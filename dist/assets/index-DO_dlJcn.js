import{r as u,j as e,R as Le,k as Un}from"./0-react-core-A2V2dXcY.js";import{V as rr,R as nr,A as ir,C as or,T as lr,D as cr,P as On,a as dr,b as Kn,c as Vn,d as Bn,S as bt,e as ur,O as aa,f as ra,g as mr,h as na,i as ia,j as hr,k as pr,l as xr,m as gr,n as Hn,o as fr,I as jr,p as yr,q as vr,r as br,L as Nr,s as wr,t as zn,u as Qn,v as Sr,w as _r,x as Yn,y as Wn,z as kr,B as Gn,E as Jn,F as Cr,G as Xn,H as Pr,J as Zn,K as Tr,M as Dr,N as ei,Q as Er,U as si,W as Rr,X as Ar,Y as ti,Z as ai,_ as qr,$ as ri,a0 as ni,a1 as ii,a2 as Fr,a3 as oi,a4 as li,a5 as Ir,a6 as $r,a7 as Lr,a8 as ci,a9 as Mr,aa as di}from"./radix-ui-R9Nxp4DW.js";import{t as ui,k as mi,m as nt,p as hi,$ as pi,u as Et,D as xi,q as gi}from"./vendor-GmHx-GZN.js";import{X as gt,W as fi,R as Pa,F as it,P as ji,H as yi,S as Ta,G as Da,T as It,I as Ur,J as ya,K as Ea,L as Or,M as Kr,N as vi,O as Vr,Q as Br,U as bi,V as Ni,Y as Re,Z as Hr,_ as Es,$ as Nt,a0 as wi,a1 as Si,a2 as Oa,a3 as vs,a4 as va,a5 as Ms,a6 as ba,a7 as kt,a8 as Ct,a9 as ft,aa as zr,ab as Xt,ac as ua,ad as Ka,ae as ts,af as Ks,ag as Va,ah as _i,ai as ki,aj as Ci,ak as Qr,al as Vs,am as Ts,an as Ra,ao as Pi,ap as fs,aq as Yr,ar as Ti,as as Di,b as Us,e as Os,at as ma,C as Xe,au as Wr,av as Gr,aw as Ei,ax as Ri,ay as Ai,az as qi,s as At,aA as As,aB as Aa,aC as Ba,aD as oa,aE as Fi,aF as Ot,aG as qt,aH as qa,aI as Zt,aJ as Ii,aK as Jr,aL as $i,aM as Na,aN as wa,aO as Bt,aP as Li,aQ as Mi,aR as Sa,aS as Ui,aT as Oi}from"./utils-CuFY74ED.js";import{u as he,a as is,b as Ne,Q as Ki}from"./react-query-BOpK3-bH.js";import{u as Gs,N as ha,a as wt,b as Fa,L as ks,c as Vi,R as Bi}from"./react-router-CWUmTk0u.js";import{C as Hi,A as zi,D as Qi,Q as Ae,I as rt}from"./appwrite-CnyP1EhL.js";import{u as _s,w as Ha,r as Yi}from"./xlsx-Ch9xS8Nz.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();const Wi=1,Gi=1e6;let pa=0;function Ji(){return pa=(pa+1)%Number.MAX_SAFE_INTEGER,pa.toString()}const xa=new Map,za=r=>{if(xa.has(r))return;const s=setTimeout(()=>{xa.delete(r),Rt({type:"REMOVE_TOAST",toastId:r})},Gi);xa.set(r,s)},Xi=(r,s)=>{switch(s.type){case"ADD_TOAST":return{...r,toasts:[s.toast,...r.toasts].slice(0,Wi)};case"UPDATE_TOAST":return{...r,toasts:r.toasts.map(t=>t.id===s.toast.id?{...t,...s.toast}:t)};case"DISMISS_TOAST":{const{toastId:t}=s;return t?za(t):r.toasts.forEach(a=>{za(a.id)}),{...r,toasts:r.toasts.map(a=>a.id===t||t===void 0?{...a,open:!1}:a)}}case"REMOVE_TOAST":return s.toastId===void 0?{...r,toasts:[]}:{...r,toasts:r.toasts.filter(t=>t.id!==s.toastId)}}},Ht=[];let zt={toasts:[]};function Rt(r){zt=Xi(zt,r),Ht.forEach(s=>{s(zt)})}function Zi({...r}){const s=Ji(),t=n=>Rt({type:"UPDATE_TOAST",toast:{...n,id:s}}),a=()=>Rt({type:"DISMISS_TOAST",toastId:s});return Rt({type:"ADD_TOAST",toast:{...r,id:s,open:!0,onOpenChange:n=>{n||a()}}}),{id:s,dismiss:a,update:t}}function Ee(){const[r,s]=u.useState(zt);return u.useEffect(()=>(Ht.push(s),()=>{const t=Ht.indexOf(s);t>-1&&Ht.splice(t,1)}),[r]),{...r,toast:Zi,dismiss:t=>Rt({type:"DISMISS_TOAST",toastId:t})}}function re(...r){return ui(mi(r))}const eo=On,Xr=u.forwardRef(({className:r,...s},t)=>e.jsx(rr,{ref:t,className:re("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",r),...s}));Xr.displayName=rr.displayName;const so=nt("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),Zr=u.forwardRef(({className:r,variant:s,...t},a)=>e.jsx(nr,{ref:a,className:re(so({variant:s}),r),...t}));Zr.displayName=nr.displayName;const to=u.forwardRef(({className:r,...s},t)=>e.jsx(ir,{ref:t,className:re("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors group-[.destructive]:border-muted/40 hover:bg-secondary group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 group-[.destructive]:focus:ring-destructive disabled:pointer-events-none disabled:opacity-50",r),...s}));to.displayName=ir.displayName;const en=u.forwardRef(({className:r,...s},t)=>e.jsx(or,{ref:t,className:re("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity group-hover:opacity-100 group-[.destructive]:text-red-300 hover:text-foreground group-[.destructive]:hover:text-red-50 focus:opacity-100 focus:outline-none focus:ring-2 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",r),"toast-close":"",...s,children:e.jsx(gt,{className:"h-4 w-4"})}));en.displayName=or.displayName;const sn=u.forwardRef(({className:r,...s},t)=>e.jsx(lr,{ref:t,className:re("text-sm font-semibold",r),...s}));sn.displayName=lr.displayName;const tn=u.forwardRef(({className:r,...s},t)=>e.jsx(cr,{ref:t,className:re("text-sm opacity-90",r),...s}));tn.displayName=cr.displayName;function ao(){const{toasts:r}=Ee();return e.jsxs(eo,{children:[r.map(function({id:s,title:t,description:a,action:n,...i}){return e.jsxs(Zr,{...i,children:[e.jsxs("div",{className:"grid gap-1",children:[t&&e.jsx(sn,{children:t}),a&&e.jsx(tn,{children:a})]}),n,e.jsx(en,{})]},s)}),e.jsx(Xr,{})]})}const ro=({...r})=>{const{theme:s="system"}=hi();return e.jsx(pi,{theme:s,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...r})},an=Kn,no=Vn,io=Bn,rn=u.forwardRef(({className:r,sideOffset:s=4,...t},a)=>e.jsx(dr,{ref:a,sideOffset:s,className:re("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...t}));rn.displayName=dr.displayName;const ge={PRE_PRODUCTION_STATUS:"pre_production_status",PRODUCTION_STATUS:"production_status",POST_PRODUCTION_STATUS:"post_production_status",INVENTORY_STATUS:"inventory_status",STOCK_STATUS:"stock_status",TASKS:"tasks",PRE_PRODUCTION_TASKS:"pre_production_tasks",PRODUCTION_TASKS:"production_tasks",PRODUCTION_TASK_ITEMS:"production_task_items",POST_PRODUCTION_TASKS:"post_production_tasks",STOCKS:"stocks",RAW_PRODUCTS:"raw_products",VENDORS:"vendors",STAFF:"staff",PROCESSES:"processes",PRODUCTS:"products",SALES_CHANNELS:"sales_channels",PURCHASES:"purchases",SALES_ORDERS:"sales_orders",SALES_ORDER_ITEMS:"sales_order_items",SALES_UNITS:"sales_units",SALES_RECORDS:"sales_records"},oo="https://fra.cloud.appwrite.io/v1",lo="68cb76af00043a1c3b77",la=new Hi;la.setEndpoint(oo);la.setProject(lo);const Me=new Qi(la),qs=new zi(la),Ue="68cb77a000339977dcb0",nn=u.createContext(void 0),os=()=>{const r=u.useContext(nn);if(r===void 0)throw new Error("useAuth must be used within an AuthProvider");return r},co=({children:r})=>{const[s,t]=u.useState(null),[a,n]=u.useState(!0);u.useEffect(()=>{i()},[]);const i=async()=>{try{if(window.self!==window.top){console.log("Running in iframe environment (preview mode)");const w=localStorage.getItem("appwrite-auth-user");if(w)try{const T=JSON.parse(w);t(T),console.log("Using stored user data in iframe:",T.email),n(!1);return}catch{console.log("Invalid stored user data, clearing..."),localStorage.removeItem("appwrite-auth-user")}}const b=await qs.get();t(b),localStorage.setItem("appwrite-auth-user",JSON.stringify(b)),console.log("Authenticated user:",b.email)}catch(g){t(null),localStorage.removeItem("appwrite-auth-user"),console.error("Authentication check failed:",{code:g.code,message:g.message,type:g.type,response:g.response,isInIframe:window.self!==window.top}),g.code===401?console.log("Session expired or invalid, user needs to login again"):console.log("Not authenticated:",g.message)}finally{n(!1)}},l=async(g,b)=>{try{await qs.createEmailPasswordSession(g,b);const w=await qs.get();t(w),localStorage.setItem("appwrite-auth-user",JSON.stringify(w)),console.log("Successfully authenticated user:",w.email)}catch(w){throw console.error("Authentication error:",w.message),w}},d={user:s,login:l,register:async(g,b,w)=>{try{await qs.create("unique()",g,b,w),await l(g,b)}catch(T){throw T}},loginWithGoogle:async()=>{try{qs.createOAuth2Session("google",`${window.location.origin}/`,`${window.location.origin}/login`)}catch(g){throw g}},logout:async()=>{try{await qs.deleteSession("current"),t(null),localStorage.removeItem("appwrite-auth-user"),console.log("Successfully logged out")}catch(g){console.error("Logout error:",g.message),t(null),localStorage.removeItem("appwrite-auth-user")}},loading:a};return e.jsx(nn.Provider,{value:d,children:r})};class ne{static field(s){return new uo(s)}static PATTERNS={EMAIL:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,PHONE:/^[\+]?[1-9][\d]{0,15}$/,PHONE_INTERNATIONAL:/^\+?[1-9]\d{1,14}$/,PHONE_US:/^(\+1|1)?[-.\s]?\(?[0-9]{3}\)?[-.\s]?[0-9]{3}[-.\s]?[0-9]{4}$/,URL:/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)$/,ALPHANUMERIC:/^[a-zA-Z0-9]+$/,ALPHA:/^[a-zA-Z]+$/,NUMERIC:/^[0-9]+$/,DECIMAL:/^[0-9]+(\.[0-9]+)?$/,DATE_ISO:/^\d{4}-\d{2}-\d{2}$/,DATE_US:/^(0[1-9]|1[0-2])\/(0[1-9]|[12][0-9]|3[01])\/\d{4}$/,TIME_24H:/^([01]?[0-9]|2[0-3]):[0-5][0-9]$/,TIME_12H:/^(0?[1-9]|1[0-2]):[0-5][0-9]\s?(AM|PM|am|pm)$/,SKU:/^[A-Z0-9\-_]+$/,CURRENCY:/^\$?[0-9]+(\.[0-9]{2})?$/};static COMMON_RULES={email:()=>({field:"email",type:"format",options:{pattern:ne.PATTERNS.EMAIL},message:"Invalid email format"}),phone:()=>({field:"phone",type:"format",options:{pattern:ne.PATTERNS.PHONE},message:"Invalid phone number format"}),currency:()=>({field:"amount",type:"format",options:{pattern:ne.PATTERNS.CURRENCY},message:"Invalid currency format (e.g., 123.45 or $123.45)"}),sku:()=>({field:"sku",type:"format",options:{pattern:ne.PATTERNS.SKU},message:"SKU must contain only uppercase letters, numbers, hyphens, and underscores"}),positiveNumber:s=>({field:s,type:"range",options:{min:0},message:"Value must be a positive number"}),percentage:s=>({field:s,type:"range",options:{min:0,max:100},message:"Percentage must be between 0 and 100"})};static isValidEmail(s){return this.PATTERNS.EMAIL.test(s)}static isValidPhone(s){return this.PATTERNS.PHONE.test(s)}static isValidDate(s){if(!s)return!1;const t=new Date(s);return!isNaN(t.getTime())}static isValidNumber(s,t,a){const n=Number(s);return!(isNaN(n)||t!==void 0&&n<t||a!==void 0&&n>a)}static isValidStringLength(s,t,a){return!(typeof s!="string"||t!==void 0&&s.length<t||a!==void 0&&s.length>a)}static isOneOf(s,t){return t.includes(s)}static isUnique(s,t,a,n){return a.filter((l,m)=>n!==void 0&&m===n?!1:l[t]===s).length===0}static sanitizeValue(s){if(typeof s=="string"){if(s=s.trim(),s==="")return null;s=s.replace(/[\u200B-\u200D\uFEFF]/g,""),s=s.replace(/\u00A0/g," ")}return s}static convertType(s,t){if(s==null)return null;switch(t){case"string":return String(s);case"number":const a=Number(s);return isNaN(a)?null:a;case"boolean":if(typeof s=="boolean")return s;if(typeof s=="string"){const i=s.toLowerCase();if(["true","1","yes","y","on"].includes(i))return!0;if(["false","0","no","n","off"].includes(i))return!1}return!!s;case"date":const n=new Date(s);return isNaN(n.getTime())?null:n;default:return s}}static formatErrorMessage(s,t,a){if(t.message)return t.message;switch(t.type){case"required":return`${s} is required`;case"format":return`${s} has invalid format`;case"range":return t.options?.min!==void 0&&t.options?.max!==void 0?`${s} must be between ${t.options.min} and ${t.options.max}`:t.options?.min!==void 0?`${s} must be at least ${t.options.min}`:t.options?.max!==void 0?`${s} must be at most ${t.options.max}`:`${s} is out of range`;case"unique":return`${s} must be unique (duplicate value: ${a})`;default:return`${s} validation failed`}}static createRulesForDataType(s,t,a=!1){const n=[];switch(a&&n.push({field:s,type:"required",message:`${s} is required`}),t.toLowerCase()){case"email":n.push(this.COMMON_RULES.email());break;case"phone":n.push(this.COMMON_RULES.phone());break;case"currency":case"money":n.push(this.COMMON_RULES.currency());break;case"sku":n.push(this.COMMON_RULES.sku());break;case"percentage":n.push(this.COMMON_RULES.percentage(s));break;case"positive_number":n.push(this.COMMON_RULES.positiveNumber(s));break;case"date":n.push({field:s,type:"custom",validator:i=>this.isValidDate(i),message:"Invalid date format"});break;case"url":n.push({field:s,type:"format",options:{pattern:this.PATTERNS.URL},message:"Invalid URL format"});break}return n}static createForeignKeyRule(s,t,a="id",n){return{field:s,type:"custom",validator:i=>i?t.some(l=>l[a]===i):!0,message:n||`${s} must reference a valid ${a}`}}static createConditionalRule(s,t,a){return{...a,field:s,validator:(n,i)=>{if(!t(i))return!0;if(a.validator)return a.validator(n,i);switch(a.type){case"required":return n!=null&&n!=="";case"format":return a.options?.pattern?a.options.pattern.test(String(n)):!0;default:return!0}}}}}class uo{constructor(s){this.field=s,this.rule={field:s}}rule;required(){return this.rule.type="required",this.rule.message=`${this.field} is required`,this}email(){return this.rule.type="format",this.rule.options={pattern:ne.PATTERNS.EMAIL},this.rule.message="Invalid email format",this}phone(){return this.rule.type="format",this.rule.options={pattern:ne.PATTERNS.PHONE},this.rule.message="Invalid phone number format",this}number(s,t){return this.rule.type="range",this.rule.options={min:s,max:t},s!==void 0&&t!==void 0?this.rule.message=`Must be between ${s} and ${t}`:s!==void 0?this.rule.message=`Must be at least ${s}`:t!==void 0&&(this.rule.message=`Must be at most ${t}`),this}string(s,t){return this.rule.type="custom",this.rule.validator=a=>ne.isValidStringLength(String(a),s,t),s!==void 0&&t!==void 0?this.rule.message=`Must be between ${s} and ${t} characters`:s!==void 0?this.rule.message=`Must be at least ${s} characters`:t!==void 0&&(this.rule.message=`Must be at most ${t} characters`),this}date(){return this.rule.type="custom",this.rule.validator=s=>ne.isValidDate(s),this.rule.message="Invalid date format",this}boolean(){return this.rule.type="custom",this.rule.validator=s=>{if(typeof s=="boolean")return!0;if(typeof s=="string"){const t=s.toLowerCase();return["true","false","1","0","yes","no","y","n"].includes(t)}return!1},this.rule.message="Must be a valid boolean value (true/false, yes/no, 1/0)",this}oneOf(s){return this.rule.type="custom",this.rule.validator=t=>ne.isOneOf(t,s),this.rule.message=`Must be one of: ${s.join(", ")}`,this}pattern(s,t){return this.rule.type="format",this.rule.options={pattern:s},this.rule.message=t||"Invalid format",this}unique(){return this.rule.type="unique",this.rule.message=`${this.field} must be unique`,this}custom(s,t){return this.rule.type="custom",this.rule.validator=(a,n,i)=>{const l={row:n||{},rowNumber:n&&n._rowNumber||0,allData:i||[],fieldName:this.field};return s(a,l)},this.rule.message=t||"Custom validation failed",this}build(){return this.rule}}const mo=r=>{try{if(!r)return"No Date";const s=new Date(r);if(isNaN(s.getTime()))return console.warn("Invalid date value:",r),"Invalid Date";const t=String(s.getDate()).padStart(2,"0"),a=String(s.getMonth()+1).padStart(2,"0"),n=s.getFullYear();return`${t}/${a}/${n}`}catch(s){return console.error("Date formatting error:",s,"Input:",r),"Invalid Date"}},ca=r=>{try{if(!r)return console.warn("formatTableDate: Empty date value received"),"No Date";if(r==="Invalid Date"||r==="NaN")return console.warn("formatTableDate: Invalid date string received:",r),"Invalid Date";let s;if(typeof r=="string"&&/^\d{2}\/\d{2}\/\d{4}$/.test(r)){const[l,m,c]=r.split("/");s=new Date(`${c}-${m}-${l}`)}else s=new Date(r);if(isNaN(s.getTime()))return console.warn("formatTableDate: Could not parse date:",r,"Type:",typeof r),"Invalid Date";const t=String(s.getDate()).padStart(2,"0"),a=String(s.getMonth()+1).padStart(2,"0"),n=s.getFullYear(),i=`${t}/${a}/${n}`;return console.log("ðŸ“… formatTableDate:",{input:r,output:i}),i}catch(s){return console.error("formatTableDate: Error formatting date:",s,"Input:",r),"Invalid Date"}},ot=r=>mo(r),ho={pageName:"stocks",exportEnabled:!0,importEnabled:!0,sortableColumns:["name","sku","category","unit","openingBalance","createdAt"],exportColumns:[{dataKey:"name",exportHeader:"Stock Name",required:!0},{dataKey:"sku",exportHeader:"SKU",required:!0},{dataKey:"category",exportHeader:"Category"},{dataKey:"unit",exportHeader:"Unit",required:!0},{dataKey:"openingBalance",exportHeader:"Opening Balance",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"description",exportHeader:"Description"},{dataKey:"createdAt",exportHeader:"Created Date",dataType:"date",formatter:r=>ot(r)}],importValidation:[ne.field("name").required().string(1,100).build(),ne.field("sku").required().pattern(ne.PATTERNS.SKU).build(),ne.field("unit").required().oneOf(["kg","g","l","ml","pcs","box","pack"]).build(),ne.field("openingBalance").number(0).build(),ne.field("category").string(0,50).build()],tableColumns:[{key:"name",label:"Stock Name",sortable:!0,dataType:"string"},{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"category",label:"Category",sortable:!0,dataType:"string"},{key:"unit",label:"Unit",sortable:!0,dataType:"string"},{key:"openingBalance",label:"Opening Balance",sortable:!0,dataType:"number",align:"right"},{key:"createdAt",label:"Created",sortable:!0,dataType:"date"}]},po={pageName:"products",exportEnabled:!0,importEnabled:!0,sortableColumns:["name","sku","category","price","createdAt"],exportColumns:[{dataKey:"name",exportHeader:"Product Name",required:!0},{dataKey:"sku",exportHeader:"SKU",required:!0},{dataKey:"category",exportHeader:"Category"},{dataKey:"price",exportHeader:"Price",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"description",exportHeader:"Description"},{dataKey:"isActive",exportHeader:"Active",dataType:"boolean",formatter:r=>r?"Yes":"No"},{dataKey:"createdAt",exportHeader:"Created Date",dataType:"date",formatter:r=>ot(r)}],importValidation:[ne.field("name").required().string(1,100).build(),ne.field("sku").required().pattern(ne.PATTERNS.SKU).build(),ne.field("price").number(0).build(),ne.field("category").string(0,50).build(),ne.field("isActive").boolean().build()],tableColumns:[{key:"name",label:"Product Name",sortable:!0,dataType:"string"},{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"category",label:"Category",sortable:!0,dataType:"string"},{key:"price",label:"Price",sortable:!0,dataType:"number",align:"right"},{key:"isActive",label:"Active",sortable:!0,dataType:"boolean"},{key:"createdAt",label:"Created",sortable:!0,dataType:"date"}]},xo={pageName:"raw-products",exportEnabled:!0,importEnabled:!0,sortableColumns:["name","sku","unit","costPerUnit","createdAt"],exportColumns:[{dataKey:"name",exportHeader:"Raw Product Name",required:!0},{dataKey:"sku",exportHeader:"SKU",required:!0},{dataKey:"unit",exportHeader:"Unit",required:!0},{dataKey:"costPerUnit",exportHeader:"Cost Per Unit",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"description",exportHeader:"Description"},{dataKey:"createdAt",exportHeader:"Created Date",dataType:"date",formatter:r=>ot(r)}],importValidation:[ne.field("name").required().string(1,100).build(),ne.field("sku").required().pattern(ne.PATTERNS.SKU).build(),ne.field("unit").required().oneOf(["kg","g","l","ml","pcs","box","pack"]).build(),ne.field("costPerUnit").number(0).build()],tableColumns:[{key:"name",label:"Raw Product Name",sortable:!0,dataType:"string"},{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"unit",label:"Unit",sortable:!0,dataType:"string"},{key:"costPerUnit",label:"Cost Per Unit",sortable:!0,dataType:"number",align:"right"},{key:"createdAt",label:"Created",sortable:!0,dataType:"date"}]},go={pageName:"staff",exportEnabled:!0,importEnabled:!0,sortableColumns:["name","email","phone","role","isActive","createdAt"],exportColumns:[{dataKey:"name",exportHeader:"Staff Name",required:!0},{dataKey:"email",exportHeader:"Email",required:!0},{dataKey:"phone",exportHeader:"Phone"},{dataKey:"role",exportHeader:"Role",required:!0},{dataKey:"department",exportHeader:"Department"},{dataKey:"isActive",exportHeader:"Active",dataType:"boolean",formatter:r=>r?"Yes":"No"},{dataKey:"createdAt",exportHeader:"Created Date",dataType:"date",formatter:r=>ot(r)}],importValidation:[ne.field("name").required().string(1,100).build(),ne.field("email").required().email().build(),ne.field("phone").phone().build(),ne.field("role").required().oneOf(["admin","manager","operator","viewer"]).build(),ne.field("department").string(0,50).build(),ne.field("isActive").boolean().build()],tableColumns:[{key:"name",label:"Staff Name",sortable:!0,dataType:"string"},{key:"email",label:"Email",sortable:!0,dataType:"string"},{key:"phone",label:"Phone",sortable:!0,dataType:"string"},{key:"role",label:"Role",sortable:!0,dataType:"string"},{key:"isActive",label:"Active",sortable:!0,dataType:"boolean"},{key:"createdAt",label:"Created",sortable:!0,dataType:"date"}]},fo={pageName:"vendors",exportEnabled:!0,importEnabled:!0,sortableColumns:["name","email","phone","contactPerson","isActive","createdAt"],exportColumns:[{dataKey:"name",exportHeader:"Vendor Name",required:!0},{dataKey:"email",exportHeader:"Email"},{dataKey:"phone",exportHeader:"Phone"},{dataKey:"contactPerson",exportHeader:"Contact Person"},{dataKey:"address",exportHeader:"Address"},{dataKey:"isActive",exportHeader:"Active",dataType:"boolean",formatter:r=>r?"Yes":"No"},{dataKey:"createdAt",exportHeader:"Created Date",dataType:"date",formatter:r=>ot(r)}],importValidation:[ne.field("name").required().string(1,100).build(),ne.field("email").email().build(),ne.field("phone").phone().build(),ne.field("contactPerson").string(0,100).build(),ne.field("address").string(0,200).build(),ne.field("isActive").boolean().build()],tableColumns:[{key:"name",label:"Vendor Name",sortable:!0,dataType:"string"},{key:"email",label:"Email",sortable:!0,dataType:"string"},{key:"phone",label:"Phone",sortable:!0,dataType:"string"},{key:"contactPerson",label:"Contact Person",sortable:!0,dataType:"string"},{key:"isActive",label:"Active",sortable:!0,dataType:"boolean"},{key:"createdAt",label:"Created",sortable:!0,dataType:"date"}]},jo={pageName:"processes",exportEnabled:!0,importEnabled:!0,sortableColumns:["name","description","estimatedTime","isActive","createdAt"],exportColumns:[{dataKey:"name",exportHeader:"Process Name",required:!0},{dataKey:"description",exportHeader:"Description"},{dataKey:"estimatedTime",exportHeader:"Estimated Time (minutes)",dataType:"number"},{dataKey:"isActive",exportHeader:"Active",dataType:"boolean",formatter:r=>r?"Yes":"No"},{dataKey:"createdAt",exportHeader:"Created Date",dataType:"date",formatter:r=>ot(r)}],importValidation:[ne.field("name").required().string(1,100).build(),ne.field("description").string(0,500).build(),ne.field("estimatedTime").number(0).build(),ne.field("isActive").boolean().build()],tableColumns:[{key:"name",label:"Process Name",sortable:!0,dataType:"string"},{key:"description",label:"Description",sortable:!0,dataType:"string"},{key:"estimatedTime",label:"Est. Time (min)",sortable:!0,dataType:"number",align:"right"},{key:"isActive",label:"Active",sortable:!0,dataType:"boolean"},{key:"createdAt",label:"Created",sortable:!0,dataType:"date"}]},yo={pageName:"sales-channels",exportEnabled:!0,importEnabled:!0,sortableColumns:["name","type","commission","isActive","createdAt"],exportColumns:[{dataKey:"name",exportHeader:"Channel Name",required:!0},{dataKey:"type",exportHeader:"Type",required:!0},{dataKey:"commission",exportHeader:"Commission (%)",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"description",exportHeader:"Description"},{dataKey:"isActive",exportHeader:"Active",dataType:"boolean",formatter:r=>r?"Yes":"No"},{dataKey:"createdAt",exportHeader:"Created Date",dataType:"date",formatter:r=>ot(r)}],importValidation:[ne.field("name").required().string(1,100).build(),ne.field("type").required().oneOf(["online","retail","wholesale","distributor"]).build(),ne.field("commission").number(0,100).build(),ne.field("description").string(0,500).build(),ne.field("isActive").boolean().build()],tableColumns:[{key:"name",label:"Channel Name",sortable:!0,dataType:"string"},{key:"type",label:"Type",sortable:!0,dataType:"string"},{key:"commission",label:"Commission (%)",sortable:!0,dataType:"number",align:"right"},{key:"isActive",label:"Active",sortable:!0,dataType:"boolean"},{key:"createdAt",label:"Created",sortable:!0,dataType:"date"}]},vo={pageName:"sales-units",exportEnabled:!0,importEnabled:!0,sortableColumns:["date","productName","sku","units","status","remarks"],exportColumns:[{dataKey:"date",exportHeader:"Date",dataType:"date",formatter:r=>new Date(r).toLocaleDateString("en-GB")},{dataKey:"productName",exportHeader:"Product",required:!0},{dataKey:"sku",exportHeader:"SKU",required:!0},{dataKey:"units",exportHeader:"Units",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"status",exportHeader:"Status"},{dataKey:"remarks",exportHeader:"Remarks"}],importValidation:[ne.field("date").required().date().build(),ne.field("productName").required().string(1,100).build(),ne.field("sku").required().string(1,50).build(),ne.field("units").required().number(.01).build(),ne.field("status").string(0,50).build(),ne.field("remarks").string(0,500).build()],tableColumns:[{key:"date",label:"Date",sortable:!0,dataType:"date"},{key:"productName",label:"Product",sortable:!0,dataType:"string"},{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"units",label:"Units",sortable:!0,dataType:"number",align:"right"},{key:"status",label:"Status",sortable:!0,dataType:"string"},{key:"remarks",label:"Remarks",sortable:!0,dataType:"string"}]},bo={pageName:"sales-record",exportEnabled:!0,importEnabled:!0,sortableColumns:["date","channelName","productName","sku","qty","rate","totalAmount","status","remarks"],exportColumns:[{dataKey:"date",exportHeader:"Date",dataType:"date",formatter:r=>new Date(r).toLocaleDateString("en-GB")},{dataKey:"channelName",exportHeader:"Sales Channel",required:!0},{dataKey:"productName",exportHeader:"Product",required:!0},{dataKey:"sku",exportHeader:"SKU",required:!0},{dataKey:"qty",exportHeader:"Qty",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"rate",exportHeader:"Rate",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"totalAmount",exportHeader:"Total Amount",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"status",exportHeader:"Status"},{dataKey:"remarks",exportHeader:"Remarks"}],importValidation:[ne.field("date").required().date().build(),ne.field("channelName").required().string(1,100).build(),ne.field("productName").required().string(1,100).build(),ne.field("sku").required().string(1,50).build(),ne.field("qty").required().number(.01).build(),ne.field("rate").required().number(.01).build(),ne.field("totalAmount").number(.01).build(),ne.field("status").string(0,50).build(),ne.field("remarks").string(0,500).build()],tableColumns:[{key:"date",label:"Date",sortable:!0,dataType:"date"},{key:"channelName",label:"Sales Channel",sortable:!0,dataType:"string"},{key:"productName",label:"Product",sortable:!0,dataType:"string"},{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"qty",label:"Qty",sortable:!0,dataType:"number",align:"right"},{key:"rate",label:"Rate",sortable:!0,dataType:"number",align:"right"},{key:"totalAmount",label:"Total Amount",sortable:!0,dataType:"number",align:"right"},{key:"status",label:"Status",sortable:!0,dataType:"string"},{key:"remarks",label:"Remarks",sortable:!0,dataType:"string"}]},No={pageName:"purchases",exportEnabled:!0,importEnabled:!0,sortableColumns:["purchaseCode","date","vendorName","stockName","quantity","rate","totalAmount","status"],exportColumns:[{dataKey:"purchaseCode",exportHeader:"Purchase Code",required:!0},{dataKey:"date",exportHeader:"Date",dataType:"date",formatter:r=>new Date(r).toLocaleDateString("en-GB")},{dataKey:"vendorName",exportHeader:"Vendor Name",required:!0},{dataKey:"stockName",exportHeader:"Stock Name",required:!0},{dataKey:"quantity",exportHeader:"Quantity",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"rate",exportHeader:"Rate",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"totalAmount",exportHeader:"Total Amount",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"status",exportHeader:"Status"}],importValidation:[ne.field("purchaseCode").required().string(1,50).build(),ne.field("date").required().date().build(),ne.field("vendorName").required().string(1,100).build(),ne.field("stockName").required().string(1,100).build(),ne.field("quantity").required().number(.01).build(),ne.field("rate").required().number(.01).build(),ne.field("totalAmount").number(.01).build(),ne.field("status").string(0,50).build()],tableColumns:[{key:"purchaseCode",label:"Purchase Code",sortable:!0,dataType:"string"},{key:"date",label:"Date",sortable:!0,dataType:"date"},{key:"vendorName",label:"Vendor Name",sortable:!0,dataType:"string"},{key:"stockName",label:"Stock Name",sortable:!0,dataType:"string"},{key:"quantity",label:"Quantity",sortable:!0,dataType:"number",align:"right"},{key:"unitPrice",label:"Unit Price",sortable:!0,dataType:"number",align:"right"},{key:"totalAmount",label:"Total",sortable:!0,dataType:"number",align:"right"},{key:"purchaseDate",label:"Purchase Date",sortable:!0,dataType:"date"},{key:"vendorName",label:"Vendor",sortable:!0,dataType:"string"},{key:"createdAt",label:"Created",sortable:!0,dataType:"date"}]},wo={pageName:"pre-production-tasks",exportEnabled:!0,importEnabled:!0,sortableColumns:["task_id","stock_name","stock_source","date_assigned","process_name","assigned_quantity","staff_name","date_completed","completed_quantity","wastage_quantity","status"],exportColumns:[{dataKey:"task_id",exportHeader:"Task ID",required:!0},{dataKey:"stock_name",exportHeader:"Stock Name",required:!0},{dataKey:"stock_source",exportHeader:"Stock Source"},{dataKey:"date_assigned",exportHeader:"Date Assigned",dataType:"date",formatter:r=>new Date(r).toLocaleDateString("en-GB")},{dataKey:"process_name",exportHeader:"Process",required:!0},{dataKey:"assigned_quantity",exportHeader:"Assigned Qty",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"staff_name",exportHeader:"Staff Name"},{dataKey:"date_completed",exportHeader:"Date Completed",dataType:"date",formatter:r=>r?new Date(r).toLocaleDateString("en-GB"):""},{dataKey:"completed_quantity",exportHeader:"Completed Qty",dataType:"number",formatter:r=>r?Number(r).toFixed(2):"0.00"},{dataKey:"wastage_quantity",exportHeader:"Wastage Qty",dataType:"number",formatter:r=>r?Number(r).toFixed(2):"0.00"},{dataKey:"remarks",exportHeader:"Remarks"},{dataKey:"status",exportHeader:"Status"}],importValidation:[ne.field("task_id").required().string(1,50).build(),ne.field("stock_name").required().string(1,100).build(),ne.field("assigned_quantity").required().number(.01).build(),ne.field("status").required().oneOf(["pending","in_progress","completed","cancelled"]).build(),ne.field("date_assigned").date().build(),ne.field("staff_name").string(0,100).build()],tableColumns:[{key:"task_id",label:"Task ID",sortable:!0,dataType:"string"},{key:"stock_name",label:"Stock Name",sortable:!0,dataType:"string"},{key:"stock_source",label:"Stock Source",sortable:!0,dataType:"string"},{key:"date_assigned",label:"Date Assigned",sortable:!0,dataType:"date"},{key:"process_name",label:"Process",sortable:!0,dataType:"string"},{key:"assigned_quantity",label:"Assigned Qty",sortable:!0,dataType:"number",align:"right"},{key:"staff_name",label:"Staff Name",sortable:!0,dataType:"string"},{key:"date_completed",label:"Date Completed",sortable:!0,dataType:"date"},{key:"completed_quantity",label:"Completed Qty",sortable:!0,dataType:"number",align:"right"},{key:"wastage_quantity",label:"Wastage Qty",sortable:!0,dataType:"number",align:"right"},{key:"status",label:"Status",sortable:!0,dataType:"string"}]},So={pageName:"production-tasks",exportEnabled:!0,importEnabled:!0,sortableColumns:["task_id","date","raw_product_name","process_name","staff_name","assigned_quantity","wastage_quantity","status"],exportColumns:[{dataKey:"task_id",exportHeader:"Task ID",required:!0},{dataKey:"date",exportHeader:"Date",dataType:"date",formatter:r=>new Date(r).toLocaleDateString("en-GB")},{dataKey:"raw_product_name",exportHeader:"Raw Product",required:!0},{dataKey:"process_name",exportHeader:"Process",required:!0},{dataKey:"staff_name",exportHeader:"Staff Name"},{dataKey:"assigned_quantity",exportHeader:"Assigned Qty",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"wastage_quantity",exportHeader:"Wastage Qty",dataType:"number",formatter:r=>r?Number(r).toFixed(2):"0.00"},{dataKey:"status",exportHeader:"Status"}],importValidation:[ne.field("task_id").required().string(1,50).build(),ne.field("raw_product_name").required().string(1,100).build(),ne.field("process_name").required().string(1,100).build(),ne.field("assigned_quantity").required().number(.01).build(),ne.field("status").required().oneOf(["pending","in_progress","completed","cancelled"]).build(),ne.field("date").date().build(),ne.field("staff_name").string(0,100).build()],tableColumns:[{key:"task_id",label:"Task ID",sortable:!0,dataType:"string"},{key:"date",label:"Date",sortable:!0,dataType:"date"},{key:"raw_product_name",label:"Raw Product",sortable:!0,dataType:"string"},{key:"process_name",label:"Process",sortable:!0,dataType:"string"},{key:"assignedQuantity",label:"Quantity",sortable:!0,dataType:"number",align:"right"},{key:"assignedTo",label:"Assigned To",sortable:!0,dataType:"string"},{key:"status",label:"Status",sortable:!0,dataType:"string"},{key:"dueDate",label:"Due Date",sortable:!0,dataType:"date"},{key:"createdAt",label:"Created",sortable:!0,dataType:"date"}]},_o={pageName:"post-production-tasks",exportEnabled:!0,importEnabled:!0,sortableColumns:["task_id","date","date_completed","source_quantity","sku","product_name","process_name","staff_name","assigned_quantity","units","wastage_quantity","status"],exportColumns:[{dataKey:"task_id",exportHeader:"Task ID",required:!0},{dataKey:"date",exportHeader:"Date Assigned",dataType:"date",formatter:r=>new Date(r).toLocaleDateString("en-GB")},{dataKey:"date_completed",exportHeader:"Date Completed",dataType:"date",formatter:r=>r?new Date(r).toLocaleDateString("en-GB"):""},{dataKey:"source_quantity",exportHeader:"Source Qty",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"sku",exportHeader:"SKU",required:!0},{dataKey:"product_name",exportHeader:"Product",required:!0},{dataKey:"process_name",exportHeader:"Process",required:!0},{dataKey:"staff_name",exportHeader:"Staff Name"},{dataKey:"assigned_quantity",exportHeader:"Assigned Units",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"units",exportHeader:"Completed Units",dataType:"number",formatter:r=>r?Number(r).toFixed(2):"0.00"},{dataKey:"wastage_quantity",exportHeader:"Wastage Qty",dataType:"number",formatter:r=>r?Number(r).toFixed(2):"0.00"},{dataKey:"remarks",exportHeader:"Remarks"},{dataKey:"status",exportHeader:"Status"}],importValidation:[ne.field("task_id").required().string(1,50).build(),ne.field("product_name").required().string(1,100).build(),ne.field("sku").required().string(1,50).build(),ne.field("process_name").required().string(1,100).build(),ne.field("source_quantity").required().number(.01).build(),ne.field("assigned_quantity").required().number(.01).build(),ne.field("status").required().oneOf(["pending","in_progress","completed","cancelled"]).build(),ne.field("date").date().build(),ne.field("staff_name").string(0,100).build()],tableColumns:[{key:"task_id",label:"Task ID",sortable:!0,dataType:"string"},{key:"date",label:"Date Assigned",sortable:!0,dataType:"date"},{key:"date_completed",label:"Date Completed",sortable:!0,dataType:"date"},{key:"source_quantity",label:"Source Qty",sortable:!0,dataType:"number",align:"right"},{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"product_name",label:"Product",sortable:!0,dataType:"string"},{key:"process_name",label:"Process",sortable:!0,dataType:"string"},{key:"staff_name",label:"Staff Name",sortable:!0,dataType:"string"},{key:"assigned_quantity",label:"Assigned Units",sortable:!0,dataType:"number",align:"right"},{key:"units",label:"Completed Units",sortable:!0,dataType:"number",align:"right"},{key:"wastage_quantity",label:"Wastage Qty",sortable:!0,dataType:"number",align:"right"},{key:"status",label:"Status",sortable:!0,dataType:"string"}]},ko={pageName:"stock-status",exportEnabled:!0,importEnabled:!1,sortableColumns:["stockName","openingBalance","purchases","sales","closingBalance"],exportColumns:[{dataKey:"stockName",exportHeader:"Stock Name"},{dataKey:"openingBalance",exportHeader:"Opening Balance",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"purchases",exportHeader:"Purchases",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"sales",exportHeader:"Sales",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"closingBalance",exportHeader:"Closing Balance",dataType:"number",formatter:r=>Number(r).toFixed(2)}],importValidation:[],tableColumns:[{key:"stockName",label:"Stock Name",sortable:!0,dataType:"string"},{key:"openingBalance",label:"Opening Balance",sortable:!0,dataType:"number",align:"right"},{key:"purchases",label:"Purchases",sortable:!0,dataType:"number",align:"right"},{key:"sales",label:"Sales",sortable:!0,dataType:"number",align:"right"},{key:"closingBalance",label:"Closing Balance",sortable:!0,dataType:"number",align:"right"}]},Co={pageName:"inventory-status",exportEnabled:!0,importEnabled:!1,sortableColumns:["stockName","openingBalance","salesUnits","soldUnits","closingBalance"],exportColumns:[{dataKey:"stockName",exportHeader:"Stock Name"},{dataKey:"openingBalance",exportHeader:"Opening Balance",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"salesUnits",exportHeader:"Sales Units",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"soldUnits",exportHeader:"Sold Units",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"closingBalance",exportHeader:"Closing Balance",dataType:"number",formatter:r=>Number(r).toFixed(2)}],importValidation:[],tableColumns:[{key:"stockName",label:"Stock Name",sortable:!0,dataType:"string"},{key:"openingBalance",label:"Opening Balance",sortable:!0,dataType:"number",align:"right"},{key:"salesUnits",label:"Sales Units",sortable:!0,dataType:"number",align:"right"},{key:"soldUnits",label:"Sold Units",sortable:!0,dataType:"number",align:"right"},{key:"closingBalance",label:"Closing Balance",sortable:!0,dataType:"number",align:"right"}]},on={stocks:ho,products:po,"raw-products":xo,staff:go,vendors:fo,processes:jo,"sales-channels":yo,"sales-units":vo,"sales-record":bo,purchases:No,"pre-production-tasks":wo,"production-tasks":So,"post-production-tasks":_o,"stock-status":ko,"inventory-status":Co},Po=r=>on[r],To={defaultExportFormat:"xlsx",maxImportFileSize:50,defaultBatchSize:100,enableProgressTracking:!0,autoRefreshInterval:300,cacheTimeout:30,enableValidationWarnings:!0,defaultSortDirection:"asc",enableMultiSort:!1,maxExportRows:1e5,enableBackgroundExport:!0},ln=u.createContext(void 0),Do=({children:r,initialSettings:s={}})=>{const[t,a]=u.useState({}),[n,i]=u.useState({...To,...s}),[l,m]=u.useState(!1),[c,o]=u.useState(null);u.useEffect(()=>{try{const _=localStorage.getItem("dataManagementSettings");if(_){const Q=JSON.parse(_);i(K=>({...K,...Q}))}}catch(_){console.warn("Failed to load saved settings:",_)}},[]),u.useEffect(()=>{try{localStorage.setItem("dataManagementSettings",JSON.stringify(n))}catch(_){console.warn("Failed to save settings:",_)}},[n]),u.useEffect(()=>{if(n.autoRefreshInterval>0){const _=setInterval(()=>{d()},n.autoRefreshInterval*1e3);return()=>clearInterval(_)}},[n.autoRefreshInterval]);const d=()=>{const _=Date.now(),Q=n.cacheTimeout*60*1e3;a(K=>{const S={...K};return Object.keys(S).forEach(h=>{_-S[h].timestamp>Q&&delete S[h]}),S})},g=u.useCallback(_=>{try{const Q=t[_],K=Date.now(),S=n.cacheTimeout*60*1e3;if(Q&&K-Q.timestamp<S)return Q.config;const h=Po(_);return h&&setTimeout(()=>{a(I=>({...I,[_]:{config:h,timestamp:K}}))},0),h}catch(Q){o(`Failed to get configuration for ${_}: ${Q instanceof Error?Q.message:"Unknown error"}`);return}},[t,n.cacheTimeout]),b=(_,Q)=>{try{const K=g(_);if(!K)throw new Error(`Configuration not found for page: ${_}`);const S={...K,...Q};a(h=>({...h,[_]:{config:S,timestamp:Date.now()}})),on[_]=S,o(null)}catch(K){o(`Failed to update configuration for ${_}: ${K instanceof Error?K.message:"Unknown error"}`)}},w=_=>{try{a(Q=>{const K={...Q};return delete K[_],K}),o(null)}catch(Q){o(`Failed to reset configuration for ${_}: ${Q instanceof Error?Q.message:"Unknown error"}`)}},T=_=>g(_)?.exportEnabled||!1,L=_=>g(_)?.importEnabled||!1,f=_=>g(_)?.exportColumns||[],N=_=>g(_)?.tableColumns||[],E=_=>g(_)?.importValidation||[],D=_=>{i(Q=>({...Q,..._})),o(null)},k=()=>{a({}),o(null)},H={getConfig:g,updateConfig:b,resetConfig:w,canExport:T,canImport:L,getExportColumns:f,getTableColumns:N,getValidationRules:E,globalSettings:n,updateGlobalSettings:D,clearCache:k,refreshConfig:_=>{_?a(Q=>{const K={...Q};return delete K[_],K}):k(),o(null)},isLoading:l,error:c};return e.jsx(ln.Provider,{value:H,children:r})},Ia=()=>{const r=u.useContext(ln);if(r===void 0)throw new Error("useDataManagement must be used within a DataManagementProvider");return r},bs=r=>{const{getConfig:s,updateConfig:t,resetConfig:a,canExport:n,canImport:i}=Ia(),l=s(r);return{config:l,canExport:n(r),canImport:i(r),updateConfig:m=>t(r,m),resetConfig:()=>a(r),isConfigured:!!l}},Ns=r=>{const{getValidationRules:s,canImport:t,globalSettings:a}=Ia();return{validationRules:s(r),canImport:t(r),maxFileSize:a.maxImportFileSize,batchSize:a.defaultBatchSize,enableWarnings:a.enableValidationWarnings}},Eo=r=>{const{getTableColumns:s,globalSettings:t}=Ia();return{columns:s(r),defaultSortDirection:t.defaultSortDirection,enableMultiSort:t.enableMultiSort}},_a=nt("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),A=u.forwardRef(({className:r,variant:s,size:t,asChild:a=!1,...n},i)=>{const l=a?bt:"button";return e.jsx(l,{className:re(_a({variant:s,size:t,className:r})),ref:i,...n})});A.displayName="Button";const Ro=nt("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),Oe=u.forwardRef(({className:r,variant:s,...t},a)=>e.jsx("div",{ref:a,role:"alert",className:re(Ro({variant:s}),r),...t}));Oe.displayName="Alert";const Ao=u.forwardRef(({className:r,...s},t)=>e.jsx("h5",{ref:t,className:re("mb-1 font-medium leading-none tracking-tight",r),...s}));Ao.displayName="AlertTitle";const Ke=u.forwardRef(({className:r,...s},t)=>e.jsx("div",{ref:t,className:re("text-sm [&_p]:leading-relaxed",r),...s}));Ke.displayName="AlertDescription";class qo{isDevelopment=!1;isVerbose=!1;log(...s){this.isDevelopment&&console.log(...s)}verbose(...s){this.isDevelopment&&this.isVerbose&&console.log(...s)}warn(...s){this.isDevelopment&&console.warn(...s)}error(...s){console.error(...s),this.isDevelopment}logWithContext(s,t,a){if(this.isDevelopment){const n=this.formatContext(t);console.log(`${n} ${s}`,a||"")}}performance(s,t){if(this.isDevelopment){console.time(s);const a=t();return console.timeEnd(s),a}return t()}async performanceAsync(s,t){if(this.isDevelopment){console.time(s);const a=await t();return console.timeEnd(s),a}return t()}group(s,t){this.isDevelopment&&(console.group(s),t(),console.groupEnd())}table(s){this.isDevelopment&&console.table(s)}json(s,t){this.isDevelopment&&console.log(`${s}:`,JSON.stringify(t,null,2))}assert(s,t){this.isDevelopment&&!s&&console.error(`Assertion failed: ${t}`)}formatContext(s){const t=[];return s.component&&t.push(`[${s.component}]`),s.hook&&t.push(`[${s.hook}]`),s.service&&t.push(`[${s.service}]`),t.join(" ")}}const ps=new qo;ps.performance.bind(ps);ps.performanceAsync.bind(ps);ps.group.bind(ps);ps.table.bind(ps);ps.json.bind(ps);function Fo(){const[r,s]=u.useState(null),[t,a]=u.useState(!1),[n,i]=u.useState(!1),[l,m]=u.useState(navigator.onLine),[c,o]=u.useState(!1);return u.useEffect(()=>{window.matchMedia("(display-mode: standalone)").matches&&i(!0);const b=f=>{f.preventDefault(),s(f),a(!0)},w=()=>{i(!0),a(!1),s(null)},T=()=>m(!0),L=()=>m(!1);return window.addEventListener("beforeinstallprompt",b),window.addEventListener("appinstalled",w),window.addEventListener("online",T),window.addEventListener("offline",L),"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").then(f=>{ps.log("Service Worker registered:",f),f.addEventListener("updatefound",()=>{const N=f.installing;N&&N.addEventListener("statechange",()=>{N.state==="installed"&&navigator.serviceWorker.controller&&o(!0)})})}).catch(f=>{console.error("Service Worker registration failed:",f)}),()=>{window.removeEventListener("beforeinstallprompt",b),window.removeEventListener("appinstalled",w),window.removeEventListener("online",T),window.removeEventListener("offline",L)}},[]),{isInstallable:t,isInstalled:n,isOnline:l,updateAvailable:c,installApp:async()=>{if(!r)return!1;try{await r.prompt();const{outcome:b}=await r.userChoice;return b==="accepted"?(s(null),a(!1),!0):!1}catch(b){return console.error("Error installing app:",b),!1}},updateApp:()=>{"serviceWorker"in navigator&&navigator.serviceWorker.getRegistration().then(b=>{b&&b.waiting&&(b.waiting.postMessage({type:"SKIP_WAITING"}),window.location.reload())})}}}function Io(){const{isInstallable:r,isInstalled:s,isOnline:t,updateAvailable:a,installApp:n,updateApp:i}=Fo(),{toast:l}=Ee(),[m,c]=u.useState(!1),[o,d]=u.useState(!1);u.useEffect(()=>{if(r&&!s&&!localStorage.getItem("pwa-install-dismissed")){const L=setTimeout(()=>{c(!0)},3e4);return()=>clearTimeout(L)}},[r,s]),u.useEffect(()=>{a&&d(!0)},[a]);const g=async()=>{await n()&&(c(!1),l({title:"App installed!",description:"Molaga ERP has been added to your home screen"}))},b=()=>{c(!1),localStorage.setItem("pwa-install-dismissed","true")},w=()=>{i(),d(!1)};return t?o?e.jsx("div",{className:"fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-96 z-50",children:e.jsxs(Oe,{className:"bg-blue-50 border-blue-200",children:[e.jsx(Pa,{className:"h-4 w-4 text-blue-600"}),e.jsx(Ke,{className:"text-blue-800",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"New version available!"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(A,{size:"sm",variant:"outline",onClick:()=>d(!1),className:"h-7",children:"Later"}),e.jsx(A,{size:"sm",onClick:w,className:"h-7 bg-blue-600 hover:bg-blue-700",children:"Update"})]})]})})]})}):m&&!s?e.jsx("div",{className:"fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-96 z-50",children:e.jsxs(Oe,{className:"bg-primary/5 border-primary/20",children:[e.jsx(it,{className:"h-4 w-4 text-primary"}),e.jsxs(Ke,{children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-foreground mb-1",children:"Install Molaga ERP"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Add to your home screen for quick access and offline use"})]}),e.jsx(A,{size:"sm",variant:"ghost",onClick:b,className:"h-6 w-6 p-0",children:e.jsx(gt,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx(A,{size:"sm",variant:"outline",onClick:b,className:"flex-1",children:"Not now"}),e.jsx(A,{size:"sm",onClick:g,className:"flex-1 bg-primary hover:bg-primary/90",children:"Install"})]})]})]})}):null:e.jsx("div",{className:"fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-96 z-50",children:e.jsxs(Oe,{className:"bg-orange-50 border-orange-200",children:[e.jsx(fi,{className:"h-4 w-4 text-orange-600"}),e.jsx(Ke,{className:"text-orange-800",children:"You're offline. Some features may be limited."})]})})}const ga=768;function $o(){const[r,s]=u.useState(void 0);return u.useEffect(()=>{const t=window.matchMedia(`(max-width: ${ga-1}px)`),a=()=>{s(window.innerWidth<ga)};return t.addEventListener("change",a),s(window.innerWidth<ga),()=>t.removeEventListener("change",a)},[]),!!r}const V=u.forwardRef(({className:r,type:s,...t},a)=>e.jsx("input",{type:s,className:re("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:a,...t}));V.displayName="Input";const da=u.forwardRef(({className:r,orientation:s="horizontal",decorative:t=!0,...a},n)=>e.jsx(ur,{ref:n,decorative:t,orientation:s,className:re("shrink-0 bg-border",s==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",r),...a}));da.displayName=ur.displayName;const Lo=hr,Mo=pr,cn=u.forwardRef(({className:r,...s},t)=>e.jsx(aa,{className:re("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r),...s,ref:t}));cn.displayName=aa.displayName;const Uo=nt("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),dn=u.forwardRef(({side:r="right",className:s,children:t,...a},n)=>e.jsxs(Mo,{children:[e.jsx(cn,{}),e.jsxs(ra,{ref:n,className:re(Uo({side:r}),s),...a,children:[t,e.jsxs(mr,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-secondary hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[e.jsx(gt,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));dn.displayName=ra.displayName;const Oo=u.forwardRef(({className:r,...s},t)=>e.jsx(na,{ref:t,className:re("text-lg font-semibold text-foreground",r),...s}));Oo.displayName=na.displayName;const Ko=u.forwardRef(({className:r,...s},t)=>e.jsx(ia,{ref:t,className:re("text-sm text-muted-foreground",r),...s}));Ko.displayName=ia.displayName;function Qa({className:r,...s}){return e.jsx("div",{className:re("animate-pulse rounded-md bg-muted",r),...s})}const Vo="sidebar:state",Bo=60*60*24*7,Ho="16rem",zo="18rem",Qo="3rem",Yo="b",un=u.createContext(null);function $t(){const r=u.useContext(un);if(!r)throw new Error("useSidebar must be used within a SidebarProvider.");return r}const mn=u.forwardRef(({defaultOpen:r=!0,open:s,onOpenChange:t,className:a,style:n,children:i,...l},m)=>{const c=$o(),[o,d]=u.useState(!1),[g,b]=u.useState(r),w=s??g,T=u.useCallback(E=>{const D=typeof E=="function"?E(w):E;t?t(D):b(D),document.cookie=`${Vo}=${D}; path=/; max-age=${Bo}`},[t,w]),L=u.useCallback(()=>c?d(E=>!E):T(E=>!E),[c,T,d]);u.useEffect(()=>{const E=D=>{D.key===Yo&&(D.metaKey||D.ctrlKey)&&(D.preventDefault(),L())};return window.addEventListener("keydown",E),()=>window.removeEventListener("keydown",E)},[L]);const f=w?"expanded":"collapsed",N=u.useMemo(()=>({state:f,open:w,setOpen:T,isMobile:c,openMobile:o,setOpenMobile:d,toggleSidebar:L}),[f,w,T,c,o,d,L]);return e.jsx(un.Provider,{value:N,children:e.jsx(an,{delayDuration:0,children:e.jsx("div",{style:{"--sidebar-width":Ho,"--sidebar-width-icon":Qo,...n},className:re("group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar",a),ref:m,...l,children:i})})})});mn.displayName="SidebarProvider";const hn=u.forwardRef(({side:r="left",variant:s="sidebar",collapsible:t="offcanvas",className:a,children:n,...i},l)=>{const{isMobile:m,state:c,openMobile:o,setOpenMobile:d}=$t();return t==="none"?e.jsx("div",{className:re("flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground",a),ref:l,...i,children:n}):m?e.jsx(Lo,{open:o,onOpenChange:d,...i,children:e.jsx(dn,{"data-sidebar":"sidebar","data-mobile":"true",className:"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden",style:{"--sidebar-width":zo},side:r,children:e.jsx("div",{className:"flex h-full w-full flex-col",children:n})})}):e.jsxs("div",{ref:l,className:"group peer hidden text-sidebar-foreground md:block","data-state":c,"data-collapsible":c==="collapsed"?t:"","data-variant":s,"data-side":r,children:[e.jsx("div",{className:re("relative h-svh w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear","group-data-[collapsible=offcanvas]:w-0","group-data-[side=right]:rotate-180",s==="floating"||s==="inset"?"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon]")}),e.jsx("div",{className:re("fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex",r==="left"?"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]":"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]",s==="floating"||s==="inset"?"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l",a),...i,children:e.jsx("div",{"data-sidebar":"sidebar",className:"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow",children:n})})]})});hn.displayName="Sidebar";const pn=u.forwardRef(({className:r,onClick:s,...t},a)=>{const{toggleSidebar:n}=$t();return e.jsxs(A,{ref:a,"data-sidebar":"trigger",variant:"ghost",size:"icon",className:re("h-7 w-7",r),onClick:i=>{s?.(i),n()},...t,children:[e.jsx(ji,{}),e.jsx("span",{className:"sr-only",children:"Toggle Sidebar"})]})});pn.displayName="SidebarTrigger";const Wo=u.forwardRef(({className:r,...s},t)=>{const{toggleSidebar:a}=$t();return e.jsx("button",{ref:t,"data-sidebar":"rail","aria-label":"Toggle Sidebar",tabIndex:-1,onClick:a,title:"Toggle Sidebar",className:re("absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] group-data-[side=left]:-right-4 group-data-[side=right]:left-0 hover:after:bg-sidebar-border sm:flex","[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize","[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize","group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar","[[data-side=left][data-collapsible=offcanvas]_&]:-right-2","[[data-side=right][data-collapsible=offcanvas]_&]:-left-2",r),...s})});Wo.displayName="SidebarRail";const Go=u.forwardRef(({className:r,...s},t)=>e.jsx("main",{ref:t,className:re("relative flex min-h-svh flex-1 flex-col bg-background","peer-data-[variant=inset]:min-h-[calc(100svh-theme(spacing.4))] md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow",r),...s}));Go.displayName="SidebarInset";const Jo=u.forwardRef(({className:r,...s},t)=>e.jsx(V,{ref:t,"data-sidebar":"input",className:re("h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring",r),...s}));Jo.displayName="SidebarInput";const Xo=u.forwardRef(({className:r,...s},t)=>e.jsx("div",{ref:t,"data-sidebar":"header",className:re("flex flex-col gap-2 p-2",r),...s}));Xo.displayName="SidebarHeader";const Zo=u.forwardRef(({className:r,...s},t)=>e.jsx("div",{ref:t,"data-sidebar":"footer",className:re("flex flex-col gap-2 p-2",r),...s}));Zo.displayName="SidebarFooter";const el=u.forwardRef(({className:r,...s},t)=>e.jsx(da,{ref:t,"data-sidebar":"separator",className:re("mx-2 w-auto bg-sidebar-border",r),...s}));el.displayName="SidebarSeparator";const xn=u.forwardRef(({className:r,...s},t)=>e.jsx("div",{ref:t,"data-sidebar":"content",className:re("flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden",r),...s}));xn.displayName="SidebarContent";const Qt=u.forwardRef(({className:r,...s},t)=>e.jsx("div",{ref:t,"data-sidebar":"group",className:re("relative flex w-full min-w-0 flex-col p-2",r),...s}));Qt.displayName="SidebarGroup";const ka=u.forwardRef(({className:r,asChild:s=!1,...t},a)=>{const n=s?bt:"div";return e.jsx(n,{ref:a,"data-sidebar":"group-label",className:re("flex h-8 shrink-0 items-center rounded-md px-2 text-sm font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opa] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0",r),...t})});ka.displayName="SidebarGroupLabel";const sl=u.forwardRef(({className:r,asChild:s=!1,...t},a)=>{const n=s?bt:"button";return e.jsx(n,{ref:a,"data-sidebar":"group-action",className:re("absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","group-data-[collapsible=icon]:hidden",r),...t})});sl.displayName="SidebarGroupAction";const Yt=u.forwardRef(({className:r,...s},t)=>e.jsx("div",{ref:t,"data-sidebar":"group-content",className:re("w-full text-sm",r),...s}));Yt.displayName="SidebarGroupContent";const Wt=u.forwardRef(({className:r,...s},t)=>e.jsx("ul",{ref:t,"data-sidebar":"menu",className:re("flex w-full min-w-0 flex-col gap-1",r),...s}));Wt.displayName="SidebarMenu";const Gt=u.forwardRef(({className:r,...s},t)=>e.jsx("li",{ref:t,"data-sidebar":"menu-item",className:re("group/menu-item relative",r),...s}));Gt.displayName="SidebarMenuItem";const tl=nt("peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-base outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",{variants:{variant:{default:"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",outline:"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]"},size:{default:"h-8 text-base",sm:"h-7 text-sm",lg:"h-12 text-base group-data-[collapsible=icon]:!p-0"}},defaultVariants:{variant:"default",size:"default"}}),Jt=u.forwardRef(({asChild:r=!1,isActive:s=!1,variant:t="default",size:a="default",tooltip:n,className:i,...l},m)=>{const c=r?bt:"button",{isMobile:o,state:d}=$t(),g=e.jsx(c,{ref:m,"data-sidebar":"menu-button","data-size":a,"data-active":s,className:re(tl({variant:t,size:a}),i),...l});return n?(typeof n=="string"&&(n={children:n}),e.jsxs(no,{children:[e.jsx(io,{asChild:!0,children:g}),e.jsx(rn,{side:"right",align:"center",hidden:d!=="collapsed"||o,...n})]})):g});Jt.displayName="SidebarMenuButton";const al=u.forwardRef(({className:r,asChild:s=!1,showOnHover:t=!1,...a},n)=>{const i=s?bt:"button";return e.jsx(i,{ref:n,"data-sidebar":"menu-action",className:re("absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform peer-hover/menu-button:text-sidebar-accent-foreground hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",t&&"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0",r),...a})});al.displayName="SidebarMenuAction";const rl=u.forwardRef(({className:r,...s},t)=>e.jsx("div",{ref:t,"data-sidebar":"menu-badge",className:re("pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground","peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",r),...s}));rl.displayName="SidebarMenuBadge";const nl=u.forwardRef(({className:r,showIcon:s=!1,...t},a)=>{const n=u.useMemo(()=>`${Math.floor(Math.random()*40)+50}%`,[]);return e.jsxs("div",{ref:a,"data-sidebar":"menu-skeleton",className:re("flex h-8 items-center gap-2 rounded-md px-2",r),...t,children:[s&&e.jsx(Qa,{className:"size-4 rounded-md","data-sidebar":"menu-skeleton-icon"}),e.jsx(Qa,{className:"h-4 max-w-[--skeleton-width] flex-1","data-sidebar":"menu-skeleton-text",style:{"--skeleton-width":n}})]})});nl.displayName="SidebarMenuSkeleton";const il=u.forwardRef(({className:r,...s},t)=>e.jsx("ul",{ref:t,"data-sidebar":"menu-sub",className:re("mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5","group-data-[collapsible=icon]:hidden",r),...s}));il.displayName="SidebarMenuSub";const ol=u.forwardRef(({...r},s)=>e.jsx("li",{ref:s,...r}));ol.displayName="SidebarMenuSubItem";const ll=u.forwardRef(({asChild:r=!1,size:s="md",isActive:t,className:a,...n},i)=>{const l=r?bt:"a";return e.jsx(l,{ref:i,"data-sidebar":"menu-sub-button","data-size":s,"data-active":t,className:re("flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring aria-disabled:pointer-events-none aria-disabled:opacity-50 hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground","data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground",s==="sm"&&"text-xs",s==="md"&&"text-sm","group-data-[collapsible=icon]:hidden",a),...n})});ll.displayName="SidebarMenuSubButton";const cl=[{title:"Dashboard",url:"/",icon:yi},{title:"Purchases",url:"/purchases",icon:Ta},{title:"Tasks",url:"/tasks",icon:Da},{title:"Status",url:"/status",icon:It},{title:"Sales",url:"/sales",icon:Ur}],dl=[{title:"Master Data",url:"/master",icon:ya},{title:"Analytics",url:"/analytics",icon:ya}],ul=[{title:"Settings",url:"/settings",icon:Ea}];function ml(){const{state:r}=$t(),t=Gs().pathname,a=r==="collapsed",[n,i]=u.useState(!1);u.useEffect(()=>{const o=()=>{const g=document.documentElement.classList.contains("dark");i(g)};o();const d=new MutationObserver(o);return d.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]}),()=>d.disconnect()},[]);const l=n?"/molaga-logo_dark.png":"/molaga-logo.png",m=o=>t===o||o!=="/"&&t.startsWith(o),c=({isActive:o})=>o?"bg-primary/10 text-primary font-medium border-r-2 border-primary":"hover:bg-muted/50 transition-colors";return e.jsx(hn,{className:a?"w-14":"w-64",collapsible:"icon",children:e.jsxs(xn,{className:"bg-sidebar",children:[e.jsx("div",{className:"h-16 border-b border-sidebar-border flex items-center justify-center px-4",children:a?e.jsxs("div",{className:"w-10 h-10 flex items-center justify-center",children:[e.jsx("img",{src:l,alt:"Molaga",className:"w-8 h-8 object-contain transition-opacity duration-200",onError:o=>{const d=o.target;d.style.display="none",d.nextElementSibling?.classList.remove("hidden")}}),e.jsx("div",{className:"w-8 h-8 rounded bg-gradient-to-br from-red-500 to-red-600 flex items-center justify-center text-white font-bold text-sm hidden",children:"M"})]}):e.jsxs("div",{className:"flex items-center justify-center w-full",children:[e.jsx("img",{src:l,alt:"Molaga ERP",className:"h-12 object-contain max-w-full transition-opacity duration-200",onError:o=>{const d=o.target;d.style.display="none",d.nextElementSibling?.classList.remove("hidden")}}),e.jsxs("div",{className:"hidden text-center",children:[e.jsx("h2",{className:"font-bold text-sidebar-foreground text-xl",children:"MOLAGA"}),e.jsx("p",{className:"text-sm text-sidebar-foreground/70",children:"Spice Manufacturing ERP"})]})]})}),e.jsxs(Qt,{children:[e.jsx(ka,{children:"Main Modules"}),e.jsx(Yt,{children:e.jsx(Wt,{children:cl.map(o=>e.jsx(Gt,{children:e.jsx(Jt,{asChild:!0,isActive:m(o.url),children:e.jsxs(ha,{to:o.url,end:o.url==="/",className:c,children:[e.jsx(o.icon,{className:"h-4 w-4"}),!a&&e.jsx("span",{children:o.title})]})})},o.title))})})]}),e.jsxs(Qt,{children:[e.jsx(ka,{children:"Management"}),e.jsx(Yt,{children:e.jsx(Wt,{children:dl.map(o=>e.jsx(Gt,{children:e.jsx(Jt,{asChild:!0,children:e.jsxs(ha,{to:o.url,className:c,children:[e.jsx(o.icon,{className:"h-4 w-4"}),!a&&e.jsx("span",{children:o.title})]})})},o.title))})})]}),e.jsx("div",{className:"mt-auto",children:e.jsx(Qt,{children:e.jsx(Yt,{children:e.jsx(Wt,{children:ul.map(o=>e.jsx(Gt,{children:e.jsx(Jt,{asChild:!0,children:e.jsxs(ha,{to:o.url,className:c,children:[e.jsx(o.icon,{className:"h-4 w-4"}),!a&&e.jsx("span",{children:o.title})]})})},o.title))})})})})]})})}const Ya="molaga_settings",js={company:{companyName:"Molaga Spices Pvt Ltd",legalName:"Molaga Spices Private Limited",registrationNumber:"",taxId:"",industryType:"Manufacturing",address:"",city:"",state:"",postalCode:"",country:"India",phone:"",email:"",website:"",fiscalYearStart:"04",currency:"INR",timezone:"Asia/Kolkata"},system:{language:"en",dateFormat:"DD/MM/YYYY",timeFormat:"24",firstDayOfWeek:"monday",decimalPlaces:"2",thousandSeparator:",",decimalSeparator:".",recordsPerPage:"50",theme:"light",sidebarCollapsed:!1,showTooltips:!0,enableAnimations:!0},security:{minPasswordLength:"8",requireUppercase:!0,requireLowercase:!0,requireNumbers:!0,requireSpecialChars:!0,passwordExpiry:"90",sessionTimeout:"30",maxSessions:"3",enable2FA:!1,loginAttempts:"5",lockoutDuration:"30"},notifications:{smtp:{host:"smtp.gmail.com",port:"587",username:"",password:"",fromEmail:"",fromName:"Molaga ERP",useTLS:!0},notifications:{lowStockAlerts:!0,taskCompletion:!0,backupStatus:!0,userLogin:!1,dataImportExport:!0}},backup:{autoBackup:!0,frequency:"daily",time:"00:00",retention:"30"}};class hl{settings;constructor(){this.settings=this.loadSettings()}loadSettings(){try{const s=localStorage.getItem(Ya);if(s){const t=JSON.parse(s);return{company:{...js.company,...t.company},system:{...js.system,...t.system},security:{...js.security,...t.security},notifications:{smtp:{...js.notifications.smtp,...t.notifications?.smtp},notifications:{...js.notifications.notifications,...t.notifications?.notifications}},backup:{...js.backup,...t.backup}}}}catch(s){console.error("Error loading settings:",s)}return js}saveSettings(){try{localStorage.setItem(Ya,JSON.stringify(this.settings))}catch(s){console.error("Error saving settings:",s)}}getAll(){return{...this.settings}}getCompany(){return{...this.settings.company}}updateCompany(s){return this.settings.company={...this.settings.company,...s},this.saveSettings(),this.getCompany()}getSystem(){return{...this.settings.system}}updateSystem(s){return this.settings.system={...this.settings.system,...s},this.saveSettings(),this.getSystem()}getSecurity(){return{...this.settings.security}}updateSecurity(s){return this.settings.security={...this.settings.security,...s},this.saveSettings(),this.getSecurity()}getNotifications(){return{...this.settings.notifications}}updateNotifications(s){return this.settings.notifications={smtp:{...this.settings.notifications.smtp,...s.smtp},notifications:{...this.settings.notifications.notifications,...s.notifications}},this.saveSettings(),this.getNotifications()}getBackup(){return{...this.settings.backup}}updateBackup(s){return this.settings.backup={...this.settings.backup,...s},this.saveSettings(),this.getBackup()}resetToDefaults(){return this.settings={...js},this.saveSettings(),this.getAll()}exportSettings(){return JSON.stringify(this.settings,null,2)}importSettings(s){try{const t=JSON.parse(s);return this.settings={company:{...js.company,...t.company},system:{...js.system,...t.system},security:{...js.security,...t.security},notifications:{smtp:{...js.notifications.smtp,...t.notifications?.smtp},notifications:{...js.notifications.notifications,...t.notifications?.notifications}},backup:{...js.backup,...t.backup}},this.saveSettings(),!0}catch(t){return console.error("Error importing settings:",t),!1}}}const ea=new hl;function gn(){const[r,s]=u.useState(ea.getCompany()),t=u.useCallback(a=>{const n=ea.updateCompany(a);return s(n),n},[]);return{settings:r,updateSettings:t}}function fn(){const[r,s]=u.useState(ea.getSystem()),t=u.useCallback(a=>{const n=ea.updateSystem(a);return s(n),n},[]);return{settings:r,updateSettings:t}}const sa=zn,ta=Qn,pl=u.forwardRef(({className:r,inset:s,children:t,...a},n)=>e.jsxs(xr,{ref:n,className:re("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[state=open]:bg-accent focus:bg-accent",s&&"pl-8",r),...a,children:[t,e.jsx(Or,{className:"ml-auto h-4 w-4"})]}));pl.displayName=xr.displayName;const xl=u.forwardRef(({className:r,...s},t)=>e.jsx(gr,{ref:t,className:re("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...s}));xl.displayName=gr.displayName;const Ft=u.forwardRef(({className:r,sideOffset:s=4,...t},a)=>e.jsx(Hn,{children:e.jsx(fr,{ref:a,sideOffset:s,className:re("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...t})}));Ft.displayName=fr.displayName;const jt=u.forwardRef(({className:r,inset:s,...t},a)=>e.jsx(jr,{ref:a,className:re("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",s&&"pl-8",r),...t}));jt.displayName=jr.displayName;const gl=u.forwardRef(({className:r,children:s,checked:t,...a},n)=>e.jsxs(yr,{ref:n,className:re("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",r),checked:t,...a,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(vr,{children:e.jsx(Kr,{className:"h-4 w-4"})})}),s]}));gl.displayName=yr.displayName;const fl=u.forwardRef(({className:r,children:s,...t},a)=>e.jsxs(br,{ref:a,className:re("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",r),...t,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(vr,{children:e.jsx(vi,{className:"h-2 w-2 fill-current"})})}),s]}));fl.displayName=br.displayName;const jn=u.forwardRef(({className:r,inset:s,...t},a)=>e.jsx(Nr,{ref:a,className:re("px-2 py-1.5 text-sm font-semibold",s&&"pl-8",r),...t}));jn.displayName=Nr.displayName;const yn=u.forwardRef(({className:r,...s},t)=>e.jsx(wr,{ref:t,className:re("-mx-1 my-1 h-px bg-muted",r),...s}));yn.displayName=wr.displayName;function Fe({children:r}){const{user:s,logout:t}=os(),{toast:a}=Ee(),{settings:n}=gn(),{settings:i}=fn();u.useEffect(()=>{const m=window.document.documentElement;if(m.classList.remove("light","dark"),i.theme==="auto"){const c=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";m.classList.add(c)}else m.classList.add(i.theme)},[i.theme]);const l=async()=>{try{await t(),a({title:"Success",description:"Logged out successfully"})}catch{a({title:"Error",description:"Failed to logout",variant:"destructive"})}};return e.jsx(mn,{children:e.jsxs("div",{className:"min-h-screen flex w-full bg-background",children:[e.jsx(ml,{}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("header",{className:"h-16 border-b border-border bg-card/50 backdrop-blur-sm sticky top-0 z-50",children:e.jsxs("div",{className:"flex items-center justify-between px-4 sm:px-6 h-full",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[e.jsx(pn,{className:"hover:bg-primary/10 p-2"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"font-semibold text-foreground text-sm sm:text-base",children:"Molaga ERP"})})]}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[n.companyName&&e.jsxs("div",{className:"hidden sm:flex items-center gap-2 px-3 py-1.5 rounded-md bg-primary/5 border border-primary/10",children:[e.jsx(Vr,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:n.companyName})]}),e.jsx(A,{variant:"ghost",size:"icon",className:"hover:bg-primary/10 h-8 w-8 sm:h-10 sm:w-10",children:e.jsx(Br,{className:"h-4 w-4"})}),e.jsxs(sa,{children:[e.jsx(ta,{asChild:!0,children:e.jsx(A,{variant:"ghost",size:"icon",className:"hover:bg-primary/10 h-8 w-8 sm:h-10 sm:w-10",children:e.jsx(bi,{className:"h-4 w-4"})})}),e.jsxs(Ft,{align:"end",className:"w-56",children:[e.jsx(jn,{children:e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("p",{className:"text-sm font-medium leading-none",children:s?.name}),e.jsx("p",{className:"text-xs leading-none text-muted-foreground",children:s?.email})]})}),e.jsx(yn,{}),e.jsxs(jt,{onClick:l,className:"text-red-600 focus:text-red-600",children:[e.jsx(Ni,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Log out"})]})]})]})]})]})}),e.jsx("main",{className:"flex-1 p-4 sm:p-6 bg-gradient-to-br from-background to-muted/20",children:r})]})]})})}const Ie=({children:r})=>{const{user:s,loading:t}=os(),a=Gs();return t?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Re,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading..."})]})}):s?e.jsx(e.Fragment,{children:r}):e.jsx(wt,{to:"/login",state:{from:a},replace:!0})},jl=nt("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),P=u.forwardRef(({className:r,...s},t)=>e.jsx(Sr,{ref:t,className:re(jl(),r),...s}));P.displayName=Sr.displayName;const J=u.forwardRef(({className:r,...s},t)=>e.jsx("div",{ref:t,className:re("rounded-lg border bg-card text-card-foreground shadow-sm",r),...s}));J.displayName="Card";const le=u.forwardRef(({className:r,...s},t)=>e.jsx("div",{ref:t,className:re("flex flex-col space-y-1.5 p-6",r),...s}));le.displayName="CardHeader";const ce=u.forwardRef(({className:r,...s},t)=>e.jsx("h3",{ref:t,className:re("text-2xl font-semibold leading-none tracking-tight",r),...s}));ce.displayName="CardTitle";const ve=u.forwardRef(({className:r,...s},t)=>e.jsx("p",{ref:t,className:re("text-sm text-muted-foreground",r),...s}));ve.displayName="CardDescription";const Z=u.forwardRef(({className:r,...s},t)=>e.jsx("div",{ref:t,className:re("p-6 pt-0",r),...s}));Z.displayName="CardContent";const Rs=u.forwardRef(({className:r,...s},t)=>e.jsx("div",{ref:t,className:re("flex items-center p-6 pt-0",r),...s}));Rs.displayName="CardFooter";const yl=()=>{const[r,s]=u.useState(""),[t,a]=u.useState(""),[n,i]=u.useState(!1),[l,m]=u.useState(!1),{login:c,loginWithGoogle:o}=os(),d=Fa(),{toast:g}=Ee(),b=async T=>{T.preventDefault(),i(!0);try{await c(r,t),g({title:"Success",description:"Logged in successfully"}),d("/")}catch(L){g({title:"Error",description:L.message||"Failed to login",variant:"destructive"})}finally{i(!1)}},w=async()=>{m(!0);try{await o()}catch(T){g({title:"Error",description:T.message||"Failed to login with Google",variant:"destructive"}),m(!1)}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs(J,{className:"w-full max-w-md",children:[e.jsxs(le,{className:"space-y-1",children:[e.jsx(ce,{className:"text-2xl font-bold text-center",children:"MOLAGA ERP"}),e.jsx(ve,{className:"text-center",children:"Sign in to your account to continue"})]}),e.jsxs(Z,{children:[e.jsxs("form",{onSubmit:b,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"email",children:"Email"}),e.jsx(V,{id:"email",type:"email",placeholder:"Enter your email",value:r,onChange:T=>s(T.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"password",children:"Password"}),e.jsx(V,{id:"password",type:"password",placeholder:"Enter your password",value:t,onChange:T=>a(T.target.value),required:!0})]}),e.jsxs(A,{type:"submit",className:"w-full",disabled:n,children:[n&&e.jsx(Re,{className:"mr-2 h-4 w-4 animate-spin"}),"Sign In"]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx(da,{className:"w-full"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{className:"bg-background px-2 text-muted-foreground",children:"Or continue with"})})]}),e.jsxs(A,{type:"button",variant:"outline",className:"w-full mt-4",onClick:w,disabled:l,children:[l&&e.jsx(Re,{className:"mr-2 h-4 w-4 animate-spin"}),e.jsxs("svg",{className:"mr-2 h-4 w-4",viewBox:"0 0 24 24",children:[e.jsx("path",{fill:"currentColor",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),e.jsx("path",{fill:"currentColor",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),e.jsx("path",{fill:"currentColor",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),e.jsx("path",{fill:"currentColor",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Continue with Google"]})]}),e.jsxs("div",{className:"mt-4 text-center text-sm",children:["Don't have an account?"," ",e.jsx(ks,{to:"/register",className:"text-primary hover:underline",children:"Sign up"})]})]})]})})},vl=()=>{const[r,s]=u.useState(""),[t,a]=u.useState(""),[n,i]=u.useState(""),[l,m]=u.useState(""),[c,o]=u.useState(!1),[d,g]=u.useState(!1),{register:b,loginWithGoogle:w}=os(),T=Fa(),{toast:L}=Ee(),f=async E=>{if(E.preventDefault(),n!==l){L({title:"Error",description:"Passwords do not match",variant:"destructive"});return}if(n.length<8){L({title:"Error",description:"Password must be at least 8 characters long",variant:"destructive"});return}o(!0);try{await b(t,n,r),L({title:"Success",description:"Account created successfully"}),T("/")}catch(D){L({title:"Error",description:D.message||"Failed to create account",variant:"destructive"})}finally{o(!1)}},N=async()=>{g(!0);try{await w()}catch(E){L({title:"Error",description:E.message||"Failed to login with Google",variant:"destructive"}),g(!1)}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs(J,{className:"w-full max-w-md",children:[e.jsxs(le,{className:"space-y-1",children:[e.jsx(ce,{className:"text-2xl font-bold text-center",children:"MOLAGA ERP"}),e.jsx(ve,{className:"text-center",children:"Create your account to get started"})]}),e.jsxs(Z,{children:[e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"name",children:"Full Name"}),e.jsx(V,{id:"name",type:"text",placeholder:"Enter your full name",value:r,onChange:E=>s(E.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"email",children:"Email"}),e.jsx(V,{id:"email",type:"email",placeholder:"Enter your email",value:t,onChange:E=>a(E.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"password",children:"Password"}),e.jsx(V,{id:"password",type:"password",placeholder:"Enter your password (min 8 characters)",value:n,onChange:E=>i(E.target.value),required:!0,minLength:8})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"confirmPassword",children:"Confirm Password"}),e.jsx(V,{id:"confirmPassword",type:"password",placeholder:"Confirm your password",value:l,onChange:E=>m(E.target.value),required:!0})]}),e.jsxs(A,{type:"submit",className:"w-full",disabled:c,children:[c&&e.jsx(Re,{className:"mr-2 h-4 w-4 animate-spin"}),"Create Account"]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx(da,{className:"w-full"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{className:"bg-background px-2 text-muted-foreground",children:"Or continue with"})})]}),e.jsxs(A,{type:"button",variant:"outline",className:"w-full mt-4",onClick:N,disabled:d,children:[d&&e.jsx(Re,{className:"mr-2 h-4 w-4 animate-spin"}),e.jsxs("svg",{className:"mr-2 h-4 w-4",viewBox:"0 0 24 24",children:[e.jsx("path",{fill:"currentColor",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),e.jsx("path",{fill:"currentColor",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),e.jsx("path",{fill:"currentColor",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),e.jsx("path",{fill:"currentColor",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Continue with Google"]})]}),e.jsxs("div",{className:"mt-4 text-center text-sm",children:["Already have an account?"," ",e.jsx(ks,{to:"/login",className:"text-primary hover:underline",children:"Sign in"})]})]})]})})},bl=nt("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function qe({className:r,variant:s,...t}){return e.jsx("div",{className:re(bl({variant:s}),r),...t})}function Nl({title:r,value:s,change:t,changeType:a="neutral",icon:n,description:i}){const l={positive:"text-green-600 bg-green-50",negative:"text-red-600 bg-red-50",neutral:"text-muted-foreground bg-muted"}[a];return e.jsxs(J,{className:"hover:shadow-lg transition-all duration-300 border-l-4 border-l-primary",children:[e.jsxs(le,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(ce,{className:"text-xs sm:text-sm font-medium text-muted-foreground",children:r}),e.jsx(n,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"})]}),e.jsxs(Z,{children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-foreground",children:s}),t&&e.jsx(qe,{variant:"secondary",className:`text-xs mt-2 ${l}`,children:t}),i&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:i})]})]})}const Wa=[{id:1,name:"Procurement",icon:Nt,description:"Raw Materials",status:"active"},{id:2,name:"Pre-Production",icon:Ea,description:"Clean/Roast",status:"active"},{id:3,name:"Production",icon:Hr,description:"Grinding",status:"active"},{id:4,name:"Post-Production",icon:wi,description:"Packing",status:"pending"},{id:5,name:"Sales",icon:Si,description:"Customer",status:"pending"}];function wl(){return e.jsxs(J,{className:"col-span-full",children:[e.jsx(le,{children:e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(Hr,{className:"h-5 w-5 text-primary"}),"Production Flow Status"]})}),e.jsx(Z,{children:e.jsx("div",{className:"flex items-center justify-between overflow-x-auto pb-4",children:Wa.map((r,s)=>e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"flex flex-col items-center min-w-0 flex-shrink-0",children:[e.jsx("div",{className:`
                  w-16 h-16 rounded-full border-2 flex items-center justify-center mb-2
                  ${r.status==="active"?"bg-primary/10 border-primary text-primary":"bg-muted border-muted-foreground/30 text-muted-foreground"}
                `,children:e.jsx(r.icon,{className:"h-6 w-6"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-medium text-sm",children:r.name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:r.description})]})]}),s<Wa.length-1&&e.jsx(Es,{className:"h-5 w-5 text-muted-foreground mx-6 flex-shrink-0"})]},r.id))})})]})}const ke=r=>({async getAll(s=[]){let t=[],a=0;const n=100;let i=!0;for(;i;)try{const l=await Me.listDocuments(Ue,r,[...s,Ae.limit(n),Ae.offset(a)]);if(t.push(...l.documents),a+=n,i=l.documents.length===n,a>1e4){ps.warn(`âš ï¸ Pagination safety limit reached for ${r}, stopping at 10000 records`);break}}catch(l){throw ps.error(`Error fetching documents from ${r}:`,l),l}return ps.log(`ðŸ“¦ Fetched ${t.length} documents from ${r}`),t},async getPaginated(s=[],t={}){const a=t.limit||100,n=t.offset||0;try{const i=await Me.listDocuments(Ue,r,[...s,Ae.limit(a),Ae.offset(n)]);return{documents:i.documents,total:i.total,hasMore:n+a<i.total}}catch(i){throw ps.error(`Error fetching paginated documents from ${r}:`,i),i}},async getById(s){return await Me.getDocument(Ue,r,s)},async create(s){return await Me.createDocument(Ue,r,rt.unique(),s)},async update(s,t){return await Me.updateDocument(Ue,r,s,t)},async delete(s){await Me.deleteDocument(Ue,r,s)}});({...ke(ge.PRODUCTION_STATUS)});const Sl={...ke(ge.POST_PRODUCTION_STATUS),async getWithRelations(){const r=await this.getAll(),s=ke(ge.PRODUCTS),t=ke(ge.PROCESSES),a=await s.getAll(),n=await t.getAll(),i=new Map(a.map(m=>[m.$id,m.name])),l=new Map(n.map(m=>[m.$id,m.process_name]));return r.map(m=>({...m,product_name:i.get(m.product_id)||"Unknown",process_name:l.get(m.process_id)||"Unknown"}))}};({...ke(ge.INVENTORY_STATUS)});const vn={...ke(ge.STOCK_STATUS),async getStockStatusByDateRange(r,s){const t=[];return r&&t.push(Ae.greaterThanEqual("status_date",r)),s&&t.push(Ae.lessThanEqual("status_date",s)),await this.getAll(t)}},Ys={...ke(ge.PRODUCTION_TASKS),async getByDateRange(r,s){const t=[];return r&&t.push(Ae.greaterThanEqual("date",r.toISOString())),s&&t.push(Ae.lessThanEqual("date",s.toISOString())),this.getAll(t)},async getProductionTasksWithRelations(r,s,t){const a=[];r&&a.push(Ae.greaterThanEqual("date",r)),s&&a.push(Ae.lessThanEqual("date",s)),t&&a.push(Ae.equal("process_id",t));const n=await this.getAll(a),i=ke(ge.STAFF),l=ke(ge.PROCESSES),m=ke(ge.RAW_PRODUCTS),c=ke(ge.STOCKS),o=await i.getAll(),d=await l.getAll(),g=await m.getAll(),b=await c.getAll(),w=await Dt.getAll(),T=new Map(o.map(E=>[E.$id,E.staff_name])),L=new Map(d.map(E=>[E.$id,E.process_name])),f=new Map(g.map(E=>[E.$id,E.raw_product])),N=new Map(b.map(E=>[E.$id,E.stock_name]));return n.map(E=>{const k=w.filter($=>$.production_task_id===E.$id).map($=>({...$,stock_name:N.get($.stock_id)||"Unknown"}));return{...E,staff_name:T.get(E.staff_id)||"Unknown",process_name:L.get(E.process_id)||"Unknown",source_process_name:L.get(E.source_process_id)||"Unknown",raw_product_name:f.get(E.raw_product_id)||"Unknown",stock_items:k}})}},at={...ke(ge.POST_PRODUCTION_TASKS),async getPostProductionTasksWithRelations(){const r=await this.getAll(),s=ke(ge.STAFF),t=ke(ge.PROCESSES),a=ke(ge.PRODUCTS),n=ke(ge.STOCKS),i=await s.getAll(),l=await t.getAll(),m=await a.getAll(),c=await n.getAll(),o=new Map(i.map(w=>[w.$id,w.staff_name])),d=new Map(l.map(w=>[w.$id,w.process_name])),g=new Map(m.map(w=>[w.$id,w.product])),b=new Map(c.map(w=>[w.$id,w.stock_name]));return r.map(w=>({...w,staff_name:o.get(w.staff_id)||"Unknown",process_name:d.get(w.process_id)||"Unknown",source_process_name:d.get(w.source_process_id)||"Unknown",product_name:g.get(w.product_id)||"Unknown",stock_name:b.get(w.sku)||"Unknown"}))}},Fs={...ke(ge.STOCKS),async getCategories(){const r=await this.getAll(),s=new Set(r.map(t=>t.category));return Array.from(s)}},pt=ke(ge.RAW_PRODUCTS),Pt=ke(ge.VENDORS),_l=ke(ge.STAFF),lt=ke(ge.PROCESSES),Is=ke(ge.PRODUCTS),Tt=ke(ge.SALES_CHANNELS),zs={...ke(ge.PURCHASES),async getByDateRange(r,s){const t=[];if(r){const a=new Date(r),n=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`;t.push(Ae.greaterThanEqual("date",n))}if(s){const a=new Date(s),n=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`;t.push(Ae.lessThanEqual("date",n))}return this.getAll(t)}},kl=ke(ge.SALES_ORDERS),Qs=ke(ge.SALES_UNITS),tt=ke(ge.SALES_RECORDS);({...ke(ge.PRE_PRODUCTION_STATUS)});const Dt={...ke(ge.PRODUCTION_TASK_ITEMS),async deleteByProductionTaskId(r){const s=await this.getAll([Ae.equal("production_task_id",r)]);await Promise.all(s.map(t=>this.delete(t.$id)))}},Ws={...ke(ge.PRE_PRODUCTION_TASKS),async getByDateRange(r,s){const t=[];if(r){const a=new Date(r),n=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`;t.push(Ae.greaterThanEqual("date_assigned",n))}if(s){const a=new Date(s),n=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`;t.push(Ae.lessThanEqual("date_assigned",n))}return this.getAll(t)},async getPreProductionTasksWithRelations(){const r=await this.getAll(),s=ke(ge.STAFF),t=ke(ge.PROCESSES),a=ke(ge.STOCKS),n=await s.getAll(),i=await t.getAll(),l=await a.getAll(),m=new Map(n.map(d=>[d.$id,d.staff_name])),c=new Map(i.map(d=>[d.$id,d.process_name])),o=new Map(l.map(d=>[d.$id,d.stock_name]));return r.map(d=>({...d,staff_name:m.get(d.staff_id)||"Unknown",process_name:c.get(d.process_id)||"Unknown",stock_name:o.get(d.stock_id)||"Unknown"}))}},Cl=()=>{const{data:r=[],isLoading:s}=he({queryKey:["dashboard","stock-status"],queryFn:()=>vn.getStockStatusByDateRange(),staleTime:6e4}),{data:t=[],isLoading:a}=he({queryKey:["dashboard","sales-orders"],queryFn:async()=>{const{documents:f}=await kl.list();return f},staleTime:6e4}),{data:n=[],isLoading:i}=he({queryKey:["dashboard","recent-purchases"],queryFn:async()=>{const{documents:f}=await zs.list();return f.sort((N,E)=>new Date(E.$createdAt||E.date).getTime()-new Date(N.$createdAt||N.date).getTime()).slice(0,5)},staleTime:6e4}),{data:l=[],isLoading:m}=he({queryKey:["dashboard","recent-prepro-tasks"],queryFn:async()=>{const{documents:f}=await Ws.list();return f.sort((N,E)=>new Date(E.$createdAt||E.date_assigned).getTime()-new Date(N.$createdAt||N.date_assigned).getTime()).slice(0,5)},staleTime:6e4}),c=(r||[]).reduce((f,N)=>f+(N.closing_bal||0),0),o=(t||[]).filter(f=>f.status!=="delivered"&&f.status!=="cancelled").length,d=(l||[]).reduce((f,N)=>f+(N.assigned_quantity||0),0),g=(l||[]).reduce((f,N)=>f+((N.assigned_quantity||0)-(N.wastage_quantity||0)),0),b=d>0?g/d*100:0,w=(r||[]).filter(f=>(f.closing_bal||0)<=(f.min_level||0)).map(f=>({name:f.stock_name,current:`${f.closing_bal||0} kg`,minimum:`${f.min_level||0} kg`,severity:(f.closing_bal||0)===0?"critical":"warning"})).slice(0,5),T=[...(n||[]).map(f=>({id:f.$id||`purchase-${f.date}`,action:"New purchase",item:`${f.stock_id} - ${f.quantity} units @ ${f.rate}`,time:Oa(new Date(f.date||f.$createdAt),{addSuffix:!0}),status:"success"})),...(l||[]).map(f=>({id:f.$id||`task-${f.date_assigned}`,action:`${f.status==="completed"?"Task completed":f.status==="in_progress"?"Task in progress":"Task created"}`,item:`${f.process_id} - ${f.assigned_quantity} units (${f.stock_id})`,time:Oa(new Date(f.date_completed||f.date_assigned||f.$createdAt),{addSuffix:!0}),status:f.status==="completed"?"success":"error"}))].sort((f,N)=>f.time>N.time?-1:1).slice(0,5),L=[{title:"Total Raw Stock",value:`${c.toLocaleString()} kg`,changeType:"neutral",icon:Nt,description:"Sum of closing balances across stocks"},{title:"Active Orders",value:o,changeType:"neutral",icon:Ta,description:"Not delivered or cancelled"},{title:"Production Efficiency",value:`${b.toFixed(1)}%`,changeType:b>=90?"positive":"negative",icon:It,description:"Effective completed vs assigned (recent)"},{title:"Low Stock Alerts",value:w.length,changeType:w.length>0?"negative":"neutral",icon:vs,description:"Closing balance below minimum"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Dashboard"}),e.jsx("p",{className:"text-muted-foreground",children:"Welcome to Molaga ERP - Your complete spice manufacturing solution"})]}),e.jsx("div",{className:"grid gap-3 sm:gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-4",children:L.map((f,N)=>e.jsx(Nl,{...f},N))}),e.jsx(wl,{}),e.jsxs("div",{className:"grid gap-4 sm:gap-6 grid-cols-1 lg:grid-cols-2",children:[e.jsxs(J,{children:[e.jsx(le,{children:e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(va,{className:"h-5 w-5 text-primary"}),"Recent Activities"]})}),e.jsx(Z,{children:e.jsxs("div",{className:"space-y-4",children:[T.map(f=>e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg hover:bg-muted/50 transition-colors",children:[e.jsx("div",{className:`mt-0.5 ${f.status==="success"?"text-green-600":"text-red-600"}`,children:f.status==="success"?e.jsx(Ms,{className:"h-4 w-4"}):e.jsx(ba,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:f.action}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:f.item}),e.jsx("p",{className:"text-xs text-muted-foreground",children:f.time})]})]},f.id)),(s||a||i||m)&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading real data..."}),!T.length&&!(s||a||i||m)&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"No recent activities found."})]})})]}),e.jsxs(J,{children:[e.jsx(le,{children:e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(vs,{className:"h-5 w-5 text-destructive"}),"Low Stock Alerts"]})}),e.jsx(Z,{children:e.jsxs("div",{className:"space-y-3",children:[w.map((f,N)=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-border",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm text-foreground",children:f.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Current: ",f.current," | Min: ",f.minimum]})]}),e.jsx(qe,{variant:f.severity==="critical"?"destructive":"secondary",className:f.severity==="critical"?"bg-red-100 text-red-800":f.severity==="warning"?"bg-yellow-100 text-yellow-800":"bg-orange-100 text-orange-800",children:f.severity})]},N)),!w.length&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"No low stock alerts."})]})})]})]})]})},yt=u.forwardRef(({className:r,value:s,...t},a)=>e.jsx(_r,{ref:a,className:re("relative h-4 w-full overflow-hidden rounded-full bg-secondary",r),...t,children:e.jsx(Yn,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(s||0)}%)`}})}));yt.displayName=_r.displayName;class fa{static CHUNK_SIZE=1e3;static MAX_MEMORY_RECORDS=1e4;static async exportToCSV(s,t){try{t?.({current:0,total:s.data.length,percentage:0,status:"preparing",message:"Preparing CSV export..."});const a=this.formatDataForExport(s.data,s.headers);t?.({current:s.data.length*.5,total:s.data.length,percentage:50,status:"processing",message:"Processing data..."});let n=a;s.metadata&&(n=[...this.createMetadataRows(s.metadata),[],s.headers,...a.slice(1)]),t?.({current:s.data.length*.8,total:s.data.length,percentage:80,status:"generating",message:"Generating CSV file..."});const i=kt.unparse(n,{header:!1,skipEmptyLines:!1});t?.({current:s.data.length,total:s.data.length,percentage:95,status:"downloading",message:"Downloading file..."});const l=new Blob([i],{type:"text/csv;charset=utf-8;"}),m=this.generateFilename(s.filename,"csv");Ct.saveAs(l,m),t?.({current:s.data.length,total:s.data.length,percentage:100,status:"complete",message:"Export completed successfully"})}catch(a){throw t?.({current:0,total:s.data.length,percentage:0,status:"error",message:`Export failed: ${a instanceof Error?a.message:"Unknown error"}`}),a}}static async exportToXLSX(s,t){try{t?.({current:0,total:s.data.length,percentage:0,status:"preparing",message:"Preparing Excel export..."});const a=_s.book_new(),n=this.formatDataForExport(s.data,s.headers);t?.({current:s.data.length*.3,total:s.data.length,percentage:30,status:"processing",message:"Processing data..."});const i=_s.aoa_to_sheet(n);if(this.applyExcelFormatting(i,s.headers.length,n.length),_s.book_append_sheet(a,i,"Data"),t?.({current:s.data.length*.6,total:s.data.length,percentage:60,status:"processing",message:"Creating worksheets..."}),s.metadata){const o=this.createMetadataSheet(s.metadata);_s.book_append_sheet(a,o,"Export Info")}t?.({current:s.data.length*.8,total:s.data.length,percentage:80,status:"generating",message:"Generating Excel file..."});const l=Ha(a,{bookType:"xlsx",type:"array",compression:!0});t?.({current:s.data.length,total:s.data.length,percentage:95,status:"downloading",message:"Downloading file..."});const m=new Blob([l],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),c=this.generateFilename(s.filename,"xlsx");Ct.saveAs(m,c),t?.({current:s.data.length,total:s.data.length,percentage:100,status:"complete",message:"Export completed successfully"})}catch(a){throw t?.({current:0,total:s.data.length,percentage:0,status:"error",message:`Export failed: ${a instanceof Error?a.message:"Unknown error"}`}),a}}static async exportLargeDataset(s,t){if(s.data.length<=this.MAX_MEMORY_RECORDS)return s.format==="csv"?this.exportToCSV(s,t):this.exportToXLSX(s,t);try{t?.({current:0,total:s.data.length,percentage:0,status:"preparing",message:"Preparing large dataset export..."});const a=this.chunkArray(s.data,this.CHUNK_SIZE);let n=0;s.format==="csv"?await this.exportLargeCSV(s,a,t):await this.exportLargeXLSX(s,a,t)}catch(a){throw t?.({current:0,total:s.data.length,percentage:0,status:"error",message:`Large export failed: ${a instanceof Error?a.message:"Unknown error"}`}),a}}static formatDataForExport(s,t){if(s.length===0)return[t];const a=[t];return s.forEach(n=>{const i=t.map(l=>{const m=n[l]||n[this.camelToSnake(l)]||"";return this.formatCellValue(m)});a.push(i)}),a}static formatCellValue(s){return s==null?"":typeof s=="boolean"?s?"Yes":"No":s instanceof Date?s.toLocaleDateString("en-GB"):typeof s=="number"?s%1===0?s.toString():s.toFixed(2):typeof s=="object"?JSON.stringify(s):String(s)}static generateFilename(s,t){const a=new Date().toISOString().slice(0,19).replace(/[:.]/g,"-");return`${s}_${a}.${t}`}static createMetadataRows(s){return[["Export Information"],["Exported At:",s.exportedAt.toLocaleString()],["Exported By:",s.exportedBy],["Page Source:",s.pageSource],["Record Count:",s.recordCount.toString()],["Version:",s.version],...s.filters?[["Filters:",JSON.stringify(s.filters)]]:[]]}static createMetadataSheet(s){const t=[["Export Information",""],["Exported At",s.exportedAt.toLocaleString()],["Exported By",s.exportedBy],["Page Source",s.pageSource],["Record Count",s.recordCount],["Version",s.version],...s.filters?[["Filters",JSON.stringify(s.filters)]]:[]];return _s.aoa_to_sheet(t)}static applyExcelFormatting(s,t,a){const n=_s.encode_range({s:{c:0,r:0},e:{c:t-1,r:a-1}});s["!ref"]=n;const i=Array(t).fill({wch:15});s["!cols"]=i;for(let l=0;l<t;l++){const m=_s.encode_cell({r:0,c:l});s[m]&&(s[m].s={font:{bold:!0},fill:{fgColor:{rgb:"E2E8F0"}}})}}static async exportLargeCSV(s,t,a){let n="",i=0;if(n+=kt.unparse([s.headers],{header:!1})+`
`,s.metadata){const c=this.createMetadataRows(s.metadata);n=kt.unparse(c,{header:!1})+`

`+n}for(let c=0;c<t.length;c++){const o=t[c],d=this.formatDataForExport(o,s.headers).slice(1);n+=kt.unparse(d,{header:!1}),c<t.length-1&&(n+=`
`),i+=o.length,a?.({current:i,total:s.data.length,percentage:Math.round(i/s.data.length*80),status:"processing",message:`Processing chunk ${c+1} of ${t.length}...`}),await new Promise(g=>setTimeout(g,10))}const l=new Blob([n],{type:"text/csv;charset=utf-8;"}),m=this.generateFilename(s.filename,"csv");Ct.saveAs(l,m)}static async exportLargeXLSX(s,t,a){const n=_s.book_new();let i=[s.headers],l=0;for(let g=0;g<t.length;g++){const b=t[g],w=this.formatDataForExport(b,s.headers).slice(1);i.push(...w),l+=b.length,a?.({current:l,total:s.data.length,percentage:Math.round(l/s.data.length*70),status:"processing",message:`Processing chunk ${g+1} of ${t.length}...`}),await new Promise(T=>setTimeout(T,10))}const m=_s.aoa_to_sheet(i);if(this.applyExcelFormatting(m,s.headers.length,i.length),_s.book_append_sheet(n,m,"Data"),s.metadata){const g=this.createMetadataSheet(s.metadata);_s.book_append_sheet(n,g,"Export Info")}const c=Ha(n,{bookType:"xlsx",type:"array",compression:!0}),o=new Blob([c],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),d=this.generateFilename(s.filename,"xlsx");Ct.saveAs(o,d)}static chunkArray(s,t){const a=[];for(let n=0;n<s.length;n+=t)a.push(s.slice(n,n+t));return a}static camelToSnake(s){return s.replace(/[A-Z]/g,t=>`_${t.toLowerCase()}`)}}const xs=({data:r,headers:s,filename:t,className:a,disabled:n=!1,includeMetadata:i=!0,metadata:l,onExportStart:m,onExportComplete:c,variant:o="outline",size:d="default"})=>{const[g,b]=u.useState(!1),[w,T]=u.useState(null),[L,f]=u.useState(null),N=async $=>{if(!(g||n))try{b(!0),f($),T(null),m?.();const H=i?{exportedAt:new Date,exportedBy:"Current User",pageSource:t,recordCount:r.length,version:"1.0.0",...l}:void 0,_={filename:t,headers:s,data:r,format:$,metadata:H};T({current:0,total:r.length,percentage:0,status:"preparing",message:`Preparing ${$.toUpperCase()} export...`}),r.length>1e4?await fa.exportLargeDataset(_,T):$==="csv"?await fa.exportToCSV(_,T):await fa.exportToXLSX(_,T),Et.success(`Successfully exported ${r.length} records to ${$.toUpperCase()}`,{description:`File: ${t}_${new Date().toISOString().slice(0,19).replace(/[:.]/g,"-")}.${$}`}),c?.(!0)}catch(H){console.error("Export failed:",H),Et.error("Export failed",{description:H instanceof Error?H.message:"An unexpected error occurred"}),c?.(!1)}finally{b(!1),f(null),T(null)}},E=()=>g&&L?`Exporting ${L.toUpperCase()}...`:"Export",D=()=>g?e.jsx(Re,{className:"h-4 w-4 animate-spin"}):e.jsx(it,{className:"h-4 w-4"}),k=!r||r.length===0;return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(sa,{children:[e.jsx(ta,{asChild:!0,children:e.jsxs(A,{variant:o,size:d,className:a,disabled:n||g||k,children:[D(),E()]})}),e.jsxs(Ft,{align:"end",children:[e.jsxs(jt,{onClick:()=>N("csv"),disabled:g||k,className:"cursor-pointer",children:[e.jsx(ft,{className:"h-4 w-4 mr-2"}),"Export as CSV"]}),e.jsxs(jt,{onClick:()=>N("xlsx"),disabled:g||k,className:"cursor-pointer",children:[e.jsx(zr,{className:"h-4 w-4 mr-2"}),"Export as Excel"]})]})]}),g&&w&&e.jsxs("div",{className:"space-y-2 min-w-[200px]",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:w.message||"Processing..."}),e.jsxs("span",{className:"text-muted-foreground",children:[w.percentage,"%"]})]}),e.jsx(yt,{value:w.percentage,className:"h-2"}),w.currentBatch&&w.totalBatches&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Batch ",w.currentBatch," of ",w.totalBatches]})]}),k&&e.jsx("div",{className:"text-xs text-muted-foreground",children:"No data available to export"})]})},Qe=hr,ct=Wn,Pl=pr,bn=u.forwardRef(({className:r,...s},t)=>e.jsx(aa,{ref:t,className:re("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r),...s}));bn.displayName=aa.displayName;const Ve=u.forwardRef(({className:r,children:s,...t},a)=>e.jsxs(Pl,{children:[e.jsx(bn,{}),e.jsxs(ra,{ref:a,className:re("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",r),...t,children:[s,e.jsxs(mr,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-accent data-[state=open]:text-muted-foreground hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[e.jsx(gt,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Ve.displayName=ra.displayName;const Be=({className:r,...s})=>e.jsx("div",{className:re("flex flex-col space-y-1.5 text-center sm:text-left",r),...s});Be.displayName="DialogHeader";const He=({className:r,...s})=>e.jsx("div",{className:re("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",r),...s});He.displayName="DialogFooter";const ze=u.forwardRef(({className:r,...s},t)=>e.jsx(na,{ref:t,className:re("text-lg font-semibold leading-none tracking-tight",r),...s}));ze.displayName=na.displayName;const Ye=u.forwardRef(({className:r,...s},t)=>e.jsx(ia,{ref:t,className:re("text-sm text-muted-foreground",r),...s}));Ye.displayName=ia.displayName;class ja{static DEFAULT_BATCH_SIZE=100;static MAX_FILE_SIZE_MB=50;static SUPPORTED_FORMATS=[".csv",".xlsx",".xls"];static async parseFile(s,t){try{this.validateFile(s),t?.({current:0,total:100,percentage:0,status:"parsing",message:"Starting file parsing..."});const a=this.getFileExtension(s.name);let n=[];if(a===".csv")n=await this.parseCSVFile(s,t);else if(a===".xlsx"||a===".xls")n=await this.parseExcelFile(s,t);else throw new Error(`Unsupported file format: ${a}`);return t?.({current:100,total:100,percentage:100,status:"complete",message:`Successfully parsed ${n.length} rows`}),n}catch(a){throw t?.({current:0,total:100,percentage:0,status:"error",message:`Parsing failed: ${a instanceof Error?a.message:"Unknown error"}`}),a}}static validateData(s,t,a){const n={isValid:!0,errors:[],warnings:[],validData:[],invalidData:[]};if(s.length===0)return n.isValid=!1,n.errors.push({row:0,column:"file",message:"File contains no data rows",value:null,severity:"error"}),n;a?.({current:0,total:s.length,percentage:0,status:"validating",message:"Starting data validation..."});const i=Object.keys(s[0]),l=this.validateHeaders(i,t);return l.isValid||(n.errors.push(...l.errors),n.isValid=!1),s.forEach((m,c)=>{const o=c+1,d=this.validateRow(m,t.validationRules,o,s);d.errors.length>0?(n.errors.push(...d.errors),n.invalidData.push({...m,_rowNumber:o})):n.validData.push({...m,_rowNumber:o}),d.warnings.length>0&&n.warnings.push(...d.warnings),(c%100===0||c===s.length-1)&&a?.({current:c+1,total:s.length,percentage:Math.round((c+1)/s.length*100),status:"validating",message:`Validating row ${c+1} of ${s.length}...`})}),n.isValid=n.errors.length===0,a?.({current:s.length,total:s.length,percentage:100,status:"complete",message:`Validation complete. ${n.validData.length} valid rows, ${n.invalidData.length} invalid rows`}),n}static async processImport(s,t,a){const n=t.batchSize||this.DEFAULT_BATCH_SIZE,i=this.createBatches(s,n),l={totalRows:s.length,successfulRows:0,failedRows:0,errors:[],warnings:[],processedData:[],skippedRows:0};a?.({current:0,total:s.length,percentage:0,status:"processing",message:"Starting import process...",currentBatch:0,totalBatches:i.length});try{for(let m=0;m<i.length;m++){const c=i[m],o=await this.processBatch(c,n,m+1);l.successfulRows+=o.processed,l.errors.push(...o.errors),l.warnings.push(...o.warnings),l.processedData.push(...o.data);const d=(m+1)*n,g=Math.min(d,s.length);a?.({current:g,total:s.length,percentage:Math.round(g/s.length*100),status:"processing",message:`Processing batch ${m+1} of ${i.length}...`,currentBatch:m+1,totalBatches:i.length}),await new Promise(b=>setTimeout(b,10))}return l.failedRows=l.totalRows-l.successfulRows,a?.({current:s.length,total:s.length,percentage:100,status:"complete",message:`Import complete. ${l.successfulRows} successful, ${l.failedRows} failed`}),t.onImportComplete(l),l}catch(m){throw a?.({current:0,total:s.length,percentage:0,status:"error",message:`Import failed: ${m instanceof Error?m.message:"Unknown error"}`}),m}}static async processBatch(s,t,a){const n={processed:0,errors:[],warnings:[],data:[]};try{return await new Promise(i=>setTimeout(i,50)),s.forEach((i,l)=>{try{const m=this.processRow(i);n.data.push(m),n.processed++}catch(m){n.errors.push({row:(a-1)*t+l+1,column:"processing",message:m instanceof Error?m.message:"Processing failed",value:i,severity:"error"})}}),n}catch(i){return s.forEach((l,m)=>{n.errors.push({row:(a-1)*t+m+1,column:"batch",message:`Batch processing failed: ${i instanceof Error?i.message:"Unknown error"}`,value:null,severity:"error"})}),n}}static validateFile(s){const t=this.MAX_FILE_SIZE_MB*1024*1024;if(s.size>t)throw new Error(`File size exceeds maximum allowed size of ${this.MAX_FILE_SIZE_MB}MB`);const a=this.getFileExtension(s.name);if(!this.SUPPORTED_FORMATS.includes(a))throw new Error(`Unsupported file format. Supported formats: ${this.SUPPORTED_FORMATS.join(", ")}`)}static async parseCSVFile(s,t){return new Promise((a,n)=>{kt.parse(s,{header:!0,skipEmptyLines:!0,transformHeader:i=>i.trim(),transform:i=>i.trim(),step:(i,l)=>{const m=Math.round((s.size-l.streamer._input.length)/s.size*80);t?.({current:m,total:100,percentage:m,status:"parsing",message:"Parsing CSV file..."})},complete:i=>{if(i.errors.length>0){const l=i.errors.map(m=>`Row ${m.row}: ${m.message}`).join("; ");n(new Error(`CSV parsing errors: ${l}`))}else a(i.data)},error:i=>{n(new Error(`CSV parsing failed: ${i.message}`))}})})}static async parseExcelFile(s,t){return new Promise((a,n)=>{const i=new FileReader;i.onload=l=>{try{t?.({current:50,total:100,percentage:50,status:"parsing",message:"Reading Excel file..."});const m=new Uint8Array(l.target?.result),c=Yi(m,{type:"array"}),o=c.SheetNames[0],d=c.Sheets[o];t?.({current:80,total:100,percentage:80,status:"parsing",message:"Converting Excel data..."});const g=_s.sheet_to_json(d,{header:1,defval:"",blankrows:!1});if(g.length===0){n(new Error("Excel file contains no data"));return}const b=g[0].map(T=>String(T).trim()),w=g.slice(1).map(T=>{const L={};return b.forEach((f,N)=>{L[f]=T[N]!==void 0?String(T[N]).trim():""}),L});a(w)}catch(m){n(new Error(`Excel parsing failed: ${m instanceof Error?m.message:"Unknown error"}`))}},i.onerror=()=>{n(new Error("Failed to read Excel file"))},i.readAsArrayBuffer(s)})}static validateHeaders(s,t){const a=[];t.requiredColumns.forEach(i=>{s.includes(i)||a.push({row:0,column:i,message:`Required column '${i}' is missing`,value:null,severity:"error"})});const n=[...t.requiredColumns,...t.optionalColumns];return s.forEach(i=>{n.includes(i)||a.push({row:0,column:i,message:`Unknown column '${i}' will be ignored`,value:null,severity:"warning"})}),{isValid:a.filter(i=>i.severity==="error").length===0,errors:a}}static validateRow(s,t,a,n){const i=[],l=[];return t.forEach(m=>{const c=s[m.field],o=this.applyValidationRule(c,m,s,n);if(o!==!0){const d=typeof o=="string"?o:m.message||`Validation failed for ${m.field}`;m.type==="required"||m.validator&&o===!1?i.push({row:a,column:m.field,message:d,value:c,severity:"error"}):l.push({row:a,column:m.field,message:d,value:c})}}),{errors:i,warnings:l}}static applyValidationRule(s,t,a,n){switch(t.type){case"required":return s!=null&&s!=="";case"format":return t.options?.pattern?t.options.pattern.test(String(s)):!0;case"range":const i=Number(s);return isNaN(i)?"Value must be a number":t.options?.min!==void 0&&i<t.options.min?`Value must be at least ${t.options.min}`:t.options?.max!==void 0&&i>t.options.max?`Value must be at most ${t.options.max}`:!0;case"unique":return n.filter(m=>m[t.field]===s).length<=1||`Duplicate value found: ${s}`;case"custom":return t.validator?t.validator(s,a,n):!0;default:return!0}}static processRow(s){const t={};return Object.keys(s).forEach(a=>{let n=s[a];if(a.startsWith("_")){t[a]=n;return}if(typeof n=="string"){if(n=n.trim(),n===""&&(n=null),n&&!isNaN(Number(n))&&!isNaN(parseFloat(n))){const i=parseFloat(n);(i.toString()===n||i.toFixed(2)===n)&&(n=i)}n==="true"||n==="True"||n==="TRUE"?n=!0:(n==="false"||n==="False"||n==="FALSE")&&(n=!1)}t[a]=n}),t}static createBatches(s,t){const a=[];for(let n=0;n<s.length;n+=t)a.push(s.slice(n,n+t));return a}static getFileExtension(s){return s.toLowerCase().substring(s.lastIndexOf("."))}}const gs=({config:r,className:s,disabled:t=!1,onImportComplete:a,onImportStart:n,variant:i="outline",size:l="default",acceptedFormats:m=[".csv",".xlsx",".xls"]})=>{const c=u.useRef(null),[o,d]=u.useState({isOpen:!1,step:"upload",file:null,parsedData:[],validationResult:null,importProgress:null,importResult:null,error:null}),g=()=>{d({isOpen:!1,step:"upload",file:null,parsedData:[],validationResult:null,importProgress:null,importResult:null,error:null})},b=()=>{const _=r.requiredColumns.concat(r.optionalColumns||[]),Q=_.map(y=>`Sample ${y}`),K=[_.join(","),Q.join(",")].join(`
`),S=new Blob([K],{type:"text/csv;charset=utf-8;"}),h=URL.createObjectURL(S),I=document.createElement("a");I.setAttribute("href",h),I.setAttribute("download","sample-import-template.csv"),I.style.visibility="hidden",document.body.appendChild(I),I.click(),document.body.removeChild(I),Et.success("Sample CSV downloaded",{description:"Fill in your data and import the file"})},w=async _=>{try{d(S=>({...S,file:_,error:null,step:"preview"}));const Q=await ja.parseFile(_,S=>{d(h=>({...h,importProgress:S}))}),K=ja.validateData(Q,r,S=>{d(h=>({...h,importProgress:S}))});d(S=>({...S,parsedData:Q,validationResult:K,importProgress:null}))}catch(Q){d(K=>({...K,error:Q instanceof Error?Q.message:"Failed to parse file",importProgress:null}))}},T=async()=>{if(o.validationResult?.validData.length)try{d(Q=>({...Q,step:"processing",error:null})),n?.();const _=await ja.processImport(o.validationResult.validData,r,Q=>{d(K=>({...K,importProgress:Q}))});d(Q=>({...Q,step:"complete",importResult:_,importProgress:null})),Et.success("Import completed successfully",{description:`${_.successfulRows} rows imported, ${_.failedRows} failed`}),a?.(_)}catch(_){d(Q=>({...Q,error:_ instanceof Error?_.message:"Import failed",importProgress:null})),Et.error("Import failed",{description:_ instanceof Error?_.message:"An unexpected error occurred"})}},L=_=>{_.preventDefault(),_.stopPropagation()},f=_=>{_.preventDefault(),_.stopPropagation();const K=Array.from(_.dataTransfer.files)[0];K&&w(K)},N=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs(A,{variant:"outline",size:"sm",onClick:_=>{_.stopPropagation(),b()},className:"gap-2",children:[e.jsx(ft,{className:"h-4 w-4"}),"Download Sample CSV"]})}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-gray-400 transition-colors cursor-pointer",onDragOver:L,onDrop:f,onClick:()=>c.current?.click(),children:[e.jsx(Xt,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"Drop your file here or click to browse"}),e.jsxs("p",{className:"text-sm text-gray-500 mb-4",children:["Supported formats: ",m.join(", ")]}),e.jsx(A,{variant:"outline",children:"Choose File"})]}),e.jsx("input",{ref:c,type:"file",accept:m.join(","),onChange:_=>{const Q=_.target.files?.[0];Q&&w(Q)},className:"hidden"}),o.importProgress&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:o.importProgress.message}),e.jsxs("span",{children:[o.importProgress.percentage,"%"]})]}),e.jsx(yt,{value:o.importProgress.percentage})]}),o.error&&e.jsxs(Oe,{variant:"destructive",children:[e.jsx(ua,{className:"h-4 w-4"}),e.jsx(Ke,{children:o.error})]})]}),E=()=>{if(!o.validationResult)return null;const{validData:_,invalidData:Q,errors:K,warnings:S}=o.validationResult;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Import Preview"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(qe,{variant:"outline",className:"text-green-600",children:[e.jsx(Ka,{className:"h-3 w-3 mr-1"}),_.length," Valid"]}),Q.length>0&&e.jsxs(qe,{variant:"outline",className:"text-red-600",children:[e.jsx(ua,{className:"h-3 w-3 mr-1"}),Q.length," Invalid"]}),S.length>0&&e.jsxs(qe,{variant:"outline",className:"text-yellow-600",children:[e.jsx(ua,{className:"h-3 w-3 mr-1"}),S.length," Warnings"]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[o.file?.name.endsWith(".csv")?e.jsx(ft,{className:"h-4 w-4"}):e.jsx(zr,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:o.file?.name})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[o.parsedData.length," rows found"]})]}),K.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-red-600",children:"Validation Errors"}),e.jsxs("div",{className:"max-h-32 overflow-y-auto space-y-1",children:[K.slice(0,10).map((h,I)=>e.jsx(Oe,{variant:"destructive",className:"py-2",children:e.jsxs(Ke,{className:"text-xs",children:["Row ",h.row,', Column "',h.column,'": ',h.message]})},I)),K.length>10&&e.jsxs("p",{className:"text-xs text-gray-500",children:["... and ",K.length-10," more errors"]})]})]}),S.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-yellow-600",children:"Warnings"}),e.jsxs("div",{className:"max-h-24 overflow-y-auto space-y-1",children:[S.slice(0,5).map((h,I)=>e.jsx(Oe,{className:"py-2 border-yellow-200",children:e.jsxs(Ke,{className:"text-xs",children:["Row ",h.row,', Column "',h.column,'": ',h.message]})},I)),S.length>5&&e.jsxs("p",{className:"text-xs text-gray-500",children:["... and ",S.length-5," more warnings"]})]})]}),_.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium",children:"Sample Data (First 3 rows)"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-xs border",children:[e.jsx("thead",{children:e.jsx("tr",{className:"bg-gray-50",children:r.requiredColumns.concat(r.optionalColumns).slice(0,6).map(h=>e.jsx("th",{className:"border px-2 py-1 text-left font-medium",children:h},h))})}),e.jsx("tbody",{children:_.slice(0,3).map((h,I)=>e.jsx("tr",{children:r.requiredColumns.concat(r.optionalColumns).slice(0,6).map(y=>e.jsxs("td",{className:"border px-2 py-1",children:[String(h[y]||"").substring(0,20),String(h[y]||"").length>20&&"..."]},y))},I))})]})})]})]})},D=()=>e.jsxs("div",{className:"space-y-4 text-center",children:[e.jsx(Re,{className:"h-12 w-12 animate-spin mx-auto text-blue-500"}),e.jsx("h3",{className:"text-lg font-medium",children:"Processing Import"}),o.importProgress&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:o.importProgress.message}),e.jsxs("span",{children:[o.importProgress.percentage,"%"]})]}),e.jsx(yt,{value:o.importProgress.percentage}),o.importProgress.currentBatch&&o.importProgress.totalBatches&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Processing batch ",o.importProgress.currentBatch," of ",o.importProgress.totalBatches]})]})]}),k=()=>{if(!o.importResult)return null;const{successfulRows:_,failedRows:Q,totalRows:K,errors:S}=o.importResult;return e.jsxs("div",{className:"space-y-4 text-center",children:[e.jsx(Ka,{className:"h-12 w-12 mx-auto text-green-500"}),e.jsx("h3",{className:"text-lg font-medium",children:"Import Complete"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{className:"bg-green-50 p-3 rounded-lg",children:[e.jsx("div",{className:"font-medium text-green-600",children:_}),e.jsx("div",{className:"text-green-600",children:"Successful"})]}),e.jsxs("div",{className:"bg-red-50 p-3 rounded-lg",children:[e.jsx("div",{className:"font-medium text-red-600",children:Q}),e.jsx("div",{className:"text-red-600",children:"Failed"})]}),e.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg",children:[e.jsx("div",{className:"font-medium text-blue-600",children:K}),e.jsx("div",{className:"text-blue-600",children:"Total"})]})]}),S.length>0&&e.jsxs("div",{className:"space-y-2 text-left",children:[e.jsx("h4",{className:"font-medium text-red-600",children:"Import Errors"}),e.jsxs("div",{className:"max-h-32 overflow-y-auto space-y-1",children:[S.slice(0,5).map((h,I)=>e.jsx(Oe,{variant:"destructive",className:"py-2",children:e.jsxs(Ke,{className:"text-xs",children:["Row ",h.row,": ",h.message]})},I)),S.length>5&&e.jsxs("p",{className:"text-xs text-gray-500",children:["... and ",S.length-5," more errors"]})]})]})]})},$=()=>{switch(o.step){case"upload":return"Import Data";case"preview":return"Review Import Data";case"processing":return"Processing Import";case"complete":return"Import Complete";default:return"Import Data"}},H=()=>o.step==="preview"&&o.validationResult?o.validationResult.validData.length>0:!1;return e.jsxs(e.Fragment,{children:[e.jsxs(A,{variant:i,size:l,className:s,disabled:t,onClick:()=>d(_=>({..._,isOpen:!0})),children:[e.jsx(Xt,{className:"h-4 w-4 mr-2"}),"Import"]}),e.jsx(Qe,{open:o.isOpen,onOpenChange:_=>{_||g()},children:e.jsxs(Ve,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(Be,{children:[e.jsx(ze,{children:$()}),e.jsxs(Ye,{children:[o.step==="upload"&&"Select a file to import data",o.step==="preview"&&"Review the data before importing",o.step==="processing"&&"Please wait while we process your data",o.step==="complete"&&"Import has been completed"]})]}),e.jsxs("div",{className:"py-4",children:[o.step==="upload"&&N(),o.step==="preview"&&E(),o.step==="processing"&&D(),o.step==="complete"&&k()]}),e.jsxs(He,{children:[o.step==="upload"&&e.jsx(A,{variant:"outline",onClick:g,children:"Cancel"}),o.step==="preview"&&e.jsxs(e.Fragment,{children:[e.jsx(A,{variant:"outline",onClick:()=>d(_=>({..._,step:"upload"})),children:"Back"}),e.jsxs(A,{onClick:T,disabled:!H(),children:["Import ",o.validationResult?.validData.length||0," Rows"]})]}),o.step==="complete"&&e.jsx(A,{onClick:g,children:"Close"})]})]})})]})},Nn=u.forwardRef(({className:r,children:s,...t},a)=>e.jsxs(kr,{ref:a,className:re("relative overflow-hidden",r),...t,children:[e.jsx(Gn,{className:"h-full w-full rounded-[inherit]",children:s}),e.jsx(wn,{}),e.jsx(Jn,{})]}));Nn.displayName=kr.displayName;const wn=u.forwardRef(({className:r,orientation:s="vertical",...t},a)=>e.jsx(Cr,{ref:a,orientation:s,className:re("flex touch-none select-none transition-colors",s==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",s==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",r),...t,children:e.jsx(Xn,{className:"relative flex-1 rounded-full bg-border"})}));wn.displayName=Cr.displayName;const ds=u.forwardRef(({className:r,...s},t)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:t,className:re("w-full caption-bottom text-sm",r),...s})}));ds.displayName="Table";const us=u.forwardRef(({className:r,...s},t)=>e.jsx("thead",{ref:t,className:re("[&_tr]:border-b",r),...s}));us.displayName="TableHeader";const ms=u.forwardRef(({className:r,...s},t)=>e.jsx("tbody",{ref:t,className:re("[&_tr:last-child]:border-0",r),...s}));ms.displayName="TableBody";const Tl=u.forwardRef(({className:r,...s},t)=>e.jsx("tfoot",{ref:t,className:re("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",r),...s}));Tl.displayName="TableFooter";const we=u.forwardRef(({className:r,...s},t)=>e.jsx("tr",{ref:t,className:re("border-b transition-colors data-[state=selected]:bg-muted hover:bg-muted/50",r),...s}));we.displayName="TableRow";const X=u.forwardRef(({className:r,...s},t)=>e.jsx("th",{ref:t,className:re("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",r),...s}));X.displayName="TableHead";const Y=u.forwardRef(({className:r,...s},t)=>e.jsx("td",{ref:t,className:re("p-4 align-middle [&:has([role=checkbox])]:pr-0",r),...s}));Y.displayName="TableCell";const Dl=u.forwardRef(({className:r,...s},t)=>e.jsx("caption",{ref:t,className:re("mt-4 text-sm text-muted-foreground",r),...s}));Dl.displayName="TableCaption";const Js=({data:r,columns:s,onSort:t,currentSort:a,loading:n=!1,emptyMessage:i="No data available",searchable:l=!0,filterable:m=!1,actions:c=[],onRowClick:o,className:d,maxHeight:g="600px",stickyHeader:b=!0,striped:w=!0,bordered:T=!1,compact:L=!1,selectable:f=!1,selectedRows:N=[],onSelectionChange:E,rowKey:D="id"})=>{const[k,$]=u.useState(""),[H,_]=u.useState({}),Q=u.useMemo(()=>a?[...r].sort((q,B)=>{const U=q[a.column],ie=B[a.column];let ue=0;switch(a.dataType){case"number":ue=(Number(U)||0)-(Number(ie)||0);break;case"date":const je=new Date(U),z=new Date(ie);ue=je.getTime()-z.getTime();break;case"boolean":ue=U===ie?0:U?1:-1;break;default:ue=String(U||"").localeCompare(String(ie||""))}return a.direction==="desc"?-ue:ue}):r,[r,a]),K=u.useMemo(()=>{let q=Q;if(k&&l){const B=k.toLowerCase();q=q.filter(U=>s.some(ie=>ie.searchable===!1?!1:String(U[ie.key]||"").toLowerCase().includes(B)))}return m&&Object.entries(H).forEach(([B,U])=>{if(U){const ie=U.toLowerCase();q=q.filter(ue=>String(ue[B]||"").toLowerCase().includes(ie))}}),q},[Q,k,H,s,l,m]),S=q=>{if(!q.sortable||!t)return;let B="asc";a?.column===q.key&&(B=a.direction==="asc"?"desc":"asc"),t({column:q.key,direction:B,dataType:q.dataType})},h=(q,B)=>{if(!f||!E)return;const U=q[D];let ie=[...N];B?ie.some(ue=>ue[D]===U)||ie.push(q):ie=ie.filter(ue=>ue[D]!==U),E(ie)},I=q=>{!f||!E||E(q?K:[])},y=q=>f?N.some(B=>B[D]===q[D]):!1,F=()=>!f||K.length===0?!1:K.every(q=>y(q)),p=q=>q.sortable?a?.column===q.key?a.direction==="asc"?e.jsx(_i,{className:"h-4 w-4"}):e.jsx(ki,{className:"h-4 w-4"}):e.jsx(Ci,{className:"h-4 w-4 opacity-50"}):null,C=(q,B,U)=>{if(B.formatter)return B.formatter(q,U);if(q==null)return e.jsx("span",{className:"text-gray-400",children:"â€”"});switch(B.dataType){case"boolean":return e.jsx(qe,{variant:q?"default":"secondary",children:q?"Yes":"No"});case"date":return ca(q);case"number":return typeof q=="number"?q.toLocaleString():q;default:return String(q)}},G=q=>{switch(q){case"center":return"text-center";case"right":return"text-right";default:return"text-left"}};return e.jsxs("div",{className:`space-y-4 ${d}`,children:[(l||m)&&e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4",children:[l&&e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ts,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(V,{placeholder:"Search...",value:k,onChange:q=>$(q.target.value),className:"pl-10 text-sm"})]}),m&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Ks,{className:"h-4 w-4 text-gray-400 mt-3"}),s.slice(0,3).map(q=>e.jsx(V,{placeholder:`Filter ${q.label}...`,value:H[q.key]||"",onChange:B=>_(U=>({...U,[q.key]:B.target.value})),className:"w-40"},q.key))]})]}),k&&e.jsxs("div",{className:"text-sm text-gray-500",children:["Showing ",K.length," of ",r.length," results"]}),e.jsx("div",{className:`rounded-md border ${T?"border-2":""} overflow-hidden`,children:g&&g!=="none"?e.jsx("div",{className:"overflow-x-auto",children:e.jsx(Nn,{style:{maxHeight:g},className:"relative",children:e.jsxs(ds,{className:"min-w-full",children:[e.jsx(us,{className:b?"sticky top-0 bg-gray-100 z-10":"bg-gray-100",style:b?{position:"sticky",top:0,zIndex:10}:void 0,children:e.jsxs(we,{children:[f&&e.jsx(X,{className:"w-12",children:e.jsx("input",{type:"checkbox",checked:F(),onChange:q=>I(q.target.checked),className:"rounded border-gray-300"})}),s.map(q=>e.jsx(X,{className:`${G(q.align)} ${q.sortable?"cursor-pointer hover:bg-gray-50":""} ${q.headerClassName||""}`,style:{width:q.width},onClick:()=>S(q),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:q.label}),p(q)]})},q.key)),c.length>0&&e.jsx(X,{className:"w-12",children:"Actions"})]})}),e.jsx(ms,{children:n?e.jsx(we,{children:e.jsx(Y,{colSpan:s.length+(f?1:0)+(c.length>0?1:0),className:"text-center py-8",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-900"}),"Loading..."]})})}):K.length===0?e.jsx(we,{children:e.jsx(Y,{colSpan:s.length+(f?1:0)+(c.length>0?1:0),className:"text-center py-8 text-gray-500",children:i})}):K.map((q,B)=>e.jsxs(we,{className:`
                      ${w&&B%2===1?"bg-gray-50":""}
                      ${L?"h-10":""}
                      ${o?"cursor-pointer hover:bg-gray-100":""}
                      ${y(q)?"bg-blue-50 border-blue-200":""}
                    `,onClick:()=>o?.(q),children:[f&&e.jsx(Y,{children:e.jsx("input",{type:"checkbox",checked:y(q),onChange:U=>{U.stopPropagation(),h(q,U.target.checked)},className:"rounded border-gray-300"})}),s.map(U=>e.jsx(Y,{className:`${G(U.align)} ${U.cellClassName||""}`,children:C(q[U.key],U,q)},U.key)),c.length>0&&e.jsx(Y,{children:e.jsxs(sa,{children:[e.jsx(ta,{asChild:!0,children:e.jsx(A,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:U=>U.stopPropagation(),children:e.jsx(Va,{className:"h-4 w-4"})})}),e.jsx(Ft,{align:"end",children:c.map((U,ie)=>e.jsxs(jt,{onClick:ue=>{ue.stopPropagation(),U.onClick(q)},disabled:U.disabled?.(q),className:U.variant==="destructive"?"text-red-600":"",children:[U.icon&&e.jsx("span",{className:"mr-2",children:U.icon}),U.label]},ie))})]})})]},q[D]||B))})]})})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(ds,{className:"min-w-full",children:[e.jsx(us,{className:b?"sticky top-0 bg-gray-100 z-10":"bg-gray-100",style:b?{position:"sticky",top:0,zIndex:10}:void 0,children:e.jsxs(we,{children:[f&&e.jsx(X,{className:"w-12",children:e.jsx("input",{type:"checkbox",checked:F(),onChange:q=>I(q.target.checked),className:"rounded border-gray-300"})}),s.map(q=>e.jsx(X,{className:`${G(q.align)} ${q.sortable?"cursor-pointer hover:bg-gray-50":""} ${q.headerClassName||""}`,style:{width:q.width},onClick:()=>S(q),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:q.label}),p(q)]})},q.key)),c.length>0&&e.jsx(X,{className:"w-12",children:"Actions"})]})}),e.jsx(ms,{children:n?e.jsx(we,{children:e.jsx(Y,{colSpan:s.length+(f?1:0)+(c.length>0?1:0),className:"text-center py-8",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-900"}),"Loading..."]})})}):K.length===0?e.jsx(we,{children:e.jsx(Y,{colSpan:s.length+(f?1:0)+(c.length>0?1:0),className:"text-center py-8 text-gray-500",children:i})}):K.map((q,B)=>e.jsxs(we,{className:`
                      ${w&&B%2===1?"bg-gray-50":""}
                      ${L?"h-10":""}
                      ${o?"cursor-pointer hover:bg-gray-100":""}
                      ${y(q)?"bg-blue-50 border-blue-200":""}
                    `,onClick:()=>o?.(q),children:[f&&e.jsx(Y,{children:e.jsx("input",{type:"checkbox",checked:y(q),onChange:U=>{U.stopPropagation(),h(q,U.target.checked)},className:"rounded border-gray-300"})}),s.map(U=>e.jsx(Y,{className:`${G(U.align)} ${U.cellClassName||""}`,children:C(q[U.key],U,q)},U.key)),c.length>0&&e.jsx(Y,{children:e.jsxs(sa,{children:[e.jsx(ta,{asChild:!0,children:e.jsx(A,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:U=>U.stopPropagation(),children:e.jsx(Va,{className:"h-4 w-4"})})}),e.jsx(Ft,{align:"end",children:c.map((U,ie)=>e.jsxs(jt,{onClick:ue=>{ue.stopPropagation(),U.onClick(q)},disabled:U.disabled?.(q),className:U.variant==="destructive"?"text-red-600":"",children:[U.icon&&e.jsx("span",{className:"mr-2",children:U.icon}),U.label]},ie))})]})})]},q[D]||B))})]})})}),f&&N.length>0&&e.jsxs("div",{className:"flex items-center justify-between bg-blue-50 p-3 rounded-lg",children:[e.jsxs("span",{className:"text-sm text-blue-700",children:[N.length," row",N.length>1?"s":""," selected"]}),e.jsx(A,{variant:"outline",size:"sm",onClick:()=>E?.([]),children:"Clear Selection"})]})]})},vt={view:r=>({label:"View",icon:e.jsx(Qr,{className:"h-4 w-4"}),onClick:r}),edit:r=>({label:"Edit",icon:e.jsx(Vs,{className:"h-4 w-4"}),onClick:r}),delete:r=>({label:"Delete",icon:e.jsx(Ts,{className:"h-4 w-4"}),onClick:r,variant:"destructive"})},Bs=r=>{const[s,t]=Le.useState(r),a=Le.useCallback(l=>{t(l)},[]),n=Le.useCallback(()=>{t(void 0)},[]),i=Le.useCallback(l=>s?[...l].sort((m,c)=>{const o=m[s.column],d=c[s.column];let g=0;switch(s.dataType){case"number":g=(Number(o)||0)-(Number(d)||0);break;case"date":const b=new Date(o),w=new Date(d);g=b.getTime()-w.getTime();break;case"boolean":g=o===d?0:o?1:-1;break;default:g=String(o||"").localeCompare(String(d||""))}return s.direction==="desc"?-g:g}):l,[s]);return{currentSort:s,handleSort:a,clearSort:n,getSortedData:i}},te=ri,ae=ni,ee=u.forwardRef(({className:r,children:s,...t},a)=>e.jsxs(Pr,{ref:a,className:re("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",r),...t,children:[s,e.jsx(Zn,{asChild:!0,children:e.jsx(Ra,{className:"h-4 w-4 opacity-50"})})]}));ee.displayName=Pr.displayName;const Sn=u.forwardRef(({className:r,...s},t)=>e.jsx(Tr,{ref:t,className:re("flex cursor-default items-center justify-center py-1",r),...s,children:e.jsx(Pi,{className:"h-4 w-4"})}));Sn.displayName=Tr.displayName;const _n=u.forwardRef(({className:r,...s},t)=>e.jsx(Dr,{ref:t,className:re("flex cursor-default items-center justify-center py-1",r),...s,children:e.jsx(Ra,{className:"h-4 w-4"})}));_n.displayName=Dr.displayName;const se=u.forwardRef(({className:r,children:s,position:t="popper",...a},n)=>e.jsx(ei,{children:e.jsxs(Er,{ref:n,className:re("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",r),position:t,...a,children:[e.jsx(Sn,{}),e.jsx(si,{className:re("p-1",t==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s}),e.jsx(_n,{})]})}));se.displayName=Er.displayName;const El=u.forwardRef(({className:r,...s},t)=>e.jsx(Rr,{ref:t,className:re("py-1.5 pl-8 pr-2 text-sm font-semibold",r),...s}));El.displayName=Rr.displayName;const v=u.forwardRef(({className:r,children:s,...t},a)=>e.jsxs(Ar,{ref:a,className:re("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",r),...t,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(ti,{children:e.jsx(Kr,{className:"h-4 w-4"})})}),e.jsx(ai,{children:s})]}));v.displayName=Ar.displayName;const Rl=u.forwardRef(({className:r,...s},t)=>e.jsx(qr,{ref:t,className:re("-mx-1 my-1 h-px bg-muted",r),...s}));Rl.displayName=qr.displayName;const Al=()=>{const[r,s]=u.useState(!1),[t,a]=u.useState(!1),[n,i]=u.useState(null),[l,m]=u.useState(null),[c,o]=u.useState(""),[d,g]=u.useState([]),[b,w]=u.useState("all"),[T,L]=u.useState("all"),[f,N]=u.useState({from:"",to:""}),[E,D]=u.useState(1),[k,$]=u.useState(50),H=is(),{toast:_}=Ee(),{user:Q,loading:K}=os(),{config:S}=bs("purchases"),{validationRules:h,canImport:I}=Ns("purchases"),{currentSort:y,handleSort:F,getSortedData:p}=Bs(),[C,G]=u.useState({purchase_code:"",date:new Date().toISOString().split("T")[0],vendor_id:"",stock_id:"",quantity:"",rate:"",total_amount:""});u.useEffect(()=>{const{quantity:O,rate:De}=C;if(O&&De){const ss=parseFloat(O)*parseFloat(De);G(as=>({...as,total_amount:String(ss)}))}else G(ss=>({...ss,total_amount:""}))},[C.quantity,C.rate]);const{data:q,isLoading:B,error:U}=he({queryKey:["purchases"],queryFn:()=>zs.getAll(),enabled:!!Q}),{data:ie,isLoading:ue,error:je}=he({queryKey:["vendors"],queryFn:()=>Pt.getAll(),enabled:!!Q}),{data:z,isLoading:pe,error:fe}=he({queryKey:["stocks"],queryFn:()=>Fs.getAll(),enabled:!!Q}),Te=Le.useMemo(()=>ie?new Map(ie.map(O=>[O.$id,O.vendor_name])):new Map,[ie]),Ze=Le.useMemo(()=>z?new Map(z.map(O=>[O.$id,O.stock_name])):new Map,[z]),xe=Le.useMemo(()=>q?q.map(O=>({...O,id:O.$id,vendor_name:Te.get(O.vendor_id)||"Unknown Vendor",stock_name:Ze.get(O.stock_id)||"Unknown Stock"})):[],[q,Te,Ze]),Ce=Ne({mutationFn:O=>l?zs.update(l.id,O):zs.create(O),onSuccess:()=>{H.invalidateQueries({queryKey:["purchases"]}),s(!1),m(null),_({title:l?"Purchase Updated":"Purchase Created",description:`The purchase has been successfully ${l?"updated":"saved"}.`})},onError:O=>{_({title:"Error",description:O.message||`Failed to ${l?"update":"create"} purchase.`,variant:"destructive"})}}),ns=Ne({mutationFn:O=>zs.delete(O),onSuccess:()=>{H.invalidateQueries({queryKey:["purchases"]}),_({title:"Purchase Deleted",description:"The purchase has been successfully deleted."})},onError:O=>{_({title:"Error",description:O.message||"Failed to delete purchase.",variant:"destructive"})}}),We=O=>{i(O),a(!0)},Ge=()=>{n&&(ns.mutate(n),i(null),a(!1))},R=O=>{m(O),G({...O,date:new Date(O.date).toISOString().split("T")[0],quantity:String(O.quantity),rate:String(O.rate),total_amount:String(O.total_amount),vendor_id:O.vendor_id,stock_id:O.stock_id}),s(!0)},M=O=>{if(O.preventDefault(),!C.purchase_code||!C.date||!C.vendor_id||!C.stock_id||!C.quantity||!C.rate){_({title:"Missing Fields",description:"Please fill out all required fields.",variant:"destructive"});return}const De={purchase_code:C.purchase_code,date:C.date,vendor_id:C.vendor_id,stock_id:C.stock_id,quantity:parseFloat(C.quantity),rate:parseFloat(C.rate),total_amount:parseFloat(C.total_amount)};Ce.mutate(De)},be=xe.filter(O=>{const De=O.purchase_code.toLowerCase().includes(c.toLowerCase())||O.vendor_name.toLowerCase().includes(c.toLowerCase())||O.stock_name.toLowerCase().includes(c.toLowerCase()),ss=b==="all"||O.vendor_id===b,as=T==="all"||O.stock_id===T,Lt=new Date(O.date),Zs=(!f.from||Lt>=new Date(f.from))&&(!f.to||Lt<=new Date(f.to));return De&&ss&&as&&Zs}),Se=Le.useMemo(()=>{const O=new Map;return xe.forEach(De=>{O.has(De.vendor_id)||O.set(De.vendor_id,{id:De.vendor_id,name:De.vendor_name})}),Array.from(O.values()).sort((De,ss)=>De.name.localeCompare(ss.name))},[xe]),$e=Le.useMemo(()=>{const O=new Map;return xe.forEach(De=>{O.has(De.stock_id)||O.set(De.stock_id,{id:De.stock_id,name:De.stock_name})}),Array.from(O.values()).sort((De,ss)=>De.name.localeCompare(ss.name))},[xe]),Je=be.length,ls=Math.ceil(Je/k),Ds=(E-1)*k,j=Ds+k,oe=be.slice(Ds,j);u.useEffect(()=>{D(1)},[c,b,T,f,k]);const ye=Ne({mutationFn:async O=>{await Promise.all(O.map(De=>zs.delete(De)))},onSuccess:()=>{H.invalidateQueries({queryKey:["purchases"]}),g([]),_({title:"Success",description:"Selected purchases deleted successfully."})},onError:()=>{_({title:"Error",description:"Failed to delete selected purchases.",variant:"destructive"})}}),_e=()=>{if(d.length===0){_({title:"No Selection",description:"Please select purchases to delete.",variant:"destructive"});return}confirm(`Are you sure you want to delete ${d.length} selected purchase(s)?`)&&ye.mutate(d.map(O=>O.id))},es=()=>{if(d.length===0){_({title:"No Selection",description:"Please select purchases to export.",variant:"destructive"});return}_({title:"Export",description:`Exporting ${d.length} selected purchase(s)...`})},ws=K||B||ue||pe,dt=U||je||fe;return ws?e.jsx("div",{children:"Loading..."}):dt?(console.error("Data loading error:",{purchasesError:U,vendorsError:je,stocksError:fe}),e.jsx("div",{children:"Error loading data."})):e.jsx("div",{className:"p-4",children:e.jsxs(J,{children:[e.jsx(le,{children:e.jsxs(ce,{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Purchases"}),e.jsxs(A,{onClick:()=>s(!0),children:[e.jsx(fs,{className:"mr-2 h-4 w-4"})," Add New Purchase"]})]})}),e.jsxs(Z,{children:[e.jsx(J,{className:"mb-6",children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(ts,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(V,{placeholder:"Search purchases...",className:"pl-10",value:c,onChange:O=>o(O.target.value)})]}),I&&S&&e.jsx(gs,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:S.exportColumns.filter(O=>O.required).map(O=>O.exportHeader),optionalColumns:S.exportColumns.filter(O=>!O.required).map(O=>O.exportHeader),validationRules:h,onImportComplete:O=>{O.successfulRows>0&&(H.invalidateQueries({queryKey:["purchases"]}),_({title:"Import Successful",description:`${O.successfulRows} purchases imported successfully.`}))}},variant:"outline"}),S&&e.jsx(xs,{data:be.map(O=>{const De={};return S.exportColumns.forEach(ss=>{let as;switch(ss.dataKey){case"purchaseCode":as=O.purchase_code;break;case"date":as=O.date;break;case"vendorName":as=O.vendor_name;break;case"stockName":as=O.stock_name;break;case"quantity":as=O.quantity;break;case"rate":as=O.rate;break;case"totalAmount":as=O.total_amount;break;case"status":as="Completed";break;default:as=O[ss.dataKey]}De[ss.exportHeader]=ss.formatter?ss.formatter(as):as}),De}),headers:S.exportColumns.map(O=>O.exportHeader),filename:"purchases",variant:"outline"})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs(te,{value:b,onValueChange:w,children:[e.jsx(ee,{className:"w-[180px]",children:e.jsx(ae,{placeholder:"Filter by Vendor"})}),e.jsxs(se,{children:[e.jsx(v,{value:"all",children:"All Vendors"}),Se.map(O=>e.jsx(v,{value:O.id,children:O.name},O.id))]})]}),e.jsxs(te,{value:T,onValueChange:L,children:[e.jsx(ee,{className:"w-[180px]",children:e.jsx(ae,{placeholder:"Filter by Stock"})}),e.jsxs(se,{children:[e.jsx(v,{value:"all",children:"All Stocks"}),$e.map(O=>e.jsx(v,{value:O.id,children:O.name},O.id))]})]}),e.jsx(V,{type:"date",placeholder:"From Date",className:"w-[150px]",value:f.from,onChange:O=>N(De=>({...De,from:O.target.value}))}),e.jsx(V,{type:"date",placeholder:"To Date",className:"w-[150px]",value:f.to,onChange:O=>N(De=>({...De,to:O.target.value}))})]})]})})}),e.jsx(Qe,{open:r,onOpenChange:O=>{s(O),O||(m(null),G({purchase_code:"",date:new Date().toISOString().split("T")[0],vendor_id:"",stock_id:"",quantity:"",rate:"",total_amount:""}))},children:e.jsxs(Ve,{className:"sm:max-w-[600px]",children:[e.jsxs(Be,{children:[e.jsx(ze,{children:l?"Edit Purchase":"Add New Purchase"}),e.jsx(Ye,{children:l?"Update the purchase information below.":"Fill in the details to create a new purchase record."})]}),e.jsxs("form",{onSubmit:M,children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 py-4",children:[e.jsxs("div",{children:[e.jsx(P,{htmlFor:"purchase_code",children:"Purchase Code"}),e.jsx(V,{id:"purchase_code",value:C.purchase_code,onChange:O=>G({...C,purchase_code:O.target.value})})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"date",children:"Date"}),e.jsx(V,{id:"date",type:"date",value:C.date,onChange:O=>G({...C,date:O.target.value})})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"vendor_id",children:"Vendor"}),e.jsxs(te,{value:C.vendor_id,onValueChange:O=>G({...C,vendor_id:O}),children:[e.jsx(ee,{id:"vendor_id",children:e.jsx(ae,{placeholder:"Select a vendor"})}),e.jsx(se,{children:ie?.map(O=>e.jsx(v,{value:O.$id,children:O.vendor_name},O.$id))})]})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"stock_id",children:"Stock"}),e.jsxs(te,{value:C.stock_id,onValueChange:O=>G({...C,stock_id:O}),children:[e.jsx(ee,{id:"stock_id",children:e.jsx(ae,{placeholder:"Select a stock item"})}),e.jsx(se,{children:z?.map(O=>e.jsx(v,{value:O.$id,children:O.stock_name},O.$id))})]})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"quantity",children:"Quantity"}),e.jsx(V,{id:"quantity",type:"number",value:C.quantity,onChange:O=>G({...C,quantity:O.target.value})})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"rate",children:"Rate"}),e.jsx(V,{id:"rate",type:"number",value:C.rate,onChange:O=>G({...C,rate:O.target.value})})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"total_amount",children:"Total Amount"}),e.jsx(V,{id:"total_amount",type:"number",value:C.total_amount,readOnly:!0,className:"bg-gray-100"})]})]}),e.jsx(He,{children:e.jsx(A,{type:"submit",disabled:Ce.isPending,children:Ce.isPending?"Saving...":l?"Update Purchase":"Create Purchase"})})]})]})}),e.jsx(Qe,{open:t,onOpenChange:a,children:e.jsxs(Ve,{children:[e.jsx(Be,{children:e.jsx(ze,{children:"Are you sure?"})}),e.jsx("div",{className:"py-4",children:e.jsx("p",{children:"This action cannot be undone. This will permanently delete the purchase."})}),e.jsxs(He,{children:[e.jsx(A,{variant:"outline",onClick:()=>a(!1),children:"Cancel"}),e.jsx(A,{variant:"destructive",onClick:Ge,children:"Delete"})]})]})}),e.jsx(J,{children:e.jsxs(Z,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",Ds+1," to ",Math.min(j,Je)," of ",Je," records"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Records per page:"}),e.jsxs(te,{value:k.toString(),onValueChange:O=>$(Number(O)),children:[e.jsx(ee,{className:"w-[100px]",children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"50",children:"50"}),e.jsx(v,{value:"100",children:"100"}),e.jsx(v,{value:"500",children:"500"})]})]})]})]}),d.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 p-3 bg-muted rounded-md",children:[e.jsxs("span",{className:"text-sm font-medium",children:[d.length," selected"]}),e.jsx(A,{variant:"destructive",size:"sm",onClick:_e,disabled:ye.isPending,children:"Delete Selected"}),e.jsx(A,{variant:"outline",size:"sm",onClick:es,children:"Export Selected"})]}),e.jsx("div",{className:"border rounded-md",children:e.jsx("div",{className:"overflow-auto",style:{maxHeight:"600px"},children:e.jsx(Js,{data:p(oe.map(O=>((!O.date||O.date==="Invalid Date")&&console.warn("Invalid purchase date found:",{id:O.$id,date:O.date,purchase_code:O.purchase_code}),{...O,formattedDate:ca(O.date),status:"Completed"}))),columns:[{key:"purchase_code",label:"Purchase Code",sortable:!0,dataType:"string"},{key:"formattedDate",label:"Date",sortable:!0,dataType:"date"},{key:"vendor_name",label:"Vendor Name",sortable:!0,dataType:"string"},{key:"stock_name",label:"Stock Name",sortable:!0,dataType:"string"},{key:"quantity",label:"Quantity",sortable:!0,dataType:"number",align:"right",headerClassName:"bg-purple-50",cellClassName:"bg-purple-50 font-medium"},{key:"rate",label:"Rate",sortable:!0,dataType:"number",align:"right"},{key:"total_amount",label:"Total Amount",sortable:!0,dataType:"number",align:"right"},{key:"status",label:"Status",sortable:!0,dataType:"string",formatter:O=>e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${O==="Completed"?"bg-green-100 text-green-800":O==="In Progress"?"bg-yellow-100 text-yellow-800":O==="Pending"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:O})}],onSort:F,currentSort:y,loading:ws,maxHeight:"none",stickyHeader:!0,bordered:!1,searchable:!1,rowKey:"$id",selectable:!0,selectedRows:d,onSelectionChange:g,actions:[{label:"Edit",onClick:R,variant:"default"},{label:"Delete",onClick:O=>We(O.id),variant:"destructive"}],emptyMessage:"No purchases found"})})}),ls>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx(A,{variant:"outline",size:"sm",onClick:()=>D(O=>Math.max(1,O-1)),disabled:E===1,children:"Previous"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",E," of ",ls]})}),e.jsx(A,{variant:"outline",size:"sm",onClick:()=>D(O=>Math.min(ls,O+1)),disabled:E===ls,children:"Next"})]})]})})]})]})})},kn=()=>{const{data:r=[],...s}=he({queryKey:["preProductionTasks"],queryFn:async()=>Ws.getPreProductionTasksWithRelations()});return{tasks:r,...s}},Cn=()=>{const{data:r=[],isLoading:s,error:t,refetch:a}=he({queryKey:["production_tasks"],queryFn:async()=>await Ys.getProductionTasksWithRelations(),staleTime:12e4,gcTime:6e5,refetchOnWindowFocus:!1,retry:3,retryDelay:n=>Math.min(1e3*2**n,3e4)});return{tasks:r,isLoading:s,error:t,refetch:a}},ql=()=>{const r=is(),s=Ne({mutationFn:async({taskData:n,stockItems:i})=>{const l=await Ys.create(n);return i.length>0&&await Promise.all(i.map(m=>Dt.create({production_task_id:l.$id,stock_id:m.stock_id,quantity:m.quantity,action:m.action}))),l},onSuccess:()=>{r.invalidateQueries({queryKey:["production_tasks"]})},onError:n=>{console.error("Error creating production task:",n)}}),t=Ne({mutationFn:async({id:n,taskData:i,stockItems:l})=>{const m=await Ys.update(n,i);return l&&(await Dt.deleteByProductionTaskId(n),l.length>0&&await Promise.all(l.map(c=>Dt.create({production_task_id:n,stock_id:c.stock_id,quantity:c.quantity,action:c.action})))),m},onSuccess:()=>{r.invalidateQueries({queryKey:["production_tasks"]})},onError:n=>{console.error("Error updating production task:",n)}}),a=Ne({mutationFn:async n=>(await Dt.deleteByProductionTaskId(n),await Ys.delete(n)),onSuccess:()=>{r.invalidateQueries({queryKey:["production_tasks"]})},onError:n=>{console.error("Error deleting production task:",n)}});return{createTask:s,updateTask:t,deleteTask:a}},Pn=()=>{const{data:r=[],isLoading:s,error:t,refetch:a}=he({queryKey:["post_production_tasks"],queryFn:async()=>await at.getPostProductionTasksWithRelations(),staleTime:12e4,gcTime:6e5,refetchOnWindowFocus:!1,retry:3,retryDelay:n=>Math.min(1e3*2**n,3e4)});return{tasks:r,isLoading:s,error:t,refetch:a}},Fl=()=>{const r=is(),s=Ne({mutationFn:n=>at.create(n),onSuccess:()=>{r.invalidateQueries({queryKey:["post_production_tasks"]})},onError:n=>{console.error("Error creating post-production task:",n)}}),t=Ne({mutationFn:({id:n,data:i})=>at.update(n,i),onSuccess:()=>{r.invalidateQueries({queryKey:["post_production_tasks"]})},onError:n=>{console.error("Error updating post-production task:",n)}}),a=Ne({mutationFn:n=>at.delete(n),onSuccess:()=>{r.invalidateQueries({queryKey:["post_production_tasks"]})},onError:n=>{console.error("Error deleting post-production task:",n)}});return{createTask:s,updateTask:t,deleteTask:a}},Il=()=>{const{tasks:r}=kn(),{tasks:s}=Cn(),{tasks:t}=Pn(),a=m=>({total:m.length,pending:m.filter(c=>c.status==="pending").length,inProgress:m.filter(c=>c.status==="in_progress").length,completed:m.filter(c=>c.status==="completed").length}),n=a(r),i=a(s),l=a(t);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Tasks Module"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage production tasks across all stages"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs(J,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(le,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Da,{className:"h-5 w-5 text-primary"}),e.jsx(ce,{children:"Pre-Production Tasks"})]}),e.jsx(ve,{children:"Manage pre-production planning and preparation tasks"})]}),e.jsxs(Z,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Track material requisitions, planning approvals, and preparation progress"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-orange-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-orange-700",children:n.pending}),e.jsx("div",{className:"text-orange-600",children:"Pending"})]}),e.jsxs("div",{className:"bg-blue-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-blue-700",children:n.inProgress}),e.jsx("div",{className:"text-blue-600",children:"In Progress"})]}),e.jsxs("div",{className:"bg-green-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-green-700",children:n.completed}),e.jsx("div",{className:"text-green-600",children:"Completed"})]}),e.jsxs("div",{className:"bg-gray-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-gray-700",children:n.total}),e.jsx("div",{className:"text-gray-600",children:"Total"})]})]})]}),e.jsx(Rs,{className:"border-t pt-4",children:e.jsx(A,{asChild:!0,className:"w-full",children:e.jsxs(ks,{to:"/tasks/pre-production",children:["View Pre-Production Tasks",e.jsx(Es,{className:"ml-2 h-4 w-4"})]})})})]}),e.jsxs(J,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(le,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Yr,{className:"h-5 w-5 text-primary"}),e.jsx(ce,{children:"Production Tasks"})]}),e.jsx(ve,{children:"Track manufacturing and production progress"})]}),e.jsxs(Z,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Monitor work-in-progress, production timelines, and quality checks"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-orange-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-orange-700",children:i.pending}),e.jsx("div",{className:"text-orange-600",children:"Pending"})]}),e.jsxs("div",{className:"bg-blue-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-blue-700",children:i.inProgress}),e.jsx("div",{className:"text-blue-600",children:"In Progress"})]}),e.jsxs("div",{className:"bg-green-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-green-700",children:i.completed}),e.jsx("div",{className:"text-green-600",children:"Completed"})]}),e.jsxs("div",{className:"bg-gray-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-gray-700",children:i.total}),e.jsx("div",{className:"text-gray-600",children:"Total"})]})]})]}),e.jsx(Rs,{className:"border-t pt-4",children:e.jsx(A,{asChild:!0,className:"w-full",children:e.jsxs(ks,{to:"/tasks/production",children:["View Production Tasks",e.jsx(Es,{className:"ml-2 h-4 w-4"})]})})})]}),e.jsxs(J,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(le,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Nt,{className:"h-5 w-5 text-primary"}),e.jsx(ce,{children:"Post-Production Tasks"})]}),e.jsx(ve,{children:"Track finishing, packaging, and shipping"})]}),e.jsxs(Z,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Monitor finishing processes, packaging, and logistics"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-orange-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-orange-700",children:l.pending}),e.jsx("div",{className:"text-orange-600",children:"Pending"})]}),e.jsxs("div",{className:"bg-blue-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-blue-700",children:l.inProgress}),e.jsx("div",{className:"text-blue-600",children:"In Progress"})]}),e.jsxs("div",{className:"bg-green-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-green-700",children:l.completed}),e.jsx("div",{className:"text-green-600",children:"Completed"})]}),e.jsxs("div",{className:"bg-gray-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-gray-700",children:l.total}),e.jsx("div",{className:"text-gray-600",children:"Total"})]})]})]}),e.jsx(Rs,{className:"border-t pt-4",children:e.jsx(A,{asChild:!0,className:"w-full",children:e.jsxs(ks,{to:"/tasks/post-production",children:["View Post-Production Tasks",e.jsx(Es,{className:"ml-2 h-4 w-4"})]})})})]})]}),e.jsxs(J,{children:[e.jsx(le,{children:e.jsx(ce,{className:"flex items-center gap-2",children:"Task Management System"})}),e.jsx(Z,{children:e.jsx("div",{className:"text-center py-6 text-muted-foreground",children:e.jsx("p",{className:"text-sm",children:"Comprehensive task management across all production stages with real-time tracking and reporting"})})})]})]})},$l=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Status Module"}),e.jsx("p",{className:"text-muted-foreground",children:"Track real-time status across all production stages"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs(J,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(le,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ti,{className:"h-5 w-5 text-primary"}),e.jsx(ce,{children:"Stock Status"})]}),e.jsx(ve,{children:"Track raw material and component inventory"})]}),e.jsx(Z,{children:e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Monitor stock levels, movements, and availability of raw materials and components"})}),e.jsx(Rs,{className:"border-t pt-4",children:e.jsx(A,{asChild:!0,className:"w-full",children:e.jsxs(ks,{to:"/status/stock-status",children:["View Stock Status",e.jsx(Es,{className:"ml-2 h-4 w-4"})]})})})]}),e.jsxs(J,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(le,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Da,{className:"h-5 w-5 text-primary"}),e.jsx(ce,{children:"Pre-production Status"})]}),e.jsx(ve,{children:"Track pre-production planning and preparation"})]}),e.jsx(Z,{children:e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Monitor material requisitions, planning approvals, and preparation progress"})}),e.jsx(Rs,{className:"border-t pt-4",children:e.jsx(A,{asChild:!0,className:"w-full",children:e.jsxs(ks,{to:"/status/pre-production-status",children:["View Pre-production Status",e.jsx(Es,{className:"ml-2 h-4 w-4"})]})})})]}),e.jsxs(J,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(le,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Yr,{className:"h-5 w-5 text-primary"}),e.jsx(ce,{children:"Production Status"})]}),e.jsx(ve,{children:"Track manufacturing and production progress"})]}),e.jsx(Z,{children:e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Monitor work-in-progress, production timelines, and quality checks"})}),e.jsx(Rs,{className:"border-t pt-4",children:e.jsx(A,{asChild:!0,className:"w-full",children:e.jsxs(ks,{to:"/status/production-status",children:["View Production Status",e.jsx(Es,{className:"ml-2 h-4 w-4"})]})})})]}),e.jsxs(J,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(le,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Nt,{className:"h-5 w-5 text-primary"}),e.jsx(ce,{children:"Post-Production Status"})]}),e.jsx(ve,{children:"Track finishing, packaging, and shipping"})]}),e.jsx(Z,{children:e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Monitor finishing processes, packaging, and logistics"})}),e.jsx(Rs,{className:"border-t pt-4",children:e.jsx(A,{asChild:!0,className:"w-full",children:e.jsxs(ks,{to:"/status/post-production-status",children:["View Post-Production Status",e.jsx(Es,{className:"ml-2 h-4 w-4"})]})})})]}),e.jsxs(J,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(le,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(It,{className:"h-5 w-5 text-primary"}),e.jsx(ce,{children:"Inventory Status"})]}),e.jsx(ve,{children:"Track overall inventory movements and valuation"})]}),e.jsx(Z,{children:e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Monitor opening/closing balances, receiving, issue, and inventory value"})}),e.jsx(Rs,{className:"border-t pt-4",children:e.jsx(A,{asChild:!0,className:"w-full",children:e.jsxs(ks,{to:"/status/inventory-status",children:["View Inventory Status",e.jsx(Es,{className:"ml-2 h-4 w-4"})]})})})]})]}),e.jsxs(J,{children:[e.jsx(le,{children:e.jsx(ce,{className:"flex items-center gap-2",children:"Database Connection"})}),e.jsx(Z,{children:e.jsx("div",{className:"text-center py-6 text-muted-foreground",children:e.jsx("p",{className:"text-sm",children:"For real-time data tracking and management, ensure your application is connected to Appwrite database"})})})]})]}),Ca={products:["products"],stocks:["stocks"],vendors:["vendors"],staff:["staff"],processes:["processes"],rawProducts:["raw-products"],salesChannels:["sales-channels"],salesUnits:r=>["sales-units",r?.from,r?.to].filter(Boolean),salesRecords:r=>["sales-records",r?.from,r?.to].filter(Boolean),stockStatus:["stock-status"],preProductionStatus:["pre-production-status"],productionStatus:["production-status"],postProductionStatus:["post-production-status"],inventoryStatus:r=>["inventory-status",r?.from,r?.to].filter(Boolean),preProductionTasks:["pre-production-tasks"],productionTasks:["production-tasks"],postProductionTasks:["post-production-tasks"],purchases:["purchases"]},Ll=()=>{const{data:r=[]}=he({queryKey:Ca.salesUnits(),queryFn:()=>Qs.getAll(),staleTime:3e5}),{data:s=[]}=he({queryKey:Ca.salesRecords(),queryFn:()=>tt.getAll(),staleTime:5*60*1e3}),t={total:r.length,totalUnits:r.reduce((n,i)=>n+(i.units||0),0),recentEntries:r.filter(n=>{const i=new Date(n.date),l=new Date;return l.setDate(l.getDate()-7),i>=l}).length,uniqueProducts:new Set(r.map(n=>n.product_id)).size},a={total:s.length,totalRevenue:s.reduce((n,i)=>n+(i.sold_units||0)*(i.unit_price||0),0),recentSales:s.filter(n=>{const i=new Date(n.date),l=new Date;return l.setDate(l.getDate()-7),i>=l}).length,totalUnitsSold:s.reduce((n,i)=>n+(i.sold_units||0),0)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Sales Module"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage sales units, records, and finished goods inventory"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(J,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(le,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Nt,{className:"h-5 w-5 text-primary"}),e.jsx(ce,{children:"Sales Units"})]}),e.jsx(ve,{children:"Track batch coding utilization and inventory movement"})]}),e.jsxs(Z,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:'Sales units added by user using "Add Form" from "Batch Coding" process in Post Production tasks'}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-purple-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-purple-700",children:t.total}),e.jsx("div",{className:"text-purple-600",children:"Total Entries"})]}),e.jsxs("div",{className:"bg-blue-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-blue-700",children:t.totalUnits.toLocaleString()}),e.jsx("div",{className:"text-blue-600",children:"Total Units"})]}),e.jsxs("div",{className:"bg-green-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-green-700",children:t.recentEntries}),e.jsx("div",{className:"text-green-600",children:"This Week"})]}),e.jsxs("div",{className:"bg-orange-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-orange-700",children:t.uniqueProducts}),e.jsx("div",{className:"text-orange-600",children:"Products"})]})]})]}),e.jsx(Rs,{className:"border-t pt-4",children:e.jsx(A,{asChild:!0,className:"w-full",children:e.jsxs(ks,{to:"/sales/units",children:["View Sales Units",e.jsx(Es,{className:"ml-2 h-4 w-4"})]})})})]}),e.jsxs(J,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(le,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ur,{className:"h-5 w-5 text-primary"}),e.jsx(ce,{children:"Sales Records"})]}),e.jsx(ve,{children:"Track sold units with pricing and revenue"})]}),e.jsxs(Z,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:'Total sum of all the "sold units" for the respective SKU in date range in "Sales Record Page"'}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-green-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-green-700",children:a.total}),e.jsx("div",{className:"text-green-600",children:"Total Records"})]}),e.jsxs("div",{className:"bg-blue-50 p-2 rounded text-center",children:[e.jsxs("div",{className:"font-semibold text-blue-700",children:["â‚¹",a.totalRevenue.toLocaleString()]}),e.jsx("div",{className:"text-blue-600",children:"Total Revenue"})]}),e.jsxs("div",{className:"bg-purple-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-purple-700",children:a.recentSales}),e.jsx("div",{className:"text-purple-600",children:"Recent Sales"})]}),e.jsxs("div",{className:"bg-orange-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-orange-700",children:a.totalUnitsSold.toLocaleString()}),e.jsx("div",{className:"text-orange-600",children:"Units Sold"})]})]})]}),e.jsx(Rs,{className:"border-t pt-4",children:e.jsx(A,{asChild:!0,className:"w-full",children:e.jsxs(ks,{to:"/sales/records",children:["View Sales Records",e.jsx(Es,{className:"ml-2 h-4 w-4"})]})})})]})]}),e.jsxs(J,{children:[e.jsx(le,{children:e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(It,{className:"h-5 w-5 text-primary"}),"Sales Management System"]})}),e.jsx(Z,{children:e.jsx("div",{className:"text-center py-6 text-muted-foreground",children:e.jsx("p",{className:"text-sm",children:"Comprehensive sales tracking from batch coding utilization to final revenue with real-time inventory management"})})})]})]})};function Tn({className:r,classNames:s,showOutsideDays:t=!0,presets:a,...n}){return e.jsxs("div",{className:"flex",children:[a&&e.jsx("div",{className:"flex flex-col items-start pr-4 border-r border-gray-200",children:a.map(i=>e.jsx(A,{variant:"ghost",className:"w-full justify-start mb-1",onClick:()=>{n.onSelect&&typeof n.onSelect=="function"&&n.onSelect(i.range)},children:i.name},i.name))}),e.jsx(xi,{showOutsideDays:t,className:re("p-3",r),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:re(_a({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:re(_a({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...s},components:{IconLeft:({...i})=>e.jsx(Di,{className:"h-4 w-4"}),IconRight:({...i})=>e.jsx(Or,{className:"h-4 w-4"})},...n})]})}Tn.displayName="Calendar";const Ml=oi,Ul=li,Dn=u.forwardRef(({className:r,align:s="center",sideOffset:t=4,...a},n)=>e.jsx(ii,{children:e.jsx(Fr,{ref:n,align:s,sideOffset:t,className:re("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...a})}));Dn.displayName=Fr.displayName;function St({value:r,onChange:s,className:t}){const[a,n]=u.useState("this-month"),[i,l]=u.useState(!1),m=[{id:"this-month",name:"This month",range:{from:Us(new Date),to:Os(new Date)}},{id:"previous-month",name:"Previous month",range:{from:Us(ma(new Date,1)),to:Os(ma(new Date,1))}},{id:"last-6-months",name:"Last 6 months",range:{from:ma(new Date,6),to:new Date}},{id:"custom",name:"Custom",range:void 0}],c=d=>{n(d);const g=m.find(b=>b.id===d);g&&g.id!=="custom"?(s(g.range),l(!1)):l(!0)},o=()=>r?.from?r.to?`${Xe(r.from,"dd MMM")} - ${Xe(r.to,"dd MMM yyyy")}`:Xe(r.from,"dd MMM yyyy"):"Select date range";return u.useEffect(()=>{if(!r&&a==="this-month"&&typeof s=="function"){const d=m.find(g=>g.id==="this-month");d&&s(d.range)}},[r,s,a,m]),e.jsxs("div",{className:re("flex items-center gap-2",t),children:[e.jsxs(te,{value:a,onValueChange:c,children:[e.jsx(ee,{className:"w-[150px]",children:e.jsx(ae,{})}),e.jsx(se,{children:m.map(d=>e.jsx(v,{value:d.id,children:d.name},d.id))})]}),e.jsxs(Ml,{open:i,onOpenChange:l,children:[e.jsx(Ul,{asChild:!0,children:e.jsxs(A,{id:"date",variant:"outline",className:re("min-w-[200px] justify-between text-left font-normal",!r&&"text-muted-foreground"),onClick:()=>{a==="custom"&&l(!i)},children:[o(),a==="custom"&&e.jsx(Ra,{className:"h-4 w-4 opacity-50"})]})}),a==="custom"&&e.jsx(Dn,{className:"w-auto p-0",align:"start",children:e.jsx(Tn,{initialFocus:!0,mode:"range",defaultMonth:r?.from,selected:r,onSelect:d=>{s(d),d?.from&&d?.to&&l(!1)},numberOfMonths:2})})]})]})}const Ga=r=>r.toISOString();function Ol(){const{user:r,loading:s}=os(),t=Gs(),{toast:a}=Ee(),n=is(),[i,l]=u.useState(void 0),[m,c]=u.useState(!1),[o,d]=u.useState(null),[g,b]=u.useState([]),[w,T]=u.useState("all"),[L,f]=u.useState("all"),[N,E]=u.useState(""),[D,k]=u.useState({from:"",to:""}),[$,H]=u.useState(1),[_,Q]=u.useState(50),{config:K}=bs("sales-units"),{validationRules:S,canImport:h}=Ns("sales-units"),{currentSort:I,handleSort:y,getSortedData:F}=Bs();if(Le.useEffect(()=>{o&&m&&(console.log("ðŸ”„ Populating form for edit:",o),oe({date:o.date,product_id:o.product_id,sku:o.sku,units:o.units,notes:o.notes||"",dateString:new Date(o.date).toISOString().split("T")[0]}))},[o,m]),s)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Re,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Validating authentication..."})]})});if(!r)return console.error("SalesUnits: User not authenticated, redirecting to login",{location:t.pathname,timestamp:new Date().toISOString(),userAgent:navigator.userAgent}),e.jsx(wt,{to:"/login",state:{from:t},replace:!0});Le.useEffect(()=>()=>{},[r,t]);const{data:p=[],error:C}=he({queryKey:["products"],queryFn:async()=>{try{const x=await Is.getAll();return console.log("ðŸ“¦ Products loaded for sales:",x.map(W=>({id:W.$id,name:W.product||W.product_name,sku:W.sku}))),x}catch(x){throw console.error("SalesUnits: Failed to fetch products",{error:x.message,code:x.code,type:x.type,userId:r?.$id,stack:x.stack}),x}},retry:(x,W)=>W.code===401||W.code===403?!1:x<3}),{data:G=[]}=he({queryKey:["post-production-tasks"],queryFn:async()=>{try{return await at.getAll()}catch(x){throw console.error("SalesUnits: Failed to fetch post-production tasks",x),x}},retry:(x,W)=>W.code===401||W.code===403?!1:x<3}),{data:q=[]}=he({queryKey:["processes"],queryFn:async()=>{try{const x=await lt.getAll();return console.log("ðŸ”§ Processes loaded for sales validation:",x.map(W=>({id:W.$id,name:W.process_name,department:W.department}))),x}catch(x){throw console.error("SalesUnits: Failed to fetch processes",x),x}},staleTime:5*60*1e3}),{data:B=[],isLoading:U,error:ie}=he({queryKey:["post-production-status"],queryFn:async()=>{console.log("ðŸš€ Starting post-production status query...");try{const x=await Sl.getAll();return console.log("âœ… Post-production status query successful:",x.length,"records"),console.log("ðŸ“‹ All PostProductionStatus records:",x.map(W=>({product_id:W.product_id,closing_balance:W.closing_balance,status_date:W.status_date}))),x}catch(x){throw console.error("âŒ SalesUnits: Failed to fetch post-production status",{message:x.message,code:x.code,type:x.type,stack:x.stack}),x}},retry:(x,W)=>(console.log(`ðŸ”„ Retrying post-production status query (attempt ${x+1})`),W.code===401||W.code===403?(console.log("ðŸš« Authentication error, not retrying"),!1):x<3),enabled:!!r});Le.useEffect(()=>{console.log("ðŸ“Š Post-production status query status:",{isLoading:U,hasError:!!ie,dataLength:B.length,error:ie?.message})},[U,ie,B.length]);const ue=u.useMemo(()=>{const x=[];return i?.from&&x.push(Ae.greaterThanEqual("date",Ga(i.from))),i?.to&&x.push(Ae.lessThanEqual("date",Ga(i.to))),x},[i]),{data:je=[],isLoading:z,error:pe}=he({queryKey:["sales-units",i?.from?.toISOString(),i?.to?.toISOString()],queryFn:async()=>{try{return await Qs.getAll(ue)}catch(x){throw console.error("SalesUnits: Failed to fetch sales units",{error:x.message,code:x.code,type:x.type,queries:ue,userId:r?.$id,stack:x.stack}),x}},retry:(x,W)=>W.code===401||W.code===403?!1:x<3});Le.useEffect(()=>{pe&&(console.error("SalesUnits: Sales units query error detected",pe),a({title:"Data Loading Error",description:"Failed to load sales units. Please refresh the page.",variant:"destructive"}))},[pe,a]),Le.useEffect(()=>{C&&(console.error("SalesUnits: Products query error detected",C),a({title:"Products Loading Error",description:"Failed to load products. Some features may not work properly.",variant:"destructive"}))},[C,a]);const fe=Ne({mutationFn:async x=>await as(async()=>await Qs.create(x)),onMutate:()=>{if(es==="offline")throw a({title:"Offline",description:"You are currently offline. Please check your connection.",variant:"destructive"}),new Error("Network offline")},onError:(x,W)=>{try{throw console.error("SalesUnits: Failed to create sales unit",{error:x.message,code:x.code,type:x.type,payload:W,userId:r?.$id}),x.code===401?(a({title:"Authentication Error",description:"Your session has expired. Please log in again.",variant:"destructive"}),window.location.href="/login",x):x.code===403?(a({title:"Permission Denied",description:"You don't have permission to create sales units.",variant:"destructive"}),x):x.code>=500?(a({title:"Server Error",description:"A server error occurred. Please try again later.",variant:"destructive"}),x):ss(x)?(a({title:"Network Error",description:es==="offline"?"You appear to be offline. Please check your internet connection.":"Network error occurred. Retrying...",variant:"destructive"}),x):(a({title:"Error",description:x.message||"Failed to create sales unit. Please try again.",variant:"destructive"}),x)}catch(de){throw console.error("SalesUnits: Error in mutation error handler",de),de}},onSuccess:x=>{n.invalidateQueries({queryKey:["sales-units"]}),a({title:"Success",description:"Sales unit created successfully.",duration:3e3}),c(!1);const W={date:new Date().toISOString(),product_id:"",sku:"",units:0,notes:""};oe(W),_e({}),b([]),d(null)}}),Te=Ne({mutationFn:async({id:x,data:W})=>await as(async()=>await Qs.update(x,W)),onSuccess:x=>{n.invalidateQueries({queryKey:["sales-units"]}),a({title:"Success",description:"Sales unit updated successfully.",duration:3e3}),c(!1),d(null);const W={date:new Date().toISOString(),product_id:"",sku:"",units:0,notes:""};oe(W),_e({})},onError:x=>{console.error("Failed to update sales unit:",x),a({title:"Error",description:x.message||"Failed to update sales unit. Please try again.",variant:"destructive"})}}),Ze=Ne({mutationFn:x=>Qs.delete(x),onSuccess:()=>{n.invalidateQueries({queryKey:["sales-units"]}),a({title:"Success",description:"Sales unit deleted successfully."})},onError:()=>{a({title:"Error",description:"Failed to delete sales unit.",variant:"destructive"})}}),xe=Ne({mutationFn:async x=>{await Promise.all(x.map(W=>Qs.delete(W)))},onSuccess:()=>{n.invalidateQueries({queryKey:["sales-units"]}),b([]),a({title:"Success",description:"Selected units deleted successfully."})},onError:()=>{a({title:"Error",description:"Failed to delete selected units.",variant:"destructive"})}}),Ce=x=>{console.log("ðŸ” Editing sales unit:",x),d(x),c(!0)},ns=x=>{confirm("Are you sure you want to delete this sales unit?")&&Ze.mutate(x)},We=()=>{if(g.length===0){a({title:"No Selection",description:"Please select units to delete.",variant:"destructive"});return}confirm(`Are you sure you want to delete ${g.length} selected unit(s)?`)&&xe.mutate(g.map(x=>x.$id))},Ge=je.filter(x=>{const W=!N||x.sku.toLowerCase().includes(N.toLowerCase())||x.notes&&x.notes.toLowerCase().includes(N.toLowerCase()),de=w==="all"||x.product_id===w,me=L==="all"||x.sku===L,Pe=new Date(x.date),rs=(!D.from||Pe>=new Date(D.from))&&(!D.to||Pe<=new Date(D.to));return W&&de&&me&&rs}),R=Le.useMemo(()=>{const x=new Map;return je.forEach(W=>{x.has(W.product_id)||x.set(W.product_id,{id:W.product_id,name:p.find(de=>de.$id===W.product_id)?.product||W.product_id})}),Array.from(x.values()).sort((W,de)=>W.name.localeCompare(de.name))},[je,p]),M=Le.useMemo(()=>Array.from(new Set(je.map(x=>x.sku))).sort(),[je]),be=Ge.length,Se=Math.ceil(be/_),$e=($-1)*_,Je=$e+_,ls=Ge.slice($e,Je);Le.useEffect(()=>{H(1)},[N,w,L,D,_]);const Ds=()=>{if(g.length===0){a({title:"No Selection",description:"Please select units to export.",variant:"destructive"});return}a({title:"Export",description:`Exporting ${g.length} selected unit(s)...`})},[j,oe]=u.useState({date:new Date().toISOString(),product_id:"",sku:"",units:0,notes:""}),[ye,_e]=u.useState({}),[es,ws]=u.useState("online"),[dt,O]=u.useState(0),De=Le.useMemo(()=>{const x={date:new Date().toISOString(),product_id:"",sku:"",units:0,notes:""};return j.product_id!==x.product_id||j.sku!==x.sku||j.units!==x.units||(j.notes||"")!==x.notes||j.dateString&&j.dateString!==new Date().toISOString().split("T")[0]},[j]);Le.useEffect(()=>{const x=()=>{ws("online"),a({title:"Connection Restored",description:"Your internet connection has been restored."})},W=()=>{ws("offline"),a({title:"Connection Lost",description:"Please check your internet connection.",variant:"destructive"})};return window.addEventListener("online",x),window.addEventListener("offline",W),ws(navigator.onLine?"online":"offline"),()=>{window.removeEventListener("online",x),window.removeEventListener("offline",W)}},[a]);const ss=x=>x.message?.toLowerCase().includes("network")||x.message?.toLowerCase().includes("fetch")||x.message?.toLowerCase().includes("connection")||x.code==="NETWORK_ERROR"||!navigator.onLine,as=async(x,W=3)=>{let de;for(let me=1;me<=W;me++)try{if(O(me-1),me>1){const rs=Math.min(1e3*Math.pow(2,me-2),1e4);await new Promise(ys=>setTimeout(ys,rs))}const Pe=await x();return O(0),Pe}catch(Pe){if(de=Pe,console.error(`SalesUnits: Retry attempt ${me} failed`,{error:Pe.message,isNetworkError:ss(Pe),attempt:me,maxRetries:W}),Pe.code===401||Pe.code===403||!ss(Pe)&&me===W)break}throw O(0),de},Lt=(x,W)=>{const de={...ye};switch(x){case"product_id":W?delete de.product_id:de.product_id="Product is required";break;case"sku":W?delete de.sku:de.sku="SKU is required";break;case"units":!W||W<=0?de.units="Units must be greater than 0":delete de.units;break;case"dateString":W?delete de.dateString:de.dateString="Date is required";break}return _e(de),Object.keys(de).length===0},Zs=x=>{const W={...j,...x};oe(W),Object.keys(x).forEach(de=>{Lt(de,x[de])})},In=async()=>{try{return r?!0:(a({title:"Session Expired",description:"Please log in again to continue.",variant:"destructive"}),!1)}catch{return a({title:"Session Error",description:"Unable to validate your session. Please log in again.",variant:"destructive"}),!1}},$n=x=>{console.log("ðŸ” Checking if product has available batch coding units:",x);const W=B.find(de=>de.product_id===x);if(console.log("ðŸ“‹ Post-production status for product:",W),W&&(W.closing_balance||0)>0){const me=p.find(Pe=>Pe.$id===x)?.sku;if(me){const Pe=je.filter(ys=>ys.sku===me).reduce((ys,Ss)=>ys+(Ss.units||0),0),rs=(W.closing_balance||0)-Pe;return console.log(`ðŸ“Š Availability using stored balance for ${me}:`,{storedBalance:W.closing_balance,soldUnits:Pe,available:rs}),rs>0}}else{console.log("âš ï¸ No stored balance, checking completed batch coding tasks...");const de=G.filter(me=>{const rs=q.find(ys=>ys.$id===me.process_id)?.process_name?.toLowerCase()==="batch coding";return me.product_id===x&&me.status==="completed"&&rs});return console.log(`ðŸ“Š Found ${de.length} completed batch coding tasks for product`),de.length>0}return!1},_t=(x,W,de)=>{console.log("ðŸ” Getting available batch coding units:",{productId:x,sku:W,excludeRecordId:de});const me=p.find(Ss=>Ss.$id===x),Pe=me?.sku;if(!me||!Pe)return console.log("âš ï¸ Product not found or has no SKU:",{productId:x,productSku:Pe}),0;if(Pe!==W)return console.log("âš ï¸ SKU mismatch - requested SKU does not belong to this product:",{productId:x,requestedSku:W,productSku:Pe}),0;const rs=B.find(Ss=>Ss.product_id===x);console.log("ðŸŽ¯ PostProductionStatus record found for product:",rs);let ys=0;if(rs&&rs.closing_balance!==void 0&&rs.closing_balance!==null){const Ss=rs.closing_balance||0;console.log("âœ… Using stored closing balance:",Ss);const Mt=de?je.filter(et=>et.sku===W&&et.$id===de).reduce((et,cs)=>et+(cs.units||0),0):0;ys=Math.max(0,Ss+Mt)}else{console.log("âš ï¸ No stored closing balance found, calculating from completed tasks...");const Ss=G.filter(cs=>{const $s=q.find(Mn=>Mn.$id===cs.process_id),Ut=$s?.process_name?.toLowerCase()==="batch coding",Ua=cs.product_id===x&&cs.status==="completed"&&Ut;return cs.product_id===x&&console.log(`ðŸ” Task ${cs.task_id}:`,{processId:cs.process_id,processName:$s?.process_name,isBatchCoding:Ut,status:cs.status,matches:Ua}),Ua});if(console.log("ðŸ“Š Completed batch coding tasks found:",Ss.length),Ss.length===0)return console.log("âš ï¸ No completed batch coding tasks found for this product"),0;const Mt=Ss.reduce((cs,$s)=>{const Ut=$s.completed_quantity!==void 0&&$s.completed_quantity!==null?Number($s.completed_quantity):Number($s.units)||0;return cs+Ut},0),et=je.filter(cs=>cs.sku===W&&cs.$id!==de).reduce((cs,$s)=>cs+($s.units||0),0);ys=Math.max(0,Mt-et),console.log("ðŸ“Š Calculated availability:",{totalCompletedUnits:Mt,soldUnits:et,availableUnits:ys})}return console.log("ðŸ“ˆ Final availability calculation:",{productId:x,sku:W,availableUnits:ys,excludedRecordId:de,method:rs?.closing_balance!==void 0?"stored_balance":"calculated_from_tasks"}),ys},Ln=async x=>{if(x.preventDefault(),!await In()){console.error("SalesUnits: Session validation failed, aborting form submission");return}if(!j.product_id||!j.sku||!j.units||!j.dateString||j.product_id==="no-products"||j.sku==="no-skus"){a({title:"Validation Error",description:"Please fill all required fields: Product, SKU, Units, and Date.",variant:"destructive"});return}if(j.units<=0){a({title:"Validation Error",description:"Units must be greater than 0.",variant:"destructive"});return}const de=_t(j.product_id,j.sku,o?.$id);if(console.log("ðŸ”„ Edit Mode Validation Check:",{isEditing:!!o,editingRecordId:o?.$id,requestedUnits:j.units,availableUnits:de,sku:j.sku,shouldTriggerValidation:j.units>de}),j.units>de){console.log("ðŸš¨ SALES UNITS VALIDATION TRIGGERED:",{requestedUnits:j.units,availableUnits:de,productId:j.product_id,sku:j.sku}),console.log("ðŸ”„ Showing custom Sales Units validation dialog");const me={isValid:!1,currentProcess:"sales_units",sourceProcess:"batch_coding",availableQuantity:de,requiredQuantity:j.units,warningMessage:`Insufficient batch coding units. Available: ${de} units, Requested: ${j.units} units`,suggestions:[`Reduce quantity to ${de} units or less`,"Complete more batch coding tasks to increase availability","Check batch coding status for current availability"]};console.log("ðŸ“‹ Custom Validation Data Created:",me),console.log("ðŸ§¹ Clearing regular validation state before showing custom dialog")}try{const me={date:j.dateString?new Date(j.dateString).toISOString():j.date,product_id:j.product_id,sku:j.sku,units:j.units,notes:j.notes||void 0};o?Te.mutate({id:o.$id,data:me}):fe.mutate(me)}catch(me){console.error("SalesUnits: Form submission error",me),a({title:"Error",description:"Failed to submit form. Please try again.",variant:"destructive"})}};return e.jsx("div",{className:"p-4",children:e.jsxs(J,{children:[e.jsx(le,{children:e.jsxs(ce,{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Sales Units"}),e.jsxs("div",{className:"flex gap-2",children:[h&&e.jsx(gs,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:K?K.exportColumns.filter(x=>x.required).map(x=>x.exportHeader):["Product","SKU"],optionalColumns:K?K.exportColumns.filter(x=>!x.required).map(x=>x.exportHeader):["Date","Units","Status","Remarks"],validationRules:S,onImportComplete:x=>{x.successfulRows>0&&(n.invalidateQueries({queryKey:["sales-units"]}),a({title:"Import Successful",description:`${x.successfulRows} sales units imported successfully.`}))}},variant:"outline"}),K&&e.jsx(xs,{data:je.map(x=>{const W={};return K.exportColumns.forEach(de=>{let me;switch(de.dataKey){case"date":me=x.date;break;case"productName":me=p.find(Pe=>Pe.$id===x.product_id)?.product||x.product_id;break;case"sku":me=x.sku;break;case"units":me=x.units;break;case"status":me="Completed";break;case"remarks":me=x.notes||"";break;default:me=x[de.dataKey]}W[de.exportHeader]=de.formatter?de.formatter(me):me}),W}),headers:K.exportColumns.map(x=>x.exportHeader),filename:"sales-units",variant:"outline"}),e.jsxs(A,{onClick:()=>c(!0),children:[e.jsx(fs,{className:"mr-2 h-4 w-4"})," Add New Units"]})]})]})}),e.jsxs(Z,{children:[e.jsx(J,{className:"mb-6",children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(ts,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(V,{placeholder:"Search units...",className:"pl-10",value:N,onChange:x=>E(x.target.value)})]}),h&&K&&e.jsx(gs,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:K.exportColumns.filter(x=>x.required).map(x=>x.exportHeader),optionalColumns:K.exportColumns.filter(x=>!x.required).map(x=>x.exportHeader),validationRules:S,onImportComplete:x=>{x.successfulRows>0&&(n.invalidateQueries({queryKey:["sales-units"]}),a({title:"Import Successful",description:`${x.successfulRows} sales units imported successfully.`}))}},variant:"outline"}),K&&e.jsx(xs,{data:Ge.map(x=>{const W={};return K.exportColumns.forEach(de=>{let me;switch(de.dataKey){case"date":me=x.date;break;case"productName":me=p.find(Pe=>Pe.$id===x.product_id)?.product||x.product_id;break;case"sku":me=x.sku;break;case"units":me=x.units;break;case"status":me="Completed";break;case"remarks":me=x.notes||"";break;default:me=x[de.dataKey]}W[de.exportHeader]=de.formatter?de.formatter(me):me}),W}),headers:K.exportColumns.map(x=>x.exportHeader),filename:"sales-units",variant:"outline"})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs(te,{value:w,onValueChange:T,children:[e.jsx(ee,{className:"w-[180px]",children:e.jsx(ae,{placeholder:"Filter by Product"})}),e.jsxs(se,{children:[e.jsx(v,{value:"all",children:"All Products"}),R.map(x=>e.jsx(v,{value:x.id,children:x.name},x.id))]})]}),e.jsxs(te,{value:L,onValueChange:f,children:[e.jsx(ee,{className:"w-[180px]",children:e.jsx(ae,{placeholder:"Filter by SKU"})}),e.jsxs(se,{children:[e.jsx(v,{value:"all",children:"All SKUs"}),M.map(x=>e.jsx(v,{value:x,children:x},x))]})]}),e.jsx(V,{type:"date",placeholder:"From Date",className:"w-[150px]",value:D.from,onChange:x=>k(W=>({...W,from:x.target.value}))}),e.jsx(V,{type:"date",placeholder:"To Date",className:"w-[150px]",value:D.to,onChange:x=>k(W=>({...W,to:x.target.value}))})]})]})})}),e.jsx(Qe,{open:m,onOpenChange:x=>{if(!x&&(fe.isPending||Te.isPending)){a({title:"Please wait",description:"Form is being submitted. Please wait for completion.",variant:"destructive"});return}if(!(!x&&De&&!(fe.isPending||Te.isPending)&&!window.confirm("You have unsaved changes. Are you sure you want to close without saving?"))&&(c(x),!x)){const W={date:new Date().toISOString(),product_id:"",sku:"",units:0,notes:""};oe(W),_e({}),d(null)}},children:e.jsxs(Ve,{className:"sm:max-w-[600px] max-w-[95vw] max-h-[90vh] overflow-y-auto",children:[e.jsxs(Be,{children:[e.jsxs(ze,{className:"flex items-center gap-2",children:[o?"Edit Sales Unit":"Add New Sales Unit",De&&e.jsx("span",{className:"text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded",children:"Unsaved changes"})]}),e.jsx(Ye,{children:"Enter sales unit details below."}),p.filter(x=>$n(x.$id)).length===0&&e.jsxs("div",{className:"mt-2 p-3 bg-yellow-50 border border-yellow-200 rounded text-sm text-yellow-800",children:[e.jsx("strong",{children:"âš ï¸ No products available:"})," All products either have no completed batch coding units or all units have been sold."]})]}),e.jsxs("form",{onSubmit:Ln,children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 py-4",children:[e.jsxs("div",{children:[e.jsx(P,{htmlFor:"date",children:"Date *"}),e.jsx(V,{id:"date",type:"date",value:j.dateString||"",onChange:x=>Zs({dateString:x.target.value}),className:ye.dateString?"border-red-500":""}),ye.dateString&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:ye.dateString})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"product",children:"Product *"}),e.jsxs(te,{value:j.product_id,onValueChange:x=>Zs({product_id:x,sku:p.find(W=>W.$id===x)?.sku||j.sku}),children:[e.jsx(ee,{id:"product",className:ye.product_id?"border-red-500":"",children:e.jsx(ae,{placeholder:"Select Product"})}),e.jsxs(se,{children:[p.filter(x=>{const W=B.find(me=>me.product_id===x.$id);let de=!1;return W&&(W.closing_balance||0)>0?de=!0:x.sku&&(de=G.filter(rs=>rs.product_id===x.$id&&rs.status==="completed").length>0),console.log("ðŸ” Product filtering for sales:",{productId:x.$id,productName:x.product||x.product_name,sku:x.sku,postProdStatusFound:!!W,storedClosingBalance:W?.closing_balance,hasCompletedTasks:G.filter(me=>me.product_id===x.$id&&me.status==="completed").length>0,finalDecision:de}),de}).map(x=>e.jsx(v,{value:x.$id,children:x.product||x.$id},x.$id)),p.filter(x=>{const W=B.find(me=>me.product_id===x.$id);return W&&(W.closing_balance||0)>0?!0:x.sku?G.filter(Pe=>Pe.product_id===x.$id&&Pe.status==="completed").length>0:!1}).length===0&&e.jsx(v,{value:"no-products",disabled:!0,children:"No products with available batch coding units"})]})]}),ye.product_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:ye.product_id})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"sku",children:"SKU *"}),e.jsxs(te,{value:j.sku,onValueChange:x=>Zs({sku:x}),children:[e.jsx(ee,{id:"sku",className:ye.sku?"border-red-500":"",children:e.jsx(ae,{placeholder:"Select SKU"})}),e.jsxs(se,{children:[(()=>{if(!j.product_id)return[];const x=p.find(Pe=>Pe.$id===j.product_id);if(!x||!x.sku)return[];const W=x.sku,de=_t(j.product_id,W,o?.$id),me=o&&W===o.sku;return de>0||me?[x]:[]})().map(x=>{const W=x.sku,de=_t(j.product_id,W,o?.$id),me=o&&W===o.sku;return e.jsxs(v,{value:W,children:[W,x.product?` â€” ${x.product}`:"",e.jsxs("span",{className:`text-xs ml-2 ${de>0?"text-gray-500":"text-red-500"}`,children:["(",de," available",me&&de===0?" - Current":"",")"]})]},x.$id)}),j.product_id&&(()=>{const x=p.find(Pe=>Pe.$id===j.product_id);if(!x||!x.sku)return!0;const W=x.sku,de=_t(j.product_id,W,o?.$id),me=o&&W===o.sku;return de===0&&!me})()&&e.jsx(v,{value:"no-skus",disabled:!0,children:"No SKUs with available batch coding units for this product"})]})]}),ye.sku&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:ye.sku}),j.product_id&&j.sku&&e.jsxs("div",{className:"mt-2 p-2 bg-blue-50 border border-blue-200 rounded text-sm",children:[e.jsx("span",{className:"text-blue-700 font-medium",children:"Available Batch Coding Units:"}),e.jsxs("span",{className:"text-blue-800 font-bold",children:[_t(j.product_id,j.sku,o?.$id)," units"]})]})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"units",children:"Units *"}),e.jsx(V,{id:"units",type:"number",min:"1",value:j.units,onChange:x=>Zs({units:Number(x.target.value)}),className:ye.units?"border-red-500":""}),ye.units&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:ye.units})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(P,{htmlFor:"notes",children:"Remarks"}),e.jsx(V,{id:"notes",type:"text",value:j.notes||"",onChange:x=>Zs({notes:x.target.value})})]})]}),e.jsxs(He,{className:"flex-col sm:flex-row gap-2 pt-4",children:[e.jsx(A,{type:"button",variant:"outline",onClick:()=>c(!1),className:"w-full sm:w-auto",children:"Cancel"}),e.jsx(A,{type:"submit",disabled:fe.isPending||Te.isPending||Object.keys(ye).length>0,className:"w-full sm:w-auto",children:fe.isPending||Te.isPending?e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"mr-2 h-4 w-4 animate-spin"}),"Savingâ€¦"]}):o?"Update Sales Unit":"Add Sales Unit"})]})]})]})}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{placeholder:"Search units...",value:N,onChange:x=>E(x.target.value),className:"max-w-sm"}),e.jsxs(te,{value:w,onValueChange:T,children:[e.jsx(ee,{className:"w-[180px]",children:e.jsx(ae,{placeholder:"Filter by Product"})}),e.jsxs(se,{children:[e.jsx(v,{value:"all",children:"All Products"}),p.map(x=>e.jsx(v,{value:x.$id,children:x.product||x.$id},x.$id))]})]}),e.jsx(St,{value:i,onChange:l})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[es==="offline"&&e.jsxs("div",{className:"flex items-center gap-1 text-red-600 text-sm",children:[e.jsx("div",{className:"w-2 h-2 bg-red-600 rounded-full"}),"Offline"]}),dt>0&&e.jsxs("div",{className:"flex items-center gap-1 text-yellow-600 text-sm",children:[e.jsx(Re,{className:"h-3 w-3 animate-spin"}),"Retrying... (",dt,")"]})]})]}),e.jsx(J,{children:e.jsxs(Z,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",$e+1," to ",Math.min(Je,be)," of ",be," records"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Records per page:"}),e.jsxs(te,{value:_.toString(),onValueChange:x=>Q(Number(x)),children:[e.jsx(ee,{className:"w-[100px]",children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"50",children:"50"}),e.jsx(v,{value:"100",children:"100"}),e.jsx(v,{value:"500",children:"500"})]})]})]})]}),g.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 p-3 bg-muted rounded-md",children:[e.jsxs("span",{className:"text-sm font-medium",children:[g.length," selected"]}),e.jsx(A,{variant:"destructive",size:"sm",onClick:We,disabled:xe.isPending,children:"Delete Selected"}),e.jsx(A,{variant:"outline",size:"sm",onClick:Ds,children:"Export Selected"})]}),e.jsx("div",{className:"border rounded-md",children:e.jsx("div",{className:"overflow-auto",style:{maxHeight:"600px"},children:e.jsx(Js,{data:F(ls.map(x=>((!x.date||x.date==="Invalid Date")&&console.warn("Invalid sales unit date found:",{id:x.$id,date:x.date}),{...x,productName:p.find(W=>W.$id===x.product_id)?.product||x.product_id,formattedDate:ca(x.date),status:"Completed"}))),columns:[{key:"formattedDate",label:"Date",sortable:!0,dataType:"date"},{key:"productName",label:"Product",sortable:!0,dataType:"string"},{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"units",label:"Units",sortable:!0,dataType:"number",align:"right",headerClassName:"bg-purple-50",cellClassName:"bg-purple-50 font-medium"},{key:"status",label:"Status",sortable:!0,dataType:"string",formatter:x=>e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${x==="Completed"?"bg-green-100 text-green-800":x==="In Progress"?"bg-yellow-100 text-yellow-800":x==="Pending"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:x})},{key:"notes",label:"Remarks",sortable:!0,dataType:"string"}],onSort:y,currentSort:I,loading:z,maxHeight:"none",stickyHeader:!0,bordered:!1,searchable:!1,rowKey:"$id",selectable:!0,selectedRows:g,onSelectionChange:b,actions:[{label:"Edit",onClick:Ce,variant:"default"},{label:"Delete",onClick:x=>ns(x.$id),variant:"destructive"}],emptyMessage:"No sales units found"})})}),Se>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx(A,{variant:"outline",size:"sm",onClick:()=>H(x=>Math.max(1,x-1)),disabled:$===1,children:"Previous"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",$," of ",Se]})}),e.jsx(A,{variant:"outline",size:"sm",onClick:()=>H(x=>Math.min(Se,x+1)),disabled:$===Se,children:"Next"})]})]})})]})]})})}const Ja=r=>r.toISOString();function Kl(){const{user:r,loading:s}=os(),t=Gs(),{toast:a}=Ee(),n=is(),[i,l]=u.useState(void 0),[m,c]=u.useState(!1),[o,d]=u.useState(null),[g,b]=u.useState([]),[w,T]=u.useState("all"),[L,f]=u.useState("all"),[N,E]=u.useState("all"),[D,k]=u.useState(""),[$,H]=u.useState({from:"",to:""}),[_,Q]=u.useState(1),[K,S]=u.useState(50),{config:h}=bs("sales-record"),{validationRules:I,canImport:y}=Ns("sales-record"),{currentSort:F,handleSort:p,getSortedData:C}=Bs();if(Le.useEffect(()=>{o&&m&&(console.log("ðŸ”„ Populating form for edit:",o),pe({date:o.date,sales_channel_id:o.sales_channel_id,product_id:o.product_id,sku:o.sku,sold_units:o.sold_units,unit_price:o.unit_price,total_price:o.total_price,notes:o.notes||"",dateString:new Date(o.date).toISOString().split("T")[0]}))},[o,m]),s)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Re,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Validating authentication..."})]})});if(!r)return console.error("SalesRecord: User not authenticated, redirecting to login"),e.jsx(wt,{to:"/login",state:{from:t},replace:!0});const{data:G=[]}=he({queryKey:["products"],queryFn:()=>Is.getAll()}),{data:q=[]}=he({queryKey:["sales-channels"],queryFn:()=>Tt.getAll()}),B=u.useMemo(()=>{const j=[];return i?.from&&j.push(Ae.greaterThanEqual("date",Ja(i.from))),i?.to&&j.push(Ae.lessThanEqual("date",Ja(i.to))),j},[i]),{data:U=[],isLoading:ie}=he({queryKey:["sales-records",i?.from?.toISOString(),i?.to?.toISOString()],queryFn:()=>tt.getAll(B)}),ue=Ne({mutationFn:async j=>{try{return await tt.create(j)}catch(oe){throw console.error("SalesRecord: Failed to create sales record",{error:oe.message,code:oe.code,type:oe.type,payload:j,userId:r?.$id}),oe.code===401?(a({title:"Authentication Error",description:"Your session has expired. Please log in again.",variant:"destructive"}),window.location.href="/login",oe):oe.code===403?(a({title:"Permission Denied",description:"You don't have permission to create sales records.",variant:"destructive"}),oe):(a({title:"Error",description:oe.message||"Failed to create sales record. Please try again.",variant:"destructive"}),oe)}},onSuccess:j=>{n.invalidateQueries({queryKey:["sales-records"]}),a({title:"Success",description:"Sales record created successfully.",duration:3e3}),c(!1),b([]),pe({date:new Date().toISOString(),sales_channel_id:"",product_id:"",sku:"",sold_units:0,unit_price:0,total_price:0,notes:""}),d(null)}}),je=Ne({mutationFn:async({id:j,data:oe})=>await tt.update(j,oe),onSuccess:j=>{n.invalidateQueries({queryKey:["sales-records"]}),a({title:"Success",description:"Sales record updated successfully.",duration:3e3}),c(!1),d(null),pe({date:new Date().toISOString(),sales_channel_id:"",product_id:"",sku:"",sold_units:0,unit_price:0,total_price:0,notes:""})},onError:j=>{console.error("Failed to update sales record:",j),a({title:"Error",description:j.message||"Failed to update sales record. Please try again.",variant:"destructive"})}}),[z,pe]=u.useState({date:new Date().toISOString(),sales_channel_id:"",product_id:"",sku:"",sold_units:0,unit_price:0,total_price:0,notes:""}),fe=Ne({mutationFn:j=>tt.delete(j),onSuccess:()=>{n.invalidateQueries({queryKey:["sales-records"]}),a({title:"Success",description:"Sales record deleted successfully."})},onError:()=>{a({title:"Error",description:"Failed to delete sales record.",variant:"destructive"})}}),Te=Ne({mutationFn:async j=>{await Promise.all(j.map(oe=>tt.delete(oe)))},onSuccess:()=>{n.invalidateQueries({queryKey:["sales-records"]}),b([]),a({title:"Success",description:"Selected records deleted successfully."})},onError:()=>{a({title:"Error",description:"Failed to delete selected records.",variant:"destructive"})}}),Ze=j=>{console.log("ðŸ” Editing sales record:",j),d(j),c(!0)},xe=j=>{confirm("Are you sure you want to delete this sales record?")&&fe.mutate(j)},Ce=()=>{if(g.length===0){a({title:"No Selection",description:"Please select records to delete.",variant:"destructive"});return}confirm(`Are you sure you want to delete ${g.length} selected record(s)?`)&&Te.mutate(g.map(j=>j.$id))},ns=()=>{if(g.length===0){a({title:"No Selection",description:"Please select records to export.",variant:"destructive"});return}a({title:"Export",description:`Exporting ${g.length} selected record(s)...`})},We=U.filter(j=>{const oe=!D||j.sku.toLowerCase().includes(D.toLowerCase())||j.notes&&j.notes.toLowerCase().includes(D.toLowerCase()),ye=w==="all"||j.sales_channel_id===w,_e=L==="all"||j.product_id===L,es=N==="all"||j.sku===N,ws=new Date(j.date),dt=(!$.from||ws>=new Date($.from))&&(!$.to||ws<=new Date($.to));return oe&&ye&&_e&&es&&dt}),Ge=Le.useMemo(()=>{const j=new Map;return U.forEach(oe=>{j.has(oe.sales_channel_id)||j.set(oe.sales_channel_id,{id:oe.sales_channel_id,name:q.find(ye=>ye.$id===oe.sales_channel_id)?.channel_name||oe.sales_channel_id})}),Array.from(j.values()).sort((oe,ye)=>oe.name.localeCompare(ye.name))},[U,q]),R=Le.useMemo(()=>{const j=new Map;return U.forEach(oe=>{j.has(oe.product_id)||j.set(oe.product_id,{id:oe.product_id,name:G.find(ye=>ye.$id===oe.product_id)?.product||oe.product_id})}),Array.from(j.values()).sort((oe,ye)=>oe.name.localeCompare(ye.name))},[U,G]),M=Le.useMemo(()=>Array.from(new Set(U.map(j=>j.sku))).sort(),[U]),be=We.length,Se=Math.ceil(be/K),$e=(_-1)*K,Je=$e+K,ls=We.slice($e,Je);u.useEffect(()=>{Q(1)},[D,w,L,N,$,K]);const Ds=j=>{if(j.preventDefault(),!z.sales_channel_id||!z.product_id||!z.sku||!z.sold_units||!z.unit_price||!z.dateString){a({title:"Validation Error",description:"Please fill all required fields: Date, Sales Channel, Product, SKU, Quantity, and Rate.",variant:"destructive"});return}if(z.sold_units<=0){a({title:"Validation Error",description:"Quantity must be greater than 0.",variant:"destructive"});return}if(z.unit_price<=0){a({title:"Validation Error",description:"Rate must be greater than 0.",variant:"destructive"});return}const oe={date:z.dateString?new Date(z.dateString).toISOString():z.date,sales_channel_id:z.sales_channel_id,product_id:z.product_id,sku:z.sku,sold_units:z.sold_units,unit_price:z.unit_price,total_price:Number((z.sold_units*z.unit_price).toFixed(2)),notes:z.notes||void 0};o?je.mutate({id:o.$id,data:oe}):ue.mutate(oe)};return e.jsx("div",{className:"p-4",children:e.jsxs(J,{children:[e.jsx(le,{children:e.jsxs(ce,{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Sales Records"}),e.jsxs("div",{className:"flex gap-2",children:[y&&e.jsx(gs,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:h?h.exportColumns.filter(j=>j.required).map(j=>j.exportHeader):["Sales Channel","Product","SKU"],optionalColumns:h?h.exportColumns.filter(j=>!j.required).map(j=>j.exportHeader):["Date","Qty","Rate","Total Amount","Status","Remarks"],validationRules:I,onImportComplete:j=>{j.successfulRows>0&&(n.invalidateQueries({queryKey:["sales-records"]}),a({title:"Import Successful",description:`${j.successfulRows} sales records imported successfully.`}))}},variant:"outline"}),h&&e.jsx(xs,{data:U.map(j=>{const oe={};return h.exportColumns.forEach(ye=>{let _e;switch(ye.dataKey){case"date":_e=j.date;break;case"channelName":_e=q.find(es=>es.$id===j.sales_channel_id)?.channel_name||j.sales_channel_id;break;case"productName":_e=G.find(es=>es.$id===j.product_id)?.product||j.product_id;break;case"sku":_e=j.sku;break;case"qty":_e=j.sold_units;break;case"rate":_e=j.unit_price;break;case"totalAmount":_e=Number((j.sold_units*j.unit_price).toFixed(2));break;case"status":_e="Completed";break;case"remarks":_e=j.notes||"";break;default:_e=j[ye.dataKey]}oe[ye.exportHeader]=ye.formatter?ye.formatter(_e):_e}),oe}),headers:h.exportColumns.map(j=>j.exportHeader),filename:"sales-record",variant:"outline"}),e.jsxs(A,{onClick:()=>c(!0),children:[e.jsx(fs,{className:"mr-2 h-4 w-4"})," Add Sales Record"]})]})]})}),e.jsxs(Z,{children:[e.jsx(J,{className:"mb-6",children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(ts,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(V,{placeholder:"Search records...",className:"pl-10",value:D,onChange:j=>k(j.target.value)})]}),y&&h&&e.jsx(gs,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:h.exportColumns.filter(j=>j.required).map(j=>j.exportHeader),optionalColumns:h.exportColumns.filter(j=>!j.required).map(j=>j.exportHeader),validationRules:I,onImportComplete:j=>{j.successfulRows>0&&(n.invalidateQueries({queryKey:["sales-records"]}),a({title:"Import Successful",description:`${j.successfulRows} sales records imported successfully.`}))}},variant:"outline"}),h&&e.jsx(xs,{data:We.map(j=>{const oe={};return h.exportColumns.forEach(ye=>{let _e;switch(ye.dataKey){case"date":_e=j.date;break;case"channelName":_e=q.find(es=>es.$id===j.sales_channel_id)?.channel_name||j.sales_channel_id;break;case"productName":_e=G.find(es=>es.$id===j.product_id)?.product||j.product_id;break;case"sku":_e=j.sku;break;case"qty":_e=j.sold_units;break;case"rate":_e=j.unit_price;break;case"totalAmount":_e=Number((j.sold_units*j.unit_price).toFixed(2));break;case"status":_e="Completed";break;case"remarks":_e=j.notes||"";break;default:_e=j[ye.dataKey]}oe[ye.exportHeader]=ye.formatter?ye.formatter(_e):_e}),oe}),headers:h.exportColumns.map(j=>j.exportHeader),filename:"sales-record",variant:"outline"})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs(te,{value:w,onValueChange:T,children:[e.jsx(ee,{className:"w-[180px]",children:e.jsx(ae,{placeholder:"Filter by Channel"})}),e.jsxs(se,{children:[e.jsx(v,{value:"all",children:"All Channels"}),Ge.map(j=>e.jsx(v,{value:j.id,children:j.name},j.id))]})]}),e.jsxs(te,{value:L,onValueChange:f,children:[e.jsx(ee,{className:"w-[180px]",children:e.jsx(ae,{placeholder:"Filter by Product"})}),e.jsxs(se,{children:[e.jsx(v,{value:"all",children:"All Products"}),R.map(j=>e.jsx(v,{value:j.id,children:j.name},j.id))]})]}),e.jsxs(te,{value:N,onValueChange:E,children:[e.jsx(ee,{className:"w-[180px]",children:e.jsx(ae,{placeholder:"Filter by SKU"})}),e.jsxs(se,{children:[e.jsx(v,{value:"all",children:"All SKUs"}),M.map(j=>e.jsx(v,{value:j,children:j},j))]})]}),e.jsx(V,{type:"date",placeholder:"From Date",className:"w-[150px]",value:$.from,onChange:j=>H(oe=>({...oe,from:j.target.value}))}),e.jsx(V,{type:"date",placeholder:"To Date",className:"w-[150px]",value:$.to,onChange:j=>H(oe=>({...oe,to:j.target.value}))})]})]})})}),e.jsx(Qe,{open:m,onOpenChange:j=>{c(j),j||(pe({date:new Date().toISOString(),sales_channel_id:"",product_id:"",sku:"",sold_units:0,unit_price:0,total_price:0,notes:""}),d(null))},children:e.jsxs(Ve,{className:"sm:max-w-[720px]",children:[e.jsxs(Be,{children:[e.jsx(ze,{children:o?"Edit Sales Record":"Add New Sales Record"}),e.jsx(Ye,{children:"Enter sales record details below."})]}),e.jsxs("form",{onSubmit:Ds,children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 py-4",children:[e.jsxs("div",{children:[e.jsx(P,{htmlFor:"date",children:"Date *"}),e.jsx(V,{id:"date",type:"date",value:z.dateString||"",onChange:j=>pe(oe=>({...oe,dateString:j.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"channel",children:"Sales Channel *"}),e.jsxs(te,{value:z.sales_channel_id,onValueChange:j=>pe(oe=>({...oe,sales_channel_id:j})),children:[e.jsx(ee,{id:"channel",children:e.jsx(ae,{placeholder:"Select Sales Channel"})}),e.jsx(se,{children:q.map(j=>e.jsx(v,{value:j.$id,children:j.channel_name||j.$id},j.$id))})]})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"product",children:"Product *"}),e.jsxs(te,{value:z.product_id,onValueChange:j=>pe(oe=>({...oe,product_id:j,sku:G.find(ye=>ye.$id===j)?.sku||oe.sku})),children:[e.jsx(ee,{id:"product",children:e.jsx(ae,{placeholder:"Select Product"})}),e.jsx(se,{children:G.map(j=>e.jsx(v,{value:j.$id,children:j.product||j.$id},j.$id))})]})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"sku",children:"SKU *"}),e.jsxs(te,{value:z.sku,onValueChange:j=>pe(oe=>({...oe,sku:j})),children:[e.jsx(ee,{id:"sku",children:e.jsx(ae,{placeholder:"Select SKU"})}),e.jsx(se,{children:G.filter(j=>j.sku).map(j=>e.jsxs(v,{value:j.sku,children:[j.sku,j.product?` â€” ${j.product}`:""]},j.$id))})]})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"qty",children:"Quantity *"}),e.jsx(V,{id:"qty",type:"number",min:"1",value:z.sold_units,onChange:j=>pe(oe=>({...oe,sold_units:Number(j.target.value),total_price:Number((Number(j.target.value)*oe.unit_price).toFixed(2))})),required:!0})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"rate",children:"Rate *"}),e.jsx(V,{id:"rate",type:"number",step:"0.01",min:"0.01",value:z.unit_price,onChange:j=>pe(oe=>({...oe,unit_price:Number(j.target.value),total_price:Number((oe.sold_units*Number(j.target.value)).toFixed(2))})),required:!0})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"total",children:"Total Amount"}),e.jsx(V,{id:"total",type:"number",step:"0.01",value:Number((z.sold_units*z.unit_price).toFixed(2)),readOnly:!0,className:"bg-gray-100"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(P,{htmlFor:"notes",children:"Remarks"}),e.jsx(V,{id:"notes",type:"text",value:z.notes||"",onChange:j=>pe(oe=>({...oe,notes:j.target.value}))})]})]}),e.jsx(He,{children:e.jsx(A,{type:"submit",disabled:ue.isPending||je.isPending,children:ue.isPending||je.isPending?e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"mr-2 h-4 w-4 animate-spin"}),"Savingâ€¦"]}):o?"Update Sales Record":"Add Sales Record"})})]})]})}),e.jsx(J,{children:e.jsxs(Z,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",$e+1," to ",Math.min(Je,be)," of ",be," records"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Records per page:"}),e.jsxs(te,{value:K.toString(),onValueChange:j=>S(Number(j)),children:[e.jsx(ee,{className:"w-[100px]",children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"50",children:"50"}),e.jsx(v,{value:"100",children:"100"}),e.jsx(v,{value:"500",children:"500"})]})]})]})]}),g.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 p-3 bg-muted rounded-md",children:[e.jsxs("span",{className:"text-sm font-medium",children:[g.length," selected"]}),e.jsx(A,{variant:"destructive",size:"sm",onClick:Ce,disabled:Te.isPending,children:"Delete Selected"}),e.jsx(A,{variant:"outline",size:"sm",onClick:ns,children:"Export Selected"})]}),e.jsx("div",{className:"border rounded-md",children:e.jsx("div",{className:"overflow-auto",style:{maxHeight:"600px"},children:e.jsx(Js,{data:C(ls.map(j=>((!j.date||j.date==="Invalid Date")&&console.warn("Invalid sales record date found:",{id:j.$id,date:j.date}),{...j,formattedDate:ca(j.date),channelName:q.find(oe=>oe.$id===j.sales_channel_id)?.channel_name||j.sales_channel_id,productName:G.find(oe=>oe.$id===j.product_id)?.product||j.product_id,totalAmount:Number((j.sold_units*j.unit_price).toFixed(2)),status:"Completed"}))),columns:[{key:"formattedDate",label:"Date",sortable:!0,dataType:"date"},{key:"channelName",label:"Sales Channel",sortable:!0,dataType:"string"},{key:"productName",label:"Product",sortable:!0,dataType:"string"},{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"sold_units",label:"Qty",sortable:!0,dataType:"number",align:"right",headerClassName:"bg-purple-50",cellClassName:"bg-purple-50 font-medium"},{key:"unit_price",label:"Rate",sortable:!0,dataType:"number",align:"right"},{key:"totalAmount",label:"Total Amount",sortable:!0,dataType:"number",align:"right",headerClassName:"bg-green-50",cellClassName:"bg-green-50 font-medium"},{key:"status",label:"Status",sortable:!0,dataType:"string",formatter:j=>e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${j==="Completed"?"bg-green-100 text-green-800":j==="In Progress"?"bg-yellow-100 text-yellow-800":j==="Pending"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:j})},{key:"notes",label:"Remarks",sortable:!0,dataType:"string"}],onSort:p,currentSort:F,loading:ie,maxHeight:"none",stickyHeader:!0,bordered:!1,searchable:!1,rowKey:"$id",selectable:!0,selectedRows:g,onSelectionChange:b,actions:[{label:"Edit",onClick:Ze,variant:"default"},{label:"Delete",onClick:j=>xe(j.$id),variant:"destructive"}],emptyMessage:"No sales records found"})})}),Se>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx(A,{variant:"outline",size:"sm",onClick:()=>Q(j=>Math.max(1,j-1)),disabled:_===1,children:"Previous"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",_," of ",Se]})}),e.jsx(A,{variant:"outline",size:"sm",onClick:()=>Q(j=>Math.min(Se,j+1)),disabled:_===Se,children:"Next"})]})]})})]})]})})}const Vl=()=>{const r=Fa(),s=[{title:"Stocks",description:"Manage inventory and stock levels",icon:Nt,path:"/master/stocks",color:"text-blue-600"},{title:"Vendors",description:"Manage supplier information",icon:Wr,path:"/master/vendors",color:"text-green-600"},{title:"Staff",description:"Manage employee records",icon:Gr,path:"/master/staff",color:"text-purple-600"},{title:"Processes",description:"Manage business processes",icon:Ea,path:"/master/processes",color:"text-orange-600"},{title:"Raw Products",description:"Manage raw materials",icon:Ta,path:"/master/raw-products",color:"text-red-600"},{title:"Products",description:"Manage finished products",icon:Ei,path:"/master/products",color:"text-indigo-600"},{title:"Sales Channels",description:"Manage sales channels",icon:Ri,path:"/master/sales-channels",color:"text-teal-600"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Master Data"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your core business data and configurations"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:s.map(t=>{const a=t.icon;return e.jsxs(J,{className:"hover:shadow-lg transition-shadow cursor-pointer",children:[e.jsxs(le,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(a,{className:`h-6 w-6 ${t.color}`}),e.jsx(ce,{className:"text-lg",children:t.title})]}),e.jsx(ve,{children:t.description})]}),e.jsx(Z,{children:e.jsxs(A,{onClick:()=>r(t.path),className:"w-full",variant:"outline",children:["Manage ",t.title]})})]},t.title)})})]})},Bl=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Analytics"}),e.jsx("p",{className:"text-muted-foreground",children:"Business intelligence and performance analytics"})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(J,{children:[e.jsx(le,{children:e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(ya,{className:"h-5 w-5 text-primary"}),"Production Analytics"]})}),e.jsx(Z,{children:e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"Production performance charts"}),e.jsx("p",{className:"text-sm",children:"Database connection required"})]})})]}),e.jsxs(J,{children:[e.jsx(le,{children:e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(It,{className:"h-5 w-5 text-primary"}),"Sales Trends"]})}),e.jsx(Z,{children:e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"Sales performance analysis"}),e.jsx("p",{className:"text-sm",children:"Database connection required"})]})})]}),e.jsxs(J,{children:[e.jsx(le,{children:e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(Ai,{className:"h-5 w-5 text-primary"}),"Inventory Distribution"]})}),e.jsx(Z,{children:e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"Stock distribution charts"}),e.jsx("p",{className:"text-sm",children:"Database connection required"})]})})]}),e.jsxs(J,{children:[e.jsx(le,{children:e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(qi,{className:"h-5 w-5 text-primary"}),"Efficiency Metrics"]})}),e.jsx(Z,{children:e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"Process efficiency analysis"}),e.jsx("p",{className:"text-sm",children:"Database connection required"})]})})]})]})]}),Hl=()=>{const r=Gs();return u.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",r.pathname)},[r.pathname]),e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-gray-100",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"mb-4 text-4xl font-bold",children:"404"}),e.jsx("p",{className:"mb-4 text-xl text-gray-600",children:"Oops! Page not found"}),e.jsx("a",{href:"/",className:"text-blue-500 underline hover:text-blue-700",children:"Return to Home"})]})})},zl=()=>{const[r,s]=u.useState(!1),[t,a]=u.useState(null),[n,i]=u.useState(""),{toast:l}=Ee(),m=is(),{user:c}=os(),{config:o}=bs("stocks"),{validationRules:d,canImport:g}=Ns("stocks"),{currentSort:b,handleSort:w,getSortedData:T}=Bs(),[L,f]=u.useState({stock_code:"",stock_name:"",category:"",uom:"",min_level:"",status:"Active"}),{data:N=[],isLoading:E,error:D}=he({queryKey:["stocks"],queryFn:async()=>await Fs.getAll(),enabled:!!c}),k=Ne({mutationFn:async F=>{const{stock_code:p,stock_name:C,category:G,uom:q,min_level:B}=F,U={stock_code:p,stock_name:C,category:G,uom:q,min_level:B},ie=await Fs.create(U);if(ie&&ie.$id)try{const ue=new Date().toISOString().split("T")[0];await vn.create({stock_id:ie.$id,opening_balance:0,purchases:0,used_in_production:0,status_date:ue})}catch(ue){console.error("Error creating stock status entry:",ue)}return ie},onSuccess:()=>{m.invalidateQueries({queryKey:["stocks"]}),m.invalidateQueries({queryKey:["stock_status"]}),l({title:"Success",description:"Stock created successfully"}),s(!1),a(null),S()},onError:F=>{l({title:"Error",description:"Failed to create stock",variant:"destructive"}),console.error("Error creating stock:",F)}}),$=Ne({mutationFn:async({id:F,data:p})=>{const{stock_code:C,name:G,category:q,uom:B,min_level:U}=p,ie={stock_code:C,stock_name:G,category:q,uom:B,min_level:U};return await Fs.update(F,ie)},onSuccess:()=>{m.invalidateQueries({queryKey:["stocks"]}),m.invalidateQueries({queryKey:["stock_status"]}),l({title:"Success",description:"Stock updated successfully"}),s(!1),a(null),S()},onError:F=>{l({title:"Error",description:"Failed to update stock",variant:"destructive"}),console.error("Error updating stock:",F)}}),H=Ne({mutationFn:F=>Fs.delete(F),onSuccess:()=>{m.invalidateQueries({queryKey:["stocks"]}),l({title:"Success",description:"Stock deleted successfully"})},onError:F=>{l({title:"Error",description:"Failed to delete stock",variant:"destructive"}),console.error("Error deleting stock:",F)}}),_=async F=>{if(F.preventDefault(),!L.stock_code.trim()){l({title:"Error",description:"Stock Code is required",variant:"destructive"});return}if(!L.stock_name?.trim()){l({title:"Error",description:"Stock Name is required",variant:"destructive"});return}if(!L.category.trim()){l({title:"Error",description:"Category is required",variant:"destructive"});return}if(!L.uom.trim()){l({title:"Error",description:"UoM is required",variant:"destructive"});return}if(!L.min_level.trim()){l({title:"Error",description:"Min Level is required",variant:"destructive"});return}const p={...L,min_level:L.min_level?parseFloat(L.min_level):void 0};t?$.mutate({id:t.$id,data:p}):k.mutate(p)},Q=F=>{a(F),f({stock_code:F.stock_code,stock_name:F.stock_name||"",category:F.category||"",uom:F.uom||"",min_level:F.min_level?.toString()||"",status:F.status}),s(!0)},K=async F=>{await requestDeletion("stock",F.$id,F.stock_name,()=>H.mutate(F.$id))},S=()=>{f({stock_code:"",stock_name:"",category:"",uom:"",min_level:"",status:"Active"})},h=()=>{a(null),S(),s(!0)},I=N.filter(F=>F.stock_name.toLowerCase().includes(n.toLowerCase())||F.stock_code.toLowerCase().includes(n.toLowerCase())||F.category.toLowerCase().includes(n.toLowerCase())),y=T(I);return D?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("p",{className:"text-red-500",children:["Error loading stocks: ",D.message]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Stocks"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage raw materials and stock items"})]}),e.jsxs(Qe,{open:r,onOpenChange:s,children:[e.jsx(ct,{asChild:!0,children:e.jsxs(A,{onClick:h,className:"bg-primary hover:bg-primary/90",children:[e.jsx(fs,{className:"h-4 w-4 mr-2"}),"Add New Stock"]})}),e.jsxs(Ve,{className:"sm:max-w-[425px]",children:[e.jsxs(Be,{children:[e.jsx(ze,{children:t?"Edit Stock":"Add New Stock"}),e.jsxs(Ye,{children:[t?"Update stock information":"Enter stock details to add a new stock",e.jsxs("span",{className:"mt-2 text-sm text-muted-foreground",children:["Fields marked with ",e.jsx("span",{className:"text-red-500",children:"*"})," are required."]})]})]}),e.jsxs("form",{onSubmit:_,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(P,{htmlFor:"stock_code",className:"text-right",children:["Stock Code ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(V,{id:"stock_code",value:L.stock_code,onChange:F=>f({...L,stock_code:F.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(P,{htmlFor:"stock_name",className:"text-right",children:["Stock Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(V,{id:"stock_name",value:L.stock_name,onChange:F=>f({...L,stock_name:F.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(P,{htmlFor:"category",className:"text-right",children:["Category ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(V,{id:"category",value:L.category,onChange:F=>f({...L,category:F.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(P,{htmlFor:"uom",className:"text-right",children:["UoM ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(te,{value:L.uom,onValueChange:F=>f({...L,uom:F}),children:[e.jsx(ee,{className:"col-span-3",children:e.jsx(ae,{placeholder:"Select unit of measure"})}),e.jsxs(se,{children:[e.jsx(v,{value:"kg",children:"kg"}),e.jsx(v,{value:"g",children:"g"}),e.jsx(v,{value:"ltr",children:"ltr"}),e.jsx(v,{value:"ml",children:"ml"}),e.jsx(v,{value:"pcs",children:"pcs"}),e.jsx(v,{value:"bags",children:"bags"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(P,{htmlFor:"min_level",className:"text-right",children:["Min Level ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(V,{id:"min_level",type:"number",step:"0.01",value:L.min_level,onChange:F=>f({...L,min_level:F.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(P,{htmlFor:"status",className:"text-right",children:"Status"}),e.jsxs(te,{value:L.status,onValueChange:F=>f({...L,status:F}),children:[e.jsx(ee,{className:"col-span-3",children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"Active",children:"Active"}),e.jsx(v,{value:"Inactive",children:"Inactive"})]})]})]})]}),e.jsx(He,{children:e.jsx(A,{type:"submit",disabled:k.isPending||$.isPending,children:k.isPending||$.isPending?"Saving...":t?"Update":"Create"})})]})]})]})]}),e.jsx(J,{children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ts,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(V,{placeholder:"Search stocks...",className:"pl-10",value:n,onChange:F=>i(F.target.value)})]}),e.jsxs(A,{variant:"outline",children:[e.jsx(Ks,{className:"h-4 w-4 mr-2"}),"Filter"]}),g&&e.jsx(gs,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:["Stock Name","SKU","Unit"],optionalColumns:["Category","Opening Balance"],validationRules:d,onImportComplete:F=>{F.successfulRows>0&&(m.invalidateQueries({queryKey:["stocks"]}),l({title:"Import Successful",description:`${F.successfulRows} stocks imported successfully.`}))}},variant:"outline"}),o&&e.jsx(xs,{data:I.map(F=>({name:F.stock_name,sku:F.stock_code,category:F.category,unit:F.uom,openingBalance:F.min_level||0,createdAt:F.$createdAt})),headers:o.exportColumns.map(F=>F.exportHeader),filename:"stocks",variant:"outline"})]})})}),e.jsxs(J,{children:[e.jsx(le,{children:e.jsxs(ce,{children:["Stock Items (",I.length,")"]})}),e.jsx(Z,{children:e.jsx(Js,{data:y.map(F=>({...F,stock_code:F.stock_code||"",stock_name:F.stock_name||"",category:F.category||"-",uom:F.uom||"-",min_level:F.min_level||0,status:F.status||"Active"})),columns:[{key:"stock_code",label:"Stock Code",sortable:!0,dataType:"string"},{key:"stock_name",label:"Stock Name",sortable:!0,dataType:"string"},{key:"category",label:"Category",sortable:!0,dataType:"string"},{key:"uom",label:"UoM",sortable:!0,dataType:"string"},{key:"min_level",label:"Min Level",sortable:!0,dataType:"number",align:"right"},{key:"status",label:"Status",sortable:!0,dataType:"string"}],onSort:w,currentSort:b,loading:E,emptyMessage:"No stocks found",actions:[{label:"Edit",icon:e.jsx(Vs,{className:"h-4 w-4"}),onClick:Q},{label:"Delete",icon:e.jsx(Ts,{className:"h-4 w-4"}),onClick:F=>K(F),variant:"destructive"}]})})]})]})},Hs=u.forwardRef(({className:r,...s},t)=>e.jsx("textarea",{className:re("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:t,...s}));Hs.displayName="Textarea";const Ql=()=>{const[r,s]=u.useState(""),[t,a]=u.useState("all"),[n,i]=u.useState(!1),[l,m]=u.useState(null),[c,o]=u.useState({vendor_name:"",contact_person:"",phone:"",email:"",address:"",gstin:"",status:"Active"}),{toast:d}=Ee(),g=is(),{config:b}=bs("vendors"),{validationRules:w,canImport:T}=Ns("vendors"),{data:L=[],isLoading:f,error:N}=he({queryKey:["vendors"],queryFn:async()=>await Pt.getAll()}),E=Ne({mutationFn:h=>{const{vendor_name:I,contact_person:y,phone:F,email:p,address:C,gstin:G}=h,q={vendor_name:I,contact_person:y||"",phone:F||"",address:C||"",gstin:G||""};return p&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(p)&&(q.email=p),Pt.create(q)},onSuccess:()=>{g.invalidateQueries({queryKey:["vendors"]}),d({title:"Success",description:"Vendor created successfully"}),i(!1),$()},onError:h=>{d({title:"Error",description:"Failed to create vendor",variant:"destructive"}),console.error("Error creating vendor:",h)}}),D=Ne({mutationFn:({id:h,data:I})=>{const{vendor_name:y,contact_person:F,phone:p,email:C,address:G,gstin:q}=I,B={vendor_name:y,contact_person:F||"",phone:p||"",address:G||"",gstin:q||""};return C&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(C)&&(B.email=C),Pt.update(h,B)},onSuccess:()=>{g.invalidateQueries({queryKey:["vendors"]}),d({title:"Success",description:"Vendor updated successfully"}),i(!1),$()},onError:h=>{d({title:"Error",description:"Failed to update vendor",variant:"destructive"}),console.error("Error updating vendor:",h)}}),k=Ne({mutationFn:h=>Pt.delete(h),onSuccess:()=>{g.invalidateQueries({queryKey:["vendors"]}),d({title:"Success",description:"Vendor deleted successfully"})},onError:h=>{d({title:"Error",description:"Failed to delete vendor",variant:"destructive"}),console.error("Error deleting vendor:",h)}}),$=()=>{o({vendor_name:"",contact_person:"",phone:"",email:"",address:"",gstin:"",status:"Active"}),m(null)},H=h=>{if(h.preventDefault(),!c.vendor_name.trim()){d({title:"Error",description:"Vendor Name is required",variant:"destructive"});return}if(!c.contact_person.trim()){d({title:"Error",description:"Contact Person is required",variant:"destructive"});return}if(c.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(c.email)){d({title:"Error",description:"Please enter a valid email address",variant:"destructive"});return}l?D.mutate({id:l.$id,data:c}):E.mutate(c)},_=h=>{m(h),o({vendor_name:h.vendor_name,contact_person:h.contact_person||"",phone:h.phone||"",email:h.email||"",address:h.address||"",gstin:h.gstin||"",status:h.status}),i(!0)},Q=h=>{confirm("Are you sure you want to delete this vendor?")&&k.mutate(h)},K=()=>{m(null),$(),i(!0)},S=L.filter(h=>{const I=h.vendor_name.toLowerCase().includes(r.toLowerCase())||h.contact_person?.toLowerCase().includes(r.toLowerCase())||h.email?.toLowerCase().includes(r.toLowerCase()),y=t==="all"||h.status===t;return I&&y});return N?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("p",{className:"text-red-500",children:["Error loading vendors: ",N.message]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Vendors"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage vendor information and relationships"})]}),e.jsxs(Qe,{open:n,onOpenChange:i,children:[e.jsx(ct,{asChild:!0,children:e.jsxs(A,{onClick:K,className:"bg-primary hover:bg-primary/90",children:[e.jsx(fs,{className:"h-4 w-4 mr-2"}),"Add New Vendor"]})}),e.jsxs(Ve,{className:"sm:max-w-[500px]",children:[e.jsxs(Be,{children:[e.jsx(ze,{children:l?"Edit Vendor":"Add New Vendor"}),e.jsxs(Ye,{children:[l?"Update vendor information":"Enter vendor details to add a new vendor",e.jsxs("p",{className:"mt-2 text-sm text-muted-foreground",children:["Fields marked with ",e.jsx("span",{className:"text-red-500",children:"*"})," are required."]})]})]}),e.jsxs("form",{onSubmit:H,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(P,{htmlFor:"vendor_name",className:"text-right",children:["Vendor Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(V,{id:"vendor_name",value:c.vendor_name,onChange:h=>o({...c,vendor_name:h.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(P,{htmlFor:"contact_person",className:"text-right",children:["Contact Person ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(V,{id:"contact_person",value:c.contact_person,onChange:h=>o({...c,contact_person:h.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(P,{htmlFor:"phone",className:"text-right",children:"Phone"}),e.jsx(V,{id:"phone",value:c.phone,onChange:h=>o({...c,phone:h.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(P,{htmlFor:"email",className:"text-right",children:"Email"}),e.jsx(V,{id:"email",type:"email",value:c.email,onChange:h=>o({...c,email:h.target.value}),className:"col-span-3",placeholder:"Optional"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(P,{htmlFor:"address",className:"text-right",children:"Address"}),e.jsx(Hs,{id:"address",value:c.address,onChange:h=>o({...c,address:h.target.value}),className:"col-span-3",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(P,{htmlFor:"gstin",className:"text-right",children:"GSTIN"}),e.jsx(V,{id:"gstin",value:c.gstin,onChange:h=>o({...c,gstin:h.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(P,{htmlFor:"status",className:"text-right",children:"Status"}),e.jsxs(te,{value:c.status,onValueChange:h=>o({...c,status:h}),children:[e.jsx(ee,{className:"col-span-3",children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"Active",children:"Active"}),e.jsx(v,{value:"Inactive",children:"Inactive"})]})]})]})]}),e.jsx(He,{children:e.jsx(A,{type:"submit",children:l?"Update":"Create"})})]})]})]})]}),e.jsx(J,{children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ts,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(V,{placeholder:"Search vendors...",className:"pl-10",value:r,onChange:h=>s(h.target.value)})]}),e.jsxs(A,{variant:"outline",children:[e.jsx(Ks,{className:"h-4 w-4 mr-2"}),"Filter"]}),T&&e.jsx(gs,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:["Vendor Name"],optionalColumns:["Email","Phone","Contact Person","Address"],validationRules:w,onImportComplete:h=>{h.successfulRows>0&&(g.invalidateQueries({queryKey:["vendors"]}),d({title:"Import Successful",description:`${h.successfulRows} vendors imported successfully.`}))}},variant:"outline"}),b&&e.jsx(xs,{data:S.map(h=>({name:h.vendor_name,email:h.email||"",phone:h.phone||"",contactPerson:h.contact_person||"",address:h.address||"",isActive:h.status==="Active",createdAt:h.$createdAt})),headers:b.exportColumns.map(h=>h.exportHeader),filename:"vendors",variant:"outline"})]})})}),e.jsxs(J,{children:[e.jsx(le,{children:e.jsxs(ce,{children:["Vendors (",S.length,")"]})}),e.jsx(Z,{children:f?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:e.jsx("span",{children:"Loading vendors..."})}):S.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("p",{className:"text-lg mb-2",children:"No vendors found"}),e.jsx("p",{className:"text-sm",children:"Add your first vendor to get started"})]}):e.jsxs(ds,{children:[e.jsx(us,{children:e.jsxs(we,{children:[e.jsx(X,{children:"Vendor Name"}),e.jsx(X,{children:"Contact Person"}),e.jsx(X,{children:"Phone"}),e.jsx(X,{children:"Email"}),e.jsx(X,{children:"Address"}),e.jsx(X,{children:"GSTIN"}),e.jsx(X,{children:"Status"}),e.jsx(X,{children:"Actions"})]})}),e.jsx(ms,{children:S.map(h=>e.jsxs(we,{children:[e.jsx(Y,{className:"font-medium",children:h.vendor_name}),e.jsx(Y,{children:h.contact_person||"-"}),e.jsx(Y,{children:h.phone||"-"}),e.jsx(Y,{children:h.email||"-"}),e.jsx(Y,{className:"max-w-xs truncate",children:h.address||"-"}),e.jsx(Y,{children:h.gstin||"-"}),e.jsx(Y,{children:e.jsx(qe,{variant:h.status==="Active"?"default":"secondary",children:h.status})}),e.jsx(Y,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(A,{variant:"outline",size:"sm",onClick:()=>_(h),children:e.jsx(Vs,{className:"h-4 w-4"})}),e.jsx(A,{variant:"outline",size:"sm",onClick:()=>Q(h.$id),children:e.jsx(Ts,{className:"h-4 w-4"})})]})})]},h.$id))})]})})]})]})},Yl=()=>{const[r,s]=u.useState(""),[t,a]=u.useState("all"),[n,i]=u.useState(!1),[l,m]=u.useState(null),[c,o]=u.useState({staff_code:"",staff_name:"",role:"",department:"",email:"",phone:"",joining_date:"",status:"Active"}),{toast:d}=Ee(),g=is(),{config:b}=bs("staff"),{validationRules:w,canImport:T}=Ns("staff"),{currentSort:L,handleSort:f,getSortedData:N}=Bs(),E={async getAll(){return(await Me.listDocuments(Ue,ge.STAFF)).documents},async create(p){return await Me.createDocument(Ue,ge.STAFF,rt.unique(),p)},async update(p,C){return await Me.updateDocument(Ue,ge.STAFF,p,C)},async delete(p){return await Me.deleteDocument(Ue,ge.STAFF,p)}},{data:D=[],isLoading:k,error:$}=he({queryKey:["staff"],queryFn:async()=>await E.getAll()}),H=Ne({mutationFn:p=>{const{staff_code:C,staff_name:G,role:q,department:B,phone:U,email:ie}=p,ue={staff_code:C,staff_name:G,role:q,department:B,phone:U||"",email:ie||""};return E.create(ue)},onSuccess:()=>{g.invalidateQueries({queryKey:["staff"]}),d({title:"Success",description:"Staff member created successfully"}),i(!1),K()},onError:p=>{d({title:"Error",description:"Failed to create staff member",variant:"destructive"}),console.error("Error creating staff:",p)}}),_=Ne({mutationFn:({id:p,data:C})=>{const{staff_code:G,staff_name:q,role:B,department:U,phone:ie,email:ue}=C,je={staff_code:G,staff_name:q,role:B,department:U,phone:ie||"",email:ue||""};return E.update(p,je)},onSuccess:()=>{g.invalidateQueries({queryKey:["staff"]}),d({title:"Success",description:"Staff member updated successfully"}),i(!1),K()},onError:p=>{d({title:"Error",description:"Failed to update staff member",variant:"destructive"}),console.error("Error updating staff:",p)}}),Q=Ne({mutationFn:p=>E.delete(p),onSuccess:()=>{g.invalidateQueries({queryKey:["staff"]}),d({title:"Success",description:"Staff member deleted successfully"})},onError:p=>{d({title:"Error",description:"Failed to delete staff member",variant:"destructive"}),console.error("Error deleting staff:",p)}}),K=()=>{o({staff_code:"",staff_name:"",role:"",department:"",email:"",phone:"",joining_date:"",status:"Active"}),m(null)},S=p=>{if(p.preventDefault(),!c.staff_code.trim()){d({title:"Error",description:"Staff Code is required",variant:"destructive"});return}if(!c.staff_name.trim()){d({title:"Error",description:"Staff Name is required",variant:"destructive"});return}if(!c.role.trim()){d({title:"Error",description:"Role is required",variant:"destructive"});return}if(!c.department.trim()){d({title:"Error",description:"Department is required",variant:"destructive"});return}if(c.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(c.email)){d({title:"Error",description:"Please enter a valid email address",variant:"destructive"});return}l?_.mutate({id:l.$id,data:c}):H.mutate(c)},h=p=>{m(p),o({staff_code:p.staff_code,staff_name:p.staff_name,role:p.role,department:p.department||"",email:p.email||"",phone:p.phone||"",joining_date:p.joining_date||"",status:p.status}),i(!0)},I=p=>{confirm("Are you sure you want to delete this staff member?")&&Q.mutate(p)},y=()=>{m(null),K(),i(!0)},F=D.filter(p=>{const C=p.staff_name.toLowerCase().includes(r.toLowerCase())||p.staff_code.toLowerCase().includes(r.toLowerCase())||p.role.toLowerCase().includes(r.toLowerCase())||p.department?.toLowerCase().includes(r.toLowerCase()),G=t==="all"||p.status===t;return C&&G});return N(F),$?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("p",{className:"text-red-500",children:["Error loading staff: ",$.message]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Staff"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage employee data and roles"})]}),e.jsxs(Qe,{open:n,onOpenChange:i,children:[e.jsx(ct,{asChild:!0,children:e.jsxs(A,{onClick:y,className:"bg-primary hover:bg-primary/90",children:[e.jsx(fs,{className:"h-4 w-4 mr-2"}),"Add New Staff"]})}),e.jsxs(Ve,{className:"sm:max-w-[500px]",children:[e.jsxs(Be,{children:[e.jsx(ze,{children:l?"Edit Staff":"Add New Staff"}),e.jsxs(Ye,{children:[l?"Update staff information":"Enter staff details to add a new employee",e.jsxs("p",{className:"mt-2 text-sm text-muted-foreground",children:["Fields marked with ",e.jsx("span",{className:"text-red-500",children:"*"})," are required."]})]})]}),e.jsxs("form",{onSubmit:S,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(P,{htmlFor:"staff_code",className:"text-right",children:["Staff Code ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(V,{id:"staff_code",value:c.staff_code,onChange:p=>o({...c,staff_code:p.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(P,{htmlFor:"staff_name",className:"text-right",children:["Staff Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(V,{id:"staff_name",value:c.staff_name,onChange:p=>o({...c,staff_name:p.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(P,{htmlFor:"role",className:"text-right",children:["Role ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(te,{value:c.role,onValueChange:p=>o({...c,role:p}),children:[e.jsx(ee,{className:"col-span-3",children:e.jsx(ae,{placeholder:"Select role"})}),e.jsxs(se,{children:[e.jsx(v,{value:"Manager",children:"Manager"}),e.jsx(v,{value:"Supervisor",children:"Supervisor"}),e.jsx(v,{value:"Operator",children:"Operator"}),e.jsx(v,{value:"Quality Controller",children:"Quality Controller"}),e.jsx(v,{value:"Warehouse Staff",children:"Warehouse Staff"}),e.jsx(v,{value:"Admin",children:"Admin"}),e.jsx(v,{value:"Accountant",children:"Accountant"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(P,{htmlFor:"department",className:"text-right",children:["Department ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(te,{value:c.department,onValueChange:p=>o({...c,department:p}),children:[e.jsx(ee,{className:"col-span-3",children:e.jsx(ae,{placeholder:"Select department"})}),e.jsxs(se,{children:[e.jsx(v,{value:"Production",children:"Production"}),e.jsx(v,{value:"Quality Control",children:"Quality Control"}),e.jsx(v,{value:"Warehouse",children:"Warehouse"}),e.jsx(v,{value:"Administration",children:"Administration"}),e.jsx(v,{value:"Accounts",children:"Accounts"}),e.jsx(v,{value:"Sales",children:"Sales"}),e.jsx(v,{value:"Purchase",children:"Purchase"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(P,{htmlFor:"email",className:"text-right",children:"Email"}),e.jsx(V,{id:"email",type:"email",value:c.email,onChange:p=>o({...c,email:p.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(P,{htmlFor:"phone",className:"text-right",children:"Phone"}),e.jsx(V,{id:"phone",value:c.phone,onChange:p=>o({...c,phone:p.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(P,{htmlFor:"joining_date",className:"text-right",children:"Joining Date"}),e.jsx(V,{id:"joining_date",type:"date",value:c.joining_date,onChange:p=>o({...c,joining_date:p.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(P,{htmlFor:"status",className:"text-right",children:"Status"}),e.jsxs(te,{value:c.status,onValueChange:p=>o({...c,status:p}),children:[e.jsx(ee,{className:"col-span-3",children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"Active",children:"Active"}),e.jsx(v,{value:"Inactive",children:"Inactive"})]})]})]})]}),e.jsx(He,{children:e.jsx(A,{type:"submit",children:l?"Update":"Create"})})]})]})]})]}),e.jsx(J,{children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ts,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(V,{placeholder:"Search staff...",className:"pl-10",value:r,onChange:p=>s(p.target.value)})]}),e.jsxs(A,{variant:"outline",children:[e.jsx(Ks,{className:"h-4 w-4 mr-2"}),"Filter"]}),T&&e.jsx(gs,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:["Staff Name","Email","Role"],optionalColumns:["Phone","Department"],validationRules:w,onImportComplete:p=>{p.successfulRows>0&&(g.invalidateQueries({queryKey:["staff"]}),d({title:"Import Successful",description:`${p.successfulRows} staff members imported successfully.`}))}},variant:"outline"}),b&&e.jsx(xs,{data:F.map(p=>({name:p.staff_name,email:p.email||"",phone:p.phone||"",role:p.role,department:p.department||"",isActive:p.status==="Active",createdAt:p.$createdAt})),headers:b.exportColumns.map(p=>p.exportHeader),filename:"staff",variant:"outline"})]})})}),e.jsxs(J,{children:[e.jsx(le,{children:e.jsxs(ce,{children:["Staff Members (",F.length,")"]})}),e.jsx(Z,{children:k?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:e.jsx("span",{children:"Loading staff..."})}):F.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("p",{className:"text-lg mb-2",children:"No staff found"}),e.jsx("p",{className:"text-sm",children:"Add your first staff member to get started"})]}):e.jsxs(ds,{children:[e.jsx(us,{children:e.jsxs(we,{children:[e.jsx(X,{children:"Staff Code"}),e.jsx(X,{children:"Staff Name"}),e.jsx(X,{children:"Role"}),e.jsx(X,{children:"Department"}),e.jsx(X,{children:"Email"}),e.jsx(X,{children:"Phone"}),e.jsx(X,{children:"Joining Date"}),e.jsx(X,{children:"Status"}),e.jsx(X,{children:"Actions"})]})}),e.jsx(ms,{children:F.map(p=>e.jsxs(we,{children:[e.jsx(Y,{className:"font-medium",children:p.staff_code}),e.jsx(Y,{children:p.staff_name}),e.jsx(Y,{children:p.role}),e.jsx(Y,{children:p.department||"-"}),e.jsx(Y,{children:p.email||"-"}),e.jsx(Y,{children:p.phone||"-"}),e.jsx(Y,{children:p.joining_date?new Date(p.joining_date).toLocaleDateString("en-GB"):"-"}),e.jsx(Y,{children:e.jsx(qe,{variant:p.status==="Active"?"default":"secondary",children:p.status})}),e.jsx(Y,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(A,{variant:"outline",size:"sm",onClick:()=>h(p),children:e.jsx(Vs,{className:"h-4 w-4"})}),e.jsx(A,{variant:"outline",size:"sm",onClick:()=>I(p.$id),children:e.jsx(Ts,{className:"h-4 w-4"})})]})})]},p.$id))})]})})]})]})},Wl=()=>{const[r,s]=u.useState(""),[t,a]=u.useState("all"),[n,i]=u.useState(!1),[l,m]=u.useState(null),[c,o]=u.useState({name:"",department:"",description:"",status:"Active"}),{toast:d}=Ee(),g=is(),{config:b}=bs("processes"),{validationRules:w,canImport:T}=Ns("processes"),L={async getAll(){return(await Me.listDocuments(Ue,ge.PROCESSES)).documents},async create(I){return await Me.createDocument(Ue,ge.PROCESSES,rt.unique(),I)},async update(I,y){return await Me.updateDocument(Ue,ge.PROCESSES,I,y)},async delete(I){return await Me.deleteDocument(Ue,ge.PROCESSES,I)}},{data:f=[],isLoading:N,error:E}=he({queryKey:["processes"],queryFn:async()=>await L.getAll()}),D=Ne({mutationFn:I=>{const{name:y,department:F}=I,p={process_name:y,department:F};return L.create(p)},onSuccess:()=>{g.invalidateQueries({queryKey:["processes"]}),d({title:"Success",description:"Process created successfully"}),i(!1),H()},onError:I=>{d({title:"Error",description:"Failed to create process",variant:"destructive"}),console.error("Error creating process:",I)}}),k=Ne({mutationFn:({id:I,data:y})=>{const{name:F,department:p}=y,C={process_name:F,department:p};return L.update(I,C)},onSuccess:()=>{g.invalidateQueries({queryKey:["processes"]}),d({title:"Success",description:"Process updated successfully"}),i(!1),H()},onError:I=>{d({title:"Error",description:"Failed to update process",variant:"destructive"}),console.error("Error updating process:",I)}}),$=Ne({mutationFn:I=>L.delete(I),onSuccess:()=>{g.invalidateQueries({queryKey:["processes"]}),d({title:"Success",description:"Process deleted successfully"})},onError:I=>{d({title:"Error",description:"Failed to delete process",variant:"destructive"}),console.error("Error deleting process:",I)}}),H=()=>{o({name:"",department:"",description:"",status:"Active"}),m(null)},_=I=>{if(I.preventDefault(),!c.name?.trim()){d({title:"Error",description:"Process Name is required",variant:"destructive"});return}if(!c.department.trim()){d({title:"Error",description:"Department is required",variant:"destructive"});return}l?k.mutate({id:l.$id,data:c}):D.mutate(c)},Q=I=>{m(I),o({name:I.process_name,department:I.department||"",description:I.description||"",status:I.status}),i(!0)},K=I=>{confirm("Are you sure you want to delete this process?")&&$.mutate(I)},S=()=>{m(null),H(),i(!0)},h=f.filter(I=>(I.process_name.toLowerCase().includes(r.toLowerCase())||I.department?.toLowerCase().includes(r.toLowerCase())||I.description?.toLowerCase().includes(r.toLowerCase()))&&(t==="all"||I.status===t));return E?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("p",{className:"text-red-500",children:["Error loading processes: ",E.message]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Processes"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage manufacturing and operational processes"})]}),e.jsxs(Qe,{open:n,onOpenChange:i,children:[e.jsx(ct,{asChild:!0,children:e.jsxs(A,{onClick:S,className:"bg-primary hover:bg-primary/90",children:[e.jsx(fs,{className:"h-4 w-4 mr-2"}),"Add New Process"]})}),e.jsxs(Ve,{className:"sm:max-w-[500px]",children:[e.jsxs(Be,{children:[e.jsx(ze,{children:l?"Edit Process":"Add New Process"}),e.jsxs(Ye,{children:[l?"Update process information":"Enter process details to add a new process",e.jsxs("span",{className:"mt-2 text-sm text-muted-foreground",children:["Fields marked with ",e.jsx("span",{className:"text-red-500",children:"*"})," are required."]})]})]}),e.jsxs("form",{onSubmit:_,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(P,{htmlFor:"name",className:"text-right",children:["Process Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(V,{id:"name",value:c.name,onChange:I=>o({...c,name:I.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(P,{htmlFor:"department",className:"text-right",children:["Department ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(te,{value:c.department||"",onValueChange:I=>o({...c,department:I}),children:[e.jsx(ee,{className:"col-span-3",children:e.jsx(ae,{placeholder:"Select department"})}),e.jsxs(se,{children:[e.jsx(v,{value:"Pre-Production",children:"Pre-Production"}),e.jsx(v,{value:"Production",children:"Production"}),e.jsx(v,{value:"Post Production",children:"Post Production"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-start gap-4",children:[e.jsx(P,{htmlFor:"description",className:"text-right mt-2",children:"Description"}),e.jsx(Hs,{id:"description",value:c.description,onChange:I=>o({...c,description:I.target.value}),className:"col-span-3",rows:3,placeholder:"Enter process description..."})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(P,{htmlFor:"status",className:"text-right",children:"Status"}),e.jsxs(te,{value:c.status,onValueChange:I=>o({...c,status:I}),children:[e.jsx(ee,{className:"col-span-3",children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"Active",children:"Active"}),e.jsx(v,{value:"Inactive",children:"Inactive"}),e.jsx(v,{value:"Under Review",children:"Under Review"})]})]})]})]}),e.jsx(He,{children:e.jsx(A,{type:"submit",children:l?"Update":"Create"})})]})]})]})]}),e.jsx(J,{children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ts,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(V,{placeholder:"Search processes...",className:"pl-10",value:r,onChange:I=>s(I.target.value)})]}),e.jsxs(A,{variant:"outline",children:[e.jsx(Ks,{className:"h-4 w-4 mr-2"}),"Filter"]}),T&&e.jsx(gs,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:["Process Name"],optionalColumns:["Description","Estimated Time (minutes)"],validationRules:w,onImportComplete:I=>{I.successfulRows>0&&(g.invalidateQueries({queryKey:["processes"]}),d({title:"Import Successful",description:`${I.successfulRows} processes imported successfully.`}))}},variant:"outline"}),b&&e.jsx(xs,{data:h.map(I=>({name:I.process_name,description:I.description||"",estimatedTime:0,isActive:I.status==="Active",createdAt:I.$createdAt})),headers:b.exportColumns.map(I=>I.exportHeader),filename:"processes",variant:"outline"})]})})}),e.jsxs(J,{children:[e.jsx(le,{children:e.jsxs(ce,{children:["Manufacturing Processes (",h.length,")"]})}),e.jsx(Z,{children:N?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:e.jsx("span",{children:"Loading processes..."})}):h.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("p",{className:"text-lg mb-2",children:"No processes found"}),e.jsx("p",{className:"text-sm",children:"Add your first process to get started"})]}):e.jsxs(ds,{children:[e.jsx(us,{children:e.jsxs(we,{children:[e.jsx(X,{children:"Process Name"}),e.jsx(X,{children:"Department"}),e.jsx(X,{children:"Description"}),e.jsx(X,{children:"Status"}),e.jsx(X,{children:"Actions"})]})}),e.jsx(ms,{children:h.map(I=>e.jsxs(we,{children:[e.jsx(Y,{className:"font-medium",children:I.process_name}),e.jsx(Y,{children:I.department||"-"}),e.jsx(Y,{className:"max-w-xs truncate",children:I.description||"-"}),e.jsx(Y,{children:e.jsx(qe,{variant:I.status==="Active"?"default":I.status==="Under Review"?"secondary":"outline",children:I.status})}),e.jsx(Y,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(A,{variant:"outline",size:"sm",onClick:()=>Q(I),children:e.jsx(Vs,{className:"h-4 w-4"})}),e.jsx(A,{variant:"outline",size:"sm",onClick:()=>K(I.$id),children:e.jsx(Ts,{className:"h-4 w-4"})})]})})]},I.$id))})]})})]})]})},Gl=()=>{const[r,s]=u.useState(""),[t,a]=u.useState("all"),[n,i]=u.useState(!1),[l,m]=u.useState(null),[c,o]=u.useState({code:"",raw_product:"",uom:"",source:"Manufactured",status:"Active"}),{toast:d}=Ee(),g=is(),{config:b}=bs("raw-products"),{validationRules:w,canImport:T}=Ns("raw-products"),{data:L=[],isLoading:f,error:N}=he({queryKey:["rawProducts"],queryFn:async()=>await pt.getAll()}),E=Ne({mutationFn:h=>{const{code:I,raw_product:y,uom:F,source:p}=h,C={code:I,raw_product:y,uom:F,source:p};return pt.create(C)},onSuccess:()=>{g.invalidateQueries({queryKey:["rawProducts"]}),d({title:"Success",description:"Raw product created successfully"}),i(!1),$()},onError:h=>{d({title:"Error",description:"Failed to create raw product",variant:"destructive"}),console.error("Error creating raw product:",h)}}),D=Ne({mutationFn:({id:h,data:I})=>{const{code:y,raw_product:F,uom:p,source:C}=I,G={code:y,raw_product:F,uom:p,source:C};return pt.update(h,G)},onSuccess:()=>{g.invalidateQueries({queryKey:["rawProducts"]}),d({title:"Success",description:"Raw product updated successfully"}),i(!1),$()},onError:h=>{d({title:"Error",description:"Failed to update raw product",variant:"destructive"}),console.error("Error updating raw product:",h)}}),k=Ne({mutationFn:h=>pt.delete(h),onSuccess:()=>{g.invalidateQueries({queryKey:["rawProducts"]}),d({title:"Success",description:"Raw product deleted successfully"})},onError:h=>{d({title:"Error",description:"Failed to delete raw product",variant:"destructive"}),console.error("Error deleting raw product:",h)}}),$=()=>{o({code:"",raw_product:"",uom:"",source:"Manufactured",status:"Active"}),m(null)},H=h=>{if(h.preventDefault(),!c.code.trim()){d({title:"Error",description:"Code is required",variant:"destructive"});return}if(!c.raw_product.trim()){d({title:"Error",description:"Raw Product is required",variant:"destructive"});return}if(!c.uom.trim()){d({title:"Error",description:"UoM is required",variant:"destructive"});return}if(!c.source.trim()){d({title:"Error",description:"Source is required",variant:"destructive"});return}l?D.mutate({id:l.$id,data:c}):E.mutate(c)},_=h=>{m(h),o({code:h.code,raw_product:h.raw_product,uom:h.uom||"",source:h.source||"Manufactured",status:h.status}),i(!0)},Q=h=>{window.confirm("Are you sure you want to delete this raw product?")&&k.mutate(h)},K=()=>{m(null),$(),i(!0)},S=L.filter(h=>{const I=h.raw_product.toLowerCase().includes(r.toLowerCase())||h.code.toLowerCase().includes(r.toLowerCase())||h.source?.toLowerCase().includes(r.toLowerCase()),y=t==="all"||h.status===t;return I&&y});return N?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("p",{className:"text-red-500",children:["Error loading raw products: ",N.message]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Raw Products"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage raw materials and ingredients"})]}),e.jsxs(Qe,{open:n,onOpenChange:i,children:[e.jsx(ct,{asChild:!0,children:e.jsxs(A,{onClick:K,className:"bg-primary hover:bg-primary/90",children:[e.jsx(fs,{className:"h-4 w-4 mr-2"}),"Add New Raw Product"]})}),e.jsxs(Ve,{className:"sm:max-w-[500px]",children:[e.jsxs(Be,{children:[e.jsx(ze,{children:l?"Edit Raw Product":"Add New Raw Product"}),e.jsxs(Ye,{children:[l?"Update raw product information":"Enter raw product details to add a new material",e.jsxs("p",{className:"mt-2 text-sm text-muted-foreground",children:["Fields marked with ",e.jsx("span",{className:"text-red-500",children:"*"})," are required."]})]})]}),e.jsxs("form",{onSubmit:H,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(P,{htmlFor:"code",className:"text-right",children:["Code ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(V,{id:"code",value:c.code,onChange:h=>o({...c,code:h.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(P,{htmlFor:"raw_product",className:"text-right",children:["Raw Product ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(V,{id:"raw_product",value:c.raw_product,onChange:h=>o({...c,raw_product:h.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(P,{htmlFor:"uom",className:"text-right",children:["UoM ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(te,{value:c.uom,onValueChange:h=>o({...c,uom:h}),children:[e.jsx(ee,{className:"col-span-3",children:e.jsx(ae,{placeholder:"Select unit of measure"})}),e.jsxs(se,{children:[e.jsx(v,{value:"kg",children:"Kilogram (kg)"}),e.jsx(v,{value:"g",children:"Gram (g)"}),e.jsx(v,{value:"l",children:"Liter (l)"}),e.jsx(v,{value:"ml",children:"Milliliter (ml)"}),e.jsx(v,{value:"pcs",children:"Pieces (pcs)"}),e.jsx(v,{value:"box",children:"Box"}),e.jsx(v,{value:"bag",children:"Bag"}),e.jsx(v,{value:"ton",children:"Ton"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(P,{htmlFor:"source",className:"text-right",children:["Source ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(te,{value:c.source,onValueChange:h=>o({...c,source:h}),children:[e.jsx(ee,{className:"col-span-3",children:e.jsx(ae,{placeholder:"Select source type"})}),e.jsxs(se,{children:[e.jsx(v,{value:"Manufactured",children:"Manufactured"}),e.jsx(v,{value:"Purchased",children:"Purchased"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(P,{htmlFor:"status",className:"text-right",children:"Status"}),e.jsxs(te,{value:c.status,onValueChange:h=>o({...c,status:h}),children:[e.jsx(ee,{className:"col-span-3",children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"Active",children:"Active"}),e.jsx(v,{value:"Inactive",children:"Inactive"}),e.jsx(v,{value:"Discontinued",children:"Discontinued"})]})]})]})]}),e.jsx(He,{children:e.jsx(A,{type:"submit",children:l?"Update":"Create"})})]})]})]})]}),e.jsx(J,{children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ts,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(V,{placeholder:"Search raw products...",className:"pl-10",value:r,onChange:h=>s(h.target.value)})]}),e.jsxs(A,{variant:"outline",children:[e.jsx(Ks,{className:"h-4 w-4 mr-2"}),"Filter"]}),T&&e.jsx(gs,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:["Raw Product Name","SKU","Unit"],optionalColumns:["Cost Per Unit","Description"],validationRules:w,onImportComplete:h=>{h.successfulRows>0&&(g.invalidateQueries({queryKey:["rawProducts"]}),d({title:"Import Successful",description:`${h.successfulRows} raw products imported successfully.`}))}},variant:"outline"}),b&&e.jsx(xs,{data:S.map(h=>({name:h.raw_product,sku:h.code,unit:h.uom||"",costPerUnit:0,description:"",createdAt:h.$createdAt})),headers:b.exportColumns.map(h=>h.exportHeader),filename:"raw-products",variant:"outline"})]})})}),e.jsxs(J,{children:[e.jsx(le,{children:e.jsxs(ce,{children:["Raw Materials (",S.length,")"]})}),e.jsx(Z,{children:f?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:e.jsx("span",{children:"Loading raw products..."})}):S.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("p",{className:"text-lg mb-2",children:"No raw products found"}),e.jsx("p",{className:"text-sm",children:"Add your first raw product to get started"})]}):e.jsxs(ds,{children:[e.jsx(us,{children:e.jsxs(we,{children:[e.jsx(X,{children:"Code"}),e.jsx(X,{children:"Raw Product"}),e.jsx(X,{children:"UoM"}),e.jsx(X,{children:"Source"}),e.jsx(X,{children:"Status"}),e.jsx(X,{children:"Actions"})]})}),e.jsx(ms,{children:S.map(h=>e.jsxs(we,{children:[e.jsx(Y,{className:"font-medium",children:h.code}),e.jsx(Y,{children:h.raw_product}),e.jsx(Y,{children:h.uom||"-"}),e.jsx(Y,{children:h.source&&e.jsx(qe,{variant:h.source==="Manufactured"?"default":"secondary",children:h.source})}),e.jsx(Y,{children:e.jsx(qe,{variant:h.status==="Active"?"default":h.status==="Discontinued"?"destructive":"secondary",children:h.status})}),e.jsx(Y,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(A,{variant:"outline",size:"sm",onClick:()=>_(h),children:e.jsx(Vs,{className:"h-4 w-4"})}),e.jsx(A,{variant:"outline",size:"sm",onClick:()=>Q(h.$id),children:e.jsx(Ts,{className:"h-4 w-4"})})]})})]},h.$id))})]})})]})]})},Jl=()=>{const[r,s]=u.useState(""),[t,a]=u.useState("all"),[n,i]=u.useState(!1),[l,m]=u.useState(null),[c,o]=u.useState({sku:"",name:"",uom:"",min_level:"",status:"Active"}),{toast:d}=Ee(),g=is(),{user:b}=os(),{config:w}=bs("products"),{validationRules:T,canImport:L}=Ns("products"),{currentSort:f,handleSort:N,getSortedData:E}=Bs(),{data:D=[],isLoading:k,error:$}=he({queryKey:["products"],queryFn:async()=>await Is.getAll(),enabled:!!b}),H=Ne({mutationFn:C=>{const{sku:G,name:q,uom:B,min_level:U}=C,ie={sku:G,product:q,uom:B,min_level:U};return Is.create(ie)},onSuccess:()=>{g.invalidateQueries({queryKey:["products"]}),d({title:"Success",description:"Product created successfully"}),i(!1),K()},onError:C=>{d({title:"Error",description:"Failed to create product",variant:"destructive"}),console.error("Error creating product:",C)}}),_=Ne({mutationFn:({id:C,data:G})=>{const{sku:q,name:B,uom:U,min_level:ie}=G,ue={sku:q,product:B,uom:U,min_level:ie};return Is.update(C,ue)},onSuccess:()=>{g.invalidateQueries({queryKey:["products"]}),d({title:"Success",description:"Product updated successfully"}),i(!1),K()},onError:C=>{d({title:"Error",description:"Failed to update product",variant:"destructive"}),console.error("Error updating product:",C)}}),Q=Ne({mutationFn:C=>Is.delete(C),onSuccess:()=>{g.invalidateQueries({queryKey:["products"]}),d({title:"Success",description:"Product deleted successfully"})},onError:C=>{d({title:"Error",description:"Failed to delete product",variant:"destructive"}),console.error("Error deleting product:",C)}}),K=()=>{o({sku:"",name:"",uom:"",min_level:"",status:"Active"}),m(null)},S=C=>{if(C.preventDefault(),!c.sku?.trim()){d({title:"Error",description:"SKU is required",variant:"destructive"});return}if(!c.name?.trim()){d({title:"Error",description:"Product Name is required",variant:"destructive"});return}if(!c.uom?.trim()){d({title:"Error",description:"Unit of Measure is required",variant:"destructive"});return}if(!c.min_level?.trim()){d({title:"Error",description:"Minimum Level is required",variant:"destructive"});return}const G={...c,min_level:c.min_level?parseInt(c.min_level):void 0};l?_.mutate({id:l.$id,data:G}):H.mutate(G)},h=C=>{m(C),o({sku:C.sku,name:C.product,uom:C.uom||"",min_level:C.min_level?.toString()||"",status:C.status}),i(!0)},I=C=>{confirm("Are you sure you want to delete this product?")&&Q.mutate(C)},y=()=>{m(null),K(),i(!0)},F=D.filter(C=>{const G=C.product.toLowerCase().includes(r.toLowerCase())||C.sku.toLowerCase().includes(r.toLowerCase()),q=t==="all"||C.status===t;return G&&q}),p=E(F);return $?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("p",{className:"text-red-500",children:["Error loading products: ",$.message]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Products"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage finished products and inventory"})]}),e.jsxs(Qe,{open:n,onOpenChange:i,children:[e.jsx(ct,{asChild:!0,children:e.jsxs(A,{onClick:y,className:"bg-primary hover:bg-primary/90",children:[e.jsx(fs,{className:"h-4 w-4 mr-2"}),"Add New Product"]})}),e.jsxs(Ve,{className:"sm:max-w-[500px]",children:[e.jsxs(Be,{children:[e.jsx(ze,{children:l?"Edit Product":"Add New Product"}),e.jsxs(Ye,{children:[l?"Update product information":"Enter product details to add a new finished product",e.jsxs("span",{className:"mt-2 text-sm text-muted-foreground",children:["Fields marked with ",e.jsx("span",{className:"text-red-500",children:"*"})," are required."]})]})]}),e.jsxs("form",{onSubmit:S,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(P,{htmlFor:"sku",className:"text-right",children:["SKU ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(V,{id:"sku",value:c.sku,onChange:C=>o({...c,sku:C.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(P,{htmlFor:"product",className:"text-right",children:["Product ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(V,{id:"product",value:c.name,onChange:C=>o({...c,name:C.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(P,{htmlFor:"uom",className:"text-right",children:["UoM ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(te,{value:c.uom,onValueChange:C=>o({...c,uom:C}),children:[e.jsx(ee,{className:"col-span-3",children:e.jsx(ae,{placeholder:"Select unit of measure"})}),e.jsxs(se,{children:[e.jsx(v,{value:"kg",children:"Kilogram (kg)"}),e.jsx(v,{value:"g",children:"Gram (g)"}),e.jsx(v,{value:"l",children:"Liter (l)"}),e.jsx(v,{value:"ml",children:"Milliliter (ml)"}),e.jsx(v,{value:"pcs",children:"Pieces (pcs)"}),e.jsx(v,{value:"box",children:"Box"}),e.jsx(v,{value:"pack",children:"Pack"}),e.jsx(v,{value:"bottle",children:"Bottle"}),e.jsx(v,{value:"can",children:"Can"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(P,{htmlFor:"min_level",className:"text-right",children:["Min Level ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(V,{id:"min_level",type:"number",value:c.min_level,onChange:C=>o({...c,min_level:C.target.value}),className:"col-span-3",min:"0",placeholder:"Minimum stock level"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(P,{htmlFor:"status",className:"text-right",children:"Status"}),e.jsxs(te,{value:c.status,onValueChange:C=>o({...c,status:C}),children:[e.jsx(ee,{className:"col-span-3",children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"Active",children:"Active"}),e.jsx(v,{value:"Inactive",children:"Inactive"}),e.jsx(v,{value:"Discontinued",children:"Discontinued"})]})]})]})]}),e.jsx(He,{children:e.jsx(A,{type:"submit",children:l?"Update":"Create"})})]})]})]})]}),e.jsx(J,{children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ts,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(V,{placeholder:"Search products...",className:"pl-10",value:r,onChange:C=>s(C.target.value)})]}),e.jsxs(A,{variant:"outline",children:[e.jsx(Ks,{className:"h-4 w-4 mr-2"}),"Filter"]}),L&&e.jsx(gs,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:["Product Name","SKU"],optionalColumns:["Category","Price","Description"],validationRules:T,onImportComplete:C=>{C.successfulRows>0&&(g.invalidateQueries({queryKey:["products"]}),d({title:"Import Successful",description:`${C.successfulRows} products imported successfully.`}))}},variant:"outline"}),w&&e.jsx(xs,{data:F.map(C=>({name:C.product,sku:C.sku,category:"",price:0,description:"",isActive:C.status==="Active",createdAt:C.$createdAt})),headers:w.exportColumns.map(C=>C.exportHeader),filename:"products",variant:"outline"})]})})}),e.jsxs(J,{children:[e.jsx(le,{children:e.jsxs(ce,{children:["Finished Products (",F.length,")"]})}),e.jsx(Z,{children:e.jsx(Js,{data:p.map(C=>({...C,sku:C.sku||"",product:C.product||"",uom:C.uom||"-",min_level:C.min_level||0,status:C.status||"Active"})),columns:[{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"product",label:"Product Name",sortable:!0,dataType:"string"},{key:"uom",label:"UoM",sortable:!0,dataType:"string"},{key:"min_level",label:"Min Level",sortable:!0,dataType:"number",align:"right"},{key:"status",label:"Status",sortable:!0,dataType:"string"}],onSort:N,currentSort:f,loading:k,emptyMessage:"No products found",actions:[{label:"Edit",icon:e.jsx(Vs,{className:"h-4 w-4"}),onClick:h},{label:"Delete",icon:e.jsx(Ts,{className:"h-4 w-4"}),onClick:C=>I(C.$id),variant:"destructive"}]})})]})]})},Xl=()=>{const[r,s]=u.useState(""),[t,a]=u.useState("all"),[n,i]=u.useState(!1),[l,m]=u.useState(null),[c,o]=u.useState({channel_name:"",description:"",type:"Online",contact_person:"",phone:"",email:"",status:"Active"}),{toast:d}=Ee(),g=is(),{config:b}=bs("sales-channels"),{validationRules:w,canImport:T}=Ns("sales-channels"),{data:L=[],isLoading:f,error:N}=he({queryKey:["salesChannels"],queryFn:async()=>await Tt.getAll()}),E=Ne({mutationFn:h=>{const{channel_name:I,type:y,email:F}=h,p={channel_name:I,type:y};return F&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(F)&&(p.email=F),Tt.create(p)},onSuccess:()=>{g.invalidateQueries({queryKey:["salesChannels"]}),d({title:"Success",description:"Sales channel created successfully"}),i(!1),$()},onError:h=>{d({title:"Error",description:"Failed to create sales channel",variant:"destructive"}),console.error("Error creating sales channel:",h)}}),D=Ne({mutationFn:({id:h,data:I})=>{const{channel_name:y,type:F,email:p}=I,C={channel_name:y,type:F};return p&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(p)&&(C.email=p),Tt.update(h,C)},onSuccess:()=>{g.invalidateQueries({queryKey:["salesChannels"]}),d({title:"Success",description:"Sales channel updated successfully"}),i(!1),$()},onError:h=>{d({title:"Error",description:"Failed to update sales channel",variant:"destructive"}),console.error("Error updating sales channel:",h)}}),k=Ne({mutationFn:h=>Tt.delete(h),onSuccess:()=>{g.invalidateQueries({queryKey:["salesChannels"]}),d({title:"Success",description:"Sales channel deleted successfully"})},onError:h=>{d({title:"Error",description:"Failed to delete sales channel",variant:"destructive"}),console.error("Error deleting sales channel:",h)}}),$=()=>{o({channel_name:"",description:"",type:"Online",contact_person:"",phone:"",email:"",status:"Active"}),m(null)},H=h=>{if(h.preventDefault(),!c.channel_name.trim()){d({title:"Error",description:"Channel Name is required",variant:"destructive"});return}if(!c.type.trim()){d({title:"Error",description:"Type is required",variant:"destructive"});return}if(c.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(c.email)){d({title:"Error",description:"Please enter a valid email address",variant:"destructive"});return}l?D.mutate({id:l.$id,data:c}):E.mutate(c)},_=h=>{m(h),o({channel_name:h.channel_name,description:h.description||"",type:h.type||"Online",contact_person:h.contact_person||"",phone:h.phone||"",email:h.email||"",status:h.status}),i(!0)},Q=h=>{confirm("Are you sure you want to delete this sales channel?")&&k.mutate(h)},K=()=>{m(null),$(),i(!0)},S=L.filter(h=>{const I=h.channel_name.toLowerCase().includes(r.toLowerCase())||h.type?.toLowerCase().includes(r.toLowerCase())||h.contact_person?.toLowerCase().includes(r.toLowerCase()),y=t==="all"||h.status===t;return I&&y});return N?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("p",{className:"text-red-500",children:["Error loading sales channels: ",N.message]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Sales Channels"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage sales distribution channels and partners"})]}),e.jsxs(Qe,{open:n,onOpenChange:i,children:[e.jsx(ct,{asChild:!0,children:e.jsxs(A,{onClick:K,className:"bg-primary hover:bg-primary/90",children:[e.jsx(fs,{className:"h-4 w-4 mr-2"}),"Add New Channel"]})}),e.jsxs(Ve,{className:"sm:max-w-[500px]",children:[e.jsxs(Be,{children:[e.jsx(ze,{children:l?"Edit Sales Channel":"Add New Sales Channel"}),e.jsxs(Ye,{children:[l?"Update sales channel information":"Enter sales channel details to add a new distribution partner",e.jsxs("p",{className:"mt-2 text-sm text-muted-foreground",children:["Fields marked with ",e.jsx("span",{className:"text-red-500",children:"*"})," are required."]})]})]}),e.jsxs("form",{onSubmit:H,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(P,{htmlFor:"channel_name",className:"text-right",children:["Channel Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(V,{id:"channel_name",value:c.channel_name,onChange:h=>o({...c,channel_name:h.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-start gap-4",children:[e.jsx(P,{htmlFor:"description",className:"text-right mt-2",children:"Description"}),e.jsx(Hs,{id:"description",value:c.description,onChange:h=>o({...c,description:h.target.value}),className:"col-span-3",rows:3,placeholder:"Enter channel description..."})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(P,{htmlFor:"type",className:"text-right",children:["Type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(te,{value:c.type,onValueChange:h=>o({...c,type:h}),children:[e.jsx(ee,{className:"col-span-3",children:e.jsx(ae,{placeholder:"Select channel type"})}),e.jsxs(se,{children:[e.jsx(v,{value:"Online",children:"Online"}),e.jsx(v,{value:"Retail",children:"Retail"}),e.jsx(v,{value:"Wholesale",children:"Wholesale"}),e.jsx(v,{value:"Direct Sales",children:"Direct Sales"}),e.jsx(v,{value:"Distributor",children:"Distributor"}),e.jsx(v,{value:"E-commerce",children:"E-commerce"}),e.jsx(v,{value:"Export",children:"Export"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(P,{htmlFor:"contact_person",className:"text-right",children:"Contact Person"}),e.jsx(V,{id:"contact_person",value:c.contact_person,onChange:h=>o({...c,contact_person:h.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(P,{htmlFor:"phone",className:"text-right",children:"Phone"}),e.jsx(V,{id:"phone",value:c.phone,onChange:h=>o({...c,phone:h.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(P,{htmlFor:"email",className:"text-right",children:"Email"}),e.jsx(V,{id:"email",type:"email",value:c.email,onChange:h=>o({...c,email:h.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(P,{htmlFor:"status",className:"text-right",children:"Status"}),e.jsxs(te,{value:c.status,onValueChange:h=>o({...c,status:h}),children:[e.jsx(ee,{className:"col-span-3",children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"Active",children:"Active"}),e.jsx(v,{value:"Inactive",children:"Inactive"}),e.jsx(v,{value:"Pending",children:"Pending"})]})]})]})]}),e.jsx(He,{children:e.jsx(A,{type:"submit",children:l?"Update":"Create"})})]})]})]})]}),e.jsx(J,{children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ts,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(V,{placeholder:"Search sales channels...",className:"pl-10",value:r,onChange:h=>s(h.target.value)})]}),e.jsxs(A,{variant:"outline",children:[e.jsx(Ks,{className:"h-4 w-4 mr-2"}),"Filter"]}),T&&e.jsx(gs,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:["Channel Name","Type"],optionalColumns:["Commission (%)","Description"],validationRules:w,onImportComplete:h=>{h.successfulRows>0&&(g.invalidateQueries({queryKey:["salesChannels"]}),d({title:"Import Successful",description:`${h.successfulRows} sales channels imported successfully.`}))}},variant:"outline"}),b&&e.jsx(xs,{data:S.map(h=>({name:h.channel_name,type:h.type||"",commission:0,description:h.description||"",isActive:h.status==="Active",createdAt:h.$createdAt})),headers:b.exportColumns.map(h=>h.exportHeader),filename:"sales-channels",variant:"outline"})]})})}),e.jsxs(J,{children:[e.jsx(le,{children:e.jsxs(ce,{children:["Distribution Channels (",S.length,")"]})}),e.jsx(Z,{children:f?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:e.jsx("span",{children:"Loading sales channels..."})}):S.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("p",{className:"text-lg mb-2",children:"No sales channels found"}),e.jsx("p",{className:"text-sm",children:"Add your first sales channel to get started"})]}):e.jsxs(ds,{children:[e.jsx(us,{children:e.jsxs(we,{children:[e.jsx(X,{children:"Channel Name"}),e.jsx(X,{children:"Description"}),e.jsx(X,{children:"Type"}),e.jsx(X,{children:"Contact Person"}),e.jsx(X,{children:"Phone"}),e.jsx(X,{children:"Email"}),e.jsx(X,{children:"Status"}),e.jsx(X,{children:"Actions"})]})}),e.jsx(ms,{children:S.map(h=>e.jsxs(we,{children:[e.jsx(Y,{className:"font-medium",children:h.channel_name}),e.jsx(Y,{className:"max-w-xs truncate",children:h.description||"-"}),e.jsx(Y,{children:h.type&&e.jsx(qe,{variant:"outline",children:h.type})}),e.jsx(Y,{children:h.contact_person||"-"}),e.jsx(Y,{children:h.phone||"-"}),e.jsx(Y,{children:h.email||"-"}),e.jsx(Y,{children:e.jsx(qe,{variant:h.status==="Active"?"default":h.status==="Pending"?"secondary":"outline",children:h.status})}),e.jsx(Y,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(A,{variant:"outline",size:"sm",onClick:()=>_(h),children:e.jsx(Vs,{className:"h-4 w-4"})}),e.jsx(A,{variant:"outline",size:"sm",onClick:()=>Q(h.$id),children:e.jsx(Ts,{className:"h-4 w-4"})})]})})]},h.$id))})]})})]})]})},En=(r,s,t={})=>{const{category:a,searchTerm:n}=t,i=r?At(r,1):void 0,l=r?Xe(r,"yyyy-MM-dd"):void 0,m=s?Xe(s,"yyyy-MM-dd"):void 0,c=i?Xe(i,"yyyy-MM-dd"):void 0,{data:o=[],isLoading:d}=he({queryKey:["stocks"],queryFn:()=>Fs.getAll(),staleTime:10*60*1e3}),{data:g=[],isLoading:b}=he({queryKey:["processes"],queryFn:()=>lt.getAll(),staleTime:10*60*1e3}),{data:w=[],isLoading:T}=he({queryKey:["purchases",l,m],queryFn:()=>zs.getByDateRange(r,s),enabled:!!r&&!!s,staleTime:5*60*1e3}),{data:L=[]}=he({queryKey:["purchasesBefore",c],queryFn:()=>zs.getByDateRange(void 0,i),enabled:!!i,staleTime:5*60*1e3}),{data:f=[],isLoading:N}=he({queryKey:["cleaning-tasks",l,m],queryFn:async()=>(await Ws.getByDateRange(r,s)).filter(H=>(H.process_name?.toLowerCase()||"").includes("cleaning")),enabled:!!r&&!!s,staleTime:5*60*1e3}),{data:E=[]}=he({queryKey:["cleaning-tasksBefore",c],queryFn:async()=>(await Ws.getByDateRange(void 0,i)).filter(H=>(H.process_name?.toLowerCase()||"").includes("cleaning")),enabled:!!i,staleTime:5*60*1e3});return{stockStatus:u.useMemo(()=>o.length?o.filter($=>{if(a&&a!=="all"&&($.category||$.Category)!==a)return!1;if(n){const H=n.toLowerCase();if(!($.stock_name?.toLowerCase()||"").includes(H))return!1}return!0}).map($=>{const H=L.filter(F=>F.stock_id===$.$id).reduce((F,p)=>F+(Number(p.quantity)||0),0),_=E.filter(F=>F.stock_id===$.$id&&F.status==="completed").reduce((F,p)=>F+(Number(p.assigned_quantity)||0),0),Q=H-_,K=w.filter(F=>F.stock_id===$.$id).reduce((F,p)=>F+(Number(p.quantity)||0),0),S=f.filter(F=>F.stock_id===$.$id&&F.status==="completed").reduce((F,p)=>F+(Number(p.assigned_quantity)||0),0),h=Q+K-S,I=$.min_level||0;let y="In Stock";return h<=0?y="Out of Stock":h<I&&(y="Low Stock"),{stock_id:$.$id,stock_name:$.stock_name,category:$.category||$.Category,opening_balance:Q,purchases:K,utilised:S,closing_balance:h,min_level:I,status:y}}):[],[o,w,L,f,E,a,n]),isLoading:d||b||T||N,error:null}},Zl=()=>{const{data:r,isLoading:s,error:t}=he({queryKey:["stock-categories"],queryFn:()=>Fs.getCategories()});return{categories:r,isLoading:s,error:t}},ec=()=>{const[r,s]=u.useState({from:Us(new Date),to:Os(new Date)}),[t,a]=u.useState(void 0),[n,i]=u.useState(""),{toast:l}=Ee(),m=is(),{stockStatus:c,isLoading:o}=En(r?.from,r?.to,{category:t,searchTerm:n}),{categories:d}=Zl(),g=async()=>{try{await m.invalidateQueries({queryKey:["stocks"]}),await m.invalidateQueries({queryKey:["purchases"]}),await m.invalidateQueries({queryKey:["tasks"]}),l({title:"Stock Data Refreshed",description:"Data updated successfully"})}catch{l({title:"Refresh Failed",description:"Please try again",variant:"destructive"})}};return e.jsxs(J,{children:[e.jsxs(le,{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(ce,{children:"Stock Status"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(A,{variant:"outline",onClick:g,disabled:o,children:[e.jsx(Pa,{className:`h-4 w-4 mr-1 ${o?"animate-spin":""}`}),"Refresh Data"]}),e.jsx(A,{variant:"outline",children:"Export"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-4",children:[e.jsx(St,{value:r,onChange:s,className:"w-[300px]"}),e.jsxs(te,{onValueChange:a,value:t,children:[e.jsx(ee,{className:"w-[180px]",children:e.jsx(ae,{placeholder:"All Categories"})}),e.jsxs(se,{children:[e.jsx(v,{value:"all",children:"All Categories"}),d?.map(b=>e.jsx(v,{value:b,children:b},b))]})]}),e.jsx(V,{placeholder:"Search...",className:"w-[200px]",value:n,onChange:b=>i(b.target.value)})]})]}),e.jsx(Z,{children:e.jsxs(ds,{children:[e.jsx(us,{children:e.jsxs(we,{children:[e.jsx(X,{children:"Stock Name"}),e.jsx(X,{children:"Category"}),e.jsx(X,{className:"text-right",children:"Opening Balance"}),e.jsx(X,{className:"text-right bg-purple-50",children:"Purchases"}),e.jsx(X,{className:"text-right bg-green-50",children:"Utilised"}),e.jsx(X,{className:"text-right",children:"Closing Balance"}),e.jsx(X,{className:"text-right",children:"Min Level"}),e.jsx(X,{children:"Status"})]})}),e.jsx(ms,{children:o?e.jsx(we,{children:e.jsxs(Y,{colSpan:8,className:"text-center py-12",children:[e.jsx(Re,{className:"h-8 w-8 animate-spin mx-auto mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading stock status..."})]})}):c.length===0?e.jsx(we,{children:e.jsx(Y,{colSpan:8,className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"No stock data found for the selected criteria"})})}):c.map((b,w)=>e.jsxs(we,{children:[e.jsx(Y,{children:b.stock_name}),e.jsx(Y,{children:b.category||"N/A"}),e.jsx(Y,{className:"text-right",children:(b.opening_balance||0).toLocaleString()}),e.jsx(Y,{className:"text-right bg-purple-50 font-medium",children:(b.purchases||0).toLocaleString()}),e.jsx(Y,{className:"text-right bg-green-50 font-medium",children:(b.utilised||0).toLocaleString()}),e.jsx(Y,{className:"text-right font-semibold",children:e.jsx("span",{className:(b.closing_balance||0)<0?"text-red-600":"text-green-600",children:(b.closing_balance||0).toLocaleString()})}),e.jsx(Y,{className:"text-right text-muted-foreground",children:(b.min_level||0).toLocaleString()}),e.jsx(Y,{children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${b.status==="Out of Stock"?"bg-red-100 text-red-800":b.status==="Low Stock"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:b.status||"In Stock"})})]},b.stock_id||`stock-${w}`))})]})})]})},$a=(r,s,t={})=>{const{processId:a}=t,n=r?As(r):void 0,i=s?As(s):void 0,l=n?At(n,1):void 0,m=n?Xe(n,"yyyy-MM-dd"):void 0,c=i?Xe(i,"yyyy-MM-dd"):void 0,o=l?Xe(l,"yyyy-MM-dd"):void 0,{data:d=[],isLoading:g}=he({queryKey:["stocks"],queryFn:()=>Fs.getAll(),staleTime:10*60*1e3}),{data:b=[],isLoading:w}=he({queryKey:["processes"],queryFn:()=>lt.getAll(),staleTime:10*60*1e3}),{data:T=[],isLoading:L}=he({queryKey:["preProductionTasks",m,c],queryFn:()=>Ws.getByDateRange(n,i),enabled:!!n&&!!i,staleTime:5*60*1e3}),{data:f=[]}=he({queryKey:["preProductionTasksBefore",o],queryFn:()=>Ws.getByDateRange(void 0,l),enabled:!!l,staleTime:5*60*1e3}),{data:N=[]}=he({queryKey:["productionTasksForPreStatus",m,c],queryFn:()=>Ys.getProductionTasksWithRelations(m,c),enabled:!!n&&!!i,staleTime:5*60*1e3}),{data:E=[]}=he({queryKey:["productionTasksBeforeForPreStatus",o],queryFn:()=>Ys.getProductionTasksWithRelations(void 0,o),enabled:!!l,staleTime:5*60*1e3});return{statusRecords:u.useMemo(()=>{if(!d.length||!b.length)return[];new Map(b.map(S=>[S.$id,S.process_name]));const $=["cleaning","c & d","roasting","rfp"],H=a?b.filter(S=>{const h=S.process_name?.toLowerCase();return S.$id===a&&$.includes(h)}):b.filter(S=>{const h=S.process_name?.toLowerCase();return $.includes(h)}),_=S=>{if(!S)return!n&&!i;if(!n&&!i)return!0;const h=As(S),I=n?h>=n:!0,y=i?h<=i:!0;return I&&y},Q=S=>!S||!l?!1:As(S)<=l;return d.flatMap(S=>H.map(h=>{const I=S.stock_name,y=h.process_name;if(!I||!y)return null;const p=f.filter(xe=>xe.stock_id===S.$id&&xe.process_id===h.$id&&xe.status==="completed"&&Q(xe.date_completed||xe.date_assigned)).reduce((xe,Ce)=>{const ns=Ce.completed_quantity!==void 0&&Ce.completed_quantity!==null?Number(Ce.completed_quantity):Number(Ce.assigned_quantity)||0,We=Number(Ce.wastage_quantity)||0;return xe+(ns-We)},0),C=f.filter(xe=>xe.stock_id===S.$id&&xe.stock_source===y&&Q(xe.date_assigned)).reduce((xe,Ce)=>xe+(Number(Ce.assigned_quantity)||0),0),G=E.filter(xe=>xe.source_process_id===h.$id).reduce((xe,Ce)=>{const We=(Ce.stock_items||[]).filter(Ge=>Ge.stock_id===S.$id).reduce((Ge,R)=>Ge+(Number(R.quantity)||0),0);return xe+We},0),q=C+G,B=p-q,U=T.filter(xe=>xe.stock_id===S.$id&&xe.process_id===h.$id&&_(xe.date_assigned)),ie=U.filter(xe=>xe.status==="completed").reduce((xe,Ce)=>{const ns=Ce.completed_quantity!==void 0&&Ce.completed_quantity!==null?Number(Ce.completed_quantity):Number(Ce.assigned_quantity)||0,We=Number(Ce.wastage_quantity)||0;return xe+(ns-We)},0),ue=U.reduce((xe,Ce)=>xe+(Number(Ce.wastage_quantity)||0),0),je=T.filter(xe=>xe.stock_id===S.$id&&xe.stock_source===y&&_(xe.date_assigned)).reduce((xe,Ce)=>xe+(Number(Ce.assigned_quantity)||0),0),z=N.filter(xe=>xe.source_process_id===h.$id).reduce((xe,Ce)=>{const We=(Ce.stock_items||[]).filter(Ge=>Ge.stock_id===S.$id).reduce((Ge,R)=>Ge+(Number(R.quantity)||0),0);return xe+We},0),pe=je+z,fe=B+ie-pe,Te=S.min_level||0;let Ze="In Stock";return fe<=0?Ze="Out of Stock":fe<Te&&(Ze="Low Stock"),{stock_name:I,process:y,opening_balance:B,effective_completed:ie,wastage_qty:ue,utilised:pe,closing_balance:fe,min_level:Te,status:Ze}}).filter(h=>h!==null)).filter(Boolean)},[d,b,T,f,N,E,a,n,i,l]),isLoading:g||w||L,error:null}},Rn=()=>{const{data:r=[],isLoading:s,error:t}=he({queryKey:["stocks"],queryFn:async()=>await Fs.getAll()});return{data:r,isLoading:s,error:t}},La=()=>{const{data:r=[],isLoading:s,error:t}=he({queryKey:["staff"],queryFn:async()=>await _l.getAll(),staleTime:3e5,gcTime:9e5,refetchOnWindowFocus:!1});return{data:r,isLoading:s,error:t}},Xs=()=>{const{data:r=[],isLoading:s,error:t}=he({queryKey:["processes"],queryFn:async()=>await lt.getAll(),staleTime:3e5,gcTime:9e5,refetchOnWindowFocus:!1});return{data:r,isLoading:s,error:t}},sc=()=>{const{data:r=[],isLoading:s,error:t}=he({queryKey:["products"],queryFn:async()=>await Is.getAll(),staleTime:3e5,gcTime:9e5,refetchOnWindowFocus:!1});return{data:r,isLoading:s,error:t}},An=()=>{const{data:r=[],isLoading:s,error:t}=he({queryKey:["rawProducts"],queryFn:async()=>await pt.getAll(),staleTime:3e5,gcTime:9e5,refetchOnWindowFocus:!1});return{data:r,isLoading:s,error:t}},tc=()=>{const r=is(),[s,t]=u.useState(""),[a,n]=u.useState({from:Us(new Date),to:Os(new Date)}),[i,l]=u.useState(""),{data:m,isLoading:c}=Xs(),o=a.from?Xe(a.from,"yyyy-MM-dd"):void 0,d=a.to?Xe(a.to,"yyyy-MM-dd"):void 0,{toast:g}=Ee(),{statusRecords:b,isLoading:w}=$a(o,d,{processId:i||void 0}),T=u.useMemo(()=>b?b.filter(N=>(N.stock_name||"").toLowerCase().includes(s.toLowerCase())||(N.process||"").toLowerCase().includes(s.toLowerCase())):[],[b,s]),L=async()=>{try{await r.invalidateQueries({queryKey:["stocks"]}),await r.invalidateQueries({queryKey:["processes"]}),await r.invalidateQueries({queryKey:["preProductionTasks"]}),await r.invalidateQueries({queryKey:["productionTasksForPreStatus"]}),g({title:"Pre-Production Data Refreshed",description:"Data updated successfully"})}catch{g({title:"Refresh Failed",description:"Please try again",variant:"destructive"})}},f=()=>{const E=[["Stock Name","Process","Opening Balance","Effective Completed","Wastage Qty","Utilised","Closing Balance","Min Level","Status"].join(","),...T.map(_=>[`"${_.stock_name}"`,`"${_.process}"`,_.opening_balance.toFixed(2),_.effective_completed.toFixed(2),_.wastage_qty.toFixed(2),_.utilised.toFixed(2),_.closing_balance.toFixed(2),(_.min_level||0).toFixed(2),`"${_.status||"In Stock"}"`].join(","))].join(`
`),D=new Blob([E],{type:"text/csv;charset=utf-8;"}),k=URL.createObjectURL(D),$=document.createElement("a");$.setAttribute("href",k);const H=o&&d?`_${o}_to_${d}`:"";$.setAttribute("download",`pre-production-status${H}_${new Date().toISOString().split("T")[0]}.csv`),$.style.visibility="hidden",document.body.appendChild($),$.click(),document.body.removeChild($)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Pre-Production Status"}),e.jsx("p",{className:"text-muted-foreground",children:"Track material flow through pre-production stages"})]}),e.jsx(J,{children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("div",{className:"relative w-full md:w-auto",children:[e.jsx(ts,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(V,{placeholder:"Search stock or process...",className:"w-full pl-8 md:w-[200px] lg:w-[300px]",value:s,onChange:N=>t(N.target.value)})]}),e.jsx(St,{value:a,onChange:N=>{N?.from&&N?.to&&n({from:N.from,to:N.to})}}),e.jsxs(te,{value:i||"all",onValueChange:N=>l(N==="all"?"":N),children:[e.jsx(ee,{className:"w-[180px]",children:e.jsx(ae,{placeholder:"All Processes"})}),e.jsxs(se,{children:[e.jsx(v,{value:"all",children:"All Processes"}),m?.filter(N=>{const E=N.process_name?.toLowerCase();return["cleaning","c & d","roasting","rfp"].includes(E)}).map(N=>e.jsx(v,{value:N.$id,children:N.process_name},N.$id))]})]}),e.jsx(A,{onClick:L,variant:"outline",size:"icon",disabled:w,children:e.jsx(Aa,{className:`h-4 w-4 ${w?"animate-spin":""}`})}),e.jsx(A,{onClick:f,variant:"outline",size:"icon",disabled:!T||T.length===0,children:e.jsx(it,{className:"h-4 w-4"})})]})})}),w?e.jsx(J,{children:e.jsxs(Z,{className:"py-12 text-center",children:[e.jsx(Re,{className:"h-8 w-8 animate-spin mx-auto mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading pre-production status..."})]})}):e.jsxs(J,{children:[e.jsx(le,{children:e.jsx(ce,{children:"Status Details"})}),e.jsx(Z,{children:e.jsxs(ds,{children:[e.jsx(us,{children:e.jsxs(we,{children:[e.jsx(X,{children:"Stock Name"}),e.jsx(X,{children:"Process"}),e.jsx(X,{className:"text-right",children:"Opening Balance"}),e.jsx(X,{className:"text-right bg-purple-50",children:"Effective Completed"}),e.jsx(X,{className:"text-right",children:"Wastage Qty"}),e.jsx(X,{className:"text-right bg-green-50",children:"Utilised"}),e.jsx(X,{className:"text-right",children:"Closing Balance"}),e.jsx(X,{className:"text-right",children:"Min Level"}),e.jsx(X,{children:"Status"})]})}),e.jsx(ms,{children:T&&T.length>0?T.map((N,E)=>e.jsxs(we,{children:[e.jsx(Y,{children:N.stock_name}),e.jsx(Y,{children:N.process}),e.jsx(Y,{className:"text-right",children:N.opening_balance.toFixed(2)}),e.jsx(Y,{className:"text-right bg-purple-50 font-medium",children:N.effective_completed.toFixed(2)}),e.jsx(Y,{className:"text-right",children:N.wastage_qty.toFixed(2)}),e.jsx(Y,{className:"text-right bg-green-50 font-medium",children:N.utilised.toFixed(2)}),e.jsx(Y,{className:"text-right font-semibold",children:e.jsx("span",{className:N.closing_balance<0?"text-red-600":"text-green-600",children:N.closing_balance.toFixed(2)})}),e.jsx(Y,{className:"text-right text-muted-foreground",children:(N.min_level||0).toFixed(2)}),e.jsx(Y,{children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${N.status==="Out of Stock"?"bg-red-100 text-red-800":N.status==="Low Stock"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:N.status||"In Stock"})})]},`${N.stock_name}-${N.process}-${E}`)):e.jsx(we,{children:e.jsx(Y,{colSpan:9,className:"text-center",children:"No pre-production status found for the selected criteria."})})})]})})]})]})},qn=(r,s,t={})=>{const{processId:a}=t,n=r?As(r):void 0,i=s?As(s):void 0,l=n?At(n,1):void 0,m=n?Xe(n,"yyyy-MM-dd"):void 0,c=i?Xe(i,"yyyy-MM-dd"):void 0,o=l?Xe(l,"yyyy-MM-dd"):void 0,{data:d=[],isLoading:g}=he({queryKey:["stocks"],queryFn:()=>Fs.getAll(),staleTime:10*60*1e3}),{data:b=[],isLoading:w}=he({queryKey:["processes"],queryFn:()=>lt.getAll(),staleTime:10*60*1e3}),{data:T=[],isLoading:L}=he({queryKey:["rawProducts"],queryFn:()=>pt.getAll(),staleTime:10*60*1e3}),{data:f=[],isLoading:N}=he({queryKey:["products"],queryFn:()=>Is.getAll(),staleTime:10*60*1e3}),{data:E=[],isLoading:D}=he({queryKey:["productionTasks",m,c,a],queryFn:()=>Ys.getProductionTasksWithRelations(m,c,a),enabled:!!n&&!!i,staleTime:5*60*1e3}),{data:k=[]}=he({queryKey:["productionTasksBefore",o,a],queryFn:()=>Ys.getProductionTasksWithRelations(void 0,o,a),enabled:!!l,staleTime:5*60*1e3}),{data:$=[]}=he({queryKey:["postProductionTasks",m,c],queryFn:()=>at.getPostProductionTasksWithRelations(),enabled:!!n&&!!i,staleTime:5*60*1e3});return{statusRecords:u.useMemo(()=>{if(!b.length||!T.length||!f.length)return[];const Q=a?b.filter(p=>p.$id===a):b.filter(p=>{const C=p.process_name?.toLowerCase();return C==="grinding"||C==="blending"}),K=new Map(Q.map(p=>[p.$id,p.process_name])),S=new Map(T.map(p=>[p.$id,p])),h=p=>{const C=f.find(B=>B.$id===p);if(!C)return null;const G=C.product||C.product_name||C.Product_Name||C.name;if(!G)return null;let q=T.find(B=>B.raw_product?.toLowerCase()===G.toLowerCase());return q||(q=T.find(B=>{const U=B.raw_product?.toLowerCase()||"",ie=G.toLowerCase();return U.includes(ie)||ie.includes(U)})),q},I=new Map,y=p=>{if(!p)return!n&&!i;if(!n&&!i)return!0;const C=As(p),G=n?C>=n:!0,q=i?C<=i:!0;return G&&q},F=new Set(Q.map(p=>p.$id));return k.filter(p=>F.has(p.process_id)).forEach(p=>{const C=`${p.raw_product_id}-${p.process_id}`,G=Array.isArray(p.stock_items)?p.stock_items.reduce((ie,ue)=>ie+(Number(ue.quantity)||0),0):0,q=p.assigned_quantity!==void 0&&p.assigned_quantity!==null?Number(p.assigned_quantity):G,B=Number(p.wastage_quantity)||0,U=q-B;I.has(C)?I.get(C).opening_balance+=U:I.set(C,{stock_name:p.raw_product_name||"Unknown",process:K.get(p.process_id)||"Unknown",opening_balance:U,assigned:0,effective_completed:0,wastage_qty:0,utilised:0,closing_balance:0})}),E.filter(p=>F.has(p.process_id)).forEach(p=>{const C=`${p.raw_product_id}-${p.process_id}`,G=Array.isArray(p.stock_items)?p.stock_items.reduce((ie,ue)=>ie+(Number(ue.quantity)||0),0):0,q=p.assigned_quantity!==void 0&&p.assigned_quantity!==null?Number(p.assigned_quantity):G,B=Number(p.wastage_quantity)||0,U=q-B;if(I.has(C)){const ie=I.get(C);ie.assigned+=q,ie.wastage_qty+=B,ie.effective_completed+=U}else I.set(C,{stock_name:p.raw_product_name||"Unknown",process:K.get(p.process_id)||"Unknown",opening_balance:0,assigned:q,wastage_qty:B,effective_completed:U,utilised:0,closing_balance:0})}),I.forEach((p,C)=>{const[G,q]=C.split("-");S.get(G);const B=($||[]).filter(U=>{const ie=U.source_process_id===q,ue=h(U.product_id),je=ue&&ue.$id===G,z=y(U.date_assigned)||y(U.date_completed);return ie&&je&&z}).reduce((U,ie)=>{const ue=Number(ie.source_quantity)||0;return U+ue},0);p.utilised=B}),I.forEach(p=>{p.closing_balance=p.opening_balance+p.effective_completed-p.utilised,p.closing_balance<=0?p.status="Out of Stock":p.closing_balance<0?p.status="Low Stock":p.status="In Stock"}),Array.from(I.values())},[d,b,E,k,$,T,f,n,i,l,a]),isLoading:g||w||L||N||D,error:null}},ac=()=>{const{user:r,loading:s}=os(),t=Gs(),{toast:a}=Ee(),n=is(),[i,l]=u.useState(""),[m,c]=u.useState({from:Us(new Date),to:Os(new Date)}),[o,d]=u.useState(""),{data:g,isLoading:b}=Xs(),w=m.from?Xe(m.from,"yyyy-MM-dd"):void 0,T=m.to?Xe(m.to,"yyyy-MM-dd"):void 0,{statusRecords:L,isLoading:f}=qn(w,T,{processId:o||void 0}),N=u.useMemo(()=>L?L.filter($=>($.stock_name||"").toLowerCase().includes(i.toLowerCase())||($.process||"").toLowerCase().includes(i.toLowerCase())):[],[L,i]),E=async()=>{try{await n.invalidateQueries({queryKey:["stocks"]}),await n.invalidateQueries({queryKey:["processes"]}),await n.invalidateQueries({queryKey:["productionTasks"]}),await n.invalidateQueries({queryKey:["postProductionTasks"]}),await n.invalidateQueries({queryKey:["rawProducts"]}),await n.invalidateQueries({queryKey:["products"]}),a({title:"Production Data Refreshed",description:"Data updated successfully"})}catch{a({title:"Refresh Failed",description:"Please try again",variant:"destructive"})}},D=()=>{const H=[["Raw Product","Process","Opening Balance","Assigned","Effective Completed","Wastage Qty","Utilised","Closing Bal","Min Level","Status"].join(","),...N.map(h=>[`"${h.stock_name}"`,`"${h.process}"`,h.opening_balance.toFixed(2),h.assigned.toFixed(2),h.effective_completed.toFixed(2),h.wastage_qty.toFixed(2),h.utilised.toFixed(2),h.closing_balance.toFixed(2),(h.min_level||0).toFixed(2),`"${h.status||"In Stock"}"`].join(","))].join(`
`),_=new Blob([H],{type:"text/csv;charset=utf-8;"}),Q=URL.createObjectURL(_),K=document.createElement("a");K.setAttribute("href",Q);const S=w&&T?`_${w}_to_${T}`:"";K.setAttribute("download",`production-status${S}_${new Date().toISOString().split("T")[0]}.csv`),K.style.visibility="hidden",document.body.appendChild(K),K.click(),document.body.removeChild(K)},k=f||b;return s?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Re,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading..."})]})}):r?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Production Status"}),e.jsx("p",{className:"text-muted-foreground",children:"Track material flow through production stages"})]}),e.jsx(J,{children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("div",{className:"relative w-full md:w-auto",children:[e.jsx(ts,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(V,{placeholder:"Search stock or process...",className:"w-full pl-8 md:w-[200px] lg:w-[300px]",value:i,onChange:$=>l($.target.value)})]}),e.jsx(St,{value:m,onChange:$=>{$?.from&&$?.to&&c($)}}),e.jsxs(te,{value:o,onValueChange:d,children:[e.jsx(ee,{className:"w-[180px]",children:e.jsx(ae,{placeholder:"All Processes"})}),e.jsx(se,{children:g?.filter($=>{const H=$.process_name?.toLowerCase();return H==="grinding"||H==="blending"}).map($=>e.jsx(v,{value:$.$id,children:$.process_name},$.$id))})]}),e.jsx(A,{onClick:E,variant:"outline",size:"icon",disabled:k,children:e.jsx(Aa,{className:`h-4 w-4 ${k?"animate-spin":""}`})}),e.jsx(A,{onClick:D,variant:"outline",size:"icon",disabled:!N||N.length===0,children:e.jsx(it,{className:"h-4 w-4"})})]})})}),k?e.jsx(J,{children:e.jsxs(Z,{className:"py-12 text-center",children:[e.jsx(Re,{className:"h-8 w-8 animate-spin mx-auto mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading production status..."})]})}):e.jsxs(J,{children:[e.jsxs(le,{className:"flex flex-row items-center justify-between",children:[e.jsxs(ce,{children:["Production Status Records (",N.length,")"]}),e.jsx("div",{className:"flex items-center gap-2"})]}),e.jsx(Z,{children:e.jsxs(ds,{children:[e.jsx(us,{children:e.jsxs(we,{children:[e.jsx(X,{children:"Raw Product"}),e.jsx(X,{children:"Process"}),e.jsx(X,{className:"text-right",children:"Opening Balance"}),e.jsx(X,{className:"text-right",children:"Assigned"}),e.jsx(X,{className:"text-right bg-purple-50",children:"Effective Completed"}),e.jsx(X,{className:"text-right",children:"Wastage Qty"}),e.jsx(X,{className:"text-right bg-green-50",children:"Utilised"}),e.jsx(X,{className:"text-right",children:"Closing Bal"}),e.jsx(X,{className:"text-right",children:"Min Level"}),e.jsx(X,{children:"Status"})]})}),e.jsx(ms,{children:N&&N.length>0?N.map(($,H)=>e.jsxs(we,{children:[e.jsx(Y,{children:$.stock_name}),e.jsx(Y,{children:$.process}),e.jsx(Y,{className:"text-right",children:$.opening_balance.toFixed(2)}),e.jsx(Y,{className:"text-right",children:$.assigned.toFixed(2)}),e.jsx(Y,{className:"text-right bg-purple-50 font-medium",children:$.effective_completed.toFixed(2)}),e.jsx(Y,{className:"text-right",children:$.wastage_qty.toFixed(2)}),e.jsx(Y,{className:"text-right bg-green-50 font-medium",children:$.utilised.toFixed(2)}),e.jsx(Y,{className:"text-right font-semibold",children:e.jsx("span",{className:$.closing_balance<0?"text-red-600":"text-green-600",children:$.closing_balance.toFixed(2)})}),e.jsx(Y,{className:"text-right text-muted-foreground",children:($.min_level||0).toFixed(2)}),e.jsx(Y,{children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${$.status==="Out of Stock"?"bg-red-100 text-red-800":$.status==="Low Stock"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:$.status||"In Stock"})})]},`${$.stock_name}-${$.process}-${H}`)):e.jsx(we,{children:e.jsx(Y,{colSpan:10,className:"text-center",children:"No production status found for the selected criteria."})})})]})})]})]}):e.jsx(wt,{to:"/login",state:{from:t},replace:!0})},rc=(r,s)=>r.filter(t=>{const a=t.$id;return a&&a.trim()!==""}),Kt={ALL:"all",NONE:"none",EMPTY:"empty",DEFAULT:"default"},nc=(r,s,t={})=>{const{processId:a}=t,n=r?As(r):void 0,i=s?As(s):void 0;n&&At(n,1);const l=n?Xe(n,"yyyy-MM-dd"):void 0,m=i?Xe(i,"yyyy-MM-dd"):void 0,{data:c=[],isLoading:o}=he({queryKey:["products"],queryFn:()=>Is.getAll(),staleTime:10*60*1e3}),{data:d=[],isLoading:g}=he({queryKey:["processes"],queryFn:()=>lt.getAll(),staleTime:10*60*1e3}),{data:b=[],isLoading:w}=he({queryKey:["postProductionTasks",l,m],queryFn:()=>at.getPostProductionTasksWithRelations(),enabled:!!n&&!!i,staleTime:5*60*1e3}),{data:T=[]}=he({queryKey:["salesUnits",l,m],queryFn:()=>Qs.getAll(),staleTime:1*60*1e3});return{statusRecords:u.useMemo(()=>{if(!c.length||!d.length)return[];const N=n?At(n,1):void 0,E=a?d.filter(H=>H.$id===a):d.filter(H=>{const _=H.process_name?.toLowerCase();return _==="packing"||_==="batch coding"}),D=H=>{if(!H)return!n&&!i;if(!n&&!i)return!0;const _=As(H),Q=n?_>=n:!0,K=i?_<=i:!0;return Q&&K},k=H=>!H||!N?!1:As(H)<=N,$=[];return c.forEach(H=>{E.forEach(_=>{const Q=H.sku||H.SKU||"",K=H.product||"",S=_.process_name,h=H.min_level||H.minLevel||0;if(!Q||!K||!S)return;const y=b.filter(z=>z.product_id===H.$id&&z.process_id===_.$id&&z.status==="completed"&&k(z.date_completed||z.date_assigned)).reduce((z,pe)=>z+(Number(pe.units)||0),0),F=b.filter(z=>z.source_process_id===_.$id&&z.product_id===H.$id&&k(z.date_assigned||z.date_completed)).reduce((z,pe)=>z+(Number(pe.units)||0),0);let p=0;S.toLowerCase()==="batch coding"&&(p=T.filter(z=>z.product_id===H.$id&&k(z.date||z.$createdAt)).reduce((z,pe)=>z+(Number(pe.units)||0),0));const C=y-F-p,q=b.filter(z=>z.product_id===H.$id&&z.process_id===_.$id&&z.status==="completed"&&D(z.date_completed||z.date_assigned)).reduce((z,pe)=>z+(Number(pe.units)||0),0),B=b.filter(z=>z.source_process_id===_.$id&&z.product_id===H.$id&&D(z.date_assigned||z.date_completed)).reduce((z,pe)=>{const fe=Number(pe.units)||0;return z+fe},0);let U=0;S.toLowerCase()==="batch coding"&&(U=T.filter(z=>z.product_id===H.$id&&D(z.date||z.$createdAt)).reduce((z,pe)=>{const fe=Number(pe.units)||0;return z+fe},0));const ie=B+U,ue=C+q-ie;let je="In Stock";ue<=0?je="Out of Stock":ue<h&&(je="Low Stock"),$.push({sku:Q,product_name:K,process_name:S,opening_balance:C,completed_units:q,utilised:ie,closing_balance:ue,status:je,min_level:h})})}),$},[c,d,b,T,a,n,i]),isLoading:o||g||w,error:null}},ic=()=>{const{user:r,loading:s}=os(),t=Gs(),{toast:a}=Ee(),n=is(),[i,l]=u.useState(""),[m,c]=u.useState({from:Us(new Date),to:Os(new Date)}),[o,d]=u.useState(Kt.ALL);if(s)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Re,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Validating authentication..."})]})});if(!r)return console.error("PostProductionStatus: User not authenticated, redirecting to login"),e.jsx(wt,{to:"/login",state:{from:t},replace:!0});const{data:g=[],isLoading:b}=he({queryKey:Ca.processes,queryFn:async()=>await lt.getAll()}),{statusRecords:w=[],isLoading:T}=nc(m?.from?Xe(m.from,"yyyy-MM-dd"):void 0,m?.to?Xe(m.to,"yyyy-MM-dd"):void 0,{processId:o!==Kt.ALL?o:void 0}),L=u.useMemo(()=>{if(!w)return[];let D=[...w];if(i&&(D=D.filter(k=>k.product_name?.toLowerCase().includes(i.toLowerCase())||k.process_name?.toLowerCase().includes(i.toLowerCase())||k.sku?.toLowerCase().includes(i.toLowerCase()))),o!==Kt.ALL){const k=g.find($=>$.$id===o)?.process_name;k&&(D=D.filter($=>$.process_name===k))}return D},[w,i,o,g]),f=b||T,N=async()=>{try{await n.invalidateQueries({queryKey:["products"]}),await n.invalidateQueries({queryKey:["processes"]}),await n.invalidateQueries({queryKey:["postProductionTasks"]}),await n.invalidateQueries({queryKey:["salesUnits"]}),a({title:"Post-Production Data Refreshed",description:"Data updated successfully"})}catch{a({title:"Refresh Failed",description:"Please try again",variant:"destructive"})}},E=()=>{try{const D=[["SKU","Product","Process","Source Qty (kg)","Opening Balance","Completed Units","Utilised","Closing Balance","Min Level","Status"],...L.map(_=>[_.sku||"",_.product_name||"",_.process_name||"",_.source_qty??"N/A",_.opening_balance||0,_.completed_units||0,_.utilised||0,_.closing_balance||0,_.min_level||0,`"${_.status||"In Stock"}"`])].map(_=>_.join(",")).join(`
`),k=new Blob([D],{type:"text/csv"}),$=window.URL.createObjectURL(k),H=document.createElement("a");H.href=$,H.download=`post-production-status-${Xe(new Date,"yyyy-MM-dd")}.csv`,H.click(),window.URL.revokeObjectURL($),a({title:"Export Successful",description:"Post-production status data exported successfully."})}catch(D){console.error("PostProductionStatus: Export failed",D),a({title:"Export Failed",description:"Failed to export data. Please try again.",variant:"destructive"})}};return e.jsxs("div",{className:"space-y-6 p-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Post-Production Status"}),e.jsx("p",{className:"text-muted-foreground",children:"Track quality checks and post-production status"})]}),e.jsx(J,{children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("div",{className:"relative w-full md:w-auto",children:[e.jsx(ts,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(V,{placeholder:"Search product, process or SKU...",className:"w-full pl-8 md:w-[200px] lg:w-[300px]",value:i,onChange:D=>l(D.target.value)})]}),e.jsx(St,{value:m,onChange:D=>{D?.from&&D?.to&&c(D)}}),e.jsxs(te,{value:o,onValueChange:d,children:[e.jsx(ee,{className:"w-[180px]",children:e.jsx(ae,{placeholder:"Select Process"})}),e.jsxs(se,{children:[e.jsx(v,{value:Kt.ALL,children:"All Processes"}),rc(g).filter(D=>{const k=D.process_name?.toLowerCase();return k==="packing"||k==="batch coding"}).map(D=>e.jsx(v,{value:D.$id,children:D.process_name},D.$id))]})]}),e.jsx(A,{onClick:N,variant:"outline",size:"icon",disabled:f,children:e.jsx(Aa,{className:`h-4 w-4 ${f?"animate-spin":""}`})}),e.jsx(A,{onClick:E,variant:"outline",size:"icon",disabled:!L||L.length===0,title:"Export to CSV",children:e.jsx(it,{className:"h-4 w-4"})})]})})}),e.jsxs(J,{children:[e.jsx(le,{className:"flex flex-row items-center justify-between",children:e.jsxs(ce,{children:["Post-Production Status Records (",L.length,")"]})}),e.jsx(Z,{children:f?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(Re,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("span",{children:"Loading post-production status..."})]}):L.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("p",{className:"text-lg mb-2",children:"No post-production status found"}),e.jsx("p",{className:"text-sm",children:i?"No matching records found":"Post-production status data will be populated from packing tasks and sales"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(ds,{children:[e.jsx(us,{children:e.jsxs(we,{children:[e.jsx(X,{children:"SKU"}),e.jsx(X,{children:"Product"}),e.jsx(X,{children:"Process"}),e.jsx(X,{className:"text-right",children:"Source Qty (kg)"}),e.jsx(X,{className:"text-right",children:"Opening Balance"}),e.jsx(X,{className:"text-right bg-purple-50",children:"Completed Units"}),e.jsx(X,{className:"text-right bg-green-50",children:"Utilised"}),e.jsx(X,{className:"text-right",children:"Closing Balance"}),e.jsx(X,{className:"text-right",children:"Min Level"}),e.jsx(X,{children:"Status"})]})}),e.jsx(ms,{children:L.map((D,k)=>e.jsxs(we,{children:[e.jsx(Y,{className:"font-medium",children:D.sku}),e.jsx(Y,{children:D.product_name}),e.jsx(Y,{children:D.process_name}),e.jsx(Y,{className:"text-right",children:D.source_qty??"N/A"}),e.jsx(Y,{className:"text-right",children:D.opening_balance||0}),e.jsx(Y,{className:"text-right bg-purple-50 font-medium",children:D.completed_units||0}),e.jsx(Y,{className:"text-right bg-green-50 font-medium",children:D.utilised||0}),e.jsx(Y,{className:"text-right font-semibold",children:e.jsx("span",{className:(D.closing_balance||0)<0?"text-red-600":"text-green-600",children:D.closing_balance||0})}),e.jsx(Y,{className:"text-right text-muted-foreground",children:D.min_level||0}),e.jsx(Y,{children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${D.status==="Out of Stock"?"bg-red-100 text-red-800":D.status==="Low Stock"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:D.status||"In Stock"})})]},`${D.sku}-${D.process_name}-${k}`))})]})})})]})]})};function oc(){const{user:r,loading:s}=os(),t=Gs(),[a,n]=u.useState(""),[i,l]=u.useState(void 0);if(s)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Re,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Validating authentication..."})]})});if(!r)return console.error("InventoryStatus: User not authenticated, redirecting to login"),e.jsx(wt,{to:"/login",state:{from:t},replace:!0});const{data:m=[],isLoading:c}=he({queryKey:["products"],queryFn:async()=>await Is.getAll()}),o=u.useMemo(()=>{const N=[];return i?.from&&N.push(Ae.greaterThanEqual("date",i.from.toISOString())),i?.to&&N.push(Ae.lessThanEqual("date",i.to.toISOString())),N},[i]),{data:d=[],isLoading:g}=he({queryKey:["sales-units-inventory",i?.from?.toISOString(),i?.to?.toISOString()],queryFn:async()=>await Qs.getAll(o)}),{data:b=[],isLoading:w}=he({queryKey:["sales-records-inventory",i?.from?.toISOString(),i?.to?.toISOString()],queryFn:async()=>await tt.getAll(o)}),T=u.useMemo(()=>m.length?m.map(N=>{const E=N.sku||"",D=N.product||N.name||"",k=N.min_level||N.minLevel||0,$=d.filter(S=>S.sku===E).reduce((S,h)=>S+(h.units||0),0),H=b.filter(S=>S.sku===E).reduce((S,h)=>S+(h.sold_units||0),0),_=0,Q=_+$-H;let K="In Stock";return Q<=0?K="Out of Stock":Q<=k&&(K="Low Stock"),{sku:E,product:D,opening_balance:_,sales_units:$,sold:H,closing_balance:Q,min_level:k,status:K}}):[],[m,d,b]),L=u.useMemo(()=>a?T.filter(N=>N.sku.toLowerCase().includes(a.toLowerCase())||N.product.toLowerCase().includes(a.toLowerCase())):T,[T,a]),f=c||g||w;return e.jsxs("div",{className:"space-y-6 p-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Inventory Status"}),e.jsx("p",{className:"text-muted-foreground",children:"Track current inventory levels based on sales units and sold units"})]}),e.jsx(J,{children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4 items-center flex-wrap",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(ts,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(V,{placeholder:"Search by SKU or Product...",className:"pl-10",value:a,onChange:N=>n(N.target.value)})]}),e.jsx("div",{className:"min-w-[250px]",children:e.jsx(St,{value:i,onChange:l,placeholder:"Select date range for calculations"})}),e.jsxs(A,{variant:"outline",children:[e.jsx(Ks,{className:"h-4 w-4 mr-2"}),"Filter"]}),e.jsxs(A,{variant:"outline",children:[e.jsx(it,{className:"h-4 w-4 mr-2"}),"Export"]})]})})}),e.jsxs(J,{children:[e.jsx(le,{children:e.jsxs(ce,{children:["Inventory Status (",L.length,")",i?.from&&i?.to&&e.jsxs("span",{className:"text-sm font-normal text-muted-foreground ml-2",children:["(",i.from.toLocaleDateString("en-GB")," - ",i.to.toLocaleDateString("en-GB"),")"]})]})}),e.jsx(Z,{children:f?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(Re,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("span",{children:"Loading inventory status..."})]}):L.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("p",{className:"text-lg mb-2",children:"No inventory data found"}),e.jsx("p",{className:"text-sm",children:a?"Try adjusting your search criteria":"Add products and sales data to see inventory status"})]}):e.jsxs(ds,{children:[e.jsx(us,{children:e.jsxs(we,{children:[e.jsx(X,{children:"SKU"}),e.jsx(X,{children:"Product"}),e.jsx(X,{className:"text-right",children:"Opening Bal"}),e.jsx(X,{className:"text-right bg-purple-50",children:"Sales Units"}),e.jsx(X,{className:"text-right bg-green-50",children:"Sold"}),e.jsx(X,{className:"text-right",children:"Closing Bal"}),e.jsx(X,{className:"text-right",children:"Min Level"}),e.jsx(X,{children:"Status"})]})}),e.jsx(ms,{children:L.map((N,E)=>e.jsxs(we,{children:[e.jsx(Y,{className:"font-medium",children:N.sku}),e.jsx(Y,{children:N.product}),e.jsx(Y,{className:"text-right",children:N.opening_balance.toLocaleString()}),e.jsx(Y,{className:"text-right bg-purple-50 font-medium",children:N.sales_units.toLocaleString()}),e.jsx(Y,{className:"text-right bg-green-50 font-medium",children:N.sold.toLocaleString()}),e.jsx(Y,{className:"text-right font-semibold",children:e.jsx("span",{className:N.closing_balance<0?"text-red-600":"text-green-600",children:N.closing_balance.toLocaleString()})}),e.jsx(Y,{className:"text-right text-muted-foreground",children:N.min_level.toLocaleString()}),e.jsx(Y,{children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${N.status==="Out of Stock"?"bg-red-100 text-red-800":N.status==="Low Stock"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:N.status})})]},`${N.sku}-${E}`))})]})})]}),e.jsxs(J,{children:[e.jsx(le,{children:e.jsx(ce,{children:"Summary"})}),e.jsx(Z,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:L.length}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Products"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:L.reduce((N,E)=>N+E.sales_units,0).toLocaleString()}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Sales Units"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:L.reduce((N,E)=>N+E.sold,0).toLocaleString()}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Sold"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:L.reduce((N,E)=>N+E.closing_balance,0).toLocaleString()}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Net Closing Balance"})]})]})})]})]})}const lc=[{value:"pending",label:"Pending"},{value:"in_progress",label:"In Progress"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"}],cc=({isOpen:r,onClose:s,onSubmit:t,editingTask:a,isLoading:n=!1})=>{const{data:i}=Rn(),{data:l}=La(),{data:m}=Xs(),c=new Date,o=Us(c),d=Os(c),{statusRecords:g}=$a(o.toISOString().split("T")[0],d.toISOString().split("T")[0],{processId:void 0}),{stockStatus:b,isLoading:w}=En(o,d,{category:void 0,searchTerm:void 0});u.useEffect(()=>{console.log("ðŸ” RTQV DATA SOURCE DEBUG:",{dateRange:`${o.toISOString().split("T")[0]} to ${d.toISOString().split("T")[0]}`,isLoading:w,dataLength:b?.length,sampleData:b?.slice(0,2),timestamp:new Date().toISOString()})},[b,w]);const T=["Stock","Cleaning","C & D","Roasting","RFP"],L=m.filter(S=>{const h=S.process_name?.toLowerCase();return["cleaning","c & d","roasting","rfp"].includes(h)}),[f,N]=u.useState({task_id:"",stock_id:"",stock_source:"",date_assigned:new Date().toISOString().split("T")[0],process_id:"",assigned_quantity:"",completed_quantity:"",staff_id:"",date_completed:"",wastage_quantity:"",remarks:"",status:"pending"}),[E,D]=u.useState({}),[k,$]=u.useState(null),H=()=>{if(!f.stock_id||!f.stock_source||!f.assigned_quantity){$(null);return}const S=i?.find(q=>q.$id===f.stock_id);if(!S){$({isValid:!1,availableQty:0,requiredQty:0,stockName:"Unknown Stock",stockSource:f.stock_source,error:"Stock not found",validationClass:"bg-red-50 text-red-700 border-red-200",validationMessage:"Selected stock not found"});return}const h=parseFloat(f.assigned_quantity);if(h<=0){$({isValid:!1,availableQty:0,requiredQty:h,stockName:S.stock_name,stockSource:f.stock_source,error:"Invalid quantity",validationClass:"bg-yellow-50 text-yellow-700 border-yellow-200",validationMessage:"Quantity must be greater than 0"});return}let I=0,y="",F=!1;if(f.stock_source==="Stock"){if(y="Stock Status",F=w,F){$({isValid:!1,availableQty:0,requiredQty:h,stockName:S.stock_name,stockSource:f.stock_source,dataSource:y,isLoading:!0,validationClass:"bg-blue-50 text-blue-700 border-blue-200",validationMessage:"Loading stock data..."});return}const q=b?.find(B=>B.Stock_Name?.toLowerCase()===S.stock_name?.toLowerCase());I=q?.Closing_Balance??0,console.log("ðŸ” RTQV Stock Status Check:",{stock_name:S.stock_name,stockRecord_found:!!q,closing_balance:q?.Closing_Balance,availableQty:I,dataSource:y,forced_fresh:!0})}else{y="Pre-Production Status";const q=g?.find(B=>B.stock_name===S.stock_name&&B.process===f.stock_source);I=q?.closing_balance??0,console.log("ðŸ” RTQV Pre-Production Status Check:",{stock_name:S.stock_name,stock_source:f.stock_source,statusRecord_found:!!q,closing_balance:q?.closing_balance,availableQty:I,dataSource:y,forced_fresh:!0})}const p=I>=h;let C="",G="";p?(C="bg-green-50 text-green-700 border-green-200",G=`âœ“ Available: ${I}kg (Required: ${h}kg)`):I===0?(C="bg-red-50 text-red-700 border-red-200",G=`âœ— Out of stock (Required: ${h}kg)`):(C="bg-orange-50 text-orange-700 border-orange-200",G=`âš  Insufficient stock: ${I}kg available (Required: ${h}kg)`),$({isValid:p,availableQty:I,requiredQty:h,stockName:S.stock_name,stockSource:f.stock_source,dataSource:y,isLoading:!1,validationClass:C,validationMessage:G})};u.useEffect(()=>{H()},[f.stock_id,f.stock_source,f.assigned_quantity,i,g,b]),u.useEffect(()=>{if(r)if(a)N({task_id:a.task_id,stock_id:a.stock_id,stock_source:a.stock_source,date_assigned:a.date_assigned,process_id:a.process_id,assigned_quantity:a.assigned_quantity.toString(),completed_quantity:a.completed_quantity?.toString()||"",staff_id:a.staff_id,date_completed:a.date_completed||"",wastage_quantity:a.wastage_quantity?.toString()||"",remarks:a.remarks||"",status:a.status});else{const S=`TASK${Date.now().toString().slice(-6)}`;N({task_id:S,stock_id:"",stock_source:"",date_assigned:new Date().toISOString().split("T")[0],process_id:"",assigned_quantity:"",completed_quantity:"",staff_id:"",date_completed:"",wastage_quantity:"",remarks:"",status:"pending"})}},[a,r]);const _=()=>{const S={};return f.task_id.trim()||(S.task_id="Task ID is required"),f.stock_id||(S.stock_id="Stock is required"),f.stock_source||(S.stock_source="Stock source is required"),f.date_assigned||(S.date_assigned="Date assigned is required"),f.process_id||(S.process_id="Process is required"),(!f.assigned_quantity||parseFloat(f.assigned_quantity)<=0)&&(S.assigned_quantity="Assigned quantity must be greater than 0"),f.staff_id||(S.staff_id="Staff is required"),f.wastage_quantity&&parseFloat(f.wastage_quantity)<0&&(S.wastage_quantity="Wastage quantity cannot be negative"),D(S),Object.keys(S).length===0},Q=S=>{if(S.preventDefault(),!_())return;const h={task_id:f.task_id,stock_id:f.stock_id,stock_source:f.stock_source,date_assigned:f.date_assigned,process_id:f.process_id,assigned_quantity:parseFloat(f.assigned_quantity),completed_quantity:f.completed_quantity?parseFloat(f.completed_quantity):void 0,staff_id:f.staff_id,date_completed:f.date_completed||void 0,wastage_quantity:f.wastage_quantity?parseFloat(f.wastage_quantity):void 0,remarks:f.remarks||void 0,status:f.status};t(h)},K=()=>{N({task_id:"",stock_id:"",stock_source:"",date_assigned:new Date().toISOString().split("T")[0],process_id:"",assigned_quantity:"",completed_quantity:"",staff_id:"",date_completed:"",wastage_quantity:"",remarks:"",status:"pending"}),D({}),$(null),s()};return e.jsx(Qe,{open:r,onOpenChange:K,children:e.jsxs(Ve,{className:"sm:max-w-[600px] max-w-[95vw] max-h-[90vh] overflow-y-auto",children:[e.jsxs(Be,{children:[e.jsx(ze,{children:a?"Edit Pre-Production Task":"Add New Pre-Production Task"}),e.jsx(Ye,{children:a?"Update the details of the pre-production task below.":"Fill in the details to create a new pre-production task."})]}),e.jsxs("form",{onSubmit:Q,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(P,{htmlFor:"task_id",children:"Task ID *"}),e.jsx(V,{id:"task_id",value:f.task_id,onChange:S=>N({...f,task_id:S.target.value}),className:E.task_id?"border-red-500":""}),E.task_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:E.task_id})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"date_assigned",children:"Date Assigned *"}),e.jsx(V,{id:"date_assigned",type:"date",value:f.date_assigned,onChange:S=>N({...f,date_assigned:S.target.value}),className:E.date_assigned?"border-red-500":""}),E.date_assigned&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:E.date_assigned})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(P,{htmlFor:"stock_id",children:"Stock Name *"}),e.jsxs(te,{value:f.stock_id,onValueChange:S=>N({...f,stock_id:S}),children:[e.jsx(ee,{className:E.stock_id?"border-red-500":"",children:e.jsx(ae,{placeholder:"Select Stock"})}),e.jsx(se,{children:i.map(S=>e.jsx(v,{value:S.$id||"",children:S.stock_name},S.$id))})]}),E.stock_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:E.stock_id})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"stock_source",children:"Stock Source *"}),e.jsxs(te,{value:f.stock_source,onValueChange:S=>N({...f,stock_source:S}),children:[e.jsx(ee,{className:E.stock_source?"border-red-500":"",children:e.jsx(ae,{placeholder:"Select Source"})}),e.jsx(se,{children:T.map(S=>e.jsx(v,{value:S,children:S},S))})]}),E.stock_source&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:E.stock_source})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(P,{htmlFor:"process_id",children:"Process *"}),e.jsxs(te,{value:f.process_id,onValueChange:S=>N({...f,process_id:S}),children:[e.jsx(ee,{className:E.process_id?"border-red-500":"",children:e.jsx(ae,{placeholder:"Select Process"})}),e.jsx(se,{children:L.map(S=>e.jsx(v,{value:S.$id||"",children:S.process_name},S.$id))})]}),E.process_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:E.process_id})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"assigned_quantity",children:"Assigned Quantity *"}),e.jsx(V,{id:"assigned_quantity",type:"number",step:"0.01",min:"0",value:f.assigned_quantity,onChange:S=>N({...f,assigned_quantity:S.target.value}),className:E.assigned_quantity?"border-red-500":"",placeholder:"Enter quantity in kg"}),E.assigned_quantity&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:E.assigned_quantity}),k&&e.jsxs("div",{className:`mt-2 p-3 rounded-md border text-sm ${k.validationClass}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("div",{className:"font-medium",children:k.stockName}),e.jsxs("div",{className:"text-xs opacity-75",children:["Source: ",k.dataSource]})]}),e.jsx("div",{className:"mb-1",children:k.validationMessage}),k.error&&e.jsxs("div",{className:"text-xs mt-1 opacity-75",children:["Error: ",k.error]}),k.isLoading&&e.jsxs("div",{className:"flex items-center gap-2 text-xs mt-1",children:[e.jsx("div",{className:"animate-spin h-3 w-3 border border-current border-t-transparent rounded-full"}),"Loading fresh data from ",k.dataSource,"..."]})]})]})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"staff_id",children:"Assigned To *"}),e.jsxs(te,{value:f.staff_id,onValueChange:S=>N({...f,staff_id:S}),children:[e.jsx(ee,{className:E.staff_id?"border-red-500":"",children:e.jsx(ae,{placeholder:"Select Staff"})}),e.jsx(se,{children:l.map(S=>e.jsx(v,{value:S.$id||"",children:S.staff_name},S.$id))})]}),E.staff_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:E.staff_id})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(P,{htmlFor:"completed_quantity",children:"Completed Quantity"}),e.jsx(V,{id:"completed_quantity",type:"number",value:f.completed_quantity,onChange:S=>N({...f,completed_quantity:S.target.value})})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"date_completed",children:"Date Completed"}),e.jsx(V,{id:"date_completed",type:"date",value:f.date_completed,onChange:S=>N({...f,date_completed:S.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(P,{htmlFor:"wastage_quantity",children:"Wastage Quantity"}),e.jsx(V,{id:"wastage_quantity",type:"number",step:"0.01",min:"0",value:f.wastage_quantity,onChange:S=>N({...f,wastage_quantity:S.target.value}),className:E.wastage_quantity?"border-red-500":""}),E.wastage_quantity&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:E.wastage_quantity})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"status",children:"Status"}),e.jsxs(te,{value:f.status,onValueChange:S=>N({...f,status:S}),children:[e.jsx(ee,{children:e.jsx(ae,{placeholder:"Select Status"})}),e.jsx(se,{children:lc.map(S=>e.jsx(v,{value:S.value,children:S.label},S.value))})]})]})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"remarks",children:"Remarks"}),e.jsx(Hs,{id:"remarks",value:f.remarks,onChange:S=>N({...f,remarks:S.target.value}),placeholder:"Enter any remarks",rows:3})]})]}),e.jsxs(He,{className:"flex-col sm:flex-row gap-2 pt-4",children:[e.jsx(A,{type:"button",variant:"outline",onClick:K,className:"w-full sm:w-auto",children:"Cancel"}),e.jsx(A,{type:"submit",disabled:n,className:"w-full sm:w-auto",children:n?"Saving...":a?"Update":"Save"})]})]})]})})},dc=()=>{const r=is(),s=Ne({mutationFn:n=>Me.createDocument(Ue,ge.PRE_PRODUCTION_TASKS,rt.unique(),n),onSuccess:()=>{r.invalidateQueries({queryKey:["preProductionTasks"]})}}),t=Ne({mutationFn:({id:n,data:i})=>Me.updateDocument(Ue,ge.PRE_PRODUCTION_TASKS,n,i),onSuccess:()=>{r.invalidateQueries({queryKey:["preProductionTasks"]})}}),a=Ne({mutationFn:n=>Me.deleteDocument(Ue,ge.PRE_PRODUCTION_TASKS,n),onSuccess:()=>{r.invalidateQueries({queryKey:["preProductionTasks"]})}});return{createTask:s,updateTask:t,deleteTask:a}},uc=()=>{const[r,s]=u.useState(""),[t,a]=u.useState(!1),[n,i]=u.useState(null),[l,m]=u.useState([]),[c,o]=u.useState({show:!1,message:"",type:"success"}),[d,g]=u.useState("all"),[b,w]=u.useState("all"),[T,L]=u.useState("all"),[f,N]=u.useState({from:"",to:""}),[E,D]=u.useState(1),[k,$]=u.useState(50),{tasks:H,isLoading:_,error:Q,refetch:K}=kn(),{createTask:S,updateTask:h,deleteTask:I}=dc(),{config:y}=bs("pre-production-tasks"),{validationRules:F,canImport:p}=Ns("pre-production-tasks");Eo("pre-production-tasks");const{currentSort:C,handleSort:G,getSortedData:q}=Bs();Xs();const B=(R,M)=>{o({show:!0,message:R,type:M}),setTimeout(()=>o({show:!1,message:"",type:"success"}),3e3)},U=H.filter(R=>{const M=R.task_id.toLowerCase().includes(r.toLowerCase())||R.stock_name.toLowerCase().includes(r.toLowerCase())||R.staff_name.toLowerCase().includes(r.toLowerCase())||R.process_name.toLowerCase().includes(r.toLowerCase()),be=d==="all"||R.stock_name.toLowerCase().includes(d.toLowerCase()),Se=b==="all"||R.process_name.toLowerCase().includes(b.toLowerCase()),$e=T==="all"||R.staff_name.toLowerCase().includes(T.toLowerCase()),Je=(!f.from||R.date_assigned>=f.from)&&(!f.to||R.date_assigned<=f.to);return M&&be&&Se&&$e&&Je}),ie=Array.from(new Set(H.map(R=>R.stock_name))).sort(),ue=Array.from(new Set(H.map(R=>R.process_name))).sort(),je=Array.from(new Set(H.map(R=>R.staff_name))).sort(),z=U.length,pe=Math.ceil(z/k),fe=(E-1)*k,Te=fe+k,Ze=U.slice(fe,Te);u.useEffect(()=>{D(1)},[r,d,b,T,f,k]);const xe=async R=>{try{n?(await h.mutateAsync({id:n.$id,data:R}),B("Pre-production task updated successfully","success")):(await S.mutateAsync(R),B("Pre-production task created successfully","success")),a(!1),i(null)}catch(M){console.error("Error saving task:",M),B("Failed to save task","error")}},Ce=R=>{i(R),a(!0)},ns=async R=>{if(window.confirm("Are you sure you want to delete this task?"))try{await I.mutateAsync(R.$id),B("Pre-production task deleted successfully","success")}catch(M){console.error("Error deleting task:",M),B("Failed to delete task","error")}},We=async()=>{if(l.length===0){B("Please select tasks to delete","error");return}if(window.confirm(`Are you sure you want to delete ${l.length} selected task(s)?`))try{await Promise.all(l.map(R=>I.mutateAsync(R.$id))),m([]),B(`${l.length} tasks deleted successfully`,"success")}catch(R){console.error("Error deleting tasks:",R),B("Failed to delete selected tasks","error")}},Ge=()=>{if(l.length===0){B("Please select tasks to export","error");return}B(`Exporting ${l.length} selected task(s)...`,"success")};return Q?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Pre-Production Tasks"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage pre-production processing tasks"})]}),e.jsx(J,{children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"text-center py-12 text-red-600",children:[e.jsx("p",{className:"text-lg mb-2",children:"Error loading tasks"}),e.jsx("p",{className:"text-sm mb-4",children:Q.message}),e.jsx(A,{onClick:()=>K(),variant:"outline",children:"Retry"})]})})})]}):e.jsxs("div",{className:"space-y-6",children:[c.show&&e.jsx("div",{className:`fixed top-4 right-4 px-4 py-2 rounded-md shadow-lg z-50 ${c.type==="success"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300"}`,children:c.message}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Pre-Production Tasks"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage pre-production processing tasks"})]}),e.jsxs(A,{className:"bg-primary hover:bg-primary/90",onClick:()=>{i(null),a(!0)},children:[e.jsx(fs,{className:"h-4 w-4 mr-2"}),"Add New"]})]}),e.jsx(J,{children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(ts,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(V,{placeholder:"Search tasks...",className:"pl-10",value:r,onChange:R=>s(R.target.value)})]}),p&&y&&e.jsx(gs,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:y.exportColumns.filter(R=>R.required).map(R=>R.exportHeader),optionalColumns:y.exportColumns.filter(R=>!R.required).map(R=>R.exportHeader),validationRules:F,onImportComplete:R=>{R.successfulRows>0&&(K(),B(`${R.successfulRows} pre-production tasks imported successfully.`,"success"))}},variant:"outline"}),y&&e.jsx(xs,{data:U.map(R=>{const M={};return y.exportColumns.forEach(be=>{const Se=R[be.dataKey];M[be.exportHeader]=be.formatter?be.formatter(Se):Se}),M}),headers:y.exportColumns.map(R=>R.exportHeader),filename:"pre-production-tasks",variant:"outline"})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs(te,{value:d,onValueChange:g,children:[e.jsx(ee,{className:"w-[180px]",children:e.jsx(ae,{placeholder:"Stock Name"})}),e.jsxs(se,{children:[e.jsx(v,{value:"all",children:"All Stocks"}),ie.map(R=>e.jsx(v,{value:R,children:R},R))]})]}),e.jsxs(te,{value:b,onValueChange:w,children:[e.jsx(ee,{className:"w-[180px]",children:e.jsx(ae,{placeholder:"Process"})}),e.jsxs(se,{children:[e.jsx(v,{value:"all",children:"All Processes"}),ue.map(R=>e.jsx(v,{value:R,children:R},R))]})]}),e.jsxs(te,{value:T,onValueChange:L,children:[e.jsx(ee,{className:"w-[180px]",children:e.jsx(ae,{placeholder:"Staff Name"})}),e.jsxs(se,{children:[e.jsx(v,{value:"all",children:"All Staff"}),je.map(R=>e.jsx(v,{value:R,children:R},R))]})]}),e.jsx(V,{type:"date",placeholder:"From Date",className:"w-[150px]",value:f.from,onChange:R=>N(M=>({...M,from:R.target.value}))}),e.jsx(V,{type:"date",placeholder:"To Date",className:"w-[150px]",value:f.to,onChange:R=>N(M=>({...M,to:R.target.value}))})]})]})})}),e.jsx(J,{children:e.jsxs(Z,{className:"pt-6",children:[l.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 p-3 bg-muted rounded-md",children:[e.jsxs("span",{className:"text-sm font-medium",children:[l.length," selected"]}),e.jsx(A,{variant:"destructive",size:"sm",onClick:We,children:"Delete Selected"}),e.jsx(A,{variant:"outline",size:"sm",onClick:Ge,children:"Export Selected"})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",fe+1," to ",Math.min(Te,z)," of ",z," records"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Records per page:"}),e.jsxs(te,{value:k.toString(),onValueChange:R=>$(Number(R)),children:[e.jsx(ee,{className:"w-[100px]",children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"50",children:"50"}),e.jsx(v,{value:"100",children:"100"}),e.jsx(v,{value:"500",children:"500"})]})]})]})]}),e.jsx("div",{className:"border rounded-md",children:e.jsx("div",{className:"overflow-auto",style:{maxHeight:"600px"},children:e.jsx(Js,{data:q(Ze.map(R=>({...R,formattedDateAssigned:new Date(R.date_assigned).toLocaleDateString("en-GB"),formattedDateCompleted:R.date_completed?new Date(R.date_completed).toLocaleDateString("en-GB"):"-"}))),columns:[{key:"task_id",label:"Task ID",sortable:!0,dataType:"string"},{key:"stock_name",label:"Stock Name",sortable:!0,dataType:"string"},{key:"stock_source",label:"Stock Source",sortable:!0,dataType:"string"},{key:"formattedDateAssigned",label:"Date Assigned",sortable:!0,dataType:"date"},{key:"process_name",label:"Process",sortable:!0,dataType:"string"},{key:"assigned_quantity",label:"Assigned Qty",sortable:!0,dataType:"number",align:"right",headerClassName:"bg-purple-50",cellClassName:"bg-purple-50 font-medium"},{key:"staff_name",label:"Staff Name",sortable:!0,dataType:"string"},{key:"formattedDateCompleted",label:"Date Completed",sortable:!0,dataType:"date"},{key:"completed_quantity",label:"Completed Qty",sortable:!0,dataType:"number",align:"right",headerClassName:"bg-green-50",cellClassName:"bg-green-50 font-medium"},{key:"wastage_quantity",label:"Wastage Qty",sortable:!0,dataType:"number",align:"right"},{key:"remarks",label:"Remarks",sortable:!0,dataType:"string"},{key:"status",label:"Status",sortable:!0,dataType:"string",formatter:R=>e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${R==="completed"?"bg-green-100 text-green-800":R==="in_progress"?"bg-yellow-100 text-yellow-800":R==="pending"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:R==="in_progress"?"In Progress":R.charAt(0).toUpperCase()+R.slice(1)})}],onSort:G,currentSort:C,loading:_,maxHeight:"none",stickyHeader:!0,bordered:!1,searchable:!1,selectable:!0,selectedRows:l,onSelectionChange:m,rowKey:"$id",actions:[vt.edit(R=>Ce(R)),vt.delete(R=>ns(R))],emptyMessage:"No pre-production tasks found"})})}),pe>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx(A,{variant:"outline",size:"sm",onClick:()=>D(R=>Math.max(1,R-1)),disabled:E===1,children:"Previous"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",E," of ",pe]})}),e.jsx(A,{variant:"outline",size:"sm",onClick:()=>D(R=>Math.min(pe,R+1)),disabled:E===pe,children:"Next"})]})]})}),e.jsx(cc,{isOpen:t,onClose:()=>{a(!1),i(null)},onSubmit:xe,editingTask:n,isLoading:S.isPending||h.isPending})]})},mc=({items:r,onItemsChange:s,availableStocks:t,isLoading:a=!1})=>{const n=()=>{const c={stock_id:"",stock_name:"",quantity:0,action:""};s([...r,c])},i=c=>{const o=r.filter((d,g)=>g!==c);s(o)},l=(c,o,d)=>{const g=[...r];if(g[c]={...g[c],[o]:d},o==="stock_id"){const b=t.find(w=>w.$id===d);g[c].stock_name=b?.stock_name||""}s(g)},m=()=>r.reduce((c,o)=>c+(o.quantity||0),0);return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(P,{className:"text-xs font-medium",children:"Stock Items"}),e.jsxs(A,{type:"button",variant:"outline",size:"sm",onClick:n,disabled:a,className:"h-7 px-2 text-xs",children:[e.jsx(fs,{className:"h-3 w-3 mr-1"}),"Add Row"]})]}),r.length===0?e.jsxs("div",{className:"text-center py-4 text-muted-foreground border-2 border-dashed rounded-lg",children:[e.jsx("p",{className:"text-xs",children:"No stock items added"}),e.jsx("p",{className:"text-xs",children:'Click "Add Row" to add stock items'})]}):e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsx("div",{className:"max-h-64 overflow-y-auto",children:e.jsxs(ds,{children:[e.jsx(us,{className:"sticky top-0 bg-white z-10",children:e.jsxs(we,{children:[e.jsx(X,{className:"text-xs py-2",children:"Stock Name"}),e.jsx(X,{className:"text-xs py-2 w-24",children:"Qty (kg)"}),e.jsx(X,{className:"text-xs py-2 w-20",children:"Action"}),e.jsx(X,{className:"text-xs py-2 w-12",children:"Remove"})]})}),e.jsx(ms,{children:r.map((c,o)=>e.jsxs(we,{className:"h-10",children:[e.jsx(Y,{className:"py-1",children:e.jsxs(te,{value:c.stock_id,onValueChange:d=>l(o,"stock_id",d),disabled:a,children:[e.jsx(ee,{className:"h-7 text-xs",children:e.jsx(ae,{placeholder:"Select Stock"})}),e.jsx(se,{children:t.map(d=>e.jsxs(v,{value:d.$id||"",children:[d.stock_name," (",d.stock_code,")"]},d.$id))})]})}),e.jsx(Y,{className:"py-1",children:e.jsx(V,{type:"number",step:"0.01",min:"0",value:c.quantity||"",onChange:d=>l(o,"quantity",parseFloat(d.target.value)||0),placeholder:"0",disabled:a,className:"h-7 text-xs",maxLength:10})}),e.jsx(Y,{className:"py-1",children:e.jsx(V,{value:c.action||"",onChange:d=>l(o,"action",d.target.value),placeholder:"Action",disabled:a,className:"h-7 text-xs"})}),e.jsx(Y,{className:"py-1",children:e.jsx(A,{type:"button",variant:"ghost",size:"sm",className:"h-6 w-6 p-0 text-red-500 hover:text-red-700 hover:bg-red-50",onClick:()=>i(o),disabled:a,children:e.jsx(Ts,{className:"h-3 w-3"})})})]},o))})]})})}),r.length>0&&e.jsx("div",{className:"flex justify-end bg-gray-50 px-3 py-1 rounded",children:e.jsxs("div",{className:"text-xs font-medium",children:["Total Quantity: ",m().toFixed(2)," kg"]})})]})},hc=[{value:"pending",label:"Pending"},{value:"in_progress",label:"In Progress"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"}],pc=({isOpen:r,onClose:s,onSubmit:t,editingTask:a,isLoading:n=!1})=>{const{data:i}=Rn(),{data:l}=La(),{data:m}=Xs(),{data:c}=An(),o=m.filter(y=>{const F=y.department?.toLowerCase();return F&&F==="production"?!0:y.process_name?.toLowerCase()==="grinding"}),[d,g]=u.useState({task_id:"",date_assigned:new Date().toISOString().split("T")[0],raw_product_id:"",process_id:"",staff_id:"",source_process_id:"",completed_quantity:"",date_completed:"",wastage_quantity:"",remarks:"",status:"pending"}),[b,w]=u.useState([]),[T,L]=u.useState({}),[f,N]=u.useState(null),E=new Date,D=Us(E),k=Os(E),{statusRecords:$}=qn(D.toISOString().split("T")[0],k.toISOString().split("T")[0],{processId:void 0}),{statusRecords:H}=$a(D.toISOString().split("T")[0],k.toISOString().split("T")[0],{processId:void 0}),_=()=>{if(!d.source_process_id||!b.length||!d.raw_product_id){N(null);return}const y=b.reduce((z,pe)=>z+(pe.quantity||0),0);if(y<=0){N({isValid:!1,availableQty:0,requiredQty:y,stockName:"Stock Items",stockSource:"Unknown",error:"Invalid quantity",validationClass:"bg-yellow-50 text-yellow-700 border-yellow-200",validationMessage:"Total quantity must be greater than 0"});return}const F=m?.find(z=>z.$id===d.source_process_id),p=c?.find(z=>z.$id===d.raw_product_id);if(!F||!p){N({isValid:!1,availableQty:0,requiredQty:y,stockName:p?.raw_product||"Unknown Product",stockSource:F?.process_name||"Unknown Process",error:"Missing reference data",validationClass:"bg-red-50 text-red-700 border-red-200",validationMessage:"Source process or raw product not found"});return}const C="Pre-Production Status",q=b[0]?.stock_name||p.raw_product;let B=H?.find(z=>z.stock_name===q&&z.process===F.process_name);if(!B&&q&&(B=H?.find(z=>z.stock_name?.toLowerCase().includes(q.toLowerCase().split("(")[0].trim())&&z.process===F.process_name)),!B){const z=q?.toLowerCase().split("(")[0].trim()||p.raw_product?.toLowerCase();B=H?.find(pe=>pe.process===F.process_name&&pe.stock_name?.toLowerCase().includes(z))}const U=B?.closing_balance??0,ie=U>=y;console.log("ðŸ” RTQV Production Status Check (Enhanced):",{raw_product:p.raw_product,stock_name_from_items:q,source_process:F.process_name,statusRecord_found:!!B,statusRecord_stock_name:B?.stock_name,statusRecord_process:B?.process,closing_balance:B?.closing_balance,availableQty:U,totalRequiredQty:y,dataSource:C,forced_fresh:!0,stock_items:b.map(z=>({stock_name:z.stock_name,quantity:z.quantity})),all_preproduction_records:H?.map(z=>({stock_name:z.stock_name,process:z.process,closing_balance:z.closing_balance}))});let ue="",je="";ie?(ue="bg-green-50 text-green-700 border-green-200",je=`âœ“ Available: ${U}kg (Required: ${y}kg)`):U===0?(ue="bg-red-50 text-red-700 border-red-200",je=`âœ— Out of stock (Required: ${y}kg)`):(ue="bg-orange-50 text-orange-700 border-orange-200",je=`âš  Insufficient stock: ${U}kg available (Required: ${y}kg)`),N({isValid:ie,availableQty:U,requiredQty:y,stockName:q||p.raw_product,stockSource:F.process_name,dataSource:C,isLoading:!1,validationClass:ue,validationMessage:je})};u.useEffect(()=>{_()},[d.source_process_id,d.raw_product_id,b,m,c,$,H]);const Q=m.filter(y=>y.process_name==="RFP");u.useEffect(()=>{if(r)if(a)g({task_id:a.task_id||"",date_assigned:a.date||"",raw_product_id:a.raw_product_id||"",process_id:a.process_id||"",staff_id:a.staff_id||"",source_process_id:a.source_process_id||"",completed_quantity:a.completed_quantity?.toString()||"",date_completed:a.date_completed||"",wastage_quantity:a.wastage_quantity?.toString()||"",remarks:a.remarks||"",status:a.status||"pending"}),a.stock_items&&w(a.stock_items.map(y=>({stock_id:y.stock_id,stock_name:y.stock_name,quantity:y.quantity,action:y.action||""})));else{const y=`PROD${Date.now().toString().slice(-6)}`;g({task_id:y,date_assigned:new Date().toISOString().split("T")[0],raw_product_id:"",process_id:"",staff_id:"",source_process_id:"",completed_quantity:"",date_completed:"",wastage_quantity:"",remarks:"",status:"pending"}),w([])}},[a,r]);const K=()=>b.reduce((y,F)=>y+(F.quantity||0),0),S=()=>{const y={};return d.task_id.trim()||(y.task_id="Task ID is required"),d.date_assigned||(y.date_assigned="Date is required"),d.raw_product_id||(y.raw_product_id="Raw product is required"),d.process_id||(y.process_id="Process is required"),d.staff_id||(y.staff_id="Staff is required"),d.source_process_id||(y.source_process_id="Source process is required"),(!d.completed_quantity||parseFloat(d.completed_quantity)<=0)&&(y.completed_quantity="Completed quantity is required and must be greater than 0"),b.length===0&&(y.stock_items="At least one stock item is required"),d.wastage_quantity&&parseFloat(d.wastage_quantity)<0&&(y.wastage_quantity="Wastage quantity cannot be negative"),b.forEach((F,p)=>{F.stock_id||(y[`stock_item_${p}_stock`]=`Stock is required for item ${p+1}`),(!F.quantity||F.quantity<=0)&&(y[`stock_item_${p}_quantity`]=`Quantity must be greater than 0 for item ${p+1}`)}),L(y),Object.keys(y).length===0},h=y=>{if(y.preventDefault(),!S())return;const F={task_id:d.task_id,date:d.date_assigned,raw_product_id:d.raw_product_id,process_id:d.process_id,staff_id:d.staff_id,source_process_id:d.source_process_id,assigned_quantity:K(),completed_quantity:parseFloat(d.completed_quantity),wastage_quantity:d.wastage_quantity?parseFloat(d.wastage_quantity):void 0,remarks:d.remarks||void 0,status:d.status};d.date_completed&&d.date_completed.trim()!==""&&(F.date_completed=d.date_completed),t({taskData:F,stockItems:b})},I=()=>{g({task_id:"",date_assigned:new Date().toISOString().split("T")[0],raw_product_id:"",process_id:"",staff_id:"",source_process_id:"",completed_quantity:"",date_completed:"",wastage_quantity:"",remarks:"",status:"pending"}),w([]),L({}),s()};return e.jsx(Qe,{open:r,onOpenChange:I,children:e.jsxs(Ve,{className:"sm:max-w-[800px] max-w-[95vw] max-h-[90vh] overflow-y-auto",children:[e.jsxs(Be,{className:"pb-2",children:[e.jsx(ze,{className:"text-lg",children:a?"Edit Production Task":"Add New Production Task"}),e.jsx(Ye,{className:"text-sm",children:a?"Update the production task details below.":"Fill in the details to create a new production task."})]}),e.jsxs("form",{onSubmit:h,children:[e.jsxs("div",{className:"grid gap-3 py-3",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[e.jsxs("div",{children:[e.jsx(P,{htmlFor:"task_id",className:"text-xs font-medium",children:"Task ID *"}),e.jsx(V,{id:"task_id",value:d.task_id,onChange:y=>g({...d,task_id:y.target.value}),className:`h-8 text-sm ${T.task_id?"border-red-500":""}`,maxLength:15}),T.task_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:T.task_id})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"date_assigned",className:"text-xs font-medium",children:"Date *"}),e.jsx(V,{id:"date_assigned",type:"date",value:d.date_assigned,onChange:y=>g({...d,date_assigned:y.target.value}),className:`h-8 text-sm ${T.date_assigned?"border-red-500":""}`}),T.date_assigned&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:T.date_assigned})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"process_id",className:"text-xs font-medium",children:"Process *"}),e.jsxs(te,{value:d.process_id,onValueChange:y=>g({...d,process_id:y}),children:[e.jsx(ee,{className:`h-8 text-sm ${T.process_id?"border-red-500":""}`,children:e.jsx(ae,{placeholder:"Select Process"})}),e.jsx(se,{children:o.map(y=>e.jsx(v,{value:y.$id||"",children:y.process_name},y.$id))})]}),T.process_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:T.process_id})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"source_process_id",className:"text-xs font-medium",children:"Source Process *"}),e.jsxs(te,{value:d.source_process_id,onValueChange:y=>g({...d,source_process_id:y}),children:[e.jsx(ee,{className:`h-8 text-sm ${T.source_process_id?"border-red-500":""}`,children:e.jsx(ae,{placeholder:"Select Source"})}),e.jsx(se,{children:Q.map(y=>e.jsx(v,{value:y.$id||"",children:y.process_name},y.$id))})]}),T.source_process_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:T.source_process_id})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(P,{htmlFor:"raw_product_id",className:"text-xs font-medium",children:"Raw Product *"}),e.jsxs(te,{value:d.raw_product_id,onValueChange:y=>g({...d,raw_product_id:y}),children:[e.jsx(ee,{className:`h-8 text-sm ${T.raw_product_id?"border-red-500":""}`,children:e.jsx(ae,{placeholder:"Select Raw Product"})}),e.jsx(se,{children:c.map(y=>e.jsx(v,{value:y.$id||"",children:y.raw_product},y.$id))})]}),T.raw_product_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:T.raw_product_id})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"staff_id",className:"text-xs font-medium",children:"Staff Name *"}),e.jsxs(te,{value:d.staff_id,onValueChange:y=>g({...d,staff_id:y}),children:[e.jsx(ee,{className:`h-8 text-sm ${T.staff_id?"border-red-500":""}`,children:e.jsx(ae,{placeholder:"Select Staff"})}),e.jsx(se,{children:l.map(y=>e.jsx(v,{value:y.$id||"",children:y.staff_name},y.$id))})]}),T.staff_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:T.staff_id})]})]}),e.jsxs("div",{children:[e.jsx(P,{className:"text-base font-semibold",children:"Stock Items"}),e.jsx(mc,{items:b,onItemsChange:w,availableStocks:i,isLoading:n}),T.stock_items&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:T.stock_items}),f&&e.jsxs("div",{className:`mt-2 p-3 rounded-md border text-sm ${f.validationClass}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("div",{className:"font-medium",children:f.stockName}),e.jsxs("div",{className:"text-xs opacity-75",children:["Source: ",f.dataSource]})]}),e.jsx("div",{className:"mb-1",children:f.validationMessage}),f.error&&e.jsxs("div",{className:"text-xs mt-1 opacity-75",children:["Error: ",f.error]}),f.isLoading&&e.jsxs("div",{className:"flex items-center gap-2 text-xs mt-1",children:[e.jsx("div",{className:"animate-spin h-3 w-3 border border-current border-t-transparent rounded-full"}),"Loading fresh data from ",f.dataSource,"..."]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(P,{htmlFor:"assigned_quantity",className:"text-xs font-medium",children:"Assigned Qty (Auto-calculated)"}),e.jsxs("div",{className:"relative",children:[e.jsx(V,{id:"assigned_quantity",type:"number",value:K().toFixed(2),disabled:!0,className:"bg-gray-50 h-8 text-sm pr-8",maxLength:10}),e.jsx("span",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-xs text-gray-500",children:"kg"})]})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"completed_quantity",className:"text-xs font-medium",children:"Completed Qty *"}),e.jsxs("div",{className:"relative",children:[e.jsx(V,{id:"completed_quantity",type:"number",step:"0.01",min:"0",value:d.completed_quantity,onChange:y=>g({...d,completed_quantity:y.target.value}),className:`h-8 text-sm pr-8 ${T.completed_quantity?"border-red-500":""}`,maxLength:10}),e.jsx("span",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-xs text-gray-500",children:"kg"})]}),T.completed_quantity&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:T.completed_quantity})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"wastage_quantity",className:"text-xs font-medium",children:"Wastage Qty"}),e.jsxs("div",{className:"relative",children:[e.jsx(V,{id:"wastage_quantity",type:"number",step:"0.01",min:"0",value:d.wastage_quantity,onChange:y=>g({...d,wastage_quantity:y.target.value}),className:`h-8 text-sm pr-8 ${T.wastage_quantity?"border-red-500":""}`,maxLength:10}),e.jsx("span",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-xs text-gray-500",children:"kg"})]}),T.wastage_quantity&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:T.wastage_quantity})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(P,{htmlFor:"date_completed",className:"text-xs font-medium",children:"Date Completed"}),e.jsx(V,{id:"date_completed",type:"date",value:d.date_completed,onChange:y=>g({...d,date_completed:y.target.value}),className:"h-8 text-sm"})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"status",className:"text-xs font-medium",children:"Status"}),e.jsxs(te,{value:d.status,onValueChange:y=>g({...d,status:y}),children:[e.jsx(ee,{className:"h-8 text-sm",children:e.jsx(ae,{})}),e.jsx(se,{children:hc.map(y=>e.jsx(v,{value:y.value,children:y.label},y.value))})]})]})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"remarks",className:"text-xs font-medium",children:"Remarks"}),e.jsx(Hs,{id:"remarks",value:d.remarks,onChange:y=>g({...d,remarks:y.target.value}),placeholder:"Enter any remarks",rows:2,className:"text-sm resize-none"})]})]}),e.jsxs(He,{className:"pt-3 flex-col sm:flex-row gap-2",children:[e.jsx(A,{type:"button",variant:"outline",onClick:I,className:"h-8 px-4 text-sm w-full sm:w-auto",children:"Cancel"}),e.jsx(A,{type:"submit",disabled:n,className:"h-8 px-4 text-sm w-full sm:w-auto",children:n?"Saving...":a?"Update":"Save"})]})]})]})})},xc=()=>{const[r,s]=u.useState(""),[t,a]=u.useState(!1),[n,i]=u.useState(null),[l,m]=u.useState([]),[c,o]=u.useState({show:!1,message:"",type:"success"}),[d,g]=u.useState("all"),[b,w]=u.useState("all"),[T,L]=u.useState("all"),[f,N]=u.useState({from:"",to:""}),[E,D]=u.useState(1),[k,$]=u.useState(50),{tasks:H,isLoading:_,error:Q,refetch:K}=Cn(),{createTask:S,updateTask:h,deleteTask:I}=ql(),{config:y}=bs("production-tasks"),{validationRules:F,canImport:p}=Ns("production-tasks"),{currentSort:C,handleSort:G,getSortedData:q}=Bs();Xs();const B=(R,M)=>{o({show:!0,message:R,type:M}),setTimeout(()=>o({show:!1,message:"",type:"success"}),3e3)},U=H.filter(R=>{const M=R.task_id.toLowerCase().includes(r.toLowerCase())||R.raw_product_name.toLowerCase().includes(r.toLowerCase())||R.staff_name.toLowerCase().includes(r.toLowerCase())||R.process_name.toLowerCase().includes(r.toLowerCase()),be=d==="all"||R.raw_product_name.toLowerCase().includes(d.toLowerCase()),Se=b==="all"||R.process_name.toLowerCase().includes(b.toLowerCase()),$e=T==="all"||R.staff_name.toLowerCase().includes(T.toLowerCase()),Je=(!f.from||R.date>=f.from)&&(!f.to||R.date<=f.to);return M&&be&&Se&&$e&&Je}),ie=Array.from(new Set(H.map(R=>R.raw_product_name))).sort(),ue=Array.from(new Set(H.map(R=>R.process_name))).sort(),je=Array.from(new Set(H.map(R=>R.staff_name))).sort(),z=U.length,pe=Math.ceil(z/k),fe=(E-1)*k,Te=fe+k,Ze=U.slice(fe,Te);u.useEffect(()=>{D(1)},[r,d,b,T,f,k]);const xe=async R=>{try{n?(await h.mutateAsync({id:n.$id,taskData:R.taskData,stockItems:R.stockItems}),B("Production task updated successfully","success")):(await S.mutateAsync(R),B("Production task created successfully","success")),a(!1),i(null)}catch(M){console.error("Error saving task:",M),B("Failed to save task","error")}},Ce=R=>{i(R),a(!0)},ns=async R=>{if(window.confirm("Are you sure you want to delete this task?"))try{await I.mutateAsync(R.$id),B("Production task deleted successfully","success")}catch(M){console.error("Error deleting task:",M),B("Failed to delete task","error")}},We=async()=>{if(l.length===0){B("Please select tasks to delete","error");return}if(window.confirm(`Are you sure you want to delete ${l.length} selected task(s)?`))try{await Promise.all(l.map(R=>I.mutateAsync(R.$id))),m([]),B(`${l.length} tasks deleted successfully`,"success")}catch(R){console.error("Error deleting tasks:",R),B("Failed to delete selected tasks","error")}},Ge=()=>{if(l.length===0){B("Please select tasks to export","error");return}B(`Exporting ${l.length} selected task(s)...`,"success")};return Q?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Production Tasks"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage production processing tasks"})]}),e.jsx(J,{children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"text-center py-12 text-red-600",children:[e.jsx("p",{className:"text-lg mb-2",children:"Error loading tasks"}),e.jsx("p",{className:"text-sm mb-4",children:Q.message}),e.jsx(A,{onClick:()=>K(),variant:"outline",children:"Retry"})]})})})]}):e.jsxs("div",{className:"space-y-6",children:[c.show&&e.jsx("div",{className:`fixed top-4 right-4 px-4 py-2 rounded-md shadow-lg z-50 ${c.type==="success"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300"}`,children:c.message}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Production Tasks"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage production processing tasks"})]}),e.jsxs(A,{className:"bg-primary hover:bg-primary/90 w-full sm:w-auto",onClick:()=>{i(null),a(!0)},children:[e.jsx(fs,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"sm:inline",children:"Add New"})]})]}),e.jsx(J,{children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4 items-stretch sm:items-center",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(ts,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(V,{placeholder:"Search tasks...",className:"pl-10",value:r,onChange:R=>s(R.target.value)})]}),p&&y&&e.jsx(gs,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:y.exportColumns.filter(R=>R.required).map(R=>R.exportHeader),optionalColumns:y.exportColumns.filter(R=>!R.required).map(R=>R.exportHeader),validationRules:F,onImportComplete:R=>{R.successfulRows>0&&(K(),B(`${R.successfulRows} production tasks imported successfully.`,"success"))}},variant:"outline"}),y&&e.jsx(xs,{data:U.map(R=>{const M={};return y.exportColumns.forEach(be=>{const Se=R[be.dataKey];M[be.exportHeader]=be.formatter?be.formatter(Se):Se}),M}),headers:y.exportColumns.map(R=>R.exportHeader),filename:"production-tasks",variant:"outline"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-3 sm:gap-4",children:[e.jsxs(te,{value:d,onValueChange:g,children:[e.jsx(ee,{className:"w-full",children:e.jsx(ae,{placeholder:"Raw Product"})}),e.jsxs(se,{children:[e.jsx(v,{value:"all",children:"All Raw Products"}),ie.map(R=>e.jsx(v,{value:R,children:R},R))]})]}),e.jsxs(te,{value:b,onValueChange:w,children:[e.jsx(ee,{className:"w-full",children:e.jsx(ae,{placeholder:"Process"})}),e.jsxs(se,{children:[e.jsx(v,{value:"all",children:"All Processes"}),ue.map(R=>e.jsx(v,{value:R,children:R},R))]})]}),e.jsxs(te,{value:T,onValueChange:L,children:[e.jsx(ee,{className:"w-full",children:e.jsx(ae,{placeholder:"Staff Name"})}),e.jsxs(se,{children:[e.jsx(v,{value:"all",children:"All Staff"}),je.map(R=>e.jsx(v,{value:R,children:R},R))]})]}),e.jsx(V,{type:"date",placeholder:"From Date",className:"w-full",value:f.from,onChange:R=>N(M=>({...M,from:R.target.value}))}),e.jsx(V,{type:"date",placeholder:"To Date",className:"w-full",value:f.to,onChange:R=>N(M=>({...M,to:R.target.value}))})]})]})})}),e.jsx(J,{children:e.jsxs(Z,{className:"pt-6",children:[l.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 p-3 bg-muted rounded-md",children:[e.jsxs("span",{className:"text-sm font-medium",children:[l.length," selected"]}),e.jsx(A,{variant:"destructive",size:"sm",onClick:We,children:"Delete Selected"}),e.jsx(A,{variant:"outline",size:"sm",onClick:Ge,children:"Export Selected"})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",fe+1," to ",Math.min(Te,z)," of ",z," records"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Records per page:"}),e.jsxs(te,{value:k.toString(),onValueChange:R=>$(Number(R)),children:[e.jsx(ee,{className:"w-[100px]",children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"50",children:"50"}),e.jsx(v,{value:"100",children:"100"}),e.jsx(v,{value:"500",children:"500"})]})]})]})]}),e.jsx("div",{className:"border rounded-md",children:e.jsx("div",{className:"overflow-auto",style:{maxHeight:"600px"},children:e.jsx(Js,{data:q(Ze.map(R=>({...R,formattedDate:new Date(R.date).toLocaleDateString("en-GB")}))),columns:[{key:"task_id",label:"Task ID",sortable:!0,dataType:"string"},{key:"formattedDate",label:"Date",sortable:!0,dataType:"date"},{key:"raw_product_name",label:"Raw Product",sortable:!0,dataType:"string"},{key:"process_name",label:"Process",sortable:!0,dataType:"string"},{key:"staff_name",label:"Staff Name",sortable:!0,dataType:"string"},{key:"assigned_quantity",label:"Assigned Qty",sortable:!0,dataType:"number",align:"right",headerClassName:"bg-purple-50",cellClassName:"bg-purple-50 font-medium"},{key:"completed_quantity",label:"Completed Qty",sortable:!0,dataType:"number",align:"right",headerClassName:"bg-green-50",cellClassName:"bg-green-50 font-medium"},{key:"wastage_quantity",label:"Wastage Qty",sortable:!0,dataType:"number",align:"right"},{key:"status",label:"Status",sortable:!0,dataType:"string",formatter:R=>e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${R==="completed"?"bg-green-100 text-green-800":R==="in_progress"?"bg-yellow-100 text-yellow-800":R==="pending"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:R==="in_progress"?"In Progress":R.charAt(0).toUpperCase()+R.slice(1)})}],onSort:G,currentSort:C,loading:_,maxHeight:"none",stickyHeader:!0,bordered:!1,searchable:!1,selectable:!0,selectedRows:l,onSelectionChange:m,rowKey:"$id",actions:[vt.edit(R=>Ce(R)),vt.delete(R=>ns(R))],emptyMessage:"No production tasks found"})})}),pe>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx(A,{variant:"outline",size:"sm",onClick:()=>D(R=>Math.max(1,R-1)),disabled:E===1,children:"Previous"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",E," of ",pe]})}),e.jsx(A,{variant:"outline",size:"sm",onClick:()=>D(R=>Math.min(pe,R+1)),disabled:E===pe,children:"Next"})]})]})}),e.jsx(pc,{isOpen:t,onClose:()=>{a(!1),i(null)},onSubmit:xe,editingTask:n,isLoading:S.isPending||h.isPending})]})},gc=[{value:"pending",label:"Pending"},{value:"in_progress",label:"In Progress"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"}],fc=({isOpen:r,onClose:s,onSubmit:t,editingTask:a,isLoading:n=!1})=>{const{data:i}=La(),{data:l}=Xs(),{data:m}=sc(),{data:c}=An(),[o,d]=u.useState({task_id:"",date_assigned:new Date().toISOString().split("T")[0],date_completed:"",raw_product_id:"",source_process_id:"",source_quantity:"",sku:"",product_id:"",process_id:"",staff_id:"",completed_quantity:"",wastage_quantity:"",remarks:"",status:"pending"}),[g,b]=u.useState({}),[w,T]=u.useState(null),L=new Date,f=Us(L),N=Os(L),{data:E}=usePostProductionStatus(f.toISOString().split("T")[0],N.toISOString().split("T")[0],void 0,{rtqvMode:!0,forceRefresh:!0}),{data:D}=useProductionStatus(f.toISOString().split("T")[0],N.toISOString().split("T")[0],void 0,{rtqvMode:!0,forceRefresh:!0}),k=()=>{if(!o.source_process_id||!o.source_quantity||!o.product_id){T(null);return}const p=parseFloat(o.source_quantity);if(p<=0){T({isValid:!1,availableQty:0,requiredQty:p,stockName:"Source Material",stockSource:"Unknown",error:"Invalid quantity",validationClass:"bg-yellow-50 text-yellow-700 border-yellow-200",validationMessage:"Source quantity must be greater than 0"});return}const C=l?.find(fe=>fe.$id===o.source_process_id),G=m?.find(fe=>fe.$id===o.product_id);if(!C||!G){T({isValid:!1,availableQty:0,requiredQty:p,stockName:G?.product_name||"Unknown Product",stockSource:C?.process_name||"Unknown Process",error:"Missing reference data",validationClass:"bg-red-50 text-red-700 border-red-200",validationMessage:"Source process or product not found"});return}let q="",B=null,U=0;const ie=C.process_name?.toLowerCase();if(ie==="grinding"){q="Production Status";const fe=G.product_name;if(B=D?.find(Te=>Te.stock_name===fe&&Te.process===C.process_name),!B&&fe){const Te=fe.toLowerCase().split(" ")[0];B=D?.find(Ze=>Ze.stock_name?.toLowerCase().includes(Te)&&Ze.process===C.process_name)}B||(B=D?.find(Te=>Te.process===C.process_name&&(Te.stock_name?.toLowerCase().includes("chilli")||Te.stock_name?.toLowerCase().includes("powder"))))}else ie==="packing"&&(q="Post-Production Status",B=E?.find(fe=>fe.product_name===G.product_name&&fe.process_name===C.process_name));U=B?.closing_balance??0;const ue=U>=p;console.log("ðŸ” RTQV Post-Production Status Check (Enhanced):",{product_name:G.product_name,source_process:C.process_name,source_process_type:ie,statusRecord_found:!!B,statusRecord_stock_name:B?.stock_name,statusRecord_process:B?.process,closing_balance:B?.closing_balance,availableQty:U,requiredQty:p,dataSource:q,forced_fresh:!0,all_production_records:ie==="grinding"?D?.map(fe=>({stock_name:fe.stock_name,process:fe.process,closing_balance:fe.closing_balance})):[],all_postproduction_records:ie==="packing"?E?.map(fe=>({product_name:fe.product_name,process_name:fe.process_name,closing_balance:fe.closing_balance})):[]});let je="",z="";const pe=ie==="grinding"?"kg":"units";ue?(je="bg-green-50 text-green-700 border-green-200",z=`âœ“ Available: ${U}${pe} (Required: ${p}${pe})`):U===0?(je="bg-red-50 text-red-700 border-red-200",z=`âœ— Out of stock (Required: ${p}${pe})`):(je="bg-orange-50 text-orange-700 border-orange-200",z=`âš  Insufficient stock: ${U}${pe} available (Required: ${p}${pe})`),T({isValid:ue,availableQty:U,requiredQty:p,stockName:G.product_name,stockSource:C.process_name,dataSource:q,isLoading:!1,validationClass:je,validationMessage:z})};u.useEffect(()=>{k()},[o.source_process_id,o.product_id,o.source_quantity,l,m,E,D]);const $=l.filter(p=>{const C=p.department?.toLowerCase();if(C&&C==="post-production")return!0;const G=p.process_name?.toLowerCase();return["packing","batch coding"].includes(G)});console.log("All Processes:",l.map(p=>p.process_name)),console.log("Post Production Processes:",$.map(p=>p.process_name));const H=l.find(p=>p.$id===o.process_id),_=H?.process_name==="Batch Coding",Q=H?.process_name==="Packing",K=()=>_,h=(()=>{if(!o.process_id)return[];const p=l.find(G=>G.$id===o.process_id);if(!p)return[];const C=p.process_name?.toLowerCase();return C==="packing"?l.filter(G=>G.process_name?.toLowerCase()==="grinding"):C==="batch coding"?l.filter(G=>G.process_name?.toLowerCase()==="packing"):[]})();u.useEffect(()=>{o.process_id&&(d(p=>({...p,source_process_id:"",source_quantity:_?"":p.source_quantity,raw_product_id:_?"":p.raw_product_id})),console.log("Selected Process:",H?.process_name),console.log("Is Batch Coding:",_))},[o.process_id,l,_,H]),u.useEffect(()=>{if(r)if(a){const p=C=>{if(!C)return"";try{const G=new Date(C);return isNaN(G.getTime())?"":G.toISOString().split("T")[0]}catch{return""}};d({task_id:a.task_id,date_assigned:p(a.date),date_completed:p(a.date_completed||""),raw_product_id:a.raw_product_id||"",source_process_id:a.source_process_id,source_quantity:a.source_quantity.toString(),sku:a.sku,product_id:a.product_id,process_id:a.process_id,staff_id:a.staff_id,completed_quantity:a.units?.toString()||"",wastage_quantity:a.wastage_quantity?.toString()||"",remarks:a.remarks||"",status:a.status})}else{const p=`POST${Date.now().toString().slice(-6)}`;d({task_id:p,date_assigned:new Date().toISOString().split("T")[0],date_completed:"",raw_product_id:"",source_process_id:"",source_quantity:"",sku:"",product_id:"",process_id:"",staff_id:"",completed_quantity:"",wastage_quantity:"",remarks:"",status:"pending"})}},[a,r]);const I=()=>{const p={},G=l.find(q=>q.$id===o.process_id)?.process_name==="Batch Coding";return o.task_id.trim()||(p.task_id="Task ID is required"),o.date_assigned||(p.date_assigned="Date is required"),!G&&!o.raw_product_id&&(p.raw_product_id="Raw Product is required"),o.process_id||(p.process_id="Process is required"),o.source_process_id||(p.source_process_id="Source process is required"),!G&&(!o.source_quantity||parseFloat(o.source_quantity)<=0)&&(p.source_quantity="Source quantity must be greater than 0"),o.sku.trim()||(p.sku="SKU is required"),o.product_id||(p.product_id="Product is required"),o.staff_id||(p.staff_id="Staff is required"),o.status==="completed"&&((!o.completed_quantity||parseFloat(o.completed_quantity)<=0)&&(p.completed_quantity="Completed units must be greater than 0"),o.wastage_quantity&&parseFloat(o.wastage_quantity)<0&&(p.wastage_quantity="Wastage quantity cannot be negative")),b(p),Object.keys(p).length===0},y=p=>{if(p.preventDefault(),!I())return;const G=l.find(B=>B.$id===o.process_id)?.process_name==="Batch Coding",q={task_id:o.task_id,date:o.date_assigned,date_completed:o.status==="completed"?o.date_completed:void 0,source_process_id:o.source_process_id,source_quantity:G?0:parseFloat(o.source_quantity)||0,sku:o.sku,product_id:o.product_id,process_id:o.process_id,staff_id:o.staff_id,units:o.completed_quantity?parseFloat(o.completed_quantity):0,wastage_quantity:o.status==="completed"&&o.wastage_quantity?parseFloat(o.wastage_quantity):void 0,remarks:o.remarks||void 0,status:o.status};console.log("ðŸš€ SUBMITTING POST-PRODUCTION TASK DATA:",q),t(q)},F=()=>{d({task_id:"",date_assigned:new Date().toISOString().split("T")[0],date_completed:"",raw_product_id:"",source_process_id:"",source_quantity:"",sku:"",product_id:"",process_id:"",staff_id:"",completed_quantity:"",wastage_quantity:"",remarks:"",status:"pending"}),b({}),s()};return e.jsx(Qe,{open:r,onOpenChange:F,children:e.jsxs(Ve,{className:"sm:max-w-[600px] max-w-[95vw] max-h-[90vh] overflow-y-auto",children:[e.jsxs(Be,{children:[e.jsx(ze,{children:a?"Edit Post-Production Task":"Add New Post-Production Task"}),e.jsx(Ye,{children:a?"Update the post-production task details below.":"Fill in the details to create a new post-production task."})]}),e.jsxs("form",{onSubmit:y,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(P,{htmlFor:"task_id",children:"Task ID *"}),e.jsx(V,{id:"task_id",value:o.task_id,onChange:p=>d({...o,task_id:p.target.value}),className:g.task_id?"border-red-500":""}),g.task_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:g.task_id})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"date_assigned",children:"Date Assigned *"}),e.jsx(V,{id:"date_assigned",type:"date",value:o.date_assigned,onChange:p=>d({...o,date_assigned:p.target.value}),className:g.date_assigned?"border-red-500":""}),g.date_assigned&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:g.date_assigned})]})]}),e.jsxs("div",{children:[e.jsxs(P,{htmlFor:"raw_product_id",children:["Raw Product ",!_&&"*",_&&e.jsx("span",{className:"text-muted-foreground",children:"(N/A for Batch Coding)"})]}),_?e.jsx(V,{value:"N/A",disabled:!0,className:"bg-gray-100 text-muted-foreground"}):e.jsxs(te,{value:o.raw_product_id,onValueChange:p=>d({...o,raw_product_id:p}),children:[e.jsx(ee,{className:g.raw_product_id?"border-red-500":"",children:e.jsx(ae,{placeholder:"Select Raw Product"})}),e.jsx(se,{children:c?.map(p=>e.jsx(v,{value:p.$id||"",children:p.raw_product},p.$id))})]}),g.raw_product_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:g.raw_product_id}),e.jsx("p",{className:"text-muted-foreground text-xs mt-1",children:_?"Batch Coding works with finished products (units), not raw products":"Select the raw product powder (kg) from Grinding process to be packed into units"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(P,{htmlFor:"process_id",children:"Process *"}),e.jsxs(te,{value:o.process_id,onValueChange:p=>d({...o,process_id:p,source_process_id:""}),children:[e.jsx(ee,{className:g.process_id?"border-red-500":"",children:e.jsx(ae,{placeholder:"Select Process"})}),e.jsx(se,{children:$.map(p=>e.jsx(v,{value:p.$id||"",children:p.process_name},p.$id))})]}),g.process_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:g.process_id})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"source_process_id",children:"Source Process *"}),e.jsxs(te,{value:o.source_process_id,onValueChange:p=>d({...o,source_process_id:p}),children:[e.jsx(ee,{className:g.source_process_id?"border-red-500":"",disabled:!o.process_id,children:e.jsx(ae,{placeholder:o.process_id?"Select Source Process":"First select a Process"})}),e.jsx(se,{children:h.map(p=>e.jsx(v,{value:p.$id||"",children:p.process_name},p.$id))})]}),g.source_process_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:g.source_process_id})]})]}),e.jsxs("div",{children:[e.jsxs(P,{htmlFor:"source_quantity",children:[Q?"Source Qty (kg) *":"Source Qty"," ",!K()&&!Q&&"*"]}),e.jsx(V,{id:"source_quantity",type:"number",step:"0.01",min:"0",value:K()?"N/A":o.source_quantity,onChange:p=>!K()&&d({...o,source_quantity:p.target.value}),className:g.source_quantity?"border-red-500":"",disabled:K(),placeholder:K()?"N/A":Q?"Raw product quantity in kg":"Enter source quantity"}),g.source_quantity&&!K()&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:g.source_quantity}),K()&&e.jsx("p",{className:"text-muted-foreground text-xs mt-1",children:"Source quantity is not required for Batch Coding"}),Q&&e.jsx("p",{className:"text-muted-foreground text-xs mt-1",children:"Raw product powder quantity from Grinding process"}),w&&!K()&&e.jsxs("div",{className:`mt-2 p-3 rounded-md border text-sm ${w.validationClass}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("div",{className:"font-medium",children:w.stockName}),e.jsxs("div",{className:"text-xs opacity-75",children:["Source: ",w.dataSource]})]}),e.jsx("div",{className:"mb-1",children:w.validationMessage}),w.error&&e.jsxs("div",{className:"text-xs mt-1 opacity-75",children:["Error: ",w.error]}),w.isLoading&&e.jsxs("div",{className:"flex items-center gap-2 text-xs mt-1",children:[e.jsx("div",{className:"animate-spin h-3 w-3 border border-current border-t-transparent rounded-full"}),"Loading fresh data from ",w.dataSource,"..."]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(P,{htmlFor:"sku",children:"SKU *"}),e.jsx(V,{id:"sku",value:o.sku,onChange:p=>d({...o,sku:p.target.value}),className:g.sku?"border-red-500":"",placeholder:"Enter SKU"}),g.sku&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:g.sku})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"product_id",children:"Product *"}),e.jsxs(te,{value:o.product_id,onValueChange:p=>d({...o,product_id:p}),children:[e.jsx(ee,{className:g.product_id?"border-red-500":"",children:e.jsx(ae,{placeholder:"Select Product"})}),e.jsx(se,{children:m.map(p=>e.jsx(v,{value:p.$id||"",children:p.product},p.$id))})]}),g.product_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:g.product_id})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(P,{htmlFor:"staff_id",children:"Staff Name *"}),e.jsxs(te,{value:o.staff_id,onValueChange:p=>d({...o,staff_id:p}),children:[e.jsx(ee,{className:g.staff_id?"border-red-500":"",children:e.jsx(ae,{placeholder:"Select Staff"})}),e.jsx(se,{children:i.map(p=>e.jsx(v,{value:p.$id||"",children:p.staff_name},p.$id))})]}),g.staff_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:g.staff_id})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"status",children:"Status"}),e.jsxs(te,{value:o.status,onValueChange:p=>d({...o,status:p}),children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsx(se,{children:gc.map(p=>e.jsx(v,{value:p.value,children:p.label},p.value))})]})]})]}),o.status==="completed"&&e.jsxs("div",{className:"grid grid-cols-3 gap-4 p-4 border rounded-md bg-muted/50",children:[e.jsxs("div",{children:[e.jsx(P,{htmlFor:"date_completed",children:"Date Completed *"}),e.jsx(V,{id:"date_completed",type:"date",value:o.date_completed,onChange:p=>d({...o,date_completed:p.target.value}),className:g.date_completed?"border-red-500":""}),g.date_completed&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:g.date_completed})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"completed_quantity",children:"Completed Units *"}),e.jsx(V,{id:"completed_quantity",type:"number",step:"0.01",min:"0",value:o.completed_quantity,onChange:p=>d({...o,completed_quantity:p.target.value}),className:g.completed_quantity?"border-red-500":"",placeholder:"Enter completed units"}),g.completed_quantity&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:g.completed_quantity})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"wastage_quantity",children:"Wastage Qty"}),e.jsx(V,{id:"wastage_quantity",type:"number",step:"0.01",min:"0",value:o.wastage_quantity,onChange:p=>d({...o,wastage_quantity:p.target.value}),className:g.wastage_quantity?"border-red-500":"",placeholder:"Enter wastage qty (optional)"}),g.wastage_quantity&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:g.wastage_quantity})]})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"remarks",children:"Remarks"}),e.jsx(Hs,{id:"remarks",value:o.remarks,onChange:p=>d({...o,remarks:p.target.value}),placeholder:"Enter any remarks",rows:3})]})]}),e.jsxs(He,{className:"flex-col sm:flex-row gap-2 pt-4",children:[e.jsx(A,{type:"button",variant:"outline",onClick:F,className:"w-full sm:w-auto",children:"Cancel"}),e.jsx(A,{type:"submit",disabled:n,className:"w-full sm:w-auto",children:n?"Saving...":a?"Update":"Save"})]})]})]})})},jc=()=>{const[r,s]=u.useState(""),[t,a]=u.useState(!1),[n,i]=u.useState(null),[l,m]=u.useState([]),[c,o]=u.useState({show:!1,message:"",type:"success"}),[d,g]=u.useState("all"),[b,w]=u.useState("all"),[T,L]=u.useState("all"),[f,N]=u.useState({from:"",to:""}),[E,D]=u.useState(1),[k,$]=u.useState(50),{tasks:H,isLoading:_,error:Q,refetch:K}=Pn(),{createTask:S,updateTask:h,deleteTask:I}=Fl(),{config:y}=bs("post-production-tasks"),{validationRules:F,canImport:p}=Ns("post-production-tasks"),{currentSort:C,handleSort:G,getSortedData:q}=Bs(),{data:B}=Xs(),U=(M,be)=>{o({show:!0,message:M,type:be}),setTimeout(()=>o({show:!1,message:"",type:"success"}),3e3)},ie=H.filter(M=>{const be=M.task_id.toLowerCase().includes(r.toLowerCase())||M.product_name.toLowerCase().includes(r.toLowerCase())||M.staff_name.toLowerCase().includes(r.toLowerCase())||M.process_name.toLowerCase().includes(r.toLowerCase())||M.stock_name&&M.stock_name.toLowerCase().includes(r.toLowerCase())||M.sku&&M.sku.toLowerCase().includes(r.toLowerCase()),Se=d==="all"||M.product_name.toLowerCase().includes(d.toLowerCase()),$e=b==="all"||M.process_name.toLowerCase().includes(b.toLowerCase()),Je=T==="all"||M.staff_name.toLowerCase().includes(T.toLowerCase()),ls=(!f.from||M.date_assigned>=f.from)&&(!f.to||M.date_assigned<=f.to);return be&&Se&&$e&&Je&&ls}),ue=Array.from(new Set(H.map(M=>M.product_name))).sort(),je=Array.from(new Set(H.map(M=>M.process_name))).sort(),z=Array.from(new Set(H.map(M=>M.staff_name))).sort(),pe=ie.length,fe=Math.ceil(pe/k),Te=(E-1)*k,Ze=Te+k,xe=ie.slice(Te,Ze);u.useEffect(()=>{D(1)},[r,d,b,T,f,k]);const Ce=async M=>{try{const be=B.find($e=>$e.$id===M.process_id),Se=be?.process_name?.toLowerCase()||"packing";if(console.log("ðŸ” Post-production task validation data:",{isEdit:!!n,processId:M.process_id,selectedProcess:be,processName:Se,rawProductId:M.product_id,sourceProcessId:M.source_process_id,sourceQuantity:M.source_quantity,productId:M.product_id,allData:M}),n){const $e=n.source_quantity||0,Je=parseFloat(M.source_quantity)||0,ls=Je-$e;if(console.log("ðŸ”„ Post-production task edit validation:",{originalQuantity:$e,newQuantity:Je,quantityDifference:ls,needsValidation:ls>0}),ls<=0)await h.mutateAsync({id:n.$id,data:M}),U("Post-production task updated successfully","success"),a(!1),i(null);else{const j=B.find(es=>es.$id===M.source_process_id)?.process_name||"Grinding",oe=Se==="batch_coding"||Se==="batch coding",ye=parseFloat(M.source_quantity)||0;console.log("ðŸš¨ POST-PRODUCTION EDIT VALIDATION TRIGGERED:",{processName:Se,sourceProcess:j,rawProductId:M.product_id,sourceQuantity:M.source_quantity,quantityToValidate:ye,newQuantity:Je,productId:M.product_id});const _e=await validateTaskCreation(Se,j,ye,void 0,M.product_id,async es=>{const ws=es?{...M,source_quantity:es}:M;console.log("ðŸ”„ UPDATING POST-PRODUCTION TASK WITH ADJUSTED QUANTITY:",ws),await h.mutateAsync({id:n.$id,data:ws}),U("Post-production task updated successfully","success"),a(!1),i(null)});console.log("ðŸ” POST-PRODUCTION EDIT VALIDATION RESULT:",_e)}}else{const Je=B.find(oe=>oe.$id===M.source_process_id)?.process_name||"Grinding",ls=Se==="batch_coding"||Se==="batch coding",Ds=parseFloat(M.source_quantity)||0;console.log("ðŸ” PROCESS TYPE DEBUG:",{processName:Se,isBatchCoding:ls,sourceQuantity:M.source_quantity,quantityToValidate:Ds}),console.log("ðŸš¨ POST-PRODUCTION NEW TASK VALIDATION:",{processName:Se,sourceProcess:Je,rawProductId:M.product_id,sourceQuantity:M.source_quantity,quantityToValidate:Ds,productId:M.product_id});const j=M;await S.mutateAsync(j),U("Post-production task created successfully","success"),a(!1),i(null)}}catch(be){console.error("Error saving task:",be),U("Failed to save task","error")}},ns=M=>{i(M),a(!0)},We=async M=>{if(window.confirm("Are you sure you want to delete this task?"))try{await I.mutateAsync(M.$id),U("Post-production task deleted successfully","success")}catch(be){console.error("Error deleting task:",be),U("Failed to delete task","error")}},Ge=async()=>{if(l.length===0){U("Please select tasks to delete","error");return}if(window.confirm(`Are you sure you want to delete ${l.length} selected task(s)?`))try{await Promise.all(l.map(M=>I.mutateAsync(M.$id))),m([]),U(`${l.length} tasks deleted successfully`,"success")}catch(M){console.error("Error deleting tasks:",M),U("Failed to delete selected tasks","error")}},R=()=>{if(l.length===0){U("Please select tasks to export","error");return}U(`Exporting ${l.length} selected task(s)...`,"success")};return Q?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Post-Production Tasks"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage post-production processing tasks"})]}),e.jsx(J,{children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"text-center py-12 text-red-600",children:[e.jsx("p",{className:"text-lg mb-2",children:"Error loading tasks"}),e.jsx("p",{className:"text-sm mb-4",children:Q.message}),e.jsx(A,{onClick:()=>K(),variant:"outline",children:"Retry"})]})})})]}):e.jsxs("div",{className:"space-y-6",children:[c.show&&e.jsx("div",{className:`fixed top-4 right-4 px-4 py-2 rounded-md shadow-lg z-50 ${c.type==="success"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300"}`,children:c.message}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Post-Production Tasks"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage post-production processing tasks"})]}),e.jsxs(A,{className:"bg-primary hover:bg-primary/90",onClick:()=>{i(null),a(!0)},children:[e.jsx(fs,{className:"h-4 w-4 mr-2"}),"Add New"]})]}),e.jsx(J,{children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(ts,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(V,{placeholder:"Search tasks...",className:"pl-10",value:r,onChange:M=>s(M.target.value)})]}),p&&y&&e.jsx(gs,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:y.exportColumns.filter(M=>M.required).map(M=>M.exportHeader),optionalColumns:y.exportColumns.filter(M=>!M.required).map(M=>M.exportHeader),validationRules:F,onImportComplete:M=>{M.successfulRows>0&&(K(),U(`${M.successfulRows} post-production tasks imported successfully.`,"success"))}},variant:"outline"}),y&&e.jsx(xs,{data:ie.map(M=>{const be={};return y.exportColumns.forEach(Se=>{const $e=M[Se.dataKey];be[Se.exportHeader]=Se.formatter?Se.formatter($e):$e}),be}),headers:y.exportColumns.map(M=>M.exportHeader),filename:"post-production-tasks",variant:"outline"})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs(te,{value:d,onValueChange:g,children:[e.jsx(ee,{className:"w-[180px]",children:e.jsx(ae,{placeholder:"Product"})}),e.jsxs(se,{children:[e.jsx(v,{value:"all",children:"All Products"}),ue.map(M=>e.jsx(v,{value:M,children:M},M))]})]}),e.jsxs(te,{value:b,onValueChange:w,children:[e.jsx(ee,{className:"w-[180px]",children:e.jsx(ae,{placeholder:"Process"})}),e.jsxs(se,{children:[e.jsx(v,{value:"all",children:"All Processes"}),je.map(M=>e.jsx(v,{value:M,children:M},M))]})]}),e.jsxs(te,{value:T,onValueChange:L,children:[e.jsx(ee,{className:"w-[180px]",children:e.jsx(ae,{placeholder:"Staff Name"})}),e.jsxs(se,{children:[e.jsx(v,{value:"all",children:"All Staff"}),z.map(M=>e.jsx(v,{value:M,children:M},M))]})]}),e.jsx(V,{type:"date",placeholder:"From Date",className:"w-[150px]",value:f.from,onChange:M=>N(be=>({...be,from:M.target.value}))}),e.jsx(V,{type:"date",placeholder:"To Date",className:"w-[150px]",value:f.to,onChange:M=>N(be=>({...be,to:M.target.value}))})]})]})})}),e.jsx(J,{children:e.jsxs(Z,{className:"pt-6",children:[l.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 p-3 bg-muted rounded-md",children:[e.jsxs("span",{className:"text-sm font-medium",children:[l.length," selected"]}),e.jsx(A,{variant:"destructive",size:"sm",onClick:Ge,children:"Delete Selected"}),e.jsx(A,{variant:"outline",size:"sm",onClick:R,children:"Export Selected"})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",Te+1," to ",Math.min(Ze,pe)," of ",pe," records"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Records per page:"}),e.jsxs(te,{value:k.toString(),onValueChange:M=>$(Number(M)),children:[e.jsx(ee,{className:"w-[100px]",children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"50",children:"50"}),e.jsx(v,{value:"100",children:"100"}),e.jsx(v,{value:"500",children:"500"})]})]})]})]}),e.jsx("div",{className:"border rounded-md",children:e.jsx("div",{className:"overflow-auto",style:{maxHeight:"600px"},children:e.jsx(Js,{data:q(xe),columns:[{key:"task_id",label:"Task ID",sortable:!0,dataType:"string"},{key:"date",label:"Date Assigned",sortable:!0,dataType:"date"},{key:"date_completed",label:"Date Completed",sortable:!0,dataType:"date"},{key:"source_quantity",label:"Source Qty",sortable:!0,dataType:"number",align:"right"},{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"product_name",label:"Product",sortable:!0,dataType:"string"},{key:"process_name",label:"Process",sortable:!0,dataType:"string"},{key:"staff_name",label:"Staff Name",sortable:!0,dataType:"string"},{key:"units",label:"Completed Units",sortable:!0,dataType:"number",align:"right",headerClassName:"bg-green-50",cellClassName:"bg-green-50 font-medium"},{key:"wastage_quantity",label:"Wastage Qty",sortable:!0,dataType:"number",align:"right"},{key:"remarks",label:"Remarks",sortable:!0,dataType:"string"},{key:"status",label:"Status",sortable:!0,dataType:"string",formatter:M=>e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${M==="completed"?"bg-green-100 text-green-800":M==="in_progress"?"bg-yellow-100 text-yellow-800":M==="pending"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:M==="in_progress"?"In Progress":M.charAt(0).toUpperCase()+M.slice(1)})}],onSort:G,currentSort:C,loading:_,maxHeight:"none",stickyHeader:!0,bordered:!1,searchable:!1,selectable:!0,selectedRows:l,onSelectionChange:m,rowKey:"$id",actions:[vt.edit(M=>ns(M)),vt.delete(M=>We(M))],emptyMessage:"No post-production tasks found"})})}),fe>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx(A,{variant:"outline",size:"sm",onClick:()=>D(M=>Math.max(1,M-1)),disabled:E===1,children:"Previous"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",E," of ",fe]})}),e.jsx(A,{variant:"outline",size:"sm",onClick:()=>D(M=>Math.min(fe,M+1)),disabled:E===fe,children:"Next"})]})]})}),e.jsx(fc,{isOpen:t,onClose:()=>{a(!1),i(null)},onSubmit:Ce,editingTask:n,isLoading:S.isPending||h.isPending})]})},Fn=ci,Ma=u.forwardRef(({className:r,...s},t)=>e.jsx(Ir,{ref:t,className:re("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",r),...s}));Ma.displayName=Ir.displayName;const xt=u.forwardRef(({className:r,...s},t)=>e.jsx($r,{ref:t,className:re("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",r),...s}));xt.displayName=$r.displayName;const hs=u.forwardRef(({className:r,...s},t)=>e.jsx(Lr,{ref:t,className:re("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",r),...s}));hs.displayName=Lr.displayName;class yc{DEFAULT_OPTIONS={maxWidth:200,maxHeight:90,maxSizeKB:500,allowedTypes:["image/jpeg","image/jpg","image/png","image/svg+xml","image/webp"]};async uploadLogo(s,t={}){const a={...this.DEFAULT_OPTIONS,...t};try{return a.allowedTypes.includes(s.type)?s.size/1024>a.maxSizeKB?{success:!1,error:`File too large. Maximum: ${a.maxSizeKB}KB`}:s.type==="image/svg+xml"?{success:!0,logoBase64:await this.fileToBase64(s)}:{success:!0,logoBase64:await this.scaleImage(s,a.maxWidth,a.maxHeight)}:{success:!1,error:`Invalid file type. Allowed: ${a.allowedTypes.join(", ")}`}}catch(n){return{success:!1,error:n.message||"Failed to process logo"}}}async scaleImage(s,t,a){return new Promise((n,i)=>{const l=new Image,m=document.createElement("canvas"),c=m.getContext("2d");if(!c){i(new Error("Canvas context not available"));return}l.onload=()=>{const{width:d,height:g}=this.calculateDimensions(l.width,l.height,t,a);m.width=d,m.height=g,c.drawImage(l,0,0,d,g);const b=m.toDataURL("image/png",.9);n(b)},l.onerror=()=>i(new Error("Failed to load image"));const o=new FileReader;o.onload=d=>{l.src=d.target?.result},o.onerror=()=>i(new Error("Failed to read file")),o.readAsDataURL(s)})}calculateDimensions(s,t,a,n){let{width:i,height:l}={width:s,height:t};if(i>a||l>n){const m=a/i,c=n/l,o=Math.min(m,c);i=Math.round(i*o),l=Math.round(l*o)}return{width:i,height:l}}fileToBase64(s){return new Promise((t,a)=>{const n=new FileReader;n.onload=()=>t(n.result),n.onerror=()=>a(new Error("Failed to read file")),n.readAsDataURL(s)})}}const vc=new yc;function bc(){const{toast:r}=Ee(),{settings:s,updateSettings:t}=gn(),[a,n]=u.useState(!1),[i,l]=u.useState(s.logo||null),m=u.useRef(null),c=(w,T)=>{t({[w]:T})},o=()=>{t({logo:i||void 0}),r({title:"Success",description:"Company profile saved successfully"})},d=async w=>{const T=w.target.files?.[0];if(T){n(!0);try{const L=await vc.uploadLogo(T,{maxWidth:200,maxHeight:90,maxSizeKB:500});L.success&&L.logoBase64?(l(L.logoBase64),r({title:"Logo uploaded successfully",description:"Logo has been scaled to fit 200x90px"})):r({title:"Upload failed",description:L.error||"Unknown error",variant:"destructive"})}catch(L){r({title:"Upload failed",description:L.message||"Failed to process logo",variant:"destructive"})}finally{n(!1),m.current&&(m.current.value="")}}},g=()=>{l(null),r({title:"Logo removed",description:"Logo has been removed"})},b=()=>{m.current?.click()};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(J,{children:[e.jsxs(le,{children:[e.jsx(ce,{children:"Company Information"}),e.jsx(ve,{children:"Basic information about your company"})]}),e.jsxs(Z,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(P,{children:"Company Logo"}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:i?e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"w-48 h-20 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg flex items-center justify-center bg-gray-50 dark:bg-gray-800 overflow-hidden",children:e.jsx("img",{src:i,alt:"Company Logo",className:"max-w-full max-h-full object-contain dark:brightness-90"})}),e.jsx(A,{variant:"destructive",size:"sm",className:"absolute -top-2 -right-2 h-6 w-6 rounded-full p-0 opacity-0 group-hover:opacity-100 transition-opacity",onClick:g,children:e.jsx(gt,{className:"h-3 w-3"})})]}):e.jsx("div",{className:"w-48 h-20 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg flex items-center justify-center bg-gray-50 dark:bg-gray-800 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:b,children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ba,{className:"h-8 w-8 mx-auto text-gray-400 dark:text-gray-500 mb-2"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Click to upload"}),e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:"200x90px"})]})})}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(A,{variant:"outline",onClick:b,disabled:a,className:"gap-2",children:[e.jsx(Xt,{className:"h-4 w-4"}),a?"Uploading...":"Upload Logo"]}),i&&e.jsxs(A,{variant:"ghost",onClick:g,className:"gap-2 text-red-600 hover:text-red-700",children:[e.jsx(gt,{className:"h-4 w-4"}),"Remove"]})]}),e.jsxs(Oe,{children:[e.jsx(Ba,{className:"h-4 w-4"}),e.jsxs(Ke,{children:[e.jsx("strong",{children:"Requirements:"})," Max 500KB â€¢ 200x90px recommended â€¢ PNG, JPG, SVG, WebP â€¢ Auto-scaled to fit"]})]})]})]}),e.jsx("input",{ref:m,type:"file",accept:"image/*",onChange:d,className:"hidden"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(P,{htmlFor:"companyName",children:"Company Name *"}),e.jsx(V,{id:"companyName",value:s.companyName,onChange:w=>c("companyName",w.target.value)})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"legalName",children:"Legal Name"}),e.jsx(V,{id:"legalName",value:s.legalName,onChange:w=>c("legalName",w.target.value)})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"registrationNumber",children:"Registration Number"}),e.jsx(V,{id:"registrationNumber",value:s.registrationNumber,onChange:w=>c("registrationNumber",w.target.value)})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"taxId",children:"Tax ID / GST Number"}),e.jsx(V,{id:"taxId",value:s.taxId,onChange:w=>c("taxId",w.target.value)})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"industryType",children:"Industry Type"}),e.jsxs(te,{value:s.industryType,onValueChange:w=>c("industryType",w),children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"Manufacturing",children:"Manufacturing"}),e.jsx(v,{value:"Trading",children:"Trading"}),e.jsx(v,{value:"Services",children:"Services"}),e.jsx(v,{value:"Retail",children:"Retail"})]})]})]})]})]})]}),e.jsxs(J,{children:[e.jsxs(le,{children:[e.jsx(ce,{children:"Contact Information"}),e.jsx(ve,{children:"How to reach your company"})]}),e.jsxs(Z,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(P,{htmlFor:"address",children:"Address"}),e.jsx(Hs,{id:"address",value:s.address,onChange:w=>c("address",w.target.value),rows:2})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(P,{htmlFor:"city",children:"City"}),e.jsx(V,{id:"city",value:s.city,onChange:w=>c("city",w.target.value)})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"state",children:"State"}),e.jsx(V,{id:"state",value:s.state,onChange:w=>c("state",w.target.value)})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"postalCode",children:"Postal Code"}),e.jsx(V,{id:"postalCode",value:s.postalCode,onChange:w=>c("postalCode",w.target.value)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(P,{htmlFor:"phone",children:"Phone"}),e.jsx(V,{id:"phone",value:s.phone,onChange:w=>c("phone",w.target.value)})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"email",children:"Email"}),e.jsx(V,{id:"email",type:"email",value:s.email,onChange:w=>c("email",w.target.value)})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"website",children:"Website"}),e.jsx(V,{id:"website",value:s.website,onChange:w=>c("website",w.target.value)})]})]})]})]}),e.jsxs(J,{children:[e.jsxs(le,{children:[e.jsx(ce,{children:"Business Settings"}),e.jsx(ve,{children:"Configure your business preferences"})]}),e.jsx(Z,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(P,{htmlFor:"fiscalYearStart",children:"Fiscal Year Start Month"}),e.jsxs(te,{value:s.fiscalYearStart,onValueChange:w=>c("fiscalYearStart",w),children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"01",children:"January"}),e.jsx(v,{value:"04",children:"April"}),e.jsx(v,{value:"07",children:"July"}),e.jsx(v,{value:"10",children:"October"})]})]})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"currency",children:"Default Currency"}),e.jsxs(te,{value:s.currency,onValueChange:w=>c("currency",w),children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"INR",children:"INR - Indian Rupee"}),e.jsx(v,{value:"USD",children:"USD - US Dollar"}),e.jsx(v,{value:"EUR",children:"EUR - Euro"}),e.jsx(v,{value:"GBP",children:"GBP - British Pound"})]})]})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"timezone",children:"Time Zone"}),e.jsxs(te,{value:s.timezone,onValueChange:w=>c("timezone",w),children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"Asia/Kolkata",children:"Asia/Kolkata (IST)"}),e.jsx(v,{value:"America/New_York",children:"America/New_York (EST)"}),e.jsx(v,{value:"Europe/London",children:"Europe/London (GMT)"}),e.jsx(v,{value:"Asia/Dubai",children:"Asia/Dubai (GST)"})]})]})]})]})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(A,{onClick:o,className:"gap-2",children:[e.jsx(oa,{className:"h-4 w-4"}),"Save Changes"]})})]})}const Xa="molaga_users",Za="molaga_roles",er=[{id:"super_admin",name:"Super Admin",description:"Full system access",permissions:{masterData:"full",purchases:"full",tasks:"full",sales:"full",status:"full",reports:"full",settings:"full"},isSystemRole:!0},{id:"admin",name:"Admin",description:"All except system configuration",permissions:{masterData:"full",purchases:"full",tasks:"full",sales:"full",status:"full",reports:"full",settings:"edit"},isSystemRole:!0},{id:"manager",name:"Manager",description:"View all, edit assigned",permissions:{masterData:"view",purchases:"edit",tasks:"edit",sales:"edit",status:"view",reports:"view",settings:"none"},isSystemRole:!0},{id:"staff",name:"Staff",description:"Limited access",permissions:{masterData:"view",purchases:"view",tasks:"edit",sales:"view",status:"view",reports:"none",settings:"none"},isSystemRole:!0},{id:"viewer",name:"Viewer",description:"Read-only access",permissions:{masterData:"view",purchases:"view",tasks:"view",sales:"view",status:"view",reports:"view",settings:"none"},isSystemRole:!0}],Nc=[{id:"1",name:"Admin User",email:"admin@molaga.com",role:"super_admin",status:"active",lastLogin:new Date().toISOString(),createdAt:new Date().toISOString()}];class wc{users;roles;constructor(){this.users=this.loadUsers(),this.roles=this.loadRoles()}loadUsers(){try{const s=localStorage.getItem(Xa);if(s)return JSON.parse(s)}catch(s){console.error("Error loading users:",s)}return[...Nc]}saveUsers(){try{localStorage.setItem(Xa,JSON.stringify(this.users))}catch(s){console.error("Error saving users:",s)}}getAllUsers(){return[...this.users]}getUserById(s){return this.users.find(t=>t.id===s)}createUser(s){const t={...s,id:Date.now().toString(),createdAt:new Date().toISOString()};return this.users.push(t),this.saveUsers(),t}updateUser(s,t){const a=this.users.findIndex(n=>n.id===s);return a===-1?null:(this.users[a]={...this.users[a],...t},this.saveUsers(),this.users[a])}deleteUser(s){const t=this.users.findIndex(a=>a.id===s);return t===-1?!1:(this.users.splice(t,1),this.saveUsers(),!0)}loadRoles(){try{const s=localStorage.getItem(Za);if(s){const t=JSON.parse(s),a=[...er];return t.forEach(n=>{n.isSystemRole||a.push(n)}),a}}catch(s){console.error("Error loading roles:",s)}return[...er]}saveRoles(){try{const s=this.roles.filter(t=>!t.isSystemRole);localStorage.setItem(Za,JSON.stringify(s))}catch(s){console.error("Error saving roles:",s)}}getAllRoles(){return[...this.roles]}getRoleById(s){return this.roles.find(t=>t.id===s)}createRole(s){const t={...s,id:Date.now().toString(),isSystemRole:!1};return this.roles.push(t),this.saveRoles(),t}updateRole(s,t){const a=this.roles.findIndex(n=>n.id===s);return a===-1||this.roles[a].isSystemRole?null:(this.roles[a]={...this.roles[a],...t},this.saveRoles(),this.roles[a])}deleteRole(s){const t=this.roles.findIndex(a=>a.id===s);return t===-1||this.roles[t].isSystemRole?!1:(this.roles.splice(t,1),this.saveRoles(),!0)}}const Cs=new wc;function Sc(){const[r,s]=u.useState(Cs.getAllUsers()),t=u.useCallback(()=>{s(Cs.getAllUsers())},[]),a=u.useCallback(l=>{const m=Cs.createUser(l);return t(),m},[t]),n=u.useCallback((l,m)=>{const c=Cs.updateUser(l,m);return t(),c},[t]),i=u.useCallback(l=>{const m=Cs.deleteUser(l);return m&&t(),m},[t]);return{users:r,createUser:a,updateUser:n,deleteUser:i,refreshUsers:t}}function _c(){const[r,s]=u.useState(Cs.getAllRoles()),t=u.useCallback(()=>{s(Cs.getAllRoles())},[]),a=u.useCallback(l=>{const m=Cs.createRole(l);return t(),m},[t]),n=u.useCallback((l,m)=>{const c=Cs.updateRole(l,m);return t(),c},[t]),i=u.useCallback(l=>{const m=Cs.deleteRole(l);return m&&t(),m},[t]);return{roles:r,createRole:a,updateRole:n,deleteRole:i,refreshRoles:t}}class kc{RESET_LOG_KEY="password_reset_log";FORCE_CHANGE_KEY="force_password_change";generateTempPassword(){const t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*";let a="";a+="ABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(Math.random()*26)],a+="abcdefghijklmnopqrstuvwxyz"[Math.floor(Math.random()*26)],a+="0123456789"[Math.floor(Math.random()*10)],a+="!@#$%^&*"[Math.floor(Math.random()*8)];for(let n=a.length;n<12;n++)a+=t[Math.floor(Math.random()*t.length)];return a.split("").sort(()=>Math.random()-.5).join("")}async resetUserPassword(s,t,a,n,i){try{const l=this.generateTempPassword();return this.logPasswordReset({id:Date.now().toString(),userId:s,userName:t,userEmail:a,resetBy:`${i} (${n})`,resetAt:new Date().toISOString(),tempPassword:l,mustChangePassword:!0}),this.setForcePasswordChange(s,!0),{success:!0,tempPassword:l,message:"Password reset successfully. User must change password on next login."}}catch(l){return console.error("Password reset error:",l),{success:!1,message:l.message||"Failed to reset password"}}}logPasswordReset(s){try{const t=this.getResetLogs();t.unshift(s),t.length>100&&t.splice(100),localStorage.setItem(this.RESET_LOG_KEY,JSON.stringify(t))}catch(t){console.error("Error logging password reset:",t)}}getResetLogs(){try{const s=localStorage.getItem(this.RESET_LOG_KEY);return s?JSON.parse(s):[]}catch(s){return console.error("Error loading reset logs:",s),[]}}setForcePasswordChange(s,t){try{const a=this.getForceChangeFlags();a[s]=t,localStorage.setItem(this.FORCE_CHANGE_KEY,JSON.stringify(a))}catch(a){console.error("Error setting force change flag:",a)}}mustChangePassword(s){try{return this.getForceChangeFlags()[s]===!0}catch(t){return console.error("Error checking force change flag:",t),!1}}clearForcePasswordChange(s){this.setForcePasswordChange(s,!1)}getForceChangeFlags(){try{const s=localStorage.getItem(this.FORCE_CHANGE_KEY);return s?JSON.parse(s):{}}catch(s){return console.error("Error loading force change flags:",s),{}}}getUserResetLogs(s){return this.getResetLogs().filter(a=>a.userId===s)}clearOldLogs(){try{const s=this.getResetLogs(),t=new Date;t.setDate(t.getDate()-90);const a=s.filter(i=>new Date(i.resetAt)>t),n=s.length-a.length;return localStorage.setItem(this.RESET_LOG_KEY,JSON.stringify(a)),n}catch(s){return console.error("Error clearing old logs:",s),0}}}const Cc=new kc;function Pc(){const{toast:r}=Ee(),{user:s}=os(),{users:t,createUser:a,updateUser:n,deleteUser:i}=Sc(),{roles:l}=_c(),[m,c]=u.useState(""),[o,d]=u.useState(!1),[g,b]=u.useState(null),[w,T]=u.useState(!1),[L,f]=u.useState(null),[N,E]=u.useState(""),[D,k]=u.useState({name:"",email:"",phone:"",role:"",department:"",employeeId:"",status:"active"}),$=t.filter(y=>y.name.toLowerCase().includes(m.toLowerCase())||y.email.toLowerCase().includes(m.toLowerCase())),H=()=>{b(null),k({name:"",email:"",phone:"",role:"",department:"",employeeId:"",status:"active"}),d(!0)},_=y=>{b(y),k({name:y.name,email:y.email,phone:y.phone||"",role:y.role,department:y.department||"",employeeId:y.employeeId||"",status:y.status}),d(!0)},Q=y=>{confirm("Are you sure you want to delete this user?")&&i(y)&&r({title:"User deleted successfully"})},K=y=>{f(y),E(""),T(!0)},S=async()=>{if(!L||!s)return;const y=await Cc.resetUserPassword(L.id,L.name,L.email,s.$id,s.name);y.success&&y.tempPassword?(E(y.tempPassword),r({title:"Password Reset Successfully",description:"Temporary password has been generated. Please share it securely with the user."})):(r({title:"Password Reset Failed",description:y.message,variant:"destructive"}),T(!1),f(null))},h=()=>{navigator.clipboard.writeText(N),r({title:"Copied!",description:"Temporary password copied to clipboard"})},I=()=>{if(!D.name||!D.email||!D.role){r({title:"Please fill in all required fields",variant:"destructive"});return}g?(n(g.id,D),r({title:"User updated successfully"})):(a(D),r({title:"User created successfully"})),d(!1)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(J,{children:[e.jsx(le,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(ce,{children:"User Management"}),e.jsx(ve,{children:"Manage system users and their access"})]}),e.jsxs(A,{onClick:H,className:"gap-2",children:[e.jsx(Fi,{className:"h-4 w-4"}),"Add User"]})]})}),e.jsxs(Z,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ts,{className:"h-4 w-4 text-muted-foreground"}),e.jsx(V,{placeholder:"Search users...",value:m,onChange:y=>c(y.target.value),className:"max-w-sm"})]}),e.jsxs(ds,{children:[e.jsx(us,{children:e.jsxs(we,{children:[e.jsx(X,{children:"Name"}),e.jsx(X,{children:"Email"}),e.jsx(X,{children:"Role"}),e.jsx(X,{children:"Status"}),e.jsx(X,{children:"Last Login"}),e.jsx(X,{className:"text-right",children:"Actions"})]})}),e.jsx(ms,{children:$.map(y=>e.jsxs(we,{children:[e.jsx(Y,{className:"font-medium",children:y.name}),e.jsx(Y,{children:y.email}),e.jsx(Y,{children:y.role}),e.jsx(Y,{children:e.jsx(qe,{variant:y.status==="active"?"default":"secondary",children:y.status})}),e.jsx(Y,{children:y.lastLogin}),e.jsx(Y,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(A,{variant:"ghost",size:"sm",onClick:()=>K(y),title:"Reset Password",children:e.jsx(Ot,{className:"h-4 w-4"})}),e.jsx(A,{variant:"ghost",size:"sm",onClick:()=>_(y),children:e.jsx(Vs,{className:"h-4 w-4"})}),e.jsx(A,{variant:"ghost",size:"sm",onClick:()=>Q(y.id),children:e.jsx(Ts,{className:"h-4 w-4"})})]})})]},y.id))})]})]})]}),e.jsxs(J,{children:[e.jsxs(le,{children:[e.jsx(ce,{children:"Roles & Permissions"}),e.jsx(ve,{children:"Configure user roles and their permissions"})]}),e.jsx(Z,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:l.map(y=>e.jsxs(J,{children:[e.jsxs(le,{children:[e.jsx(ce,{className:"text-base",children:y.name}),y.isSystemRole&&e.jsx(qe,{variant:"secondary",className:"w-fit",children:"System Role"})]}),e.jsxs(Z,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:y.description}),e.jsx("div",{className:"text-xs text-muted-foreground mb-3",children:e.jsx("div",{className:"grid grid-cols-2 gap-1",children:Object.entries(y.permissions).slice(0,4).map(([F,p])=>e.jsxs("div",{children:[F,": ",e.jsx("span",{className:"font-medium",children:p})]},F))})}),e.jsx(A,{variant:"outline",size:"sm",className:"w-full",disabled:y.isSystemRole,children:y.isSystemRole?"View Permissions":"Edit Permissions"})]})]},y.id))})})]}),e.jsx(Qe,{open:o,onOpenChange:d,children:e.jsxs(Ve,{children:[e.jsxs(Be,{children:[e.jsx(ze,{children:g?"Edit User":"Add New User"}),e.jsx(Ye,{children:g?"Update user information":"Create a new user account"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(P,{htmlFor:"name",children:"Full Name *"}),e.jsx(V,{id:"name",placeholder:"John Doe",value:D.name,onChange:y=>k({...D,name:y.target.value})})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"email",children:"Email *"}),e.jsx(V,{id:"email",type:"email",placeholder:"john@example.com",value:D.email,onChange:y=>k({...D,email:y.target.value})})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"phone",children:"Phone"}),e.jsx(V,{id:"phone",placeholder:"+91 9876543210",value:D.phone,onChange:y=>k({...D,phone:y.target.value})})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"role",children:"Role *"}),e.jsxs(te,{value:D.role,onValueChange:y=>k({...D,role:y}),children:[e.jsx(ee,{children:e.jsx(ae,{placeholder:"Select role"})}),e.jsx(se,{children:l.map(y=>e.jsx(v,{value:y.id,children:y.name},y.id))})]})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"department",children:"Department"}),e.jsx(V,{id:"department",placeholder:"Production",value:D.department,onChange:y=>k({...D,department:y.target.value})})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"employeeId",children:"Employee ID"}),e.jsx(V,{id:"employeeId",placeholder:"EMP001",value:D.employeeId,onChange:y=>k({...D,employeeId:y.target.value})})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"status",children:"Status"}),e.jsxs(te,{value:D.status,onValueChange:y=>k({...D,status:y}),children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"active",children:"Active"}),e.jsx(v,{value:"inactive",children:"Inactive"})]})]})]})]}),e.jsxs(He,{children:[e.jsx(A,{variant:"outline",onClick:()=>d(!1),children:"Cancel"}),e.jsx(A,{onClick:I,children:g?"Update":"Create"})]})]})}),e.jsx(Qe,{open:w,onOpenChange:T,children:e.jsxs(Ve,{children:[e.jsxs(Be,{children:[e.jsx(ze,{children:"Reset Password"}),e.jsxs(Ye,{children:["Reset password for ",L?.name]})]}),e.jsx("div",{className:"space-y-4 py-4",children:N?e.jsxs(e.Fragment,{children:[e.jsxs(Oe,{children:[e.jsx(Ot,{className:"h-4 w-4"}),e.jsx(Ke,{children:"Password reset successfully! Please share this temporary password securely with the user."})]}),e.jsxs("div",{children:[e.jsx(P,{children:"Temporary Password"}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(V,{value:N,readOnly:!0,className:"font-mono"}),e.jsx(A,{variant:"outline",size:"icon",onClick:h,children:e.jsx(qt,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"User must change this password on next login"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(Oe,{children:[e.jsx(Ot,{className:"h-4 w-4"}),e.jsx(Ke,{children:"A temporary password will be generated. The user will be required to change it on next login."})]}),e.jsxs("div",{children:[e.jsx(P,{children:"User Email"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:L?.email})]})]})}),e.jsx(He,{children:N?e.jsx(A,{onClick:()=>{T(!1),f(null),E("")},children:"Close"}):e.jsxs(e.Fragment,{children:[e.jsx(A,{variant:"outline",onClick:()=>T(!1),children:"Cancel"}),e.jsxs(A,{onClick:S,className:"gap-2",children:[e.jsx(Ot,{className:"h-4 w-4"}),"Generate Password"]})]})})]})})]})}class Tc{async registerWithApproval(s,t,a){try{const n=await qs.create(rt.unique(),s,t,a),i={approvalStatus:"pending",registeredAt:new Date().toISOString(),role:"viewer"};await qs.updatePrefs(i);try{await qs.deleteSession("current")}catch{}return{success:!0,message:"Registration successful. Please wait for admin approval.",userId:n.$id}}catch(n){return console.error("Registration error:",n),{success:!1,message:n.message||"Registration failed"}}}async checkApprovalStatus(s){try{const a=(await qs.get()).prefs;return!a.approvalStatus||a.approvalStatus==="approved"?{approved:!0,status:"approved",message:"User is approved"}:a.approvalStatus==="pending"?{approved:!1,status:"pending",message:"Your account is pending approval. Please wait for admin approval."}:a.approvalStatus==="rejected"?{approved:!1,status:"rejected",message:`Your account was rejected. Reason: ${a.rejectionReason||"Not specified"}`}:{approved:!1,status:"pending",message:"Unknown approval status"}}catch(t){return console.error("Approval check error:",t),{approved:!1,status:"pending",message:"Could not verify approval status"}}}async approveUser(s,t,a="viewer"){try{return{success:!0,message:"User approved successfully"}}catch(n){return console.error("Approval error:",n),{success:!1,message:n.message||"Failed to approve user"}}}async rejectUser(s,t,a){try{return{success:!0,message:"User rejected"}}catch(n){return console.error("Rejection error:",n),{success:!1,message:n.message||"Failed to reject user"}}}getPendingUsers(){try{const s=localStorage.getItem("pending_users");return s?JSON.parse(s):[]}catch(s){return console.error("Error loading pending users:",s),[]}}addPendingUser(s){try{const t=this.getPendingUsers();t.push(s),localStorage.setItem("pending_users",JSON.stringify(t))}catch(t){console.error("Error adding pending user:",t)}}removePendingUser(s){try{const a=this.getPendingUsers().filter(n=>n.$id!==s);localStorage.setItem("pending_users",JSON.stringify(a))}catch(t){console.error("Error removing pending user:",t)}}updatePendingUserStatus(s,t,a){try{const n=this.getPendingUsers(),i=n.find(l=>l.$id===s);i&&(i.approvalStatus=t,a&&(i.rejectionReason=a),localStorage.setItem("pending_users",JSON.stringify(n)))}catch(n){console.error("Error updating pending user:",n)}}}const ut=new Tc;function Dc(){const{toast:r}=Ee(),{user:s}=os(),[t,a]=u.useState(ut.getPendingUsers()),[n,i]=u.useState(null),[l,m]=u.useState(!1),[c,o]=u.useState(!1),[d,g]=u.useState("viewer"),[b,w]=u.useState(""),T=Cs.getAllRoles(),L=()=>{a(ut.getPendingUsers())},f=k=>{i(k),g("viewer"),m(!0)},N=k=>{i(k),w(""),o(!0)},E=async()=>{if(!(!n||!s))try{Cs.createUser({name:n.name,email:n.email,role:d,status:"active"}),ut.updatePendingUserStatus(n.$id,"approved"),ut.removePendingUser(n.$id),r({title:"User Approved",description:`${n.name} has been approved and can now login.`}),L(),m(!1),i(null)}catch(k){r({title:"Approval Failed",description:k.message||"Failed to approve user",variant:"destructive"})}},D=async()=>{if(!(!n||!s)){if(!b.trim()){r({title:"Reason Required",description:"Please provide a reason for rejection",variant:"destructive"});return}try{ut.updatePendingUserStatus(n.$id,"rejected",b),ut.removePendingUser(n.$id),r({title:"User Rejected",description:`${n.name} has been rejected.`}),L(),o(!1),i(null),w("")}catch(k){r({title:"Rejection Failed",description:k.message||"Failed to reject user",variant:"destructive"})}}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(J,{children:[e.jsxs(le,{children:[e.jsx(ce,{children:"Pending User Approvals"}),e.jsx(ve,{children:"Review and approve new user registrations"})]}),e.jsx(Z,{children:t.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(va,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No pending user approvals"})]}):e.jsxs(ds,{children:[e.jsx(us,{children:e.jsxs(we,{children:[e.jsx(X,{children:"Name"}),e.jsx(X,{children:"Email"}),e.jsx(X,{children:"Provider"}),e.jsx(X,{children:"Registered"}),e.jsx(X,{children:"Status"}),e.jsx(X,{className:"text-right",children:"Actions"})]})}),e.jsx(ms,{children:t.map(k=>e.jsxs(we,{children:[e.jsx(Y,{className:"font-medium",children:k.name}),e.jsx(Y,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qa,{className:"h-4 w-4 text-muted-foreground"}),k.email]})}),e.jsx(Y,{children:e.jsx(qe,{variant:"outline",children:k.provider})}),e.jsx(Y,{children:new Date(k.registeredAt).toLocaleDateString()}),e.jsx(Y,{children:e.jsxs(qe,{variant:"secondary",children:[e.jsx(va,{className:"h-3 w-3 mr-1"}),"Pending"]})}),e.jsx(Y,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(A,{variant:"ghost",size:"sm",onClick:()=>f(k),className:"text-green-600 hover:text-green-700",children:e.jsx(Ms,{className:"h-4 w-4"})}),e.jsx(A,{variant:"ghost",size:"sm",onClick:()=>N(k),className:"text-red-600 hover:text-red-700",children:e.jsx(ba,{className:"h-4 w-4"})})]})})]},k.$id))})]})})]}),e.jsx(Qe,{open:l,onOpenChange:m,children:e.jsxs(Ve,{children:[e.jsxs(Be,{children:[e.jsx(ze,{children:"Approve User"}),e.jsxs(Ye,{children:["Approve ",n?.name," to access the system"]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(P,{children:"Email"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:n?.email})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"role",children:"Assign Role"}),e.jsxs(te,{value:d,onValueChange:g,children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsx(se,{children:T.map(k=>e.jsx(v,{value:k.id,children:k.name},k.id))})]})]})]}),e.jsxs(He,{children:[e.jsx(A,{variant:"outline",onClick:()=>m(!1),children:"Cancel"}),e.jsxs(A,{onClick:E,className:"gap-2",children:[e.jsx(Ms,{className:"h-4 w-4"}),"Approve User"]})]})]})}),e.jsx(Qe,{open:c,onOpenChange:o,children:e.jsxs(Ve,{children:[e.jsxs(Be,{children:[e.jsx(ze,{children:"Reject User"}),e.jsxs(Ye,{children:["Reject ",n?.name,"'s registration request"]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(P,{children:"Email"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:n?.email})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"reason",children:"Rejection Reason *"}),e.jsx(Hs,{id:"reason",placeholder:"Please provide a reason for rejection...",value:b,onChange:k=>w(k.target.value),rows:4})]})]}),e.jsxs(He,{children:[e.jsx(A,{variant:"outline",onClick:()=>o(!1),children:"Cancel"}),e.jsxs(A,{onClick:D,variant:"destructive",className:"gap-2",children:[e.jsx(ba,{className:"h-4 w-4"}),"Reject User"]})]})]})})]})}const Ps=u.forwardRef(({className:r,...s},t)=>e.jsx(Mr,{className:re("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",r),...s,ref:t,children:e.jsx(di,{className:re("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));Ps.displayName=Mr.displayName;function Ec(){const{toast:r}=Ee(),{settings:s,updateSettings:t}=fn(),a=(i,l)=>{t({[i]:l})},n=()=>{r({title:"System configuration saved successfully"})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(J,{children:[e.jsxs(le,{children:[e.jsx(ce,{children:"General Settings"}),e.jsx(ve,{children:"Configure system-wide preferences"})]}),e.jsx(Z,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(P,{htmlFor:"language",children:"Default Language"}),e.jsxs(te,{value:s.language,onValueChange:i=>a("language",i),children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"en",children:"English"}),e.jsx(v,{value:"hi",children:"Hindi"}),e.jsx(v,{value:"ta",children:"Tamil"}),e.jsx(v,{value:"te",children:"Telugu"})]})]})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"dateFormat",children:"Date Format"}),e.jsxs(te,{value:s.dateFormat,onValueChange:i=>a("dateFormat",i),children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"DD/MM/YYYY",children:"DD/MM/YYYY"}),e.jsx(v,{value:"MM/DD/YYYY",children:"MM/DD/YYYY"}),e.jsx(v,{value:"YYYY-MM-DD",children:"YYYY-MM-DD"})]})]})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"timeFormat",children:"Time Format"}),e.jsxs(te,{value:s.timeFormat,onValueChange:i=>a("timeFormat",i),children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"12",children:"12-hour"}),e.jsx(v,{value:"24",children:"24-hour"})]})]})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"firstDayOfWeek",children:"First Day of Week"}),e.jsxs(te,{value:s.firstDayOfWeek,onValueChange:i=>a("firstDayOfWeek",i),children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"sunday",children:"Sunday"}),e.jsx(v,{value:"monday",children:"Monday"})]})]})]})]})})]}),e.jsxs(J,{children:[e.jsxs(le,{children:[e.jsx(ce,{children:"Number Formatting"}),e.jsx(ve,{children:"Configure how numbers are displayed"})]}),e.jsx(Z,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(P,{htmlFor:"decimalPlaces",children:"Decimal Places"}),e.jsxs(te,{value:s.decimalPlaces,onValueChange:i=>a("decimalPlaces",i),children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"0",children:"0"}),e.jsx(v,{value:"1",children:"1"}),e.jsx(v,{value:"2",children:"2"}),e.jsx(v,{value:"3",children:"3"}),e.jsx(v,{value:"4",children:"4"})]})]})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"thousandSeparator",children:"Thousand Separator"}),e.jsxs(te,{value:s.thousandSeparator,onValueChange:i=>a("thousandSeparator",i),children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:",",children:", (Comma)"}),e.jsx(v,{value:".",children:". (Period)"}),e.jsx(v,{value:" ",children:"  (Space)"})]})]})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"decimalSeparator",children:"Decimal Separator"}),e.jsxs(te,{value:s.decimalSeparator,onValueChange:i=>a("decimalSeparator",i),children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:".",children:". (Period)"}),e.jsx(v,{value:",",children:", (Comma)"})]})]})]})]})})]}),e.jsxs(J,{children:[e.jsxs(le,{children:[e.jsx(ce,{children:"Display Settings"}),e.jsx(ve,{children:"Customize the user interface"})]}),e.jsxs(Z,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(P,{htmlFor:"recordsPerPage",children:"Records Per Page"}),e.jsxs(te,{value:s.recordsPerPage,onValueChange:i=>a("recordsPerPage",i),children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"25",children:"25"}),e.jsx(v,{value:"50",children:"50"}),e.jsx(v,{value:"100",children:"100"}),e.jsx(v,{value:"200",children:"200"})]})]})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"theme",children:"Theme"}),e.jsxs(te,{value:s.theme,onValueChange:i=>a("theme",i),children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"light",children:"Light"}),e.jsx(v,{value:"dark",children:"Dark"}),e.jsx(v,{value:"auto",children:"Auto"})]})]})]})]}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(P,{htmlFor:"sidebarCollapsed",children:"Sidebar Collapsed by Default"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Start with a collapsed sidebar"})]}),e.jsx(Ps,{id:"sidebarCollapsed",checked:s.sidebarCollapsed,onCheckedChange:i=>a("sidebarCollapsed",i)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(P,{htmlFor:"showTooltips",children:"Show Tooltips"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Display helpful tooltips"})]}),e.jsx(Ps,{id:"showTooltips",checked:s.showTooltips,onCheckedChange:i=>a("showTooltips",i)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(P,{htmlFor:"enableAnimations",children:"Enable Animations"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Use smooth transitions"})]}),e.jsx(Ps,{id:"enableAnimations",checked:s.enableAnimations,onCheckedChange:i=>a("enableAnimations",i)})]})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(A,{onClick:n,className:"gap-2",children:[e.jsx(oa,{className:"h-4 w-4"}),"Save Configuration"]})})]})}class Rc{BACKUP_VERSION="1.0";APP_VERSION="1.0.0";getCollectionsList(){return["purchases","vendors","stocks","products","raw_products","processes","staff","sales_channels","pre_production_tasks","production_tasks","post_production_tasks","sales_units","sales_records","stock_status","pre_production_status","production_status","post_production_status"]}async exportCollection(s,t){const a=[];let n=0;const i=100;let l=!0;try{for(;l;){const m=await Me.listDocuments(Ue,ge[s],[Ae.limit(i),Ae.offset(n)]);a.push(...m.documents),t&&t(a.length,m.total),m.documents.length<i?l=!1:n+=i}return console.log(`âœ“ Exported ${a.length} documents from ${s}`),a}catch(m){return console.error(`Error exporting ${s}:`,m),[]}}async createFullBackup(s){const t=this.getCollectionsList(),a={metadata:{version:this.BACKUP_VERSION,timestamp:new Date().toISOString(),appVersion:this.APP_VERSION,totalRecords:0,totalCollections:t.length,collections:t},collections:{}};let n=0;for(const i of t)try{const l=await this.exportCollection(i,(m,c)=>{s&&s({currentCollection:i,processedCollections:n,totalCollections:t.length,currentRecords:m,totalRecords:a.metadata.totalRecords+m,percentage:Math.round((n+m/c)/t.length*100)})});a.collections[i]=l,a.metadata.totalRecords+=l.length,n++,s&&s({currentCollection:i,processedCollections:n,totalCollections:t.length,currentRecords:l.length,totalRecords:a.metadata.totalRecords,percentage:Math.round(n/t.length*100)})}catch(l){console.error(`Failed to backup ${i}:`,l),a.collections[i]=[]}return a}async createPartialBackup(s,t){const a={metadata:{version:this.BACKUP_VERSION,timestamp:new Date().toISOString(),appVersion:this.APP_VERSION,totalRecords:0,totalCollections:s.length,collections:s},collections:{}};let n=0;for(const i of s){const l=await this.exportCollection(i);a.collections[i]=l,a.metadata.totalRecords+=l.length,n++,t&&t({currentCollection:i,processedCollections:n,totalCollections:s.length,currentRecords:l.length,totalRecords:a.metadata.totalRecords,percentage:Math.round(n/s.length*100)})}return a}async downloadBackup(s,t){const a=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),n=`molaga-backup-${new Date().toISOString().split("T")[0]}.json`;Ct.saveAs(a,t||n)}getBackupSize(s){const t=JSON.stringify(s),a=new Blob([t]).size;return a<1024?`${a} B`:a<1024*1024?`${(a/1024).toFixed(2)} KB`:`${(a/(1024*1024)).toFixed(2)} MB`}async readBackupFile(s){return new Promise((t,a)=>{const n=new FileReader;n.onload=i=>{try{const l=i.target?.result,m=JSON.parse(l);t(m)}catch{a(new Error("Invalid backup file format"))}},n.onerror=()=>{a(new Error("Failed to read backup file"))},n.readAsText(s)})}}const Vt=new Rc;class Ac{RESTORE_ORDER=["vendors","stocks","raw_products","processes","products","staff","sales_channels","purchases","pre_production_tasks","production_tasks","post_production_tasks","sales_units","sales_records","stock_status","pre_production_status","production_status","post_production_status"];async validateBackup(s){const t=[],a=[];if(s.metadata?.version||t.push("Missing backup version"),s.metadata?.timestamp||t.push("Missing backup timestamp"),!s.collections||typeof s.collections!="object")return t.push("Invalid or missing collections data"),{valid:!1,errors:t,warnings:a};const n=["products","stocks","vendors"];for(const l of n)s.collections[l]||a.push(`Missing recommended collection: ${l}`);for(const[l,m]of Object.entries(s.collections))Array.isArray(m)?m.length>0&&(m[0].$id||a.push(`Documents in ${l} may be missing $id field`)):t.push(`Invalid data format for collection: ${l}`);const i=Object.values(s.collections).reduce((l,m)=>l+m.length,0);return s.metadata.totalRecords!==i&&a.push(`Metadata record count (${s.metadata.totalRecords}) doesn't match actual count (${i})`),{valid:t.length===0,errors:t,warnings:a}}cleanDocument(s){const{$id:t,$createdAt:a,$updatedAt:n,$permissions:i,$collectionId:l,$databaseId:m,...c}=s;return c}async documentExists(s,t){try{return await Me.getDocument(Ue,ge[s],t),!0}catch{return!1}}async clearCollection(s){let t=0,a=!0;try{for(;a;){const n=await Me.listDocuments(Ue,ge[s],[]);for(const i of n.documents)try{await Me.deleteDocument(Ue,ge[s],i.$id),t++}catch(l){console.error(`Failed to delete document ${i.$id}:`,l)}a=n.documents.length>0}}catch(n){console.error(`Error clearing collection ${s}:`,n)}return t}async restoreCollection(s,t,a,n){const i={total:t.length,success:0,failed:0,skipped:0,errors:[]};for(let l=0;l<t.length;l++){const m=t[l];try{const c=this.cleanDocument(m),o=m.$id||rt.unique();if(a.handleIdConflicts==="skip"){if(await this.documentExists(s,o)){i.skipped++;continue}}else a.handleIdConflicts==="overwrite"&&await this.documentExists(s,o)&&await Me.deleteDocument(Ue,ge[s],o);await Me.createDocument(Ue,ge[s],a.handleIdConflicts==="new"?rt.unique():o,c),i.success++}catch(c){if(i.failed++,i.errors.push({documentId:m.$id||"unknown",error:c.message||"Unknown error"}),a.stopOnError)throw c}n&&n(l+1,t.length)}return i}async restoreFromBackup(s,t,a){const n={success:!0,collections:{},errors:[],totalProcessed:0,totalSuccess:0,totalFailed:0};try{a&&a({currentCollection:"",processedCollections:0,totalCollections:0,currentRecords:0,totalRecords:0,percentage:0,phase:"validating"});const i=await this.validateBackup(s);if(!i.valid)throw new Error(`Invalid backup: ${i.errors.join(", ")}`);const l=this.RESTORE_ORDER.filter(o=>s.collections[o]&&s.collections[o].length>0),m=l.length;let c=0;if(t.clearExisting){a&&a({currentCollection:"",processedCollections:0,totalCollections:m,currentRecords:0,totalRecords:0,percentage:0,phase:"clearing"});for(const o of l)await this.clearCollection(o)}for(const o of l){a&&a({currentCollection:o,processedCollections:c,totalCollections:m,currentRecords:0,totalRecords:n.totalProcessed,percentage:Math.round(c/m*100),phase:"restoring"});try{const d=s.collections[o],g=await this.restoreCollection(o,d,t,(b,w)=>{a&&a({currentCollection:o,processedCollections:c,totalCollections:m,currentRecords:b,totalRecords:n.totalProcessed+b,percentage:Math.round((c+b/w)/m*100),phase:"restoring"})});n.collections[o]=g,n.totalProcessed+=g.total,n.totalSuccess+=g.success,n.totalFailed+=g.failed,c++}catch(d){if(n.success=!1,n.errors.push({collection:o,error:d.message||"Unknown error"}),t.stopOnError)throw d}}a&&a({currentCollection:"",processedCollections:m,totalCollections:m,currentRecords:n.totalProcessed,totalRecords:n.totalProcessed,percentage:100,phase:"complete"})}catch(i){n.success=!1,n.errors.push({collection:"general",error:i.message||"Unknown error"})}return n}getRestoreSummary(s){const t=[`Total Collections: ${Object.keys(s.collections).length}`,`Total Records Processed: ${s.totalProcessed}`,`Successful: ${s.totalSuccess}`,`Failed: ${s.totalFailed}`];return s.errors.length>0&&(t.push(`
Errors: ${s.errors.length}`),s.errors.forEach(a=>{t.push(`  - ${a.collection}: ${a.error}`)})),t.join(`
`)}}const qc=new Ac;function Fc(){const{toast:r}=Ee(),s=u.useRef(null),[t,a]=u.useState(!1),[n,i]=u.useState(!1),[l,m]=u.useState(null),[c,o]=u.useState(null),[d,g]=u.useState(!1),[b,w]=u.useState(null);u.useState({autoBackup:!0,frequency:"daily",time:"00:00",retention:"30"});const[T,L]=u.useState({createSafetyBackup:!0,clearExisting:!0,handleIdConflicts:"skip",stopOnError:!1}),f=async()=>{a(!0),m(null);try{r({title:"Creating backup...",description:"This may take a few minutes depending on data size"});const D=await Vt.createFullBackup($=>{m($)}),k=Vt.getBackupSize(D);await Vt.downloadBackup(D),r({title:"Backup created successfully!",description:`Downloaded ${k} backup file with ${D.metadata.totalRecords} records`})}catch(D){console.error("Backup error:",D),r({title:"Backup failed",description:D.message||"An error occurred during backup",variant:"destructive"})}finally{a(!1),m(null)}},N=D=>{const k=D.target.files?.[0];if(k){if(!k.name.endsWith(".json")){r({title:"Invalid file type",description:"Please select a JSON backup file",variant:"destructive"});return}w(k),g(!0)}},E=async()=>{if(b){g(!1),i(!0),o(null);try{r({title:"Reading backup file...",description:"Please wait while we validate the backup"});const D=await Vt.readBackupFile(b);r({title:"Restoring data...",description:"This may take several minutes. Do not close this window."});const k=await qc.restoreFromBackup(D,T,$=>{o($)});k.success?r({title:"Restore completed successfully!",description:`Restored ${k.totalSuccess} records across ${Object.keys(k.collections).length} collections`}):(r({title:"Restore completed with errors",description:`${k.totalSuccess} succeeded, ${k.totalFailed} failed. Check console for details.`,variant:"destructive"}),console.error("Restore errors:",k.errors))}catch(D){console.error("Restore error:",D),r({title:"Restore failed",description:D.message||"An error occurred during restore",variant:"destructive"})}finally{i(!1),o(null),w(null),s.current&&(s.current.value="")}}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(Oe,{children:[e.jsx(vs,{className:"h-4 w-4"}),e.jsx(Ke,{children:"Always create a backup before making major changes. Store backups securely in multiple locations."})]}),t&&l&&e.jsxs(J,{children:[e.jsx(le,{children:e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"h-5 w-5 animate-spin"}),"Creating Backup..."]})}),e.jsx(Z,{className:"space-y-4",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsxs("span",{children:["Processing: ",l.currentCollection]}),e.jsxs("span",{children:[l.percentage,"%"]})]}),e.jsx(yt,{value:l.percentage}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:[l.processedCollections," / ",l.totalCollections," collections (",l.totalRecords," records)"]})]})})]}),n&&c&&e.jsxs(J,{children:[e.jsx(le,{children:e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"h-5 w-5 animate-spin"}),"Restoring Data..."]})}),e.jsx(Z,{className:"space-y-4",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsxs("span",{children:["Phase: ",c.phase]}),e.jsxs("span",{children:[c.percentage,"%"]})]}),e.jsx(yt,{value:c.percentage}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:[c.currentCollection&&`Processing: ${c.currentCollection}`,e.jsx("br",{}),c.processedCollections," / ",c.totalCollections," collections (",c.totalRecords," records)"]})]})})]}),e.jsxs(J,{children:[e.jsxs(le,{children:[e.jsx(ce,{children:"Create Backup"}),e.jsx(ve,{children:"Export all your data to a JSON file"})]}),e.jsxs(Z,{className:"space-y-4",children:[e.jsxs(Oe,{children:[e.jsx(Zt,{className:"h-4 w-4"}),e.jsx(Ke,{children:"Full backup includes all master data, transactions, tasks, and status records. The backup file will be downloaded to your computer."})]}),e.jsx(A,{onClick:f,disabled:t||n,className:"gap-2",children:t?e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"h-4 w-4 animate-spin"}),"Creating Backup..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Zt,{className:"h-4 w-4"}),"Create Full Backup"]})})]})]}),e.jsxs(J,{children:[e.jsxs(le,{children:[e.jsx(ce,{children:"Restore Data"}),e.jsx(ve,{children:"Import data from a backup file"})]}),e.jsxs(Z,{className:"space-y-4",children:[e.jsxs(Oe,{children:[e.jsx(vs,{className:"h-4 w-4"}),e.jsx(Ke,{children:"Warning: Restoring will replace current data. Make sure you have a recent backup before proceeding."})]}),e.jsx("input",{ref:s,type:"file",accept:".json",onChange:N,className:"hidden"}),e.jsxs(A,{variant:"outline",onClick:()=>s.current?.click(),disabled:t||n,className:"gap-2",children:[e.jsx(Xt,{className:"h-4 w-4"}),"Select Backup File"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Supported format: JSON backup files created by this system"})]})]}),e.jsx(Qe,{open:d,onOpenChange:g,children:e.jsxs(Ve,{className:"max-w-2xl",children:[e.jsxs(Be,{children:[e.jsx(ze,{children:"Confirm Data Restore"}),e.jsxs(Ye,{children:["You are about to restore data from: ",b?.name]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs(Oe,{children:[e.jsx(vs,{className:"h-4 w-4"}),e.jsx(Ke,{children:"This operation will modify your database. Please review the options carefully."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(P,{children:"Create Safety Backup First"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Backup current data before restoring"})]}),e.jsx(Ps,{checked:T.createSafetyBackup,onCheckedChange:D=>L({...T,createSafetyBackup:D})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(P,{children:"Clear Existing Data"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Remove all current data before restore"})]}),e.jsx(Ps,{checked:T.clearExisting,onCheckedChange:D=>L({...T,clearExisting:D})})]}),e.jsxs("div",{children:[e.jsx(P,{children:"Handle ID Conflicts"}),e.jsxs(te,{value:T.handleIdConflicts,onValueChange:D=>L({...T,handleIdConflicts:D}),children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"skip",children:"Skip existing records"}),e.jsx(v,{value:"overwrite",children:"Overwrite existing records"}),e.jsx(v,{value:"new",children:"Create with new IDs"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(P,{children:"Stop on Error"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Stop restore if any error occurs"})]}),e.jsx(Ps,{checked:T.stopOnError,onCheckedChange:D=>L({...T,stopOnError:D})})]})]})]}),e.jsxs(He,{children:[e.jsx(A,{variant:"outline",onClick:()=>g(!1),children:"Cancel"}),e.jsxs(A,{onClick:E,className:"gap-2",children:[e.jsx(Ms,{className:"h-4 w-4"}),"Start Restore"]})]})]})})]})}function Ic(){const{toast:r}=Ee(),[s,t]=u.useState({minPasswordLength:"8",requireUppercase:!0,requireLowercase:!0,requireNumbers:!0,requireSpecialChars:!0,passwordExpiry:"90",sessionTimeout:"30",maxSessions:"3",enable2FA:!1,loginAttempts:"5",lockoutDuration:"30"});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(J,{children:[e.jsxs(le,{children:[e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(Ii,{className:"h-5 w-5"}),"Password Policy"]}),e.jsx(ve,{children:"Configure password requirements"})]}),e.jsxs(Z,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(P,{children:"Minimum Password Length"}),e.jsxs(te,{value:s.minPasswordLength,onValueChange:a=>t({...s,minPasswordLength:a}),children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsx(se,{children:[6,8,10,12,16].map(a=>e.jsxs(v,{value:String(a),children:[a," characters"]},a))})]})]}),e.jsxs("div",{children:[e.jsx(P,{children:"Password Expiry"}),e.jsxs(te,{value:s.passwordExpiry,onValueChange:a=>t({...s,passwordExpiry:a}),children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"never",children:"Never"}),e.jsx(v,{value:"30",children:"30 days"}),e.jsx(v,{value:"60",children:"60 days"}),e.jsx(v,{value:"90",children:"90 days"})]})]})]})]}),e.jsx("div",{className:"space-y-3",children:[{key:"requireUppercase",label:"Require Uppercase Letters"},{key:"requireLowercase",label:"Require Lowercase Letters"},{key:"requireNumbers",label:"Require Numbers"},{key:"requireSpecialChars",label:"Require Special Characters"}].map(({key:a,label:n})=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(P,{children:n}),e.jsx(Ps,{checked:s[a],onCheckedChange:i=>t({...s,[a]:i})})]},a))})]})]}),e.jsxs(J,{children:[e.jsxs(le,{children:[e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(Jr,{className:"h-5 w-5"}),"Session Management"]}),e.jsx(ve,{children:"Control user sessions and timeouts"})]}),e.jsx(Z,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(P,{children:"Session Timeout (minutes)"}),e.jsxs(te,{value:s.sessionTimeout,onValueChange:a=>t({...s,sessionTimeout:a}),children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsx(se,{children:[15,30,60,120].map(a=>e.jsxs(v,{value:String(a),children:[a," minutes"]},a))})]})]}),e.jsxs("div",{children:[e.jsx(P,{children:"Max Concurrent Sessions"}),e.jsxs(te,{value:s.maxSessions,onValueChange:a=>t({...s,maxSessions:a}),children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsx(se,{children:[1,2,3,5,10].map(a=>e.jsxs(v,{value:String(a),children:[a," session",a>1?"s":""]},a))})]})]})]})})]}),e.jsxs(J,{children:[e.jsxs(le,{children:[e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(Qr,{className:"h-5 w-5"}),"Access Control"]}),e.jsx(ve,{children:"Configure login security"})]}),e.jsxs(Z,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(P,{children:"Enable Two-Factor Authentication (2FA)"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Require 2FA for all users"})]}),e.jsx(Ps,{checked:s.enable2FA,onCheckedChange:a=>t({...s,enable2FA:a})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(P,{children:"Login Attempt Limit"}),e.jsxs(te,{value:s.loginAttempts,onValueChange:a=>t({...s,loginAttempts:a}),children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsx(se,{children:[3,5,10].map(a=>e.jsxs(v,{value:String(a),children:[a," attempts"]},a))})]})]}),e.jsxs("div",{children:[e.jsx(P,{children:"Account Lockout Duration"}),e.jsxs(te,{value:s.lockoutDuration,onValueChange:a=>t({...s,lockoutDuration:a}),children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsx(se,{children:[15,30,60].map(a=>e.jsxs(v,{value:String(a),children:[a," minutes"]},a))})]})]})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(A,{onClick:()=>r({title:"Security settings saved"}),className:"gap-2",children:[e.jsx(oa,{className:"h-4 w-4"}),"Save Security Settings"]})})]})}function $c(){const{toast:r}=Ee(),[s,t]=u.useState({host:"smtp.gmail.com",port:"587",username:"noreply@molaga.com",password:"",fromEmail:"noreply@molaga.com",fromName:"Molaga ERP",useTLS:!0}),[a,n]=u.useState({lowStockAlerts:!0,taskCompletion:!0,backupStatus:!0,userLogin:!1,dataImportExport:!0});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(J,{children:[e.jsxs(le,{children:[e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(qa,{className:"h-5 w-5"}),"Email Configuration"]}),e.jsx(ve,{children:"Configure SMTP settings for email notifications"})]}),e.jsxs(Z,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(P,{children:"SMTP Host"}),e.jsx(V,{value:s.host,onChange:i=>t({...s,host:i.target.value})})]}),e.jsxs("div",{children:[e.jsx(P,{children:"SMTP Port"}),e.jsx(V,{value:s.port,onChange:i=>t({...s,port:i.target.value})})]}),e.jsxs("div",{children:[e.jsx(P,{children:"Username"}),e.jsx(V,{value:s.username,onChange:i=>t({...s,username:i.target.value})})]}),e.jsxs("div",{children:[e.jsx(P,{children:"Password"}),e.jsx(V,{type:"password",value:s.password,onChange:i=>t({...s,password:i.target.value})})]}),e.jsxs("div",{children:[e.jsx(P,{children:"From Email"}),e.jsx(V,{type:"email",value:s.fromEmail,onChange:i=>t({...s,fromEmail:i.target.value})})]}),e.jsxs("div",{children:[e.jsx(P,{children:"From Name"}),e.jsx(V,{value:s.fromName,onChange:i=>t({...s,fromName:i.target.value})})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(P,{children:"Use TLS/SSL"}),e.jsx(Ps,{checked:s.useTLS,onCheckedChange:i=>t({...s,useTLS:i})})]}),e.jsxs(A,{variant:"outline",className:"gap-2",children:[e.jsx($i,{className:"h-4 w-4"}),"Send Test Email"]})]})]}),e.jsxs(J,{children:[e.jsxs(le,{children:[e.jsx(ce,{children:"Notification Preferences"}),e.jsx(ve,{children:"Choose which notifications to receive"})]}),e.jsx(Z,{className:"space-y-4",children:[{key:"lowStockAlerts",label:"Low Stock Alerts",desc:"Get notified when stock falls below minimum level"},{key:"taskCompletion",label:"Task Completion",desc:"Notifications when tasks are completed"},{key:"backupStatus",label:"Backup Success/Failure",desc:"Get notified about backup operations"},{key:"userLogin",label:"User Login Alerts",desc:"Notifications for user login activity"},{key:"dataImportExport",label:"Data Import/Export Status",desc:"Updates on data operations"}].map(({key:i,label:l,desc:m})=>e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{children:[e.jsx(P,{children:l}),e.jsx("p",{className:"text-sm text-muted-foreground",children:m})]}),e.jsx(Ps,{checked:a[i],onCheckedChange:c=>n({...a,[i]:c})})]},i))})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(A,{onClick:()=>r({title:"Notification settings saved"}),className:"gap-2",children:[e.jsx(oa,{className:"h-4 w-4"}),"Save Settings"]})})]})}const sr="molaga_data_settings",tr={importFormat:"csv",exportFormat:"csv",dateFormat:"DD/MM/YYYY",encoding:"utf8"};class Lc{settings;constructor(){this.settings=this.loadSettings()}loadSettings(){try{const s=localStorage.getItem(sr);if(s)return{...tr,...JSON.parse(s)}}catch(s){console.error("Error loading data settings:",s)}return tr}saveSettings(){try{localStorage.setItem(sr,JSON.stringify(this.settings))}catch(s){console.error("Error saving data settings:",s)}}getSettings(){return{...this.settings}}updateSettings(s){return this.settings={...this.settings,...s},this.saveSettings(),this.getSettings()}async archiveOldRecords(s){return new Promise(t=>{setTimeout(()=>{t({success:!0,count:0})},1e3)})}async deleteCancelledTasks(s){return new Promise(t=>{setTimeout(()=>{t({success:!0,count:0})},1e3)})}async clearAuditLogs(s){return new Promise(t=>{setTimeout(()=>{t({success:!0,count:0})},1e3)})}async optimizeDatabase(){return new Promise(s=>{setTimeout(()=>{s({success:!0,message:"Database optimized successfully"})},2e3)})}}const mt=new Lc;function Mc(){const[r,s]=u.useState(mt.getSettings()),[t,a]=u.useState(!1),n=u.useCallback(o=>{const d=mt.updateSettings(o);return s(d),d},[]),i=u.useCallback(async o=>{a(!0);try{return await mt.archiveOldRecords(o)}finally{a(!1)}},[]),l=u.useCallback(async o=>{a(!0);try{return await mt.deleteCancelledTasks(o)}finally{a(!1)}},[]),m=u.useCallback(async o=>{a(!0);try{return await mt.clearAuditLogs(o)}finally{a(!1)}},[]),c=u.useCallback(async()=>{a(!0);try{return await mt.optimizeDatabase()}finally{a(!1)}},[]);return{settings:r,updateSettings:n,archiveOldRecords:i,deleteCancelledTasks:l,clearAuditLogs:m,optimizeDatabase:c,isProcessing:t}}function Uc(){const{toast:r}=Ee(),{settings:s,updateSettings:t,archiveOldRecords:a,deleteCancelledTasks:n,clearAuditLogs:i,optimizeDatabase:l,isProcessing:m}=Mc(),c=async()=>{if(!confirm("Are you sure you want to archive old records?"))return;const b=await a(12);b.success&&r({title:`Archived ${b.count} records successfully`})},o=async()=>{if(!confirm("Are you sure you want to delete cancelled tasks?"))return;const b=await n(90);b.success&&r({title:`Deleted ${b.count} tasks successfully`})},d=async()=>{if(!confirm("Are you sure you want to clear audit logs?"))return;const b=await i(6);b.success&&r({title:`Cleared ${b.count} log entries successfully`})},g=async()=>{const b=await l();b.success&&r({title:b.message})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(J,{children:[e.jsxs(le,{children:[e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(ft,{className:"h-5 w-5"}),"Import/Export Settings"]}),e.jsx(ve,{children:"Configure default import and export preferences"})]}),e.jsx(Z,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(P,{children:"Default Import Format"}),e.jsxs(te,{value:s.importFormat,onValueChange:b=>t({importFormat:b}),children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"csv",children:"CSV"}),e.jsx(v,{value:"excel",children:"Excel"}),e.jsx(v,{value:"json",children:"JSON"})]})]})]}),e.jsxs("div",{children:[e.jsx(P,{children:"Default Export Format"}),e.jsxs(te,{value:s.exportFormat,onValueChange:b=>t({exportFormat:b}),children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"csv",children:"CSV"}),e.jsx(v,{value:"excel",children:"Excel"}),e.jsx(v,{value:"pdf",children:"PDF"})]})]})]}),e.jsxs("div",{children:[e.jsx(P,{children:"Date Format for Import/Export"}),e.jsxs(te,{value:s.dateFormat,onValueChange:b=>t({dateFormat:b}),children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"DD/MM/YYYY",children:"DD/MM/YYYY"}),e.jsx(v,{value:"MM/DD/YYYY",children:"MM/DD/YYYY"}),e.jsx(v,{value:"YYYY-MM-DD",children:"YYYY-MM-DD"})]})]})]}),e.jsxs("div",{children:[e.jsx(P,{children:"File Encoding"}),e.jsxs(te,{value:s.encoding,onValueChange:b=>t({encoding:b}),children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"utf8",children:"UTF-8"}),e.jsx(v,{value:"utf16",children:"UTF-16"}),e.jsx(v,{value:"ascii",children:"ASCII"})]})]})]})]})})]}),e.jsxs(J,{children:[e.jsxs(le,{children:[e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(Ts,{className:"h-5 w-5"}),"Data Cleanup"]}),e.jsx(ve,{children:"Manage old and unnecessary data"})]}),e.jsxs(Z,{className:"space-y-4",children:[e.jsxs(Oe,{children:[e.jsx(vs,{className:"h-4 w-4"}),e.jsx(Ke,{children:"Data cleanup operations are permanent. Always create a backup before proceeding."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx(P,{children:"Archive Old Records"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Move records older than 12 months to archive"})]}),e.jsx(A,{variant:"outline",onClick:c,disabled:m,children:m?e.jsx(Re,{className:"h-4 w-4 animate-spin"}):"Archive"})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx(P,{children:"Delete Cancelled Tasks"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Remove cancelled tasks older than 90 days"})]}),e.jsx(A,{variant:"outline",onClick:o,disabled:m,children:m?e.jsx(Re,{className:"h-4 w-4 animate-spin"}):"Delete"})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx(P,{children:"Clear Audit Logs"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Remove audit logs older than 6 months"})]}),e.jsx(A,{variant:"outline",onClick:d,disabled:m,children:m?e.jsx(Re,{className:"h-4 w-4 animate-spin"}):"Clear"})]})]})]})]}),e.jsxs(J,{children:[e.jsxs(le,{children:[e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(Zt,{className:"h-5 w-5"}),"Database Maintenance"]}),e.jsx(ve,{children:"Optimize database performance"})]}),e.jsx(Z,{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx(P,{children:"Optimize Database"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Rebuild indexes and optimize tables"})]}),e.jsx(A,{variant:"outline",onClick:g,disabled:m,children:m?e.jsx(Re,{className:"h-4 w-4 animate-spin"}):"Optimize"})]})})]})]})}const ht="molaga_api_keys";class Oc{generateKey(s,t,a){const n=this.createSecureKey(),i=new Date,l={id:this.generateId(),name:s,key:n,createdAt:i.toISOString(),expiresAt:a?new Date(i.getTime()+a*24*60*60*1e3).toISOString():void 0,permissions:t,isActive:!0};return this.saveKey(l),l}createSecureKey(){const s="mlg",t=this.generateRandomString(32);return`${s}_${t}`}generateRandomString(s){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let a="";const n=new Uint8Array(s);crypto.getRandomValues(n);for(let i=0;i<s;i++)a+=t[n[i]%t.length];return a}generateId(){return`key_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}saveKey(s){const t=this.getAllKeys();t.push(s),localStorage.setItem(ht,JSON.stringify(t))}getAllKeys(){try{const s=localStorage.getItem(ht);return s?JSON.parse(s):[]}catch(s){return console.error("Error loading API keys:",s),[]}}getKeyById(s){return this.getAllKeys().find(a=>a.id===s)||null}revokeKey(s){const t=this.getAllKeys(),a=t.findIndex(n=>n.id===s);return a!==-1?(t[a].isActive=!1,localStorage.setItem(ht,JSON.stringify(t)),!0):!1}deleteKey(s){const t=this.getAllKeys(),a=t.filter(n=>n.id!==s);return a.length!==t.length?(localStorage.setItem(ht,JSON.stringify(a)),!0):!1}validateKey(s){const a=this.getAllKeys().find(n=>n.key===s);return a?a.isActive?a.expiresAt&&new Date(a.expiresAt)<new Date?{valid:!1,error:"API key has expired"}:{valid:!0,apiKey:a}:{valid:!1,error:"API key has been revoked"}:{valid:!1,error:"Invalid API key"}}updateLastUsed(s){const t=this.getAllKeys(),a=t.findIndex(n=>n.id===s);a!==-1&&(t[a].lastUsed=new Date().toISOString(),localStorage.setItem(ht,JSON.stringify(t)))}regenerateKey(s){const t=this.getAllKeys(),a=t.findIndex(n=>n.id===s);return a!==-1?(t[a],t[a].key=this.createSecureKey(),t[a].createdAt=new Date().toISOString(),t[a].lastUsed=void 0,localStorage.setItem(ht,JSON.stringify(t)),t[a]):null}}const Ls=new Oc;function Kc(){const{toast:r}=Ee(),{user:s}=os(),[t,a]=u.useState(Ls.getAllKeys()),[n,i]=u.useState(!1),[l,m]=u.useState(!1),[c,o]=u.useState({name:"",expiresIn:"90",permissions:["read"]}),[d,g]=u.useState(null),b=s?.email==="varda3d@gmail.com",w=()=>{if(!c.name.trim()){r({title:"Validation error",description:"Please enter a key name",variant:"destructive"});return}const k=c.expiresIn==="never"?void 0:parseInt(c.expiresIn),$=Ls.generateKey(c.name,c.permissions,k);g($),a(Ls.getAllKeys()),i(!1),m(!0),o({name:"",expiresIn:"90",permissions:["read"]}),r({title:"API key created",description:"Copy the key now - it won't be shown again"})},T=k=>{navigator.clipboard.writeText(k),r({title:"Copied",description:"API key copied to clipboard"})},L=k=>{Ls.revokeKey(k),a(Ls.getAllKeys()),r({title:"API key revoked",description:"The key can no longer be used"})},f=k=>{Ls.deleteKey(k),a(Ls.getAllKeys()),r({title:"API key deleted",description:"The key has been permanently removed"})},N=k=>{const $=Ls.regenerateKey(k);$&&(g($),a(Ls.getAllKeys()),m(!0),r({title:"API key regenerated",description:"Copy the new key now"}))},E=k=>new Date(k).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),D=k=>k&&new Date(k)<new Date;return b?e.jsxs("div",{className:"space-y-6",children:[e.jsxs(J,{children:[e.jsx(le,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(Na,{className:"h-5 w-5"}),"API Keys"]}),e.jsx(ve,{children:"Generate and manage API keys for external integrations"})]}),e.jsxs(A,{onClick:()=>i(!0),className:"gap-2",children:[e.jsx(fs,{className:"h-4 w-4"}),"Create API Key"]})]})}),e.jsxs(Z,{children:[e.jsxs(Oe,{className:"mb-6",children:[e.jsx(vs,{className:"h-4 w-4"}),e.jsxs(Ke,{children:[e.jsx("strong",{children:"Security Notice:"})," API keys provide access to your system. Keep them secure and never share them publicly."]})]}),t.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(Na,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No API keys created yet"}),e.jsx("p",{className:"text-sm",children:"Create your first API key to get started"})]}):e.jsx("div",{className:"space-y-4",children:t.map(k=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h4",{className:"font-medium",children:k.name}),k.isActive?D(k.expiresAt)?e.jsx(qe,{variant:"destructive",children:"Expired"}):e.jsx(qe,{variant:"default",className:"bg-green-500",children:"Active"}):e.jsx(qe,{variant:"secondary",children:"Revoked"})]}),e.jsxs("div",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsxs("p",{children:["Key: ",k.key.substring(0,20),"...",k.key.substring(k.key.length-4)]}),e.jsxs("p",{children:["Created: ",E(k.createdAt)]}),k.expiresAt&&e.jsxs("p",{children:["Expires: ",E(k.expiresAt)]}),k.lastUsed&&e.jsxs("p",{children:["Last used: ",E(k.lastUsed)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(A,{variant:"outline",size:"sm",onClick:()=>T(k.key),className:"gap-2",children:[e.jsx(qt,{className:"h-3 w-3"}),"Copy"]}),k.isActive&&!D(k.expiresAt)&&e.jsxs(e.Fragment,{children:[e.jsxs(A,{variant:"outline",size:"sm",onClick:()=>N(k.id),className:"gap-2",children:[e.jsx(Pa,{className:"h-3 w-3"}),"Regenerate"]}),e.jsx(A,{variant:"outline",size:"sm",onClick:()=>L(k.id),className:"gap-2 text-orange-600 hover:text-orange-700",children:"Revoke"})]}),e.jsxs(A,{variant:"outline",size:"sm",onClick:()=>f(k.id),className:"gap-2 text-red-600 hover:text-red-700",children:[e.jsx(Ts,{className:"h-3 w-3"}),"Delete"]})]})]},k.id))})]})]}),e.jsx(Qe,{open:n,onOpenChange:i,children:e.jsxs(Ve,{children:[e.jsxs(Be,{children:[e.jsx(ze,{children:"Create New API Key"}),e.jsx(Ye,{children:"Generate a new API key for external integrations"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(P,{htmlFor:"keyName",children:"Key Name *"}),e.jsx(V,{id:"keyName",placeholder:"e.g., Mobile App Integration",value:c.name,onChange:k=>o({...c,name:k.target.value})})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"expiresIn",children:"Expires In"}),e.jsxs(te,{value:c.expiresIn,onValueChange:k=>o({...c,expiresIn:k}),children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"30",children:"30 days"}),e.jsx(v,{value:"90",children:"90 days"}),e.jsx(v,{value:"180",children:"180 days"}),e.jsx(v,{value:"365",children:"1 year"}),e.jsx(v,{value:"never",children:"Never"})]})]})]})]}),e.jsxs(He,{children:[e.jsx(A,{variant:"outline",onClick:()=>i(!1),children:"Cancel"}),e.jsx(A,{onClick:w,children:"Create Key"})]})]})}),e.jsx(Qe,{open:l,onOpenChange:m,children:e.jsxs(Ve,{children:[e.jsxs(Be,{children:[e.jsxs(ze,{className:"flex items-center gap-2",children:[e.jsx(Ms,{className:"h-5 w-5 text-green-500"}),"API Key Created"]}),e.jsx(Ye,{children:"Copy this key now - it won't be shown again"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs(Oe,{children:[e.jsx(vs,{className:"h-4 w-4"}),e.jsx(Ke,{children:"Store this key securely. You won't be able to see it again."})]}),e.jsxs("div",{children:[e.jsx(P,{children:"API Key"}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(V,{value:d?.key||"",readOnly:!0,className:"font-mono text-sm"}),e.jsxs(A,{variant:"outline",onClick:()=>T(d?.key||""),className:"gap-2",children:[e.jsx(qt,{className:"h-4 w-4"}),"Copy"]})]})]})]}),e.jsx(He,{children:e.jsx(A,{onClick:()=>m(!1),children:"Done"})})]})})]}):e.jsxs(Oe,{children:[e.jsx(vs,{className:"h-4 w-4"}),e.jsx(Ke,{children:"Only Super Admins can manage API keys. Contact your administrator for access."})]})}const ar="molaga_custom_domain";class Vc{getConfig(){try{const s=localStorage.getItem(ar);if(s)return JSON.parse(s)}catch(s){console.error("Error loading domain config:",s)}return{customDomain:null,isVerified:!1,verificationToken:this.generateVerificationToken(),verifiedAt:null,createdAt:null}}setDomain(s){const t=this.getConfig();t.customDomain=s,t.isVerified=!1,t.verifiedAt=null,t.createdAt=new Date().toISOString(),t.verificationToken||(t.verificationToken=this.generateVerificationToken()),this.saveConfig(t)}verifyDomain(){const s=this.getConfig();s.isVerified=!0,s.verifiedAt=new Date().toISOString(),this.saveConfig(s)}removeDomain(){const s={customDomain:null,isVerified:!1,verificationToken:this.generateVerificationToken(),verifiedAt:null,createdAt:null};this.saveConfig(s)}generateVerificationToken(){const s=new Uint8Array(16);return crypto.getRandomValues(s),Array.from(s,t=>t.toString(16).padStart(2,"0")).join("")}saveConfig(s){try{localStorage.setItem(ar,JSON.stringify(s))}catch(t){console.error("Error saving domain config:",t)}}isCustomDomainActive(){const s=this.getConfig();return!!(s.customDomain&&s.isVerified)}getActiveDomain(){const s=this.getConfig();return s.isVerified?s.customDomain:null}}const st=new Vc;function Bc(){const{toast:r}=Ee(),{user:s}=os(),[t,a]=u.useState(st.getConfig()),[n,i]=u.useState(t.customDomain||""),[l,m]=u.useState(!1),c=s?.email==="varda3d@gmail.com",o=()=>{if(!n.trim()){r({title:"Validation error",description:"Please enter a domain name",variant:"destructive"});return}if(!/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(n)){r({title:"Invalid domain",description:"Please enter a valid domain name (e.g., erp.yourcompany.com)",variant:"destructive"});return}st.setDomain(n),a(st.getConfig()),r({title:"Domain saved",description:"Custom domain configuration updated"})},d=async()=>{m(!0),setTimeout(()=>{Math.random()>.3?(st.verifyDomain(),a(st.getConfig()),r({title:"Domain verified",description:"Your custom domain is now active"})):r({title:"Verification failed",description:"Please check your DNS records and try again",variant:"destructive"}),m(!1)},2e3)},g=()=>{st.removeDomain(),a(st.getConfig()),i(""),r({title:"Domain removed",description:"Custom domain configuration has been removed"})},b=w=>{navigator.clipboard.writeText(w),r({title:"Copied",description:"Copied to clipboard"})};return c?e.jsx("div",{className:"space-y-6",children:e.jsxs(J,{children:[e.jsxs(le,{children:[e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(wa,{className:"h-5 w-5"}),"Custom Domain"]}),e.jsx(ve,{children:"Configure a custom domain for your ERP system"})]}),e.jsxs(Z,{className:"space-y-6",children:[e.jsxs(Oe,{children:[e.jsx(vs,{className:"h-4 w-4"}),e.jsxs(Ke,{children:[e.jsx("strong",{children:"Note:"})," Custom domain configuration requires DNS changes. Make sure you have access to your domain's DNS settings."]})]}),t.customDomain&&e.jsxs("div",{className:"p-4 border rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(wa,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:t.customDomain})]}),t.isVerified?e.jsxs(qe,{className:"bg-green-500",children:[e.jsx(Ms,{className:"h-3 w-3 mr-1"}),"Verified"]}):e.jsx(qe,{variant:"secondary",children:"Pending Verification"})]}),t.verifiedAt&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Verified on ",new Date(t.verifiedAt).toLocaleDateString()]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(P,{htmlFor:"domain",children:"Domain Name"}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(V,{id:"domain",placeholder:"erp.yourcompany.com",value:n,onChange:w=>i(w.target.value),disabled:t.isVerified}),t.isVerified?e.jsx(A,{variant:"outline",onClick:g,className:"text-red-600",children:"Remove"}):e.jsx(A,{onClick:o,children:"Save"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Enter your custom domain (e.g., erp.yourcompany.com)"})]}),t.customDomain&&!t.isVerified&&e.jsxs(J,{children:[e.jsxs(le,{children:[e.jsx(ce,{className:"text-base",children:"DNS Configuration"}),e.jsx(ve,{children:"Add these DNS records to your domain provider"})]}),e.jsxs(Z,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"p-3 border rounded-lg bg-muted/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Type: CNAME"}),e.jsx(A,{variant:"ghost",size:"sm",onClick:()=>b("CNAME"),className:"h-6 px-2",children:e.jsx(qt,{className:"h-3 w-3"})})]}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," ",t.customDomain]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Value:"})," molaga-erp.app"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"TTL:"})," 3600"]})]})]}),e.jsxs("div",{className:"p-3 border rounded-lg bg-muted/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Type: TXT (Verification)"}),e.jsx(A,{variant:"ghost",size:"sm",onClick:()=>b(`molaga-verification=${t.verificationToken}`),className:"h-6 px-2",children:e.jsx(qt,{className:"h-3 w-3"})})]}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," _molaga-verification.",t.customDomain]}),e.jsxs("p",{className:"break-all",children:[e.jsx("strong",{children:"Value:"})," molaga-verification=",t.verificationToken]}),e.jsxs("p",{children:[e.jsx("strong",{children:"TTL:"})," 3600"]})]})]})]}),e.jsxs(Oe,{children:[e.jsx(vs,{className:"h-4 w-4"}),e.jsx(Ke,{children:'DNS changes can take up to 48 hours to propagate. After adding the records, click "Verify Domain" below.'})]}),e.jsx(A,{onClick:d,disabled:l,className:"w-full gap-2",children:l?e.jsx(e.Fragment,{children:"Verifying..."}):e.jsxs(e.Fragment,{children:[e.jsx(Ms,{className:"h-4 w-4"}),"Verify Domain"]})})]})]}),t.isVerified&&e.jsxs(J,{children:[e.jsxs(le,{children:[e.jsx(ce,{className:"text-base",children:"SSL Certificate"}),e.jsx(ve,{children:"Your domain is secured with SSL/TLS"})]}),e.jsxs(Z,{children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-600",children:[e.jsx(Ms,{className:"h-4 w-4"}),e.jsx("span",{children:"SSL certificate is active and valid"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Your custom domain is secured with automatic SSL certificate provisioning."})]})]}),e.jsxs(J,{children:[e.jsx(le,{children:e.jsx(ce,{className:"text-base",children:"Need Help?"})}),e.jsxs(Z,{className:"space-y-2",children:[e.jsxs("a",{href:"#",className:"flex items-center gap-2 text-sm text-primary hover:underline",children:[e.jsx(Bt,{className:"h-3 w-3"}),"How to configure DNS records"]}),e.jsxs("a",{href:"#",className:"flex items-center gap-2 text-sm text-primary hover:underline",children:[e.jsx(Bt,{className:"h-3 w-3"}),"Troubleshooting domain verification"]}),e.jsxs("a",{href:"#",className:"flex items-center gap-2 text-sm text-primary hover:underline",children:[e.jsx(Bt,{className:"h-3 w-3"}),"Contact support"]})]})]})]})]})]})}):e.jsxs(Oe,{children:[e.jsx(vs,{className:"h-4 w-4"}),e.jsx(Ke,{children:"Only Super Admins can configure custom domains. Contact your administrator for access."})]})}function Hc(){Ee();const{user:r}=os(),[s,t]=u.useState("overview"),a=r?.email==="varda3d@gmail.com";return e.jsxs("div",{className:"space-y-6",children:[!a&&e.jsxs(Oe,{children:[e.jsx(vs,{className:"h-4 w-4"}),e.jsxs(Ke,{children:[e.jsx("strong",{children:"Read-Only Mode:"})," Only Super Admin (varda3d@gmail.com) can modify integration settings."]})]}),e.jsxs(Fn,{value:s,onValueChange:t,children:[e.jsxs(Ma,{className:"grid w-full grid-cols-4",children:[e.jsx(xt,{value:"overview",children:"Overview"}),e.jsx(xt,{value:"api-keys",children:"API Keys"}),e.jsx(xt,{value:"domain",children:"Custom Domain"}),e.jsx(xt,{value:"webhooks",children:"Webhooks"})]}),e.jsxs(hs,{value:"overview",className:"space-y-6 mt-6",children:[e.jsxs(J,{children:[e.jsxs(le,{children:[e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(Na,{className:"h-5 w-5"}),"API Configuration"]}),e.jsx(ve,{children:"Quick overview of API settings"})]}),e.jsx(Z,{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(P,{children:"API Access Status"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage API keys in the API Keys tab"})]}),e.jsx(qe,{variant:"secondary",children:"View Details â†’"})]})})]}),e.jsxs(J,{children:[e.jsxs(le,{children:[e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(wa,{className:"h-5 w-5"}),"Custom Domain"]}),e.jsx(ve,{children:"Configure your custom domain"})]}),e.jsx(Z,{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(P,{children:"Domain Status"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Configure custom domain in the Custom Domain tab"})]}),e.jsx(qe,{variant:"secondary",children:"View Details â†’"})]})})]}),e.jsxs(J,{children:[e.jsxs(le,{children:[e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(Li,{className:"h-5 w-5"}),"Third-Party Integrations"]}),e.jsx(ve,{children:"Connect with external services"})]}),e.jsx(Z,{className:"space-y-4",children:[{name:"Accounting Software",status:"Not Connected",available:!1},{name:"Payment Gateway",status:"Not Connected",available:!1},{name:"SMS Gateway",status:"Not Connected",available:!1},{name:"Cloud Storage",status:"Not Connected",available:!1}].map(n=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx(P,{children:n.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:n.status})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!n.available&&e.jsx(qe,{variant:"secondary",children:"Coming Soon"}),e.jsx(A,{variant:"outline",size:"sm",disabled:!n.available||!a,children:"Configure"})]})]},n.name))})]})]}),e.jsx(hs,{value:"api-keys",className:"mt-6",children:e.jsx(Kc,{})}),e.jsx(hs,{value:"domain",className:"mt-6",children:e.jsx(Bc,{})}),e.jsx(hs,{value:"webhooks",className:"space-y-6 mt-6",children:e.jsxs(J,{children:[e.jsxs(le,{children:[e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(Mi,{className:"h-5 w-5"}),"Webhooks"]}),e.jsx(ve,{children:"Configure webhook endpoints for real-time notifications"})]}),e.jsxs(Z,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(P,{children:"Webhook URL"}),e.jsx(V,{placeholder:"https://your-domain.com/webhook",disabled:!a}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Receive POST requests when events occur"})]}),e.jsxs("div",{children:[e.jsx(P,{children:"Events to Subscribe"}),e.jsx("div",{className:"space-y-2 mt-2",children:["Task Created","Task Completed","Low Stock Alert","Backup Completed"].map(n=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:n}),e.jsx(Ps,{disabled:!a})]},n))})]}),e.jsx(A,{variant:"outline",disabled:!a,children:"Test Webhook"})]})]})})]})]})}function zc(){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(J,{children:[e.jsxs(le,{children:[e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(Sa,{className:"h-5 w-5"}),"System Information"]}),e.jsx(ve,{children:"Details about your Molaga ERP installation"})]}),e.jsx(Z,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Application Name"}),e.jsx("p",{className:"font-medium",children:"Molaga ERP"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Version"}),e.jsxs("p",{className:"font-medium flex items-center gap-2",children:["1.0.0",e.jsxs(qe,{variant:"default",className:"gap-1",children:[e.jsx(Ms,{className:"h-3 w-3"}),"Latest"]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Build Date"}),e.jsx("p",{className:"font-medium",children:"October 11, 2025"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"License Type"}),e.jsx("p",{className:"font-medium",children:"Enterprise"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Licensed To"}),e.jsx("p",{className:"font-medium",children:"Molaga Spices Pvt Ltd"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"License Expiry"}),e.jsx("p",{className:"font-medium",children:"October 11, 2026"})]})]})})]}),e.jsxs(J,{children:[e.jsxs(le,{children:[e.jsx(ce,{children:"Support & Help"}),e.jsx(ve,{children:"Get assistance with Molaga ERP"})]}),e.jsx(Z,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3 p-4 border rounded-lg",children:[e.jsx(ft,{className:"h-5 w-5 text-primary mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Documentation"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Comprehensive guides and tutorials"}),e.jsxs(A,{variant:"link",className:"h-auto p-0 gap-1",children:["View Docs",e.jsx(Bt,{className:"h-3 w-3"})]})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 border rounded-lg",children:[e.jsx(qa,{className:"h-5 w-5 text-primary mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Email Support"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"support@molagaerp.com"}),e.jsx(A,{variant:"link",className:"h-auto p-0",children:"Send Email"})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 border rounded-lg",children:[e.jsx(Ui,{className:"h-5 w-5 text-primary mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Phone Support"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"+91 9876543210"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Mon-Fri, 9 AM - 6 PM IST"})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 border rounded-lg",children:[e.jsx(Sa,{className:"h-5 w-5 text-primary mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Submit Feedback"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Help us improve"}),e.jsx(A,{variant:"link",className:"h-auto p-0",children:"Give Feedback"})]})]})]})})]}),e.jsxs(J,{children:[e.jsxs(le,{children:[e.jsx(ce,{children:"Updates"}),e.jsx(ve,{children:"Check for system updates"})]}),e.jsxs(Z,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg bg-muted/50",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"You're running the latest version"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Last checked: October 11, 2025"})]}),e.jsx(A,{variant:"outline",children:"Check for Updates"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium mb-2",children:"Recent Updates"}),e.jsx("div",{className:"space-y-2",children:[{version:"1.0.0",date:"Oct 11, 2025",changes:"Initial release with full ERP features"},{version:"0.9.5",date:"Oct 1, 2025",changes:"Beta testing and bug fixes"},{version:"0.9.0",date:"Sep 15, 2025",changes:"Added validation system"}].map(r=>e.jsxs("div",{className:"p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("p",{className:"font-medium text-sm",children:["Version ",r.version]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r.date})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r.changes})]},r.version))})]})]})]}),e.jsxs(J,{children:[e.jsx(le,{children:e.jsx(ce,{children:"About Molaga ERP"})}),e.jsxs(Z,{children:[e.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed",children:"Molaga ERP is a comprehensive enterprise resource planning system designed specifically for spice manufacturing businesses. It streamlines operations from raw material procurement through production processes to final product sales, providing real-time insights and data-driven decision making capabilities."}),e.jsx("p",{className:"text-sm text-muted-foreground mt-4",children:"Â© 2025 Molaga ERP. All rights reserved."})]})]})]})}const Qc=[{value:"company",label:"Company Profile",icon:Vr},{value:"users",label:"User Management",icon:Wr},{value:"approvals",label:"User Approvals",icon:Gr},{value:"system",label:"System Config",icon:Oi},{value:"backup",label:"Backup & Restore",icon:Zt},{value:"security",label:"Security",icon:Jr},{value:"notifications",label:"Notifications",icon:Br},{value:"data",label:"Data Management",icon:ft},{value:"integrations",label:"Integrations",icon:it},{value:"about",label:"About",icon:Sa}];function Yc(){const[r,s]=u.useState("company");return e.jsxs("div",{className:"container mx-auto p-6 max-w-7xl",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Settings"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage your system configuration and preferences"})]}),e.jsx(J,{className:"p-6",children:e.jsxs(Fn,{value:r,onValueChange:s,className:"space-y-6",children:[e.jsx(Ma,{className:"grid grid-cols-3 lg:grid-cols-10 gap-2 h-auto p-2",children:Qc.map(t=>e.jsxs(xt,{value:t.value,className:"flex flex-col items-center gap-1 py-3 data-[state=active]:bg-primary data-[state=active]:text-primary-foreground",children:[e.jsx(t.icon,{className:"h-4 w-4"}),e.jsx("span",{className:"text-xs",children:t.label})]},t.value))}),e.jsx(hs,{value:"company",className:"space-y-4",children:e.jsx(bc,{})}),e.jsx(hs,{value:"users",className:"space-y-4",children:e.jsx(Pc,{})}),e.jsx(hs,{value:"approvals",className:"space-y-4",children:e.jsx(Dc,{})}),e.jsx(hs,{value:"system",className:"space-y-4",children:e.jsx(Ec,{})}),e.jsx(hs,{value:"backup",className:"space-y-4",children:e.jsx(Fc,{})}),e.jsx(hs,{value:"security",className:"space-y-4",children:e.jsx(Ic,{})}),e.jsx(hs,{value:"notifications",className:"space-y-4",children:e.jsx($c,{})}),e.jsx(hs,{value:"data",className:"space-y-4",children:e.jsx(Uc,{})}),e.jsx(hs,{value:"integrations",className:"space-y-4",children:e.jsx(Hc,{})}),e.jsx(hs,{value:"about",className:"space-y-4",children:e.jsx(zc,{})})]})})]})}const Wc=new gi({defaultOptions:{queries:{staleTime:5*60*1e3,gcTime:10*60*1e3,retry:(r,s)=>s?.code===401||s?.code===403?!1:r<3,refetchOnWindowFocus:!1,refetchOnMount:!0,refetchOnReconnect:!0},mutations:{retry:(r,s)=>s?.code===401||s?.code===403?!1:r<2}}}),Gc=Vi([{path:"/login",element:e.jsx(yl,{})},{path:"/register",element:e.jsx(vl,{})},{path:"/",element:e.jsx(Ie,{children:e.jsx(Fe,{children:e.jsx(Cl,{})})})},{path:"/purchases",element:e.jsx(Ie,{children:e.jsx(Fe,{children:e.jsx(Al,{})})})},{path:"/tasks",element:e.jsx(Ie,{children:e.jsx(Fe,{children:e.jsx(Il,{})})})},{path:"/status",element:e.jsx(Ie,{children:e.jsx(Fe,{children:e.jsx($l,{})})})},{path:"/sales",element:e.jsx(Ie,{children:e.jsx(Fe,{children:e.jsx(Ll,{})})})},{path:"/sales/units",element:e.jsx(Ie,{children:e.jsx(Fe,{children:e.jsx(Ol,{})})})},{path:"/sales/records",element:e.jsx(Ie,{children:e.jsx(Fe,{children:e.jsx(Kl,{})})})},{path:"/master",element:e.jsx(Ie,{children:e.jsx(Fe,{children:e.jsx(Vl,{})})})},{path:"/master/stocks",element:e.jsx(Ie,{children:e.jsx(Fe,{children:e.jsx(zl,{})})})},{path:"/master/vendors",element:e.jsx(Ie,{children:e.jsx(Fe,{children:e.jsx(Ql,{})})})},{path:"/master/staff",element:e.jsx(Ie,{children:e.jsx(Fe,{children:e.jsx(Yl,{})})})},{path:"/master/processes",element:e.jsx(Ie,{children:e.jsx(Fe,{children:e.jsx(Wl,{})})})},{path:"/master/raw-products",element:e.jsx(Ie,{children:e.jsx(Fe,{children:e.jsx(Gl,{})})})},{path:"/master/products",element:e.jsx(Ie,{children:e.jsx(Fe,{children:e.jsx(Jl,{})})})},{path:"/master/sales-channels",element:e.jsx(Ie,{children:e.jsx(Fe,{children:e.jsx(Xl,{})})})},{path:"/analytics",element:e.jsx(Ie,{children:e.jsx(Fe,{children:e.jsx(Bl,{})})})},{path:"/status/stock-status",element:e.jsx(Ie,{children:e.jsx(Fe,{children:e.jsx(ec,{})})})},{path:"/status/pre-production-status",element:e.jsx(Ie,{children:e.jsx(Fe,{children:e.jsx(tc,{})})})},{path:"/status/production-status",element:e.jsx(Ie,{children:e.jsx(Fe,{children:e.jsx(ac,{})})})},{path:"/status/post-production-status",element:e.jsx(Ie,{children:e.jsx(Fe,{children:e.jsx(ic,{})})})},{path:"/status/inventory-status",element:e.jsx(Ie,{children:e.jsx(Fe,{children:e.jsx(oc,{})})})},{path:"/tasks/pre-production",element:e.jsx(Ie,{children:e.jsx(Fe,{children:e.jsx(uc,{})})})},{path:"/tasks/production",element:e.jsx(Ie,{children:e.jsx(Fe,{children:e.jsx(xc,{})})})},{path:"/tasks/post-production",element:e.jsx(Ie,{children:e.jsx(Fe,{children:e.jsx(jc,{})})})},{path:"/settings",element:e.jsx(Ie,{children:e.jsx(Fe,{children:e.jsx(Yc,{})})})},{path:"*",element:e.jsx(Hl,{})}],{future:{v7_startTransition:!0}}),Jc=()=>e.jsx(Ki,{client:Wc,children:e.jsx(co,{children:e.jsx(Do,{children:e.jsxs(an,{children:[e.jsx(ao,{}),e.jsx(ro,{}),e.jsx(Io,{}),e.jsx(Bi,{router:Gc,future:{v7_startTransition:!0}})]})})})});Un(document.getElementById("root")).render(e.jsx(Jc,{}));

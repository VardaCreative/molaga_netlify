import{r as u,j as e,b as Le,k as Un}from"./0-react-core-CTNHgvAJ.js";import{V as nr,R as ir,A as or,C as lr,X as xt,T as cr,D as dr,P as Kn,j as Vn,$ as Bn,a as ur,b as Hn,c as zn,d as Qn,S as bt,W as Yn,e as Pa,f as rt,g as mr,O as aa,h as hr,i as ra,k as pr,l as na,m as ia,n as xr,o as Wn,H as Gn,p as Ta,q as Da,r as It,s as gr,t as ya,u as Ea,v as fr,w as jr,x as yr,y as Jn,z as vr,I as br,B as Nr,E as wr,F as Sr,G as _r,J as Xn,L as kr,K as Cr,M as Zn,N as ei,Q as Pr,U as Tr,Y as si,Z as ti,_ as Re,a0 as Dr,a1 as Er,a2 as Nt,a3 as ai,a4 as ri,a5 as Es,a6 as vs,a7 as va,a8 as Ms,a9 as ba,aa as Rr,ab as ni,ac as gt,ad as Ar,ae as Et,af as ii,ag as Xt,ah as ua,ai as Ka,aj as qr,ak as oi,al as li,am as Fr,an as ci,ao as ts,ap as Ks,aq as Va,ar as di,as as ui,at as mi,au as Ts,av as Vs,aw as Ir,ax as $r,ay as hi,az as Ra,aA as Lr,aB as pi,aC as Mr,aD as xi,aE as Or,aF as gi,aG as Ur,aH as Kr,aI as fi,aJ as ji,aK as Vr,aL as yi,aM as vi,aN as fs,aO as Br,aP as bi,aQ as Ni,aR as wi,aS as Si,aT as Hr,aU as _i,aV as ki,aW as zr,aX as Qr,aY as Ci,aZ as Pi,a_ as Ti,a$ as Di,b0 as Aa,b1 as Yr,b2 as Wr,b3 as Gr,b4 as Ei,b5 as Ba,b6 as oa,b7 as Ri,b8 as Ut,b9 as At,ba as qa,bb as Jr,bc as Ai,bd as Zt,be as qi,bf as Xr,bg as Fi,bh as Na,bi as wa,bj as Bt,bk as Ii,bl as $i,bm as Sa,bn as Li,bo as Mi}from"./1-ui-libs-BpjiZ-VE.js";import{t as Oi,q as Ui,r as nt,u as Ki}from"./9-vendor-CWobMp5c.js";import{u as he,a as is,b as Ne,Q as Vi}from"./2-react-query-BDX7x6OE.js";import{u as Ws,N as ma,a as wt,b as Fa,L as ks,c as Bi,R as Hi}from"./2-react-router-DJ5FTyjX.js";import{C as zi,A as Qi,D as Yi,I as at,Q as $e}from"./9-appwrite-Di8VTjYU.js";import{F as Ha,P as kt,G as Ct,e as Os,s as Us,H as ha,o as Xe,j as qt,I as As}from"./9-utils-CXq3ZHxZ.js";import{u as _s,w as za,r as Wi}from"./9-xlsx-hAyDQTdp.js";import"./2-react-deps-DlpLfDCO.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();const Gi=1,Ji=1e6;let pa=0;function Xi(){return pa=(pa+1)%Number.MAX_SAFE_INTEGER,pa.toString()}const xa=new Map,Qa=r=>{if(xa.has(r))return;const s=setTimeout(()=>{xa.delete(r),Rt({type:"REMOVE_TOAST",toastId:r})},Ji);xa.set(r,s)},Zi=(r,s)=>{switch(s.type){case"ADD_TOAST":return{...r,toasts:[s.toast,...r.toasts].slice(0,Gi)};case"UPDATE_TOAST":return{...r,toasts:r.toasts.map(t=>t.id===s.toast.id?{...t,...s.toast}:t)};case"DISMISS_TOAST":{const{toastId:t}=s;return t?Qa(t):r.toasts.forEach(a=>{Qa(a.id)}),{...r,toasts:r.toasts.map(a=>a.id===t||t===void 0?{...a,open:!1}:a)}}case"REMOVE_TOAST":return s.toastId===void 0?{...r,toasts:[]}:{...r,toasts:r.toasts.filter(t=>t.id!==s.toastId)}}},Ht=[];let zt={toasts:[]};function Rt(r){zt=Zi(zt,r),Ht.forEach(s=>{s(zt)})}function eo({...r}){const s=Xi(),t=n=>Rt({type:"UPDATE_TOAST",toast:{...n,id:s}}),a=()=>Rt({type:"DISMISS_TOAST",toastId:s});return Rt({type:"ADD_TOAST",toast:{...r,id:s,open:!0,onOpenChange:n=>{n||a()}}}),{id:s,dismiss:a,update:t}}function Ee(){const[r,s]=u.useState(zt);return u.useEffect(()=>(Ht.push(s),()=>{const t=Ht.indexOf(s);t>-1&&Ht.splice(t,1)}),[r]),{...r,toast:eo,dismiss:t=>Rt({type:"DISMISS_TOAST",toastId:t})}}function re(...r){return Oi(Ui(r))}const so=Kn,Zr=u.forwardRef(({className:r,...s},t)=>e.jsx(nr,{ref:t,className:re("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",r),...s}));Zr.displayName=nr.displayName;const to=nt("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),en=u.forwardRef(({className:r,variant:s,...t},a)=>e.jsx(ir,{ref:a,className:re(to({variant:s}),r),...t}));en.displayName=ir.displayName;const ao=u.forwardRef(({className:r,...s},t)=>e.jsx(or,{ref:t,className:re("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors group-[.destructive]:border-muted/40 hover:bg-secondary group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 group-[.destructive]:focus:ring-destructive disabled:pointer-events-none disabled:opacity-50",r),...s}));ao.displayName=or.displayName;const sn=u.forwardRef(({className:r,...s},t)=>e.jsx(lr,{ref:t,className:re("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity group-hover:opacity-100 group-[.destructive]:text-red-300 hover:text-foreground group-[.destructive]:hover:text-red-50 focus:opacity-100 focus:outline-none focus:ring-2 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",r),"toast-close":"",...s,children:e.jsx(xt,{className:"h-4 w-4"})}));sn.displayName=lr.displayName;const tn=u.forwardRef(({className:r,...s},t)=>e.jsx(cr,{ref:t,className:re("text-sm font-semibold",r),...s}));tn.displayName=cr.displayName;const an=u.forwardRef(({className:r,...s},t)=>e.jsx(dr,{ref:t,className:re("text-sm opacity-90",r),...s}));an.displayName=dr.displayName;function ro(){const{toasts:r}=Ee();return e.jsxs(so,{children:[r.map(function({id:s,title:t,description:a,action:n,...i}){return e.jsxs(en,{...i,children:[e.jsxs("div",{className:"grid gap-1",children:[t&&e.jsx(tn,{children:t}),a&&e.jsx(an,{children:a})]}),n,e.jsx(sn,{})]},s)}),e.jsx(Zr,{})]})}const no=({...r})=>{const{theme:s="system"}=Vn();return e.jsx(Bn,{theme:s,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...r})},rn=Hn,io=zn,oo=Qn,nn=u.forwardRef(({className:r,sideOffset:s=4,...t},a)=>e.jsx(ur,{ref:a,sideOffset:s,className:re("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...t}));nn.displayName=ur.displayName;const fe={PRE_PRODUCTION_STATUS:"pre_production_status",PRODUCTION_STATUS:"production_status",POST_PRODUCTION_STATUS:"post_production_status",INVENTORY_STATUS:"inventory_status",STOCK_STATUS:"stock_status",TASKS:"tasks",PRE_PRODUCTION_TASKS:"pre_production_tasks",PRODUCTION_TASKS:"production_tasks",PRODUCTION_TASK_ITEMS:"production_task_items",POST_PRODUCTION_TASKS:"post_production_tasks",STOCKS:"stocks",RAW_PRODUCTS:"raw_products",VENDORS:"vendors",STAFF:"staff",PROCESSES:"processes",PRODUCTS:"products",SALES_CHANNELS:"sales_channels",PURCHASES:"purchases",SALES_ORDERS:"sales_orders",SALES_ORDER_ITEMS:"sales_order_items",SALES_UNITS:"sales_units",SALES_RECORDS:"sales_records"},lo="https://fra.cloud.appwrite.io/v1",co="68cb76af00043a1c3b77",la=new zi;la.setEndpoint(lo);la.setProject(co);const Me=new Yi(la),qs=new Qi(la),Oe="68cb77a000339977dcb0",on=u.createContext(void 0),os=()=>{const r=u.useContext(on);if(r===void 0)throw new Error("useAuth must be used within an AuthProvider");return r},uo=({children:r})=>{const[s,t]=u.useState(null),[a,n]=u.useState(!0);u.useEffect(()=>{i()},[]);const i=async()=>{try{if(window.self!==window.top){console.log("Running in iframe environment (preview mode)");const N=localStorage.getItem("appwrite-auth-user");if(N)try{const q=JSON.parse(N);t(q),console.log("Using stored user data in iframe:",q.email),n(!1);return}catch{console.log("Invalid stored user data, clearing..."),localStorage.removeItem("appwrite-auth-user")}}const b=await qs.get();t(b),localStorage.setItem("appwrite-auth-user",JSON.stringify(b)),console.log("Authenticated user:",b.email)}catch(f){t(null),localStorage.removeItem("appwrite-auth-user"),console.error("Authentication check failed:",{code:f.code,message:f.message,type:f.type,response:f.response,isInIframe:window.self!==window.top}),f.code===401?console.log("Session expired or invalid, user needs to login again"):console.log("Not authenticated:",f.message)}finally{n(!1)}},l=async(f,b)=>{try{await qs.createEmailPasswordSession(f,b);const N=await qs.get();t(N),localStorage.setItem("appwrite-auth-user",JSON.stringify(N)),console.log("Successfully authenticated user:",N.email)}catch(N){throw console.error("Authentication error:",N.message),N}},d={user:s,login:l,register:async(f,b,N)=>{try{await qs.create("unique()",f,b,N),await l(f,b)}catch(q){throw q}},loginWithGoogle:async()=>{try{qs.createOAuth2Session("google",`${window.location.origin}/`,`${window.location.origin}/login`)}catch(f){throw f}},logout:async()=>{try{await qs.deleteSession("current"),t(null),localStorage.removeItem("appwrite-auth-user"),console.log("Successfully logged out")}catch(f){console.error("Logout error:",f.message),t(null),localStorage.removeItem("appwrite-auth-user")}},loading:a};return e.jsx(on.Provider,{value:d,children:r})};class ne{static field(s){return new mo(s)}static PATTERNS={EMAIL:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,PHONE:/^[\+]?[1-9][\d]{0,15}$/,PHONE_INTERNATIONAL:/^\+?[1-9]\d{1,14}$/,PHONE_US:/^(\+1|1)?[-.\s]?\(?[0-9]{3}\)?[-.\s]?[0-9]{3}[-.\s]?[0-9]{4}$/,URL:/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)$/,ALPHANUMERIC:/^[a-zA-Z0-9]+$/,ALPHA:/^[a-zA-Z]+$/,NUMERIC:/^[0-9]+$/,DECIMAL:/^[0-9]+(\.[0-9]+)?$/,DATE_ISO:/^\d{4}-\d{2}-\d{2}$/,DATE_US:/^(0[1-9]|1[0-2])\/(0[1-9]|[12][0-9]|3[01])\/\d{4}$/,TIME_24H:/^([01]?[0-9]|2[0-3]):[0-5][0-9]$/,TIME_12H:/^(0?[1-9]|1[0-2]):[0-5][0-9]\s?(AM|PM|am|pm)$/,SKU:/^[A-Z0-9\-_]+$/,CURRENCY:/^\$?[0-9]+(\.[0-9]{2})?$/};static COMMON_RULES={email:()=>({field:"email",type:"format",options:{pattern:ne.PATTERNS.EMAIL},message:"Invalid email format"}),phone:()=>({field:"phone",type:"format",options:{pattern:ne.PATTERNS.PHONE},message:"Invalid phone number format"}),currency:()=>({field:"amount",type:"format",options:{pattern:ne.PATTERNS.CURRENCY},message:"Invalid currency format (e.g., 123.45 or $123.45)"}),sku:()=>({field:"sku",type:"format",options:{pattern:ne.PATTERNS.SKU},message:"SKU must contain only uppercase letters, numbers, hyphens, and underscores"}),positiveNumber:s=>({field:s,type:"range",options:{min:0},message:"Value must be a positive number"}),percentage:s=>({field:s,type:"range",options:{min:0,max:100},message:"Percentage must be between 0 and 100"})};static isValidEmail(s){return this.PATTERNS.EMAIL.test(s)}static isValidPhone(s){return this.PATTERNS.PHONE.test(s)}static isValidDate(s){if(!s)return!1;const t=new Date(s);return!isNaN(t.getTime())}static isValidNumber(s,t,a){const n=Number(s);return!(isNaN(n)||t!==void 0&&n<t||a!==void 0&&n>a)}static isValidStringLength(s,t,a){return!(typeof s!="string"||t!==void 0&&s.length<t||a!==void 0&&s.length>a)}static isOneOf(s,t){return t.includes(s)}static isUnique(s,t,a,n){return a.filter((l,h)=>n!==void 0&&h===n?!1:l[t]===s).length===0}static sanitizeValue(s){if(typeof s=="string"){if(s=s.trim(),s==="")return null;s=s.replace(/[\u200B-\u200D\uFEFF]/g,""),s=s.replace(/\u00A0/g," ")}return s}static convertType(s,t){if(s==null)return null;switch(t){case"string":return String(s);case"number":const a=Number(s);return isNaN(a)?null:a;case"boolean":if(typeof s=="boolean")return s;if(typeof s=="string"){const i=s.toLowerCase();if(["true","1","yes","y","on"].includes(i))return!0;if(["false","0","no","n","off"].includes(i))return!1}return!!s;case"date":const n=new Date(s);return isNaN(n.getTime())?null:n;default:return s}}static formatErrorMessage(s,t,a){if(t.message)return t.message;switch(t.type){case"required":return`${s} is required`;case"format":return`${s} has invalid format`;case"range":return t.options?.min!==void 0&&t.options?.max!==void 0?`${s} must be between ${t.options.min} and ${t.options.max}`:t.options?.min!==void 0?`${s} must be at least ${t.options.min}`:t.options?.max!==void 0?`${s} must be at most ${t.options.max}`:`${s} is out of range`;case"unique":return`${s} must be unique (duplicate value: ${a})`;default:return`${s} validation failed`}}static createRulesForDataType(s,t,a=!1){const n=[];switch(a&&n.push({field:s,type:"required",message:`${s} is required`}),t.toLowerCase()){case"email":n.push(this.COMMON_RULES.email());break;case"phone":n.push(this.COMMON_RULES.phone());break;case"currency":case"money":n.push(this.COMMON_RULES.currency());break;case"sku":n.push(this.COMMON_RULES.sku());break;case"percentage":n.push(this.COMMON_RULES.percentage(s));break;case"positive_number":n.push(this.COMMON_RULES.positiveNumber(s));break;case"date":n.push({field:s,type:"custom",validator:i=>this.isValidDate(i),message:"Invalid date format"});break;case"url":n.push({field:s,type:"format",options:{pattern:this.PATTERNS.URL},message:"Invalid URL format"});break}return n}static createForeignKeyRule(s,t,a="id",n){return{field:s,type:"custom",validator:i=>i?t.some(l=>l[a]===i):!0,message:n||`${s} must reference a valid ${a}`}}static createConditionalRule(s,t,a){return{...a,field:s,validator:(n,i)=>{if(!t(i))return!0;if(a.validator)return a.validator(n,i);switch(a.type){case"required":return n!=null&&n!=="";case"format":return a.options?.pattern?a.options.pattern.test(String(n)):!0;default:return!0}}}}}class mo{constructor(s){this.field=s,this.rule={field:s}}rule;required(){return this.rule.type="required",this.rule.message=`${this.field} is required`,this}email(){return this.rule.type="format",this.rule.options={pattern:ne.PATTERNS.EMAIL},this.rule.message="Invalid email format",this}phone(){return this.rule.type="format",this.rule.options={pattern:ne.PATTERNS.PHONE},this.rule.message="Invalid phone number format",this}number(s,t){return this.rule.type="range",this.rule.options={min:s,max:t},s!==void 0&&t!==void 0?this.rule.message=`Must be between ${s} and ${t}`:s!==void 0?this.rule.message=`Must be at least ${s}`:t!==void 0&&(this.rule.message=`Must be at most ${t}`),this}string(s,t){return this.rule.type="custom",this.rule.validator=a=>ne.isValidStringLength(String(a),s,t),s!==void 0&&t!==void 0?this.rule.message=`Must be between ${s} and ${t} characters`:s!==void 0?this.rule.message=`Must be at least ${s} characters`:t!==void 0&&(this.rule.message=`Must be at most ${t} characters`),this}date(){return this.rule.type="custom",this.rule.validator=s=>ne.isValidDate(s),this.rule.message="Invalid date format",this}boolean(){return this.rule.type="custom",this.rule.validator=s=>{if(typeof s=="boolean")return!0;if(typeof s=="string"){const t=s.toLowerCase();return["true","false","1","0","yes","no","y","n"].includes(t)}return!1},this.rule.message="Must be a valid boolean value (true/false, yes/no, 1/0)",this}oneOf(s){return this.rule.type="custom",this.rule.validator=t=>ne.isOneOf(t,s),this.rule.message=`Must be one of: ${s.join(", ")}`,this}pattern(s,t){return this.rule.type="format",this.rule.options={pattern:s},this.rule.message=t||"Invalid format",this}unique(){return this.rule.type="unique",this.rule.message=`${this.field} must be unique`,this}custom(s,t){return this.rule.type="custom",this.rule.validator=(a,n,i)=>{const l={row:n||{},rowNumber:n&&n._rowNumber||0,allData:i||[],fieldName:this.field};return s(a,l)},this.rule.message=t||"Custom validation failed",this}build(){return this.rule}}const ho=r=>{try{if(!r)return"No Date";const s=new Date(r);if(isNaN(s.getTime()))return console.warn("Invalid date value:",r),"Invalid Date";const t=String(s.getDate()).padStart(2,"0"),a=String(s.getMonth()+1).padStart(2,"0"),n=s.getFullYear();return`${t}/${a}/${n}`}catch(s){return console.error("Date formatting error:",s,"Input:",r),"Invalid Date"}},ca=r=>{try{if(!r)return console.warn("formatTableDate: Empty date value received"),"No Date";if(r==="Invalid Date"||r==="NaN")return console.warn("formatTableDate: Invalid date string received:",r),"Invalid Date";let s;if(typeof r=="string"&&/^\d{2}\/\d{2}\/\d{4}$/.test(r)){const[l,h,c]=r.split("/");s=new Date(`${c}-${h}-${l}`)}else s=new Date(r);if(isNaN(s.getTime()))return console.warn("formatTableDate: Could not parse date:",r,"Type:",typeof r),"Invalid Date";const t=String(s.getDate()).padStart(2,"0"),a=String(s.getMonth()+1).padStart(2,"0"),n=s.getFullYear(),i=`${t}/${a}/${n}`;return console.log("ðŸ“… formatTableDate:",{input:r,output:i}),i}catch(s){return console.error("formatTableDate: Error formatting date:",s,"Input:",r),"Invalid Date"}},it=r=>ho(r),po={pageName:"stocks",exportEnabled:!0,importEnabled:!0,sortableColumns:["name","sku","category","unit","openingBalance","createdAt"],exportColumns:[{dataKey:"name",exportHeader:"Stock Name",required:!0},{dataKey:"sku",exportHeader:"SKU",required:!0},{dataKey:"category",exportHeader:"Category"},{dataKey:"unit",exportHeader:"Unit",required:!0},{dataKey:"openingBalance",exportHeader:"Opening Balance",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"description",exportHeader:"Description"},{dataKey:"createdAt",exportHeader:"Created Date",dataType:"date",formatter:r=>it(r)}],importValidation:[ne.field("name").required().string(1,100).build(),ne.field("sku").required().pattern(ne.PATTERNS.SKU).build(),ne.field("unit").required().oneOf(["kg","g","l","ml","pcs","box","pack"]).build(),ne.field("openingBalance").number(0).build(),ne.field("category").string(0,50).build()],tableColumns:[{key:"name",label:"Stock Name",sortable:!0,dataType:"string"},{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"category",label:"Category",sortable:!0,dataType:"string"},{key:"unit",label:"Unit",sortable:!0,dataType:"string"},{key:"openingBalance",label:"Opening Balance",sortable:!0,dataType:"number",align:"right"},{key:"createdAt",label:"Created",sortable:!0,dataType:"date"}]},xo={pageName:"products",exportEnabled:!0,importEnabled:!0,sortableColumns:["name","sku","category","price","createdAt"],exportColumns:[{dataKey:"name",exportHeader:"Product Name",required:!0},{dataKey:"sku",exportHeader:"SKU",required:!0},{dataKey:"category",exportHeader:"Category"},{dataKey:"price",exportHeader:"Price",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"description",exportHeader:"Description"},{dataKey:"isActive",exportHeader:"Active",dataType:"boolean",formatter:r=>r?"Yes":"No"},{dataKey:"createdAt",exportHeader:"Created Date",dataType:"date",formatter:r=>it(r)}],importValidation:[ne.field("name").required().string(1,100).build(),ne.field("sku").required().pattern(ne.PATTERNS.SKU).build(),ne.field("price").number(0).build(),ne.field("category").string(0,50).build(),ne.field("isActive").boolean().build()],tableColumns:[{key:"name",label:"Product Name",sortable:!0,dataType:"string"},{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"category",label:"Category",sortable:!0,dataType:"string"},{key:"price",label:"Price",sortable:!0,dataType:"number",align:"right"},{key:"isActive",label:"Active",sortable:!0,dataType:"boolean"},{key:"createdAt",label:"Created",sortable:!0,dataType:"date"}]},go={pageName:"raw-products",exportEnabled:!0,importEnabled:!0,sortableColumns:["name","sku","unit","costPerUnit","createdAt"],exportColumns:[{dataKey:"name",exportHeader:"Raw Product Name",required:!0},{dataKey:"sku",exportHeader:"SKU",required:!0},{dataKey:"unit",exportHeader:"Unit",required:!0},{dataKey:"costPerUnit",exportHeader:"Cost Per Unit",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"description",exportHeader:"Description"},{dataKey:"createdAt",exportHeader:"Created Date",dataType:"date",formatter:r=>it(r)}],importValidation:[ne.field("name").required().string(1,100).build(),ne.field("sku").required().pattern(ne.PATTERNS.SKU).build(),ne.field("unit").required().oneOf(["kg","g","l","ml","pcs","box","pack"]).build(),ne.field("costPerUnit").number(0).build()],tableColumns:[{key:"name",label:"Raw Product Name",sortable:!0,dataType:"string"},{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"unit",label:"Unit",sortable:!0,dataType:"string"},{key:"costPerUnit",label:"Cost Per Unit",sortable:!0,dataType:"number",align:"right"},{key:"createdAt",label:"Created",sortable:!0,dataType:"date"}]},fo={pageName:"staff",exportEnabled:!0,importEnabled:!0,sortableColumns:["name","email","phone","role","isActive","createdAt"],exportColumns:[{dataKey:"name",exportHeader:"Staff Name",required:!0},{dataKey:"email",exportHeader:"Email",required:!0},{dataKey:"phone",exportHeader:"Phone"},{dataKey:"role",exportHeader:"Role",required:!0},{dataKey:"department",exportHeader:"Department"},{dataKey:"isActive",exportHeader:"Active",dataType:"boolean",formatter:r=>r?"Yes":"No"},{dataKey:"createdAt",exportHeader:"Created Date",dataType:"date",formatter:r=>it(r)}],importValidation:[ne.field("name").required().string(1,100).build(),ne.field("email").required().email().build(),ne.field("phone").phone().build(),ne.field("role").required().oneOf(["admin","manager","operator","viewer"]).build(),ne.field("department").string(0,50).build(),ne.field("isActive").boolean().build()],tableColumns:[{key:"name",label:"Staff Name",sortable:!0,dataType:"string"},{key:"email",label:"Email",sortable:!0,dataType:"string"},{key:"phone",label:"Phone",sortable:!0,dataType:"string"},{key:"role",label:"Role",sortable:!0,dataType:"string"},{key:"isActive",label:"Active",sortable:!0,dataType:"boolean"},{key:"createdAt",label:"Created",sortable:!0,dataType:"date"}]},jo={pageName:"vendors",exportEnabled:!0,importEnabled:!0,sortableColumns:["name","email","phone","contactPerson","isActive","createdAt"],exportColumns:[{dataKey:"name",exportHeader:"Vendor Name",required:!0},{dataKey:"email",exportHeader:"Email"},{dataKey:"phone",exportHeader:"Phone"},{dataKey:"contactPerson",exportHeader:"Contact Person"},{dataKey:"address",exportHeader:"Address"},{dataKey:"isActive",exportHeader:"Active",dataType:"boolean",formatter:r=>r?"Yes":"No"},{dataKey:"createdAt",exportHeader:"Created Date",dataType:"date",formatter:r=>it(r)}],importValidation:[ne.field("name").required().string(1,100).build(),ne.field("email").email().build(),ne.field("phone").phone().build(),ne.field("contactPerson").string(0,100).build(),ne.field("address").string(0,200).build(),ne.field("isActive").boolean().build()],tableColumns:[{key:"name",label:"Vendor Name",sortable:!0,dataType:"string"},{key:"email",label:"Email",sortable:!0,dataType:"string"},{key:"phone",label:"Phone",sortable:!0,dataType:"string"},{key:"contactPerson",label:"Contact Person",sortable:!0,dataType:"string"},{key:"isActive",label:"Active",sortable:!0,dataType:"boolean"},{key:"createdAt",label:"Created",sortable:!0,dataType:"date"}]},yo={pageName:"processes",exportEnabled:!0,importEnabled:!0,sortableColumns:["name","description","estimatedTime","isActive","createdAt"],exportColumns:[{dataKey:"name",exportHeader:"Process Name",required:!0},{dataKey:"description",exportHeader:"Description"},{dataKey:"estimatedTime",exportHeader:"Estimated Time (minutes)",dataType:"number"},{dataKey:"isActive",exportHeader:"Active",dataType:"boolean",formatter:r=>r?"Yes":"No"},{dataKey:"createdAt",exportHeader:"Created Date",dataType:"date",formatter:r=>it(r)}],importValidation:[ne.field("name").required().string(1,100).build(),ne.field("description").string(0,500).build(),ne.field("estimatedTime").number(0).build(),ne.field("isActive").boolean().build()],tableColumns:[{key:"name",label:"Process Name",sortable:!0,dataType:"string"},{key:"description",label:"Description",sortable:!0,dataType:"string"},{key:"estimatedTime",label:"Est. Time (min)",sortable:!0,dataType:"number",align:"right"},{key:"isActive",label:"Active",sortable:!0,dataType:"boolean"},{key:"createdAt",label:"Created",sortable:!0,dataType:"date"}]},vo={pageName:"sales-channels",exportEnabled:!0,importEnabled:!0,sortableColumns:["name","type","commission","isActive","createdAt"],exportColumns:[{dataKey:"name",exportHeader:"Channel Name",required:!0},{dataKey:"type",exportHeader:"Type",required:!0},{dataKey:"commission",exportHeader:"Commission (%)",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"description",exportHeader:"Description"},{dataKey:"isActive",exportHeader:"Active",dataType:"boolean",formatter:r=>r?"Yes":"No"},{dataKey:"createdAt",exportHeader:"Created Date",dataType:"date",formatter:r=>it(r)}],importValidation:[ne.field("name").required().string(1,100).build(),ne.field("type").required().oneOf(["online","retail","wholesale","distributor"]).build(),ne.field("commission").number(0,100).build(),ne.field("description").string(0,500).build(),ne.field("isActive").boolean().build()],tableColumns:[{key:"name",label:"Channel Name",sortable:!0,dataType:"string"},{key:"type",label:"Type",sortable:!0,dataType:"string"},{key:"commission",label:"Commission (%)",sortable:!0,dataType:"number",align:"right"},{key:"isActive",label:"Active",sortable:!0,dataType:"boolean"},{key:"createdAt",label:"Created",sortable:!0,dataType:"date"}]},bo={pageName:"sales-units",exportEnabled:!0,importEnabled:!0,sortableColumns:["date","productName","sku","units","status","remarks"],exportColumns:[{dataKey:"date",exportHeader:"Date",dataType:"date",formatter:r=>new Date(r).toLocaleDateString("en-GB")},{dataKey:"productName",exportHeader:"Product",required:!0},{dataKey:"sku",exportHeader:"SKU",required:!0},{dataKey:"units",exportHeader:"Units",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"status",exportHeader:"Status"},{dataKey:"remarks",exportHeader:"Remarks"}],importValidation:[ne.field("date").required().date().build(),ne.field("productName").required().string(1,100).build(),ne.field("sku").required().string(1,50).build(),ne.field("units").required().number(.01).build(),ne.field("status").string(0,50).build(),ne.field("remarks").string(0,500).build()],tableColumns:[{key:"date",label:"Date",sortable:!0,dataType:"date"},{key:"productName",label:"Product",sortable:!0,dataType:"string"},{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"units",label:"Units",sortable:!0,dataType:"number",align:"right"},{key:"status",label:"Status",sortable:!0,dataType:"string"},{key:"remarks",label:"Remarks",sortable:!0,dataType:"string"}]},No={pageName:"sales-record",exportEnabled:!0,importEnabled:!0,sortableColumns:["date","channelName","productName","sku","qty","rate","totalAmount","status","remarks"],exportColumns:[{dataKey:"date",exportHeader:"Date",dataType:"date",formatter:r=>new Date(r).toLocaleDateString("en-GB")},{dataKey:"channelName",exportHeader:"Sales Channel",required:!0},{dataKey:"productName",exportHeader:"Product",required:!0},{dataKey:"sku",exportHeader:"SKU",required:!0},{dataKey:"qty",exportHeader:"Qty",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"rate",exportHeader:"Rate",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"totalAmount",exportHeader:"Total Amount",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"status",exportHeader:"Status"},{dataKey:"remarks",exportHeader:"Remarks"}],importValidation:[ne.field("date").required().date().build(),ne.field("channelName").required().string(1,100).build(),ne.field("productName").required().string(1,100).build(),ne.field("sku").required().string(1,50).build(),ne.field("qty").required().number(.01).build(),ne.field("rate").required().number(.01).build(),ne.field("totalAmount").number(.01).build(),ne.field("status").string(0,50).build(),ne.field("remarks").string(0,500).build()],tableColumns:[{key:"date",label:"Date",sortable:!0,dataType:"date"},{key:"channelName",label:"Sales Channel",sortable:!0,dataType:"string"},{key:"productName",label:"Product",sortable:!0,dataType:"string"},{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"qty",label:"Qty",sortable:!0,dataType:"number",align:"right"},{key:"rate",label:"Rate",sortable:!0,dataType:"number",align:"right"},{key:"totalAmount",label:"Total Amount",sortable:!0,dataType:"number",align:"right"},{key:"status",label:"Status",sortable:!0,dataType:"string"},{key:"remarks",label:"Remarks",sortable:!0,dataType:"string"}]},wo={pageName:"purchases",exportEnabled:!0,importEnabled:!0,sortableColumns:["purchaseCode","date","vendorName","stockName","quantity","rate","totalAmount","status"],exportColumns:[{dataKey:"purchaseCode",exportHeader:"Purchase Code",required:!0},{dataKey:"date",exportHeader:"Date",dataType:"date",formatter:r=>new Date(r).toLocaleDateString("en-GB")},{dataKey:"vendorName",exportHeader:"Vendor Name",required:!0},{dataKey:"stockName",exportHeader:"Stock Name",required:!0},{dataKey:"quantity",exportHeader:"Quantity",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"rate",exportHeader:"Rate",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"totalAmount",exportHeader:"Total Amount",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"status",exportHeader:"Status"}],importValidation:[ne.field("purchaseCode").required().string(1,50).build(),ne.field("date").required().date().build(),ne.field("vendorName").required().string(1,100).build(),ne.field("stockName").required().string(1,100).build(),ne.field("quantity").required().number(.01).build(),ne.field("rate").required().number(.01).build(),ne.field("totalAmount").number(.01).build(),ne.field("status").string(0,50).build()],tableColumns:[{key:"purchaseCode",label:"Purchase Code",sortable:!0,dataType:"string"},{key:"date",label:"Date",sortable:!0,dataType:"date"},{key:"vendorName",label:"Vendor Name",sortable:!0,dataType:"string"},{key:"stockName",label:"Stock Name",sortable:!0,dataType:"string"},{key:"quantity",label:"Quantity",sortable:!0,dataType:"number",align:"right"},{key:"unitPrice",label:"Unit Price",sortable:!0,dataType:"number",align:"right"},{key:"totalAmount",label:"Total",sortable:!0,dataType:"number",align:"right"},{key:"purchaseDate",label:"Purchase Date",sortable:!0,dataType:"date"},{key:"vendorName",label:"Vendor",sortable:!0,dataType:"string"},{key:"createdAt",label:"Created",sortable:!0,dataType:"date"}]},So={pageName:"pre-production-tasks",exportEnabled:!0,importEnabled:!0,sortableColumns:["task_id","stock_name","stock_source","date_assigned","process_name","assigned_quantity","staff_name","date_completed","completed_quantity","wastage_quantity","status"],exportColumns:[{dataKey:"task_id",exportHeader:"Task ID",required:!0},{dataKey:"stock_name",exportHeader:"Stock Name",required:!0},{dataKey:"stock_source",exportHeader:"Stock Source"},{dataKey:"date_assigned",exportHeader:"Date Assigned",dataType:"date",formatter:r=>new Date(r).toLocaleDateString("en-GB")},{dataKey:"process_name",exportHeader:"Process",required:!0},{dataKey:"assigned_quantity",exportHeader:"Assigned Qty",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"staff_name",exportHeader:"Staff Name"},{dataKey:"date_completed",exportHeader:"Date Completed",dataType:"date",formatter:r=>r?new Date(r).toLocaleDateString("en-GB"):""},{dataKey:"completed_quantity",exportHeader:"Completed Qty",dataType:"number",formatter:r=>r?Number(r).toFixed(2):"0.00"},{dataKey:"wastage_quantity",exportHeader:"Wastage Qty",dataType:"number",formatter:r=>r?Number(r).toFixed(2):"0.00"},{dataKey:"remarks",exportHeader:"Remarks"},{dataKey:"status",exportHeader:"Status"}],importValidation:[ne.field("task_id").required().string(1,50).build(),ne.field("stock_name").required().string(1,100).build(),ne.field("assigned_quantity").required().number(.01).build(),ne.field("status").required().oneOf(["pending","in_progress","completed","cancelled"]).build(),ne.field("date_assigned").date().build(),ne.field("staff_name").string(0,100).build()],tableColumns:[{key:"task_id",label:"Task ID",sortable:!0,dataType:"string"},{key:"stock_name",label:"Stock Name",sortable:!0,dataType:"string"},{key:"stock_source",label:"Stock Source",sortable:!0,dataType:"string"},{key:"date_assigned",label:"Date Assigned",sortable:!0,dataType:"date"},{key:"process_name",label:"Process",sortable:!0,dataType:"string"},{key:"assigned_quantity",label:"Assigned Qty",sortable:!0,dataType:"number",align:"right"},{key:"staff_name",label:"Staff Name",sortable:!0,dataType:"string"},{key:"date_completed",label:"Date Completed",sortable:!0,dataType:"date"},{key:"completed_quantity",label:"Completed Qty",sortable:!0,dataType:"number",align:"right"},{key:"wastage_quantity",label:"Wastage Qty",sortable:!0,dataType:"number",align:"right"},{key:"status",label:"Status",sortable:!0,dataType:"string"}]},_o={pageName:"production-tasks",exportEnabled:!0,importEnabled:!0,sortableColumns:["task_id","date","raw_product_name","process_name","staff_name","assigned_quantity","wastage_quantity","status"],exportColumns:[{dataKey:"task_id",exportHeader:"Task ID",required:!0},{dataKey:"date",exportHeader:"Date",dataType:"date",formatter:r=>new Date(r).toLocaleDateString("en-GB")},{dataKey:"raw_product_name",exportHeader:"Raw Product",required:!0},{dataKey:"process_name",exportHeader:"Process",required:!0},{dataKey:"staff_name",exportHeader:"Staff Name"},{dataKey:"assigned_quantity",exportHeader:"Assigned Qty",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"wastage_quantity",exportHeader:"Wastage Qty",dataType:"number",formatter:r=>r?Number(r).toFixed(2):"0.00"},{dataKey:"status",exportHeader:"Status"}],importValidation:[ne.field("task_id").required().string(1,50).build(),ne.field("raw_product_name").required().string(1,100).build(),ne.field("process_name").required().string(1,100).build(),ne.field("assigned_quantity").required().number(.01).build(),ne.field("status").required().oneOf(["pending","in_progress","completed","cancelled"]).build(),ne.field("date").date().build(),ne.field("staff_name").string(0,100).build()],tableColumns:[{key:"task_id",label:"Task ID",sortable:!0,dataType:"string"},{key:"date",label:"Date",sortable:!0,dataType:"date"},{key:"raw_product_name",label:"Raw Product",sortable:!0,dataType:"string"},{key:"process_name",label:"Process",sortable:!0,dataType:"string"},{key:"assignedQuantity",label:"Quantity",sortable:!0,dataType:"number",align:"right"},{key:"assignedTo",label:"Assigned To",sortable:!0,dataType:"string"},{key:"status",label:"Status",sortable:!0,dataType:"string"},{key:"dueDate",label:"Due Date",sortable:!0,dataType:"date"},{key:"createdAt",label:"Created",sortable:!0,dataType:"date"}]},ko={pageName:"post-production-tasks",exportEnabled:!0,importEnabled:!0,sortableColumns:["task_id","date","date_completed","source_quantity","sku","product_name","process_name","staff_name","assigned_quantity","units","wastage_quantity","status"],exportColumns:[{dataKey:"task_id",exportHeader:"Task ID",required:!0},{dataKey:"date",exportHeader:"Date Assigned",dataType:"date",formatter:r=>new Date(r).toLocaleDateString("en-GB")},{dataKey:"date_completed",exportHeader:"Date Completed",dataType:"date",formatter:r=>r?new Date(r).toLocaleDateString("en-GB"):""},{dataKey:"source_quantity",exportHeader:"Source Qty",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"sku",exportHeader:"SKU",required:!0},{dataKey:"product_name",exportHeader:"Product",required:!0},{dataKey:"process_name",exportHeader:"Process",required:!0},{dataKey:"staff_name",exportHeader:"Staff Name"},{dataKey:"assigned_quantity",exportHeader:"Assigned Units",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"units",exportHeader:"Completed Units",dataType:"number",formatter:r=>r?Number(r).toFixed(2):"0.00"},{dataKey:"wastage_quantity",exportHeader:"Wastage Qty",dataType:"number",formatter:r=>r?Number(r).toFixed(2):"0.00"},{dataKey:"remarks",exportHeader:"Remarks"},{dataKey:"status",exportHeader:"Status"}],importValidation:[ne.field("task_id").required().string(1,50).build(),ne.field("product_name").required().string(1,100).build(),ne.field("sku").required().string(1,50).build(),ne.field("process_name").required().string(1,100).build(),ne.field("source_quantity").required().number(.01).build(),ne.field("assigned_quantity").required().number(.01).build(),ne.field("status").required().oneOf(["pending","in_progress","completed","cancelled"]).build(),ne.field("date").date().build(),ne.field("staff_name").string(0,100).build()],tableColumns:[{key:"task_id",label:"Task ID",sortable:!0,dataType:"string"},{key:"date",label:"Date Assigned",sortable:!0,dataType:"date"},{key:"date_completed",label:"Date Completed",sortable:!0,dataType:"date"},{key:"source_quantity",label:"Source Qty",sortable:!0,dataType:"number",align:"right"},{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"product_name",label:"Product",sortable:!0,dataType:"string"},{key:"process_name",label:"Process",sortable:!0,dataType:"string"},{key:"staff_name",label:"Staff Name",sortable:!0,dataType:"string"},{key:"assigned_quantity",label:"Assigned Units",sortable:!0,dataType:"number",align:"right"},{key:"units",label:"Completed Units",sortable:!0,dataType:"number",align:"right"},{key:"wastage_quantity",label:"Wastage Qty",sortable:!0,dataType:"number",align:"right"},{key:"status",label:"Status",sortable:!0,dataType:"string"}]},Co={pageName:"stock-status",exportEnabled:!0,importEnabled:!1,sortableColumns:["stockName","openingBalance","purchases","sales","closingBalance"],exportColumns:[{dataKey:"stockName",exportHeader:"Stock Name"},{dataKey:"openingBalance",exportHeader:"Opening Balance",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"purchases",exportHeader:"Purchases",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"sales",exportHeader:"Sales",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"closingBalance",exportHeader:"Closing Balance",dataType:"number",formatter:r=>Number(r).toFixed(2)}],importValidation:[],tableColumns:[{key:"stockName",label:"Stock Name",sortable:!0,dataType:"string"},{key:"openingBalance",label:"Opening Balance",sortable:!0,dataType:"number",align:"right"},{key:"purchases",label:"Purchases",sortable:!0,dataType:"number",align:"right"},{key:"sales",label:"Sales",sortable:!0,dataType:"number",align:"right"},{key:"closingBalance",label:"Closing Balance",sortable:!0,dataType:"number",align:"right"}]},Po={pageName:"inventory-status",exportEnabled:!0,importEnabled:!1,sortableColumns:["stockName","openingBalance","salesUnits","soldUnits","closingBalance"],exportColumns:[{dataKey:"stockName",exportHeader:"Stock Name"},{dataKey:"openingBalance",exportHeader:"Opening Balance",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"salesUnits",exportHeader:"Sales Units",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"soldUnits",exportHeader:"Sold Units",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"closingBalance",exportHeader:"Closing Balance",dataType:"number",formatter:r=>Number(r).toFixed(2)}],importValidation:[],tableColumns:[{key:"stockName",label:"Stock Name",sortable:!0,dataType:"string"},{key:"openingBalance",label:"Opening Balance",sortable:!0,dataType:"number",align:"right"},{key:"salesUnits",label:"Sales Units",sortable:!0,dataType:"number",align:"right"},{key:"soldUnits",label:"Sold Units",sortable:!0,dataType:"number",align:"right"},{key:"closingBalance",label:"Closing Balance",sortable:!0,dataType:"number",align:"right"}]},ln={stocks:po,products:xo,"raw-products":go,staff:fo,vendors:jo,processes:yo,"sales-channels":vo,"sales-units":bo,"sales-record":No,purchases:wo,"pre-production-tasks":So,"production-tasks":_o,"post-production-tasks":ko,"stock-status":Co,"inventory-status":Po},To=r=>ln[r],Do={defaultExportFormat:"xlsx",maxImportFileSize:50,defaultBatchSize:100,enableProgressTracking:!0,autoRefreshInterval:300,cacheTimeout:30,enableValidationWarnings:!0,defaultSortDirection:"asc",enableMultiSort:!1,maxExportRows:1e5,enableBackgroundExport:!0},cn=u.createContext(void 0),Eo=({children:r,initialSettings:s={}})=>{const[t,a]=u.useState({}),[n,i]=u.useState({...Do,...s}),[l,h]=u.useState(!1),[c,o]=u.useState(null);u.useEffect(()=>{try{const S=localStorage.getItem("dataManagementSettings");if(S){const Q=JSON.parse(S);i(V=>({...V,...Q}))}}catch(S){console.warn("Failed to load saved settings:",S)}},[]),u.useEffect(()=>{try{localStorage.setItem("dataManagementSettings",JSON.stringify(n))}catch(S){console.warn("Failed to save settings:",S)}},[n]),u.useEffect(()=>{if(n.autoRefreshInterval>0){const S=setInterval(()=>{d()},n.autoRefreshInterval*1e3);return()=>clearInterval(S)}},[n.autoRefreshInterval]);const d=()=>{const S=Date.now(),Q=n.cacheTimeout*60*1e3;a(V=>{const w={...V};return Object.keys(w).forEach(m=>{S-w[m].timestamp>Q&&delete w[m]}),w})},f=u.useCallback(S=>{try{const Q=t[S],V=Date.now(),w=n.cacheTimeout*60*1e3;if(Q&&V-Q.timestamp<w)return Q.config;const m=To(S);return m&&setTimeout(()=>{a(F=>({...F,[S]:{config:m,timestamp:V}}))},0),m}catch(Q){o(`Failed to get configuration for ${S}: ${Q instanceof Error?Q.message:"Unknown error"}`);return}},[t,n.cacheTimeout]),b=(S,Q)=>{try{const V=f(S);if(!V)throw new Error(`Configuration not found for page: ${S}`);const w={...V,...Q};a(m=>({...m,[S]:{config:w,timestamp:Date.now()}})),ln[S]=w,o(null)}catch(V){o(`Failed to update configuration for ${S}: ${V instanceof Error?V.message:"Unknown error"}`)}},N=S=>{try{a(Q=>{const V={...Q};return delete V[S],V}),o(null)}catch(Q){o(`Failed to reset configuration for ${S}: ${Q instanceof Error?Q.message:"Unknown error"}`)}},q=S=>f(S)?.exportEnabled||!1,L=S=>f(S)?.importEnabled||!1,x=S=>f(S)?.exportColumns||[],C=S=>f(S)?.tableColumns||[],E=S=>f(S)?.importValidation||[],$=S=>{i(Q=>({...Q,...S})),o(null)},k=()=>{a({}),o(null)},M={getConfig:f,updateConfig:b,resetConfig:N,canExport:q,canImport:L,getExportColumns:x,getTableColumns:C,getValidationRules:E,globalSettings:n,updateGlobalSettings:$,clearCache:k,refreshConfig:S=>{S?a(Q=>{const V={...Q};return delete V[S],V}):k(),o(null)},isLoading:l,error:c};return e.jsx(cn.Provider,{value:M,children:r})},Ia=()=>{const r=u.useContext(cn);if(r===void 0)throw new Error("useDataManagement must be used within a DataManagementProvider");return r},bs=r=>{const{getConfig:s,updateConfig:t,resetConfig:a,canExport:n,canImport:i}=Ia(),l=s(r);return{config:l,canExport:n(r),canImport:i(r),updateConfig:h=>t(r,h),resetConfig:()=>a(r),isConfigured:!!l}},Ns=r=>{const{getValidationRules:s,canImport:t,globalSettings:a}=Ia();return{validationRules:s(r),canImport:t(r),maxFileSize:a.maxImportFileSize,batchSize:a.defaultBatchSize,enableWarnings:a.enableValidationWarnings}},Ro=r=>{const{getTableColumns:s,globalSettings:t}=Ia();return{columns:s(r),defaultSortDirection:t.defaultSortDirection,enableMultiSort:t.enableMultiSort}},_a=nt("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),D=u.forwardRef(({className:r,variant:s,size:t,asChild:a=!1,...n},i)=>{const l=a?bt:"button";return e.jsx(l,{className:re(_a({variant:s,size:t,className:r})),ref:i,...n})});D.displayName="Button";const Ao=nt("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),Ue=u.forwardRef(({className:r,variant:s,...t},a)=>e.jsx("div",{ref:a,role:"alert",className:re(Ao({variant:s}),r),...t}));Ue.displayName="Alert";const qo=u.forwardRef(({className:r,...s},t)=>e.jsx("h5",{ref:t,className:re("mb-1 font-medium leading-none tracking-tight",r),...s}));qo.displayName="AlertTitle";const Ke=u.forwardRef(({className:r,...s},t)=>e.jsx("div",{ref:t,className:re("text-sm [&_p]:leading-relaxed",r),...s}));Ke.displayName="AlertDescription";class Fo{isDevelopment=!1;isVerbose=!1;log(...s){this.isDevelopment&&console.log(...s)}verbose(...s){this.isDevelopment&&this.isVerbose&&console.log(...s)}warn(...s){this.isDevelopment&&console.warn(...s)}error(...s){console.error(...s),this.isDevelopment}logWithContext(s,t,a){if(this.isDevelopment){const n=this.formatContext(t);console.log(`${n} ${s}`,a||"")}}performance(s,t){if(this.isDevelopment){console.time(s);const a=t();return console.timeEnd(s),a}return t()}async performanceAsync(s,t){if(this.isDevelopment){console.time(s);const a=await t();return console.timeEnd(s),a}return t()}group(s,t){this.isDevelopment&&(console.group(s),t(),console.groupEnd())}table(s){this.isDevelopment&&console.table(s)}json(s,t){this.isDevelopment&&console.log(`${s}:`,JSON.stringify(t,null,2))}assert(s,t){this.isDevelopment&&!s&&console.error(`Assertion failed: ${t}`)}formatContext(s){const t=[];return s.component&&t.push(`[${s.component}]`),s.hook&&t.push(`[${s.hook}]`),s.service&&t.push(`[${s.service}]`),t.join(" ")}}const ps=new Fo;ps.performance.bind(ps);ps.performanceAsync.bind(ps);ps.group.bind(ps);ps.table.bind(ps);ps.json.bind(ps);function Io(){const[r,s]=u.useState(null),[t,a]=u.useState(!1),[n,i]=u.useState(!1),[l,h]=u.useState(navigator.onLine),[c,o]=u.useState(!1);return u.useEffect(()=>{window.matchMedia("(display-mode: standalone)").matches&&i(!0);const b=x=>{x.preventDefault(),s(x),a(!0)},N=()=>{i(!0),a(!1),s(null)},q=()=>h(!0),L=()=>h(!1);return window.addEventListener("beforeinstallprompt",b),window.addEventListener("appinstalled",N),window.addEventListener("online",q),window.addEventListener("offline",L),"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").then(x=>{ps.log("Service Worker registered:",x),x.addEventListener("updatefound",()=>{const C=x.installing;C&&C.addEventListener("statechange",()=>{C.state==="installed"&&navigator.serviceWorker.controller&&o(!0)})})}).catch(x=>{console.error("Service Worker registration failed:",x)}),()=>{window.removeEventListener("beforeinstallprompt",b),window.removeEventListener("appinstalled",N),window.removeEventListener("online",q),window.removeEventListener("offline",L)}},[]),{isInstallable:t,isInstalled:n,isOnline:l,updateAvailable:c,installApp:async()=>{if(!r)return!1;try{await r.prompt();const{outcome:b}=await r.userChoice;return b==="accepted"?(s(null),a(!1),!0):!1}catch(b){return console.error("Error installing app:",b),!1}},updateApp:()=>{"serviceWorker"in navigator&&navigator.serviceWorker.getRegistration().then(b=>{b&&b.waiting&&(b.waiting.postMessage({type:"SKIP_WAITING"}),window.location.reload())})}}}function $o(){const{isInstallable:r,isInstalled:s,isOnline:t,updateAvailable:a,installApp:n,updateApp:i}=Io(),{toast:l}=Ee(),[h,c]=u.useState(!1),[o,d]=u.useState(!1);u.useEffect(()=>{if(r&&!s&&!localStorage.getItem("pwa-install-dismissed")){const L=setTimeout(()=>{c(!0)},3e4);return()=>clearTimeout(L)}},[r,s]),u.useEffect(()=>{a&&d(!0)},[a]);const f=async()=>{await n()&&(c(!1),l({title:"App installed!",description:"Molaga ERP has been added to your home screen"}))},b=()=>{c(!1),localStorage.setItem("pwa-install-dismissed","true")},N=()=>{i(),d(!1)};return t?o?e.jsx("div",{className:"fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-96 z-50",children:e.jsxs(Ue,{className:"bg-blue-50 border-blue-200",children:[e.jsx(Pa,{className:"h-4 w-4 text-blue-600"}),e.jsx(Ke,{className:"text-blue-800",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"New version available!"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(D,{size:"sm",variant:"outline",onClick:()=>d(!1),className:"h-7",children:"Later"}),e.jsx(D,{size:"sm",onClick:N,className:"h-7 bg-blue-600 hover:bg-blue-700",children:"Update"})]})]})})]})}):h&&!s?e.jsx("div",{className:"fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-96 z-50",children:e.jsxs(Ue,{className:"bg-primary/5 border-primary/20",children:[e.jsx(rt,{className:"h-4 w-4 text-primary"}),e.jsxs(Ke,{children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-foreground mb-1",children:"Install Molaga ERP"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Add to your home screen for quick access and offline use"})]}),e.jsx(D,{size:"sm",variant:"ghost",onClick:b,className:"h-6 w-6 p-0",children:e.jsx(xt,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx(D,{size:"sm",variant:"outline",onClick:b,className:"flex-1",children:"Not now"}),e.jsx(D,{size:"sm",onClick:f,className:"flex-1 bg-primary hover:bg-primary/90",children:"Install"})]})]})]})}):null:e.jsx("div",{className:"fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-96 z-50",children:e.jsxs(Ue,{className:"bg-orange-50 border-orange-200",children:[e.jsx(Yn,{className:"h-4 w-4 text-orange-600"}),e.jsx(Ke,{className:"text-orange-800",children:"You're offline. Some features may be limited."})]})})}const ga=768;function Lo(){const[r,s]=u.useState(void 0);return u.useEffect(()=>{const t=window.matchMedia(`(max-width: ${ga-1}px)`),a=()=>{s(window.innerWidth<ga)};return t.addEventListener("change",a),s(window.innerWidth<ga),()=>t.removeEventListener("change",a)},[]),!!r}const B=u.forwardRef(({className:r,type:s,...t},a)=>e.jsx("input",{type:s,className:re("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:a,...t}));B.displayName="Input";const da=u.forwardRef(({className:r,orientation:s="horizontal",decorative:t=!0,...a},n)=>e.jsx(mr,{ref:n,decorative:t,orientation:s,className:re("shrink-0 bg-border",s==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",r),...a}));da.displayName=mr.displayName;const Mo=xr,Oo=hr,dn=u.forwardRef(({className:r,...s},t)=>e.jsx(aa,{className:re("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r),...s,ref:t}));dn.displayName=aa.displayName;const Uo=nt("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),un=u.forwardRef(({side:r="right",className:s,children:t,...a},n)=>e.jsxs(Oo,{children:[e.jsx(dn,{}),e.jsxs(ra,{ref:n,className:re(Uo({side:r}),s),...a,children:[t,e.jsxs(pr,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-secondary hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[e.jsx(xt,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));un.displayName=ra.displayName;const Ko=u.forwardRef(({className:r,...s},t)=>e.jsx(na,{ref:t,className:re("text-lg font-semibold text-foreground",r),...s}));Ko.displayName=na.displayName;const Vo=u.forwardRef(({className:r,...s},t)=>e.jsx(ia,{ref:t,className:re("text-sm text-muted-foreground",r),...s}));Vo.displayName=ia.displayName;function Ya({className:r,...s}){return e.jsx("div",{className:re("animate-pulse rounded-md bg-muted",r),...s})}const Bo="sidebar:state",Ho=3600*24*7,zo="16rem",Qo="18rem",Yo="3rem",Wo="b",mn=u.createContext(null);function $t(){const r=u.useContext(mn);if(!r)throw new Error("useSidebar must be used within a SidebarProvider.");return r}const hn=u.forwardRef(({defaultOpen:r=!0,open:s,onOpenChange:t,className:a,style:n,children:i,...l},h)=>{const c=Lo(),[o,d]=u.useState(!1),[f,b]=u.useState(r),N=s??f,q=u.useCallback(E=>{const $=typeof E=="function"?E(N):E;t?t($):b($),document.cookie=`${Bo}=${$}; path=/; max-age=${Ho}`},[t,N]),L=u.useCallback(()=>c?d(E=>!E):q(E=>!E),[c,q,d]);u.useEffect(()=>{const E=$=>{$.key===Wo&&($.metaKey||$.ctrlKey)&&($.preventDefault(),L())};return window.addEventListener("keydown",E),()=>window.removeEventListener("keydown",E)},[L]);const x=N?"expanded":"collapsed",C=u.useMemo(()=>({state:x,open:N,setOpen:q,isMobile:c,openMobile:o,setOpenMobile:d,toggleSidebar:L}),[x,N,q,c,o,d,L]);return e.jsx(mn.Provider,{value:C,children:e.jsx(rn,{delayDuration:0,children:e.jsx("div",{style:{"--sidebar-width":zo,"--sidebar-width-icon":Yo,...n},className:re("group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar",a),ref:h,...l,children:i})})})});hn.displayName="SidebarProvider";const pn=u.forwardRef(({side:r="left",variant:s="sidebar",collapsible:t="offcanvas",className:a,children:n,...i},l)=>{const{isMobile:h,state:c,openMobile:o,setOpenMobile:d}=$t();return t==="none"?e.jsx("div",{className:re("flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground",a),ref:l,...i,children:n}):h?e.jsx(Mo,{open:o,onOpenChange:d,...i,children:e.jsx(un,{"data-sidebar":"sidebar","data-mobile":"true",className:"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden",style:{"--sidebar-width":Qo},side:r,children:e.jsx("div",{className:"flex h-full w-full flex-col",children:n})})}):e.jsxs("div",{ref:l,className:"group peer hidden text-sidebar-foreground md:block","data-state":c,"data-collapsible":c==="collapsed"?t:"","data-variant":s,"data-side":r,children:[e.jsx("div",{className:re("relative h-svh w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear","group-data-[collapsible=offcanvas]:w-0","group-data-[side=right]:rotate-180",s==="floating"||s==="inset"?"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon]")}),e.jsx("div",{className:re("fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex",r==="left"?"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]":"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]",s==="floating"||s==="inset"?"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l",a),...i,children:e.jsx("div",{"data-sidebar":"sidebar",className:"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow",children:n})})]})});pn.displayName="Sidebar";const xn=u.forwardRef(({className:r,onClick:s,...t},a)=>{const{toggleSidebar:n}=$t();return e.jsxs(D,{ref:a,"data-sidebar":"trigger",variant:"ghost",size:"icon",className:re("h-7 w-7",r),onClick:i=>{s?.(i),n()},...t,children:[e.jsx(Wn,{}),e.jsx("span",{className:"sr-only",children:"Toggle Sidebar"})]})});xn.displayName="SidebarTrigger";const Go=u.forwardRef(({className:r,...s},t)=>{const{toggleSidebar:a}=$t();return e.jsx("button",{ref:t,"data-sidebar":"rail","aria-label":"Toggle Sidebar",tabIndex:-1,onClick:a,title:"Toggle Sidebar",className:re("absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] group-data-[side=left]:-right-4 group-data-[side=right]:left-0 hover:after:bg-sidebar-border sm:flex","[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize","[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize","group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar","[[data-side=left][data-collapsible=offcanvas]_&]:-right-2","[[data-side=right][data-collapsible=offcanvas]_&]:-left-2",r),...s})});Go.displayName="SidebarRail";const Jo=u.forwardRef(({className:r,...s},t)=>e.jsx("main",{ref:t,className:re("relative flex min-h-svh flex-1 flex-col bg-background","peer-data-[variant=inset]:min-h-[calc(100svh-theme(spacing.4))] md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow",r),...s}));Jo.displayName="SidebarInset";const Xo=u.forwardRef(({className:r,...s},t)=>e.jsx(B,{ref:t,"data-sidebar":"input",className:re("h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring",r),...s}));Xo.displayName="SidebarInput";const Zo=u.forwardRef(({className:r,...s},t)=>e.jsx("div",{ref:t,"data-sidebar":"header",className:re("flex flex-col gap-2 p-2",r),...s}));Zo.displayName="SidebarHeader";const el=u.forwardRef(({className:r,...s},t)=>e.jsx("div",{ref:t,"data-sidebar":"footer",className:re("flex flex-col gap-2 p-2",r),...s}));el.displayName="SidebarFooter";const sl=u.forwardRef(({className:r,...s},t)=>e.jsx(da,{ref:t,"data-sidebar":"separator",className:re("mx-2 w-auto bg-sidebar-border",r),...s}));sl.displayName="SidebarSeparator";const gn=u.forwardRef(({className:r,...s},t)=>e.jsx("div",{ref:t,"data-sidebar":"content",className:re("flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden",r),...s}));gn.displayName="SidebarContent";const Qt=u.forwardRef(({className:r,...s},t)=>e.jsx("div",{ref:t,"data-sidebar":"group",className:re("relative flex w-full min-w-0 flex-col p-2",r),...s}));Qt.displayName="SidebarGroup";const ka=u.forwardRef(({className:r,asChild:s=!1,...t},a)=>{const n=s?bt:"div";return e.jsx(n,{ref:a,"data-sidebar":"group-label",className:re("flex h-8 shrink-0 items-center rounded-md px-2 text-sm font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opa] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0",r),...t})});ka.displayName="SidebarGroupLabel";const tl=u.forwardRef(({className:r,asChild:s=!1,...t},a)=>{const n=s?bt:"button";return e.jsx(n,{ref:a,"data-sidebar":"group-action",className:re("absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","group-data-[collapsible=icon]:hidden",r),...t})});tl.displayName="SidebarGroupAction";const Yt=u.forwardRef(({className:r,...s},t)=>e.jsx("div",{ref:t,"data-sidebar":"group-content",className:re("w-full text-sm",r),...s}));Yt.displayName="SidebarGroupContent";const Wt=u.forwardRef(({className:r,...s},t)=>e.jsx("ul",{ref:t,"data-sidebar":"menu",className:re("flex w-full min-w-0 flex-col gap-1",r),...s}));Wt.displayName="SidebarMenu";const Gt=u.forwardRef(({className:r,...s},t)=>e.jsx("li",{ref:t,"data-sidebar":"menu-item",className:re("group/menu-item relative",r),...s}));Gt.displayName="SidebarMenuItem";const al=nt("peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-base outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",{variants:{variant:{default:"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",outline:"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]"},size:{default:"h-8 text-base",sm:"h-7 text-sm",lg:"h-12 text-base group-data-[collapsible=icon]:!p-0"}},defaultVariants:{variant:"default",size:"default"}}),Jt=u.forwardRef(({asChild:r=!1,isActive:s=!1,variant:t="default",size:a="default",tooltip:n,className:i,...l},h)=>{const c=r?bt:"button",{isMobile:o,state:d}=$t(),f=e.jsx(c,{ref:h,"data-sidebar":"menu-button","data-size":a,"data-active":s,className:re(al({variant:t,size:a}),i),...l});return n?(typeof n=="string"&&(n={children:n}),e.jsxs(io,{children:[e.jsx(oo,{asChild:!0,children:f}),e.jsx(nn,{side:"right",align:"center",hidden:d!=="collapsed"||o,...n})]})):f});Jt.displayName="SidebarMenuButton";const rl=u.forwardRef(({className:r,asChild:s=!1,showOnHover:t=!1,...a},n)=>{const i=s?bt:"button";return e.jsx(i,{ref:n,"data-sidebar":"menu-action",className:re("absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform peer-hover/menu-button:text-sidebar-accent-foreground hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",t&&"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0",r),...a})});rl.displayName="SidebarMenuAction";const nl=u.forwardRef(({className:r,...s},t)=>e.jsx("div",{ref:t,"data-sidebar":"menu-badge",className:re("pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground","peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",r),...s}));nl.displayName="SidebarMenuBadge";const il=u.forwardRef(({className:r,showIcon:s=!1,...t},a)=>{const n=u.useMemo(()=>`${Math.floor(Math.random()*40)+50}%`,[]);return e.jsxs("div",{ref:a,"data-sidebar":"menu-skeleton",className:re("flex h-8 items-center gap-2 rounded-md px-2",r),...t,children:[s&&e.jsx(Ya,{className:"size-4 rounded-md","data-sidebar":"menu-skeleton-icon"}),e.jsx(Ya,{className:"h-4 max-w-[--skeleton-width] flex-1","data-sidebar":"menu-skeleton-text",style:{"--skeleton-width":n}})]})});il.displayName="SidebarMenuSkeleton";const ol=u.forwardRef(({className:r,...s},t)=>e.jsx("ul",{ref:t,"data-sidebar":"menu-sub",className:re("mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5","group-data-[collapsible=icon]:hidden",r),...s}));ol.displayName="SidebarMenuSub";const ll=u.forwardRef(({...r},s)=>e.jsx("li",{ref:s,...r}));ll.displayName="SidebarMenuSubItem";const cl=u.forwardRef(({asChild:r=!1,size:s="md",isActive:t,className:a,...n},i)=>{const l=r?bt:"a";return e.jsx(l,{ref:i,"data-sidebar":"menu-sub-button","data-size":s,"data-active":t,className:re("flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring aria-disabled:pointer-events-none aria-disabled:opacity-50 hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground","data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground",s==="sm"&&"text-xs",s==="md"&&"text-sm","group-data-[collapsible=icon]:hidden",a),...n})});cl.displayName="SidebarMenuSubButton";const dl=[{title:"Dashboard",url:"/",icon:Gn},{title:"Purchases",url:"/purchases",icon:Ta},{title:"Tasks",url:"/tasks",icon:Da},{title:"Status",url:"/status",icon:It},{title:"Sales",url:"/sales",icon:gr}],ul=[{title:"Master Data",url:"/master",icon:ya},{title:"Analytics",url:"/analytics",icon:ya}],ml=[{title:"Settings",url:"/settings",icon:Ea}];function hl(){const{state:r}=$t(),t=Ws().pathname,a=r==="collapsed",[n,i]=u.useState(!1);u.useEffect(()=>{const o=()=>{const f=document.documentElement.classList.contains("dark");i(f)};o();const d=new MutationObserver(o);return d.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]}),()=>d.disconnect()},[]);const l=n?"/molaga-logo_dark.png":"/molaga-logo.png",h=o=>t===o||o!=="/"&&t.startsWith(o),c=({isActive:o})=>o?"bg-primary/10 text-primary font-medium border-r-2 border-primary":"hover:bg-muted/50 transition-colors";return e.jsx(pn,{className:a?"w-14":"w-64",collapsible:"icon",children:e.jsxs(gn,{className:"bg-sidebar",children:[e.jsx("div",{className:"h-16 border-b border-sidebar-border flex items-center justify-center px-4",children:a?e.jsxs("div",{className:"w-10 h-10 flex items-center justify-center",children:[e.jsx("img",{src:l,alt:"Molaga",className:"w-8 h-8 object-contain transition-opacity duration-200",onError:o=>{const d=o.target;d.style.display="none",d.nextElementSibling?.classList.remove("hidden")}}),e.jsx("div",{className:"w-8 h-8 rounded bg-gradient-to-br from-red-500 to-red-600 flex items-center justify-center text-white font-bold text-sm hidden",children:"M"})]}):e.jsxs("div",{className:"flex items-center justify-center w-full",children:[e.jsx("img",{src:l,alt:"Molaga ERP",className:"h-12 object-contain max-w-full transition-opacity duration-200",onError:o=>{const d=o.target;d.style.display="none",d.nextElementSibling?.classList.remove("hidden")}}),e.jsxs("div",{className:"hidden text-center",children:[e.jsx("h2",{className:"font-bold text-sidebar-foreground text-xl",children:"MOLAGA"}),e.jsx("p",{className:"text-sm text-sidebar-foreground/70",children:"Spice Manufacturing ERP"})]})]})}),e.jsxs(Qt,{children:[e.jsx(ka,{children:"Main Modules"}),e.jsx(Yt,{children:e.jsx(Wt,{children:dl.map(o=>e.jsx(Gt,{children:e.jsx(Jt,{asChild:!0,isActive:h(o.url),children:e.jsxs(ma,{to:o.url,end:o.url==="/",className:c,children:[e.jsx(o.icon,{className:"h-4 w-4"}),!a&&e.jsx("span",{children:o.title})]})})},o.title))})})]}),e.jsxs(Qt,{children:[e.jsx(ka,{children:"Management"}),e.jsx(Yt,{children:e.jsx(Wt,{children:ul.map(o=>e.jsx(Gt,{children:e.jsx(Jt,{asChild:!0,children:e.jsxs(ma,{to:o.url,className:c,children:[e.jsx(o.icon,{className:"h-4 w-4"}),!a&&e.jsx("span",{children:o.title})]})})},o.title))})})]}),e.jsx("div",{className:"mt-auto",children:e.jsx(Qt,{children:e.jsx(Yt,{children:e.jsx(Wt,{children:ml.map(o=>e.jsx(Gt,{children:e.jsx(Jt,{asChild:!0,children:e.jsxs(ma,{to:o.url,className:c,children:[e.jsx(o.icon,{className:"h-4 w-4"}),!a&&e.jsx("span",{children:o.title})]})})},o.title))})})})})]})})}const Wa="molaga_settings",js={company:{companyName:"Molaga Spices Pvt Ltd",legalName:"Molaga Spices Private Limited",registrationNumber:"",taxId:"",industryType:"Manufacturing",address:"",city:"",state:"",postalCode:"",country:"India",phone:"",email:"",website:"",fiscalYearStart:"04",currency:"INR",timezone:"Asia/Kolkata"},system:{language:"en",dateFormat:"DD/MM/YYYY",timeFormat:"24",firstDayOfWeek:"monday",decimalPlaces:"2",thousandSeparator:",",decimalSeparator:".",recordsPerPage:"50",theme:"light",sidebarCollapsed:!1,showTooltips:!0,enableAnimations:!0},security:{minPasswordLength:"8",requireUppercase:!0,requireLowercase:!0,requireNumbers:!0,requireSpecialChars:!0,passwordExpiry:"90",sessionTimeout:"30",maxSessions:"3",enable2FA:!1,loginAttempts:"5",lockoutDuration:"30"},notifications:{smtp:{host:"smtp.gmail.com",port:"587",username:"",password:"",fromEmail:"",fromName:"Molaga ERP",useTLS:!0},notifications:{lowStockAlerts:!0,taskCompletion:!0,backupStatus:!0,userLogin:!1,dataImportExport:!0}},backup:{autoBackup:!0,frequency:"daily",time:"00:00",retention:"30"}};class pl{settings;constructor(){this.settings=this.loadSettings()}loadSettings(){try{const s=localStorage.getItem(Wa);if(s){const t=JSON.parse(s);return{company:{...js.company,...t.company},system:{...js.system,...t.system},security:{...js.security,...t.security},notifications:{smtp:{...js.notifications.smtp,...t.notifications?.smtp},notifications:{...js.notifications.notifications,...t.notifications?.notifications}},backup:{...js.backup,...t.backup}}}}catch(s){console.error("Error loading settings:",s)}return js}saveSettings(){try{localStorage.setItem(Wa,JSON.stringify(this.settings))}catch(s){console.error("Error saving settings:",s)}}getAll(){return{...this.settings}}getCompany(){return{...this.settings.company}}updateCompany(s){return this.settings.company={...this.settings.company,...s},this.saveSettings(),this.getCompany()}getSystem(){return{...this.settings.system}}updateSystem(s){return this.settings.system={...this.settings.system,...s},this.saveSettings(),this.getSystem()}getSecurity(){return{...this.settings.security}}updateSecurity(s){return this.settings.security={...this.settings.security,...s},this.saveSettings(),this.getSecurity()}getNotifications(){return{...this.settings.notifications}}updateNotifications(s){return this.settings.notifications={smtp:{...this.settings.notifications.smtp,...s.smtp},notifications:{...this.settings.notifications.notifications,...s.notifications}},this.saveSettings(),this.getNotifications()}getBackup(){return{...this.settings.backup}}updateBackup(s){return this.settings.backup={...this.settings.backup,...s},this.saveSettings(),this.getBackup()}resetToDefaults(){return this.settings={...js},this.saveSettings(),this.getAll()}exportSettings(){return JSON.stringify(this.settings,null,2)}importSettings(s){try{const t=JSON.parse(s);return this.settings={company:{...js.company,...t.company},system:{...js.system,...t.system},security:{...js.security,...t.security},notifications:{smtp:{...js.notifications.smtp,...t.notifications?.smtp},notifications:{...js.notifications.notifications,...t.notifications?.notifications}},backup:{...js.backup,...t.backup}},this.saveSettings(),!0}catch(t){return console.error("Error importing settings:",t),!1}}}const ea=new pl;function fn(){const[r,s]=u.useState(ea.getCompany()),t=u.useCallback(a=>{const n=ea.updateCompany(a);return s(n),n},[]);return{settings:r,updateSettings:t}}function jn(){const[r,s]=u.useState(ea.getSystem()),t=u.useCallback(a=>{const n=ea.updateSystem(a);return s(n),n},[]);return{settings:r,updateSettings:t}}const sa=Zn,ta=ei,xl=u.forwardRef(({className:r,inset:s,children:t,...a},n)=>e.jsxs(fr,{ref:n,className:re("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[state=open]:bg-accent focus:bg-accent",s&&"pl-8",r),...a,children:[t,e.jsx(jr,{className:"ml-auto h-4 w-4"})]}));xl.displayName=fr.displayName;const gl=u.forwardRef(({className:r,...s},t)=>e.jsx(yr,{ref:t,className:re("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...s}));gl.displayName=yr.displayName;const Ft=u.forwardRef(({className:r,sideOffset:s=4,...t},a)=>e.jsx(Jn,{children:e.jsx(vr,{ref:a,sideOffset:s,className:re("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...t})}));Ft.displayName=vr.displayName;const ft=u.forwardRef(({className:r,inset:s,...t},a)=>e.jsx(br,{ref:a,className:re("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",s&&"pl-8",r),...t}));ft.displayName=br.displayName;const fl=u.forwardRef(({className:r,children:s,checked:t,...a},n)=>e.jsxs(Nr,{ref:n,className:re("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",r),checked:t,...a,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(wr,{children:e.jsx(Sr,{className:"h-4 w-4"})})}),s]}));fl.displayName=Nr.displayName;const jl=u.forwardRef(({className:r,children:s,...t},a)=>e.jsxs(_r,{ref:a,className:re("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",r),...t,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(wr,{children:e.jsx(Xn,{className:"h-2 w-2 fill-current"})})}),s]}));jl.displayName=_r.displayName;const yn=u.forwardRef(({className:r,inset:s,...t},a)=>e.jsx(kr,{ref:a,className:re("px-2 py-1.5 text-sm font-semibold",s&&"pl-8",r),...t}));yn.displayName=kr.displayName;const vn=u.forwardRef(({className:r,...s},t)=>e.jsx(Cr,{ref:t,className:re("-mx-1 my-1 h-px bg-muted",r),...s}));vn.displayName=Cr.displayName;function qe({children:r}){const{user:s,logout:t}=os(),{toast:a}=Ee(),{settings:n}=fn(),{settings:i}=jn();u.useEffect(()=>{const h=window.document.documentElement;if(h.classList.remove("light","dark"),i.theme==="auto"){const c=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";h.classList.add(c)}else h.classList.add(i.theme)},[i.theme]);const l=async()=>{try{await t(),a({title:"Success",description:"Logged out successfully"})}catch{a({title:"Error",description:"Failed to logout",variant:"destructive"})}};return e.jsx(hn,{children:e.jsxs("div",{className:"min-h-screen flex w-full bg-background",children:[e.jsx(hl,{}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("header",{className:"h-16 border-b border-border bg-card/50 backdrop-blur-sm sticky top-0 z-50",children:e.jsxs("div",{className:"flex items-center justify-between px-4 sm:px-6 h-full",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[e.jsx(xn,{className:"hover:bg-primary/10 p-2"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"font-semibold text-foreground text-sm sm:text-base",children:"Molaga ERP"})})]}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[n.companyName&&e.jsxs("div",{className:"hidden sm:flex items-center gap-2 px-3 py-1.5 rounded-md bg-primary/5 border border-primary/10",children:[e.jsx(Pr,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:n.companyName})]}),e.jsx(D,{variant:"ghost",size:"icon",className:"hover:bg-primary/10 h-8 w-8 sm:h-10 sm:w-10",children:e.jsx(Tr,{className:"h-4 w-4"})}),e.jsxs(sa,{children:[e.jsx(ta,{asChild:!0,children:e.jsx(D,{variant:"ghost",size:"icon",className:"hover:bg-primary/10 h-8 w-8 sm:h-10 sm:w-10",children:e.jsx(si,{className:"h-4 w-4"})})}),e.jsxs(Ft,{align:"end",className:"w-56",children:[e.jsx(yn,{children:e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("p",{className:"text-sm font-medium leading-none",children:s?.name}),e.jsx("p",{className:"text-xs leading-none text-muted-foreground",children:s?.email})]})}),e.jsx(vn,{}),e.jsxs(ft,{onClick:l,className:"text-red-600 focus:text-red-600",children:[e.jsx(ti,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Log out"})]})]})]})]})]})}),e.jsx("main",{className:"flex-1 p-4 sm:p-6 bg-gradient-to-br from-background to-muted/20",children:r})]})]})})}const Fe=({children:r})=>{const{user:s,loading:t}=os(),a=Ws();return t?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Re,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading..."})]})}):s?e.jsx(e.Fragment,{children:r}):e.jsx(wt,{to:"/login",state:{from:a},replace:!0})},yl=nt("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),_=u.forwardRef(({className:r,...s},t)=>e.jsx(Dr,{ref:t,className:re(yl(),r),...s}));_.displayName=Dr.displayName;const G=u.forwardRef(({className:r,...s},t)=>e.jsx("div",{ref:t,className:re("rounded-lg border bg-card text-card-foreground shadow-sm",r),...s}));G.displayName="Card";const le=u.forwardRef(({className:r,...s},t)=>e.jsx("div",{ref:t,className:re("flex flex-col space-y-1.5 p-6",r),...s}));le.displayName="CardHeader";const ce=u.forwardRef(({className:r,...s},t)=>e.jsx("h3",{ref:t,className:re("text-2xl font-semibold leading-none tracking-tight",r),...s}));ce.displayName="CardTitle";const ye=u.forwardRef(({className:r,...s},t)=>e.jsx("p",{ref:t,className:re("text-sm text-muted-foreground",r),...s}));ye.displayName="CardDescription";const Z=u.forwardRef(({className:r,...s},t)=>e.jsx("div",{ref:t,className:re("p-6 pt-0",r),...s}));Z.displayName="CardContent";const Rs=u.forwardRef(({className:r,...s},t)=>e.jsx("div",{ref:t,className:re("flex items-center p-6 pt-0",r),...s}));Rs.displayName="CardFooter";const vl=()=>{const[r,s]=u.useState(""),[t,a]=u.useState(""),[n,i]=u.useState(!1),[l,h]=u.useState(!1),{login:c,loginWithGoogle:o}=os(),d=Fa(),{toast:f}=Ee(),b=async q=>{q.preventDefault(),i(!0);try{await c(r,t),f({title:"Success",description:"Logged in successfully"}),d("/")}catch(L){f({title:"Error",description:L.message||"Failed to login",variant:"destructive"})}finally{i(!1)}},N=async()=>{h(!0);try{await o()}catch(q){f({title:"Error",description:q.message||"Failed to login with Google",variant:"destructive"}),h(!1)}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs(G,{className:"w-full max-w-md",children:[e.jsxs(le,{className:"space-y-1",children:[e.jsx(ce,{className:"text-2xl font-bold text-center",children:"MOLAGA ERP"}),e.jsx(ye,{className:"text-center",children:"Sign in to your account to continue"})]}),e.jsxs(Z,{children:[e.jsxs("form",{onSubmit:b,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{htmlFor:"email",children:"Email"}),e.jsx(B,{id:"email",type:"email",placeholder:"Enter your email",value:r,onChange:q=>s(q.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{htmlFor:"password",children:"Password"}),e.jsx(B,{id:"password",type:"password",placeholder:"Enter your password",value:t,onChange:q=>a(q.target.value),required:!0})]}),e.jsxs(D,{type:"submit",className:"w-full",disabled:n,children:[n&&e.jsx(Re,{className:"mr-2 h-4 w-4 animate-spin"}),"Sign In"]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx(da,{className:"w-full"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{className:"bg-background px-2 text-muted-foreground",children:"Or continue with"})})]}),e.jsxs(D,{type:"button",variant:"outline",className:"w-full mt-4",onClick:N,disabled:l,children:[l&&e.jsx(Re,{className:"mr-2 h-4 w-4 animate-spin"}),e.jsxs("svg",{className:"mr-2 h-4 w-4",viewBox:"0 0 24 24",children:[e.jsx("path",{fill:"currentColor",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),e.jsx("path",{fill:"currentColor",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),e.jsx("path",{fill:"currentColor",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),e.jsx("path",{fill:"currentColor",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Continue with Google"]})]}),e.jsxs("div",{className:"mt-4 text-center text-sm",children:["Don't have an account?"," ",e.jsx(ks,{to:"/register",className:"text-primary hover:underline",children:"Sign up"})]})]})]})})},bl=()=>{const[r,s]=u.useState(""),[t,a]=u.useState(""),[n,i]=u.useState(""),[l,h]=u.useState(""),[c,o]=u.useState(!1),[d,f]=u.useState(!1),{register:b,loginWithGoogle:N}=os(),q=Fa(),{toast:L}=Ee(),x=async E=>{if(E.preventDefault(),n!==l){L({title:"Error",description:"Passwords do not match",variant:"destructive"});return}if(n.length<8){L({title:"Error",description:"Password must be at least 8 characters long",variant:"destructive"});return}o(!0);try{await b(t,n,r),L({title:"Success",description:"Account created successfully"}),q("/")}catch($){L({title:"Error",description:$.message||"Failed to create account",variant:"destructive"})}finally{o(!1)}},C=async()=>{f(!0);try{await N()}catch(E){L({title:"Error",description:E.message||"Failed to login with Google",variant:"destructive"}),f(!1)}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs(G,{className:"w-full max-w-md",children:[e.jsxs(le,{className:"space-y-1",children:[e.jsx(ce,{className:"text-2xl font-bold text-center",children:"MOLAGA ERP"}),e.jsx(ye,{className:"text-center",children:"Create your account to get started"})]}),e.jsxs(Z,{children:[e.jsxs("form",{onSubmit:x,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{htmlFor:"name",children:"Full Name"}),e.jsx(B,{id:"name",type:"text",placeholder:"Enter your full name",value:r,onChange:E=>s(E.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{htmlFor:"email",children:"Email"}),e.jsx(B,{id:"email",type:"email",placeholder:"Enter your email",value:t,onChange:E=>a(E.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{htmlFor:"password",children:"Password"}),e.jsx(B,{id:"password",type:"password",placeholder:"Enter your password (min 8 characters)",value:n,onChange:E=>i(E.target.value),required:!0,minLength:8})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{htmlFor:"confirmPassword",children:"Confirm Password"}),e.jsx(B,{id:"confirmPassword",type:"password",placeholder:"Confirm your password",value:l,onChange:E=>h(E.target.value),required:!0})]}),e.jsxs(D,{type:"submit",className:"w-full",disabled:c,children:[c&&e.jsx(Re,{className:"mr-2 h-4 w-4 animate-spin"}),"Create Account"]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx(da,{className:"w-full"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{className:"bg-background px-2 text-muted-foreground",children:"Or continue with"})})]}),e.jsxs(D,{type:"button",variant:"outline",className:"w-full mt-4",onClick:C,disabled:d,children:[d&&e.jsx(Re,{className:"mr-2 h-4 w-4 animate-spin"}),e.jsxs("svg",{className:"mr-2 h-4 w-4",viewBox:"0 0 24 24",children:[e.jsx("path",{fill:"currentColor",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),e.jsx("path",{fill:"currentColor",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),e.jsx("path",{fill:"currentColor",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),e.jsx("path",{fill:"currentColor",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Continue with Google"]})]}),e.jsxs("div",{className:"mt-4 text-center text-sm",children:["Already have an account?"," ",e.jsx(ks,{to:"/login",className:"text-primary hover:underline",children:"Sign in"})]})]})]})})},Nl=nt("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function Ae({className:r,variant:s,...t}){return e.jsx("div",{className:re(Nl({variant:s}),r),...t})}function wl({title:r,value:s,change:t,changeType:a="neutral",icon:n,description:i}){const l={positive:"text-green-600 bg-green-50",negative:"text-red-600 bg-red-50",neutral:"text-muted-foreground bg-muted"}[a];return e.jsxs(G,{className:"hover:shadow-lg transition-all duration-300 border-l-4 border-l-primary",children:[e.jsxs(le,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(ce,{className:"text-xs sm:text-sm font-medium text-muted-foreground",children:r}),e.jsx(n,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"})]}),e.jsxs(Z,{children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-foreground",children:s}),t&&e.jsx(Ae,{variant:"secondary",className:`text-xs mt-2 ${l}`,children:t}),i&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:i})]})]})}const Ga=[{id:1,name:"Procurement",icon:Nt,description:"Raw Materials",status:"active"},{id:2,name:"Pre-Production",icon:Ea,description:"Clean/Roast",status:"active"},{id:3,name:"Production",icon:Er,description:"Grinding",status:"active"},{id:4,name:"Post-Production",icon:ai,description:"Packing",status:"pending"},{id:5,name:"Sales",icon:ri,description:"Customer",status:"pending"}];function Sl(){return e.jsxs(G,{className:"col-span-full",children:[e.jsx(le,{children:e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(Er,{className:"h-5 w-5 text-primary"}),"Production Flow Status"]})}),e.jsx(Z,{children:e.jsx("div",{className:"flex items-center justify-between overflow-x-auto pb-4",children:Ga.map((r,s)=>e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"flex flex-col items-center min-w-0 flex-shrink-0",children:[e.jsx("div",{className:`
                  w-16 h-16 rounded-full border-2 flex items-center justify-center mb-2
                  ${r.status==="active"?"bg-primary/10 border-primary text-primary":"bg-muted border-muted-foreground/30 text-muted-foreground"}
                `,children:e.jsx(r.icon,{className:"h-6 w-6"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-medium text-sm",children:r.name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:r.description})]})]}),s<Ga.length-1&&e.jsx(Es,{className:"h-5 w-5 text-muted-foreground mx-6 flex-shrink-0"})]},r.id))})})]})}const Te=r=>({async getAll(s=[]){let t=[],a=0;const n=100;let i=!0;for(;i;)try{const l=await Me.listDocuments(Oe,r,[...s,$e.limit(n),$e.offset(a)]);if(t.push(...l.documents),a+=n,i=l.documents.length===n,a>1e4){ps.warn(`âš ï¸ Pagination safety limit reached for ${r}, stopping at 10000 records`);break}}catch(l){throw ps.error(`Error fetching documents from ${r}:`,l),l}return ps.log(`ðŸ“¦ Fetched ${t.length} documents from ${r}`),t},async getPaginated(s=[],t={}){const a=t.limit||100,n=t.offset||0;try{const i=await Me.listDocuments(Oe,r,[...s,$e.limit(a),$e.offset(n)]);return{documents:i.documents,total:i.total,hasMore:n+a<i.total}}catch(i){throw ps.error(`Error fetching paginated documents from ${r}:`,i),i}},async getById(s){return await Me.getDocument(Oe,r,s)},async create(s){return await Me.createDocument(Oe,r,at.unique(),s)},async update(s,t){return await Me.updateDocument(Oe,r,s,t)},async delete(s){await Me.deleteDocument(Oe,r,s)}});({...Te(fe.PRODUCTION_STATUS)});const _l={...Te(fe.POST_PRODUCTION_STATUS),async getWithRelations(){const r=await this.getAll(),s=Te(fe.PRODUCTS),t=Te(fe.PROCESSES),a=await s.getAll(),n=await t.getAll(),i=new Map(a.map(h=>[h.$id,h.name])),l=new Map(n.map(h=>[h.$id,h.process_name]));return r.map(h=>({...h,product_name:i.get(h.product_id)||"Unknown",process_name:l.get(h.process_id)||"Unknown"}))}};({...Te(fe.INVENTORY_STATUS)});const bn={...Te(fe.STOCK_STATUS),async getStockStatusByDateRange(r,s){const t=[];return r&&t.push($e.greaterThanEqual("status_date",r)),s&&t.push($e.lessThanEqual("status_date",s)),await this.getAll(t)}},Ys={...Te(fe.PRODUCTION_TASKS),async getByDateRange(r,s){const t=[];return r&&t.push($e.greaterThanEqual("date",r.toISOString())),s&&t.push($e.lessThanEqual("date",s.toISOString())),this.getAll(t)},async getProductionTasksWithRelations(r,s,t){const a=[];r&&a.push($e.greaterThanEqual("date",r)),s&&a.push($e.lessThanEqual("date",s)),t&&a.push($e.equal("process_id",t));const n=await this.getAll(a),i=Te(fe.STAFF),l=Te(fe.PROCESSES),h=Te(fe.RAW_PRODUCTS),c=Te(fe.STOCKS),o=await i.getAll(),d=await l.getAll(),f=await h.getAll(),b=await c.getAll(),N=await Dt.getAll(),q=new Map(o.map(E=>[E.$id,E.staff_name])),L=new Map(d.map(E=>[E.$id,E.process_name])),x=new Map(f.map(E=>[E.$id,E.raw_product])),C=new Map(b.map(E=>[E.$id,E.stock_name]));return n.map(E=>{const k=N.filter(R=>R.production_task_id===E.$id).map(R=>({...R,stock_name:C.get(R.stock_id)||"Unknown"}));return{...E,staff_name:q.get(E.staff_id)||"Unknown",process_name:L.get(E.process_id)||"Unknown",source_process_name:L.get(E.source_process_id)||"Unknown",raw_product_name:x.get(E.raw_product_id)||"Unknown",stock_items:k}})}},tt={...Te(fe.POST_PRODUCTION_TASKS),async getPostProductionTasksWithRelations(){const r=await this.getAll(),s=Te(fe.STAFF),t=Te(fe.PROCESSES),a=Te(fe.PRODUCTS),n=Te(fe.STOCKS),i=await s.getAll(),l=await t.getAll(),h=await a.getAll(),c=await n.getAll(),o=new Map(i.map(N=>[N.$id,N.staff_name])),d=new Map(l.map(N=>[N.$id,N.process_name])),f=new Map(h.map(N=>[N.$id,N.product])),b=new Map(c.map(N=>[N.$id,N.stock_name]));return r.map(N=>({...N,staff_name:o.get(N.staff_id)||"Unknown",process_name:d.get(N.process_id)||"Unknown",source_process_name:d.get(N.source_process_id)||"Unknown",product_name:f.get(N.product_id)||"Unknown",stock_name:b.get(N.sku)||"Unknown"}))}},Fs={...Te(fe.STOCKS),async getCategories(){const r=await this.getAll(),s=new Set(r.map(t=>t.category));return Array.from(s)}},ht=Te(fe.RAW_PRODUCTS),Pt=Te(fe.VENDORS),kl=Te(fe.STAFF),ot=Te(fe.PROCESSES),Is=Te(fe.PRODUCTS),Tt=Te(fe.SALES_CHANNELS),zs={...Te(fe.PURCHASES),async getByDateRange(r,s){const t=[];if(r){const a=new Date(r),n=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`;t.push($e.greaterThanEqual("date",n))}if(s){const a=new Date(s),n=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`;t.push($e.lessThanEqual("date",n))}return this.getAll(t)}},Cl=Te(fe.SALES_ORDERS),Qs=Te(fe.SALES_UNITS),st=Te(fe.SALES_RECORDS);({...Te(fe.PRE_PRODUCTION_STATUS)});const Dt={...Te(fe.PRODUCTION_TASK_ITEMS),async deleteByProductionTaskId(r){const s=await this.getAll([$e.equal("production_task_id",r)]);await Promise.all(s.map(t=>this.delete(t.$id)))}},jt={...Te(fe.PRE_PRODUCTION_TASKS),async getByDateRange(r,s){const t=[];if(r){const a=new Date(r),n=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`;t.push($e.greaterThanEqual("date_assigned",n))}if(s){const a=new Date(s),n=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`;t.push($e.lessThanEqual("date_assigned",n))}return this.getAll(t)},async getPreProductionTasksWithRelations(){const r=await this.getAll(),s=Te(fe.STAFF),t=Te(fe.PROCESSES),a=Te(fe.STOCKS),n=await s.getAll(),i=await t.getAll(),l=await a.getAll(),h=new Map(n.map(d=>[d.$id,d.staff_name])),c=new Map(i.map(d=>[d.$id,d.process_name])),o=new Map(l.map(d=>[d.$id,d.stock_name]));return r.map(d=>({...d,staff_name:h.get(d.staff_id)||"Unknown",process_name:c.get(d.process_id)||"Unknown",stock_name:o.get(d.stock_id)||"Unknown"}))}},Pl=()=>{const{data:r=[],isLoading:s}=he({queryKey:["dashboard","stock-status"],queryFn:()=>bn.getStockStatusByDateRange(),staleTime:6e4}),{data:t=[],isLoading:a}=he({queryKey:["dashboard","sales-orders"],queryFn:async()=>{const{documents:x}=await Cl.list();return x},staleTime:6e4}),{data:n=[],isLoading:i}=he({queryKey:["dashboard","recent-purchases"],queryFn:async()=>{const{documents:x}=await zs.list();return x.sort((C,E)=>new Date(E.$createdAt||E.date).getTime()-new Date(C.$createdAt||C.date).getTime()).slice(0,5)},staleTime:6e4}),{data:l=[],isLoading:h}=he({queryKey:["dashboard","recent-prepro-tasks"],queryFn:async()=>{const{documents:x}=await jt.list();return x.sort((C,E)=>new Date(E.$createdAt||E.date_assigned).getTime()-new Date(C.$createdAt||C.date_assigned).getTime()).slice(0,5)},staleTime:6e4}),c=(r||[]).reduce((x,C)=>x+(C.closing_bal||0),0),o=(t||[]).filter(x=>x.status!=="delivered"&&x.status!=="cancelled").length,d=(l||[]).reduce((x,C)=>x+(C.assigned_quantity||0),0),f=(l||[]).reduce((x,C)=>x+((C.assigned_quantity||0)-(C.wastage_quantity||0)),0),b=d>0?f/d*100:0,N=(r||[]).filter(x=>(x.closing_bal||0)<=(x.min_level||0)).map(x=>({name:x.stock_name,current:`${x.closing_bal||0} kg`,minimum:`${x.min_level||0} kg`,severity:(x.closing_bal||0)===0?"critical":"warning"})).slice(0,5),q=[...(n||[]).map(x=>({id:x.$id||`purchase-${x.date}`,action:"New purchase",item:`${x.stock_id} - ${x.quantity} units @ ${x.rate}`,time:Ha(new Date(x.date||x.$createdAt),{addSuffix:!0}),status:"success"})),...(l||[]).map(x=>({id:x.$id||`task-${x.date_assigned}`,action:`${x.status==="completed"?"Task completed":x.status==="in_progress"?"Task in progress":"Task created"}`,item:`${x.process_id} - ${x.assigned_quantity} units (${x.stock_id})`,time:Ha(new Date(x.date_completed||x.date_assigned||x.$createdAt),{addSuffix:!0}),status:x.status==="completed"?"success":"error"}))].sort((x,C)=>x.time>C.time?-1:1).slice(0,5),L=[{title:"Total Raw Stock",value:`${c.toLocaleString()} kg`,changeType:"neutral",icon:Nt,description:"Sum of closing balances across stocks"},{title:"Active Orders",value:o,changeType:"neutral",icon:Ta,description:"Not delivered or cancelled"},{title:"Production Efficiency",value:`${b.toFixed(1)}%`,changeType:b>=90?"positive":"negative",icon:It,description:"Effective completed vs assigned (recent)"},{title:"Low Stock Alerts",value:N.length,changeType:N.length>0?"negative":"neutral",icon:vs,description:"Closing balance below minimum"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Dashboard"}),e.jsx("p",{className:"text-muted-foreground",children:"Welcome to Molaga ERP - Your complete spice manufacturing solution"})]}),e.jsx("div",{className:"grid gap-3 sm:gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-4",children:L.map((x,C)=>e.jsx(wl,{...x},C))}),e.jsx(Sl,{}),e.jsxs("div",{className:"grid gap-4 sm:gap-6 grid-cols-1 lg:grid-cols-2",children:[e.jsxs(G,{children:[e.jsx(le,{children:e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(va,{className:"h-5 w-5 text-primary"}),"Recent Activities"]})}),e.jsx(Z,{children:e.jsxs("div",{className:"space-y-4",children:[q.map(x=>e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg hover:bg-muted/50 transition-colors",children:[e.jsx("div",{className:`mt-0.5 ${x.status==="success"?"text-green-600":"text-red-600"}`,children:x.status==="success"?e.jsx(Ms,{className:"h-4 w-4"}):e.jsx(ba,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:x.action}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:x.item}),e.jsx("p",{className:"text-xs text-muted-foreground",children:x.time})]})]},x.id)),(s||a||i||h)&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading real data..."}),!q.length&&!(s||a||i||h)&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"No recent activities found."})]})})]}),e.jsxs(G,{children:[e.jsx(le,{children:e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(vs,{className:"h-5 w-5 text-destructive"}),"Low Stock Alerts"]})}),e.jsx(Z,{children:e.jsxs("div",{className:"space-y-3",children:[N.map((x,C)=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-border",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm text-foreground",children:x.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Current: ",x.current," | Min: ",x.minimum]})]}),e.jsx(Ae,{variant:x.severity==="critical"?"destructive":"secondary",className:x.severity==="critical"?"bg-red-100 text-red-800":x.severity==="warning"?"bg-yellow-100 text-yellow-800":"bg-orange-100 text-orange-800",children:x.severity})]},C)),!N.length&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"No low stock alerts."})]})})]})]})]})},yt=u.forwardRef(({className:r,value:s,...t},a)=>e.jsx(Rr,{ref:a,className:re("relative h-4 w-full overflow-hidden rounded-full bg-secondary",r),...t,children:e.jsx(ni,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(s||0)}%)`}})}));yt.displayName=Rr.displayName;class fa{static CHUNK_SIZE=1e3;static MAX_MEMORY_RECORDS=1e4;static async exportToCSV(s,t){try{t?.({current:0,total:s.data.length,percentage:0,status:"preparing",message:"Preparing CSV export..."});const a=this.formatDataForExport(s.data,s.headers);t?.({current:s.data.length*.5,total:s.data.length,percentage:50,status:"processing",message:"Processing data..."});let n=a;s.metadata&&(n=[...this.createMetadataRows(s.metadata),[],s.headers,...a.slice(1)]),t?.({current:s.data.length*.8,total:s.data.length,percentage:80,status:"generating",message:"Generating CSV file..."});const i=kt.unparse(n,{header:!1,skipEmptyLines:!1});t?.({current:s.data.length,total:s.data.length,percentage:95,status:"downloading",message:"Downloading file..."});const l=new Blob([i],{type:"text/csv;charset=utf-8;"}),h=this.generateFilename(s.filename,"csv");Ct.saveAs(l,h),t?.({current:s.data.length,total:s.data.length,percentage:100,status:"complete",message:"Export completed successfully"})}catch(a){throw t?.({current:0,total:s.data.length,percentage:0,status:"error",message:`Export failed: ${a instanceof Error?a.message:"Unknown error"}`}),a}}static async exportToXLSX(s,t){try{t?.({current:0,total:s.data.length,percentage:0,status:"preparing",message:"Preparing Excel export..."});const a=_s.book_new(),n=this.formatDataForExport(s.data,s.headers);t?.({current:s.data.length*.3,total:s.data.length,percentage:30,status:"processing",message:"Processing data..."});const i=_s.aoa_to_sheet(n);if(this.applyExcelFormatting(i,s.headers.length,n.length),_s.book_append_sheet(a,i,"Data"),t?.({current:s.data.length*.6,total:s.data.length,percentage:60,status:"processing",message:"Creating worksheets..."}),s.metadata){const o=this.createMetadataSheet(s.metadata);_s.book_append_sheet(a,o,"Export Info")}t?.({current:s.data.length*.8,total:s.data.length,percentage:80,status:"generating",message:"Generating Excel file..."});const l=za(a,{bookType:"xlsx",type:"array",compression:!0});t?.({current:s.data.length,total:s.data.length,percentage:95,status:"downloading",message:"Downloading file..."});const h=new Blob([l],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),c=this.generateFilename(s.filename,"xlsx");Ct.saveAs(h,c),t?.({current:s.data.length,total:s.data.length,percentage:100,status:"complete",message:"Export completed successfully"})}catch(a){throw t?.({current:0,total:s.data.length,percentage:0,status:"error",message:`Export failed: ${a instanceof Error?a.message:"Unknown error"}`}),a}}static async exportLargeDataset(s,t){if(s.data.length<=this.MAX_MEMORY_RECORDS)return s.format==="csv"?this.exportToCSV(s,t):this.exportToXLSX(s,t);try{t?.({current:0,total:s.data.length,percentage:0,status:"preparing",message:"Preparing large dataset export..."});const a=this.chunkArray(s.data,this.CHUNK_SIZE);let n=0;s.format==="csv"?await this.exportLargeCSV(s,a,t):await this.exportLargeXLSX(s,a,t)}catch(a){throw t?.({current:0,total:s.data.length,percentage:0,status:"error",message:`Large export failed: ${a instanceof Error?a.message:"Unknown error"}`}),a}}static formatDataForExport(s,t){if(s.length===0)return[t];const a=[t];return s.forEach(n=>{const i=t.map(l=>{const h=n[l]||n[this.camelToSnake(l)]||"";return this.formatCellValue(h)});a.push(i)}),a}static formatCellValue(s){return s==null?"":typeof s=="boolean"?s?"Yes":"No":s instanceof Date?s.toLocaleDateString("en-GB"):typeof s=="number"?s%1===0?s.toString():s.toFixed(2):typeof s=="object"?JSON.stringify(s):String(s)}static generateFilename(s,t){const a=new Date().toISOString().slice(0,19).replace(/[:.]/g,"-");return`${s}_${a}.${t}`}static createMetadataRows(s){return[["Export Information"],["Exported At:",s.exportedAt.toLocaleString()],["Exported By:",s.exportedBy],["Page Source:",s.pageSource],["Record Count:",s.recordCount.toString()],["Version:",s.version],...s.filters?[["Filters:",JSON.stringify(s.filters)]]:[]]}static createMetadataSheet(s){const t=[["Export Information",""],["Exported At",s.exportedAt.toLocaleString()],["Exported By",s.exportedBy],["Page Source",s.pageSource],["Record Count",s.recordCount],["Version",s.version],...s.filters?[["Filters",JSON.stringify(s.filters)]]:[]];return _s.aoa_to_sheet(t)}static applyExcelFormatting(s,t,a){const n=_s.encode_range({s:{c:0,r:0},e:{c:t-1,r:a-1}});s["!ref"]=n;const i=Array(t).fill({wch:15});s["!cols"]=i;for(let l=0;l<t;l++){const h=_s.encode_cell({r:0,c:l});s[h]&&(s[h].s={font:{bold:!0},fill:{fgColor:{rgb:"E2E8F0"}}})}}static async exportLargeCSV(s,t,a){let n="",i=0;if(n+=kt.unparse([s.headers],{header:!1})+`
`,s.metadata){const c=this.createMetadataRows(s.metadata);n=kt.unparse(c,{header:!1})+`

`+n}for(let c=0;c<t.length;c++){const o=t[c],d=this.formatDataForExport(o,s.headers).slice(1);n+=kt.unparse(d,{header:!1}),c<t.length-1&&(n+=`
`),i+=o.length,a?.({current:i,total:s.data.length,percentage:Math.round(i/s.data.length*80),status:"processing",message:`Processing chunk ${c+1} of ${t.length}...`}),await new Promise(f=>setTimeout(f,10))}const l=new Blob([n],{type:"text/csv;charset=utf-8;"}),h=this.generateFilename(s.filename,"csv");Ct.saveAs(l,h)}static async exportLargeXLSX(s,t,a){const n=_s.book_new();let i=[s.headers],l=0;for(let f=0;f<t.length;f++){const b=t[f],N=this.formatDataForExport(b,s.headers).slice(1);i.push(...N),l+=b.length,a?.({current:l,total:s.data.length,percentage:Math.round(l/s.data.length*70),status:"processing",message:`Processing chunk ${f+1} of ${t.length}...`}),await new Promise(q=>setTimeout(q,10))}const h=_s.aoa_to_sheet(i);if(this.applyExcelFormatting(h,s.headers.length,i.length),_s.book_append_sheet(n,h,"Data"),s.metadata){const f=this.createMetadataSheet(s.metadata);_s.book_append_sheet(n,f,"Export Info")}const c=za(n,{bookType:"xlsx",type:"array",compression:!0}),o=new Blob([c],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),d=this.generateFilename(s.filename,"xlsx");Ct.saveAs(o,d)}static chunkArray(s,t){const a=[];for(let n=0;n<s.length;n+=t)a.push(s.slice(n,n+t));return a}static camelToSnake(s){return s.replace(/[A-Z]/g,t=>`_${t.toLowerCase()}`)}}const xs=({data:r,headers:s,filename:t,className:a,disabled:n=!1,includeMetadata:i=!0,metadata:l,onExportStart:h,onExportComplete:c,variant:o="outline",size:d="default"})=>{const[f,b]=u.useState(!1),[N,q]=u.useState(null),[L,x]=u.useState(null),C=async R=>{if(!(f||n))try{b(!0),x(R),q(null),h?.();const M=i?{exportedAt:new Date,exportedBy:"Current User",pageSource:t,recordCount:r.length,version:"1.0.0",...l}:void 0,S={filename:t,headers:s,data:r,format:R,metadata:M};q({current:0,total:r.length,percentage:0,status:"preparing",message:`Preparing ${R.toUpperCase()} export...`}),r.length>1e4?await fa.exportLargeDataset(S,q):R==="csv"?await fa.exportToCSV(S,q):await fa.exportToXLSX(S,q),Et.success(`Successfully exported ${r.length} records to ${R.toUpperCase()}`,{description:`File: ${t}_${new Date().toISOString().slice(0,19).replace(/[:.]/g,"-")}.${R}`}),c?.(!0)}catch(M){console.error("Export failed:",M),Et.error("Export failed",{description:M instanceof Error?M.message:"An unexpected error occurred"}),c?.(!1)}finally{b(!1),x(null),q(null)}},E=()=>f&&L?`Exporting ${L.toUpperCase()}...`:"Export",$=()=>f?e.jsx(Re,{className:"h-4 w-4 animate-spin"}):e.jsx(rt,{className:"h-4 w-4"}),k=!r||r.length===0;return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(sa,{children:[e.jsx(ta,{asChild:!0,children:e.jsxs(D,{variant:o,size:d,className:a,disabled:n||f||k,children:[$(),E()]})}),e.jsxs(Ft,{align:"end",children:[e.jsxs(ft,{onClick:()=>C("csv"),disabled:f||k,className:"cursor-pointer",children:[e.jsx(gt,{className:"h-4 w-4 mr-2"}),"Export as CSV"]}),e.jsxs(ft,{onClick:()=>C("xlsx"),disabled:f||k,className:"cursor-pointer",children:[e.jsx(Ar,{className:"h-4 w-4 mr-2"}),"Export as Excel"]})]})]}),f&&N&&e.jsxs("div",{className:"space-y-2 min-w-[200px]",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:N.message||"Processing..."}),e.jsxs("span",{className:"text-muted-foreground",children:[N.percentage,"%"]})]}),e.jsx(yt,{value:N.percentage,className:"h-2"}),N.currentBatch&&N.totalBatches&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Batch ",N.currentBatch," of ",N.totalBatches]})]}),k&&e.jsx("div",{className:"text-xs text-muted-foreground",children:"No data available to export"})]})},Qe=xr,lt=ii,Tl=hr,Nn=u.forwardRef(({className:r,...s},t)=>e.jsx(aa,{ref:t,className:re("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r),...s}));Nn.displayName=aa.displayName;const Ve=u.forwardRef(({className:r,children:s,...t},a)=>e.jsxs(Tl,{children:[e.jsx(Nn,{}),e.jsxs(ra,{ref:a,className:re("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",r),...t,children:[s,e.jsxs(pr,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-accent data-[state=open]:text-muted-foreground hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[e.jsx(xt,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Ve.displayName=ra.displayName;const Be=({className:r,...s})=>e.jsx("div",{className:re("flex flex-col space-y-1.5 text-center sm:text-left",r),...s});Be.displayName="DialogHeader";const He=({className:r,...s})=>e.jsx("div",{className:re("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",r),...s});He.displayName="DialogFooter";const ze=u.forwardRef(({className:r,...s},t)=>e.jsx(na,{ref:t,className:re("text-lg font-semibold leading-none tracking-tight",r),...s}));ze.displayName=na.displayName;const Ye=u.forwardRef(({className:r,...s},t)=>e.jsx(ia,{ref:t,className:re("text-sm text-muted-foreground",r),...s}));Ye.displayName=ia.displayName;class ja{static DEFAULT_BATCH_SIZE=100;static MAX_FILE_SIZE_MB=50;static SUPPORTED_FORMATS=[".csv",".xlsx",".xls"];static async parseFile(s,t){try{this.validateFile(s),t?.({current:0,total:100,percentage:0,status:"parsing",message:"Starting file parsing..."});const a=this.getFileExtension(s.name);let n=[];if(a===".csv")n=await this.parseCSVFile(s,t);else if(a===".xlsx"||a===".xls")n=await this.parseExcelFile(s,t);else throw new Error(`Unsupported file format: ${a}`);return t?.({current:100,total:100,percentage:100,status:"complete",message:`Successfully parsed ${n.length} rows`}),n}catch(a){throw t?.({current:0,total:100,percentage:0,status:"error",message:`Parsing failed: ${a instanceof Error?a.message:"Unknown error"}`}),a}}static validateData(s,t,a){const n={isValid:!0,errors:[],warnings:[],validData:[],invalidData:[]};if(s.length===0)return n.isValid=!1,n.errors.push({row:0,column:"file",message:"File contains no data rows",value:null,severity:"error"}),n;a?.({current:0,total:s.length,percentage:0,status:"validating",message:"Starting data validation..."});const i=Object.keys(s[0]),l=this.validateHeaders(i,t);return l.isValid||(n.errors.push(...l.errors),n.isValid=!1),s.forEach((h,c)=>{const o=c+1,d=this.validateRow(h,t.validationRules,o,s);d.errors.length>0?(n.errors.push(...d.errors),n.invalidData.push({...h,_rowNumber:o})):n.validData.push({...h,_rowNumber:o}),d.warnings.length>0&&n.warnings.push(...d.warnings),(c%100===0||c===s.length-1)&&a?.({current:c+1,total:s.length,percentage:Math.round((c+1)/s.length*100),status:"validating",message:`Validating row ${c+1} of ${s.length}...`})}),n.isValid=n.errors.length===0,a?.({current:s.length,total:s.length,percentage:100,status:"complete",message:`Validation complete. ${n.validData.length} valid rows, ${n.invalidData.length} invalid rows`}),n}static async processImport(s,t,a){const n=t.batchSize||this.DEFAULT_BATCH_SIZE,i=this.createBatches(s,n),l={totalRows:s.length,successfulRows:0,failedRows:0,errors:[],warnings:[],processedData:[],skippedRows:0};a?.({current:0,total:s.length,percentage:0,status:"processing",message:"Starting import process...",currentBatch:0,totalBatches:i.length});try{for(let h=0;h<i.length;h++){const c=i[h],o=await this.processBatch(c,n,h+1);l.successfulRows+=o.processed,l.errors.push(...o.errors),l.warnings.push(...o.warnings),l.processedData.push(...o.data);const d=(h+1)*n,f=Math.min(d,s.length);a?.({current:f,total:s.length,percentage:Math.round(f/s.length*100),status:"processing",message:`Processing batch ${h+1} of ${i.length}...`,currentBatch:h+1,totalBatches:i.length}),await new Promise(b=>setTimeout(b,10))}return l.failedRows=l.totalRows-l.successfulRows,a?.({current:s.length,total:s.length,percentage:100,status:"complete",message:`Import complete. ${l.successfulRows} successful, ${l.failedRows} failed`}),t.onImportComplete(l),l}catch(h){throw a?.({current:0,total:s.length,percentage:0,status:"error",message:`Import failed: ${h instanceof Error?h.message:"Unknown error"}`}),h}}static async processBatch(s,t,a){const n={processed:0,errors:[],warnings:[],data:[]};try{return await new Promise(i=>setTimeout(i,50)),s.forEach((i,l)=>{try{const h=this.processRow(i);n.data.push(h),n.processed++}catch(h){n.errors.push({row:(a-1)*t+l+1,column:"processing",message:h instanceof Error?h.message:"Processing failed",value:i,severity:"error"})}}),n}catch(i){return s.forEach((l,h)=>{n.errors.push({row:(a-1)*t+h+1,column:"batch",message:`Batch processing failed: ${i instanceof Error?i.message:"Unknown error"}`,value:null,severity:"error"})}),n}}static validateFile(s){const t=this.MAX_FILE_SIZE_MB*1024*1024;if(s.size>t)throw new Error(`File size exceeds maximum allowed size of ${this.MAX_FILE_SIZE_MB}MB`);const a=this.getFileExtension(s.name);if(!this.SUPPORTED_FORMATS.includes(a))throw new Error(`Unsupported file format. Supported formats: ${this.SUPPORTED_FORMATS.join(", ")}`)}static async parseCSVFile(s,t){return new Promise((a,n)=>{kt.parse(s,{header:!0,skipEmptyLines:!0,transformHeader:i=>i.trim(),transform:i=>i.trim(),step:(i,l)=>{const h=Math.round((s.size-l.streamer._input.length)/s.size*80);t?.({current:h,total:100,percentage:h,status:"parsing",message:"Parsing CSV file..."})},complete:i=>{if(i.errors.length>0){const l=i.errors.map(h=>`Row ${h.row}: ${h.message}`).join("; ");n(new Error(`CSV parsing errors: ${l}`))}else a(i.data)},error:i=>{n(new Error(`CSV parsing failed: ${i.message}`))}})})}static async parseExcelFile(s,t){return new Promise((a,n)=>{const i=new FileReader;i.onload=l=>{try{t?.({current:50,total:100,percentage:50,status:"parsing",message:"Reading Excel file..."});const h=new Uint8Array(l.target?.result),c=Wi(h,{type:"array"}),o=c.SheetNames[0],d=c.Sheets[o];t?.({current:80,total:100,percentage:80,status:"parsing",message:"Converting Excel data..."});const f=_s.sheet_to_json(d,{header:1,defval:"",blankrows:!1});if(f.length===0){n(new Error("Excel file contains no data"));return}const b=f[0].map(q=>String(q).trim()),N=f.slice(1).map(q=>{const L={};return b.forEach((x,C)=>{L[x]=q[C]!==void 0?String(q[C]).trim():""}),L});a(N)}catch(h){n(new Error(`Excel parsing failed: ${h instanceof Error?h.message:"Unknown error"}`))}},i.onerror=()=>{n(new Error("Failed to read Excel file"))},i.readAsArrayBuffer(s)})}static validateHeaders(s,t){const a=[];t.requiredColumns.forEach(i=>{s.includes(i)||a.push({row:0,column:i,message:`Required column '${i}' is missing`,value:null,severity:"error"})});const n=[...t.requiredColumns,...t.optionalColumns];return s.forEach(i=>{n.includes(i)||a.push({row:0,column:i,message:`Unknown column '${i}' will be ignored`,value:null,severity:"warning"})}),{isValid:a.filter(i=>i.severity==="error").length===0,errors:a}}static validateRow(s,t,a,n){const i=[],l=[];return t.forEach(h=>{const c=s[h.field],o=this.applyValidationRule(c,h,s,n);if(o!==!0){const d=typeof o=="string"?o:h.message||`Validation failed for ${h.field}`;h.type==="required"||h.validator&&o===!1?i.push({row:a,column:h.field,message:d,value:c,severity:"error"}):l.push({row:a,column:h.field,message:d,value:c})}}),{errors:i,warnings:l}}static applyValidationRule(s,t,a,n){switch(t.type){case"required":return s!=null&&s!=="";case"format":return t.options?.pattern?t.options.pattern.test(String(s)):!0;case"range":const i=Number(s);return isNaN(i)?"Value must be a number":t.options?.min!==void 0&&i<t.options.min?`Value must be at least ${t.options.min}`:t.options?.max!==void 0&&i>t.options.max?`Value must be at most ${t.options.max}`:!0;case"unique":return n.filter(h=>h[t.field]===s).length<=1||`Duplicate value found: ${s}`;case"custom":return t.validator?t.validator(s,a,n):!0;default:return!0}}static processRow(s){const t={};return Object.keys(s).forEach(a=>{let n=s[a];if(a.startsWith("_")){t[a]=n;return}if(typeof n=="string"){if(n=n.trim(),n===""&&(n=null),n&&!isNaN(Number(n))&&!isNaN(parseFloat(n))){const i=parseFloat(n);(i.toString()===n||i.toFixed(2)===n)&&(n=i)}n==="true"||n==="True"||n==="TRUE"?n=!0:(n==="false"||n==="False"||n==="FALSE")&&(n=!1)}t[a]=n}),t}static createBatches(s,t){const a=[];for(let n=0;n<s.length;n+=t)a.push(s.slice(n,n+t));return a}static getFileExtension(s){return s.toLowerCase().substring(s.lastIndexOf("."))}}const gs=({config:r,className:s,disabled:t=!1,onImportComplete:a,onImportStart:n,variant:i="outline",size:l="default",acceptedFormats:h=[".csv",".xlsx",".xls"]})=>{const c=u.useRef(null),[o,d]=u.useState({isOpen:!1,step:"upload",file:null,parsedData:[],validationResult:null,importProgress:null,importResult:null,error:null}),f=()=>{d({isOpen:!1,step:"upload",file:null,parsedData:[],validationResult:null,importProgress:null,importResult:null,error:null})},b=()=>{const S=r.requiredColumns.concat(r.optionalColumns||[]),Q=S.map(p=>`Sample ${p}`),V=[S.join(","),Q.join(",")].join(`
`),w=new Blob([V],{type:"text/csv;charset=utf-8;"}),m=URL.createObjectURL(w),F=document.createElement("a");F.setAttribute("href",m),F.setAttribute("download","sample-import-template.csv"),F.style.visibility="hidden",document.body.appendChild(F),F.click(),document.body.removeChild(F),Et.success("Sample CSV downloaded",{description:"Fill in your data and import the file"})},N=async S=>{try{d(w=>({...w,file:S,error:null,step:"preview"}));const Q=await ja.parseFile(S,w=>{d(m=>({...m,importProgress:w}))}),V=ja.validateData(Q,r,w=>{d(m=>({...m,importProgress:w}))});d(w=>({...w,parsedData:Q,validationResult:V,importProgress:null}))}catch(Q){d(V=>({...V,error:Q instanceof Error?Q.message:"Failed to parse file",importProgress:null}))}},q=async()=>{if(o.validationResult?.validData.length)try{d(Q=>({...Q,step:"processing",error:null})),n?.();const S=await ja.processImport(o.validationResult.validData,r,Q=>{d(V=>({...V,importProgress:Q}))});d(Q=>({...Q,step:"complete",importResult:S,importProgress:null})),Et.success("Import completed successfully",{description:`${S.successfulRows} rows imported, ${S.failedRows} failed`}),a?.(S)}catch(S){d(Q=>({...Q,error:S instanceof Error?S.message:"Import failed",importProgress:null})),Et.error("Import failed",{description:S instanceof Error?S.message:"An unexpected error occurred"})}},L=S=>{S.preventDefault(),S.stopPropagation()},x=S=>{S.preventDefault(),S.stopPropagation();const V=Array.from(S.dataTransfer.files)[0];V&&N(V)},C=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs(D,{variant:"outline",size:"sm",onClick:S=>{S.stopPropagation(),b()},className:"gap-2",children:[e.jsx(gt,{className:"h-4 w-4"}),"Download Sample CSV"]})}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-gray-400 transition-colors cursor-pointer",onDragOver:L,onDrop:x,onClick:()=>c.current?.click(),children:[e.jsx(Xt,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"Drop your file here or click to browse"}),e.jsxs("p",{className:"text-sm text-gray-500 mb-4",children:["Supported formats: ",h.join(", ")]}),e.jsx(D,{variant:"outline",children:"Choose File"})]}),e.jsx("input",{ref:c,type:"file",accept:h.join(","),onChange:S=>{const Q=S.target.files?.[0];Q&&N(Q)},className:"hidden"}),o.importProgress&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:o.importProgress.message}),e.jsxs("span",{children:[o.importProgress.percentage,"%"]})]}),e.jsx(yt,{value:o.importProgress.percentage})]}),o.error&&e.jsxs(Ue,{variant:"destructive",children:[e.jsx(ua,{className:"h-4 w-4"}),e.jsx(Ke,{children:o.error})]})]}),E=()=>{if(!o.validationResult)return null;const{validData:S,invalidData:Q,errors:V,warnings:w}=o.validationResult;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Import Preview"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Ae,{variant:"outline",className:"text-green-600",children:[e.jsx(Ka,{className:"h-3 w-3 mr-1"}),S.length," Valid"]}),Q.length>0&&e.jsxs(Ae,{variant:"outline",className:"text-red-600",children:[e.jsx(ua,{className:"h-3 w-3 mr-1"}),Q.length," Invalid"]}),w.length>0&&e.jsxs(Ae,{variant:"outline",className:"text-yellow-600",children:[e.jsx(ua,{className:"h-3 w-3 mr-1"}),w.length," Warnings"]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[o.file?.name.endsWith(".csv")?e.jsx(gt,{className:"h-4 w-4"}):e.jsx(Ar,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:o.file?.name})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[o.parsedData.length," rows found"]})]}),V.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-red-600",children:"Validation Errors"}),e.jsxs("div",{className:"max-h-32 overflow-y-auto space-y-1",children:[V.slice(0,10).map((m,F)=>e.jsx(Ue,{variant:"destructive",className:"py-2",children:e.jsxs(Ke,{className:"text-xs",children:["Row ",m.row,', Column "',m.column,'": ',m.message]})},F)),V.length>10&&e.jsxs("p",{className:"text-xs text-gray-500",children:["... and ",V.length-10," more errors"]})]})]}),w.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-yellow-600",children:"Warnings"}),e.jsxs("div",{className:"max-h-24 overflow-y-auto space-y-1",children:[w.slice(0,5).map((m,F)=>e.jsx(Ue,{className:"py-2 border-yellow-200",children:e.jsxs(Ke,{className:"text-xs",children:["Row ",m.row,', Column "',m.column,'": ',m.message]})},F)),w.length>5&&e.jsxs("p",{className:"text-xs text-gray-500",children:["... and ",w.length-5," more warnings"]})]})]}),S.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium",children:"Sample Data (First 3 rows)"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-xs border",children:[e.jsx("thead",{children:e.jsx("tr",{className:"bg-gray-50",children:r.requiredColumns.concat(r.optionalColumns).slice(0,6).map(m=>e.jsx("th",{className:"border px-2 py-1 text-left font-medium",children:m},m))})}),e.jsx("tbody",{children:S.slice(0,3).map((m,F)=>e.jsx("tr",{children:r.requiredColumns.concat(r.optionalColumns).slice(0,6).map(p=>e.jsxs("td",{className:"border px-2 py-1",children:[String(m[p]||"").substring(0,20),String(m[p]||"").length>20&&"..."]},p))},F))})]})})]})]})},$=()=>e.jsxs("div",{className:"space-y-4 text-center",children:[e.jsx(Re,{className:"h-12 w-12 animate-spin mx-auto text-blue-500"}),e.jsx("h3",{className:"text-lg font-medium",children:"Processing Import"}),o.importProgress&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:o.importProgress.message}),e.jsxs("span",{children:[o.importProgress.percentage,"%"]})]}),e.jsx(yt,{value:o.importProgress.percentage}),o.importProgress.currentBatch&&o.importProgress.totalBatches&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Processing batch ",o.importProgress.currentBatch," of ",o.importProgress.totalBatches]})]})]}),k=()=>{if(!o.importResult)return null;const{successfulRows:S,failedRows:Q,totalRows:V,errors:w}=o.importResult;return e.jsxs("div",{className:"space-y-4 text-center",children:[e.jsx(Ka,{className:"h-12 w-12 mx-auto text-green-500"}),e.jsx("h3",{className:"text-lg font-medium",children:"Import Complete"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{className:"bg-green-50 p-3 rounded-lg",children:[e.jsx("div",{className:"font-medium text-green-600",children:S}),e.jsx("div",{className:"text-green-600",children:"Successful"})]}),e.jsxs("div",{className:"bg-red-50 p-3 rounded-lg",children:[e.jsx("div",{className:"font-medium text-red-600",children:Q}),e.jsx("div",{className:"text-red-600",children:"Failed"})]}),e.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg",children:[e.jsx("div",{className:"font-medium text-blue-600",children:V}),e.jsx("div",{className:"text-blue-600",children:"Total"})]})]}),w.length>0&&e.jsxs("div",{className:"space-y-2 text-left",children:[e.jsx("h4",{className:"font-medium text-red-600",children:"Import Errors"}),e.jsxs("div",{className:"max-h-32 overflow-y-auto space-y-1",children:[w.slice(0,5).map((m,F)=>e.jsx(Ue,{variant:"destructive",className:"py-2",children:e.jsxs(Ke,{className:"text-xs",children:["Row ",m.row,": ",m.message]})},F)),w.length>5&&e.jsxs("p",{className:"text-xs text-gray-500",children:["... and ",w.length-5," more errors"]})]})]})]})},R=()=>{switch(o.step){case"upload":return"Import Data";case"preview":return"Review Import Data";case"processing":return"Processing Import";case"complete":return"Import Complete";default:return"Import Data"}},M=()=>o.step==="preview"&&o.validationResult?o.validationResult.validData.length>0:!1;return e.jsxs(e.Fragment,{children:[e.jsxs(D,{variant:i,size:l,className:s,disabled:t,onClick:()=>d(S=>({...S,isOpen:!0})),children:[e.jsx(Xt,{className:"h-4 w-4 mr-2"}),"Import"]}),e.jsx(Qe,{open:o.isOpen,onOpenChange:S=>{S||f()},children:e.jsxs(Ve,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(Be,{children:[e.jsx(ze,{children:R()}),e.jsxs(Ye,{children:[o.step==="upload"&&"Select a file to import data",o.step==="preview"&&"Review the data before importing",o.step==="processing"&&"Please wait while we process your data",o.step==="complete"&&"Import has been completed"]})]}),e.jsxs("div",{className:"py-4",children:[o.step==="upload"&&C(),o.step==="preview"&&E(),o.step==="processing"&&$(),o.step==="complete"&&k()]}),e.jsxs(He,{children:[o.step==="upload"&&e.jsx(D,{variant:"outline",onClick:f,children:"Cancel"}),o.step==="preview"&&e.jsxs(e.Fragment,{children:[e.jsx(D,{variant:"outline",onClick:()=>d(S=>({...S,step:"upload"})),children:"Back"}),e.jsxs(D,{onClick:q,disabled:!M(),children:["Import ",o.validationResult?.validData.length||0," Rows"]})]}),o.step==="complete"&&e.jsx(D,{onClick:f,children:"Close"})]})]})})]})},wn=u.forwardRef(({className:r,children:s,...t},a)=>e.jsxs(qr,{ref:a,className:re("relative overflow-hidden",r),...t,children:[e.jsx(oi,{className:"h-full w-full rounded-[inherit]",children:s}),e.jsx(Sn,{}),e.jsx(li,{})]}));wn.displayName=qr.displayName;const Sn=u.forwardRef(({className:r,orientation:s="vertical",...t},a)=>e.jsx(Fr,{ref:a,orientation:s,className:re("flex touch-none select-none transition-colors",s==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",s==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",r),...t,children:e.jsx(ci,{className:"relative flex-1 rounded-full bg-border"})}));Sn.displayName=Fr.displayName;const ds=u.forwardRef(({className:r,...s},t)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:t,className:re("w-full caption-bottom text-sm",r),...s})}));ds.displayName="Table";const us=u.forwardRef(({className:r,...s},t)=>e.jsx("thead",{ref:t,className:re("[&_tr]:border-b",r),...s}));us.displayName="TableHeader";const ms=u.forwardRef(({className:r,...s},t)=>e.jsx("tbody",{ref:t,className:re("[&_tr:last-child]:border-0",r),...s}));ms.displayName="TableBody";const Dl=u.forwardRef(({className:r,...s},t)=>e.jsx("tfoot",{ref:t,className:re("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",r),...s}));Dl.displayName="TableFooter";const we=u.forwardRef(({className:r,...s},t)=>e.jsx("tr",{ref:t,className:re("border-b transition-colors data-[state=selected]:bg-muted hover:bg-muted/50",r),...s}));we.displayName="TableRow";const X=u.forwardRef(({className:r,...s},t)=>e.jsx("th",{ref:t,className:re("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",r),...s}));X.displayName="TableHead";const Y=u.forwardRef(({className:r,...s},t)=>e.jsx("td",{ref:t,className:re("p-4 align-middle [&:has([role=checkbox])]:pr-0",r),...s}));Y.displayName="TableCell";const El=u.forwardRef(({className:r,...s},t)=>e.jsx("caption",{ref:t,className:re("mt-4 text-sm text-muted-foreground",r),...s}));El.displayName="TableCaption";const Gs=({data:r,columns:s,onSort:t,currentSort:a,loading:n=!1,emptyMessage:i="No data available",searchable:l=!0,filterable:h=!1,actions:c=[],onRowClick:o,className:d,maxHeight:f="600px",stickyHeader:b=!0,striped:N=!0,bordered:q=!1,compact:L=!1,selectable:x=!1,selectedRows:C=[],onSelectionChange:E,rowKey:$="id"})=>{const[k,R]=u.useState(""),[M,S]=u.useState({}),Q=u.useMemo(()=>a?[...r].sort((A,H)=>{const U=A[a.column],ie=H[a.column];let me=0;switch(a.dataType){case"number":me=(Number(U)||0)-(Number(ie)||0);break;case"date":const ve=new Date(U),z=new Date(ie);me=ve.getTime()-z.getTime();break;case"boolean":me=U===ie?0:U?1:-1;break;default:me=String(U||"").localeCompare(String(ie||""))}return a.direction==="desc"?-me:me}):r,[r,a]),V=u.useMemo(()=>{let A=Q;if(k&&l){const H=k.toLowerCase();A=A.filter(U=>s.some(ie=>ie.searchable===!1?!1:String(U[ie.key]||"").toLowerCase().includes(H)))}return h&&Object.entries(M).forEach(([H,U])=>{if(U){const ie=U.toLowerCase();A=A.filter(me=>String(me[H]||"").toLowerCase().includes(ie))}}),A},[Q,k,M,s,l,h]),w=A=>{if(!A.sortable||!t)return;let H="asc";a?.column===A.key&&(H=a.direction==="asc"?"desc":"asc"),t({column:A.key,direction:H,dataType:A.dataType})},m=(A,H)=>{if(!x||!E)return;const U=A[$];let ie=[...C];H?ie.some(me=>me[$]===U)||ie.push(A):ie=ie.filter(me=>me[$]!==U),E(ie)},F=A=>{!x||!E||E(A?V:[])},p=A=>x?C.some(H=>H[$]===A[$]):!1,I=()=>!x||V.length===0?!1:V.every(A=>p(A)),j=A=>A.sortable?a?.column===A.key?a.direction==="asc"?e.jsx(di,{className:"h-4 w-4"}):e.jsx(ui,{className:"h-4 w-4"}):e.jsx(mi,{className:"h-4 w-4 opacity-50"}):null,P=(A,H,U)=>{if(H.formatter)return H.formatter(A,U);if(A==null)return e.jsx("span",{className:"text-gray-400",children:"â€”"});switch(H.dataType){case"boolean":return e.jsx(Ae,{variant:A?"default":"secondary",children:A?"Yes":"No"});case"date":return ca(A);case"number":return typeof A=="number"?A.toLocaleString():A;default:return String(A)}},J=A=>{switch(A){case"center":return"text-center";case"right":return"text-right";default:return"text-left"}};return e.jsxs("div",{className:`space-y-4 ${d}`,children:[(l||h)&&e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4",children:[l&&e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ts,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(B,{placeholder:"Search...",value:k,onChange:A=>R(A.target.value),className:"pl-10 text-sm"})]}),h&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Ks,{className:"h-4 w-4 text-gray-400 mt-3"}),s.slice(0,3).map(A=>e.jsx(B,{placeholder:`Filter ${A.label}...`,value:M[A.key]||"",onChange:H=>S(U=>({...U,[A.key]:H.target.value})),className:"w-40"},A.key))]})]}),k&&e.jsxs("div",{className:"text-sm text-gray-500",children:["Showing ",V.length," of ",r.length," results"]}),e.jsx("div",{className:`rounded-md border ${q?"border-2":""} overflow-hidden`,children:f&&f!=="none"?e.jsx("div",{className:"overflow-x-auto",children:e.jsx(wn,{style:{maxHeight:f},className:"relative",children:e.jsxs(ds,{className:"min-w-full",children:[e.jsx(us,{className:b?"sticky top-0 bg-gray-100 z-10":"bg-gray-100",style:b?{position:"sticky",top:0,zIndex:10}:void 0,children:e.jsxs(we,{children:[x&&e.jsx(X,{className:"w-12",children:e.jsx("input",{type:"checkbox",checked:I(),onChange:A=>F(A.target.checked),className:"rounded border-gray-300"})}),s.map(A=>e.jsx(X,{className:`${J(A.align)} ${A.sortable?"cursor-pointer hover:bg-gray-50":""} ${A.headerClassName||""}`,style:{width:A.width},onClick:()=>w(A),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:A.label}),j(A)]})},A.key)),c.length>0&&e.jsx(X,{className:"w-12",children:"Actions"})]})}),e.jsx(ms,{children:n?e.jsx(we,{children:e.jsx(Y,{colSpan:s.length+(x?1:0)+(c.length>0?1:0),className:"text-center py-8",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-900"}),"Loading..."]})})}):V.length===0?e.jsx(we,{children:e.jsx(Y,{colSpan:s.length+(x?1:0)+(c.length>0?1:0),className:"text-center py-8 text-gray-500",children:i})}):V.map((A,H)=>e.jsxs(we,{className:`
                      ${N&&H%2===1?"bg-gray-50":""}
                      ${L?"h-10":""}
                      ${o?"cursor-pointer hover:bg-gray-100":""}
                      ${p(A)?"bg-blue-50 border-blue-200":""}
                    `,onClick:()=>o?.(A),children:[x&&e.jsx(Y,{children:e.jsx("input",{type:"checkbox",checked:p(A),onChange:U=>{U.stopPropagation(),m(A,U.target.checked)},className:"rounded border-gray-300"})}),s.map(U=>e.jsx(Y,{className:`${J(U.align)} ${U.cellClassName||""}`,children:P(A[U.key],U,A)},U.key)),c.length>0&&e.jsx(Y,{children:e.jsxs(sa,{children:[e.jsx(ta,{asChild:!0,children:e.jsx(D,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:U=>U.stopPropagation(),children:e.jsx(Va,{className:"h-4 w-4"})})}),e.jsx(Ft,{align:"end",children:c.map((U,ie)=>e.jsxs(ft,{onClick:me=>{me.stopPropagation(),U.onClick(A)},disabled:U.disabled?.(A),className:U.variant==="destructive"?"text-red-600":"",children:[U.icon&&e.jsx("span",{className:"mr-2",children:U.icon}),U.label]},ie))})]})})]},A[$]||H))})]})})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(ds,{className:"min-w-full",children:[e.jsx(us,{className:b?"sticky top-0 bg-gray-100 z-10":"bg-gray-100",style:b?{position:"sticky",top:0,zIndex:10}:void 0,children:e.jsxs(we,{children:[x&&e.jsx(X,{className:"w-12",children:e.jsx("input",{type:"checkbox",checked:I(),onChange:A=>F(A.target.checked),className:"rounded border-gray-300"})}),s.map(A=>e.jsx(X,{className:`${J(A.align)} ${A.sortable?"cursor-pointer hover:bg-gray-50":""} ${A.headerClassName||""}`,style:{width:A.width},onClick:()=>w(A),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:A.label}),j(A)]})},A.key)),c.length>0&&e.jsx(X,{className:"w-12",children:"Actions"})]})}),e.jsx(ms,{children:n?e.jsx(we,{children:e.jsx(Y,{colSpan:s.length+(x?1:0)+(c.length>0?1:0),className:"text-center py-8",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-900"}),"Loading..."]})})}):V.length===0?e.jsx(we,{children:e.jsx(Y,{colSpan:s.length+(x?1:0)+(c.length>0?1:0),className:"text-center py-8 text-gray-500",children:i})}):V.map((A,H)=>e.jsxs(we,{className:`
                      ${N&&H%2===1?"bg-gray-50":""}
                      ${L?"h-10":""}
                      ${o?"cursor-pointer hover:bg-gray-100":""}
                      ${p(A)?"bg-blue-50 border-blue-200":""}
                    `,onClick:()=>o?.(A),children:[x&&e.jsx(Y,{children:e.jsx("input",{type:"checkbox",checked:p(A),onChange:U=>{U.stopPropagation(),m(A,U.target.checked)},className:"rounded border-gray-300"})}),s.map(U=>e.jsx(Y,{className:`${J(U.align)} ${U.cellClassName||""}`,children:P(A[U.key],U,A)},U.key)),c.length>0&&e.jsx(Y,{children:e.jsxs(sa,{children:[e.jsx(ta,{asChild:!0,children:e.jsx(D,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:U=>U.stopPropagation(),children:e.jsx(Va,{className:"h-4 w-4"})})}),e.jsx(Ft,{align:"end",children:c.map((U,ie)=>e.jsxs(ft,{onClick:me=>{me.stopPropagation(),U.onClick(A)},disabled:U.disabled?.(A),className:U.variant==="destructive"?"text-red-600":"",children:[U.icon&&e.jsx("span",{className:"mr-2",children:U.icon}),U.label]},ie))})]})})]},A[$]||H))})]})})}),x&&C.length>0&&e.jsxs("div",{className:"flex items-center justify-between bg-blue-50 p-3 rounded-lg",children:[e.jsxs("span",{className:"text-sm text-blue-700",children:[C.length," row",C.length>1?"s":""," selected"]}),e.jsx(D,{variant:"outline",size:"sm",onClick:()=>E?.([]),children:"Clear Selection"})]})]})},vt={view:r=>({label:"View",icon:e.jsx(Ir,{className:"h-4 w-4"}),onClick:r}),edit:r=>({label:"Edit",icon:e.jsx(Vs,{className:"h-4 w-4"}),onClick:r}),delete:r=>({label:"Delete",icon:e.jsx(Ts,{className:"h-4 w-4"}),onClick:r,variant:"destructive"})},Bs=r=>{const[s,t]=Le.useState(r),a=Le.useCallback(l=>{t(l)},[]),n=Le.useCallback(()=>{t(void 0)},[]),i=Le.useCallback(l=>s?[...l].sort((h,c)=>{const o=h[s.column],d=c[s.column];let f=0;switch(s.dataType){case"number":f=(Number(o)||0)-(Number(d)||0);break;case"date":const b=new Date(o),N=new Date(d);f=b.getTime()-N.getTime();break;case"boolean":f=o===d?0:o?1:-1;break;default:f=String(o||"").localeCompare(String(d||""))}return s.direction==="desc"?-f:f}):l,[s]);return{currentSort:s,handleSort:a,clearSort:n,getSortedData:i}},te=yi,ae=vi,ee=u.forwardRef(({className:r,children:s,...t},a)=>e.jsxs($r,{ref:a,className:re("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",r),...t,children:[s,e.jsx(hi,{asChild:!0,children:e.jsx(Ra,{className:"h-4 w-4 opacity-50"})})]}));ee.displayName=$r.displayName;const _n=u.forwardRef(({className:r,...s},t)=>e.jsx(Lr,{ref:t,className:re("flex cursor-default items-center justify-center py-1",r),...s,children:e.jsx(pi,{className:"h-4 w-4"})}));_n.displayName=Lr.displayName;const kn=u.forwardRef(({className:r,...s},t)=>e.jsx(Mr,{ref:t,className:re("flex cursor-default items-center justify-center py-1",r),...s,children:e.jsx(Ra,{className:"h-4 w-4"})}));kn.displayName=Mr.displayName;const se=u.forwardRef(({className:r,children:s,position:t="popper",...a},n)=>e.jsx(xi,{children:e.jsxs(Or,{ref:n,className:re("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",r),position:t,...a,children:[e.jsx(_n,{}),e.jsx(gi,{className:re("p-1",t==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s}),e.jsx(kn,{})]})}));se.displayName=Or.displayName;const Rl=u.forwardRef(({className:r,...s},t)=>e.jsx(Ur,{ref:t,className:re("py-1.5 pl-8 pr-2 text-sm font-semibold",r),...s}));Rl.displayName=Ur.displayName;const v=u.forwardRef(({className:r,children:s,...t},a)=>e.jsxs(Kr,{ref:a,className:re("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",r),...t,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(fi,{children:e.jsx(Sr,{className:"h-4 w-4"})})}),e.jsx(ji,{children:s})]}));v.displayName=Kr.displayName;const Al=u.forwardRef(({className:r,...s},t)=>e.jsx(Vr,{ref:t,className:re("-mx-1 my-1 h-px bg-muted",r),...s}));Al.displayName=Vr.displayName;const ql=()=>{const[r,s]=u.useState(!1),[t,a]=u.useState(!1),[n,i]=u.useState(null),[l,h]=u.useState(null),[c,o]=u.useState(""),[d,f]=u.useState([]),[b,N]=u.useState("all"),[q,L]=u.useState("all"),[x,C]=u.useState({from:"",to:""}),[E,$]=u.useState(1),[k,R]=u.useState(50),M=is(),{toast:S}=Ee(),{user:Q,loading:V}=os(),{config:w}=bs("purchases"),{validationRules:m,canImport:F}=Ns("purchases"),{currentSort:p,handleSort:I,getSortedData:j}=Bs(),[P,J]=u.useState({purchase_code:"",date:new Date().toISOString().split("T")[0],vendor_id:"",stock_id:"",quantity:"",rate:"",total_amount:""});u.useEffect(()=>{const{quantity:K,rate:De}=P;if(K&&De){const ss=parseFloat(K)*parseFloat(De);J(as=>({...as,total_amount:String(ss)}))}else J(ss=>({...ss,total_amount:""}))},[P.quantity,P.rate]);const{data:A,isLoading:H,error:U}=he({queryKey:["purchases"],queryFn:()=>zs.getAll(),enabled:!!Q}),{data:ie,isLoading:me,error:ve}=he({queryKey:["vendors"],queryFn:()=>Pt.getAll(),enabled:!!Q}),{data:z,isLoading:pe,error:ge}=he({queryKey:["stocks"],queryFn:()=>Fs.getAll(),enabled:!!Q}),Pe=Le.useMemo(()=>ie?new Map(ie.map(K=>[K.$id,K.vendor_name])):new Map,[ie]),Ze=Le.useMemo(()=>z?new Map(z.map(K=>[K.$id,K.stock_name])):new Map,[z]),xe=Le.useMemo(()=>A?A.map(K=>({...K,id:K.$id,vendor_name:Pe.get(K.vendor_id)||"Unknown Vendor",stock_name:Ze.get(K.stock_id)||"Unknown Stock"})):[],[A,Pe,Ze]),ke=Ne({mutationFn:K=>l?zs.update(l.id,K):zs.create(K),onSuccess:()=>{M.invalidateQueries({queryKey:["purchases"]}),s(!1),h(null),S({title:l?"Purchase Updated":"Purchase Created",description:`The purchase has been successfully ${l?"updated":"saved"}.`})},onError:K=>{S({title:"Error",description:K.message||`Failed to ${l?"update":"create"} purchase.`,variant:"destructive"})}}),ns=Ne({mutationFn:K=>zs.delete(K),onSuccess:()=>{M.invalidateQueries({queryKey:["purchases"]}),S({title:"Purchase Deleted",description:"The purchase has been successfully deleted."})},onError:K=>{S({title:"Error",description:K.message||"Failed to delete purchase.",variant:"destructive"})}}),We=K=>{i(K),a(!0)},Ge=()=>{n&&(ns.mutate(n),i(null),a(!1))},T=K=>{h(K),J({...K,date:new Date(K.date).toISOString().split("T")[0],quantity:String(K.quantity),rate:String(K.rate),total_amount:String(K.total_amount),vendor_id:K.vendor_id,stock_id:K.stock_id}),s(!0)},O=K=>{if(K.preventDefault(),!P.purchase_code||!P.date||!P.vendor_id||!P.stock_id||!P.quantity||!P.rate){S({title:"Missing Fields",description:"Please fill out all required fields.",variant:"destructive"});return}const De={purchase_code:P.purchase_code,date:P.date,vendor_id:P.vendor_id,stock_id:P.stock_id,quantity:parseFloat(P.quantity),rate:parseFloat(P.rate),total_amount:parseFloat(P.total_amount)};ke.mutate(De)},be=xe.filter(K=>{const De=K.purchase_code.toLowerCase().includes(c.toLowerCase())||K.vendor_name.toLowerCase().includes(c.toLowerCase())||K.stock_name.toLowerCase().includes(c.toLowerCase()),ss=b==="all"||K.vendor_id===b,as=q==="all"||K.stock_id===q,Lt=new Date(K.date),Xs=(!x.from||Lt>=new Date(x.from))&&(!x.to||Lt<=new Date(x.to));return De&&ss&&as&&Xs}),Se=Le.useMemo(()=>{const K=new Map;return xe.forEach(De=>{K.has(De.vendor_id)||K.set(De.vendor_id,{id:De.vendor_id,name:De.vendor_name})}),Array.from(K.values()).sort((De,ss)=>De.name.localeCompare(ss.name))},[xe]),Ie=Le.useMemo(()=>{const K=new Map;return xe.forEach(De=>{K.has(De.stock_id)||K.set(De.stock_id,{id:De.stock_id,name:De.stock_name})}),Array.from(K.values()).sort((De,ss)=>De.name.localeCompare(ss.name))},[xe]),Je=be.length,ls=Math.ceil(Je/k),Ds=(E-1)*k,y=Ds+k,oe=be.slice(Ds,y);u.useEffect(()=>{$(1)},[c,b,q,x,k]);const je=Ne({mutationFn:async K=>{await Promise.all(K.map(De=>zs.delete(De)))},onSuccess:()=>{M.invalidateQueries({queryKey:["purchases"]}),f([]),S({title:"Success",description:"Selected purchases deleted successfully."})},onError:()=>{S({title:"Error",description:"Failed to delete selected purchases.",variant:"destructive"})}}),_e=()=>{if(d.length===0){S({title:"No Selection",description:"Please select purchases to delete.",variant:"destructive"});return}confirm(`Are you sure you want to delete ${d.length} selected purchase(s)?`)&&je.mutate(d.map(K=>K.id))},es=()=>{if(d.length===0){S({title:"No Selection",description:"Please select purchases to export.",variant:"destructive"});return}S({title:"Export",description:`Exporting ${d.length} selected purchase(s)...`})},ws=V||H||me||pe,ct=U||ve||ge;return ws?e.jsx("div",{children:"Loading..."}):ct?(console.error("Data loading error:",{purchasesError:U,vendorsError:ve,stocksError:ge}),e.jsx("div",{children:"Error loading data."})):e.jsx("div",{className:"p-4",children:e.jsxs(G,{children:[e.jsx(le,{children:e.jsxs(ce,{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Purchases"}),e.jsxs(D,{onClick:()=>s(!0),children:[e.jsx(fs,{className:"mr-2 h-4 w-4"})," Add New Purchase"]})]})}),e.jsxs(Z,{children:[e.jsx(G,{className:"mb-6",children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(ts,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(B,{placeholder:"Search purchases...",className:"pl-10",value:c,onChange:K=>o(K.target.value)})]}),F&&w&&e.jsx(gs,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:w.exportColumns.filter(K=>K.required).map(K=>K.exportHeader),optionalColumns:w.exportColumns.filter(K=>!K.required).map(K=>K.exportHeader),validationRules:m,onImportComplete:K=>{K.successfulRows>0&&(M.invalidateQueries({queryKey:["purchases"]}),S({title:"Import Successful",description:`${K.successfulRows} purchases imported successfully.`}))}},variant:"outline"}),w&&e.jsx(xs,{data:be.map(K=>{const De={};return w.exportColumns.forEach(ss=>{let as;switch(ss.dataKey){case"purchaseCode":as=K.purchase_code;break;case"date":as=K.date;break;case"vendorName":as=K.vendor_name;break;case"stockName":as=K.stock_name;break;case"quantity":as=K.quantity;break;case"rate":as=K.rate;break;case"totalAmount":as=K.total_amount;break;case"status":as="Completed";break;default:as=K[ss.dataKey]}De[ss.exportHeader]=ss.formatter?ss.formatter(as):as}),De}),headers:w.exportColumns.map(K=>K.exportHeader),filename:"purchases",variant:"outline"})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs(te,{value:b,onValueChange:N,children:[e.jsx(ee,{className:"w-[180px]",children:e.jsx(ae,{placeholder:"Filter by Vendor"})}),e.jsxs(se,{children:[e.jsx(v,{value:"all",children:"All Vendors"}),Se.map(K=>e.jsx(v,{value:K.id,children:K.name},K.id))]})]}),e.jsxs(te,{value:q,onValueChange:L,children:[e.jsx(ee,{className:"w-[180px]",children:e.jsx(ae,{placeholder:"Filter by Stock"})}),e.jsxs(se,{children:[e.jsx(v,{value:"all",children:"All Stocks"}),Ie.map(K=>e.jsx(v,{value:K.id,children:K.name},K.id))]})]}),e.jsx(B,{type:"date",placeholder:"From Date",className:"w-[150px]",value:x.from,onChange:K=>C(De=>({...De,from:K.target.value}))}),e.jsx(B,{type:"date",placeholder:"To Date",className:"w-[150px]",value:x.to,onChange:K=>C(De=>({...De,to:K.target.value}))})]})]})})}),e.jsx(Qe,{open:r,onOpenChange:K=>{s(K),K||(h(null),J({purchase_code:"",date:new Date().toISOString().split("T")[0],vendor_id:"",stock_id:"",quantity:"",rate:"",total_amount:""}))},children:e.jsxs(Ve,{className:"sm:max-w-[600px]",children:[e.jsxs(Be,{children:[e.jsx(ze,{children:l?"Edit Purchase":"Add New Purchase"}),e.jsx(Ye,{children:l?"Update the purchase information below.":"Fill in the details to create a new purchase record."})]}),e.jsxs("form",{onSubmit:O,children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 py-4",children:[e.jsxs("div",{children:[e.jsx(_,{htmlFor:"purchase_code",children:"Purchase Code"}),e.jsx(B,{id:"purchase_code",value:P.purchase_code,onChange:K=>J({...P,purchase_code:K.target.value})})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"date",children:"Date"}),e.jsx(B,{id:"date",type:"date",value:P.date,onChange:K=>J({...P,date:K.target.value})})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"vendor_id",children:"Vendor"}),e.jsxs(te,{value:P.vendor_id,onValueChange:K=>J({...P,vendor_id:K}),children:[e.jsx(ee,{id:"vendor_id",children:e.jsx(ae,{placeholder:"Select a vendor"})}),e.jsx(se,{children:ie?.map(K=>e.jsx(v,{value:K.$id,children:K.vendor_name},K.$id))})]})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"stock_id",children:"Stock"}),e.jsxs(te,{value:P.stock_id,onValueChange:K=>J({...P,stock_id:K}),children:[e.jsx(ee,{id:"stock_id",children:e.jsx(ae,{placeholder:"Select a stock item"})}),e.jsx(se,{children:z?.map(K=>e.jsx(v,{value:K.$id,children:K.stock_name},K.$id))})]})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"quantity",children:"Quantity"}),e.jsx(B,{id:"quantity",type:"number",value:P.quantity,onChange:K=>J({...P,quantity:K.target.value})})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"rate",children:"Rate"}),e.jsx(B,{id:"rate",type:"number",value:P.rate,onChange:K=>J({...P,rate:K.target.value})})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"total_amount",children:"Total Amount"}),e.jsx(B,{id:"total_amount",type:"number",value:P.total_amount,readOnly:!0,className:"bg-gray-100"})]})]}),e.jsx(He,{children:e.jsx(D,{type:"submit",disabled:ke.isPending,children:ke.isPending?"Saving...":l?"Update Purchase":"Create Purchase"})})]})]})}),e.jsx(Qe,{open:t,onOpenChange:a,children:e.jsxs(Ve,{children:[e.jsx(Be,{children:e.jsx(ze,{children:"Are you sure?"})}),e.jsx("div",{className:"py-4",children:e.jsx("p",{children:"This action cannot be undone. This will permanently delete the purchase."})}),e.jsxs(He,{children:[e.jsx(D,{variant:"outline",onClick:()=>a(!1),children:"Cancel"}),e.jsx(D,{variant:"destructive",onClick:Ge,children:"Delete"})]})]})}),e.jsx(G,{children:e.jsxs(Z,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",Ds+1," to ",Math.min(y,Je)," of ",Je," records"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Records per page:"}),e.jsxs(te,{value:k.toString(),onValueChange:K=>R(Number(K)),children:[e.jsx(ee,{className:"w-[100px]",children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"50",children:"50"}),e.jsx(v,{value:"100",children:"100"}),e.jsx(v,{value:"500",children:"500"})]})]})]})]}),d.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 p-3 bg-muted rounded-md",children:[e.jsxs("span",{className:"text-sm font-medium",children:[d.length," selected"]}),e.jsx(D,{variant:"destructive",size:"sm",onClick:_e,disabled:je.isPending,children:"Delete Selected"}),e.jsx(D,{variant:"outline",size:"sm",onClick:es,children:"Export Selected"})]}),e.jsx("div",{className:"border rounded-md",children:e.jsx("div",{className:"overflow-auto",style:{maxHeight:"600px"},children:e.jsx(Gs,{data:j(oe.map(K=>((!K.date||K.date==="Invalid Date")&&console.warn("Invalid purchase date found:",{id:K.$id,date:K.date,purchase_code:K.purchase_code}),{...K,formattedDate:ca(K.date),status:"Completed"}))),columns:[{key:"purchase_code",label:"Purchase Code",sortable:!0,dataType:"string"},{key:"formattedDate",label:"Date",sortable:!0,dataType:"date"},{key:"vendor_name",label:"Vendor Name",sortable:!0,dataType:"string"},{key:"stock_name",label:"Stock Name",sortable:!0,dataType:"string"},{key:"quantity",label:"Quantity",sortable:!0,dataType:"number",align:"right",headerClassName:"bg-purple-50",cellClassName:"bg-purple-50 font-medium"},{key:"rate",label:"Rate",sortable:!0,dataType:"number",align:"right"},{key:"total_amount",label:"Total Amount",sortable:!0,dataType:"number",align:"right"},{key:"status",label:"Status",sortable:!0,dataType:"string",formatter:K=>e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${K==="Completed"?"bg-green-100 text-green-800":K==="In Progress"?"bg-yellow-100 text-yellow-800":K==="Pending"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:K})}],onSort:I,currentSort:p,loading:ws,maxHeight:"none",stickyHeader:!0,bordered:!1,searchable:!1,rowKey:"$id",selectable:!0,selectedRows:d,onSelectionChange:f,actions:[{label:"Edit",onClick:T,variant:"default"},{label:"Delete",onClick:K=>We(K.id),variant:"destructive"}],emptyMessage:"No purchases found"})})}),ls>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx(D,{variant:"outline",size:"sm",onClick:()=>$(K=>Math.max(1,K-1)),disabled:E===1,children:"Previous"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",E," of ",ls]})}),e.jsx(D,{variant:"outline",size:"sm",onClick:()=>$(K=>Math.min(ls,K+1)),disabled:E===ls,children:"Next"})]})]})})]})]})})},Cn=()=>{const{data:r=[],...s}=he({queryKey:["preProductionTasks"],queryFn:async()=>jt.getPreProductionTasksWithRelations()});return{tasks:r,...s}},Pn=()=>{const{data:r=[],isLoading:s,error:t,refetch:a}=he({queryKey:["production_tasks"],queryFn:async()=>await Ys.getProductionTasksWithRelations(),staleTime:12e4,gcTime:6e5,refetchOnWindowFocus:!1,retry:3,retryDelay:n=>Math.min(1e3*2**n,3e4)});return{tasks:r,isLoading:s,error:t,refetch:a}},Fl=()=>{const r=is(),s=Ne({mutationFn:async({taskData:n,stockItems:i})=>{const l=await Ys.create(n);return i.length>0&&await Promise.all(i.map(h=>Dt.create({production_task_id:l.$id,stock_id:h.stock_id,quantity:h.quantity,action:h.action}))),l},onSuccess:()=>{r.invalidateQueries({queryKey:["production_tasks"]})},onError:n=>{console.error("Error creating production task:",n)}}),t=Ne({mutationFn:async({id:n,taskData:i,stockItems:l})=>{const h=await Ys.update(n,i);return l&&(await Dt.deleteByProductionTaskId(n),l.length>0&&await Promise.all(l.map(c=>Dt.create({production_task_id:n,stock_id:c.stock_id,quantity:c.quantity,action:c.action})))),h},onSuccess:()=>{r.invalidateQueries({queryKey:["production_tasks"]})},onError:n=>{console.error("Error updating production task:",n)}}),a=Ne({mutationFn:async n=>(await Dt.deleteByProductionTaskId(n),await Ys.delete(n)),onSuccess:()=>{r.invalidateQueries({queryKey:["production_tasks"]})},onError:n=>{console.error("Error deleting production task:",n)}});return{createTask:s,updateTask:t,deleteTask:a}},Tn=()=>{const{data:r=[],isLoading:s,error:t,refetch:a}=he({queryKey:["post_production_tasks"],queryFn:async()=>await tt.getPostProductionTasksWithRelations(),staleTime:12e4,gcTime:6e5,refetchOnWindowFocus:!1,retry:3,retryDelay:n=>Math.min(1e3*2**n,3e4)});return{tasks:r,isLoading:s,error:t,refetch:a}},Il=()=>{const r=is(),s=Ne({mutationFn:n=>tt.create(n),onSuccess:()=>{r.invalidateQueries({queryKey:["post_production_tasks"]})},onError:n=>{console.error("Error creating post-production task:",n)}}),t=Ne({mutationFn:({id:n,data:i})=>tt.update(n,i),onSuccess:()=>{r.invalidateQueries({queryKey:["post_production_tasks"]})},onError:n=>{console.error("Error updating post-production task:",n)}}),a=Ne({mutationFn:n=>tt.delete(n),onSuccess:()=>{r.invalidateQueries({queryKey:["post_production_tasks"]})},onError:n=>{console.error("Error deleting post-production task:",n)}});return{createTask:s,updateTask:t,deleteTask:a}},$l=()=>{const{tasks:r}=Cn(),{tasks:s}=Pn(),{tasks:t}=Tn(),a=h=>({total:h.length,pending:h.filter(c=>c.status==="pending").length,inProgress:h.filter(c=>c.status==="in_progress").length,completed:h.filter(c=>c.status==="completed").length}),n=a(r),i=a(s),l=a(t);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Tasks Module"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage production tasks across all stages"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs(G,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(le,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Da,{className:"h-5 w-5 text-primary"}),e.jsx(ce,{children:"Pre-Production Tasks"})]}),e.jsx(ye,{children:"Manage pre-production planning and preparation tasks"})]}),e.jsxs(Z,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Track material requisitions, planning approvals, and preparation progress"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-orange-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-orange-700",children:n.pending}),e.jsx("div",{className:"text-orange-600",children:"Pending"})]}),e.jsxs("div",{className:"bg-blue-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-blue-700",children:n.inProgress}),e.jsx("div",{className:"text-blue-600",children:"In Progress"})]}),e.jsxs("div",{className:"bg-green-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-green-700",children:n.completed}),e.jsx("div",{className:"text-green-600",children:"Completed"})]}),e.jsxs("div",{className:"bg-gray-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-gray-700",children:n.total}),e.jsx("div",{className:"text-gray-600",children:"Total"})]})]})]}),e.jsx(Rs,{className:"border-t pt-4",children:e.jsx(D,{asChild:!0,className:"w-full",children:e.jsxs(ks,{to:"/tasks/pre-production",children:["View Pre-Production Tasks",e.jsx(Es,{className:"ml-2 h-4 w-4"})]})})})]}),e.jsxs(G,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(le,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Br,{className:"h-5 w-5 text-primary"}),e.jsx(ce,{children:"Production Tasks"})]}),e.jsx(ye,{children:"Track manufacturing and production progress"})]}),e.jsxs(Z,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Monitor work-in-progress, production timelines, and quality checks"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-orange-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-orange-700",children:i.pending}),e.jsx("div",{className:"text-orange-600",children:"Pending"})]}),e.jsxs("div",{className:"bg-blue-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-blue-700",children:i.inProgress}),e.jsx("div",{className:"text-blue-600",children:"In Progress"})]}),e.jsxs("div",{className:"bg-green-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-green-700",children:i.completed}),e.jsx("div",{className:"text-green-600",children:"Completed"})]}),e.jsxs("div",{className:"bg-gray-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-gray-700",children:i.total}),e.jsx("div",{className:"text-gray-600",children:"Total"})]})]})]}),e.jsx(Rs,{className:"border-t pt-4",children:e.jsx(D,{asChild:!0,className:"w-full",children:e.jsxs(ks,{to:"/tasks/production",children:["View Production Tasks",e.jsx(Es,{className:"ml-2 h-4 w-4"})]})})})]}),e.jsxs(G,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(le,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Nt,{className:"h-5 w-5 text-primary"}),e.jsx(ce,{children:"Post-Production Tasks"})]}),e.jsx(ye,{children:"Track finishing, packaging, and shipping"})]}),e.jsxs(Z,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Monitor finishing processes, packaging, and logistics"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-orange-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-orange-700",children:l.pending}),e.jsx("div",{className:"text-orange-600",children:"Pending"})]}),e.jsxs("div",{className:"bg-blue-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-blue-700",children:l.inProgress}),e.jsx("div",{className:"text-blue-600",children:"In Progress"})]}),e.jsxs("div",{className:"bg-green-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-green-700",children:l.completed}),e.jsx("div",{className:"text-green-600",children:"Completed"})]}),e.jsxs("div",{className:"bg-gray-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-gray-700",children:l.total}),e.jsx("div",{className:"text-gray-600",children:"Total"})]})]})]}),e.jsx(Rs,{className:"border-t pt-4",children:e.jsx(D,{asChild:!0,className:"w-full",children:e.jsxs(ks,{to:"/tasks/post-production",children:["View Post-Production Tasks",e.jsx(Es,{className:"ml-2 h-4 w-4"})]})})})]})]}),e.jsxs(G,{children:[e.jsx(le,{children:e.jsx(ce,{className:"flex items-center gap-2",children:"Task Management System"})}),e.jsx(Z,{children:e.jsx("div",{className:"text-center py-6 text-muted-foreground",children:e.jsx("p",{className:"text-sm",children:"Comprehensive task management across all production stages with real-time tracking and reporting"})})})]})]})},Ll=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Status Module"}),e.jsx("p",{className:"text-muted-foreground",children:"Track real-time status across all production stages"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs(G,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(le,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(bi,{className:"h-5 w-5 text-primary"}),e.jsx(ce,{children:"Stock Status"})]}),e.jsx(ye,{children:"Track raw material and component inventory"})]}),e.jsx(Z,{children:e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Monitor stock levels, movements, and availability of raw materials and components"})}),e.jsx(Rs,{className:"border-t pt-4",children:e.jsx(D,{asChild:!0,className:"w-full",children:e.jsxs(ks,{to:"/status/stock-status",children:["View Stock Status",e.jsx(Es,{className:"ml-2 h-4 w-4"})]})})})]}),e.jsxs(G,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(le,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Da,{className:"h-5 w-5 text-primary"}),e.jsx(ce,{children:"Pre-production Status"})]}),e.jsx(ye,{children:"Track pre-production planning and preparation"})]}),e.jsx(Z,{children:e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Monitor material requisitions, planning approvals, and preparation progress"})}),e.jsx(Rs,{className:"border-t pt-4",children:e.jsx(D,{asChild:!0,className:"w-full",children:e.jsxs(ks,{to:"/status/pre-production-status",children:["View Pre-production Status",e.jsx(Es,{className:"ml-2 h-4 w-4"})]})})})]}),e.jsxs(G,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(le,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Br,{className:"h-5 w-5 text-primary"}),e.jsx(ce,{children:"Production Status"})]}),e.jsx(ye,{children:"Track manufacturing and production progress"})]}),e.jsx(Z,{children:e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Monitor work-in-progress, production timelines, and quality checks"})}),e.jsx(Rs,{className:"border-t pt-4",children:e.jsx(D,{asChild:!0,className:"w-full",children:e.jsxs(ks,{to:"/status/production-status",children:["View Production Status",e.jsx(Es,{className:"ml-2 h-4 w-4"})]})})})]}),e.jsxs(G,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(le,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Nt,{className:"h-5 w-5 text-primary"}),e.jsx(ce,{children:"Post-Production Status"})]}),e.jsx(ye,{children:"Track finishing, packaging, and shipping"})]}),e.jsx(Z,{children:e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Monitor finishing processes, packaging, and logistics"})}),e.jsx(Rs,{className:"border-t pt-4",children:e.jsx(D,{asChild:!0,className:"w-full",children:e.jsxs(ks,{to:"/status/post-production-status",children:["View Post-Production Status",e.jsx(Es,{className:"ml-2 h-4 w-4"})]})})})]}),e.jsxs(G,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(le,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(It,{className:"h-5 w-5 text-primary"}),e.jsx(ce,{children:"Inventory Status"})]}),e.jsx(ye,{children:"Track overall inventory movements and valuation"})]}),e.jsx(Z,{children:e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Monitor opening/closing balances, receiving, issue, and inventory value"})}),e.jsx(Rs,{className:"border-t pt-4",children:e.jsx(D,{asChild:!0,className:"w-full",children:e.jsxs(ks,{to:"/status/inventory-status",children:["View Inventory Status",e.jsx(Es,{className:"ml-2 h-4 w-4"})]})})})]})]}),e.jsxs(G,{children:[e.jsx(le,{children:e.jsx(ce,{className:"flex items-center gap-2",children:"Database Connection"})}),e.jsx(Z,{children:e.jsx("div",{className:"text-center py-6 text-muted-foreground",children:e.jsx("p",{className:"text-sm",children:"For real-time data tracking and management, ensure your application is connected to Appwrite database"})})})]})]}),Ca={products:["products"],stocks:["stocks"],vendors:["vendors"],staff:["staff"],processes:["processes"],rawProducts:["raw-products"],salesChannels:["sales-channels"],salesUnits:r=>["sales-units",r?.from,r?.to].filter(Boolean),salesRecords:r=>["sales-records",r?.from,r?.to].filter(Boolean),stockStatus:["stock-status"],preProductionStatus:["pre-production-status"],productionStatus:["production-status"],postProductionStatus:["post-production-status"],inventoryStatus:r=>["inventory-status",r?.from,r?.to].filter(Boolean),preProductionTasks:["pre-production-tasks"],productionTasks:["production-tasks"],postProductionTasks:["post-production-tasks"],purchases:["purchases"]},Ml=()=>{const{data:r=[]}=he({queryKey:Ca.salesUnits(),queryFn:()=>Qs.getAll(),staleTime:3e5}),{data:s=[]}=he({queryKey:Ca.salesRecords(),queryFn:()=>st.getAll(),staleTime:300*1e3}),t={total:r.length,totalUnits:r.reduce((n,i)=>n+(i.units||0),0),recentEntries:r.filter(n=>{const i=new Date(n.date),l=new Date;return l.setDate(l.getDate()-7),i>=l}).length,uniqueProducts:new Set(r.map(n=>n.product_id)).size},a={total:s.length,totalRevenue:s.reduce((n,i)=>n+(i.sold_units||0)*(i.unit_price||0),0),recentSales:s.filter(n=>{const i=new Date(n.date),l=new Date;return l.setDate(l.getDate()-7),i>=l}).length,totalUnitsSold:s.reduce((n,i)=>n+(i.sold_units||0),0)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Sales Module"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage sales units, records, and finished goods inventory"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(G,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(le,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Nt,{className:"h-5 w-5 text-primary"}),e.jsx(ce,{children:"Sales Units"})]}),e.jsx(ye,{children:"Track batch coding utilization and inventory movement"})]}),e.jsxs(Z,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:'Sales units added by user using "Add Form" from "Batch Coding" process in Post Production tasks'}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-purple-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-purple-700",children:t.total}),e.jsx("div",{className:"text-purple-600",children:"Total Entries"})]}),e.jsxs("div",{className:"bg-blue-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-blue-700",children:t.totalUnits.toLocaleString()}),e.jsx("div",{className:"text-blue-600",children:"Total Units"})]}),e.jsxs("div",{className:"bg-green-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-green-700",children:t.recentEntries}),e.jsx("div",{className:"text-green-600",children:"This Week"})]}),e.jsxs("div",{className:"bg-orange-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-orange-700",children:t.uniqueProducts}),e.jsx("div",{className:"text-orange-600",children:"Products"})]})]})]}),e.jsx(Rs,{className:"border-t pt-4",children:e.jsx(D,{asChild:!0,className:"w-full",children:e.jsxs(ks,{to:"/sales/units",children:["View Sales Units",e.jsx(Es,{className:"ml-2 h-4 w-4"})]})})})]}),e.jsxs(G,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(le,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gr,{className:"h-5 w-5 text-primary"}),e.jsx(ce,{children:"Sales Records"})]}),e.jsx(ye,{children:"Track sold units with pricing and revenue"})]}),e.jsxs(Z,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:'Total sum of all the "sold units" for the respective SKU in date range in "Sales Record Page"'}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-green-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-green-700",children:a.total}),e.jsx("div",{className:"text-green-600",children:"Total Records"})]}),e.jsxs("div",{className:"bg-blue-50 p-2 rounded text-center",children:[e.jsxs("div",{className:"font-semibold text-blue-700",children:["â‚¹",a.totalRevenue.toLocaleString()]}),e.jsx("div",{className:"text-blue-600",children:"Total Revenue"})]}),e.jsxs("div",{className:"bg-purple-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-purple-700",children:a.recentSales}),e.jsx("div",{className:"text-purple-600",children:"Recent Sales"})]}),e.jsxs("div",{className:"bg-orange-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-orange-700",children:a.totalUnitsSold.toLocaleString()}),e.jsx("div",{className:"text-orange-600",children:"Units Sold"})]})]})]}),e.jsx(Rs,{className:"border-t pt-4",children:e.jsx(D,{asChild:!0,className:"w-full",children:e.jsxs(ks,{to:"/sales/records",children:["View Sales Records",e.jsx(Es,{className:"ml-2 h-4 w-4"})]})})})]})]}),e.jsxs(G,{children:[e.jsx(le,{children:e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(It,{className:"h-5 w-5 text-primary"}),"Sales Management System"]})}),e.jsx(Z,{children:e.jsx("div",{className:"text-center py-6 text-muted-foreground",children:e.jsx("p",{className:"text-sm",children:"Comprehensive sales tracking from batch coding utilization to final revenue with real-time inventory management"})})})]})]})};function Dn({className:r,classNames:s,showOutsideDays:t=!0,presets:a,...n}){return e.jsxs("div",{className:"flex",children:[a&&e.jsx("div",{className:"flex flex-col items-start pr-4 border-r border-gray-200",children:a.map(i=>e.jsx(D,{variant:"ghost",className:"w-full justify-start mb-1",onClick:()=>{n.onSelect&&typeof n.onSelect=="function"&&n.onSelect(i.range)},children:i.name},i.name))}),e.jsx(Ni,{showOutsideDays:t,className:re("p-3",r),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:re(_a({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:re(_a({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...s},components:{IconLeft:({...i})=>e.jsx(wi,{className:"h-4 w-4"}),IconRight:({...i})=>e.jsx(jr,{className:"h-4 w-4"})},...n})]})}Dn.displayName="Calendar";const Ol=_i,Ul=ki,En=u.forwardRef(({className:r,align:s="center",sideOffset:t=4,...a},n)=>e.jsx(Si,{children:e.jsx(Hr,{ref:n,align:s,sideOffset:t,className:re("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...a})}));En.displayName=Hr.displayName;function St({value:r,onChange:s,className:t}){const[a,n]=u.useState("this-month"),[i,l]=u.useState(!1),h=[{id:"this-month",name:"This month",range:{from:Us(new Date),to:Os(new Date)}},{id:"previous-month",name:"Previous month",range:{from:Us(ha(new Date,1)),to:Os(ha(new Date,1))}},{id:"last-6-months",name:"Last 6 months",range:{from:ha(new Date,6),to:new Date}},{id:"custom",name:"Custom",range:void 0}],c=d=>{n(d);const f=h.find(b=>b.id===d);f&&f.id!=="custom"?(s(f.range),l(!1)):l(!0)},o=()=>r?.from?r.to?`${Xe(r.from,"dd MMM")} - ${Xe(r.to,"dd MMM yyyy")}`:Xe(r.from,"dd MMM yyyy"):"Select date range";return u.useEffect(()=>{if(!r&&a==="this-month"&&typeof s=="function"){const d=h.find(f=>f.id==="this-month");d&&s(d.range)}},[r,s,a,h]),e.jsxs("div",{className:re("flex items-center gap-2",t),children:[e.jsxs(te,{value:a,onValueChange:c,children:[e.jsx(ee,{className:"w-[150px]",children:e.jsx(ae,{})}),e.jsx(se,{children:h.map(d=>e.jsx(v,{value:d.id,children:d.name},d.id))})]}),e.jsxs(Ol,{open:i,onOpenChange:l,children:[e.jsx(Ul,{asChild:!0,children:e.jsxs(D,{id:"date",variant:"outline",className:re("min-w-[200px] justify-between text-left font-normal",!r&&"text-muted-foreground"),onClick:()=>{a==="custom"&&l(!i)},children:[o(),a==="custom"&&e.jsx(Ra,{className:"h-4 w-4 opacity-50"})]})}),a==="custom"&&e.jsx(En,{className:"w-auto p-0",align:"start",children:e.jsx(Dn,{initialFocus:!0,mode:"range",defaultMonth:r?.from,selected:r,onSelect:d=>{s(d),d?.from&&d?.to&&l(!1)},numberOfMonths:2})})]})]})}const Ja=r=>r.toISOString();function Kl(){const{user:r,loading:s}=os(),t=Ws(),{toast:a}=Ee(),n=is(),[i,l]=u.useState(void 0),[h,c]=u.useState(!1),[o,d]=u.useState(null),[f,b]=u.useState([]),[N,q]=u.useState("all"),[L,x]=u.useState("all"),[C,E]=u.useState(""),[$,k]=u.useState({from:"",to:""}),[R,M]=u.useState(1),[S,Q]=u.useState(50),{config:V}=bs("sales-units"),{validationRules:w,canImport:m}=Ns("sales-units"),{currentSort:F,handleSort:p,getSortedData:I}=Bs();if(Le.useEffect(()=>{o&&h&&(console.log("ðŸ”„ Populating form for edit:",o),oe({date:o.date,product_id:o.product_id,sku:o.sku,units:o.units,notes:o.notes||"",dateString:new Date(o.date).toISOString().split("T")[0]}))},[o,h]),s)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Re,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Validating authentication..."})]})});if(!r)return console.error("SalesUnits: User not authenticated, redirecting to login",{location:t.pathname,timestamp:new Date().toISOString(),userAgent:navigator.userAgent}),e.jsx(wt,{to:"/login",state:{from:t},replace:!0});Le.useEffect(()=>()=>{},[r,t]);const{data:j=[],error:P}=he({queryKey:["products"],queryFn:async()=>{try{const g=await Is.getAll();return console.log("ðŸ“¦ Products loaded for sales:",g.map(W=>({id:W.$id,name:W.product||W.product_name,sku:W.sku}))),g}catch(g){throw console.error("SalesUnits: Failed to fetch products",{error:g.message,code:g.code,type:g.type,userId:r?.$id,stack:g.stack}),g}},retry:(g,W)=>W.code===401||W.code===403?!1:g<3}),{data:J=[]}=he({queryKey:["post-production-tasks"],queryFn:async()=>{try{return await tt.getAll()}catch(g){throw console.error("SalesUnits: Failed to fetch post-production tasks",g),g}},retry:(g,W)=>W.code===401||W.code===403?!1:g<3}),{data:A=[]}=he({queryKey:["processes"],queryFn:async()=>{try{const g=await ot.getAll();return console.log("ðŸ”§ Processes loaded for sales validation:",g.map(W=>({id:W.$id,name:W.process_name,department:W.department}))),g}catch(g){throw console.error("SalesUnits: Failed to fetch processes",g),g}},staleTime:300*1e3}),{data:H=[],isLoading:U,error:ie}=he({queryKey:["post-production-status"],queryFn:async()=>{console.log("ðŸš€ Starting post-production status query...");try{const g=await _l.getAll();return console.log("âœ… Post-production status query successful:",g.length,"records"),console.log("ðŸ“‹ All PostProductionStatus records:",g.map(W=>({product_id:W.product_id,closing_balance:W.closing_balance,status_date:W.status_date}))),g}catch(g){throw console.error("âŒ SalesUnits: Failed to fetch post-production status",{message:g.message,code:g.code,type:g.type,stack:g.stack}),g}},retry:(g,W)=>(console.log(`ðŸ”„ Retrying post-production status query (attempt ${g+1})`),W.code===401||W.code===403?(console.log("ðŸš« Authentication error, not retrying"),!1):g<3),enabled:!!r});Le.useEffect(()=>{console.log("ðŸ“Š Post-production status query status:",{isLoading:U,hasError:!!ie,dataLength:H.length,error:ie?.message})},[U,ie,H.length]);const me=u.useMemo(()=>{const g=[];return i?.from&&g.push($e.greaterThanEqual("date",Ja(i.from))),i?.to&&g.push($e.lessThanEqual("date",Ja(i.to))),g},[i]),{data:ve=[],isLoading:z,error:pe}=he({queryKey:["sales-units",i?.from?.toISOString(),i?.to?.toISOString()],queryFn:async()=>{try{return await Qs.getAll(me)}catch(g){throw console.error("SalesUnits: Failed to fetch sales units",{error:g.message,code:g.code,type:g.type,queries:me,userId:r?.$id,stack:g.stack}),g}},retry:(g,W)=>W.code===401||W.code===403?!1:g<3});Le.useEffect(()=>{pe&&(console.error("SalesUnits: Sales units query error detected",pe),a({title:"Data Loading Error",description:"Failed to load sales units. Please refresh the page.",variant:"destructive"}))},[pe,a]),Le.useEffect(()=>{P&&(console.error("SalesUnits: Products query error detected",P),a({title:"Products Loading Error",description:"Failed to load products. Some features may not work properly.",variant:"destructive"}))},[P,a]);const ge=Ne({mutationFn:async g=>await as(async()=>await Qs.create(g)),onMutate:()=>{if(es==="offline")throw a({title:"Offline",description:"You are currently offline. Please check your connection.",variant:"destructive"}),new Error("Network offline")},onError:(g,W)=>{try{throw console.error("SalesUnits: Failed to create sales unit",{error:g.message,code:g.code,type:g.type,payload:W,userId:r?.$id}),g.code===401?(a({title:"Authentication Error",description:"Your session has expired. Please log in again.",variant:"destructive"}),window.location.href="/login",g):g.code===403?(a({title:"Permission Denied",description:"You don't have permission to create sales units.",variant:"destructive"}),g):g.code>=500?(a({title:"Server Error",description:"A server error occurred. Please try again later.",variant:"destructive"}),g):ss(g)?(a({title:"Network Error",description:es==="offline"?"You appear to be offline. Please check your internet connection.":"Network error occurred. Retrying...",variant:"destructive"}),g):(a({title:"Error",description:g.message||"Failed to create sales unit. Please try again.",variant:"destructive"}),g)}catch(de){throw console.error("SalesUnits: Error in mutation error handler",de),de}},onSuccess:g=>{n.invalidateQueries({queryKey:["sales-units"]}),a({title:"Success",description:"Sales unit created successfully.",duration:3e3}),c(!1);const W={date:new Date().toISOString(),product_id:"",sku:"",units:0,notes:""};oe(W),_e({}),b([]),d(null)}}),Pe=Ne({mutationFn:async({id:g,data:W})=>await as(async()=>await Qs.update(g,W)),onSuccess:g=>{n.invalidateQueries({queryKey:["sales-units"]}),a({title:"Success",description:"Sales unit updated successfully.",duration:3e3}),c(!1),d(null);const W={date:new Date().toISOString(),product_id:"",sku:"",units:0,notes:""};oe(W),_e({})},onError:g=>{console.error("Failed to update sales unit:",g),a({title:"Error",description:g.message||"Failed to update sales unit. Please try again.",variant:"destructive"})}}),Ze=Ne({mutationFn:g=>Qs.delete(g),onSuccess:()=>{n.invalidateQueries({queryKey:["sales-units"]}),a({title:"Success",description:"Sales unit deleted successfully."})},onError:()=>{a({title:"Error",description:"Failed to delete sales unit.",variant:"destructive"})}}),xe=Ne({mutationFn:async g=>{await Promise.all(g.map(W=>Qs.delete(W)))},onSuccess:()=>{n.invalidateQueries({queryKey:["sales-units"]}),b([]),a({title:"Success",description:"Selected units deleted successfully."})},onError:()=>{a({title:"Error",description:"Failed to delete selected units.",variant:"destructive"})}}),ke=g=>{console.log("ðŸ” Editing sales unit:",g),d(g),c(!0)},ns=g=>{confirm("Are you sure you want to delete this sales unit?")&&Ze.mutate(g)},We=()=>{if(f.length===0){a({title:"No Selection",description:"Please select units to delete.",variant:"destructive"});return}confirm(`Are you sure you want to delete ${f.length} selected unit(s)?`)&&xe.mutate(f.map(g=>g.$id))},Ge=ve.filter(g=>{const W=!C||g.sku.toLowerCase().includes(C.toLowerCase())||g.notes&&g.notes.toLowerCase().includes(C.toLowerCase()),de=N==="all"||g.product_id===N,ue=L==="all"||g.sku===L,Ce=new Date(g.date),rs=(!$.from||Ce>=new Date($.from))&&(!$.to||Ce<=new Date($.to));return W&&de&&ue&&rs}),T=Le.useMemo(()=>{const g=new Map;return ve.forEach(W=>{g.has(W.product_id)||g.set(W.product_id,{id:W.product_id,name:j.find(de=>de.$id===W.product_id)?.product||W.product_id})}),Array.from(g.values()).sort((W,de)=>W.name.localeCompare(de.name))},[ve,j]),O=Le.useMemo(()=>Array.from(new Set(ve.map(g=>g.sku))).sort(),[ve]),be=Ge.length,Se=Math.ceil(be/S),Ie=(R-1)*S,Je=Ie+S,ls=Ge.slice(Ie,Je);Le.useEffect(()=>{M(1)},[C,N,L,$,S]);const Ds=()=>{if(f.length===0){a({title:"No Selection",description:"Please select units to export.",variant:"destructive"});return}a({title:"Export",description:`Exporting ${f.length} selected unit(s)...`})},[y,oe]=u.useState({date:new Date().toISOString(),product_id:"",sku:"",units:0,notes:""}),[je,_e]=u.useState({}),[es,ws]=u.useState("online"),[ct,K]=u.useState(0),De=Le.useMemo(()=>{const g={date:new Date().toISOString(),product_id:"",sku:"",units:0,notes:""};return y.product_id!==g.product_id||y.sku!==g.sku||y.units!==g.units||(y.notes||"")!==g.notes||y.dateString&&y.dateString!==new Date().toISOString().split("T")[0]},[y]);Le.useEffect(()=>{const g=()=>{ws("online"),a({title:"Connection Restored",description:"Your internet connection has been restored."})},W=()=>{ws("offline"),a({title:"Connection Lost",description:"Please check your internet connection.",variant:"destructive"})};return window.addEventListener("online",g),window.addEventListener("offline",W),ws(navigator.onLine?"online":"offline"),()=>{window.removeEventListener("online",g),window.removeEventListener("offline",W)}},[a]);const ss=g=>g.message?.toLowerCase().includes("network")||g.message?.toLowerCase().includes("fetch")||g.message?.toLowerCase().includes("connection")||g.code==="NETWORK_ERROR"||!navigator.onLine,as=async(g,W=3)=>{let de;for(let ue=1;ue<=W;ue++)try{if(K(ue-1),ue>1){const rs=Math.min(1e3*Math.pow(2,ue-2),1e4);await new Promise(ys=>setTimeout(ys,rs))}const Ce=await g();return K(0),Ce}catch(Ce){if(de=Ce,console.error(`SalesUnits: Retry attempt ${ue} failed`,{error:Ce.message,isNetworkError:ss(Ce),attempt:ue,maxRetries:W}),Ce.code===401||Ce.code===403||!ss(Ce)&&ue===W)break}throw K(0),de},Lt=(g,W)=>{const de={...je};switch(g){case"product_id":W?delete de.product_id:de.product_id="Product is required";break;case"sku":W?delete de.sku:de.sku="SKU is required";break;case"units":!W||W<=0?de.units="Units must be greater than 0":delete de.units;break;case"dateString":W?delete de.dateString:de.dateString="Date is required";break}return _e(de),Object.keys(de).length===0},Xs=g=>{const W={...y,...g};oe(W),Object.keys(g).forEach(de=>{Lt(de,g[de])})},$n=async()=>{try{return r?!0:(a({title:"Session Expired",description:"Please log in again to continue.",variant:"destructive"}),!1)}catch{return a({title:"Session Error",description:"Unable to validate your session. Please log in again.",variant:"destructive"}),!1}},Ln=g=>{console.log("ðŸ” Checking if product has available batch coding units:",g);const W=H.find(de=>de.product_id===g);if(console.log("ðŸ“‹ Post-production status for product:",W),W&&(W.closing_balance||0)>0){const ue=j.find(Ce=>Ce.$id===g)?.sku;if(ue){const Ce=ve.filter(ys=>ys.sku===ue).reduce((ys,Ss)=>ys+(Ss.units||0),0),rs=(W.closing_balance||0)-Ce;return console.log(`ðŸ“Š Availability using stored balance for ${ue}:`,{storedBalance:W.closing_balance,soldUnits:Ce,available:rs}),rs>0}}else{console.log("âš ï¸ No stored balance, checking completed batch coding tasks...");const de=J.filter(ue=>{const rs=A.find(ys=>ys.$id===ue.process_id)?.process_name?.toLowerCase()==="batch coding";return ue.product_id===g&&ue.status==="completed"&&rs});return console.log(`ðŸ“Š Found ${de.length} completed batch coding tasks for product`),de.length>0}return!1},_t=(g,W,de)=>{console.log("ðŸ” Getting available batch coding units:",{productId:g,sku:W,excludeRecordId:de});const ue=j.find(Ss=>Ss.$id===g),Ce=ue?.sku;if(!ue||!Ce)return console.log("âš ï¸ Product not found or has no SKU:",{productId:g,productSku:Ce}),0;if(Ce!==W)return console.log("âš ï¸ SKU mismatch - requested SKU does not belong to this product:",{productId:g,requestedSku:W,productSku:Ce}),0;const rs=H.find(Ss=>Ss.product_id===g);console.log("ðŸŽ¯ PostProductionStatus record found for product:",rs);let ys=0;if(rs&&rs.closing_balance!==void 0&&rs.closing_balance!==null){const Ss=rs.closing_balance||0;console.log("âœ… Using stored closing balance:",Ss);const Mt=de?ve.filter(Zs=>Zs.sku===W&&Zs.$id===de).reduce((Zs,cs)=>Zs+(cs.units||0),0):0;ys=Math.max(0,Ss+Mt)}else{console.log("âš ï¸ No stored closing balance found, calculating from completed tasks...");const Ss=J.filter(cs=>{const $s=A.find(On=>On.$id===cs.process_id),Ot=$s?.process_name?.toLowerCase()==="batch coding",Ua=cs.product_id===g&&cs.status==="completed"&&Ot;return cs.product_id===g&&console.log(`ðŸ” Task ${cs.task_id}:`,{processId:cs.process_id,processName:$s?.process_name,isBatchCoding:Ot,status:cs.status,matches:Ua}),Ua});if(console.log("ðŸ“Š Completed batch coding tasks found:",Ss.length),Ss.length===0)return console.log("âš ï¸ No completed batch coding tasks found for this product"),0;const Mt=Ss.reduce((cs,$s)=>{const Ot=$s.completed_quantity!==void 0&&$s.completed_quantity!==null?Number($s.completed_quantity):Number($s.units)||0;return cs+Ot},0),Zs=ve.filter(cs=>cs.sku===W&&cs.$id!==de).reduce((cs,$s)=>cs+($s.units||0),0);ys=Math.max(0,Mt-Zs),console.log("ðŸ“Š Calculated availability:",{totalCompletedUnits:Mt,soldUnits:Zs,availableUnits:ys})}return console.log("ðŸ“ˆ Final availability calculation:",{productId:g,sku:W,availableUnits:ys,excludedRecordId:de,method:rs?.closing_balance!==void 0?"stored_balance":"calculated_from_tasks"}),ys},Mn=async g=>{if(g.preventDefault(),!await $n()){console.error("SalesUnits: Session validation failed, aborting form submission");return}if(!y.product_id||!y.sku||!y.units||!y.dateString||y.product_id==="no-products"||y.sku==="no-skus"){a({title:"Validation Error",description:"Please fill all required fields: Product, SKU, Units, and Date.",variant:"destructive"});return}if(y.units<=0){a({title:"Validation Error",description:"Units must be greater than 0.",variant:"destructive"});return}const de=_t(y.product_id,y.sku,o?.$id);if(console.log("ðŸ”„ Edit Mode Validation Check:",{isEditing:!!o,editingRecordId:o?.$id,requestedUnits:y.units,availableUnits:de,sku:y.sku,shouldTriggerValidation:y.units>de}),y.units>de){console.log("ðŸš¨ SALES UNITS VALIDATION TRIGGERED:",{requestedUnits:y.units,availableUnits:de,productId:y.product_id,sku:y.sku}),console.log("ðŸ”„ Showing custom Sales Units validation dialog");const ue={isValid:!1,currentProcess:"sales_units",sourceProcess:"batch_coding",availableQuantity:de,requiredQuantity:y.units,warningMessage:`Insufficient batch coding units. Available: ${de} units, Requested: ${y.units} units`,suggestions:[`Reduce quantity to ${de} units or less`,"Complete more batch coding tasks to increase availability","Check batch coding status for current availability"]};console.log("ðŸ“‹ Custom Validation Data Created:",ue),console.log("ðŸ§¹ Clearing regular validation state before showing custom dialog")}try{const ue={date:y.dateString?new Date(y.dateString).toISOString():y.date,product_id:y.product_id,sku:y.sku,units:y.units,notes:y.notes||void 0};o?Pe.mutate({id:o.$id,data:ue}):ge.mutate(ue)}catch(ue){console.error("SalesUnits: Form submission error",ue),a({title:"Error",description:"Failed to submit form. Please try again.",variant:"destructive"})}};return e.jsx("div",{className:"p-4",children:e.jsxs(G,{children:[e.jsx(le,{children:e.jsxs(ce,{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Sales Units"}),e.jsxs("div",{className:"flex gap-2",children:[m&&e.jsx(gs,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:V?V.exportColumns.filter(g=>g.required).map(g=>g.exportHeader):["Product","SKU"],optionalColumns:V?V.exportColumns.filter(g=>!g.required).map(g=>g.exportHeader):["Date","Units","Status","Remarks"],validationRules:w,onImportComplete:g=>{g.successfulRows>0&&(n.invalidateQueries({queryKey:["sales-units"]}),a({title:"Import Successful",description:`${g.successfulRows} sales units imported successfully.`}))}},variant:"outline"}),V&&e.jsx(xs,{data:ve.map(g=>{const W={};return V.exportColumns.forEach(de=>{let ue;switch(de.dataKey){case"date":ue=g.date;break;case"productName":ue=j.find(Ce=>Ce.$id===g.product_id)?.product||g.product_id;break;case"sku":ue=g.sku;break;case"units":ue=g.units;break;case"status":ue="Completed";break;case"remarks":ue=g.notes||"";break;default:ue=g[de.dataKey]}W[de.exportHeader]=de.formatter?de.formatter(ue):ue}),W}),headers:V.exportColumns.map(g=>g.exportHeader),filename:"sales-units",variant:"outline"}),e.jsxs(D,{onClick:()=>c(!0),children:[e.jsx(fs,{className:"mr-2 h-4 w-4"})," Add New Units"]})]})]})}),e.jsxs(Z,{children:[e.jsx(G,{className:"mb-6",children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(ts,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(B,{placeholder:"Search units...",className:"pl-10",value:C,onChange:g=>E(g.target.value)})]}),m&&V&&e.jsx(gs,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:V.exportColumns.filter(g=>g.required).map(g=>g.exportHeader),optionalColumns:V.exportColumns.filter(g=>!g.required).map(g=>g.exportHeader),validationRules:w,onImportComplete:g=>{g.successfulRows>0&&(n.invalidateQueries({queryKey:["sales-units"]}),a({title:"Import Successful",description:`${g.successfulRows} sales units imported successfully.`}))}},variant:"outline"}),V&&e.jsx(xs,{data:Ge.map(g=>{const W={};return V.exportColumns.forEach(de=>{let ue;switch(de.dataKey){case"date":ue=g.date;break;case"productName":ue=j.find(Ce=>Ce.$id===g.product_id)?.product||g.product_id;break;case"sku":ue=g.sku;break;case"units":ue=g.units;break;case"status":ue="Completed";break;case"remarks":ue=g.notes||"";break;default:ue=g[de.dataKey]}W[de.exportHeader]=de.formatter?de.formatter(ue):ue}),W}),headers:V.exportColumns.map(g=>g.exportHeader),filename:"sales-units",variant:"outline"})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs(te,{value:N,onValueChange:q,children:[e.jsx(ee,{className:"w-[180px]",children:e.jsx(ae,{placeholder:"Filter by Product"})}),e.jsxs(se,{children:[e.jsx(v,{value:"all",children:"All Products"}),T.map(g=>e.jsx(v,{value:g.id,children:g.name},g.id))]})]}),e.jsxs(te,{value:L,onValueChange:x,children:[e.jsx(ee,{className:"w-[180px]",children:e.jsx(ae,{placeholder:"Filter by SKU"})}),e.jsxs(se,{children:[e.jsx(v,{value:"all",children:"All SKUs"}),O.map(g=>e.jsx(v,{value:g,children:g},g))]})]}),e.jsx(B,{type:"date",placeholder:"From Date",className:"w-[150px]",value:$.from,onChange:g=>k(W=>({...W,from:g.target.value}))}),e.jsx(B,{type:"date",placeholder:"To Date",className:"w-[150px]",value:$.to,onChange:g=>k(W=>({...W,to:g.target.value}))})]})]})})}),e.jsx(Qe,{open:h,onOpenChange:g=>{if(!g&&(ge.isPending||Pe.isPending)){a({title:"Please wait",description:"Form is being submitted. Please wait for completion.",variant:"destructive"});return}if(!(!g&&De&&!(ge.isPending||Pe.isPending)&&!window.confirm("You have unsaved changes. Are you sure you want to close without saving?"))&&(c(g),!g)){const W={date:new Date().toISOString(),product_id:"",sku:"",units:0,notes:""};oe(W),_e({}),d(null)}},children:e.jsxs(Ve,{className:"sm:max-w-[600px] max-w-[95vw] max-h-[90vh] overflow-y-auto",children:[e.jsxs(Be,{children:[e.jsxs(ze,{className:"flex items-center gap-2",children:[o?"Edit Sales Unit":"Add New Sales Unit",De&&e.jsx("span",{className:"text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded",children:"Unsaved changes"})]}),e.jsx(Ye,{children:"Enter sales unit details below."}),j.filter(g=>Ln(g.$id)).length===0&&e.jsxs("div",{className:"mt-2 p-3 bg-yellow-50 border border-yellow-200 rounded text-sm text-yellow-800",children:[e.jsx("strong",{children:"âš ï¸ No products available:"})," All products either have no completed batch coding units or all units have been sold."]})]}),e.jsxs("form",{onSubmit:Mn,children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 py-4",children:[e.jsxs("div",{children:[e.jsx(_,{htmlFor:"date",children:"Date *"}),e.jsx(B,{id:"date",type:"date",value:y.dateString||"",onChange:g=>Xs({dateString:g.target.value}),className:je.dateString?"border-red-500":""}),je.dateString&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:je.dateString})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"product",children:"Product *"}),e.jsxs(te,{value:y.product_id,onValueChange:g=>Xs({product_id:g,sku:j.find(W=>W.$id===g)?.sku||y.sku}),children:[e.jsx(ee,{id:"product",className:je.product_id?"border-red-500":"",children:e.jsx(ae,{placeholder:"Select Product"})}),e.jsxs(se,{children:[j.filter(g=>{const W=H.find(ue=>ue.product_id===g.$id);let de=!1;return W&&(W.closing_balance||0)>0?de=!0:g.sku&&(de=J.filter(rs=>rs.product_id===g.$id&&rs.status==="completed").length>0),console.log("ðŸ” Product filtering for sales:",{productId:g.$id,productName:g.product||g.product_name,sku:g.sku,postProdStatusFound:!!W,storedClosingBalance:W?.closing_balance,hasCompletedTasks:J.filter(ue=>ue.product_id===g.$id&&ue.status==="completed").length>0,finalDecision:de}),de}).map(g=>e.jsx(v,{value:g.$id,children:g.product||g.$id},g.$id)),j.filter(g=>{const W=H.find(ue=>ue.product_id===g.$id);return W&&(W.closing_balance||0)>0?!0:g.sku?J.filter(Ce=>Ce.product_id===g.$id&&Ce.status==="completed").length>0:!1}).length===0&&e.jsx(v,{value:"no-products",disabled:!0,children:"No products with available batch coding units"})]})]}),je.product_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:je.product_id})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"sku",children:"SKU *"}),e.jsxs(te,{value:y.sku,onValueChange:g=>Xs({sku:g}),children:[e.jsx(ee,{id:"sku",className:je.sku?"border-red-500":"",children:e.jsx(ae,{placeholder:"Select SKU"})}),e.jsxs(se,{children:[(()=>{if(!y.product_id)return[];const g=j.find(Ce=>Ce.$id===y.product_id);if(!g||!g.sku)return[];const W=g.sku,de=_t(y.product_id,W,o?.$id),ue=o&&W===o.sku;return de>0||ue?[g]:[]})().map(g=>{const W=g.sku,de=_t(y.product_id,W,o?.$id),ue=o&&W===o.sku;return e.jsxs(v,{value:W,children:[W,g.product?` â€” ${g.product}`:"",e.jsxs("span",{className:`text-xs ml-2 ${de>0?"text-gray-500":"text-red-500"}`,children:["(",de," available",ue&&de===0?" - Current":"",")"]})]},g.$id)}),y.product_id&&(()=>{const g=j.find(Ce=>Ce.$id===y.product_id);if(!g||!g.sku)return!0;const W=g.sku,de=_t(y.product_id,W,o?.$id),ue=o&&W===o.sku;return de===0&&!ue})()&&e.jsx(v,{value:"no-skus",disabled:!0,children:"No SKUs with available batch coding units for this product"})]})]}),je.sku&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:je.sku}),y.product_id&&y.sku&&e.jsxs("div",{className:"mt-2 p-2 bg-blue-50 border border-blue-200 rounded text-sm",children:[e.jsx("span",{className:"text-blue-700 font-medium",children:"Available Batch Coding Units:"}),e.jsxs("span",{className:"text-blue-800 font-bold",children:[_t(y.product_id,y.sku,o?.$id)," units"]})]})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"units",children:"Units *"}),e.jsx(B,{id:"units",type:"number",min:"1",value:y.units,onChange:g=>Xs({units:Number(g.target.value)}),className:je.units?"border-red-500":""}),je.units&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:je.units})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(_,{htmlFor:"notes",children:"Remarks"}),e.jsx(B,{id:"notes",type:"text",value:y.notes||"",onChange:g=>Xs({notes:g.target.value})})]})]}),e.jsxs(He,{className:"flex-col sm:flex-row gap-2 pt-4",children:[e.jsx(D,{type:"button",variant:"outline",onClick:()=>c(!1),className:"w-full sm:w-auto",children:"Cancel"}),e.jsx(D,{type:"submit",disabled:ge.isPending||Pe.isPending||Object.keys(je).length>0,className:"w-full sm:w-auto",children:ge.isPending||Pe.isPending?e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"mr-2 h-4 w-4 animate-spin"}),"Savingâ€¦"]}):o?"Update Sales Unit":"Add Sales Unit"})]})]})]})}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{placeholder:"Search units...",value:C,onChange:g=>E(g.target.value),className:"max-w-sm"}),e.jsxs(te,{value:N,onValueChange:q,children:[e.jsx(ee,{className:"w-[180px]",children:e.jsx(ae,{placeholder:"Filter by Product"})}),e.jsxs(se,{children:[e.jsx(v,{value:"all",children:"All Products"}),j.map(g=>e.jsx(v,{value:g.$id,children:g.product||g.$id},g.$id))]})]}),e.jsx(St,{value:i,onChange:l})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[es==="offline"&&e.jsxs("div",{className:"flex items-center gap-1 text-red-600 text-sm",children:[e.jsx("div",{className:"w-2 h-2 bg-red-600 rounded-full"}),"Offline"]}),ct>0&&e.jsxs("div",{className:"flex items-center gap-1 text-yellow-600 text-sm",children:[e.jsx(Re,{className:"h-3 w-3 animate-spin"}),"Retrying... (",ct,")"]})]})]}),e.jsx(G,{children:e.jsxs(Z,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",Ie+1," to ",Math.min(Je,be)," of ",be," records"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Records per page:"}),e.jsxs(te,{value:S.toString(),onValueChange:g=>Q(Number(g)),children:[e.jsx(ee,{className:"w-[100px]",children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"50",children:"50"}),e.jsx(v,{value:"100",children:"100"}),e.jsx(v,{value:"500",children:"500"})]})]})]})]}),f.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 p-3 bg-muted rounded-md",children:[e.jsxs("span",{className:"text-sm font-medium",children:[f.length," selected"]}),e.jsx(D,{variant:"destructive",size:"sm",onClick:We,disabled:xe.isPending,children:"Delete Selected"}),e.jsx(D,{variant:"outline",size:"sm",onClick:Ds,children:"Export Selected"})]}),e.jsx("div",{className:"border rounded-md",children:e.jsx("div",{className:"overflow-auto",style:{maxHeight:"600px"},children:e.jsx(Gs,{data:I(ls.map(g=>((!g.date||g.date==="Invalid Date")&&console.warn("Invalid sales unit date found:",{id:g.$id,date:g.date}),{...g,productName:j.find(W=>W.$id===g.product_id)?.product||g.product_id,formattedDate:ca(g.date),status:"Completed"}))),columns:[{key:"formattedDate",label:"Date",sortable:!0,dataType:"date"},{key:"productName",label:"Product",sortable:!0,dataType:"string"},{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"units",label:"Units",sortable:!0,dataType:"number",align:"right",headerClassName:"bg-purple-50",cellClassName:"bg-purple-50 font-medium"},{key:"status",label:"Status",sortable:!0,dataType:"string",formatter:g=>e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${g==="Completed"?"bg-green-100 text-green-800":g==="In Progress"?"bg-yellow-100 text-yellow-800":g==="Pending"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:g})},{key:"notes",label:"Remarks",sortable:!0,dataType:"string"}],onSort:p,currentSort:F,loading:z,maxHeight:"none",stickyHeader:!0,bordered:!1,searchable:!1,rowKey:"$id",selectable:!0,selectedRows:f,onSelectionChange:b,actions:[{label:"Edit",onClick:ke,variant:"default"},{label:"Delete",onClick:g=>ns(g.$id),variant:"destructive"}],emptyMessage:"No sales units found"})})}),Se>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx(D,{variant:"outline",size:"sm",onClick:()=>M(g=>Math.max(1,g-1)),disabled:R===1,children:"Previous"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",R," of ",Se]})}),e.jsx(D,{variant:"outline",size:"sm",onClick:()=>M(g=>Math.min(Se,g+1)),disabled:R===Se,children:"Next"})]})]})})]})]})})}const Xa=r=>r.toISOString();function Vl(){const{user:r,loading:s}=os(),t=Ws(),{toast:a}=Ee(),n=is(),[i,l]=u.useState(void 0),[h,c]=u.useState(!1),[o,d]=u.useState(null),[f,b]=u.useState([]),[N,q]=u.useState("all"),[L,x]=u.useState("all"),[C,E]=u.useState("all"),[$,k]=u.useState(""),[R,M]=u.useState({from:"",to:""}),[S,Q]=u.useState(1),[V,w]=u.useState(50),{config:m}=bs("sales-record"),{validationRules:F,canImport:p}=Ns("sales-record"),{currentSort:I,handleSort:j,getSortedData:P}=Bs();if(Le.useEffect(()=>{o&&h&&(console.log("ðŸ”„ Populating form for edit:",o),pe({date:o.date,sales_channel_id:o.sales_channel_id,product_id:o.product_id,sku:o.sku,sold_units:o.sold_units,unit_price:o.unit_price,total_price:o.total_price,notes:o.notes||"",dateString:new Date(o.date).toISOString().split("T")[0]}))},[o,h]),s)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Re,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Validating authentication..."})]})});if(!r)return console.error("SalesRecord: User not authenticated, redirecting to login"),e.jsx(wt,{to:"/login",state:{from:t},replace:!0});const{data:J=[]}=he({queryKey:["products"],queryFn:()=>Is.getAll()}),{data:A=[]}=he({queryKey:["sales-channels"],queryFn:()=>Tt.getAll()}),H=u.useMemo(()=>{const y=[];return i?.from&&y.push($e.greaterThanEqual("date",Xa(i.from))),i?.to&&y.push($e.lessThanEqual("date",Xa(i.to))),y},[i]),{data:U=[],isLoading:ie}=he({queryKey:["sales-records",i?.from?.toISOString(),i?.to?.toISOString()],queryFn:()=>st.getAll(H)}),me=Ne({mutationFn:async y=>{try{return await st.create(y)}catch(oe){throw console.error("SalesRecord: Failed to create sales record",{error:oe.message,code:oe.code,type:oe.type,payload:y,userId:r?.$id}),oe.code===401?(a({title:"Authentication Error",description:"Your session has expired. Please log in again.",variant:"destructive"}),window.location.href="/login",oe):oe.code===403?(a({title:"Permission Denied",description:"You don't have permission to create sales records.",variant:"destructive"}),oe):(a({title:"Error",description:oe.message||"Failed to create sales record. Please try again.",variant:"destructive"}),oe)}},onSuccess:y=>{n.invalidateQueries({queryKey:["sales-records"]}),a({title:"Success",description:"Sales record created successfully.",duration:3e3}),c(!1),b([]),pe({date:new Date().toISOString(),sales_channel_id:"",product_id:"",sku:"",sold_units:0,unit_price:0,total_price:0,notes:""}),d(null)}}),ve=Ne({mutationFn:async({id:y,data:oe})=>await st.update(y,oe),onSuccess:y=>{n.invalidateQueries({queryKey:["sales-records"]}),a({title:"Success",description:"Sales record updated successfully.",duration:3e3}),c(!1),d(null),pe({date:new Date().toISOString(),sales_channel_id:"",product_id:"",sku:"",sold_units:0,unit_price:0,total_price:0,notes:""})},onError:y=>{console.error("Failed to update sales record:",y),a({title:"Error",description:y.message||"Failed to update sales record. Please try again.",variant:"destructive"})}}),[z,pe]=u.useState({date:new Date().toISOString(),sales_channel_id:"",product_id:"",sku:"",sold_units:0,unit_price:0,total_price:0,notes:""}),ge=Ne({mutationFn:y=>st.delete(y),onSuccess:()=>{n.invalidateQueries({queryKey:["sales-records"]}),a({title:"Success",description:"Sales record deleted successfully."})},onError:()=>{a({title:"Error",description:"Failed to delete sales record.",variant:"destructive"})}}),Pe=Ne({mutationFn:async y=>{await Promise.all(y.map(oe=>st.delete(oe)))},onSuccess:()=>{n.invalidateQueries({queryKey:["sales-records"]}),b([]),a({title:"Success",description:"Selected records deleted successfully."})},onError:()=>{a({title:"Error",description:"Failed to delete selected records.",variant:"destructive"})}}),Ze=y=>{console.log("ðŸ” Editing sales record:",y),d(y),c(!0)},xe=y=>{confirm("Are you sure you want to delete this sales record?")&&ge.mutate(y)},ke=()=>{if(f.length===0){a({title:"No Selection",description:"Please select records to delete.",variant:"destructive"});return}confirm(`Are you sure you want to delete ${f.length} selected record(s)?`)&&Pe.mutate(f.map(y=>y.$id))},ns=()=>{if(f.length===0){a({title:"No Selection",description:"Please select records to export.",variant:"destructive"});return}a({title:"Export",description:`Exporting ${f.length} selected record(s)...`})},We=U.filter(y=>{const oe=!$||y.sku.toLowerCase().includes($.toLowerCase())||y.notes&&y.notes.toLowerCase().includes($.toLowerCase()),je=N==="all"||y.sales_channel_id===N,_e=L==="all"||y.product_id===L,es=C==="all"||y.sku===C,ws=new Date(y.date),ct=(!R.from||ws>=new Date(R.from))&&(!R.to||ws<=new Date(R.to));return oe&&je&&_e&&es&&ct}),Ge=Le.useMemo(()=>{const y=new Map;return U.forEach(oe=>{y.has(oe.sales_channel_id)||y.set(oe.sales_channel_id,{id:oe.sales_channel_id,name:A.find(je=>je.$id===oe.sales_channel_id)?.channel_name||oe.sales_channel_id})}),Array.from(y.values()).sort((oe,je)=>oe.name.localeCompare(je.name))},[U,A]),T=Le.useMemo(()=>{const y=new Map;return U.forEach(oe=>{y.has(oe.product_id)||y.set(oe.product_id,{id:oe.product_id,name:J.find(je=>je.$id===oe.product_id)?.product||oe.product_id})}),Array.from(y.values()).sort((oe,je)=>oe.name.localeCompare(je.name))},[U,J]),O=Le.useMemo(()=>Array.from(new Set(U.map(y=>y.sku))).sort(),[U]),be=We.length,Se=Math.ceil(be/V),Ie=(S-1)*V,Je=Ie+V,ls=We.slice(Ie,Je);u.useEffect(()=>{Q(1)},[$,N,L,C,R,V]);const Ds=y=>{if(y.preventDefault(),!z.sales_channel_id||!z.product_id||!z.sku||!z.sold_units||!z.unit_price||!z.dateString){a({title:"Validation Error",description:"Please fill all required fields: Date, Sales Channel, Product, SKU, Quantity, and Rate.",variant:"destructive"});return}if(z.sold_units<=0){a({title:"Validation Error",description:"Quantity must be greater than 0.",variant:"destructive"});return}if(z.unit_price<=0){a({title:"Validation Error",description:"Rate must be greater than 0.",variant:"destructive"});return}const oe={date:z.dateString?new Date(z.dateString).toISOString():z.date,sales_channel_id:z.sales_channel_id,product_id:z.product_id,sku:z.sku,sold_units:z.sold_units,unit_price:z.unit_price,total_price:Number((z.sold_units*z.unit_price).toFixed(2)),notes:z.notes||void 0};o?ve.mutate({id:o.$id,data:oe}):me.mutate(oe)};return e.jsx("div",{className:"p-4",children:e.jsxs(G,{children:[e.jsx(le,{children:e.jsxs(ce,{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Sales Records"}),e.jsxs("div",{className:"flex gap-2",children:[p&&e.jsx(gs,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:m?m.exportColumns.filter(y=>y.required).map(y=>y.exportHeader):["Sales Channel","Product","SKU"],optionalColumns:m?m.exportColumns.filter(y=>!y.required).map(y=>y.exportHeader):["Date","Qty","Rate","Total Amount","Status","Remarks"],validationRules:F,onImportComplete:y=>{y.successfulRows>0&&(n.invalidateQueries({queryKey:["sales-records"]}),a({title:"Import Successful",description:`${y.successfulRows} sales records imported successfully.`}))}},variant:"outline"}),m&&e.jsx(xs,{data:U.map(y=>{const oe={};return m.exportColumns.forEach(je=>{let _e;switch(je.dataKey){case"date":_e=y.date;break;case"channelName":_e=A.find(es=>es.$id===y.sales_channel_id)?.channel_name||y.sales_channel_id;break;case"productName":_e=J.find(es=>es.$id===y.product_id)?.product||y.product_id;break;case"sku":_e=y.sku;break;case"qty":_e=y.sold_units;break;case"rate":_e=y.unit_price;break;case"totalAmount":_e=Number((y.sold_units*y.unit_price).toFixed(2));break;case"status":_e="Completed";break;case"remarks":_e=y.notes||"";break;default:_e=y[je.dataKey]}oe[je.exportHeader]=je.formatter?je.formatter(_e):_e}),oe}),headers:m.exportColumns.map(y=>y.exportHeader),filename:"sales-record",variant:"outline"}),e.jsxs(D,{onClick:()=>c(!0),children:[e.jsx(fs,{className:"mr-2 h-4 w-4"})," Add Sales Record"]})]})]})}),e.jsxs(Z,{children:[e.jsx(G,{className:"mb-6",children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(ts,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(B,{placeholder:"Search records...",className:"pl-10",value:$,onChange:y=>k(y.target.value)})]}),p&&m&&e.jsx(gs,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:m.exportColumns.filter(y=>y.required).map(y=>y.exportHeader),optionalColumns:m.exportColumns.filter(y=>!y.required).map(y=>y.exportHeader),validationRules:F,onImportComplete:y=>{y.successfulRows>0&&(n.invalidateQueries({queryKey:["sales-records"]}),a({title:"Import Successful",description:`${y.successfulRows} sales records imported successfully.`}))}},variant:"outline"}),m&&e.jsx(xs,{data:We.map(y=>{const oe={};return m.exportColumns.forEach(je=>{let _e;switch(je.dataKey){case"date":_e=y.date;break;case"channelName":_e=A.find(es=>es.$id===y.sales_channel_id)?.channel_name||y.sales_channel_id;break;case"productName":_e=J.find(es=>es.$id===y.product_id)?.product||y.product_id;break;case"sku":_e=y.sku;break;case"qty":_e=y.sold_units;break;case"rate":_e=y.unit_price;break;case"totalAmount":_e=Number((y.sold_units*y.unit_price).toFixed(2));break;case"status":_e="Completed";break;case"remarks":_e=y.notes||"";break;default:_e=y[je.dataKey]}oe[je.exportHeader]=je.formatter?je.formatter(_e):_e}),oe}),headers:m.exportColumns.map(y=>y.exportHeader),filename:"sales-record",variant:"outline"})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs(te,{value:N,onValueChange:q,children:[e.jsx(ee,{className:"w-[180px]",children:e.jsx(ae,{placeholder:"Filter by Channel"})}),e.jsxs(se,{children:[e.jsx(v,{value:"all",children:"All Channels"}),Ge.map(y=>e.jsx(v,{value:y.id,children:y.name},y.id))]})]}),e.jsxs(te,{value:L,onValueChange:x,children:[e.jsx(ee,{className:"w-[180px]",children:e.jsx(ae,{placeholder:"Filter by Product"})}),e.jsxs(se,{children:[e.jsx(v,{value:"all",children:"All Products"}),T.map(y=>e.jsx(v,{value:y.id,children:y.name},y.id))]})]}),e.jsxs(te,{value:C,onValueChange:E,children:[e.jsx(ee,{className:"w-[180px]",children:e.jsx(ae,{placeholder:"Filter by SKU"})}),e.jsxs(se,{children:[e.jsx(v,{value:"all",children:"All SKUs"}),O.map(y=>e.jsx(v,{value:y,children:y},y))]})]}),e.jsx(B,{type:"date",placeholder:"From Date",className:"w-[150px]",value:R.from,onChange:y=>M(oe=>({...oe,from:y.target.value}))}),e.jsx(B,{type:"date",placeholder:"To Date",className:"w-[150px]",value:R.to,onChange:y=>M(oe=>({...oe,to:y.target.value}))})]})]})})}),e.jsx(Qe,{open:h,onOpenChange:y=>{c(y),y||(pe({date:new Date().toISOString(),sales_channel_id:"",product_id:"",sku:"",sold_units:0,unit_price:0,total_price:0,notes:""}),d(null))},children:e.jsxs(Ve,{className:"sm:max-w-[720px]",children:[e.jsxs(Be,{children:[e.jsx(ze,{children:o?"Edit Sales Record":"Add New Sales Record"}),e.jsx(Ye,{children:"Enter sales record details below."})]}),e.jsxs("form",{onSubmit:Ds,children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 py-4",children:[e.jsxs("div",{children:[e.jsx(_,{htmlFor:"date",children:"Date *"}),e.jsx(B,{id:"date",type:"date",value:z.dateString||"",onChange:y=>pe(oe=>({...oe,dateString:y.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"channel",children:"Sales Channel *"}),e.jsxs(te,{value:z.sales_channel_id,onValueChange:y=>pe(oe=>({...oe,sales_channel_id:y})),children:[e.jsx(ee,{id:"channel",children:e.jsx(ae,{placeholder:"Select Sales Channel"})}),e.jsx(se,{children:A.map(y=>e.jsx(v,{value:y.$id,children:y.channel_name||y.$id},y.$id))})]})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"product",children:"Product *"}),e.jsxs(te,{value:z.product_id,onValueChange:y=>pe(oe=>({...oe,product_id:y,sku:J.find(je=>je.$id===y)?.sku||oe.sku})),children:[e.jsx(ee,{id:"product",children:e.jsx(ae,{placeholder:"Select Product"})}),e.jsx(se,{children:J.map(y=>e.jsx(v,{value:y.$id,children:y.product||y.$id},y.$id))})]})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"sku",children:"SKU *"}),e.jsxs(te,{value:z.sku,onValueChange:y=>pe(oe=>({...oe,sku:y})),children:[e.jsx(ee,{id:"sku",children:e.jsx(ae,{placeholder:"Select SKU"})}),e.jsx(se,{children:J.filter(y=>y.sku).map(y=>e.jsxs(v,{value:y.sku,children:[y.sku,y.product?` â€” ${y.product}`:""]},y.$id))})]})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"qty",children:"Quantity *"}),e.jsx(B,{id:"qty",type:"number",min:"1",value:z.sold_units,onChange:y=>pe(oe=>({...oe,sold_units:Number(y.target.value),total_price:Number((Number(y.target.value)*oe.unit_price).toFixed(2))})),required:!0})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"rate",children:"Rate *"}),e.jsx(B,{id:"rate",type:"number",step:"0.01",min:"0.01",value:z.unit_price,onChange:y=>pe(oe=>({...oe,unit_price:Number(y.target.value),total_price:Number((oe.sold_units*Number(y.target.value)).toFixed(2))})),required:!0})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"total",children:"Total Amount"}),e.jsx(B,{id:"total",type:"number",step:"0.01",value:Number((z.sold_units*z.unit_price).toFixed(2)),readOnly:!0,className:"bg-gray-100"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(_,{htmlFor:"notes",children:"Remarks"}),e.jsx(B,{id:"notes",type:"text",value:z.notes||"",onChange:y=>pe(oe=>({...oe,notes:y.target.value}))})]})]}),e.jsx(He,{children:e.jsx(D,{type:"submit",disabled:me.isPending||ve.isPending,children:me.isPending||ve.isPending?e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"mr-2 h-4 w-4 animate-spin"}),"Savingâ€¦"]}):o?"Update Sales Record":"Add Sales Record"})})]})]})}),e.jsx(G,{children:e.jsxs(Z,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",Ie+1," to ",Math.min(Je,be)," of ",be," records"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Records per page:"}),e.jsxs(te,{value:V.toString(),onValueChange:y=>w(Number(y)),children:[e.jsx(ee,{className:"w-[100px]",children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"50",children:"50"}),e.jsx(v,{value:"100",children:"100"}),e.jsx(v,{value:"500",children:"500"})]})]})]})]}),f.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 p-3 bg-muted rounded-md",children:[e.jsxs("span",{className:"text-sm font-medium",children:[f.length," selected"]}),e.jsx(D,{variant:"destructive",size:"sm",onClick:ke,disabled:Pe.isPending,children:"Delete Selected"}),e.jsx(D,{variant:"outline",size:"sm",onClick:ns,children:"Export Selected"})]}),e.jsx("div",{className:"border rounded-md",children:e.jsx("div",{className:"overflow-auto",style:{maxHeight:"600px"},children:e.jsx(Gs,{data:P(ls.map(y=>((!y.date||y.date==="Invalid Date")&&console.warn("Invalid sales record date found:",{id:y.$id,date:y.date}),{...y,formattedDate:ca(y.date),channelName:A.find(oe=>oe.$id===y.sales_channel_id)?.channel_name||y.sales_channel_id,productName:J.find(oe=>oe.$id===y.product_id)?.product||y.product_id,totalAmount:Number((y.sold_units*y.unit_price).toFixed(2)),status:"Completed"}))),columns:[{key:"formattedDate",label:"Date",sortable:!0,dataType:"date"},{key:"channelName",label:"Sales Channel",sortable:!0,dataType:"string"},{key:"productName",label:"Product",sortable:!0,dataType:"string"},{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"sold_units",label:"Qty",sortable:!0,dataType:"number",align:"right",headerClassName:"bg-purple-50",cellClassName:"bg-purple-50 font-medium"},{key:"unit_price",label:"Rate",sortable:!0,dataType:"number",align:"right"},{key:"totalAmount",label:"Total Amount",sortable:!0,dataType:"number",align:"right",headerClassName:"bg-green-50",cellClassName:"bg-green-50 font-medium"},{key:"status",label:"Status",sortable:!0,dataType:"string",formatter:y=>e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${y==="Completed"?"bg-green-100 text-green-800":y==="In Progress"?"bg-yellow-100 text-yellow-800":y==="Pending"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:y})},{key:"notes",label:"Remarks",sortable:!0,dataType:"string"}],onSort:j,currentSort:I,loading:ie,maxHeight:"none",stickyHeader:!0,bordered:!1,searchable:!1,rowKey:"$id",selectable:!0,selectedRows:f,onSelectionChange:b,actions:[{label:"Edit",onClick:Ze,variant:"default"},{label:"Delete",onClick:y=>xe(y.$id),variant:"destructive"}],emptyMessage:"No sales records found"})})}),Se>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx(D,{variant:"outline",size:"sm",onClick:()=>Q(y=>Math.max(1,y-1)),disabled:S===1,children:"Previous"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",S," of ",Se]})}),e.jsx(D,{variant:"outline",size:"sm",onClick:()=>Q(y=>Math.min(Se,y+1)),disabled:S===Se,children:"Next"})]})]})})]})]})})}const Bl=()=>{const r=Fa(),s=[{title:"Stocks",description:"Manage inventory and stock levels",icon:Nt,path:"/master/stocks",color:"text-blue-600"},{title:"Vendors",description:"Manage supplier information",icon:zr,path:"/master/vendors",color:"text-green-600"},{title:"Staff",description:"Manage employee records",icon:Qr,path:"/master/staff",color:"text-purple-600"},{title:"Processes",description:"Manage business processes",icon:Ea,path:"/master/processes",color:"text-orange-600"},{title:"Raw Products",description:"Manage raw materials",icon:Ta,path:"/master/raw-products",color:"text-red-600"},{title:"Products",description:"Manage finished products",icon:Ci,path:"/master/products",color:"text-indigo-600"},{title:"Sales Channels",description:"Manage sales channels",icon:Pi,path:"/master/sales-channels",color:"text-teal-600"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Master Data"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your core business data and configurations"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:s.map(t=>{const a=t.icon;return e.jsxs(G,{className:"hover:shadow-lg transition-shadow cursor-pointer",children:[e.jsxs(le,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(a,{className:`h-6 w-6 ${t.color}`}),e.jsx(ce,{className:"text-lg",children:t.title})]}),e.jsx(ye,{children:t.description})]}),e.jsx(Z,{children:e.jsxs(D,{onClick:()=>r(t.path),className:"w-full",variant:"outline",children:["Manage ",t.title]})})]},t.title)})})]})},Hl=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Analytics"}),e.jsx("p",{className:"text-muted-foreground",children:"Business intelligence and performance analytics"})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(G,{children:[e.jsx(le,{children:e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(ya,{className:"h-5 w-5 text-primary"}),"Production Analytics"]})}),e.jsx(Z,{children:e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"Production performance charts"}),e.jsx("p",{className:"text-sm",children:"Database connection required"})]})})]}),e.jsxs(G,{children:[e.jsx(le,{children:e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(It,{className:"h-5 w-5 text-primary"}),"Sales Trends"]})}),e.jsx(Z,{children:e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"Sales performance analysis"}),e.jsx("p",{className:"text-sm",children:"Database connection required"})]})})]}),e.jsxs(G,{children:[e.jsx(le,{children:e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(Ti,{className:"h-5 w-5 text-primary"}),"Inventory Distribution"]})}),e.jsx(Z,{children:e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"Stock distribution charts"}),e.jsx("p",{className:"text-sm",children:"Database connection required"})]})})]}),e.jsxs(G,{children:[e.jsx(le,{children:e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(Di,{className:"h-5 w-5 text-primary"}),"Efficiency Metrics"]})}),e.jsx(Z,{children:e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"Process efficiency analysis"}),e.jsx("p",{className:"text-sm",children:"Database connection required"})]})})]})]})]}),zl=()=>{const r=Ws();return u.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",r.pathname)},[r.pathname]),e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-gray-100",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"mb-4 text-4xl font-bold",children:"404"}),e.jsx("p",{className:"mb-4 text-xl text-gray-600",children:"Oops! Page not found"}),e.jsx("a",{href:"/",className:"text-blue-500 underline hover:text-blue-700",children:"Return to Home"})]})})},Ql=()=>{const[r,s]=u.useState(!1),[t,a]=u.useState(null),[n,i]=u.useState(""),{toast:l}=Ee(),h=is(),{user:c}=os(),{config:o}=bs("stocks"),{validationRules:d,canImport:f}=Ns("stocks"),{currentSort:b,handleSort:N,getSortedData:q}=Bs(),[L,x]=u.useState({stock_code:"",stock_name:"",category:"",uom:"",min_level:"",status:"Active"}),{data:C=[],isLoading:E,error:$}=he({queryKey:["stocks"],queryFn:async()=>await Fs.getAll(),enabled:!!c}),k=Ne({mutationFn:async I=>{const{stock_code:j,stock_name:P,category:J,uom:A,min_level:H}=I,U={stock_code:j,stock_name:P,category:J,uom:A,min_level:H},ie=await Fs.create(U);if(ie&&ie.$id)try{const me=new Date().toISOString().split("T")[0];await bn.create({stock_id:ie.$id,opening_balance:0,purchases:0,used_in_production:0,status_date:me})}catch(me){console.error("Error creating stock status entry:",me)}return ie},onSuccess:()=>{h.invalidateQueries({queryKey:["stocks"]}),h.invalidateQueries({queryKey:["stock_status"]}),l({title:"Success",description:"Stock created successfully"}),s(!1),a(null),w()},onError:I=>{l({title:"Error",description:"Failed to create stock",variant:"destructive"}),console.error("Error creating stock:",I)}}),R=Ne({mutationFn:async({id:I,data:j})=>{const{stock_code:P,name:J,category:A,uom:H,min_level:U}=j,ie={stock_code:P,stock_name:J,category:A,uom:H,min_level:U};return await Fs.update(I,ie)},onSuccess:()=>{h.invalidateQueries({queryKey:["stocks"]}),h.invalidateQueries({queryKey:["stock_status"]}),l({title:"Success",description:"Stock updated successfully"}),s(!1),a(null),w()},onError:I=>{l({title:"Error",description:"Failed to update stock",variant:"destructive"}),console.error("Error updating stock:",I)}}),M=Ne({mutationFn:I=>Fs.delete(I),onSuccess:()=>{h.invalidateQueries({queryKey:["stocks"]}),l({title:"Success",description:"Stock deleted successfully"})},onError:I=>{l({title:"Error",description:"Failed to delete stock",variant:"destructive"}),console.error("Error deleting stock:",I)}}),S=async I=>{if(I.preventDefault(),!L.stock_code.trim()){l({title:"Error",description:"Stock Code is required",variant:"destructive"});return}if(!L.stock_name?.trim()){l({title:"Error",description:"Stock Name is required",variant:"destructive"});return}if(!L.category.trim()){l({title:"Error",description:"Category is required",variant:"destructive"});return}if(!L.uom.trim()){l({title:"Error",description:"UoM is required",variant:"destructive"});return}if(!L.min_level.trim()){l({title:"Error",description:"Min Level is required",variant:"destructive"});return}const j={...L,min_level:L.min_level?parseFloat(L.min_level):void 0};t?R.mutate({id:t.$id,data:j}):k.mutate(j)},Q=I=>{a(I),x({stock_code:I.stock_code,stock_name:I.stock_name||"",category:I.category||"",uom:I.uom||"",min_level:I.min_level?.toString()||"",status:I.status}),s(!0)},V=async I=>{await requestDeletion("stock",I.$id,I.stock_name,()=>M.mutate(I.$id))},w=()=>{x({stock_code:"",stock_name:"",category:"",uom:"",min_level:"",status:"Active"})},m=()=>{a(null),w(),s(!0)},F=C.filter(I=>I.stock_name.toLowerCase().includes(n.toLowerCase())||I.stock_code.toLowerCase().includes(n.toLowerCase())||I.category.toLowerCase().includes(n.toLowerCase())),p=q(F);return $?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("p",{className:"text-red-500",children:["Error loading stocks: ",$.message]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Stocks"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage raw materials and stock items"})]}),e.jsxs(Qe,{open:r,onOpenChange:s,children:[e.jsx(lt,{asChild:!0,children:e.jsxs(D,{onClick:m,className:"bg-primary hover:bg-primary/90",children:[e.jsx(fs,{className:"h-4 w-4 mr-2"}),"Add New Stock"]})}),e.jsxs(Ve,{className:"sm:max-w-[425px]",children:[e.jsxs(Be,{children:[e.jsx(ze,{children:t?"Edit Stock":"Add New Stock"}),e.jsxs(Ye,{children:[t?"Update stock information":"Enter stock details to add a new stock",e.jsxs("span",{className:"mt-2 text-sm text-muted-foreground",children:["Fields marked with ",e.jsx("span",{className:"text-red-500",children:"*"})," are required."]})]})]}),e.jsxs("form",{onSubmit:S,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(_,{htmlFor:"stock_code",className:"text-right",children:["Stock Code ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(B,{id:"stock_code",value:L.stock_code,onChange:I=>x({...L,stock_code:I.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(_,{htmlFor:"stock_name",className:"text-right",children:["Stock Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(B,{id:"stock_name",value:L.stock_name,onChange:I=>x({...L,stock_name:I.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(_,{htmlFor:"category",className:"text-right",children:["Category ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(B,{id:"category",value:L.category,onChange:I=>x({...L,category:I.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(_,{htmlFor:"uom",className:"text-right",children:["UoM ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(te,{value:L.uom,onValueChange:I=>x({...L,uom:I}),children:[e.jsx(ee,{className:"col-span-3",children:e.jsx(ae,{placeholder:"Select unit of measure"})}),e.jsxs(se,{children:[e.jsx(v,{value:"kg",children:"kg"}),e.jsx(v,{value:"g",children:"g"}),e.jsx(v,{value:"ltr",children:"ltr"}),e.jsx(v,{value:"ml",children:"ml"}),e.jsx(v,{value:"pcs",children:"pcs"}),e.jsx(v,{value:"bags",children:"bags"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(_,{htmlFor:"min_level",className:"text-right",children:["Min Level ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(B,{id:"min_level",type:"number",step:"0.01",value:L.min_level,onChange:I=>x({...L,min_level:I.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(_,{htmlFor:"status",className:"text-right",children:"Status"}),e.jsxs(te,{value:L.status,onValueChange:I=>x({...L,status:I}),children:[e.jsx(ee,{className:"col-span-3",children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"Active",children:"Active"}),e.jsx(v,{value:"Inactive",children:"Inactive"})]})]})]})]}),e.jsx(He,{children:e.jsx(D,{type:"submit",disabled:k.isPending||R.isPending,children:k.isPending||R.isPending?"Saving...":t?"Update":"Create"})})]})]})]})]}),e.jsx(G,{children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ts,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(B,{placeholder:"Search stocks...",className:"pl-10",value:n,onChange:I=>i(I.target.value)})]}),e.jsxs(D,{variant:"outline",children:[e.jsx(Ks,{className:"h-4 w-4 mr-2"}),"Filter"]}),f&&e.jsx(gs,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:["Stock Name","SKU","Unit"],optionalColumns:["Category","Opening Balance"],validationRules:d,onImportComplete:I=>{I.successfulRows>0&&(h.invalidateQueries({queryKey:["stocks"]}),l({title:"Import Successful",description:`${I.successfulRows} stocks imported successfully.`}))}},variant:"outline"}),o&&e.jsx(xs,{data:F.map(I=>({name:I.stock_name,sku:I.stock_code,category:I.category,unit:I.uom,openingBalance:I.min_level||0,createdAt:I.$createdAt})),headers:o.exportColumns.map(I=>I.exportHeader),filename:"stocks",variant:"outline"})]})})}),e.jsxs(G,{children:[e.jsx(le,{children:e.jsxs(ce,{children:["Stock Items (",F.length,")"]})}),e.jsx(Z,{children:e.jsx(Gs,{data:p.map(I=>({...I,stock_code:I.stock_code||"",stock_name:I.stock_name||"",category:I.category||"-",uom:I.uom||"-",min_level:I.min_level||0,status:I.status||"Active"})),columns:[{key:"stock_code",label:"Stock Code",sortable:!0,dataType:"string"},{key:"stock_name",label:"Stock Name",sortable:!0,dataType:"string"},{key:"category",label:"Category",sortable:!0,dataType:"string"},{key:"uom",label:"UoM",sortable:!0,dataType:"string"},{key:"min_level",label:"Min Level",sortable:!0,dataType:"number",align:"right"},{key:"status",label:"Status",sortable:!0,dataType:"string"}],onSort:N,currentSort:b,loading:E,emptyMessage:"No stocks found",actions:[{label:"Edit",icon:e.jsx(Vs,{className:"h-4 w-4"}),onClick:Q},{label:"Delete",icon:e.jsx(Ts,{className:"h-4 w-4"}),onClick:I=>V(I),variant:"destructive"}]})})]})]})},Hs=u.forwardRef(({className:r,...s},t)=>e.jsx("textarea",{className:re("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:t,...s}));Hs.displayName="Textarea";const Yl=()=>{const[r,s]=u.useState(""),[t,a]=u.useState("all"),[n,i]=u.useState(!1),[l,h]=u.useState(null),[c,o]=u.useState({vendor_name:"",contact_person:"",phone:"",email:"",address:"",gstin:"",status:"Active"}),{toast:d}=Ee(),f=is(),{config:b}=bs("vendors"),{validationRules:N,canImport:q}=Ns("vendors"),{data:L=[],isLoading:x,error:C}=he({queryKey:["vendors"],queryFn:async()=>await Pt.getAll()}),E=Ne({mutationFn:m=>{const{vendor_name:F,contact_person:p,phone:I,email:j,address:P,gstin:J}=m,A={vendor_name:F,contact_person:p||"",phone:I||"",address:P||"",gstin:J||""};return j&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(j)&&(A.email=j),Pt.create(A)},onSuccess:()=>{f.invalidateQueries({queryKey:["vendors"]}),d({title:"Success",description:"Vendor created successfully"}),i(!1),R()},onError:m=>{d({title:"Error",description:"Failed to create vendor",variant:"destructive"}),console.error("Error creating vendor:",m)}}),$=Ne({mutationFn:({id:m,data:F})=>{const{vendor_name:p,contact_person:I,phone:j,email:P,address:J,gstin:A}=F,H={vendor_name:p,contact_person:I||"",phone:j||"",address:J||"",gstin:A||""};return P&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(P)&&(H.email=P),Pt.update(m,H)},onSuccess:()=>{f.invalidateQueries({queryKey:["vendors"]}),d({title:"Success",description:"Vendor updated successfully"}),i(!1),R()},onError:m=>{d({title:"Error",description:"Failed to update vendor",variant:"destructive"}),console.error("Error updating vendor:",m)}}),k=Ne({mutationFn:m=>Pt.delete(m),onSuccess:()=>{f.invalidateQueries({queryKey:["vendors"]}),d({title:"Success",description:"Vendor deleted successfully"})},onError:m=>{d({title:"Error",description:"Failed to delete vendor",variant:"destructive"}),console.error("Error deleting vendor:",m)}}),R=()=>{o({vendor_name:"",contact_person:"",phone:"",email:"",address:"",gstin:"",status:"Active"}),h(null)},M=m=>{if(m.preventDefault(),!c.vendor_name.trim()){d({title:"Error",description:"Vendor Name is required",variant:"destructive"});return}if(!c.contact_person.trim()){d({title:"Error",description:"Contact Person is required",variant:"destructive"});return}if(c.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(c.email)){d({title:"Error",description:"Please enter a valid email address",variant:"destructive"});return}l?$.mutate({id:l.$id,data:c}):E.mutate(c)},S=m=>{h(m),o({vendor_name:m.vendor_name,contact_person:m.contact_person||"",phone:m.phone||"",email:m.email||"",address:m.address||"",gstin:m.gstin||"",status:m.status}),i(!0)},Q=m=>{confirm("Are you sure you want to delete this vendor?")&&k.mutate(m)},V=()=>{h(null),R(),i(!0)},w=L.filter(m=>{const F=m.vendor_name.toLowerCase().includes(r.toLowerCase())||m.contact_person?.toLowerCase().includes(r.toLowerCase())||m.email?.toLowerCase().includes(r.toLowerCase()),p=t==="all"||m.status===t;return F&&p});return C?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("p",{className:"text-red-500",children:["Error loading vendors: ",C.message]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Vendors"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage vendor information and relationships"})]}),e.jsxs(Qe,{open:n,onOpenChange:i,children:[e.jsx(lt,{asChild:!0,children:e.jsxs(D,{onClick:V,className:"bg-primary hover:bg-primary/90",children:[e.jsx(fs,{className:"h-4 w-4 mr-2"}),"Add New Vendor"]})}),e.jsxs(Ve,{className:"sm:max-w-[500px]",children:[e.jsxs(Be,{children:[e.jsx(ze,{children:l?"Edit Vendor":"Add New Vendor"}),e.jsxs(Ye,{children:[l?"Update vendor information":"Enter vendor details to add a new vendor",e.jsxs("p",{className:"mt-2 text-sm text-muted-foreground",children:["Fields marked with ",e.jsx("span",{className:"text-red-500",children:"*"})," are required."]})]})]}),e.jsxs("form",{onSubmit:M,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(_,{htmlFor:"vendor_name",className:"text-right",children:["Vendor Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(B,{id:"vendor_name",value:c.vendor_name,onChange:m=>o({...c,vendor_name:m.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(_,{htmlFor:"contact_person",className:"text-right",children:["Contact Person ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(B,{id:"contact_person",value:c.contact_person,onChange:m=>o({...c,contact_person:m.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(_,{htmlFor:"phone",className:"text-right",children:"Phone"}),e.jsx(B,{id:"phone",value:c.phone,onChange:m=>o({...c,phone:m.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(_,{htmlFor:"email",className:"text-right",children:"Email"}),e.jsx(B,{id:"email",type:"email",value:c.email,onChange:m=>o({...c,email:m.target.value}),className:"col-span-3",placeholder:"Optional"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(_,{htmlFor:"address",className:"text-right",children:"Address"}),e.jsx(Hs,{id:"address",value:c.address,onChange:m=>o({...c,address:m.target.value}),className:"col-span-3",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(_,{htmlFor:"gstin",className:"text-right",children:"GSTIN"}),e.jsx(B,{id:"gstin",value:c.gstin,onChange:m=>o({...c,gstin:m.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(_,{htmlFor:"status",className:"text-right",children:"Status"}),e.jsxs(te,{value:c.status,onValueChange:m=>o({...c,status:m}),children:[e.jsx(ee,{className:"col-span-3",children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"Active",children:"Active"}),e.jsx(v,{value:"Inactive",children:"Inactive"})]})]})]})]}),e.jsx(He,{children:e.jsx(D,{type:"submit",children:l?"Update":"Create"})})]})]})]})]}),e.jsx(G,{children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ts,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(B,{placeholder:"Search vendors...",className:"pl-10",value:r,onChange:m=>s(m.target.value)})]}),e.jsxs(D,{variant:"outline",children:[e.jsx(Ks,{className:"h-4 w-4 mr-2"}),"Filter"]}),q&&e.jsx(gs,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:["Vendor Name"],optionalColumns:["Email","Phone","Contact Person","Address"],validationRules:N,onImportComplete:m=>{m.successfulRows>0&&(f.invalidateQueries({queryKey:["vendors"]}),d({title:"Import Successful",description:`${m.successfulRows} vendors imported successfully.`}))}},variant:"outline"}),b&&e.jsx(xs,{data:w.map(m=>({name:m.vendor_name,email:m.email||"",phone:m.phone||"",contactPerson:m.contact_person||"",address:m.address||"",isActive:m.status==="Active",createdAt:m.$createdAt})),headers:b.exportColumns.map(m=>m.exportHeader),filename:"vendors",variant:"outline"})]})})}),e.jsxs(G,{children:[e.jsx(le,{children:e.jsxs(ce,{children:["Vendors (",w.length,")"]})}),e.jsx(Z,{children:x?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:e.jsx("span",{children:"Loading vendors..."})}):w.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("p",{className:"text-lg mb-2",children:"No vendors found"}),e.jsx("p",{className:"text-sm",children:"Add your first vendor to get started"})]}):e.jsxs(ds,{children:[e.jsx(us,{children:e.jsxs(we,{children:[e.jsx(X,{children:"Vendor Name"}),e.jsx(X,{children:"Contact Person"}),e.jsx(X,{children:"Phone"}),e.jsx(X,{children:"Email"}),e.jsx(X,{children:"Address"}),e.jsx(X,{children:"GSTIN"}),e.jsx(X,{children:"Status"}),e.jsx(X,{children:"Actions"})]})}),e.jsx(ms,{children:w.map(m=>e.jsxs(we,{children:[e.jsx(Y,{className:"font-medium",children:m.vendor_name}),e.jsx(Y,{children:m.contact_person||"-"}),e.jsx(Y,{children:m.phone||"-"}),e.jsx(Y,{children:m.email||"-"}),e.jsx(Y,{className:"max-w-xs truncate",children:m.address||"-"}),e.jsx(Y,{children:m.gstin||"-"}),e.jsx(Y,{children:e.jsx(Ae,{variant:m.status==="Active"?"default":"secondary",children:m.status})}),e.jsx(Y,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(D,{variant:"outline",size:"sm",onClick:()=>S(m),children:e.jsx(Vs,{className:"h-4 w-4"})}),e.jsx(D,{variant:"outline",size:"sm",onClick:()=>Q(m.$id),children:e.jsx(Ts,{className:"h-4 w-4"})})]})})]},m.$id))})]})})]})]})},Wl=()=>{const[r,s]=u.useState(""),[t,a]=u.useState("all"),[n,i]=u.useState(!1),[l,h]=u.useState(null),[c,o]=u.useState({staff_code:"",staff_name:"",role:"",department:"",email:"",phone:"",joining_date:"",status:"Active"}),{toast:d}=Ee(),f=is(),{config:b}=bs("staff"),{validationRules:N,canImport:q}=Ns("staff"),{getSortedData:L}=Bs(),x={async getAll(){return(await Me.listDocuments(Oe,fe.STAFF)).documents},async create(p){return await Me.createDocument(Oe,fe.STAFF,at.unique(),p)},async update(p,I){return await Me.updateDocument(Oe,fe.STAFF,p,I)},async delete(p){return await Me.deleteDocument(Oe,fe.STAFF,p)}},{data:C=[],isLoading:E,error:$}=he({queryKey:["staff"],queryFn:async()=>await x.getAll()}),k=Ne({mutationFn:p=>{const{staff_code:I,staff_name:j,role:P,department:J,phone:A,email:H}=p,U={staff_code:I,staff_name:j,role:P,department:J,phone:A||"",email:H||""};return x.create(U)},onSuccess:()=>{f.invalidateQueries({queryKey:["staff"]}),d({title:"Success",description:"Staff member created successfully"}),i(!1),S()},onError:p=>{d({title:"Error",description:"Failed to create staff member",variant:"destructive"}),console.error("Error creating staff:",p)}}),R=Ne({mutationFn:({id:p,data:I})=>{const{staff_code:j,staff_name:P,role:J,department:A,phone:H,email:U}=I,ie={staff_code:j,staff_name:P,role:J,department:A,phone:H||"",email:U||""};return x.update(p,ie)},onSuccess:()=>{f.invalidateQueries({queryKey:["staff"]}),d({title:"Success",description:"Staff member updated successfully"}),i(!1),S()},onError:p=>{d({title:"Error",description:"Failed to update staff member",variant:"destructive"}),console.error("Error updating staff:",p)}}),M=Ne({mutationFn:p=>x.delete(p),onSuccess:()=>{f.invalidateQueries({queryKey:["staff"]}),d({title:"Success",description:"Staff member deleted successfully"})},onError:p=>{d({title:"Error",description:"Failed to delete staff member",variant:"destructive"}),console.error("Error deleting staff:",p)}}),S=()=>{o({staff_code:"",staff_name:"",role:"",department:"",email:"",phone:"",joining_date:"",status:"Active"}),h(null)},Q=p=>{if(p.preventDefault(),!c.staff_code.trim()){d({title:"Error",description:"Staff Code is required",variant:"destructive"});return}if(!c.staff_name.trim()){d({title:"Error",description:"Staff Name is required",variant:"destructive"});return}if(!c.role.trim()){d({title:"Error",description:"Role is required",variant:"destructive"});return}if(!c.department.trim()){d({title:"Error",description:"Department is required",variant:"destructive"});return}if(c.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(c.email)){d({title:"Error",description:"Please enter a valid email address",variant:"destructive"});return}l?R.mutate({id:l.$id,data:c}):k.mutate(c)},V=p=>{h(p),o({staff_code:p.staff_code,staff_name:p.staff_name,role:p.role,department:p.department||"",email:p.email||"",phone:p.phone||"",joining_date:p.joining_date||"",status:p.status}),i(!0)},w=p=>{confirm("Are you sure you want to delete this staff member?")&&M.mutate(p)},m=()=>{h(null),S(),i(!0)},F=C.filter(p=>{const I=p.staff_name.toLowerCase().includes(r.toLowerCase())||p.staff_code.toLowerCase().includes(r.toLowerCase())||p.role.toLowerCase().includes(r.toLowerCase())||p.department?.toLowerCase().includes(r.toLowerCase()),j=t==="all"||p.status===t;return I&&j});return L(F),$?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("p",{className:"text-red-500",children:["Error loading staff: ",$.message]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Staff"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage employee data and roles"})]}),e.jsxs(Qe,{open:n,onOpenChange:i,children:[e.jsx(lt,{asChild:!0,children:e.jsxs(D,{onClick:m,className:"bg-primary hover:bg-primary/90",children:[e.jsx(fs,{className:"h-4 w-4 mr-2"}),"Add New Staff"]})}),e.jsxs(Ve,{className:"sm:max-w-[500px]",children:[e.jsxs(Be,{children:[e.jsx(ze,{children:l?"Edit Staff":"Add New Staff"}),e.jsxs(Ye,{children:[l?"Update staff information":"Enter staff details to add a new employee",e.jsxs("p",{className:"mt-2 text-sm text-muted-foreground",children:["Fields marked with ",e.jsx("span",{className:"text-red-500",children:"*"})," are required."]})]})]}),e.jsxs("form",{onSubmit:Q,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(_,{htmlFor:"staff_code",className:"text-right",children:["Staff Code ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(B,{id:"staff_code",value:c.staff_code,onChange:p=>o({...c,staff_code:p.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(_,{htmlFor:"staff_name",className:"text-right",children:["Staff Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(B,{id:"staff_name",value:c.staff_name,onChange:p=>o({...c,staff_name:p.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(_,{htmlFor:"role",className:"text-right",children:["Role ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(te,{value:c.role,onValueChange:p=>o({...c,role:p}),children:[e.jsx(ee,{className:"col-span-3",children:e.jsx(ae,{placeholder:"Select role"})}),e.jsxs(se,{children:[e.jsx(v,{value:"Manager",children:"Manager"}),e.jsx(v,{value:"Supervisor",children:"Supervisor"}),e.jsx(v,{value:"Operator",children:"Operator"}),e.jsx(v,{value:"Quality Controller",children:"Quality Controller"}),e.jsx(v,{value:"Warehouse Staff",children:"Warehouse Staff"}),e.jsx(v,{value:"Admin",children:"Admin"}),e.jsx(v,{value:"Accountant",children:"Accountant"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(_,{htmlFor:"department",className:"text-right",children:["Department ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(te,{value:c.department,onValueChange:p=>o({...c,department:p}),children:[e.jsx(ee,{className:"col-span-3",children:e.jsx(ae,{placeholder:"Select department"})}),e.jsxs(se,{children:[e.jsx(v,{value:"Production",children:"Production"}),e.jsx(v,{value:"Quality Control",children:"Quality Control"}),e.jsx(v,{value:"Warehouse",children:"Warehouse"}),e.jsx(v,{value:"Administration",children:"Administration"}),e.jsx(v,{value:"Accounts",children:"Accounts"}),e.jsx(v,{value:"Sales",children:"Sales"}),e.jsx(v,{value:"Purchase",children:"Purchase"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(_,{htmlFor:"email",className:"text-right",children:"Email"}),e.jsx(B,{id:"email",type:"email",value:c.email,onChange:p=>o({...c,email:p.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(_,{htmlFor:"phone",className:"text-right",children:"Phone"}),e.jsx(B,{id:"phone",value:c.phone,onChange:p=>o({...c,phone:p.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(_,{htmlFor:"joining_date",className:"text-right",children:"Joining Date"}),e.jsx(B,{id:"joining_date",type:"date",value:c.joining_date,onChange:p=>o({...c,joining_date:p.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(_,{htmlFor:"status",className:"text-right",children:"Status"}),e.jsxs(te,{value:c.status,onValueChange:p=>o({...c,status:p}),children:[e.jsx(ee,{className:"col-span-3",children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"Active",children:"Active"}),e.jsx(v,{value:"Inactive",children:"Inactive"})]})]})]})]}),e.jsx(He,{children:e.jsx(D,{type:"submit",children:l?"Update":"Create"})})]})]})]})]}),e.jsx(G,{children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ts,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(B,{placeholder:"Search staff...",className:"pl-10",value:r,onChange:p=>s(p.target.value)})]}),e.jsxs(D,{variant:"outline",children:[e.jsx(Ks,{className:"h-4 w-4 mr-2"}),"Filter"]}),q&&e.jsx(gs,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:["Staff Name","Email","Role"],optionalColumns:["Phone","Department"],validationRules:N,onImportComplete:p=>{p.successfulRows>0&&(f.invalidateQueries({queryKey:["staff"]}),d({title:"Import Successful",description:`${p.successfulRows} staff members imported successfully.`}))}},variant:"outline"}),b&&e.jsx(xs,{data:F.map(p=>({name:p.staff_name,email:p.email||"",phone:p.phone||"",role:p.role,department:p.department||"",isActive:p.status==="Active",createdAt:p.$createdAt})),headers:b.exportColumns.map(p=>p.exportHeader),filename:"staff",variant:"outline"})]})})}),e.jsxs(G,{children:[e.jsx(le,{children:e.jsxs(ce,{children:["Staff Members (",F.length,")"]})}),e.jsx(Z,{children:E?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:e.jsx("span",{children:"Loading staff..."})}):F.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("p",{className:"text-lg mb-2",children:"No staff found"}),e.jsx("p",{className:"text-sm",children:"Add your first staff member to get started"})]}):e.jsxs(ds,{children:[e.jsx(us,{children:e.jsxs(we,{children:[e.jsx(X,{children:"Staff Code"}),e.jsx(X,{children:"Staff Name"}),e.jsx(X,{children:"Role"}),e.jsx(X,{children:"Department"}),e.jsx(X,{children:"Email"}),e.jsx(X,{children:"Phone"}),e.jsx(X,{children:"Joining Date"}),e.jsx(X,{children:"Status"}),e.jsx(X,{children:"Actions"})]})}),e.jsx(ms,{children:F.map(p=>e.jsxs(we,{children:[e.jsx(Y,{className:"font-medium",children:p.staff_code}),e.jsx(Y,{children:p.staff_name}),e.jsx(Y,{children:p.role}),e.jsx(Y,{children:p.department||"-"}),e.jsx(Y,{children:p.email||"-"}),e.jsx(Y,{children:p.phone||"-"}),e.jsx(Y,{children:p.joining_date?new Date(p.joining_date).toLocaleDateString("en-GB"):"-"}),e.jsx(Y,{children:e.jsx(Ae,{variant:p.status==="Active"?"default":"secondary",children:p.status})}),e.jsx(Y,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(D,{variant:"outline",size:"sm",onClick:()=>V(p),children:e.jsx(Vs,{className:"h-4 w-4"})}),e.jsx(D,{variant:"outline",size:"sm",onClick:()=>w(p.$id),children:e.jsx(Ts,{className:"h-4 w-4"})})]})})]},p.$id))})]})})]})]})},Gl=()=>{const[r,s]=u.useState(""),[t,a]=u.useState("all"),[n,i]=u.useState(!1),[l,h]=u.useState(null),[c,o]=u.useState({name:"",department:"",description:"",status:"Active"}),{toast:d}=Ee(),f=is(),{config:b}=bs("processes"),{validationRules:N,canImport:q}=Ns("processes"),L={async getAll(){return(await Me.listDocuments(Oe,fe.PROCESSES)).documents},async create(F){return await Me.createDocument(Oe,fe.PROCESSES,at.unique(),F)},async update(F,p){return await Me.updateDocument(Oe,fe.PROCESSES,F,p)},async delete(F){return await Me.deleteDocument(Oe,fe.PROCESSES,F)}},{data:x=[],isLoading:C,error:E}=he({queryKey:["processes"],queryFn:async()=>await L.getAll()}),$=Ne({mutationFn:F=>{const{name:p,department:I}=F,j={process_name:p,department:I};return L.create(j)},onSuccess:()=>{f.invalidateQueries({queryKey:["processes"]}),d({title:"Success",description:"Process created successfully"}),i(!1),M()},onError:F=>{d({title:"Error",description:"Failed to create process",variant:"destructive"}),console.error("Error creating process:",F)}}),k=Ne({mutationFn:({id:F,data:p})=>{const{name:I,department:j}=p,P={process_name:I,department:j};return L.update(F,P)},onSuccess:()=>{f.invalidateQueries({queryKey:["processes"]}),d({title:"Success",description:"Process updated successfully"}),i(!1),M()},onError:F=>{d({title:"Error",description:"Failed to update process",variant:"destructive"}),console.error("Error updating process:",F)}}),R=Ne({mutationFn:F=>L.delete(F),onSuccess:()=>{f.invalidateQueries({queryKey:["processes"]}),d({title:"Success",description:"Process deleted successfully"})},onError:F=>{d({title:"Error",description:"Failed to delete process",variant:"destructive"}),console.error("Error deleting process:",F)}}),M=()=>{o({name:"",department:"",description:"",status:"Active"}),h(null)},S=F=>{if(F.preventDefault(),!c.name?.trim()){d({title:"Error",description:"Process Name is required",variant:"destructive"});return}if(!c.department.trim()){d({title:"Error",description:"Department is required",variant:"destructive"});return}l?k.mutate({id:l.$id,data:c}):$.mutate(c)},Q=F=>{h(F),o({name:F.process_name,department:F.department||"",description:F.description||"",status:F.status}),i(!0)},V=F=>{confirm("Are you sure you want to delete this process?")&&R.mutate(F)},w=()=>{h(null),M(),i(!0)},m=x.filter(F=>(F.process_name.toLowerCase().includes(r.toLowerCase())||F.department?.toLowerCase().includes(r.toLowerCase())||F.description?.toLowerCase().includes(r.toLowerCase()))&&(t==="all"||F.status===t));return E?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("p",{className:"text-red-500",children:["Error loading processes: ",E.message]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Processes"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage manufacturing and operational processes"})]}),e.jsxs(Qe,{open:n,onOpenChange:i,children:[e.jsx(lt,{asChild:!0,children:e.jsxs(D,{onClick:w,className:"bg-primary hover:bg-primary/90",children:[e.jsx(fs,{className:"h-4 w-4 mr-2"}),"Add New Process"]})}),e.jsxs(Ve,{className:"sm:max-w-[500px]",children:[e.jsxs(Be,{children:[e.jsx(ze,{children:l?"Edit Process":"Add New Process"}),e.jsxs(Ye,{children:[l?"Update process information":"Enter process details to add a new process",e.jsxs("span",{className:"mt-2 text-sm text-muted-foreground",children:["Fields marked with ",e.jsx("span",{className:"text-red-500",children:"*"})," are required."]})]})]}),e.jsxs("form",{onSubmit:S,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(_,{htmlFor:"name",className:"text-right",children:["Process Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(B,{id:"name",value:c.name,onChange:F=>o({...c,name:F.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(_,{htmlFor:"department",className:"text-right",children:["Department ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(te,{value:c.department||"",onValueChange:F=>o({...c,department:F}),children:[e.jsx(ee,{className:"col-span-3",children:e.jsx(ae,{placeholder:"Select department"})}),e.jsxs(se,{children:[e.jsx(v,{value:"Pre-Production",children:"Pre-Production"}),e.jsx(v,{value:"Production",children:"Production"}),e.jsx(v,{value:"Post Production",children:"Post Production"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-start gap-4",children:[e.jsx(_,{htmlFor:"description",className:"text-right mt-2",children:"Description"}),e.jsx(Hs,{id:"description",value:c.description,onChange:F=>o({...c,description:F.target.value}),className:"col-span-3",rows:3,placeholder:"Enter process description..."})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(_,{htmlFor:"status",className:"text-right",children:"Status"}),e.jsxs(te,{value:c.status,onValueChange:F=>o({...c,status:F}),children:[e.jsx(ee,{className:"col-span-3",children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"Active",children:"Active"}),e.jsx(v,{value:"Inactive",children:"Inactive"}),e.jsx(v,{value:"Under Review",children:"Under Review"})]})]})]})]}),e.jsx(He,{children:e.jsx(D,{type:"submit",children:l?"Update":"Create"})})]})]})]})]}),e.jsx(G,{children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ts,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(B,{placeholder:"Search processes...",className:"pl-10",value:r,onChange:F=>s(F.target.value)})]}),e.jsxs(D,{variant:"outline",children:[e.jsx(Ks,{className:"h-4 w-4 mr-2"}),"Filter"]}),q&&e.jsx(gs,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:["Process Name"],optionalColumns:["Description","Estimated Time (minutes)"],validationRules:N,onImportComplete:F=>{F.successfulRows>0&&(f.invalidateQueries({queryKey:["processes"]}),d({title:"Import Successful",description:`${F.successfulRows} processes imported successfully.`}))}},variant:"outline"}),b&&e.jsx(xs,{data:m.map(F=>({name:F.process_name,description:F.description||"",estimatedTime:0,isActive:F.status==="Active",createdAt:F.$createdAt})),headers:b.exportColumns.map(F=>F.exportHeader),filename:"processes",variant:"outline"})]})})}),e.jsxs(G,{children:[e.jsx(le,{children:e.jsxs(ce,{children:["Manufacturing Processes (",m.length,")"]})}),e.jsx(Z,{children:C?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:e.jsx("span",{children:"Loading processes..."})}):m.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("p",{className:"text-lg mb-2",children:"No processes found"}),e.jsx("p",{className:"text-sm",children:"Add your first process to get started"})]}):e.jsxs(ds,{children:[e.jsx(us,{children:e.jsxs(we,{children:[e.jsx(X,{children:"Process Name"}),e.jsx(X,{children:"Department"}),e.jsx(X,{children:"Description"}),e.jsx(X,{children:"Status"}),e.jsx(X,{children:"Actions"})]})}),e.jsx(ms,{children:m.map(F=>e.jsxs(we,{children:[e.jsx(Y,{className:"font-medium",children:F.process_name}),e.jsx(Y,{children:F.department||"-"}),e.jsx(Y,{className:"max-w-xs truncate",children:F.description||"-"}),e.jsx(Y,{children:e.jsx(Ae,{variant:F.status==="Active"?"default":F.status==="Under Review"?"secondary":"outline",children:F.status})}),e.jsx(Y,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(D,{variant:"outline",size:"sm",onClick:()=>Q(F),children:e.jsx(Vs,{className:"h-4 w-4"})}),e.jsx(D,{variant:"outline",size:"sm",onClick:()=>V(F.$id),children:e.jsx(Ts,{className:"h-4 w-4"})})]})})]},F.$id))})]})})]})]})},Jl=()=>{const[r,s]=u.useState(""),[t,a]=u.useState("all"),[n,i]=u.useState(!1),[l,h]=u.useState(null),[c,o]=u.useState({code:"",raw_product:"",uom:"",source:"Manufactured",status:"Active"}),{toast:d}=Ee(),f=is(),{config:b}=bs("raw-products"),{validationRules:N,canImport:q}=Ns("raw-products"),{data:L=[],isLoading:x,error:C}=he({queryKey:["rawProducts"],queryFn:async()=>await ht.getAll()}),E=Ne({mutationFn:m=>{const{code:F,raw_product:p,uom:I,source:j}=m,P={code:F,raw_product:p,uom:I,source:j};return ht.create(P)},onSuccess:()=>{f.invalidateQueries({queryKey:["rawProducts"]}),d({title:"Success",description:"Raw product created successfully"}),i(!1),R()},onError:m=>{d({title:"Error",description:"Failed to create raw product",variant:"destructive"}),console.error("Error creating raw product:",m)}}),$=Ne({mutationFn:({id:m,data:F})=>{const{code:p,raw_product:I,uom:j,source:P}=F,J={code:p,raw_product:I,uom:j,source:P};return ht.update(m,J)},onSuccess:()=>{f.invalidateQueries({queryKey:["rawProducts"]}),d({title:"Success",description:"Raw product updated successfully"}),i(!1),R()},onError:m=>{d({title:"Error",description:"Failed to update raw product",variant:"destructive"}),console.error("Error updating raw product:",m)}}),k=Ne({mutationFn:m=>ht.delete(m),onSuccess:()=>{f.invalidateQueries({queryKey:["rawProducts"]}),d({title:"Success",description:"Raw product deleted successfully"})},onError:m=>{d({title:"Error",description:"Failed to delete raw product",variant:"destructive"}),console.error("Error deleting raw product:",m)}}),R=()=>{o({code:"",raw_product:"",uom:"",source:"Manufactured",status:"Active"}),h(null)},M=m=>{if(m.preventDefault(),!c.code.trim()){d({title:"Error",description:"Code is required",variant:"destructive"});return}if(!c.raw_product.trim()){d({title:"Error",description:"Raw Product is required",variant:"destructive"});return}if(!c.uom.trim()){d({title:"Error",description:"UoM is required",variant:"destructive"});return}if(!c.source.trim()){d({title:"Error",description:"Source is required",variant:"destructive"});return}l?$.mutate({id:l.$id,data:c}):E.mutate(c)},S=m=>{h(m),o({code:m.code,raw_product:m.raw_product,uom:m.uom||"",source:m.source||"Manufactured",status:m.status}),i(!0)},Q=m=>{window.confirm("Are you sure you want to delete this raw product?")&&k.mutate(m)},V=()=>{h(null),R(),i(!0)},w=L.filter(m=>{const F=m.raw_product.toLowerCase().includes(r.toLowerCase())||m.code.toLowerCase().includes(r.toLowerCase())||m.source?.toLowerCase().includes(r.toLowerCase()),p=t==="all"||m.status===t;return F&&p});return C?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("p",{className:"text-red-500",children:["Error loading raw products: ",C.message]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Raw Products"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage raw materials and ingredients"})]}),e.jsxs(Qe,{open:n,onOpenChange:i,children:[e.jsx(lt,{asChild:!0,children:e.jsxs(D,{onClick:V,className:"bg-primary hover:bg-primary/90",children:[e.jsx(fs,{className:"h-4 w-4 mr-2"}),"Add New Raw Product"]})}),e.jsxs(Ve,{className:"sm:max-w-[500px]",children:[e.jsxs(Be,{children:[e.jsx(ze,{children:l?"Edit Raw Product":"Add New Raw Product"}),e.jsxs(Ye,{children:[l?"Update raw product information":"Enter raw product details to add a new material",e.jsxs("p",{className:"mt-2 text-sm text-muted-foreground",children:["Fields marked with ",e.jsx("span",{className:"text-red-500",children:"*"})," are required."]})]})]}),e.jsxs("form",{onSubmit:M,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(_,{htmlFor:"code",className:"text-right",children:["Code ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(B,{id:"code",value:c.code,onChange:m=>o({...c,code:m.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(_,{htmlFor:"raw_product",className:"text-right",children:["Raw Product ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(B,{id:"raw_product",value:c.raw_product,onChange:m=>o({...c,raw_product:m.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(_,{htmlFor:"uom",className:"text-right",children:["UoM ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(te,{value:c.uom,onValueChange:m=>o({...c,uom:m}),children:[e.jsx(ee,{className:"col-span-3",children:e.jsx(ae,{placeholder:"Select unit of measure"})}),e.jsxs(se,{children:[e.jsx(v,{value:"kg",children:"Kilogram (kg)"}),e.jsx(v,{value:"g",children:"Gram (g)"}),e.jsx(v,{value:"l",children:"Liter (l)"}),e.jsx(v,{value:"ml",children:"Milliliter (ml)"}),e.jsx(v,{value:"pcs",children:"Pieces (pcs)"}),e.jsx(v,{value:"box",children:"Box"}),e.jsx(v,{value:"bag",children:"Bag"}),e.jsx(v,{value:"ton",children:"Ton"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(_,{htmlFor:"source",className:"text-right",children:["Source ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(te,{value:c.source,onValueChange:m=>o({...c,source:m}),children:[e.jsx(ee,{className:"col-span-3",children:e.jsx(ae,{placeholder:"Select source type"})}),e.jsxs(se,{children:[e.jsx(v,{value:"Manufactured",children:"Manufactured"}),e.jsx(v,{value:"Purchased",children:"Purchased"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(_,{htmlFor:"status",className:"text-right",children:"Status"}),e.jsxs(te,{value:c.status,onValueChange:m=>o({...c,status:m}),children:[e.jsx(ee,{className:"col-span-3",children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"Active",children:"Active"}),e.jsx(v,{value:"Inactive",children:"Inactive"}),e.jsx(v,{value:"Discontinued",children:"Discontinued"})]})]})]})]}),e.jsx(He,{children:e.jsx(D,{type:"submit",children:l?"Update":"Create"})})]})]})]})]}),e.jsx(G,{children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ts,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(B,{placeholder:"Search raw products...",className:"pl-10",value:r,onChange:m=>s(m.target.value)})]}),e.jsxs(D,{variant:"outline",children:[e.jsx(Ks,{className:"h-4 w-4 mr-2"}),"Filter"]}),q&&e.jsx(gs,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:["Raw Product Name","SKU","Unit"],optionalColumns:["Cost Per Unit","Description"],validationRules:N,onImportComplete:m=>{m.successfulRows>0&&(f.invalidateQueries({queryKey:["rawProducts"]}),d({title:"Import Successful",description:`${m.successfulRows} raw products imported successfully.`}))}},variant:"outline"}),b&&e.jsx(xs,{data:w.map(m=>({name:m.raw_product,sku:m.code,unit:m.uom||"",costPerUnit:0,description:"",createdAt:m.$createdAt})),headers:b.exportColumns.map(m=>m.exportHeader),filename:"raw-products",variant:"outline"})]})})}),e.jsxs(G,{children:[e.jsx(le,{children:e.jsxs(ce,{children:["Raw Materials (",w.length,")"]})}),e.jsx(Z,{children:x?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:e.jsx("span",{children:"Loading raw products..."})}):w.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("p",{className:"text-lg mb-2",children:"No raw products found"}),e.jsx("p",{className:"text-sm",children:"Add your first raw product to get started"})]}):e.jsxs(ds,{children:[e.jsx(us,{children:e.jsxs(we,{children:[e.jsx(X,{children:"Code"}),e.jsx(X,{children:"Raw Product"}),e.jsx(X,{children:"UoM"}),e.jsx(X,{children:"Source"}),e.jsx(X,{children:"Status"}),e.jsx(X,{children:"Actions"})]})}),e.jsx(ms,{children:w.map(m=>e.jsxs(we,{children:[e.jsx(Y,{className:"font-medium",children:m.code}),e.jsx(Y,{children:m.raw_product}),e.jsx(Y,{children:m.uom||"-"}),e.jsx(Y,{children:m.source&&e.jsx(Ae,{variant:m.source==="Manufactured"?"default":"secondary",children:m.source})}),e.jsx(Y,{children:e.jsx(Ae,{variant:m.status==="Active"?"default":m.status==="Discontinued"?"destructive":"secondary",children:m.status})}),e.jsx(Y,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(D,{variant:"outline",size:"sm",onClick:()=>S(m),children:e.jsx(Vs,{className:"h-4 w-4"})}),e.jsx(D,{variant:"outline",size:"sm",onClick:()=>Q(m.$id),children:e.jsx(Ts,{className:"h-4 w-4"})})]})})]},m.$id))})]})})]})]})},Xl=()=>{const[r,s]=u.useState(""),[t,a]=u.useState("all"),[n,i]=u.useState(!1),[l,h]=u.useState(null),[c,o]=u.useState({sku:"",name:"",uom:"",min_level:"",status:"Active"}),{toast:d}=Ee(),f=is(),{user:b}=os(),{config:N}=bs("products"),{validationRules:q,canImport:L}=Ns("products"),{currentSort:x,handleSort:C,getSortedData:E}=Bs(),{data:$=[],isLoading:k,error:R}=he({queryKey:["products"],queryFn:async()=>await Is.getAll(),enabled:!!b}),M=Ne({mutationFn:P=>{const{sku:J,name:A,uom:H,min_level:U}=P,ie={sku:J,product:A,uom:H,min_level:U};return Is.create(ie)},onSuccess:()=>{f.invalidateQueries({queryKey:["products"]}),d({title:"Success",description:"Product created successfully"}),i(!1),V()},onError:P=>{d({title:"Error",description:"Failed to create product",variant:"destructive"}),console.error("Error creating product:",P)}}),S=Ne({mutationFn:({id:P,data:J})=>{const{sku:A,name:H,uom:U,min_level:ie}=J,me={sku:A,product:H,uom:U,min_level:ie};return Is.update(P,me)},onSuccess:()=>{f.invalidateQueries({queryKey:["products"]}),d({title:"Success",description:"Product updated successfully"}),i(!1),V()},onError:P=>{d({title:"Error",description:"Failed to update product",variant:"destructive"}),console.error("Error updating product:",P)}}),Q=Ne({mutationFn:P=>Is.delete(P),onSuccess:()=>{f.invalidateQueries({queryKey:["products"]}),d({title:"Success",description:"Product deleted successfully"})},onError:P=>{d({title:"Error",description:"Failed to delete product",variant:"destructive"}),console.error("Error deleting product:",P)}}),V=()=>{o({sku:"",name:"",uom:"",min_level:"",status:"Active"}),h(null)},w=P=>{if(P.preventDefault(),!c.sku?.trim()){d({title:"Error",description:"SKU is required",variant:"destructive"});return}if(!c.name?.trim()){d({title:"Error",description:"Product Name is required",variant:"destructive"});return}if(!c.uom?.trim()){d({title:"Error",description:"Unit of Measure is required",variant:"destructive"});return}if(!c.min_level?.trim()){d({title:"Error",description:"Minimum Level is required",variant:"destructive"});return}const J={...c,min_level:c.min_level?parseInt(c.min_level):void 0};l?S.mutate({id:l.$id,data:J}):M.mutate(J)},m=P=>{h(P),o({sku:P.sku,name:P.product,uom:P.uom||"",min_level:P.min_level?.toString()||"",status:P.status}),i(!0)},F=P=>{confirm("Are you sure you want to delete this product?")&&Q.mutate(P)},p=()=>{h(null),V(),i(!0)},I=$.filter(P=>{const J=P.product.toLowerCase().includes(r.toLowerCase())||P.sku.toLowerCase().includes(r.toLowerCase()),A=t==="all"||P.status===t;return J&&A}),j=E(I);return R?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("p",{className:"text-red-500",children:["Error loading products: ",R.message]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Products"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage finished products and inventory"})]}),e.jsxs(Qe,{open:n,onOpenChange:i,children:[e.jsx(lt,{asChild:!0,children:e.jsxs(D,{onClick:p,className:"bg-primary hover:bg-primary/90",children:[e.jsx(fs,{className:"h-4 w-4 mr-2"}),"Add New Product"]})}),e.jsxs(Ve,{className:"sm:max-w-[500px]",children:[e.jsxs(Be,{children:[e.jsx(ze,{children:l?"Edit Product":"Add New Product"}),e.jsxs(Ye,{children:[l?"Update product information":"Enter product details to add a new finished product",e.jsxs("span",{className:"mt-2 text-sm text-muted-foreground",children:["Fields marked with ",e.jsx("span",{className:"text-red-500",children:"*"})," are required."]})]})]}),e.jsxs("form",{onSubmit:w,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(_,{htmlFor:"sku",className:"text-right",children:["SKU ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(B,{id:"sku",value:c.sku,onChange:P=>o({...c,sku:P.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(_,{htmlFor:"product",className:"text-right",children:["Product ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(B,{id:"product",value:c.name,onChange:P=>o({...c,name:P.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(_,{htmlFor:"uom",className:"text-right",children:["UoM ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(te,{value:c.uom,onValueChange:P=>o({...c,uom:P}),children:[e.jsx(ee,{className:"col-span-3",children:e.jsx(ae,{placeholder:"Select unit of measure"})}),e.jsxs(se,{children:[e.jsx(v,{value:"kg",children:"Kilogram (kg)"}),e.jsx(v,{value:"g",children:"Gram (g)"}),e.jsx(v,{value:"l",children:"Liter (l)"}),e.jsx(v,{value:"ml",children:"Milliliter (ml)"}),e.jsx(v,{value:"pcs",children:"Pieces (pcs)"}),e.jsx(v,{value:"box",children:"Box"}),e.jsx(v,{value:"pack",children:"Pack"}),e.jsx(v,{value:"bottle",children:"Bottle"}),e.jsx(v,{value:"can",children:"Can"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(_,{htmlFor:"min_level",className:"text-right",children:["Min Level ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(B,{id:"min_level",type:"number",value:c.min_level,onChange:P=>o({...c,min_level:P.target.value}),className:"col-span-3",min:"0",placeholder:"Minimum stock level"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(_,{htmlFor:"status",className:"text-right",children:"Status"}),e.jsxs(te,{value:c.status,onValueChange:P=>o({...c,status:P}),children:[e.jsx(ee,{className:"col-span-3",children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"Active",children:"Active"}),e.jsx(v,{value:"Inactive",children:"Inactive"}),e.jsx(v,{value:"Discontinued",children:"Discontinued"})]})]})]})]}),e.jsx(He,{children:e.jsx(D,{type:"submit",children:l?"Update":"Create"})})]})]})]})]}),e.jsx(G,{children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ts,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(B,{placeholder:"Search products...",className:"pl-10",value:r,onChange:P=>s(P.target.value)})]}),e.jsxs(D,{variant:"outline",children:[e.jsx(Ks,{className:"h-4 w-4 mr-2"}),"Filter"]}),L&&e.jsx(gs,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:["Product Name","SKU"],optionalColumns:["Category","Price","Description"],validationRules:q,onImportComplete:P=>{P.successfulRows>0&&(f.invalidateQueries({queryKey:["products"]}),d({title:"Import Successful",description:`${P.successfulRows} products imported successfully.`}))}},variant:"outline"}),N&&e.jsx(xs,{data:I.map(P=>({name:P.product,sku:P.sku,category:"",price:0,description:"",isActive:P.status==="Active",createdAt:P.$createdAt})),headers:N.exportColumns.map(P=>P.exportHeader),filename:"products",variant:"outline"})]})})}),e.jsxs(G,{children:[e.jsx(le,{children:e.jsxs(ce,{children:["Finished Products (",I.length,")"]})}),e.jsx(Z,{children:e.jsx(Gs,{data:j.map(P=>({...P,sku:P.sku||"",product:P.product||"",uom:P.uom||"-",min_level:P.min_level||0,status:P.status||"Active"})),columns:[{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"product",label:"Product Name",sortable:!0,dataType:"string"},{key:"uom",label:"UoM",sortable:!0,dataType:"string"},{key:"min_level",label:"Min Level",sortable:!0,dataType:"number",align:"right"},{key:"status",label:"Status",sortable:!0,dataType:"string"}],onSort:C,currentSort:x,loading:k,emptyMessage:"No products found",actions:[{label:"Edit",icon:e.jsx(Vs,{className:"h-4 w-4"}),onClick:m},{label:"Delete",icon:e.jsx(Ts,{className:"h-4 w-4"}),onClick:P=>F(P.$id),variant:"destructive"}]})})]})]})},Zl=()=>{const[r,s]=u.useState(""),[t,a]=u.useState("all"),[n,i]=u.useState(!1),[l,h]=u.useState(null),[c,o]=u.useState({channel_name:"",description:"",type:"Online",contact_person:"",phone:"",email:"",status:"Active"}),{toast:d}=Ee(),f=is(),{config:b}=bs("sales-channels"),{validationRules:N,canImport:q}=Ns("sales-channels"),{data:L=[],isLoading:x,error:C}=he({queryKey:["salesChannels"],queryFn:async()=>await Tt.getAll()}),E=Ne({mutationFn:m=>{const{channel_name:F,type:p,email:I}=m,j={channel_name:F,type:p};return I&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(I)&&(j.email=I),Tt.create(j)},onSuccess:()=>{f.invalidateQueries({queryKey:["salesChannels"]}),d({title:"Success",description:"Sales channel created successfully"}),i(!1),R()},onError:m=>{d({title:"Error",description:"Failed to create sales channel",variant:"destructive"}),console.error("Error creating sales channel:",m)}}),$=Ne({mutationFn:({id:m,data:F})=>{const{channel_name:p,type:I,email:j}=F,P={channel_name:p,type:I};return j&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(j)&&(P.email=j),Tt.update(m,P)},onSuccess:()=>{f.invalidateQueries({queryKey:["salesChannels"]}),d({title:"Success",description:"Sales channel updated successfully"}),i(!1),R()},onError:m=>{d({title:"Error",description:"Failed to update sales channel",variant:"destructive"}),console.error("Error updating sales channel:",m)}}),k=Ne({mutationFn:m=>Tt.delete(m),onSuccess:()=>{f.invalidateQueries({queryKey:["salesChannels"]}),d({title:"Success",description:"Sales channel deleted successfully"})},onError:m=>{d({title:"Error",description:"Failed to delete sales channel",variant:"destructive"}),console.error("Error deleting sales channel:",m)}}),R=()=>{o({channel_name:"",description:"",type:"Online",contact_person:"",phone:"",email:"",status:"Active"}),h(null)},M=m=>{if(m.preventDefault(),!c.channel_name.trim()){d({title:"Error",description:"Channel Name is required",variant:"destructive"});return}if(!c.type.trim()){d({title:"Error",description:"Type is required",variant:"destructive"});return}if(c.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(c.email)){d({title:"Error",description:"Please enter a valid email address",variant:"destructive"});return}l?$.mutate({id:l.$id,data:c}):E.mutate(c)},S=m=>{h(m),o({channel_name:m.channel_name,description:m.description||"",type:m.type||"Online",contact_person:m.contact_person||"",phone:m.phone||"",email:m.email||"",status:m.status}),i(!0)},Q=m=>{confirm("Are you sure you want to delete this sales channel?")&&k.mutate(m)},V=()=>{h(null),R(),i(!0)},w=L.filter(m=>{const F=m.channel_name.toLowerCase().includes(r.toLowerCase())||m.type?.toLowerCase().includes(r.toLowerCase())||m.contact_person?.toLowerCase().includes(r.toLowerCase()),p=t==="all"||m.status===t;return F&&p});return C?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("p",{className:"text-red-500",children:["Error loading sales channels: ",C.message]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Sales Channels"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage sales distribution channels and partners"})]}),e.jsxs(Qe,{open:n,onOpenChange:i,children:[e.jsx(lt,{asChild:!0,children:e.jsxs(D,{onClick:V,className:"bg-primary hover:bg-primary/90",children:[e.jsx(fs,{className:"h-4 w-4 mr-2"}),"Add New Channel"]})}),e.jsxs(Ve,{className:"sm:max-w-[500px]",children:[e.jsxs(Be,{children:[e.jsx(ze,{children:l?"Edit Sales Channel":"Add New Sales Channel"}),e.jsxs(Ye,{children:[l?"Update sales channel information":"Enter sales channel details to add a new distribution partner",e.jsxs("p",{className:"mt-2 text-sm text-muted-foreground",children:["Fields marked with ",e.jsx("span",{className:"text-red-500",children:"*"})," are required."]})]})]}),e.jsxs("form",{onSubmit:M,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(_,{htmlFor:"channel_name",className:"text-right",children:["Channel Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(B,{id:"channel_name",value:c.channel_name,onChange:m=>o({...c,channel_name:m.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-start gap-4",children:[e.jsx(_,{htmlFor:"description",className:"text-right mt-2",children:"Description"}),e.jsx(Hs,{id:"description",value:c.description,onChange:m=>o({...c,description:m.target.value}),className:"col-span-3",rows:3,placeholder:"Enter channel description..."})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(_,{htmlFor:"type",className:"text-right",children:["Type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(te,{value:c.type,onValueChange:m=>o({...c,type:m}),children:[e.jsx(ee,{className:"col-span-3",children:e.jsx(ae,{placeholder:"Select channel type"})}),e.jsxs(se,{children:[e.jsx(v,{value:"Online",children:"Online"}),e.jsx(v,{value:"Retail",children:"Retail"}),e.jsx(v,{value:"Wholesale",children:"Wholesale"}),e.jsx(v,{value:"Direct Sales",children:"Direct Sales"}),e.jsx(v,{value:"Distributor",children:"Distributor"}),e.jsx(v,{value:"E-commerce",children:"E-commerce"}),e.jsx(v,{value:"Export",children:"Export"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(_,{htmlFor:"contact_person",className:"text-right",children:"Contact Person"}),e.jsx(B,{id:"contact_person",value:c.contact_person,onChange:m=>o({...c,contact_person:m.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(_,{htmlFor:"phone",className:"text-right",children:"Phone"}),e.jsx(B,{id:"phone",value:c.phone,onChange:m=>o({...c,phone:m.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(_,{htmlFor:"email",className:"text-right",children:"Email"}),e.jsx(B,{id:"email",type:"email",value:c.email,onChange:m=>o({...c,email:m.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(_,{htmlFor:"status",className:"text-right",children:"Status"}),e.jsxs(te,{value:c.status,onValueChange:m=>o({...c,status:m}),children:[e.jsx(ee,{className:"col-span-3",children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"Active",children:"Active"}),e.jsx(v,{value:"Inactive",children:"Inactive"}),e.jsx(v,{value:"Pending",children:"Pending"})]})]})]})]}),e.jsx(He,{children:e.jsx(D,{type:"submit",children:l?"Update":"Create"})})]})]})]})]}),e.jsx(G,{children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ts,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(B,{placeholder:"Search sales channels...",className:"pl-10",value:r,onChange:m=>s(m.target.value)})]}),e.jsxs(D,{variant:"outline",children:[e.jsx(Ks,{className:"h-4 w-4 mr-2"}),"Filter"]}),q&&e.jsx(gs,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:["Channel Name","Type"],optionalColumns:["Commission (%)","Description"],validationRules:N,onImportComplete:m=>{m.successfulRows>0&&(f.invalidateQueries({queryKey:["salesChannels"]}),d({title:"Import Successful",description:`${m.successfulRows} sales channels imported successfully.`}))}},variant:"outline"}),b&&e.jsx(xs,{data:w.map(m=>({name:m.channel_name,type:m.type||"",commission:0,description:m.description||"",isActive:m.status==="Active",createdAt:m.$createdAt})),headers:b.exportColumns.map(m=>m.exportHeader),filename:"sales-channels",variant:"outline"})]})})}),e.jsxs(G,{children:[e.jsx(le,{children:e.jsxs(ce,{children:["Distribution Channels (",w.length,")"]})}),e.jsx(Z,{children:x?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:e.jsx("span",{children:"Loading sales channels..."})}):w.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("p",{className:"text-lg mb-2",children:"No sales channels found"}),e.jsx("p",{className:"text-sm",children:"Add your first sales channel to get started"})]}):e.jsxs(ds,{children:[e.jsx(us,{children:e.jsxs(we,{children:[e.jsx(X,{children:"Channel Name"}),e.jsx(X,{children:"Description"}),e.jsx(X,{children:"Type"}),e.jsx(X,{children:"Contact Person"}),e.jsx(X,{children:"Phone"}),e.jsx(X,{children:"Email"}),e.jsx(X,{children:"Status"}),e.jsx(X,{children:"Actions"})]})}),e.jsx(ms,{children:w.map(m=>e.jsxs(we,{children:[e.jsx(Y,{className:"font-medium",children:m.channel_name}),e.jsx(Y,{className:"max-w-xs truncate",children:m.description||"-"}),e.jsx(Y,{children:m.type&&e.jsx(Ae,{variant:"outline",children:m.type})}),e.jsx(Y,{children:m.contact_person||"-"}),e.jsx(Y,{children:m.phone||"-"}),e.jsx(Y,{children:m.email||"-"}),e.jsx(Y,{children:e.jsx(Ae,{variant:m.status==="Active"?"default":m.status==="Pending"?"secondary":"outline",children:m.status})}),e.jsx(Y,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(D,{variant:"outline",size:"sm",onClick:()=>S(m),children:e.jsx(Vs,{className:"h-4 w-4"})}),e.jsx(D,{variant:"outline",size:"sm",onClick:()=>Q(m.$id),children:e.jsx(Ts,{className:"h-4 w-4"})})]})})]},m.$id))})]})})]})]})},Rn=(r,s,t={})=>{const{category:a,searchTerm:n}=t,i=r?qt(r,1):void 0,l=r?Xe(r,"yyyy-MM-dd"):void 0,h=s?Xe(s,"yyyy-MM-dd"):void 0,c=i?Xe(i,"yyyy-MM-dd"):void 0,{data:o=[],isLoading:d}=he({queryKey:["stocks"],queryFn:()=>Fs.getAll(),staleTime:600*1e3}),{data:f=[],isLoading:b}=he({queryKey:["processes"],queryFn:()=>ot.getAll(),staleTime:600*1e3}),{data:N=[],isLoading:q}=he({queryKey:["purchases",l,h],queryFn:()=>zs.getByDateRange(r,s),enabled:!!r&&!!s,staleTime:300*1e3}),{data:L=[]}=he({queryKey:["purchasesBefore",c],queryFn:()=>zs.getByDateRange(void 0,i),enabled:!!i,staleTime:300*1e3}),{data:x=[],isLoading:C}=he({queryKey:["cleaning-tasks",l,h],queryFn:async()=>(await jt.getByDateRange(r,s)).filter(M=>(M.process_name?.toLowerCase()||"").includes("cleaning")),enabled:!!r&&!!s,staleTime:300*1e3}),{data:E=[]}=he({queryKey:["cleaning-tasksBefore",c],queryFn:async()=>(await jt.getByDateRange(void 0,i)).filter(M=>(M.process_name?.toLowerCase()||"").includes("cleaning")),enabled:!!i,staleTime:300*1e3});return{stockStatus:u.useMemo(()=>o.length?o.filter(R=>{if(a&&a!=="all"&&(R.category||R.Category)!==a)return!1;if(n){const M=n.toLowerCase();if(!(R.stock_name?.toLowerCase()||"").includes(M))return!1}return!0}).map(R=>{const M=L.filter(I=>I.stock_id===R.$id).reduce((I,j)=>I+(Number(j.quantity)||0),0),S=E.filter(I=>I.stock_id===R.$id&&I.status==="completed").reduce((I,j)=>I+(Number(j.assigned_quantity)||0),0),Q=M-S,V=N.filter(I=>I.stock_id===R.$id).reduce((I,j)=>I+(Number(j.quantity)||0),0),w=x.filter(I=>I.stock_id===R.$id&&I.status==="completed").reduce((I,j)=>I+(Number(j.assigned_quantity)||0),0),m=Q+V-w,F=R.min_level||0;let p="In Stock";return m<=0?p="Out of Stock":m<F&&(p="Low Stock"),{stock_id:R.$id,stock_name:R.stock_name,category:R.category||R.Category,opening_balance:Q,purchases:V,utilised:w,closing_balance:m,min_level:F,status:p}}):[],[o,N,L,x,E,a,n]),isLoading:d||b||q||C,error:null}},ec=()=>{const{data:r,isLoading:s,error:t}=he({queryKey:["stock-categories"],queryFn:()=>Fs.getCategories()});return{categories:r,isLoading:s,error:t}},sc=()=>{const[r,s]=u.useState({from:Us(new Date),to:Os(new Date)}),[t,a]=u.useState(void 0),[n,i]=u.useState(""),{toast:l}=Ee(),h=is(),{stockStatus:c,isLoading:o}=Rn(r?.from,r?.to,{category:t,searchTerm:n}),{categories:d}=ec(),f=async()=>{try{await h.invalidateQueries({queryKey:["stocks"]}),await h.invalidateQueries({queryKey:["purchases"]}),await h.invalidateQueries({queryKey:["tasks"]}),l({title:"Stock Data Refreshed",description:"Data updated successfully"})}catch{l({title:"Refresh Failed",description:"Please try again",variant:"destructive"})}};return e.jsxs(G,{children:[e.jsxs(le,{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(ce,{children:"Stock Status"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(D,{variant:"outline",onClick:f,disabled:o,children:[e.jsx(Pa,{className:`h-4 w-4 mr-1 ${o?"animate-spin":""}`}),"Refresh Data"]}),e.jsx(D,{variant:"outline",children:"Export"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-4",children:[e.jsx(St,{value:r,onChange:s,className:"w-[300px]"}),e.jsxs(te,{onValueChange:a,value:t,children:[e.jsx(ee,{className:"w-[180px]",children:e.jsx(ae,{placeholder:"All Categories"})}),e.jsxs(se,{children:[e.jsx(v,{value:"all",children:"All Categories"}),d?.map(b=>e.jsx(v,{value:b,children:b},b))]})]}),e.jsx(B,{placeholder:"Search...",className:"w-[200px]",value:n,onChange:b=>i(b.target.value)})]})]}),e.jsx(Z,{children:e.jsxs(ds,{children:[e.jsx(us,{children:e.jsxs(we,{children:[e.jsx(X,{children:"Stock Name"}),e.jsx(X,{children:"Category"}),e.jsx(X,{className:"text-right",children:"Opening Balance"}),e.jsx(X,{className:"text-right bg-purple-50",children:"Purchases"}),e.jsx(X,{className:"text-right bg-green-50",children:"Utilised"}),e.jsx(X,{className:"text-right",children:"Closing Balance"}),e.jsx(X,{className:"text-right",children:"Min Level"}),e.jsx(X,{children:"Status"})]})}),e.jsx(ms,{children:o?e.jsx(we,{children:e.jsxs(Y,{colSpan:8,className:"text-center py-12",children:[e.jsx(Re,{className:"h-8 w-8 animate-spin mx-auto mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading stock status..."})]})}):c.length===0?e.jsx(we,{children:e.jsx(Y,{colSpan:8,className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"No stock data found for the selected criteria"})})}):c.map((b,N)=>e.jsxs(we,{children:[e.jsx(Y,{children:b.stock_name}),e.jsx(Y,{children:b.category||"N/A"}),e.jsx(Y,{className:"text-right",children:(b.opening_balance||0).toLocaleString()}),e.jsx(Y,{className:"text-right bg-purple-50 font-medium",children:(b.purchases||0).toLocaleString()}),e.jsx(Y,{className:"text-right bg-green-50 font-medium",children:(b.utilised||0).toLocaleString()}),e.jsx(Y,{className:"text-right font-semibold",children:e.jsx("span",{className:(b.closing_balance||0)<0?"text-red-600":"text-green-600",children:(b.closing_balance||0).toLocaleString()})}),e.jsx(Y,{className:"text-right text-muted-foreground",children:(b.min_level||0).toLocaleString()}),e.jsx(Y,{children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${b.status==="Out of Stock"?"bg-red-100 text-red-800":b.status==="Low Stock"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:b.status||"In Stock"})})]},b.stock_id||`stock-${N}`))})]})})]})},$a=(r,s,t={})=>{const{processId:a}=t,n=r?As(r):void 0,i=s?As(s):void 0,l=n?qt(n,1):void 0,h=n?Xe(n,"yyyy-MM-dd"):void 0,c=i?Xe(i,"yyyy-MM-dd"):void 0,o=l?Xe(l,"yyyy-MM-dd"):void 0,{data:d=[],isLoading:f}=he({queryKey:["stocks"],queryFn:()=>Fs.getAll(),staleTime:600*1e3}),{data:b=[],isLoading:N}=he({queryKey:["processes"],queryFn:()=>ot.getAll(),staleTime:600*1e3}),{data:q=[],isLoading:L}=he({queryKey:["preProductionTasks",h,c],queryFn:()=>jt.getByDateRange(n,i),enabled:!!n&&!!i,staleTime:300*1e3}),{data:x=[]}=he({queryKey:["preProductionTasksBefore",o],queryFn:()=>jt.getByDateRange(void 0,l),enabled:!!l,staleTime:300*1e3}),{data:C=[]}=he({queryKey:["productionTasksForPreStatus",h,c],queryFn:()=>Ys.getProductionTasksWithRelations(h,c),enabled:!!n&&!!i,staleTime:300*1e3}),{data:E=[]}=he({queryKey:["productionTasksBeforeForPreStatus",o],queryFn:()=>Ys.getProductionTasksWithRelations(void 0,o),enabled:!!l,staleTime:300*1e3});return{statusRecords:u.useMemo(()=>{if(!d.length||!b.length)return[];new Map(b.map(w=>[w.$id,w.process_name]));const R=["cleaning","c & d","roasting","rfp"],M=a?b.filter(w=>{const m=w.process_name?.toLowerCase();return w.$id===a&&R.includes(m)}):b.filter(w=>{const m=w.process_name?.toLowerCase();return R.includes(m)}),S=w=>{if(!w)return!n&&!i;if(!n&&!i)return!0;const m=As(w),F=n?m>=n:!0,p=i?m<=i:!0;return F&&p},Q=w=>!w||!l?!1:As(w)<=l;return d.flatMap(w=>M.map(m=>{const F=w.stock_name,p=m.process_name;if(!F||!p)return null;const j=x.filter(xe=>xe.stock_id===w.$id&&xe.process_id===m.$id&&xe.status==="completed"&&Q(xe.date_completed||xe.date_assigned)).reduce((xe,ke)=>{const ns=ke.completed_quantity!==void 0&&ke.completed_quantity!==null?Number(ke.completed_quantity):Number(ke.assigned_quantity)||0,We=Number(ke.wastage_quantity)||0;return xe+(ns-We)},0),P=x.filter(xe=>xe.stock_id===w.$id&&xe.stock_source===p&&Q(xe.date_assigned)).reduce((xe,ke)=>xe+(Number(ke.assigned_quantity)||0),0),J=E.filter(xe=>xe.source_process_id===m.$id).reduce((xe,ke)=>{const We=(ke.stock_items||[]).filter(Ge=>Ge.stock_id===w.$id).reduce((Ge,T)=>Ge+(Number(T.quantity)||0),0);return xe+We},0),A=P+J,H=j-A,U=q.filter(xe=>xe.stock_id===w.$id&&xe.process_id===m.$id&&S(xe.date_assigned)),ie=U.filter(xe=>xe.status==="completed").reduce((xe,ke)=>{const ns=ke.completed_quantity!==void 0&&ke.completed_quantity!==null?Number(ke.completed_quantity):Number(ke.assigned_quantity)||0,We=Number(ke.wastage_quantity)||0;return xe+(ns-We)},0),me=U.reduce((xe,ke)=>xe+(Number(ke.wastage_quantity)||0),0),ve=q.filter(xe=>xe.stock_id===w.$id&&xe.stock_source===p&&S(xe.date_assigned)).reduce((xe,ke)=>xe+(Number(ke.assigned_quantity)||0),0),z=C.filter(xe=>xe.source_process_id===m.$id).reduce((xe,ke)=>{const We=(ke.stock_items||[]).filter(Ge=>Ge.stock_id===w.$id).reduce((Ge,T)=>Ge+(Number(T.quantity)||0),0);return xe+We},0),pe=ve+z,ge=H+ie-pe,Pe=w.min_level||0;let Ze="In Stock";return ge<=0?Ze="Out of Stock":ge<Pe&&(Ze="Low Stock"),{stock_name:F,process:p,opening_balance:H,effective_completed:ie,wastage_qty:me,utilised:pe,closing_balance:ge,min_level:Pe,status:Ze}}).filter(m=>m!==null)).filter(Boolean)},[d,b,q,x,C,E,a,n,i,l]),isLoading:f||N||L,error:null}},An=()=>{const{data:r=[],isLoading:s,error:t}=he({queryKey:["stocks"],queryFn:async()=>await Fs.getAll()});return{data:r,isLoading:s,error:t}},La=()=>{const{data:r=[],isLoading:s,error:t}=he({queryKey:["staff"],queryFn:async()=>await kl.getAll(),staleTime:3e5,gcTime:9e5,refetchOnWindowFocus:!1});return{data:r,isLoading:s,error:t}},Js=()=>{const{data:r=[],isLoading:s,error:t}=he({queryKey:["processes"],queryFn:async()=>await ot.getAll(),staleTime:3e5,gcTime:9e5,refetchOnWindowFocus:!1});return{data:r,isLoading:s,error:t}},tc=()=>{const{data:r=[],isLoading:s,error:t}=he({queryKey:["products"],queryFn:async()=>await Is.getAll(),staleTime:3e5,gcTime:9e5,refetchOnWindowFocus:!1});return{data:r,isLoading:s,error:t}},qn=()=>{const{data:r=[],isLoading:s,error:t}=he({queryKey:["rawProducts"],queryFn:async()=>await ht.getAll(),staleTime:3e5,gcTime:9e5,refetchOnWindowFocus:!1});return{data:r,isLoading:s,error:t}},ac=()=>{const r=is(),[s,t]=u.useState(""),[a,n]=u.useState({from:Us(new Date),to:Os(new Date)}),[i,l]=u.useState(""),{data:h}=Js(),c=a.from?Xe(a.from,"yyyy-MM-dd"):void 0,o=a.to?Xe(a.to,"yyyy-MM-dd"):void 0,{toast:d}=Ee(),{statusRecords:f,isLoading:b}=$a(c,o,{processId:i||void 0}),N=u.useMemo(()=>f?f.filter(x=>(x.stock_name||"").toLowerCase().includes(s.toLowerCase())||(x.process||"").toLowerCase().includes(s.toLowerCase())):[],[f,s]),q=async()=>{try{await r.invalidateQueries({queryKey:["stocks"]}),await r.invalidateQueries({queryKey:["processes"]}),await r.invalidateQueries({queryKey:["preProductionTasks"]}),await r.invalidateQueries({queryKey:["productionTasksForPreStatus"]}),d({title:"Pre-Production Data Refreshed",description:"Data updated successfully"})}catch{d({title:"Refresh Failed",description:"Please try again",variant:"destructive"})}},L=()=>{const C=[["Stock Name","Process","Opening Balance","Effective Completed","Wastage Qty","Utilised","Closing Balance","Min Level","Status"].join(","),...N.map(M=>[`"${M.stock_name}"`,`"${M.process}"`,M.opening_balance.toFixed(2),M.effective_completed.toFixed(2),M.wastage_qty.toFixed(2),M.utilised.toFixed(2),M.closing_balance.toFixed(2),(M.min_level||0).toFixed(2),`"${M.status||"In Stock"}"`].join(","))].join(`
`),E=new Blob([C],{type:"text/csv;charset=utf-8;"}),$=URL.createObjectURL(E),k=document.createElement("a");k.setAttribute("href",$);const R=c&&o?`_${c}_to_${o}`:"";k.setAttribute("download",`pre-production-status${R}_${new Date().toISOString().split("T")[0]}.csv`),k.style.visibility="hidden",document.body.appendChild(k),k.click(),document.body.removeChild(k)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Pre-Production Status"}),e.jsx("p",{className:"text-muted-foreground",children:"Track material flow through pre-production stages"})]}),e.jsx(G,{children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("div",{className:"relative w-full md:w-auto",children:[e.jsx(ts,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(B,{placeholder:"Search stock or process...",className:"w-full pl-8 md:w-[200px] lg:w-[300px]",value:s,onChange:x=>t(x.target.value)})]}),e.jsx(St,{value:a,onChange:x=>{x?.from&&x?.to&&n({from:x.from,to:x.to})}}),e.jsxs(te,{value:i||"all",onValueChange:x=>l(x==="all"?"":x),children:[e.jsx(ee,{className:"w-[180px]",children:e.jsx(ae,{placeholder:"All Processes"})}),e.jsxs(se,{children:[e.jsx(v,{value:"all",children:"All Processes"}),h?.filter(x=>{const C=x.process_name?.toLowerCase();return["cleaning","c & d","roasting","rfp"].includes(C)}).map(x=>e.jsx(v,{value:x.$id,children:x.process_name},x.$id))]})]}),e.jsx(D,{onClick:q,variant:"outline",size:"icon",disabled:b,children:e.jsx(Aa,{className:`h-4 w-4 ${b?"animate-spin":""}`})}),e.jsx(D,{onClick:L,variant:"outline",size:"icon",disabled:!N||N.length===0,children:e.jsx(rt,{className:"h-4 w-4"})})]})})}),b?e.jsx(G,{children:e.jsxs(Z,{className:"py-12 text-center",children:[e.jsx(Re,{className:"h-8 w-8 animate-spin mx-auto mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading pre-production status..."})]})}):e.jsxs(G,{children:[e.jsx(le,{children:e.jsx(ce,{children:"Status Details"})}),e.jsx(Z,{children:e.jsxs(ds,{children:[e.jsx(us,{children:e.jsxs(we,{children:[e.jsx(X,{children:"Stock Name"}),e.jsx(X,{children:"Process"}),e.jsx(X,{className:"text-right",children:"Opening Balance"}),e.jsx(X,{className:"text-right bg-purple-50",children:"Effective Completed"}),e.jsx(X,{className:"text-right",children:"Wastage Qty"}),e.jsx(X,{className:"text-right bg-green-50",children:"Utilised"}),e.jsx(X,{className:"text-right",children:"Closing Balance"}),e.jsx(X,{className:"text-right",children:"Min Level"}),e.jsx(X,{children:"Status"})]})}),e.jsx(ms,{children:N&&N.length>0?N.map((x,C)=>e.jsxs(we,{children:[e.jsx(Y,{children:x.stock_name}),e.jsx(Y,{children:x.process}),e.jsx(Y,{className:"text-right",children:x.opening_balance.toFixed(2)}),e.jsx(Y,{className:"text-right bg-purple-50 font-medium",children:x.effective_completed.toFixed(2)}),e.jsx(Y,{className:"text-right",children:x.wastage_qty.toFixed(2)}),e.jsx(Y,{className:"text-right bg-green-50 font-medium",children:x.utilised.toFixed(2)}),e.jsx(Y,{className:"text-right font-semibold",children:e.jsx("span",{className:x.closing_balance<0?"text-red-600":"text-green-600",children:x.closing_balance.toFixed(2)})}),e.jsx(Y,{className:"text-right text-muted-foreground",children:(x.min_level||0).toFixed(2)}),e.jsx(Y,{children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${x.status==="Out of Stock"?"bg-red-100 text-red-800":x.status==="Low Stock"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:x.status||"In Stock"})})]},`${x.stock_name}-${x.process}-${C}`)):e.jsx(we,{children:e.jsx(Y,{colSpan:9,className:"text-center",children:"No pre-production status found for the selected criteria."})})})]})})]})]})},Ma=(r,s,t={})=>{const{processId:a}=t,n=r?As(r):void 0,i=s?As(s):void 0,l=n?qt(n,1):void 0,h=n?Xe(n,"yyyy-MM-dd"):void 0,c=i?Xe(i,"yyyy-MM-dd"):void 0,o=l?Xe(l,"yyyy-MM-dd"):void 0,{data:d=[],isLoading:f}=he({queryKey:["stocks"],queryFn:()=>Fs.getAll(),staleTime:600*1e3}),{data:b=[],isLoading:N}=he({queryKey:["processes"],queryFn:()=>ot.getAll(),staleTime:600*1e3}),{data:q=[],isLoading:L}=he({queryKey:["rawProducts"],queryFn:()=>ht.getAll(),staleTime:600*1e3}),{data:x=[],isLoading:C}=he({queryKey:["products"],queryFn:()=>Is.getAll(),staleTime:600*1e3}),{data:E=[],isLoading:$}=he({queryKey:["productionTasks",h,c,a],queryFn:()=>Ys.getProductionTasksWithRelations(h,c,a),enabled:!!n&&!!i,staleTime:300*1e3}),{data:k=[]}=he({queryKey:["productionTasksBefore",o,a],queryFn:()=>Ys.getProductionTasksWithRelations(void 0,o,a),enabled:!!l,staleTime:300*1e3}),{data:R=[]}=he({queryKey:["postProductionTasks",h,c],queryFn:()=>tt.getPostProductionTasksWithRelations(),enabled:!!n&&!!i,staleTime:300*1e3});return{statusRecords:u.useMemo(()=>{if(!b.length||!q.length||!x.length)return[];const Q=a?b.filter(j=>j.$id===a):b.filter(j=>{const P=j.process_name?.toLowerCase();return P==="grinding"||P==="blending"}),V=new Map(Q.map(j=>[j.$id,j.process_name])),w=new Map(q.map(j=>[j.$id,j])),m=j=>{const P=x.find(H=>H.$id===j);if(!P)return null;const J=P.product||P.product_name||P.Product_Name||P.name;if(!J)return null;let A=q.find(H=>H.raw_product?.toLowerCase()===J.toLowerCase());return A||(A=q.find(H=>{const U=H.raw_product?.toLowerCase()||"",ie=J.toLowerCase();return U.includes(ie)||ie.includes(U)})),A},F=new Map,p=j=>{if(!j)return!n&&!i;if(!n&&!i)return!0;const P=As(j),J=n?P>=n:!0,A=i?P<=i:!0;return J&&A},I=new Set(Q.map(j=>j.$id));return k.filter(j=>I.has(j.process_id)).forEach(j=>{const P=`${j.raw_product_id}-${j.process_id}`,J=Array.isArray(j.stock_items)?j.stock_items.reduce((ie,me)=>ie+(Number(me.quantity)||0),0):0,A=j.assigned_quantity!==void 0&&j.assigned_quantity!==null?Number(j.assigned_quantity):J,H=Number(j.wastage_quantity)||0,U=A-H;F.has(P)?F.get(P).opening_balance+=U:F.set(P,{stock_name:j.raw_product_name||"Unknown",process:V.get(j.process_id)||"Unknown",opening_balance:U,assigned:0,effective_completed:0,wastage_qty:0,utilised:0,closing_balance:0})}),E.filter(j=>I.has(j.process_id)).forEach(j=>{const P=`${j.raw_product_id}-${j.process_id}`,J=Array.isArray(j.stock_items)?j.stock_items.reduce((ie,me)=>ie+(Number(me.quantity)||0),0):0,A=j.assigned_quantity!==void 0&&j.assigned_quantity!==null?Number(j.assigned_quantity):J,H=Number(j.wastage_quantity)||0,U=A-H;if(F.has(P)){const ie=F.get(P);ie.assigned+=A,ie.wastage_qty+=H,ie.effective_completed+=U}else F.set(P,{stock_name:j.raw_product_name||"Unknown",process:V.get(j.process_id)||"Unknown",opening_balance:0,assigned:A,wastage_qty:H,effective_completed:U,utilised:0,closing_balance:0})}),F.forEach((j,P)=>{const[J,A]=P.split("-");w.get(J);const H=(R||[]).filter(U=>{const ie=U.source_process_id===A,me=m(U.product_id),ve=me&&me.$id===J,z=p(U.date_assigned)||p(U.date_completed);return ie&&ve&&z}).reduce((U,ie)=>{const me=Number(ie.source_quantity)||0;return U+me},0);j.utilised=H}),F.forEach(j=>{j.closing_balance=j.opening_balance+j.effective_completed-j.utilised,j.closing_balance<=0?j.status="Out of Stock":j.closing_balance<0?j.status="Low Stock":j.status="In Stock"}),Array.from(F.values())},[d,b,E,k,R,q,x,n,i,l,a]),isLoading:f||N||L||C||$,error:null}},rc=()=>{const{user:r,loading:s}=os(),t=Ws(),{toast:a}=Ee(),n=is(),[i,l]=u.useState(""),[h,c]=u.useState({from:Us(new Date),to:Os(new Date)}),[o,d]=u.useState(""),{data:f,isLoading:b}=Js(),N=h.from?Xe(h.from,"yyyy-MM-dd"):void 0,q=h.to?Xe(h.to,"yyyy-MM-dd"):void 0,{statusRecords:L,isLoading:x}=Ma(N,q,{processId:o||void 0}),C=u.useMemo(()=>L?L.filter(R=>(R.stock_name||"").toLowerCase().includes(i.toLowerCase())||(R.process||"").toLowerCase().includes(i.toLowerCase())):[],[L,i]),E=async()=>{try{await n.invalidateQueries({queryKey:["stocks"]}),await n.invalidateQueries({queryKey:["processes"]}),await n.invalidateQueries({queryKey:["productionTasks"]}),await n.invalidateQueries({queryKey:["postProductionTasks"]}),await n.invalidateQueries({queryKey:["rawProducts"]}),await n.invalidateQueries({queryKey:["products"]}),a({title:"Production Data Refreshed",description:"Data updated successfully"})}catch{a({title:"Refresh Failed",description:"Please try again",variant:"destructive"})}},$=()=>{const M=[["Raw Product","Process","Opening Balance","Assigned","Effective Completed","Wastage Qty","Utilised","Closing Bal","Min Level","Status"].join(","),...C.map(m=>[`"${m.stock_name}"`,`"${m.process}"`,m.opening_balance.toFixed(2),m.assigned.toFixed(2),m.effective_completed.toFixed(2),m.wastage_qty.toFixed(2),m.utilised.toFixed(2),m.closing_balance.toFixed(2),(m.min_level||0).toFixed(2),`"${m.status||"In Stock"}"`].join(","))].join(`
`),S=new Blob([M],{type:"text/csv;charset=utf-8;"}),Q=URL.createObjectURL(S),V=document.createElement("a");V.setAttribute("href",Q);const w=N&&q?`_${N}_to_${q}`:"";V.setAttribute("download",`production-status${w}_${new Date().toISOString().split("T")[0]}.csv`),V.style.visibility="hidden",document.body.appendChild(V),V.click(),document.body.removeChild(V)},k=x||b;return s?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Re,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading..."})]})}):r?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Production Status"}),e.jsx("p",{className:"text-muted-foreground",children:"Track material flow through production stages"})]}),e.jsx(G,{children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("div",{className:"relative w-full md:w-auto",children:[e.jsx(ts,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(B,{placeholder:"Search stock or process...",className:"w-full pl-8 md:w-[200px] lg:w-[300px]",value:i,onChange:R=>l(R.target.value)})]}),e.jsx(St,{value:h,onChange:R=>{R?.from&&R?.to&&c(R)}}),e.jsxs(te,{value:o,onValueChange:d,children:[e.jsx(ee,{className:"w-[180px]",children:e.jsx(ae,{placeholder:"All Processes"})}),e.jsx(se,{children:f?.filter(R=>{const M=R.process_name?.toLowerCase();return M==="grinding"||M==="blending"}).map(R=>e.jsx(v,{value:R.$id,children:R.process_name},R.$id))})]}),e.jsx(D,{onClick:E,variant:"outline",size:"icon",disabled:k,children:e.jsx(Aa,{className:`h-4 w-4 ${k?"animate-spin":""}`})}),e.jsx(D,{onClick:$,variant:"outline",size:"icon",disabled:!C||C.length===0,children:e.jsx(rt,{className:"h-4 w-4"})})]})})}),k?e.jsx(G,{children:e.jsxs(Z,{className:"py-12 text-center",children:[e.jsx(Re,{className:"h-8 w-8 animate-spin mx-auto mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading production status..."})]})}):e.jsxs(G,{children:[e.jsxs(le,{className:"flex flex-row items-center justify-between",children:[e.jsxs(ce,{children:["Production Status Records (",C.length,")"]}),e.jsx("div",{className:"flex items-center gap-2"})]}),e.jsx(Z,{children:e.jsxs(ds,{children:[e.jsx(us,{children:e.jsxs(we,{children:[e.jsx(X,{children:"Raw Product"}),e.jsx(X,{children:"Process"}),e.jsx(X,{className:"text-right",children:"Opening Balance"}),e.jsx(X,{className:"text-right",children:"Assigned"}),e.jsx(X,{className:"text-right bg-purple-50",children:"Effective Completed"}),e.jsx(X,{className:"text-right",children:"Wastage Qty"}),e.jsx(X,{className:"text-right bg-green-50",children:"Utilised"}),e.jsx(X,{className:"text-right",children:"Closing Bal"}),e.jsx(X,{className:"text-right",children:"Min Level"}),e.jsx(X,{children:"Status"})]})}),e.jsx(ms,{children:C&&C.length>0?C.map((R,M)=>e.jsxs(we,{children:[e.jsx(Y,{children:R.stock_name}),e.jsx(Y,{children:R.process}),e.jsx(Y,{className:"text-right",children:R.opening_balance.toFixed(2)}),e.jsx(Y,{className:"text-right",children:R.assigned.toFixed(2)}),e.jsx(Y,{className:"text-right bg-purple-50 font-medium",children:R.effective_completed.toFixed(2)}),e.jsx(Y,{className:"text-right",children:R.wastage_qty.toFixed(2)}),e.jsx(Y,{className:"text-right bg-green-50 font-medium",children:R.utilised.toFixed(2)}),e.jsx(Y,{className:"text-right font-semibold",children:e.jsx("span",{className:R.closing_balance<0?"text-red-600":"text-green-600",children:R.closing_balance.toFixed(2)})}),e.jsx(Y,{className:"text-right text-muted-foreground",children:(R.min_level||0).toFixed(2)}),e.jsx(Y,{children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${R.status==="Out of Stock"?"bg-red-100 text-red-800":R.status==="Low Stock"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:R.status||"In Stock"})})]},`${R.stock_name}-${R.process}-${M}`)):e.jsx(we,{children:e.jsx(Y,{colSpan:10,className:"text-center",children:"No production status found for the selected criteria."})})})]})})]})]}):e.jsx(wt,{to:"/login",state:{from:t},replace:!0})},nc=(r,s)=>r.filter(t=>{const a=t.$id;return a&&a.trim()!==""}),Kt={ALL:"all"},Fn=(r,s,t={})=>{const{processId:a}=t,n=r?As(r):void 0,i=s?As(s):void 0;n&&qt(n,1);const l=n?Xe(n,"yyyy-MM-dd"):void 0,h=i?Xe(i,"yyyy-MM-dd"):void 0,{data:c=[],isLoading:o}=he({queryKey:["products"],queryFn:()=>Is.getAll(),staleTime:600*1e3}),{data:d=[],isLoading:f}=he({queryKey:["processes"],queryFn:()=>ot.getAll(),staleTime:600*1e3}),{data:b=[],isLoading:N}=he({queryKey:["postProductionTasks",l,h],queryFn:()=>tt.getPostProductionTasksWithRelations(),enabled:!!n&&!!i,staleTime:300*1e3}),{data:q=[]}=he({queryKey:["salesUnits",l,h],queryFn:()=>Qs.getAll(),staleTime:60*1e3});return{statusRecords:u.useMemo(()=>{if(!c.length||!d.length)return[];const C=n?qt(n,1):void 0,E=a?d.filter(M=>M.$id===a):d.filter(M=>{const S=M.process_name?.toLowerCase();return S==="packing"||S==="batch coding"}),$=M=>{if(!M)return!n&&!i;if(!n&&!i)return!0;const S=As(M),Q=n?S>=n:!0,V=i?S<=i:!0;return Q&&V},k=M=>!M||!C?!1:As(M)<=C,R=[];return c.forEach(M=>{E.forEach(S=>{const Q=M.sku||M.SKU||"",V=M.product||"",w=S.process_name,m=M.min_level||M.minLevel||0;if(!Q||!V||!w)return;const p=b.filter(z=>z.product_id===M.$id&&z.process_id===S.$id&&z.status==="completed"&&k(z.date_completed||z.date_assigned)).reduce((z,pe)=>z+(Number(pe.units)||0),0),I=b.filter(z=>z.source_process_id===S.$id&&z.product_id===M.$id&&k(z.date_assigned||z.date_completed)).reduce((z,pe)=>z+(Number(pe.units)||0),0);let j=0;w.toLowerCase()==="batch coding"&&(j=q.filter(z=>z.product_id===M.$id&&k(z.date||z.$createdAt)).reduce((z,pe)=>z+(Number(pe.units)||0),0));const P=p-I-j,A=b.filter(z=>z.product_id===M.$id&&z.process_id===S.$id&&z.status==="completed"&&$(z.date_completed||z.date_assigned)).reduce((z,pe)=>z+(Number(pe.units)||0),0),H=b.filter(z=>z.source_process_id===S.$id&&z.product_id===M.$id&&$(z.date_assigned||z.date_completed)).reduce((z,pe)=>{const ge=Number(pe.units)||0;return z+ge},0);let U=0;w.toLowerCase()==="batch coding"&&(U=q.filter(z=>z.product_id===M.$id&&$(z.date||z.$createdAt)).reduce((z,pe)=>{const ge=Number(pe.units)||0;return z+ge},0));const ie=H+U,me=P+A-ie;let ve="In Stock";me<=0?ve="Out of Stock":me<m&&(ve="Low Stock"),R.push({sku:Q,product_name:V,process_name:w,opening_balance:P,completed_units:A,utilised:ie,closing_balance:me,status:ve,min_level:m})})}),R},[c,d,b,q,a,n,i]),isLoading:o||f||N,error:null}},ic=()=>{const{user:r,loading:s}=os(),t=Ws(),{toast:a}=Ee(),n=is(),[i,l]=u.useState(""),[h,c]=u.useState({from:Us(new Date),to:Os(new Date)}),[o,d]=u.useState(Kt.ALL);if(s)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Re,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Validating authentication..."})]})});if(!r)return console.error("PostProductionStatus: User not authenticated, redirecting to login"),e.jsx(wt,{to:"/login",state:{from:t},replace:!0});const{data:f=[],isLoading:b}=he({queryKey:Ca.processes,queryFn:async()=>await ot.getAll()}),{statusRecords:N=[],isLoading:q}=Fn(h?.from?Xe(h.from,"yyyy-MM-dd"):void 0,h?.to?Xe(h.to,"yyyy-MM-dd"):void 0,{processId:o!==Kt.ALL?o:void 0}),L=u.useMemo(()=>{if(!N)return[];let $=[...N];if(i&&($=$.filter(k=>k.product_name?.toLowerCase().includes(i.toLowerCase())||k.process_name?.toLowerCase().includes(i.toLowerCase())||k.sku?.toLowerCase().includes(i.toLowerCase()))),o!==Kt.ALL){const k=f.find(R=>R.$id===o)?.process_name;k&&($=$.filter(R=>R.process_name===k))}return $},[N,i,o,f]),x=b||q,C=async()=>{try{await n.invalidateQueries({queryKey:["products"]}),await n.invalidateQueries({queryKey:["processes"]}),await n.invalidateQueries({queryKey:["postProductionTasks"]}),await n.invalidateQueries({queryKey:["salesUnits"]}),a({title:"Post-Production Data Refreshed",description:"Data updated successfully"})}catch{a({title:"Refresh Failed",description:"Please try again",variant:"destructive"})}},E=()=>{try{const $=[["SKU","Product","Process","Source Qty (kg)","Opening Balance","Completed Units","Utilised","Closing Balance","Min Level","Status"],...L.map(S=>[S.sku||"",S.product_name||"",S.process_name||"",S.source_qty??"N/A",S.opening_balance||0,S.completed_units||0,S.utilised||0,S.closing_balance||0,S.min_level||0,`"${S.status||"In Stock"}"`])].map(S=>S.join(",")).join(`
`),k=new Blob([$],{type:"text/csv"}),R=window.URL.createObjectURL(k),M=document.createElement("a");M.href=R,M.download=`post-production-status-${Xe(new Date,"yyyy-MM-dd")}.csv`,M.click(),window.URL.revokeObjectURL(R),a({title:"Export Successful",description:"Post-production status data exported successfully."})}catch($){console.error("PostProductionStatus: Export failed",$),a({title:"Export Failed",description:"Failed to export data. Please try again.",variant:"destructive"})}};return e.jsxs("div",{className:"space-y-6 p-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Post-Production Status"}),e.jsx("p",{className:"text-muted-foreground",children:"Track quality checks and post-production status"})]}),e.jsx(G,{children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("div",{className:"relative w-full md:w-auto",children:[e.jsx(ts,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(B,{placeholder:"Search product, process or SKU...",className:"w-full pl-8 md:w-[200px] lg:w-[300px]",value:i,onChange:$=>l($.target.value)})]}),e.jsx(St,{value:h,onChange:$=>{$?.from&&$?.to&&c($)}}),e.jsxs(te,{value:o,onValueChange:d,children:[e.jsx(ee,{className:"w-[180px]",children:e.jsx(ae,{placeholder:"Select Process"})}),e.jsxs(se,{children:[e.jsx(v,{value:Kt.ALL,children:"All Processes"}),nc(f).filter($=>{const k=$.process_name?.toLowerCase();return k==="packing"||k==="batch coding"}).map($=>e.jsx(v,{value:$.$id,children:$.process_name},$.$id))]})]}),e.jsx(D,{onClick:C,variant:"outline",size:"icon",disabled:x,children:e.jsx(Aa,{className:`h-4 w-4 ${x?"animate-spin":""}`})}),e.jsx(D,{onClick:E,variant:"outline",size:"icon",disabled:!L||L.length===0,title:"Export to CSV",children:e.jsx(rt,{className:"h-4 w-4"})})]})})}),e.jsxs(G,{children:[e.jsx(le,{className:"flex flex-row items-center justify-between",children:e.jsxs(ce,{children:["Post-Production Status Records (",L.length,")"]})}),e.jsx(Z,{children:x?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(Re,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("span",{children:"Loading post-production status..."})]}):L.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("p",{className:"text-lg mb-2",children:"No post-production status found"}),e.jsx("p",{className:"text-sm",children:i?"No matching records found":"Post-production status data will be populated from packing tasks and sales"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(ds,{children:[e.jsx(us,{children:e.jsxs(we,{children:[e.jsx(X,{children:"SKU"}),e.jsx(X,{children:"Product"}),e.jsx(X,{children:"Process"}),e.jsx(X,{className:"text-right",children:"Source Qty (kg)"}),e.jsx(X,{className:"text-right",children:"Opening Balance"}),e.jsx(X,{className:"text-right bg-purple-50",children:"Completed Units"}),e.jsx(X,{className:"text-right bg-green-50",children:"Utilised"}),e.jsx(X,{className:"text-right",children:"Closing Balance"}),e.jsx(X,{className:"text-right",children:"Min Level"}),e.jsx(X,{children:"Status"})]})}),e.jsx(ms,{children:L.map(($,k)=>e.jsxs(we,{children:[e.jsx(Y,{className:"font-medium",children:$.sku}),e.jsx(Y,{children:$.product_name}),e.jsx(Y,{children:$.process_name}),e.jsx(Y,{className:"text-right",children:$.source_qty??"N/A"}),e.jsx(Y,{className:"text-right",children:$.opening_balance||0}),e.jsx(Y,{className:"text-right bg-purple-50 font-medium",children:$.completed_units||0}),e.jsx(Y,{className:"text-right bg-green-50 font-medium",children:$.utilised||0}),e.jsx(Y,{className:"text-right font-semibold",children:e.jsx("span",{className:($.closing_balance||0)<0?"text-red-600":"text-green-600",children:$.closing_balance||0})}),e.jsx(Y,{className:"text-right text-muted-foreground",children:$.min_level||0}),e.jsx(Y,{children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${$.status==="Out of Stock"?"bg-red-100 text-red-800":$.status==="Low Stock"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:$.status||"In Stock"})})]},`${$.sku}-${$.process_name}-${k}`))})]})})})]})]})};function oc(){const{user:r,loading:s}=os(),t=Ws(),[a,n]=u.useState(""),[i,l]=u.useState(void 0);if(s)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Re,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Validating authentication..."})]})});if(!r)return console.error("InventoryStatus: User not authenticated, redirecting to login"),e.jsx(wt,{to:"/login",state:{from:t},replace:!0});const{data:h=[],isLoading:c}=he({queryKey:["products"],queryFn:async()=>await Is.getAll()}),o=u.useMemo(()=>{const C=[];return i?.from&&C.push($e.greaterThanEqual("date",i.from.toISOString())),i?.to&&C.push($e.lessThanEqual("date",i.to.toISOString())),C},[i]),{data:d=[],isLoading:f}=he({queryKey:["sales-units-inventory",i?.from?.toISOString(),i?.to?.toISOString()],queryFn:async()=>await Qs.getAll(o)}),{data:b=[],isLoading:N}=he({queryKey:["sales-records-inventory",i?.from?.toISOString(),i?.to?.toISOString()],queryFn:async()=>await st.getAll(o)}),q=u.useMemo(()=>h.length?h.map(C=>{const E=C.sku||"",$=C.product||C.name||"",k=C.min_level||C.minLevel||0,R=d.filter(w=>w.sku===E).reduce((w,m)=>w+(m.units||0),0),M=b.filter(w=>w.sku===E).reduce((w,m)=>w+(m.sold_units||0),0),S=0,Q=S+R-M;let V="In Stock";return Q<=0?V="Out of Stock":Q<=k&&(V="Low Stock"),{sku:E,product:$,opening_balance:S,sales_units:R,sold:M,closing_balance:Q,min_level:k,status:V}}):[],[h,d,b]),L=u.useMemo(()=>a?q.filter(C=>C.sku.toLowerCase().includes(a.toLowerCase())||C.product.toLowerCase().includes(a.toLowerCase())):q,[q,a]),x=c||f||N;return e.jsxs("div",{className:"space-y-6 p-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Inventory Status"}),e.jsx("p",{className:"text-muted-foreground",children:"Track current inventory levels based on sales units and sold units"})]}),e.jsx(G,{children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4 items-center flex-wrap",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(ts,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(B,{placeholder:"Search by SKU or Product...",className:"pl-10",value:a,onChange:C=>n(C.target.value)})]}),e.jsx("div",{className:"min-w-[250px]",children:e.jsx(St,{value:i,onChange:l,placeholder:"Select date range for calculations"})}),e.jsxs(D,{variant:"outline",children:[e.jsx(Ks,{className:"h-4 w-4 mr-2"}),"Filter"]}),e.jsxs(D,{variant:"outline",children:[e.jsx(rt,{className:"h-4 w-4 mr-2"}),"Export"]})]})})}),e.jsxs(G,{children:[e.jsx(le,{children:e.jsxs(ce,{children:["Inventory Status (",L.length,")",i?.from&&i?.to&&e.jsxs("span",{className:"text-sm font-normal text-muted-foreground ml-2",children:["(",i.from.toLocaleDateString("en-GB")," - ",i.to.toLocaleDateString("en-GB"),")"]})]})}),e.jsx(Z,{children:x?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(Re,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("span",{children:"Loading inventory status..."})]}):L.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("p",{className:"text-lg mb-2",children:"No inventory data found"}),e.jsx("p",{className:"text-sm",children:a?"Try adjusting your search criteria":"Add products and sales data to see inventory status"})]}):e.jsxs(ds,{children:[e.jsx(us,{children:e.jsxs(we,{children:[e.jsx(X,{children:"SKU"}),e.jsx(X,{children:"Product"}),e.jsx(X,{className:"text-right",children:"Opening Bal"}),e.jsx(X,{className:"text-right bg-purple-50",children:"Sales Units"}),e.jsx(X,{className:"text-right bg-green-50",children:"Sold"}),e.jsx(X,{className:"text-right",children:"Closing Bal"}),e.jsx(X,{className:"text-right",children:"Min Level"}),e.jsx(X,{children:"Status"})]})}),e.jsx(ms,{children:L.map((C,E)=>e.jsxs(we,{children:[e.jsx(Y,{className:"font-medium",children:C.sku}),e.jsx(Y,{children:C.product}),e.jsx(Y,{className:"text-right",children:C.opening_balance.toLocaleString()}),e.jsx(Y,{className:"text-right bg-purple-50 font-medium",children:C.sales_units.toLocaleString()}),e.jsx(Y,{className:"text-right bg-green-50 font-medium",children:C.sold.toLocaleString()}),e.jsx(Y,{className:"text-right font-semibold",children:e.jsx("span",{className:C.closing_balance<0?"text-red-600":"text-green-600",children:C.closing_balance.toLocaleString()})}),e.jsx(Y,{className:"text-right text-muted-foreground",children:C.min_level.toLocaleString()}),e.jsx(Y,{children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${C.status==="Out of Stock"?"bg-red-100 text-red-800":C.status==="Low Stock"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:C.status})})]},`${C.sku}-${E}`))})]})})]}),e.jsxs(G,{children:[e.jsx(le,{children:e.jsx(ce,{children:"Summary"})}),e.jsx(Z,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:L.length}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Products"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:L.reduce((C,E)=>C+E.sales_units,0).toLocaleString()}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Sales Units"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:L.reduce((C,E)=>C+E.sold,0).toLocaleString()}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Sold"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:L.reduce((C,E)=>C+E.closing_balance,0).toLocaleString()}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Net Closing Balance"})]})]})})]})]})}const lc=[{value:"pending",label:"Pending"},{value:"in_progress",label:"In Progress"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"}],cc=({isOpen:r,onClose:s,onSubmit:t,editingTask:a,isLoading:n=!1})=>{const{data:i}=An(),{data:l}=La(),{data:h}=Js(),c=new Date,o=Us(c),d=Os(c),{statusRecords:f}=$a(o.toISOString().split("T")[0],d.toISOString().split("T")[0],{processId:void 0}),{stockStatus:b,isLoading:N}=Rn(o,d,{category:void 0,searchTerm:void 0});u.useEffect(()=>{console.log("ðŸ” RTQV DATA SOURCE DEBUG:",{dateRange:`${o.toISOString().split("T")[0]} to ${d.toISOString().split("T")[0]}`,isLoading:N,dataLength:b?.length,sampleData:b?.slice(0,2),timestamp:new Date().toISOString()})},[b,N]);const q=["Stock","Cleaning","C & D","Roasting","RFP"],L=h.filter(w=>{const m=w.process_name?.toLowerCase();return["cleaning","c & d","roasting","rfp"].includes(m)}),[x,C]=u.useState({task_id:"",stock_id:"",stock_source:"",date_assigned:new Date().toISOString().split("T")[0],process_id:"",assigned_quantity:"",completed_quantity:"",staff_id:"",date_completed:"",wastage_quantity:"",remarks:"",status:"pending"}),[E,$]=u.useState({}),[k,R]=u.useState(null),M=()=>{if(!x.stock_id||!x.stock_source||!x.assigned_quantity){R(null);return}const w=i?.find(A=>A.$id===x.stock_id);if(!w){R({isValid:!1,availableQty:0,requiredQty:0,stockName:"Unknown Stock",stockSource:x.stock_source,error:"Stock not found",validationClass:"bg-red-50 text-red-700 border-red-200",validationMessage:"Selected stock not found"});return}const m=parseFloat(x.assigned_quantity);if(m<=0){R({isValid:!1,availableQty:0,requiredQty:m,stockName:w.stock_name,stockSource:x.stock_source,error:"Invalid quantity",validationClass:"bg-yellow-50 text-yellow-700 border-yellow-200",validationMessage:"Quantity must be greater than 0"});return}let F=0,p="",I=!1;if(x.stock_source==="Stock"){if(p="Stock Status",I=N,I){R({isValid:!1,availableQty:0,requiredQty:m,stockName:w.stock_name,stockSource:x.stock_source,dataSource:p,isLoading:!0,validationClass:"bg-blue-50 text-blue-700 border-blue-200",validationMessage:"Loading stock data..."});return}const A=b?.find(H=>H.stock_name?.toLowerCase()===w.stock_name?.toLowerCase());F=A?.closing_balance??0,console.log("ðŸ” RTQV Stock Status Check:",{stock_name:w.stock_name,stockRecord_found:!!A,closing_balance:A?.closing_balance,availableQty:F,dataSource:p,forced_fresh:!0})}else{p="Pre-Production Status";const A=f?.find(H=>H.stock_name===w.stock_name&&H.process===x.stock_source);F=A?.closing_balance??0,console.log("ðŸ” RTQV Pre-Production Status Check:",{stock_name:w.stock_name,stock_source:x.stock_source,statusRecord_found:!!A,closing_balance:A?.closing_balance,availableQty:F,dataSource:p,forced_fresh:!0})}const j=F>=m;let P="",J="";j?(P="bg-green-50 text-green-700 border-green-200",J=`âœ“ Available: ${F}kg (Required: ${m}kg)`):F===0?(P="bg-red-50 text-red-700 border-red-200",J=`âœ— Out of stock (Required: ${m}kg)`):(P="bg-orange-50 text-orange-700 border-orange-200",J=`âš  Insufficient stock: ${F}kg available (Required: ${m}kg)`),R({isValid:j,availableQty:F,requiredQty:m,stockName:w.stock_name,stockSource:x.stock_source,dataSource:p,isLoading:!1,validationClass:P,validationMessage:J})};u.useEffect(()=>{M()},[x.stock_id,x.stock_source,x.assigned_quantity,i,f,b]),u.useEffect(()=>{if(r)if(a)C({task_id:a.task_id,stock_id:a.stock_id,stock_source:a.stock_source,date_assigned:a.date_assigned,process_id:a.process_id,assigned_quantity:a.assigned_quantity.toString(),completed_quantity:a.completed_quantity?.toString()||"",staff_id:a.staff_id,date_completed:a.date_completed||"",wastage_quantity:a.wastage_quantity?.toString()||"",remarks:a.remarks||"",status:a.status});else{const w=`TASK${Date.now().toString().slice(-6)}`;C({task_id:w,stock_id:"",stock_source:"",date_assigned:new Date().toISOString().split("T")[0],process_id:"",assigned_quantity:"",completed_quantity:"",staff_id:"",date_completed:"",wastage_quantity:"",remarks:"",status:"pending"})}},[a,r]);const S=()=>{const w={};return x.task_id.trim()||(w.task_id="Task ID is required"),x.stock_id||(w.stock_id="Stock is required"),x.stock_source||(w.stock_source="Stock source is required"),x.date_assigned||(w.date_assigned="Date assigned is required"),x.process_id||(w.process_id="Process is required"),(!x.assigned_quantity||parseFloat(x.assigned_quantity)<=0)&&(w.assigned_quantity="Assigned quantity must be greater than 0"),x.staff_id||(w.staff_id="Staff is required"),x.wastage_quantity&&parseFloat(x.wastage_quantity)<0&&(w.wastage_quantity="Wastage quantity cannot be negative"),$(w),Object.keys(w).length===0},Q=w=>{if(w.preventDefault(),!S())return;const m={task_id:x.task_id,stock_id:x.stock_id,stock_source:x.stock_source,date_assigned:x.date_assigned,process_id:x.process_id,assigned_quantity:parseFloat(x.assigned_quantity),completed_quantity:x.completed_quantity?parseFloat(x.completed_quantity):void 0,staff_id:x.staff_id,date_completed:x.date_completed||void 0,wastage_quantity:x.wastage_quantity?parseFloat(x.wastage_quantity):void 0,remarks:x.remarks||void 0,status:x.status};t(m)},V=()=>{C({task_id:"",stock_id:"",stock_source:"",date_assigned:new Date().toISOString().split("T")[0],process_id:"",assigned_quantity:"",completed_quantity:"",staff_id:"",date_completed:"",wastage_quantity:"",remarks:"",status:"pending"}),$({}),R(null),s()};return e.jsx(Qe,{open:r,onOpenChange:V,children:e.jsxs(Ve,{className:"sm:max-w-[600px] max-w-[95vw] max-h-[90vh] overflow-y-auto",children:[e.jsxs(Be,{children:[e.jsx(ze,{children:a?"Edit Pre-Production Task":"Add New Pre-Production Task"}),e.jsx(Ye,{children:a?"Update the details of the pre-production task below.":"Fill in the details to create a new pre-production task."})]}),e.jsxs("form",{onSubmit:Q,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(_,{htmlFor:"task_id",children:"Task ID *"}),e.jsx(B,{id:"task_id",value:x.task_id,onChange:w=>C({...x,task_id:w.target.value}),className:E.task_id?"border-red-500":""}),E.task_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:E.task_id})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"date_assigned",children:"Date Assigned *"}),e.jsx(B,{id:"date_assigned",type:"date",value:x.date_assigned,onChange:w=>C({...x,date_assigned:w.target.value}),className:E.date_assigned?"border-red-500":""}),E.date_assigned&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:E.date_assigned})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(_,{htmlFor:"stock_id",children:"Stock Name *"}),e.jsxs(te,{value:x.stock_id,onValueChange:w=>C({...x,stock_id:w}),children:[e.jsx(ee,{className:E.stock_id?"border-red-500":"",children:e.jsx(ae,{placeholder:"Select Stock"})}),e.jsx(se,{children:i.map(w=>e.jsx(v,{value:w.$id||"",children:w.stock_name},w.$id))})]}),E.stock_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:E.stock_id})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"stock_source",children:"Stock Source *"}),e.jsxs(te,{value:x.stock_source,onValueChange:w=>C({...x,stock_source:w}),children:[e.jsx(ee,{className:E.stock_source?"border-red-500":"",children:e.jsx(ae,{placeholder:"Select Source"})}),e.jsx(se,{children:q.map(w=>e.jsx(v,{value:w,children:w},w))})]}),E.stock_source&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:E.stock_source})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(_,{htmlFor:"process_id",children:"Process *"}),e.jsxs(te,{value:x.process_id,onValueChange:w=>C({...x,process_id:w}),children:[e.jsx(ee,{className:E.process_id?"border-red-500":"",children:e.jsx(ae,{placeholder:"Select Process"})}),e.jsx(se,{children:L.map(w=>e.jsx(v,{value:w.$id||"",children:w.process_name},w.$id))})]}),E.process_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:E.process_id})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"assigned_quantity",children:"Assigned Quantity *"}),e.jsx(B,{id:"assigned_quantity",type:"number",step:"0.01",min:"0",value:x.assigned_quantity,onChange:w=>C({...x,assigned_quantity:w.target.value}),className:E.assigned_quantity?"border-red-500":"",placeholder:"Enter quantity in kg"}),E.assigned_quantity&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:E.assigned_quantity}),k&&e.jsxs("div",{className:`mt-2 p-3 rounded-md border text-sm ${k.validationClass}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("div",{className:"font-medium",children:k.stockName}),e.jsxs("div",{className:"text-xs opacity-75",children:["Source: ",k.dataSource]})]}),e.jsx("div",{className:"mb-1",children:k.validationMessage}),k.error&&e.jsxs("div",{className:"text-xs mt-1 opacity-75",children:["Error: ",k.error]}),k.isLoading&&e.jsxs("div",{className:"flex items-center gap-2 text-xs mt-1",children:[e.jsx("div",{className:"animate-spin h-3 w-3 border border-current border-t-transparent rounded-full"}),"Loading fresh data from ",k.dataSource,"..."]})]})]})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"staff_id",children:"Assigned To *"}),e.jsxs(te,{value:x.staff_id,onValueChange:w=>C({...x,staff_id:w}),children:[e.jsx(ee,{className:E.staff_id?"border-red-500":"",children:e.jsx(ae,{placeholder:"Select Staff"})}),e.jsx(se,{children:l.map(w=>e.jsx(v,{value:w.$id||"",children:w.staff_name},w.$id))})]}),E.staff_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:E.staff_id})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(_,{htmlFor:"completed_quantity",children:"Completed Quantity"}),e.jsx(B,{id:"completed_quantity",type:"number",value:x.completed_quantity,onChange:w=>C({...x,completed_quantity:w.target.value})})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"date_completed",children:"Date Completed"}),e.jsx(B,{id:"date_completed",type:"date",value:x.date_completed,onChange:w=>C({...x,date_completed:w.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(_,{htmlFor:"wastage_quantity",children:"Wastage Quantity"}),e.jsx(B,{id:"wastage_quantity",type:"number",step:"0.01",min:"0",value:x.wastage_quantity,onChange:w=>C({...x,wastage_quantity:w.target.value}),className:E.wastage_quantity?"border-red-500":""}),E.wastage_quantity&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:E.wastage_quantity})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"status",children:"Status"}),e.jsxs(te,{value:x.status,onValueChange:w=>C({...x,status:w}),children:[e.jsx(ee,{children:e.jsx(ae,{placeholder:"Select Status"})}),e.jsx(se,{children:lc.map(w=>e.jsx(v,{value:w.value,children:w.label},w.value))})]})]})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"remarks",children:"Remarks"}),e.jsx(Hs,{id:"remarks",value:x.remarks,onChange:w=>C({...x,remarks:w.target.value}),placeholder:"Enter any remarks",rows:3})]})]}),e.jsxs(He,{className:"flex-col sm:flex-row gap-2 pt-4",children:[e.jsx(D,{type:"button",variant:"outline",onClick:V,className:"w-full sm:w-auto",children:"Cancel"}),e.jsx(D,{type:"submit",disabled:n,className:"w-full sm:w-auto",children:n?"Saving...":a?"Update":"Save"})]})]})]})})},dc=()=>{const r=is(),s=Ne({mutationFn:n=>Me.createDocument(Oe,fe.PRE_PRODUCTION_TASKS,at.unique(),n),onSuccess:()=>{r.invalidateQueries({queryKey:["preProductionTasks"]})}}),t=Ne({mutationFn:({id:n,data:i})=>Me.updateDocument(Oe,fe.PRE_PRODUCTION_TASKS,n,i),onSuccess:()=>{r.invalidateQueries({queryKey:["preProductionTasks"]})}}),a=Ne({mutationFn:n=>Me.deleteDocument(Oe,fe.PRE_PRODUCTION_TASKS,n),onSuccess:()=>{r.invalidateQueries({queryKey:["preProductionTasks"]})}});return{createTask:s,updateTask:t,deleteTask:a}},uc=()=>{const[r,s]=u.useState(""),[t,a]=u.useState(!1),[n,i]=u.useState(null),[l,h]=u.useState([]),[c,o]=u.useState({show:!1,message:"",type:"success"}),[d,f]=u.useState("all"),[b,N]=u.useState("all"),[q,L]=u.useState("all"),[x,C]=u.useState({from:"",to:""}),[E,$]=u.useState(1),[k,R]=u.useState(50),{tasks:M,isLoading:S,error:Q,refetch:V}=Cn(),{createTask:w,updateTask:m,deleteTask:F}=dc(),{config:p}=bs("pre-production-tasks"),{validationRules:I,canImport:j}=Ns("pre-production-tasks");Ro("pre-production-tasks");const{currentSort:P,handleSort:J,getSortedData:A}=Bs();Js();const H=(T,O)=>{o({show:!0,message:T,type:O}),setTimeout(()=>o({show:!1,message:"",type:"success"}),3e3)},U=M.filter(T=>{const O=T.task_id.toLowerCase().includes(r.toLowerCase())||T.stock_name.toLowerCase().includes(r.toLowerCase())||T.staff_name.toLowerCase().includes(r.toLowerCase())||T.process_name.toLowerCase().includes(r.toLowerCase()),be=d==="all"||T.stock_name.toLowerCase().includes(d.toLowerCase()),Se=b==="all"||T.process_name.toLowerCase().includes(b.toLowerCase()),Ie=q==="all"||T.staff_name.toLowerCase().includes(q.toLowerCase()),Je=(!x.from||T.date_assigned>=x.from)&&(!x.to||T.date_assigned<=x.to);return O&&be&&Se&&Ie&&Je}),ie=Array.from(new Set(M.map(T=>T.stock_name))).sort(),me=Array.from(new Set(M.map(T=>T.process_name))).sort(),ve=Array.from(new Set(M.map(T=>T.staff_name))).sort(),z=U.length,pe=Math.ceil(z/k),ge=(E-1)*k,Pe=ge+k,Ze=U.slice(ge,Pe);u.useEffect(()=>{$(1)},[r,d,b,q,x,k]);const xe=async T=>{try{n?(await m.mutateAsync({id:n.$id,data:T}),H("Pre-production task updated successfully","success")):(await w.mutateAsync(T),H("Pre-production task created successfully","success")),a(!1),i(null)}catch(O){console.error("Error saving task:",O),H("Failed to save task","error")}},ke=T=>{i(T),a(!0)},ns=async T=>{if(window.confirm("Are you sure you want to delete this task?"))try{await F.mutateAsync(T.$id),H("Pre-production task deleted successfully","success")}catch(O){console.error("Error deleting task:",O),H("Failed to delete task","error")}},We=async()=>{if(l.length===0){H("Please select tasks to delete","error");return}if(window.confirm(`Are you sure you want to delete ${l.length} selected task(s)?`))try{await Promise.all(l.map(T=>F.mutateAsync(T.$id))),h([]),H(`${l.length} tasks deleted successfully`,"success")}catch(T){console.error("Error deleting tasks:",T),H("Failed to delete selected tasks","error")}},Ge=()=>{if(l.length===0){H("Please select tasks to export","error");return}H(`Exporting ${l.length} selected task(s)...`,"success")};return Q?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Pre-Production Tasks"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage pre-production processing tasks"})]}),e.jsx(G,{children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"text-center py-12 text-red-600",children:[e.jsx("p",{className:"text-lg mb-2",children:"Error loading tasks"}),e.jsx("p",{className:"text-sm mb-4",children:Q.message}),e.jsx(D,{onClick:()=>V(),variant:"outline",children:"Retry"})]})})})]}):e.jsxs("div",{className:"space-y-6",children:[c.show&&e.jsx("div",{className:`fixed top-4 right-4 px-4 py-2 rounded-md shadow-lg z-50 ${c.type==="success"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300"}`,children:c.message}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Pre-Production Tasks"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage pre-production processing tasks"})]}),e.jsxs(D,{className:"bg-primary hover:bg-primary/90",onClick:()=>{i(null),a(!0)},children:[e.jsx(fs,{className:"h-4 w-4 mr-2"}),"Add New"]})]}),e.jsx(G,{children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(ts,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(B,{placeholder:"Search tasks...",className:"pl-10",value:r,onChange:T=>s(T.target.value)})]}),j&&p&&e.jsx(gs,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:p.exportColumns.filter(T=>T.required).map(T=>T.exportHeader),optionalColumns:p.exportColumns.filter(T=>!T.required).map(T=>T.exportHeader),validationRules:I,onImportComplete:T=>{T.successfulRows>0&&(V(),H(`${T.successfulRows} pre-production tasks imported successfully.`,"success"))}},variant:"outline"}),p&&e.jsx(xs,{data:U.map(T=>{const O={};return p.exportColumns.forEach(be=>{const Se=T[be.dataKey];O[be.exportHeader]=be.formatter?be.formatter(Se):Se}),O}),headers:p.exportColumns.map(T=>T.exportHeader),filename:"pre-production-tasks",variant:"outline"})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs(te,{value:d,onValueChange:f,children:[e.jsx(ee,{className:"w-[180px]",children:e.jsx(ae,{placeholder:"Stock Name"})}),e.jsxs(se,{children:[e.jsx(v,{value:"all",children:"All Stocks"}),ie.map(T=>e.jsx(v,{value:T,children:T},T))]})]}),e.jsxs(te,{value:b,onValueChange:N,children:[e.jsx(ee,{className:"w-[180px]",children:e.jsx(ae,{placeholder:"Process"})}),e.jsxs(se,{children:[e.jsx(v,{value:"all",children:"All Processes"}),me.map(T=>e.jsx(v,{value:T,children:T},T))]})]}),e.jsxs(te,{value:q,onValueChange:L,children:[e.jsx(ee,{className:"w-[180px]",children:e.jsx(ae,{placeholder:"Staff Name"})}),e.jsxs(se,{children:[e.jsx(v,{value:"all",children:"All Staff"}),ve.map(T=>e.jsx(v,{value:T,children:T},T))]})]}),e.jsx(B,{type:"date",placeholder:"From Date",className:"w-[150px]",value:x.from,onChange:T=>C(O=>({...O,from:T.target.value}))}),e.jsx(B,{type:"date",placeholder:"To Date",className:"w-[150px]",value:x.to,onChange:T=>C(O=>({...O,to:T.target.value}))})]})]})})}),e.jsx(G,{children:e.jsxs(Z,{className:"pt-6",children:[l.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 p-3 bg-muted rounded-md",children:[e.jsxs("span",{className:"text-sm font-medium",children:[l.length," selected"]}),e.jsx(D,{variant:"destructive",size:"sm",onClick:We,children:"Delete Selected"}),e.jsx(D,{variant:"outline",size:"sm",onClick:Ge,children:"Export Selected"})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",ge+1," to ",Math.min(Pe,z)," of ",z," records"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Records per page:"}),e.jsxs(te,{value:k.toString(),onValueChange:T=>R(Number(T)),children:[e.jsx(ee,{className:"w-[100px]",children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"50",children:"50"}),e.jsx(v,{value:"100",children:"100"}),e.jsx(v,{value:"500",children:"500"})]})]})]})]}),e.jsx("div",{className:"border rounded-md",children:e.jsx("div",{className:"overflow-auto",style:{maxHeight:"600px"},children:e.jsx(Gs,{data:A(Ze.map(T=>({...T,formattedDateAssigned:new Date(T.date_assigned).toLocaleDateString("en-GB"),formattedDateCompleted:T.date_completed?new Date(T.date_completed).toLocaleDateString("en-GB"):"-"}))),columns:[{key:"task_id",label:"Task ID",sortable:!0,dataType:"string"},{key:"stock_name",label:"Stock Name",sortable:!0,dataType:"string"},{key:"stock_source",label:"Stock Source",sortable:!0,dataType:"string"},{key:"formattedDateAssigned",label:"Date Assigned",sortable:!0,dataType:"date"},{key:"process_name",label:"Process",sortable:!0,dataType:"string"},{key:"assigned_quantity",label:"Assigned Qty",sortable:!0,dataType:"number",align:"right",headerClassName:"bg-purple-50",cellClassName:"bg-purple-50 font-medium"},{key:"staff_name",label:"Staff Name",sortable:!0,dataType:"string"},{key:"formattedDateCompleted",label:"Date Completed",sortable:!0,dataType:"date"},{key:"completed_quantity",label:"Completed Qty",sortable:!0,dataType:"number",align:"right",headerClassName:"bg-green-50",cellClassName:"bg-green-50 font-medium"},{key:"wastage_quantity",label:"Wastage Qty",sortable:!0,dataType:"number",align:"right"},{key:"remarks",label:"Remarks",sortable:!0,dataType:"string"},{key:"status",label:"Status",sortable:!0,dataType:"string",formatter:T=>e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${T==="completed"?"bg-green-100 text-green-800":T==="in_progress"?"bg-yellow-100 text-yellow-800":T==="pending"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:T==="in_progress"?"In Progress":T.charAt(0).toUpperCase()+T.slice(1)})}],onSort:J,currentSort:P,loading:S,maxHeight:"none",stickyHeader:!0,bordered:!1,searchable:!1,selectable:!0,selectedRows:l,onSelectionChange:h,rowKey:"$id",actions:[vt.edit(T=>ke(T)),vt.delete(T=>ns(T))],emptyMessage:"No pre-production tasks found"})})}),pe>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx(D,{variant:"outline",size:"sm",onClick:()=>$(T=>Math.max(1,T-1)),disabled:E===1,children:"Previous"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",E," of ",pe]})}),e.jsx(D,{variant:"outline",size:"sm",onClick:()=>$(T=>Math.min(pe,T+1)),disabled:E===pe,children:"Next"})]})]})}),e.jsx(cc,{isOpen:t,onClose:()=>{a(!1),i(null)},onSubmit:xe,editingTask:n,isLoading:w.isPending||m.isPending})]})},mc=({items:r,onItemsChange:s,availableStocks:t,isLoading:a=!1})=>{const n=()=>{const c={stock_id:"",stock_name:"",quantity:0,action:""};s([...r,c])},i=c=>{const o=r.filter((d,f)=>f!==c);s(o)},l=(c,o,d)=>{const f=[...r];if(f[c]={...f[c],[o]:d},o==="stock_id"){const b=t.find(N=>N.$id===d);f[c].stock_name=b?.stock_name||""}s(f)},h=()=>r.reduce((c,o)=>c+(o.quantity||0),0);return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(_,{className:"text-xs font-medium",children:"Stock Items"}),e.jsxs(D,{type:"button",variant:"outline",size:"sm",onClick:n,disabled:a,className:"h-7 px-2 text-xs",children:[e.jsx(fs,{className:"h-3 w-3 mr-1"}),"Add Row"]})]}),r.length===0?e.jsxs("div",{className:"text-center py-4 text-muted-foreground border-2 border-dashed rounded-lg",children:[e.jsx("p",{className:"text-xs",children:"No stock items added"}),e.jsx("p",{className:"text-xs",children:'Click "Add Row" to add stock items'})]}):e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsx("div",{className:"max-h-64 overflow-y-auto",children:e.jsxs(ds,{children:[e.jsx(us,{className:"sticky top-0 bg-white z-10",children:e.jsxs(we,{children:[e.jsx(X,{className:"text-xs py-2",children:"Stock Name"}),e.jsx(X,{className:"text-xs py-2 w-24",children:"Qty (kg)"}),e.jsx(X,{className:"text-xs py-2 w-20",children:"Action"}),e.jsx(X,{className:"text-xs py-2 w-12",children:"Remove"})]})}),e.jsx(ms,{children:r.map((c,o)=>e.jsxs(we,{className:"h-10",children:[e.jsx(Y,{className:"py-1",children:e.jsxs(te,{value:c.stock_id,onValueChange:d=>l(o,"stock_id",d),disabled:a,children:[e.jsx(ee,{className:"h-7 text-xs",children:e.jsx(ae,{placeholder:"Select Stock"})}),e.jsx(se,{children:t.map(d=>e.jsxs(v,{value:d.$id||"",children:[d.stock_name," (",d.stock_code,")"]},d.$id))})]})}),e.jsx(Y,{className:"py-1",children:e.jsx(B,{type:"number",step:"0.01",min:"0",value:c.quantity||"",onChange:d=>l(o,"quantity",parseFloat(d.target.value)||0),placeholder:"0",disabled:a,className:"h-7 text-xs",maxLength:10})}),e.jsx(Y,{className:"py-1",children:e.jsx(B,{value:c.action||"",onChange:d=>l(o,"action",d.target.value),placeholder:"Action",disabled:a,className:"h-7 text-xs"})}),e.jsx(Y,{className:"py-1",children:e.jsx(D,{type:"button",variant:"ghost",size:"sm",className:"h-6 w-6 p-0 text-red-500 hover:text-red-700 hover:bg-red-50",onClick:()=>i(o),disabled:a,children:e.jsx(Ts,{className:"h-3 w-3"})})})]},o))})]})})}),r.length>0&&e.jsx("div",{className:"flex justify-end bg-gray-50 px-3 py-1 rounded",children:e.jsxs("div",{className:"text-xs font-medium",children:["Total Quantity: ",h().toFixed(2)," kg"]})})]})},hc=[{value:"pending",label:"Pending"},{value:"in_progress",label:"In Progress"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"}],pc=({isOpen:r,onClose:s,onSubmit:t,editingTask:a,isLoading:n=!1})=>{const{data:i}=An(),{data:l}=La(),{data:h}=Js(),{data:c}=qn(),o=h.filter(p=>{const I=p.department?.toLowerCase();return I&&I==="production"?!0:p.process_name?.toLowerCase()==="grinding"}),[d,f]=u.useState({task_id:"",date_assigned:new Date().toISOString().split("T")[0],raw_product_id:"",process_id:"",staff_id:"",source_process_id:"",completed_quantity:"",date_completed:"",wastage_quantity:"",remarks:"",status:"pending"}),[b,N]=u.useState([]),[q,L]=u.useState({}),[x,C]=u.useState(null),E=new Date,$=Us(E),k=Os(E),{statusRecords:R}=Ma($.toISOString().split("T")[0],k.toISOString().split("T")[0],{processId:void 0}),{statusRecords:M}=$a($.toISOString().split("T")[0],k.toISOString().split("T")[0],{processId:void 0}),S=()=>{if(!d.source_process_id||!b.length||!d.raw_product_id){C(null);return}const p=b.reduce((z,pe)=>z+(pe.quantity||0),0);if(p<=0){C({isValid:!1,availableQty:0,requiredQty:p,stockName:"Stock Items",stockSource:"Unknown",error:"Invalid quantity",validationClass:"bg-yellow-50 text-yellow-700 border-yellow-200",validationMessage:"Total quantity must be greater than 0"});return}const I=h?.find(z=>z.$id===d.source_process_id),j=c?.find(z=>z.$id===d.raw_product_id);if(!I||!j){C({isValid:!1,availableQty:0,requiredQty:p,stockName:j?.raw_product||"Unknown Product",stockSource:I?.process_name||"Unknown Process",error:"Missing reference data",validationClass:"bg-red-50 text-red-700 border-red-200",validationMessage:"Source process or raw product not found"});return}const P="Pre-Production Status",A=b[0]?.stock_name||j.raw_product;let H=M?.find(z=>z.stock_name===A&&z.process===I.process_name);if(!H&&A&&(H=M?.find(z=>z.stock_name?.toLowerCase().includes(A.toLowerCase().split("(")[0].trim())&&z.process===I.process_name)),!H){const z=A?.toLowerCase().split("(")[0].trim()||j.raw_product?.toLowerCase();H=M?.find(pe=>pe.process===I.process_name&&pe.stock_name?.toLowerCase().includes(z))}const U=H?.closing_balance??0,ie=U>=p;console.log("ðŸ” RTQV Production Status Check (Enhanced):",{raw_product:j.raw_product,stock_name_from_items:A,source_process:I.process_name,statusRecord_found:!!H,statusRecord_stock_name:H?.stock_name,statusRecord_process:H?.process,closing_balance:H?.closing_balance,availableQty:U,totalRequiredQty:p,dataSource:P,forced_fresh:!0,stock_items:b.map(z=>({stock_name:z.stock_name,quantity:z.quantity})),all_preproduction_records:M?.map(z=>({stock_name:z.stock_name,process:z.process,closing_balance:z.closing_balance}))});let me="",ve="";ie?(me="bg-green-50 text-green-700 border-green-200",ve=`âœ“ Available: ${U}kg (Required: ${p}kg)`):U===0?(me="bg-red-50 text-red-700 border-red-200",ve=`âœ— Out of stock (Required: ${p}kg)`):(me="bg-orange-50 text-orange-700 border-orange-200",ve=`âš  Insufficient stock: ${U}kg available (Required: ${p}kg)`),C({isValid:ie,availableQty:U,requiredQty:p,stockName:A||j.raw_product,stockSource:I.process_name,dataSource:P,isLoading:!1,validationClass:me,validationMessage:ve})};u.useEffect(()=>{S()},[d.source_process_id,d.raw_product_id,b,h,c,R,M]);const Q=h.filter(p=>p.process_name==="RFP");u.useEffect(()=>{if(r)if(a)f({task_id:a.task_id||"",date_assigned:a.date||"",raw_product_id:a.raw_product_id||"",process_id:a.process_id||"",staff_id:a.staff_id||"",source_process_id:a.source_process_id||"",completed_quantity:a.completed_quantity?.toString()||"",date_completed:a.date_completed||"",wastage_quantity:a.wastage_quantity?.toString()||"",remarks:a.remarks||"",status:a.status||"pending"}),a.stock_items&&N(a.stock_items.map(p=>({stock_id:p.stock_id,stock_name:p.stock_name,quantity:p.quantity,action:p.action||""})));else{const p=`PROD${Date.now().toString().slice(-6)}`;f({task_id:p,date_assigned:new Date().toISOString().split("T")[0],raw_product_id:"",process_id:"",staff_id:"",source_process_id:"",completed_quantity:"",date_completed:"",wastage_quantity:"",remarks:"",status:"pending"}),N([])}},[a,r]);const V=()=>b.reduce((p,I)=>p+(I.quantity||0),0),w=()=>{const p={};return d.task_id.trim()||(p.task_id="Task ID is required"),d.date_assigned||(p.date_assigned="Date is required"),d.raw_product_id||(p.raw_product_id="Raw product is required"),d.process_id||(p.process_id="Process is required"),d.staff_id||(p.staff_id="Staff is required"),d.source_process_id||(p.source_process_id="Source process is required"),(!d.completed_quantity||parseFloat(d.completed_quantity)<=0)&&(p.completed_quantity="Completed quantity is required and must be greater than 0"),b.length===0&&(p.stock_items="At least one stock item is required"),d.wastage_quantity&&parseFloat(d.wastage_quantity)<0&&(p.wastage_quantity="Wastage quantity cannot be negative"),b.forEach((I,j)=>{I.stock_id||(p[`stock_item_${j}_stock`]=`Stock is required for item ${j+1}`),(!I.quantity||I.quantity<=0)&&(p[`stock_item_${j}_quantity`]=`Quantity must be greater than 0 for item ${j+1}`)}),L(p),Object.keys(p).length===0},m=p=>{if(p.preventDefault(),!w())return;const I={task_id:d.task_id,date:d.date_assigned,raw_product_id:d.raw_product_id,process_id:d.process_id,staff_id:d.staff_id,source_process_id:d.source_process_id,assigned_quantity:V(),completed_quantity:parseFloat(d.completed_quantity),wastage_quantity:d.wastage_quantity?parseFloat(d.wastage_quantity):void 0,remarks:d.remarks||void 0,status:d.status};d.date_completed&&d.date_completed.trim()!==""&&(I.date_completed=d.date_completed),t({taskData:I,stockItems:b})},F=()=>{f({task_id:"",date_assigned:new Date().toISOString().split("T")[0],raw_product_id:"",process_id:"",staff_id:"",source_process_id:"",completed_quantity:"",date_completed:"",wastage_quantity:"",remarks:"",status:"pending"}),N([]),L({}),s()};return e.jsx(Qe,{open:r,onOpenChange:F,children:e.jsxs(Ve,{className:"sm:max-w-[800px] max-w-[95vw] max-h-[90vh] overflow-y-auto",children:[e.jsxs(Be,{className:"pb-2",children:[e.jsx(ze,{className:"text-lg",children:a?"Edit Production Task":"Add New Production Task"}),e.jsx(Ye,{className:"text-sm",children:a?"Update the production task details below.":"Fill in the details to create a new production task."})]}),e.jsxs("form",{onSubmit:m,children:[e.jsxs("div",{className:"grid gap-3 py-3",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[e.jsxs("div",{children:[e.jsx(_,{htmlFor:"task_id",className:"text-xs font-medium",children:"Task ID *"}),e.jsx(B,{id:"task_id",value:d.task_id,onChange:p=>f({...d,task_id:p.target.value}),className:`h-8 text-sm ${q.task_id?"border-red-500":""}`,maxLength:15}),q.task_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:q.task_id})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"date_assigned",className:"text-xs font-medium",children:"Date *"}),e.jsx(B,{id:"date_assigned",type:"date",value:d.date_assigned,onChange:p=>f({...d,date_assigned:p.target.value}),className:`h-8 text-sm ${q.date_assigned?"border-red-500":""}`}),q.date_assigned&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:q.date_assigned})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"process_id",className:"text-xs font-medium",children:"Process *"}),e.jsxs(te,{value:d.process_id,onValueChange:p=>f({...d,process_id:p}),children:[e.jsx(ee,{className:`h-8 text-sm ${q.process_id?"border-red-500":""}`,children:e.jsx(ae,{placeholder:"Select Process"})}),e.jsx(se,{children:o.map(p=>e.jsx(v,{value:p.$id||"",children:p.process_name},p.$id))})]}),q.process_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:q.process_id})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"source_process_id",className:"text-xs font-medium",children:"Source Process *"}),e.jsxs(te,{value:d.source_process_id,onValueChange:p=>f({...d,source_process_id:p}),children:[e.jsx(ee,{className:`h-8 text-sm ${q.source_process_id?"border-red-500":""}`,children:e.jsx(ae,{placeholder:"Select Source"})}),e.jsx(se,{children:Q.map(p=>e.jsx(v,{value:p.$id||"",children:p.process_name},p.$id))})]}),q.source_process_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:q.source_process_id})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(_,{htmlFor:"raw_product_id",className:"text-xs font-medium",children:"Raw Product *"}),e.jsxs(te,{value:d.raw_product_id,onValueChange:p=>f({...d,raw_product_id:p}),children:[e.jsx(ee,{className:`h-8 text-sm ${q.raw_product_id?"border-red-500":""}`,children:e.jsx(ae,{placeholder:"Select Raw Product"})}),e.jsx(se,{children:c.map(p=>e.jsx(v,{value:p.$id||"",children:p.raw_product},p.$id))})]}),q.raw_product_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:q.raw_product_id})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"staff_id",className:"text-xs font-medium",children:"Staff Name *"}),e.jsxs(te,{value:d.staff_id,onValueChange:p=>f({...d,staff_id:p}),children:[e.jsx(ee,{className:`h-8 text-sm ${q.staff_id?"border-red-500":""}`,children:e.jsx(ae,{placeholder:"Select Staff"})}),e.jsx(se,{children:l.map(p=>e.jsx(v,{value:p.$id||"",children:p.staff_name},p.$id))})]}),q.staff_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:q.staff_id})]})]}),e.jsxs("div",{children:[e.jsx(_,{className:"text-base font-semibold",children:"Stock Items"}),e.jsx(mc,{items:b,onItemsChange:N,availableStocks:i,isLoading:n}),q.stock_items&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:q.stock_items}),x&&e.jsxs("div",{className:`mt-2 p-3 rounded-md border text-sm ${x.validationClass}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("div",{className:"font-medium",children:x.stockName}),e.jsxs("div",{className:"text-xs opacity-75",children:["Source: ",x.dataSource]})]}),e.jsx("div",{className:"mb-1",children:x.validationMessage}),x.error&&e.jsxs("div",{className:"text-xs mt-1 opacity-75",children:["Error: ",x.error]}),x.isLoading&&e.jsxs("div",{className:"flex items-center gap-2 text-xs mt-1",children:[e.jsx("div",{className:"animate-spin h-3 w-3 border border-current border-t-transparent rounded-full"}),"Loading fresh data from ",x.dataSource,"..."]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(_,{htmlFor:"assigned_quantity",className:"text-xs font-medium",children:"Assigned Qty (Auto-calculated)"}),e.jsxs("div",{className:"relative",children:[e.jsx(B,{id:"assigned_quantity",type:"number",value:V().toFixed(2),disabled:!0,className:"bg-gray-50 h-8 text-sm pr-8",maxLength:10}),e.jsx("span",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-xs text-gray-500",children:"kg"})]})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"completed_quantity",className:"text-xs font-medium",children:"Completed Qty *"}),e.jsxs("div",{className:"relative",children:[e.jsx(B,{id:"completed_quantity",type:"number",step:"0.01",min:"0",value:d.completed_quantity,onChange:p=>f({...d,completed_quantity:p.target.value}),className:`h-8 text-sm pr-8 ${q.completed_quantity?"border-red-500":""}`,maxLength:10}),e.jsx("span",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-xs text-gray-500",children:"kg"})]}),q.completed_quantity&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:q.completed_quantity})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"wastage_quantity",className:"text-xs font-medium",children:"Wastage Qty"}),e.jsxs("div",{className:"relative",children:[e.jsx(B,{id:"wastage_quantity",type:"number",step:"0.01",min:"0",value:d.wastage_quantity,onChange:p=>f({...d,wastage_quantity:p.target.value}),className:`h-8 text-sm pr-8 ${q.wastage_quantity?"border-red-500":""}`,maxLength:10}),e.jsx("span",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-xs text-gray-500",children:"kg"})]}),q.wastage_quantity&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:q.wastage_quantity})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(_,{htmlFor:"date_completed",className:"text-xs font-medium",children:"Date Completed"}),e.jsx(B,{id:"date_completed",type:"date",value:d.date_completed,onChange:p=>f({...d,date_completed:p.target.value}),className:"h-8 text-sm"})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"status",className:"text-xs font-medium",children:"Status"}),e.jsxs(te,{value:d.status,onValueChange:p=>f({...d,status:p}),children:[e.jsx(ee,{className:"h-8 text-sm",children:e.jsx(ae,{})}),e.jsx(se,{children:hc.map(p=>e.jsx(v,{value:p.value,children:p.label},p.value))})]})]})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"remarks",className:"text-xs font-medium",children:"Remarks"}),e.jsx(Hs,{id:"remarks",value:d.remarks,onChange:p=>f({...d,remarks:p.target.value}),placeholder:"Enter any remarks",rows:2,className:"text-sm resize-none"})]})]}),e.jsxs(He,{className:"pt-3 flex-col sm:flex-row gap-2",children:[e.jsx(D,{type:"button",variant:"outline",onClick:F,className:"h-8 px-4 text-sm w-full sm:w-auto",children:"Cancel"}),e.jsx(D,{type:"submit",disabled:n,className:"h-8 px-4 text-sm w-full sm:w-auto",children:n?"Saving...":a?"Update":"Save"})]})]})]})})},xc=()=>{const[r,s]=u.useState(""),[t,a]=u.useState(!1),[n,i]=u.useState(null),[l,h]=u.useState([]),[c,o]=u.useState({show:!1,message:"",type:"success"}),[d,f]=u.useState("all"),[b,N]=u.useState("all"),[q,L]=u.useState("all"),[x,C]=u.useState({from:"",to:""}),[E,$]=u.useState(1),[k,R]=u.useState(50),{tasks:M,isLoading:S,error:Q,refetch:V}=Pn(),{createTask:w,updateTask:m,deleteTask:F}=Fl(),{config:p}=bs("production-tasks"),{validationRules:I,canImport:j}=Ns("production-tasks"),{currentSort:P,handleSort:J,getSortedData:A}=Bs();Js();const H=(T,O)=>{o({show:!0,message:T,type:O}),setTimeout(()=>o({show:!1,message:"",type:"success"}),3e3)},U=M.filter(T=>{const O=T.task_id.toLowerCase().includes(r.toLowerCase())||T.raw_product_name.toLowerCase().includes(r.toLowerCase())||T.staff_name.toLowerCase().includes(r.toLowerCase())||T.process_name.toLowerCase().includes(r.toLowerCase()),be=d==="all"||T.raw_product_name.toLowerCase().includes(d.toLowerCase()),Se=b==="all"||T.process_name.toLowerCase().includes(b.toLowerCase()),Ie=q==="all"||T.staff_name.toLowerCase().includes(q.toLowerCase()),Je=(!x.from||T.date>=x.from)&&(!x.to||T.date<=x.to);return O&&be&&Se&&Ie&&Je}),ie=Array.from(new Set(M.map(T=>T.raw_product_name))).sort(),me=Array.from(new Set(M.map(T=>T.process_name))).sort(),ve=Array.from(new Set(M.map(T=>T.staff_name))).sort(),z=U.length,pe=Math.ceil(z/k),ge=(E-1)*k,Pe=ge+k,Ze=U.slice(ge,Pe);u.useEffect(()=>{$(1)},[r,d,b,q,x,k]);const xe=async T=>{try{n?(await m.mutateAsync({id:n.$id,taskData:T.taskData,stockItems:T.stockItems}),H("Production task updated successfully","success")):(await w.mutateAsync(T),H("Production task created successfully","success")),a(!1),i(null)}catch(O){console.error("Error saving task:",O),H("Failed to save task","error")}},ke=T=>{i(T),a(!0)},ns=async T=>{if(window.confirm("Are you sure you want to delete this task?"))try{await F.mutateAsync(T.$id),H("Production task deleted successfully","success")}catch(O){console.error("Error deleting task:",O),H("Failed to delete task","error")}},We=async()=>{if(l.length===0){H("Please select tasks to delete","error");return}if(window.confirm(`Are you sure you want to delete ${l.length} selected task(s)?`))try{await Promise.all(l.map(T=>F.mutateAsync(T.$id))),h([]),H(`${l.length} tasks deleted successfully`,"success")}catch(T){console.error("Error deleting tasks:",T),H("Failed to delete selected tasks","error")}},Ge=()=>{if(l.length===0){H("Please select tasks to export","error");return}H(`Exporting ${l.length} selected task(s)...`,"success")};return Q?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Production Tasks"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage production processing tasks"})]}),e.jsx(G,{children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"text-center py-12 text-red-600",children:[e.jsx("p",{className:"text-lg mb-2",children:"Error loading tasks"}),e.jsx("p",{className:"text-sm mb-4",children:Q.message}),e.jsx(D,{onClick:()=>V(),variant:"outline",children:"Retry"})]})})})]}):e.jsxs("div",{className:"space-y-6",children:[c.show&&e.jsx("div",{className:`fixed top-4 right-4 px-4 py-2 rounded-md shadow-lg z-50 ${c.type==="success"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300"}`,children:c.message}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Production Tasks"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage production processing tasks"})]}),e.jsxs(D,{className:"bg-primary hover:bg-primary/90 w-full sm:w-auto",onClick:()=>{i(null),a(!0)},children:[e.jsx(fs,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"sm:inline",children:"Add New"})]})]}),e.jsx(G,{children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4 items-stretch sm:items-center",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(ts,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(B,{placeholder:"Search tasks...",className:"pl-10",value:r,onChange:T=>s(T.target.value)})]}),j&&p&&e.jsx(gs,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:p.exportColumns.filter(T=>T.required).map(T=>T.exportHeader),optionalColumns:p.exportColumns.filter(T=>!T.required).map(T=>T.exportHeader),validationRules:I,onImportComplete:T=>{T.successfulRows>0&&(V(),H(`${T.successfulRows} production tasks imported successfully.`,"success"))}},variant:"outline"}),p&&e.jsx(xs,{data:U.map(T=>{const O={};return p.exportColumns.forEach(be=>{const Se=T[be.dataKey];O[be.exportHeader]=be.formatter?be.formatter(Se):Se}),O}),headers:p.exportColumns.map(T=>T.exportHeader),filename:"production-tasks",variant:"outline"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-3 sm:gap-4",children:[e.jsxs(te,{value:d,onValueChange:f,children:[e.jsx(ee,{className:"w-full",children:e.jsx(ae,{placeholder:"Raw Product"})}),e.jsxs(se,{children:[e.jsx(v,{value:"all",children:"All Raw Products"}),ie.map(T=>e.jsx(v,{value:T,children:T},T))]})]}),e.jsxs(te,{value:b,onValueChange:N,children:[e.jsx(ee,{className:"w-full",children:e.jsx(ae,{placeholder:"Process"})}),e.jsxs(se,{children:[e.jsx(v,{value:"all",children:"All Processes"}),me.map(T=>e.jsx(v,{value:T,children:T},T))]})]}),e.jsxs(te,{value:q,onValueChange:L,children:[e.jsx(ee,{className:"w-full",children:e.jsx(ae,{placeholder:"Staff Name"})}),e.jsxs(se,{children:[e.jsx(v,{value:"all",children:"All Staff"}),ve.map(T=>e.jsx(v,{value:T,children:T},T))]})]}),e.jsx(B,{type:"date",placeholder:"From Date",className:"w-full",value:x.from,onChange:T=>C(O=>({...O,from:T.target.value}))}),e.jsx(B,{type:"date",placeholder:"To Date",className:"w-full",value:x.to,onChange:T=>C(O=>({...O,to:T.target.value}))})]})]})})}),e.jsx(G,{children:e.jsxs(Z,{className:"pt-6",children:[l.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 p-3 bg-muted rounded-md",children:[e.jsxs("span",{className:"text-sm font-medium",children:[l.length," selected"]}),e.jsx(D,{variant:"destructive",size:"sm",onClick:We,children:"Delete Selected"}),e.jsx(D,{variant:"outline",size:"sm",onClick:Ge,children:"Export Selected"})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",ge+1," to ",Math.min(Pe,z)," of ",z," records"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Records per page:"}),e.jsxs(te,{value:k.toString(),onValueChange:T=>R(Number(T)),children:[e.jsx(ee,{className:"w-[100px]",children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"50",children:"50"}),e.jsx(v,{value:"100",children:"100"}),e.jsx(v,{value:"500",children:"500"})]})]})]})]}),e.jsx("div",{className:"border rounded-md",children:e.jsx("div",{className:"overflow-auto",style:{maxHeight:"600px"},children:e.jsx(Gs,{data:A(Ze.map(T=>({...T,formattedDate:new Date(T.date).toLocaleDateString("en-GB")}))),columns:[{key:"task_id",label:"Task ID",sortable:!0,dataType:"string"},{key:"formattedDate",label:"Date",sortable:!0,dataType:"date"},{key:"raw_product_name",label:"Raw Product",sortable:!0,dataType:"string"},{key:"process_name",label:"Process",sortable:!0,dataType:"string"},{key:"staff_name",label:"Staff Name",sortable:!0,dataType:"string"},{key:"assigned_quantity",label:"Assigned Qty",sortable:!0,dataType:"number",align:"right",headerClassName:"bg-purple-50",cellClassName:"bg-purple-50 font-medium"},{key:"completed_quantity",label:"Completed Qty",sortable:!0,dataType:"number",align:"right",headerClassName:"bg-green-50",cellClassName:"bg-green-50 font-medium"},{key:"wastage_quantity",label:"Wastage Qty",sortable:!0,dataType:"number",align:"right"},{key:"status",label:"Status",sortable:!0,dataType:"string",formatter:T=>e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${T==="completed"?"bg-green-100 text-green-800":T==="in_progress"?"bg-yellow-100 text-yellow-800":T==="pending"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:T==="in_progress"?"In Progress":T.charAt(0).toUpperCase()+T.slice(1)})}],onSort:J,currentSort:P,loading:S,maxHeight:"none",stickyHeader:!0,bordered:!1,searchable:!1,selectable:!0,selectedRows:l,onSelectionChange:h,rowKey:"$id",actions:[vt.edit(T=>ke(T)),vt.delete(T=>ns(T))],emptyMessage:"No production tasks found"})})}),pe>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx(D,{variant:"outline",size:"sm",onClick:()=>$(T=>Math.max(1,T-1)),disabled:E===1,children:"Previous"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",E," of ",pe]})}),e.jsx(D,{variant:"outline",size:"sm",onClick:()=>$(T=>Math.min(pe,T+1)),disabled:E===pe,children:"Next"})]})]})}),e.jsx(pc,{isOpen:t,onClose:()=>{a(!1),i(null)},onSubmit:xe,editingTask:n,isLoading:w.isPending||m.isPending})]})},gc=[{value:"pending",label:"Pending"},{value:"in_progress",label:"In Progress"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"}],fc=({isOpen:r,onClose:s,onSubmit:t,editingTask:a,isLoading:n=!1})=>{const{data:i}=La(),{data:l}=Js(),{data:h}=tc(),{data:c}=qn(),[o,d]=u.useState({task_id:"",date_assigned:new Date().toISOString().split("T")[0],date_completed:"",raw_product_id:"",source_process_id:"",source_quantity:"",sku:"",product_id:"",process_id:"",staff_id:"",completed_quantity:"",wastage_quantity:"",remarks:"",status:"pending"}),[f,b]=u.useState({}),[N,q]=u.useState(null),L=new Date,x=Us(L),C=Os(L),{statusRecords:E}=Fn(x.toISOString().split("T")[0],C.toISOString().split("T")[0]),{statusRecords:$}=Ma(x.toISOString().split("T")[0],C.toISOString().split("T")[0]),k=()=>{if(!o.source_process_id||!o.source_quantity||!o.product_id){q(null);return}const j=parseFloat(o.source_quantity);if(j<=0){q({isValid:!1,availableQty:0,requiredQty:j,stockName:"Source Material",stockSource:"Unknown",error:"Invalid quantity",validationClass:"bg-yellow-50 text-yellow-700 border-yellow-200",validationMessage:"Source quantity must be greater than 0"});return}const P=l?.find(ge=>ge.$id===o.source_process_id),J=h?.find(ge=>ge.$id===o.product_id);if(!P||!J){q({isValid:!1,availableQty:0,requiredQty:j,stockName:J?.product_name||"Unknown Product",stockSource:P?.process_name||"Unknown Process",error:"Missing reference data",validationClass:"bg-red-50 text-red-700 border-red-200",validationMessage:"Source process or product not found"});return}let A="",H=null,U=0;const ie=P.process_name?.toLowerCase();if(ie==="grinding"){A="Production Status";const ge=J.product_name;if(H=$?.find(Pe=>Pe.stock_name===ge&&Pe.process===P.process_name),!H&&ge){const Pe=ge.toLowerCase().split(" ")[0];H=$?.find(Ze=>Ze.stock_name?.toLowerCase().includes(Pe)&&Ze.process===P.process_name)}H||(H=$?.find(Pe=>Pe.process===P.process_name&&(Pe.stock_name?.toLowerCase().includes("chilli")||Pe.stock_name?.toLowerCase().includes("powder"))))}else ie==="packing"&&(A="Post-Production Status",H=E?.find(ge=>ge.product_name===J.product_name&&ge.process_name===P.process_name));U=H?.closing_balance??0;const me=U>=j;console.log("ðŸ” RTQV Post-Production Status Check (Enhanced):",{product_name:J.product_name,source_process:P.process_name,source_process_type:ie,statusRecord_found:!!H,statusRecord_stock_name:H?.stock_name,statusRecord_process:H?.process,closing_balance:H?.closing_balance,availableQty:U,requiredQty:j,dataSource:A,forced_fresh:!0,all_production_records:ie==="grinding"?$?.map(ge=>({stock_name:ge.stock_name,process:ge.process,closing_balance:ge.closing_balance})):[],all_postproduction_records:ie==="packing"?E?.map(ge=>({product_name:ge.product_name,process_name:ge.process_name,closing_balance:ge.closing_balance})):[]});let ve="",z="";const pe=ie==="grinding"?"kg":"units";me?(ve="bg-green-50 text-green-700 border-green-200",z=`âœ“ Available: ${U}${pe} (Required: ${j}${pe})`):U===0?(ve="bg-red-50 text-red-700 border-red-200",z=`âœ— Out of stock (Required: ${j}${pe})`):(ve="bg-orange-50 text-orange-700 border-orange-200",z=`âš  Insufficient stock: ${U}${pe} available (Required: ${j}${pe})`),q({isValid:me,availableQty:U,requiredQty:j,stockName:J.product_name,stockSource:P.process_name,dataSource:A,isLoading:!1,validationClass:ve,validationMessage:z})};u.useEffect(()=>{k()},[o.source_process_id,o.product_id,o.source_quantity,l,h,E,$]);const R=l.filter(j=>{const P=j.department?.toLowerCase();if(P&&P==="post-production")return!0;const J=j.process_name?.toLowerCase();return["packing","batch coding"].includes(J)});console.log("All Processes:",l.map(j=>j.process_name)),console.log("Post Production Processes:",R.map(j=>j.process_name));const M=l.find(j=>j.$id===o.process_id),S=M?.process_name==="Batch Coding",Q=M?.process_name==="Packing",V=()=>S,m=(()=>{if(!o.process_id)return[];const j=l.find(J=>J.$id===o.process_id);if(!j)return[];const P=j.process_name?.toLowerCase();return P==="packing"?l.filter(J=>J.process_name?.toLowerCase()==="grinding"):P==="batch coding"?l.filter(J=>J.process_name?.toLowerCase()==="packing"):[]})();u.useEffect(()=>{o.process_id&&(d(j=>({...j,source_process_id:"",source_quantity:S?"":j.source_quantity,raw_product_id:S?"":j.raw_product_id})),console.log("Selected Process:",M?.process_name),console.log("Is Batch Coding:",S))},[o.process_id,l,S,M]),u.useEffect(()=>{if(r)if(a){const j=P=>{if(!P)return"";try{const J=new Date(P);return isNaN(J.getTime())?"":J.toISOString().split("T")[0]}catch{return""}};d({task_id:a.task_id,date_assigned:j(a.date),date_completed:j(a.date_completed||""),raw_product_id:a.raw_product_id||"",source_process_id:a.source_process_id,source_quantity:a.source_quantity.toString(),sku:a.sku,product_id:a.product_id,process_id:a.process_id,staff_id:a.staff_id,completed_quantity:a.units?.toString()||"",wastage_quantity:a.wastage_quantity?.toString()||"",remarks:a.remarks||"",status:a.status})}else{const j=`POST${Date.now().toString().slice(-6)}`;d({task_id:j,date_assigned:new Date().toISOString().split("T")[0],date_completed:"",raw_product_id:"",source_process_id:"",source_quantity:"",sku:"",product_id:"",process_id:"",staff_id:"",completed_quantity:"",wastage_quantity:"",remarks:"",status:"pending"})}},[a,r]);const F=()=>{const j={},J=l.find(A=>A.$id===o.process_id)?.process_name==="Batch Coding";return o.task_id.trim()||(j.task_id="Task ID is required"),o.date_assigned||(j.date_assigned="Date is required"),!J&&!o.raw_product_id&&(j.raw_product_id="Raw Product is required"),o.process_id||(j.process_id="Process is required"),o.source_process_id||(j.source_process_id="Source process is required"),!J&&(!o.source_quantity||parseFloat(o.source_quantity)<=0)&&(j.source_quantity="Source quantity must be greater than 0"),o.sku.trim()||(j.sku="SKU is required"),o.product_id||(j.product_id="Product is required"),o.staff_id||(j.staff_id="Staff is required"),o.status==="completed"&&((!o.completed_quantity||parseFloat(o.completed_quantity)<=0)&&(j.completed_quantity="Completed units must be greater than 0"),o.wastage_quantity&&parseFloat(o.wastage_quantity)<0&&(j.wastage_quantity="Wastage quantity cannot be negative")),b(j),Object.keys(j).length===0},p=j=>{if(j.preventDefault(),!F())return;const J=l.find(H=>H.$id===o.process_id)?.process_name==="Batch Coding",A={task_id:o.task_id,date:o.date_assigned,date_completed:o.status==="completed"?o.date_completed:void 0,source_process_id:o.source_process_id,source_quantity:J?0:parseFloat(o.source_quantity)||0,sku:o.sku,product_id:o.product_id,process_id:o.process_id,staff_id:o.staff_id,units:o.completed_quantity?parseFloat(o.completed_quantity):0,wastage_quantity:o.status==="completed"&&o.wastage_quantity?parseFloat(o.wastage_quantity):void 0,remarks:o.remarks||void 0,status:o.status};console.log("ðŸš€ SUBMITTING POST-PRODUCTION TASK DATA:",A),t(A)},I=()=>{d({task_id:"",date_assigned:new Date().toISOString().split("T")[0],date_completed:"",raw_product_id:"",source_process_id:"",source_quantity:"",sku:"",product_id:"",process_id:"",staff_id:"",completed_quantity:"",wastage_quantity:"",remarks:"",status:"pending"}),b({}),s()};return e.jsx(Qe,{open:r,onOpenChange:I,children:e.jsxs(Ve,{className:"sm:max-w-[600px] max-w-[95vw] max-h-[90vh] overflow-y-auto",children:[e.jsxs(Be,{children:[e.jsx(ze,{children:a?"Edit Post-Production Task":"Add New Post-Production Task"}),e.jsx(Ye,{children:a?"Update the post-production task details below.":"Fill in the details to create a new post-production task."})]}),e.jsxs("form",{onSubmit:p,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(_,{htmlFor:"task_id",children:"Task ID *"}),e.jsx(B,{id:"task_id",value:o.task_id,onChange:j=>d({...o,task_id:j.target.value}),className:f.task_id?"border-red-500":""}),f.task_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:f.task_id})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"date_assigned",children:"Date Assigned *"}),e.jsx(B,{id:"date_assigned",type:"date",value:o.date_assigned,onChange:j=>d({...o,date_assigned:j.target.value}),className:f.date_assigned?"border-red-500":""}),f.date_assigned&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:f.date_assigned})]})]}),e.jsxs("div",{children:[e.jsxs(_,{htmlFor:"raw_product_id",children:["Raw Product ",!S&&"*",S&&e.jsx("span",{className:"text-muted-foreground",children:"(N/A for Batch Coding)"})]}),S?e.jsx(B,{value:"N/A",disabled:!0,className:"bg-gray-100 text-muted-foreground"}):e.jsxs(te,{value:o.raw_product_id,onValueChange:j=>d({...o,raw_product_id:j}),children:[e.jsx(ee,{className:f.raw_product_id?"border-red-500":"",children:e.jsx(ae,{placeholder:"Select Raw Product"})}),e.jsx(se,{children:c?.map(j=>e.jsx(v,{value:j.$id||"",children:j.raw_product},j.$id))})]}),f.raw_product_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:f.raw_product_id}),e.jsx("p",{className:"text-muted-foreground text-xs mt-1",children:S?"Batch Coding works with finished products (units), not raw products":"Select the raw product powder (kg) from Grinding process to be packed into units"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(_,{htmlFor:"process_id",children:"Process *"}),e.jsxs(te,{value:o.process_id,onValueChange:j=>d({...o,process_id:j,source_process_id:""}),children:[e.jsx(ee,{className:f.process_id?"border-red-500":"",children:e.jsx(ae,{placeholder:"Select Process"})}),e.jsx(se,{children:R.map(j=>e.jsx(v,{value:j.$id||"",children:j.process_name},j.$id))})]}),f.process_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:f.process_id})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"source_process_id",children:"Source Process *"}),e.jsxs(te,{value:o.source_process_id,onValueChange:j=>d({...o,source_process_id:j}),children:[e.jsx(ee,{className:f.source_process_id?"border-red-500":"",disabled:!o.process_id,children:e.jsx(ae,{placeholder:o.process_id?"Select Source Process":"First select a Process"})}),e.jsx(se,{children:m.map(j=>e.jsx(v,{value:j.$id||"",children:j.process_name},j.$id))})]}),f.source_process_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:f.source_process_id})]})]}),e.jsxs("div",{children:[e.jsxs(_,{htmlFor:"source_quantity",children:[Q?"Source Qty (kg) *":"Source Qty"," ",!V()&&!Q&&"*"]}),e.jsx(B,{id:"source_quantity",type:"number",step:"0.01",min:"0",value:V()?"N/A":o.source_quantity,onChange:j=>!V()&&d({...o,source_quantity:j.target.value}),className:f.source_quantity?"border-red-500":"",disabled:V(),placeholder:V()?"N/A":Q?"Raw product quantity in kg":"Enter source quantity"}),f.source_quantity&&!V()&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:f.source_quantity}),V()&&e.jsx("p",{className:"text-muted-foreground text-xs mt-1",children:"Source quantity is not required for Batch Coding"}),Q&&e.jsx("p",{className:"text-muted-foreground text-xs mt-1",children:"Raw product powder quantity from Grinding process"}),N&&!V()&&e.jsxs("div",{className:`mt-2 p-3 rounded-md border text-sm ${N.validationClass}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("div",{className:"font-medium",children:N.stockName}),e.jsxs("div",{className:"text-xs opacity-75",children:["Source: ",N.dataSource]})]}),e.jsx("div",{className:"mb-1",children:N.validationMessage}),N.error&&e.jsxs("div",{className:"text-xs mt-1 opacity-75",children:["Error: ",N.error]}),N.isLoading&&e.jsxs("div",{className:"flex items-center gap-2 text-xs mt-1",children:[e.jsx("div",{className:"animate-spin h-3 w-3 border border-current border-t-transparent rounded-full"}),"Loading fresh data from ",N.dataSource,"..."]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(_,{htmlFor:"sku",children:"SKU *"}),e.jsx(B,{id:"sku",value:o.sku,onChange:j=>d({...o,sku:j.target.value}),className:f.sku?"border-red-500":"",placeholder:"Enter SKU"}),f.sku&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:f.sku})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"product_id",children:"Product *"}),e.jsxs(te,{value:o.product_id,onValueChange:j=>d({...o,product_id:j}),children:[e.jsx(ee,{className:f.product_id?"border-red-500":"",children:e.jsx(ae,{placeholder:"Select Product"})}),e.jsx(se,{children:h.map(j=>e.jsx(v,{value:j.$id||"",children:j.product},j.$id))})]}),f.product_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:f.product_id})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(_,{htmlFor:"staff_id",children:"Staff Name *"}),e.jsxs(te,{value:o.staff_id,onValueChange:j=>d({...o,staff_id:j}),children:[e.jsx(ee,{className:f.staff_id?"border-red-500":"",children:e.jsx(ae,{placeholder:"Select Staff"})}),e.jsx(se,{children:i.map(j=>e.jsx(v,{value:j.$id||"",children:j.staff_name},j.$id))})]}),f.staff_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:f.staff_id})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"status",children:"Status"}),e.jsxs(te,{value:o.status,onValueChange:j=>d({...o,status:j}),children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsx(se,{children:gc.map(j=>e.jsx(v,{value:j.value,children:j.label},j.value))})]})]})]}),o.status==="completed"&&e.jsxs("div",{className:"grid grid-cols-3 gap-4 p-4 border rounded-md bg-muted/50",children:[e.jsxs("div",{children:[e.jsx(_,{htmlFor:"date_completed",children:"Date Completed *"}),e.jsx(B,{id:"date_completed",type:"date",value:o.date_completed,onChange:j=>d({...o,date_completed:j.target.value}),className:f.date_completed?"border-red-500":""}),f.date_completed&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:f.date_completed})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"completed_quantity",children:"Completed Units *"}),e.jsx(B,{id:"completed_quantity",type:"number",step:"0.01",min:"0",value:o.completed_quantity,onChange:j=>d({...o,completed_quantity:j.target.value}),className:f.completed_quantity?"border-red-500":"",placeholder:"Enter completed units"}),f.completed_quantity&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:f.completed_quantity})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"wastage_quantity",children:"Wastage Qty"}),e.jsx(B,{id:"wastage_quantity",type:"number",step:"0.01",min:"0",value:o.wastage_quantity,onChange:j=>d({...o,wastage_quantity:j.target.value}),className:f.wastage_quantity?"border-red-500":"",placeholder:"Enter wastage qty (optional)"}),f.wastage_quantity&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:f.wastage_quantity})]})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"remarks",children:"Remarks"}),e.jsx(Hs,{id:"remarks",value:o.remarks,onChange:j=>d({...o,remarks:j.target.value}),placeholder:"Enter any remarks",rows:3})]})]}),e.jsxs(He,{className:"flex-col sm:flex-row gap-2 pt-4",children:[e.jsx(D,{type:"button",variant:"outline",onClick:I,className:"w-full sm:w-auto",children:"Cancel"}),e.jsx(D,{type:"submit",disabled:n,className:"w-full sm:w-auto",children:n?"Saving...":a?"Update":"Save"})]})]})]})})},jc=()=>{const[r,s]=u.useState(""),[t,a]=u.useState(!1),[n,i]=u.useState(null),[l,h]=u.useState([]),[c,o]=u.useState({show:!1,message:"",type:"success"}),[d,f]=u.useState("all"),[b,N]=u.useState("all"),[q,L]=u.useState("all"),[x,C]=u.useState({from:"",to:""}),[E,$]=u.useState(1),[k,R]=u.useState(50),{tasks:M,isLoading:S,error:Q,refetch:V}=Tn(),{createTask:w,updateTask:m,deleteTask:F}=Il(),{config:p}=bs("post-production-tasks"),{validationRules:I,canImport:j}=Ns("post-production-tasks"),{currentSort:P,handleSort:J,getSortedData:A}=Bs(),{data:H}=Js(),U=(O,be)=>{o({show:!0,message:O,type:be}),setTimeout(()=>o({show:!1,message:"",type:"success"}),3e3)},ie=M.filter(O=>{const be=O.task_id.toLowerCase().includes(r.toLowerCase())||O.product_name.toLowerCase().includes(r.toLowerCase())||O.staff_name.toLowerCase().includes(r.toLowerCase())||O.process_name.toLowerCase().includes(r.toLowerCase())||O.stock_name&&O.stock_name.toLowerCase().includes(r.toLowerCase())||O.sku&&O.sku.toLowerCase().includes(r.toLowerCase()),Se=d==="all"||O.product_name.toLowerCase().includes(d.toLowerCase()),Ie=b==="all"||O.process_name.toLowerCase().includes(b.toLowerCase()),Je=q==="all"||O.staff_name.toLowerCase().includes(q.toLowerCase()),ls=(!x.from||O.date_assigned>=x.from)&&(!x.to||O.date_assigned<=x.to);return be&&Se&&Ie&&Je&&ls}),me=Array.from(new Set(M.map(O=>O.product_name))).sort(),ve=Array.from(new Set(M.map(O=>O.process_name))).sort(),z=Array.from(new Set(M.map(O=>O.staff_name))).sort(),pe=ie.length,ge=Math.ceil(pe/k),Pe=(E-1)*k,Ze=Pe+k,xe=ie.slice(Pe,Ze);u.useEffect(()=>{$(1)},[r,d,b,q,x,k]);const ke=async O=>{try{const be=H.find(Ie=>Ie.$id===O.process_id),Se=be?.process_name?.toLowerCase()||"packing";if(console.log("ðŸ” Post-production task validation data:",{isEdit:!!n,processId:O.process_id,selectedProcess:be,processName:Se,rawProductId:O.product_id,sourceProcessId:O.source_process_id,sourceQuantity:O.source_quantity,productId:O.product_id,allData:O}),n){const Ie=n.source_quantity||0,Je=parseFloat(O.source_quantity)||0,ls=Je-Ie;if(console.log("ðŸ”„ Post-production task edit validation:",{originalQuantity:Ie,newQuantity:Je,quantityDifference:ls,needsValidation:ls>0}),ls<=0)await m.mutateAsync({id:n.$id,data:O}),U("Post-production task updated successfully","success"),a(!1),i(null);else{const y=H.find(es=>es.$id===O.source_process_id)?.process_name||"Grinding",oe=Se==="batch_coding"||Se==="batch coding",je=parseFloat(O.source_quantity)||0;console.log("ðŸš¨ POST-PRODUCTION EDIT VALIDATION TRIGGERED:",{processName:Se,sourceProcess:y,rawProductId:O.product_id,sourceQuantity:O.source_quantity,quantityToValidate:je,newQuantity:Je,productId:O.product_id});const _e=await validateTaskCreation(Se,y,je,void 0,O.product_id,async es=>{const ws=es?{...O,source_quantity:es}:O;console.log("ðŸ”„ UPDATING POST-PRODUCTION TASK WITH ADJUSTED QUANTITY:",ws),await m.mutateAsync({id:n.$id,data:ws}),U("Post-production task updated successfully","success"),a(!1),i(null)});console.log("ðŸ” POST-PRODUCTION EDIT VALIDATION RESULT:",_e)}}else{const Je=H.find(oe=>oe.$id===O.source_process_id)?.process_name||"Grinding",ls=Se==="batch_coding"||Se==="batch coding",Ds=parseFloat(O.source_quantity)||0;console.log("ðŸ” PROCESS TYPE DEBUG:",{processName:Se,isBatchCoding:ls,sourceQuantity:O.source_quantity,quantityToValidate:Ds}),console.log("ðŸš¨ POST-PRODUCTION NEW TASK VALIDATION:",{processName:Se,sourceProcess:Je,rawProductId:O.product_id,sourceQuantity:O.source_quantity,quantityToValidate:Ds,productId:O.product_id});const y=O;await w.mutateAsync(y),U("Post-production task created successfully","success"),a(!1),i(null)}}catch(be){console.error("Error saving task:",be),U("Failed to save task","error")}},ns=O=>{i(O),a(!0)},We=async O=>{if(window.confirm("Are you sure you want to delete this task?"))try{await F.mutateAsync(O.$id),U("Post-production task deleted successfully","success")}catch(be){console.error("Error deleting task:",be),U("Failed to delete task","error")}},Ge=async()=>{if(l.length===0){U("Please select tasks to delete","error");return}if(window.confirm(`Are you sure you want to delete ${l.length} selected task(s)?`))try{await Promise.all(l.map(O=>F.mutateAsync(O.$id))),h([]),U(`${l.length} tasks deleted successfully`,"success")}catch(O){console.error("Error deleting tasks:",O),U("Failed to delete selected tasks","error")}},T=()=>{if(l.length===0){U("Please select tasks to export","error");return}U(`Exporting ${l.length} selected task(s)...`,"success")};return Q?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Post-Production Tasks"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage post-production processing tasks"})]}),e.jsx(G,{children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"text-center py-12 text-red-600",children:[e.jsx("p",{className:"text-lg mb-2",children:"Error loading tasks"}),e.jsx("p",{className:"text-sm mb-4",children:Q.message}),e.jsx(D,{onClick:()=>V(),variant:"outline",children:"Retry"})]})})})]}):e.jsxs("div",{className:"space-y-6",children:[c.show&&e.jsx("div",{className:`fixed top-4 right-4 px-4 py-2 rounded-md shadow-lg z-50 ${c.type==="success"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300"}`,children:c.message}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Post-Production Tasks"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage post-production processing tasks"})]}),e.jsxs(D,{className:"bg-primary hover:bg-primary/90",onClick:()=>{i(null),a(!0)},children:[e.jsx(fs,{className:"h-4 w-4 mr-2"}),"Add New"]})]}),e.jsx(G,{children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(ts,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(B,{placeholder:"Search tasks...",className:"pl-10",value:r,onChange:O=>s(O.target.value)})]}),j&&p&&e.jsx(gs,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:p.exportColumns.filter(O=>O.required).map(O=>O.exportHeader),optionalColumns:p.exportColumns.filter(O=>!O.required).map(O=>O.exportHeader),validationRules:I,onImportComplete:O=>{O.successfulRows>0&&(V(),U(`${O.successfulRows} post-production tasks imported successfully.`,"success"))}},variant:"outline"}),p&&e.jsx(xs,{data:ie.map(O=>{const be={};return p.exportColumns.forEach(Se=>{const Ie=O[Se.dataKey];be[Se.exportHeader]=Se.formatter?Se.formatter(Ie):Ie}),be}),headers:p.exportColumns.map(O=>O.exportHeader),filename:"post-production-tasks",variant:"outline"})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs(te,{value:d,onValueChange:f,children:[e.jsx(ee,{className:"w-[180px]",children:e.jsx(ae,{placeholder:"Product"})}),e.jsxs(se,{children:[e.jsx(v,{value:"all",children:"All Products"}),me.map(O=>e.jsx(v,{value:O,children:O},O))]})]}),e.jsxs(te,{value:b,onValueChange:N,children:[e.jsx(ee,{className:"w-[180px]",children:e.jsx(ae,{placeholder:"Process"})}),e.jsxs(se,{children:[e.jsx(v,{value:"all",children:"All Processes"}),ve.map(O=>e.jsx(v,{value:O,children:O},O))]})]}),e.jsxs(te,{value:q,onValueChange:L,children:[e.jsx(ee,{className:"w-[180px]",children:e.jsx(ae,{placeholder:"Staff Name"})}),e.jsxs(se,{children:[e.jsx(v,{value:"all",children:"All Staff"}),z.map(O=>e.jsx(v,{value:O,children:O},O))]})]}),e.jsx(B,{type:"date",placeholder:"From Date",className:"w-[150px]",value:x.from,onChange:O=>C(be=>({...be,from:O.target.value}))}),e.jsx(B,{type:"date",placeholder:"To Date",className:"w-[150px]",value:x.to,onChange:O=>C(be=>({...be,to:O.target.value}))})]})]})})}),e.jsx(G,{children:e.jsxs(Z,{className:"pt-6",children:[l.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 p-3 bg-muted rounded-md",children:[e.jsxs("span",{className:"text-sm font-medium",children:[l.length," selected"]}),e.jsx(D,{variant:"destructive",size:"sm",onClick:Ge,children:"Delete Selected"}),e.jsx(D,{variant:"outline",size:"sm",onClick:T,children:"Export Selected"})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",Pe+1," to ",Math.min(Ze,pe)," of ",pe," records"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Records per page:"}),e.jsxs(te,{value:k.toString(),onValueChange:O=>R(Number(O)),children:[e.jsx(ee,{className:"w-[100px]",children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"50",children:"50"}),e.jsx(v,{value:"100",children:"100"}),e.jsx(v,{value:"500",children:"500"})]})]})]})]}),e.jsx("div",{className:"border rounded-md",children:e.jsx("div",{className:"overflow-auto",style:{maxHeight:"600px"},children:e.jsx(Gs,{data:A(xe),columns:[{key:"task_id",label:"Task ID",sortable:!0,dataType:"string"},{key:"date",label:"Date Assigned",sortable:!0,dataType:"date"},{key:"date_completed",label:"Date Completed",sortable:!0,dataType:"date"},{key:"source_quantity",label:"Source Qty",sortable:!0,dataType:"number",align:"right"},{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"product_name",label:"Product",sortable:!0,dataType:"string"},{key:"process_name",label:"Process",sortable:!0,dataType:"string"},{key:"staff_name",label:"Staff Name",sortable:!0,dataType:"string"},{key:"units",label:"Completed Units",sortable:!0,dataType:"number",align:"right",headerClassName:"bg-green-50",cellClassName:"bg-green-50 font-medium"},{key:"wastage_quantity",label:"Wastage Qty",sortable:!0,dataType:"number",align:"right"},{key:"remarks",label:"Remarks",sortable:!0,dataType:"string"},{key:"status",label:"Status",sortable:!0,dataType:"string",formatter:O=>e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${O==="completed"?"bg-green-100 text-green-800":O==="in_progress"?"bg-yellow-100 text-yellow-800":O==="pending"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:O==="in_progress"?"In Progress":O.charAt(0).toUpperCase()+O.slice(1)})}],onSort:J,currentSort:P,loading:S,maxHeight:"none",stickyHeader:!0,bordered:!1,searchable:!1,selectable:!0,selectedRows:l,onSelectionChange:h,rowKey:"$id",actions:[vt.edit(O=>ns(O)),vt.delete(O=>We(O))],emptyMessage:"No post-production tasks found"})})}),ge>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx(D,{variant:"outline",size:"sm",onClick:()=>$(O=>Math.max(1,O-1)),disabled:E===1,children:"Previous"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",E," of ",ge]})}),e.jsx(D,{variant:"outline",size:"sm",onClick:()=>$(O=>Math.min(ge,O+1)),disabled:E===ge,children:"Next"})]})]})}),e.jsx(fc,{isOpen:t,onClose:()=>{a(!1),i(null)},onSubmit:ke,editingTask:n,isLoading:w.isPending||m.isPending})]})},In=Ei,Oa=u.forwardRef(({className:r,...s},t)=>e.jsx(Yr,{ref:t,className:re("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",r),...s}));Oa.displayName=Yr.displayName;const pt=u.forwardRef(({className:r,...s},t)=>e.jsx(Wr,{ref:t,className:re("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",r),...s}));pt.displayName=Wr.displayName;const hs=u.forwardRef(({className:r,...s},t)=>e.jsx(Gr,{ref:t,className:re("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",r),...s}));hs.displayName=Gr.displayName;class yc{DEFAULT_OPTIONS={maxWidth:200,maxHeight:90,maxSizeKB:500,allowedTypes:["image/jpeg","image/jpg","image/png","image/svg+xml","image/webp"]};async uploadLogo(s,t={}){const a={...this.DEFAULT_OPTIONS,...t};try{return a.allowedTypes.includes(s.type)?s.size/1024>a.maxSizeKB?{success:!1,error:`File too large. Maximum: ${a.maxSizeKB}KB`}:s.type==="image/svg+xml"?{success:!0,logoBase64:await this.fileToBase64(s)}:{success:!0,logoBase64:await this.scaleImage(s,a.maxWidth,a.maxHeight)}:{success:!1,error:`Invalid file type. Allowed: ${a.allowedTypes.join(", ")}`}}catch(n){return{success:!1,error:n.message||"Failed to process logo"}}}async scaleImage(s,t,a){return new Promise((n,i)=>{const l=new Image,h=document.createElement("canvas"),c=h.getContext("2d");if(!c){i(new Error("Canvas context not available"));return}l.onload=()=>{const{width:d,height:f}=this.calculateDimensions(l.width,l.height,t,a);h.width=d,h.height=f,c.drawImage(l,0,0,d,f);const b=h.toDataURL("image/png",.9);n(b)},l.onerror=()=>i(new Error("Failed to load image"));const o=new FileReader;o.onload=d=>{l.src=d.target?.result},o.onerror=()=>i(new Error("Failed to read file")),o.readAsDataURL(s)})}calculateDimensions(s,t,a,n){let{width:i,height:l}={width:s,height:t};if(i>a||l>n){const h=a/i,c=n/l,o=Math.min(h,c);i=Math.round(i*o),l=Math.round(l*o)}return{width:i,height:l}}fileToBase64(s){return new Promise((t,a)=>{const n=new FileReader;n.onload=()=>t(n.result),n.onerror=()=>a(new Error("Failed to read file")),n.readAsDataURL(s)})}}const vc=new yc;function bc(){const{toast:r}=Ee(),{settings:s,updateSettings:t}=fn(),[a,n]=u.useState(!1),[i,l]=u.useState(s.logo||null),h=u.useRef(null),c=(N,q)=>{t({[N]:q})},o=()=>{t({logo:i||void 0}),r({title:"Success",description:"Company profile saved successfully"})},d=async N=>{const q=N.target.files?.[0];if(q){n(!0);try{const L=await vc.uploadLogo(q,{maxWidth:200,maxHeight:90,maxSizeKB:500});L.success&&L.logoBase64?(l(L.logoBase64),r({title:"Logo uploaded successfully",description:"Logo has been scaled to fit 200x90px"})):r({title:"Upload failed",description:L.error||"Unknown error",variant:"destructive"})}catch(L){r({title:"Upload failed",description:L.message||"Failed to process logo",variant:"destructive"})}finally{n(!1),h.current&&(h.current.value="")}}},f=()=>{l(null),r({title:"Logo removed",description:"Logo has been removed"})},b=()=>{h.current?.click()};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(G,{children:[e.jsxs(le,{children:[e.jsx(ce,{children:"Company Information"}),e.jsx(ye,{children:"Basic information about your company"})]}),e.jsxs(Z,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(_,{children:"Company Logo"}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:i?e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"w-48 h-20 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg flex items-center justify-center bg-gray-50 dark:bg-gray-800 overflow-hidden",children:e.jsx("img",{src:i,alt:"Company Logo",className:"max-w-full max-h-full object-contain dark:brightness-90"})}),e.jsx(D,{variant:"destructive",size:"sm",className:"absolute -top-2 -right-2 h-6 w-6 rounded-full p-0 opacity-0 group-hover:opacity-100 transition-opacity",onClick:f,children:e.jsx(xt,{className:"h-3 w-3"})})]}):e.jsx("div",{className:"w-48 h-20 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg flex items-center justify-center bg-gray-50 dark:bg-gray-800 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:b,children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ba,{className:"h-8 w-8 mx-auto text-gray-400 dark:text-gray-500 mb-2"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Click to upload"}),e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:"200x90px"})]})})}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(D,{variant:"outline",onClick:b,disabled:a,className:"gap-2",children:[e.jsx(Xt,{className:"h-4 w-4"}),a?"Uploading...":"Upload Logo"]}),i&&e.jsxs(D,{variant:"ghost",onClick:f,className:"gap-2 text-red-600 hover:text-red-700",children:[e.jsx(xt,{className:"h-4 w-4"}),"Remove"]})]}),e.jsxs(Ue,{children:[e.jsx(Ba,{className:"h-4 w-4"}),e.jsxs(Ke,{children:[e.jsx("strong",{children:"Requirements:"})," Max 500KB â€¢ 200x90px recommended â€¢ PNG, JPG, SVG, WebP â€¢ Auto-scaled to fit"]})]})]})]}),e.jsx("input",{ref:h,type:"file",accept:"image/*",onChange:d,className:"hidden"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(_,{htmlFor:"companyName",children:"Company Name *"}),e.jsx(B,{id:"companyName",value:s.companyName,onChange:N=>c("companyName",N.target.value)})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"legalName",children:"Legal Name"}),e.jsx(B,{id:"legalName",value:s.legalName,onChange:N=>c("legalName",N.target.value)})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"registrationNumber",children:"Registration Number"}),e.jsx(B,{id:"registrationNumber",value:s.registrationNumber,onChange:N=>c("registrationNumber",N.target.value)})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"taxId",children:"Tax ID / GST Number"}),e.jsx(B,{id:"taxId",value:s.taxId,onChange:N=>c("taxId",N.target.value)})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"industryType",children:"Industry Type"}),e.jsxs(te,{value:s.industryType,onValueChange:N=>c("industryType",N),children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"Manufacturing",children:"Manufacturing"}),e.jsx(v,{value:"Trading",children:"Trading"}),e.jsx(v,{value:"Services",children:"Services"}),e.jsx(v,{value:"Retail",children:"Retail"})]})]})]})]})]})]}),e.jsxs(G,{children:[e.jsxs(le,{children:[e.jsx(ce,{children:"Contact Information"}),e.jsx(ye,{children:"How to reach your company"})]}),e.jsxs(Z,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(_,{htmlFor:"address",children:"Address"}),e.jsx(Hs,{id:"address",value:s.address,onChange:N=>c("address",N.target.value),rows:2})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(_,{htmlFor:"city",children:"City"}),e.jsx(B,{id:"city",value:s.city,onChange:N=>c("city",N.target.value)})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"state",children:"State"}),e.jsx(B,{id:"state",value:s.state,onChange:N=>c("state",N.target.value)})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"postalCode",children:"Postal Code"}),e.jsx(B,{id:"postalCode",value:s.postalCode,onChange:N=>c("postalCode",N.target.value)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(_,{htmlFor:"phone",children:"Phone"}),e.jsx(B,{id:"phone",value:s.phone,onChange:N=>c("phone",N.target.value)})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"email",children:"Email"}),e.jsx(B,{id:"email",type:"email",value:s.email,onChange:N=>c("email",N.target.value)})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"website",children:"Website"}),e.jsx(B,{id:"website",value:s.website,onChange:N=>c("website",N.target.value)})]})]})]})]}),e.jsxs(G,{children:[e.jsxs(le,{children:[e.jsx(ce,{children:"Business Settings"}),e.jsx(ye,{children:"Configure your business preferences"})]}),e.jsx(Z,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(_,{htmlFor:"fiscalYearStart",children:"Fiscal Year Start Month"}),e.jsxs(te,{value:s.fiscalYearStart,onValueChange:N=>c("fiscalYearStart",N),children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"01",children:"January"}),e.jsx(v,{value:"04",children:"April"}),e.jsx(v,{value:"07",children:"July"}),e.jsx(v,{value:"10",children:"October"})]})]})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"currency",children:"Default Currency"}),e.jsxs(te,{value:s.currency,onValueChange:N=>c("currency",N),children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"INR",children:"INR - Indian Rupee"}),e.jsx(v,{value:"USD",children:"USD - US Dollar"}),e.jsx(v,{value:"EUR",children:"EUR - Euro"}),e.jsx(v,{value:"GBP",children:"GBP - British Pound"})]})]})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"timezone",children:"Time Zone"}),e.jsxs(te,{value:s.timezone,onValueChange:N=>c("timezone",N),children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"Asia/Kolkata",children:"Asia/Kolkata (IST)"}),e.jsx(v,{value:"America/New_York",children:"America/New_York (EST)"}),e.jsx(v,{value:"Europe/London",children:"Europe/London (GMT)"}),e.jsx(v,{value:"Asia/Dubai",children:"Asia/Dubai (GST)"})]})]})]})]})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(D,{onClick:o,className:"gap-2",children:[e.jsx(oa,{className:"h-4 w-4"}),"Save Changes"]})})]})}const Za="molaga_users",er="molaga_roles",sr=[{id:"super_admin",name:"Super Admin",description:"Full system access",permissions:{masterData:"full",purchases:"full",tasks:"full",sales:"full",status:"full",reports:"full",settings:"full"},isSystemRole:!0},{id:"admin",name:"Admin",description:"All except system configuration",permissions:{masterData:"full",purchases:"full",tasks:"full",sales:"full",status:"full",reports:"full",settings:"edit"},isSystemRole:!0},{id:"manager",name:"Manager",description:"View all, edit assigned",permissions:{masterData:"view",purchases:"edit",tasks:"edit",sales:"edit",status:"view",reports:"view",settings:"none"},isSystemRole:!0},{id:"staff",name:"Staff",description:"Limited access",permissions:{masterData:"view",purchases:"view",tasks:"edit",sales:"view",status:"view",reports:"none",settings:"none"},isSystemRole:!0},{id:"viewer",name:"Viewer",description:"Read-only access",permissions:{masterData:"view",purchases:"view",tasks:"view",sales:"view",status:"view",reports:"view",settings:"none"},isSystemRole:!0}],Nc=[{id:"1",name:"Admin User",email:"admin@molaga.com",role:"super_admin",status:"active",lastLogin:new Date().toISOString(),createdAt:new Date().toISOString()}];class wc{users;roles;constructor(){this.users=this.loadUsers(),this.roles=this.loadRoles()}loadUsers(){try{const s=localStorage.getItem(Za);if(s)return JSON.parse(s)}catch(s){console.error("Error loading users:",s)}return[...Nc]}saveUsers(){try{localStorage.setItem(Za,JSON.stringify(this.users))}catch(s){console.error("Error saving users:",s)}}getAllUsers(){return[...this.users]}getUserById(s){return this.users.find(t=>t.id===s)}createUser(s){const t={...s,id:Date.now().toString(),createdAt:new Date().toISOString()};return this.users.push(t),this.saveUsers(),t}updateUser(s,t){const a=this.users.findIndex(n=>n.id===s);return a===-1?null:(this.users[a]={...this.users[a],...t},this.saveUsers(),this.users[a])}deleteUser(s){const t=this.users.findIndex(a=>a.id===s);return t===-1?!1:(this.users.splice(t,1),this.saveUsers(),!0)}loadRoles(){try{const s=localStorage.getItem(er);if(s){const t=JSON.parse(s),a=[...sr];return t.forEach(n=>{n.isSystemRole||a.push(n)}),a}}catch(s){console.error("Error loading roles:",s)}return[...sr]}saveRoles(){try{const s=this.roles.filter(t=>!t.isSystemRole);localStorage.setItem(er,JSON.stringify(s))}catch(s){console.error("Error saving roles:",s)}}getAllRoles(){return[...this.roles]}getRoleById(s){return this.roles.find(t=>t.id===s)}createRole(s){const t={...s,id:Date.now().toString(),isSystemRole:!1};return this.roles.push(t),this.saveRoles(),t}updateRole(s,t){const a=this.roles.findIndex(n=>n.id===s);return a===-1||this.roles[a].isSystemRole?null:(this.roles[a]={...this.roles[a],...t},this.saveRoles(),this.roles[a])}deleteRole(s){const t=this.roles.findIndex(a=>a.id===s);return t===-1||this.roles[t].isSystemRole?!1:(this.roles.splice(t,1),this.saveRoles(),!0)}}const Cs=new wc;function Sc(){const[r,s]=u.useState(Cs.getAllUsers()),t=u.useCallback(()=>{s(Cs.getAllUsers())},[]),a=u.useCallback(l=>{const h=Cs.createUser(l);return t(),h},[t]),n=u.useCallback((l,h)=>{const c=Cs.updateUser(l,h);return t(),c},[t]),i=u.useCallback(l=>{const h=Cs.deleteUser(l);return h&&t(),h},[t]);return{users:r,createUser:a,updateUser:n,deleteUser:i,refreshUsers:t}}function _c(){const[r,s]=u.useState(Cs.getAllRoles()),t=u.useCallback(()=>{s(Cs.getAllRoles())},[]),a=u.useCallback(l=>{const h=Cs.createRole(l);return t(),h},[t]),n=u.useCallback((l,h)=>{const c=Cs.updateRole(l,h);return t(),c},[t]),i=u.useCallback(l=>{const h=Cs.deleteRole(l);return h&&t(),h},[t]);return{roles:r,createRole:a,updateRole:n,deleteRole:i,refreshRoles:t}}class kc{RESET_LOG_KEY="password_reset_log";FORCE_CHANGE_KEY="force_password_change";generateTempPassword(){const t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*";let a="";a+="ABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(Math.random()*26)],a+="abcdefghijklmnopqrstuvwxyz"[Math.floor(Math.random()*26)],a+="0123456789"[Math.floor(Math.random()*10)],a+="!@#$%^&*"[Math.floor(Math.random()*8)];for(let n=a.length;n<12;n++)a+=t[Math.floor(Math.random()*t.length)];return a.split("").sort(()=>Math.random()-.5).join("")}async resetUserPassword(s,t,a,n,i){try{const l=this.generateTempPassword();return this.logPasswordReset({id:Date.now().toString(),userId:s,userName:t,userEmail:a,resetBy:`${i} (${n})`,resetAt:new Date().toISOString(),tempPassword:l,mustChangePassword:!0}),this.setForcePasswordChange(s,!0),{success:!0,tempPassword:l,message:"Password reset successfully. User must change password on next login."}}catch(l){return console.error("Password reset error:",l),{success:!1,message:l.message||"Failed to reset password"}}}logPasswordReset(s){try{const t=this.getResetLogs();t.unshift(s),t.length>100&&t.splice(100),localStorage.setItem(this.RESET_LOG_KEY,JSON.stringify(t))}catch(t){console.error("Error logging password reset:",t)}}getResetLogs(){try{const s=localStorage.getItem(this.RESET_LOG_KEY);return s?JSON.parse(s):[]}catch(s){return console.error("Error loading reset logs:",s),[]}}setForcePasswordChange(s,t){try{const a=this.getForceChangeFlags();a[s]=t,localStorage.setItem(this.FORCE_CHANGE_KEY,JSON.stringify(a))}catch(a){console.error("Error setting force change flag:",a)}}mustChangePassword(s){try{return this.getForceChangeFlags()[s]===!0}catch(t){return console.error("Error checking force change flag:",t),!1}}clearForcePasswordChange(s){this.setForcePasswordChange(s,!1)}getForceChangeFlags(){try{const s=localStorage.getItem(this.FORCE_CHANGE_KEY);return s?JSON.parse(s):{}}catch(s){return console.error("Error loading force change flags:",s),{}}}getUserResetLogs(s){return this.getResetLogs().filter(a=>a.userId===s)}clearOldLogs(){try{const s=this.getResetLogs(),t=new Date;t.setDate(t.getDate()-90);const a=s.filter(i=>new Date(i.resetAt)>t),n=s.length-a.length;return localStorage.setItem(this.RESET_LOG_KEY,JSON.stringify(a)),n}catch(s){return console.error("Error clearing old logs:",s),0}}}const Cc=new kc;function Pc(){const{toast:r}=Ee(),{user:s}=os(),{users:t,createUser:a,updateUser:n,deleteUser:i}=Sc(),{roles:l}=_c(),[h,c]=u.useState(""),[o,d]=u.useState(!1),[f,b]=u.useState(null),[N,q]=u.useState(!1),[L,x]=u.useState(null),[C,E]=u.useState(""),[$,k]=u.useState({name:"",email:"",phone:"",role:"",department:"",employeeId:"",status:"active"}),R=t.filter(p=>p.name.toLowerCase().includes(h.toLowerCase())||p.email.toLowerCase().includes(h.toLowerCase())),M=()=>{b(null),k({name:"",email:"",phone:"",role:"",department:"",employeeId:"",status:"active"}),d(!0)},S=p=>{b(p),k({name:p.name,email:p.email,phone:p.phone||"",role:p.role,department:p.department||"",employeeId:p.employeeId||"",status:p.status}),d(!0)},Q=p=>{confirm("Are you sure you want to delete this user?")&&i(p)&&r({title:"User deleted successfully"})},V=p=>{x(p),E(""),q(!0)},w=async()=>{if(!L||!s)return;const p=await Cc.resetUserPassword(L.id,L.name,L.email,s.$id,s.name);p.success&&p.tempPassword?(E(p.tempPassword),r({title:"Password Reset Successfully",description:"Temporary password has been generated. Please share it securely with the user."})):(r({title:"Password Reset Failed",description:p.message,variant:"destructive"}),q(!1),x(null))},m=()=>{navigator.clipboard.writeText(C),r({title:"Copied!",description:"Temporary password copied to clipboard"})},F=()=>{if(!$.name||!$.email||!$.role){r({title:"Please fill in all required fields",variant:"destructive"});return}f?(n(f.id,$),r({title:"User updated successfully"})):(a($),r({title:"User created successfully"})),d(!1)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(G,{children:[e.jsx(le,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(ce,{children:"User Management"}),e.jsx(ye,{children:"Manage system users and their access"})]}),e.jsxs(D,{onClick:M,className:"gap-2",children:[e.jsx(Ri,{className:"h-4 w-4"}),"Add User"]})]})}),e.jsxs(Z,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ts,{className:"h-4 w-4 text-muted-foreground"}),e.jsx(B,{placeholder:"Search users...",value:h,onChange:p=>c(p.target.value),className:"max-w-sm"})]}),e.jsxs(ds,{children:[e.jsx(us,{children:e.jsxs(we,{children:[e.jsx(X,{children:"Name"}),e.jsx(X,{children:"Email"}),e.jsx(X,{children:"Role"}),e.jsx(X,{children:"Status"}),e.jsx(X,{children:"Last Login"}),e.jsx(X,{className:"text-right",children:"Actions"})]})}),e.jsx(ms,{children:R.map(p=>e.jsxs(we,{children:[e.jsx(Y,{className:"font-medium",children:p.name}),e.jsx(Y,{children:p.email}),e.jsx(Y,{children:p.role}),e.jsx(Y,{children:e.jsx(Ae,{variant:p.status==="active"?"default":"secondary",children:p.status})}),e.jsx(Y,{children:p.lastLogin}),e.jsx(Y,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(D,{variant:"ghost",size:"sm",onClick:()=>V(p),title:"Reset Password",children:e.jsx(Ut,{className:"h-4 w-4"})}),e.jsx(D,{variant:"ghost",size:"sm",onClick:()=>S(p),children:e.jsx(Vs,{className:"h-4 w-4"})}),e.jsx(D,{variant:"ghost",size:"sm",onClick:()=>Q(p.id),children:e.jsx(Ts,{className:"h-4 w-4"})})]})})]},p.id))})]})]})]}),e.jsxs(G,{children:[e.jsxs(le,{children:[e.jsx(ce,{children:"Roles & Permissions"}),e.jsx(ye,{children:"Configure user roles and their permissions"})]}),e.jsx(Z,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:l.map(p=>e.jsxs(G,{children:[e.jsxs(le,{children:[e.jsx(ce,{className:"text-base",children:p.name}),p.isSystemRole&&e.jsx(Ae,{variant:"secondary",className:"w-fit",children:"System Role"})]}),e.jsxs(Z,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:p.description}),e.jsx("div",{className:"text-xs text-muted-foreground mb-3",children:e.jsx("div",{className:"grid grid-cols-2 gap-1",children:Object.entries(p.permissions).slice(0,4).map(([I,j])=>e.jsxs("div",{children:[I,": ",e.jsx("span",{className:"font-medium",children:j})]},I))})}),e.jsx(D,{variant:"outline",size:"sm",className:"w-full",disabled:p.isSystemRole,children:p.isSystemRole?"View Permissions":"Edit Permissions"})]})]},p.id))})})]}),e.jsx(Qe,{open:o,onOpenChange:d,children:e.jsxs(Ve,{children:[e.jsxs(Be,{children:[e.jsx(ze,{children:f?"Edit User":"Add New User"}),e.jsx(Ye,{children:f?"Update user information":"Create a new user account"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(_,{htmlFor:"name",children:"Full Name *"}),e.jsx(B,{id:"name",placeholder:"John Doe",value:$.name,onChange:p=>k({...$,name:p.target.value})})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"email",children:"Email *"}),e.jsx(B,{id:"email",type:"email",placeholder:"john@example.com",value:$.email,onChange:p=>k({...$,email:p.target.value})})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"phone",children:"Phone"}),e.jsx(B,{id:"phone",placeholder:"+91 9876543210",value:$.phone,onChange:p=>k({...$,phone:p.target.value})})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"role",children:"Role *"}),e.jsxs(te,{value:$.role,onValueChange:p=>k({...$,role:p}),children:[e.jsx(ee,{children:e.jsx(ae,{placeholder:"Select role"})}),e.jsx(se,{children:l.map(p=>e.jsx(v,{value:p.id,children:p.name},p.id))})]})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"department",children:"Department"}),e.jsx(B,{id:"department",placeholder:"Production",value:$.department,onChange:p=>k({...$,department:p.target.value})})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"employeeId",children:"Employee ID"}),e.jsx(B,{id:"employeeId",placeholder:"EMP001",value:$.employeeId,onChange:p=>k({...$,employeeId:p.target.value})})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"status",children:"Status"}),e.jsxs(te,{value:$.status,onValueChange:p=>k({...$,status:p}),children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"active",children:"Active"}),e.jsx(v,{value:"inactive",children:"Inactive"})]})]})]})]}),e.jsxs(He,{children:[e.jsx(D,{variant:"outline",onClick:()=>d(!1),children:"Cancel"}),e.jsx(D,{onClick:F,children:f?"Update":"Create"})]})]})}),e.jsx(Qe,{open:N,onOpenChange:q,children:e.jsxs(Ve,{children:[e.jsxs(Be,{children:[e.jsx(ze,{children:"Reset Password"}),e.jsxs(Ye,{children:["Reset password for ",L?.name]})]}),e.jsx("div",{className:"space-y-4 py-4",children:C?e.jsxs(e.Fragment,{children:[e.jsxs(Ue,{children:[e.jsx(Ut,{className:"h-4 w-4"}),e.jsx(Ke,{children:"Password reset successfully! Please share this temporary password securely with the user."})]}),e.jsxs("div",{children:[e.jsx(_,{children:"Temporary Password"}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(B,{value:C,readOnly:!0,className:"font-mono"}),e.jsx(D,{variant:"outline",size:"icon",onClick:m,children:e.jsx(At,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"User must change this password on next login"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(Ue,{children:[e.jsx(Ut,{className:"h-4 w-4"}),e.jsx(Ke,{children:"A temporary password will be generated. The user will be required to change it on next login."})]}),e.jsxs("div",{children:[e.jsx(_,{children:"User Email"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:L?.email})]})]})}),e.jsx(He,{children:C?e.jsx(D,{onClick:()=>{q(!1),x(null),E("")},children:"Close"}):e.jsxs(e.Fragment,{children:[e.jsx(D,{variant:"outline",onClick:()=>q(!1),children:"Cancel"}),e.jsxs(D,{onClick:w,className:"gap-2",children:[e.jsx(Ut,{className:"h-4 w-4"}),"Generate Password"]})]})})]})})]})}class Tc{async registerWithApproval(s,t,a){try{const n=await qs.create(at.unique(),s,t,a),i={approvalStatus:"pending",registeredAt:new Date().toISOString(),role:"viewer"};await qs.updatePrefs(i);try{await qs.deleteSession("current")}catch{}return{success:!0,message:"Registration successful. Please wait for admin approval.",userId:n.$id}}catch(n){return console.error("Registration error:",n),{success:!1,message:n.message||"Registration failed"}}}async checkApprovalStatus(s){try{const a=(await qs.get()).prefs;return!a.approvalStatus||a.approvalStatus==="approved"?{approved:!0,status:"approved",message:"User is approved"}:a.approvalStatus==="pending"?{approved:!1,status:"pending",message:"Your account is pending approval. Please wait for admin approval."}:a.approvalStatus==="rejected"?{approved:!1,status:"rejected",message:`Your account was rejected. Reason: ${a.rejectionReason||"Not specified"}`}:{approved:!1,status:"pending",message:"Unknown approval status"}}catch(t){return console.error("Approval check error:",t),{approved:!1,status:"pending",message:"Could not verify approval status"}}}async approveUser(s,t,a="viewer"){try{return{success:!0,message:"User approved successfully"}}catch(n){return console.error("Approval error:",n),{success:!1,message:n.message||"Failed to approve user"}}}async rejectUser(s,t,a){try{return{success:!0,message:"User rejected"}}catch(n){return console.error("Rejection error:",n),{success:!1,message:n.message||"Failed to reject user"}}}getPendingUsers(){try{const s=localStorage.getItem("pending_users");return s?JSON.parse(s):[]}catch(s){return console.error("Error loading pending users:",s),[]}}addPendingUser(s){try{const t=this.getPendingUsers();t.push(s),localStorage.setItem("pending_users",JSON.stringify(t))}catch(t){console.error("Error adding pending user:",t)}}removePendingUser(s){try{const a=this.getPendingUsers().filter(n=>n.$id!==s);localStorage.setItem("pending_users",JSON.stringify(a))}catch(t){console.error("Error removing pending user:",t)}}updatePendingUserStatus(s,t,a){try{const n=this.getPendingUsers(),i=n.find(l=>l.$id===s);i&&(i.approvalStatus=t,a&&(i.rejectionReason=a),localStorage.setItem("pending_users",JSON.stringify(n)))}catch(n){console.error("Error updating pending user:",n)}}}const dt=new Tc;function Dc(){const{toast:r}=Ee(),{user:s}=os(),[t,a]=u.useState(dt.getPendingUsers()),[n,i]=u.useState(null),[l,h]=u.useState(!1),[c,o]=u.useState(!1),[d,f]=u.useState("viewer"),[b,N]=u.useState(""),q=Cs.getAllRoles(),L=()=>{a(dt.getPendingUsers())},x=k=>{i(k),f("viewer"),h(!0)},C=k=>{i(k),N(""),o(!0)},E=async()=>{if(!(!n||!s))try{Cs.createUser({name:n.name,email:n.email,role:d,status:"active"}),dt.updatePendingUserStatus(n.$id,"approved"),dt.removePendingUser(n.$id),r({title:"User Approved",description:`${n.name} has been approved and can now login.`}),L(),h(!1),i(null)}catch(k){r({title:"Approval Failed",description:k.message||"Failed to approve user",variant:"destructive"})}},$=async()=>{if(!(!n||!s)){if(!b.trim()){r({title:"Reason Required",description:"Please provide a reason for rejection",variant:"destructive"});return}try{dt.updatePendingUserStatus(n.$id,"rejected",b),dt.removePendingUser(n.$id),r({title:"User Rejected",description:`${n.name} has been rejected.`}),L(),o(!1),i(null),N("")}catch(k){r({title:"Rejection Failed",description:k.message||"Failed to reject user",variant:"destructive"})}}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(G,{children:[e.jsxs(le,{children:[e.jsx(ce,{children:"Pending User Approvals"}),e.jsx(ye,{children:"Review and approve new user registrations"})]}),e.jsx(Z,{children:t.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(va,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No pending user approvals"})]}):e.jsxs(ds,{children:[e.jsx(us,{children:e.jsxs(we,{children:[e.jsx(X,{children:"Name"}),e.jsx(X,{children:"Email"}),e.jsx(X,{children:"Provider"}),e.jsx(X,{children:"Registered"}),e.jsx(X,{children:"Status"}),e.jsx(X,{className:"text-right",children:"Actions"})]})}),e.jsx(ms,{children:t.map(k=>e.jsxs(we,{children:[e.jsx(Y,{className:"font-medium",children:k.name}),e.jsx(Y,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qa,{className:"h-4 w-4 text-muted-foreground"}),k.email]})}),e.jsx(Y,{children:e.jsx(Ae,{variant:"outline",children:k.provider})}),e.jsx(Y,{children:new Date(k.registeredAt).toLocaleDateString()}),e.jsx(Y,{children:e.jsxs(Ae,{variant:"secondary",children:[e.jsx(va,{className:"h-3 w-3 mr-1"}),"Pending"]})}),e.jsx(Y,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(D,{variant:"ghost",size:"sm",onClick:()=>x(k),className:"text-green-600 hover:text-green-700",children:e.jsx(Ms,{className:"h-4 w-4"})}),e.jsx(D,{variant:"ghost",size:"sm",onClick:()=>C(k),className:"text-red-600 hover:text-red-700",children:e.jsx(ba,{className:"h-4 w-4"})})]})})]},k.$id))})]})})]}),e.jsx(Qe,{open:l,onOpenChange:h,children:e.jsxs(Ve,{children:[e.jsxs(Be,{children:[e.jsx(ze,{children:"Approve User"}),e.jsxs(Ye,{children:["Approve ",n?.name," to access the system"]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(_,{children:"Email"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:n?.email})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"role",children:"Assign Role"}),e.jsxs(te,{value:d,onValueChange:f,children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsx(se,{children:q.map(k=>e.jsx(v,{value:k.id,children:k.name},k.id))})]})]})]}),e.jsxs(He,{children:[e.jsx(D,{variant:"outline",onClick:()=>h(!1),children:"Cancel"}),e.jsxs(D,{onClick:E,className:"gap-2",children:[e.jsx(Ms,{className:"h-4 w-4"}),"Approve User"]})]})]})}),e.jsx(Qe,{open:c,onOpenChange:o,children:e.jsxs(Ve,{children:[e.jsxs(Be,{children:[e.jsx(ze,{children:"Reject User"}),e.jsxs(Ye,{children:["Reject ",n?.name,"'s registration request"]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(_,{children:"Email"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:n?.email})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"reason",children:"Rejection Reason *"}),e.jsx(Hs,{id:"reason",placeholder:"Please provide a reason for rejection...",value:b,onChange:k=>N(k.target.value),rows:4})]})]}),e.jsxs(He,{children:[e.jsx(D,{variant:"outline",onClick:()=>o(!1),children:"Cancel"}),e.jsxs(D,{onClick:$,variant:"destructive",className:"gap-2",children:[e.jsx(ba,{className:"h-4 w-4"}),"Reject User"]})]})]})})]})}const Ps=u.forwardRef(({className:r,...s},t)=>e.jsx(Jr,{className:re("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",r),...s,ref:t,children:e.jsx(Ai,{className:re("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));Ps.displayName=Jr.displayName;function Ec(){const{toast:r}=Ee(),{settings:s,updateSettings:t}=jn(),a=(i,l)=>{t({[i]:l})},n=()=>{r({title:"System configuration saved successfully"})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(G,{children:[e.jsxs(le,{children:[e.jsx(ce,{children:"General Settings"}),e.jsx(ye,{children:"Configure system-wide preferences"})]}),e.jsx(Z,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(_,{htmlFor:"language",children:"Default Language"}),e.jsxs(te,{value:s.language,onValueChange:i=>a("language",i),children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"en",children:"English"}),e.jsx(v,{value:"hi",children:"Hindi"}),e.jsx(v,{value:"ta",children:"Tamil"}),e.jsx(v,{value:"te",children:"Telugu"})]})]})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"dateFormat",children:"Date Format"}),e.jsxs(te,{value:s.dateFormat,onValueChange:i=>a("dateFormat",i),children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"DD/MM/YYYY",children:"DD/MM/YYYY"}),e.jsx(v,{value:"MM/DD/YYYY",children:"MM/DD/YYYY"}),e.jsx(v,{value:"YYYY-MM-DD",children:"YYYY-MM-DD"})]})]})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"timeFormat",children:"Time Format"}),e.jsxs(te,{value:s.timeFormat,onValueChange:i=>a("timeFormat",i),children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"12",children:"12-hour"}),e.jsx(v,{value:"24",children:"24-hour"})]})]})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"firstDayOfWeek",children:"First Day of Week"}),e.jsxs(te,{value:s.firstDayOfWeek,onValueChange:i=>a("firstDayOfWeek",i),children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"sunday",children:"Sunday"}),e.jsx(v,{value:"monday",children:"Monday"})]})]})]})]})})]}),e.jsxs(G,{children:[e.jsxs(le,{children:[e.jsx(ce,{children:"Number Formatting"}),e.jsx(ye,{children:"Configure how numbers are displayed"})]}),e.jsx(Z,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(_,{htmlFor:"decimalPlaces",children:"Decimal Places"}),e.jsxs(te,{value:s.decimalPlaces,onValueChange:i=>a("decimalPlaces",i),children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"0",children:"0"}),e.jsx(v,{value:"1",children:"1"}),e.jsx(v,{value:"2",children:"2"}),e.jsx(v,{value:"3",children:"3"}),e.jsx(v,{value:"4",children:"4"})]})]})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"thousandSeparator",children:"Thousand Separator"}),e.jsxs(te,{value:s.thousandSeparator,onValueChange:i=>a("thousandSeparator",i),children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:",",children:", (Comma)"}),e.jsx(v,{value:".",children:". (Period)"}),e.jsx(v,{value:" ",children:"  (Space)"})]})]})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"decimalSeparator",children:"Decimal Separator"}),e.jsxs(te,{value:s.decimalSeparator,onValueChange:i=>a("decimalSeparator",i),children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:".",children:". (Period)"}),e.jsx(v,{value:",",children:", (Comma)"})]})]})]})]})})]}),e.jsxs(G,{children:[e.jsxs(le,{children:[e.jsx(ce,{children:"Display Settings"}),e.jsx(ye,{children:"Customize the user interface"})]}),e.jsxs(Z,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(_,{htmlFor:"recordsPerPage",children:"Records Per Page"}),e.jsxs(te,{value:s.recordsPerPage,onValueChange:i=>a("recordsPerPage",i),children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"25",children:"25"}),e.jsx(v,{value:"50",children:"50"}),e.jsx(v,{value:"100",children:"100"}),e.jsx(v,{value:"200",children:"200"})]})]})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"theme",children:"Theme"}),e.jsxs(te,{value:s.theme,onValueChange:i=>a("theme",i),children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"light",children:"Light"}),e.jsx(v,{value:"dark",children:"Dark"}),e.jsx(v,{value:"auto",children:"Auto"})]})]})]})]}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(_,{htmlFor:"sidebarCollapsed",children:"Sidebar Collapsed by Default"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Start with a collapsed sidebar"})]}),e.jsx(Ps,{id:"sidebarCollapsed",checked:s.sidebarCollapsed,onCheckedChange:i=>a("sidebarCollapsed",i)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(_,{htmlFor:"showTooltips",children:"Show Tooltips"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Display helpful tooltips"})]}),e.jsx(Ps,{id:"showTooltips",checked:s.showTooltips,onCheckedChange:i=>a("showTooltips",i)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(_,{htmlFor:"enableAnimations",children:"Enable Animations"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Use smooth transitions"})]}),e.jsx(Ps,{id:"enableAnimations",checked:s.enableAnimations,onCheckedChange:i=>a("enableAnimations",i)})]})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(D,{onClick:n,className:"gap-2",children:[e.jsx(oa,{className:"h-4 w-4"}),"Save Configuration"]})})]})}class Rc{BACKUP_VERSION="1.0";APP_VERSION="1.0.0";getCollectionsList(){return["purchases","vendors","stocks","products","raw_products","processes","staff","sales_channels","pre_production_tasks","production_tasks","post_production_tasks","sales_units","sales_records","stock_status","pre_production_status","production_status","post_production_status"]}async exportCollection(s,t){const a=[];let n=0;const i=100;let l=!0;try{for(;l;){const h=await Me.listDocuments(Oe,fe[s],[$e.limit(i),$e.offset(n)]);a.push(...h.documents),t&&t(a.length,h.total),h.documents.length<i?l=!1:n+=i}return console.log(`âœ“ Exported ${a.length} documents from ${s}`),a}catch(h){return console.error(`Error exporting ${s}:`,h),[]}}async createFullBackup(s){const t=this.getCollectionsList(),a={metadata:{version:this.BACKUP_VERSION,timestamp:new Date().toISOString(),appVersion:this.APP_VERSION,totalRecords:0,totalCollections:t.length,collections:t},collections:{}};let n=0;for(const i of t)try{const l=await this.exportCollection(i,(h,c)=>{s&&s({currentCollection:i,processedCollections:n,totalCollections:t.length,currentRecords:h,totalRecords:a.metadata.totalRecords+h,percentage:Math.round((n+h/c)/t.length*100)})});a.collections[i]=l,a.metadata.totalRecords+=l.length,n++,s&&s({currentCollection:i,processedCollections:n,totalCollections:t.length,currentRecords:l.length,totalRecords:a.metadata.totalRecords,percentage:Math.round(n/t.length*100)})}catch(l){console.error(`Failed to backup ${i}:`,l),a.collections[i]=[]}return a}async createPartialBackup(s,t){const a={metadata:{version:this.BACKUP_VERSION,timestamp:new Date().toISOString(),appVersion:this.APP_VERSION,totalRecords:0,totalCollections:s.length,collections:s},collections:{}};let n=0;for(const i of s){const l=await this.exportCollection(i);a.collections[i]=l,a.metadata.totalRecords+=l.length,n++,t&&t({currentCollection:i,processedCollections:n,totalCollections:s.length,currentRecords:l.length,totalRecords:a.metadata.totalRecords,percentage:Math.round(n/s.length*100)})}return a}async downloadBackup(s,t){const a=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),n=`molaga-backup-${new Date().toISOString().split("T")[0]}.json`;Ct.saveAs(a,t||n)}getBackupSize(s){const t=JSON.stringify(s),a=new Blob([t]).size;return a<1024?`${a} B`:a<1024*1024?`${(a/1024).toFixed(2)} KB`:`${(a/(1024*1024)).toFixed(2)} MB`}async readBackupFile(s){return new Promise((t,a)=>{const n=new FileReader;n.onload=i=>{try{const l=i.target?.result,h=JSON.parse(l);t(h)}catch{a(new Error("Invalid backup file format"))}},n.onerror=()=>{a(new Error("Failed to read backup file"))},n.readAsText(s)})}}const Vt=new Rc;class Ac{RESTORE_ORDER=["vendors","stocks","raw_products","processes","products","staff","sales_channels","purchases","pre_production_tasks","production_tasks","post_production_tasks","sales_units","sales_records","stock_status","pre_production_status","production_status","post_production_status"];async validateBackup(s){const t=[],a=[];if(s.metadata?.version||t.push("Missing backup version"),s.metadata?.timestamp||t.push("Missing backup timestamp"),!s.collections||typeof s.collections!="object")return t.push("Invalid or missing collections data"),{valid:!1,errors:t,warnings:a};const n=["products","stocks","vendors"];for(const l of n)s.collections[l]||a.push(`Missing recommended collection: ${l}`);for(const[l,h]of Object.entries(s.collections))Array.isArray(h)?h.length>0&&(h[0].$id||a.push(`Documents in ${l} may be missing $id field`)):t.push(`Invalid data format for collection: ${l}`);const i=Object.values(s.collections).reduce((l,h)=>l+h.length,0);return s.metadata.totalRecords!==i&&a.push(`Metadata record count (${s.metadata.totalRecords}) doesn't match actual count (${i})`),{valid:t.length===0,errors:t,warnings:a}}cleanDocument(s){const{$id:t,$createdAt:a,$updatedAt:n,$permissions:i,$collectionId:l,$databaseId:h,...c}=s;return c}async documentExists(s,t){try{return await Me.getDocument(Oe,fe[s],t),!0}catch{return!1}}async clearCollection(s){let t=0,a=!0;try{for(;a;){const n=await Me.listDocuments(Oe,fe[s],[]);for(const i of n.documents)try{await Me.deleteDocument(Oe,fe[s],i.$id),t++}catch(l){console.error(`Failed to delete document ${i.$id}:`,l)}a=n.documents.length>0}}catch(n){console.error(`Error clearing collection ${s}:`,n)}return t}async restoreCollection(s,t,a,n){const i={total:t.length,success:0,failed:0,skipped:0,errors:[]};for(let l=0;l<t.length;l++){const h=t[l];try{const c=this.cleanDocument(h),o=h.$id||at.unique();if(a.handleIdConflicts==="skip"){if(await this.documentExists(s,o)){i.skipped++;continue}}else a.handleIdConflicts==="overwrite"&&await this.documentExists(s,o)&&await Me.deleteDocument(Oe,fe[s],o);await Me.createDocument(Oe,fe[s],a.handleIdConflicts==="new"?at.unique():o,c),i.success++}catch(c){if(i.failed++,i.errors.push({documentId:h.$id||"unknown",error:c.message||"Unknown error"}),a.stopOnError)throw c}n&&n(l+1,t.length)}return i}async restoreFromBackup(s,t,a){const n={success:!0,collections:{},errors:[],totalProcessed:0,totalSuccess:0,totalFailed:0};try{a&&a({currentCollection:"",processedCollections:0,totalCollections:0,currentRecords:0,totalRecords:0,percentage:0,phase:"validating"});const i=await this.validateBackup(s);if(!i.valid)throw new Error(`Invalid backup: ${i.errors.join(", ")}`);const l=this.RESTORE_ORDER.filter(o=>s.collections[o]&&s.collections[o].length>0),h=l.length;let c=0;if(t.clearExisting){a&&a({currentCollection:"",processedCollections:0,totalCollections:h,currentRecords:0,totalRecords:0,percentage:0,phase:"clearing"});for(const o of l)await this.clearCollection(o)}for(const o of l){a&&a({currentCollection:o,processedCollections:c,totalCollections:h,currentRecords:0,totalRecords:n.totalProcessed,percentage:Math.round(c/h*100),phase:"restoring"});try{const d=s.collections[o],f=await this.restoreCollection(o,d,t,(b,N)=>{a&&a({currentCollection:o,processedCollections:c,totalCollections:h,currentRecords:b,totalRecords:n.totalProcessed+b,percentage:Math.round((c+b/N)/h*100),phase:"restoring"})});n.collections[o]=f,n.totalProcessed+=f.total,n.totalSuccess+=f.success,n.totalFailed+=f.failed,c++}catch(d){if(n.success=!1,n.errors.push({collection:o,error:d.message||"Unknown error"}),t.stopOnError)throw d}}a&&a({currentCollection:"",processedCollections:h,totalCollections:h,currentRecords:n.totalProcessed,totalRecords:n.totalProcessed,percentage:100,phase:"complete"})}catch(i){n.success=!1,n.errors.push({collection:"general",error:i.message||"Unknown error"})}return n}getRestoreSummary(s){const t=[`Total Collections: ${Object.keys(s.collections).length}`,`Total Records Processed: ${s.totalProcessed}`,`Successful: ${s.totalSuccess}`,`Failed: ${s.totalFailed}`];return s.errors.length>0&&(t.push(`
Errors: ${s.errors.length}`),s.errors.forEach(a=>{t.push(`  - ${a.collection}: ${a.error}`)})),t.join(`
`)}}const qc=new Ac;function Fc(){const{toast:r}=Ee(),s=u.useRef(null),[t,a]=u.useState(!1),[n,i]=u.useState(!1),[l,h]=u.useState(null),[c,o]=u.useState(null),[d,f]=u.useState(!1),[b,N]=u.useState(null),[q,L]=u.useState({autoBackup:!0,frequency:"daily",time:"00:00",retention:"30"}),[x,C]=u.useState({createSafetyBackup:!0,clearExisting:!0,handleIdConflicts:"skip",stopOnError:!1}),E=async()=>{a(!0),h(null);try{r({title:"Creating backup...",description:"This may take a few minutes depending on data size"});const R=await Vt.createFullBackup(S=>{h(S)}),M=Vt.getBackupSize(R);await Vt.downloadBackup(R),r({title:"Backup created successfully!",description:`Downloaded ${M} backup file with ${R.metadata.totalRecords} records`})}catch(R){console.error("Backup error:",R),r({title:"Backup failed",description:R.message||"An error occurred during backup",variant:"destructive"})}finally{a(!1),h(null)}},$=R=>{const M=R.target.files?.[0];if(M){if(!M.name.endsWith(".json")){r({title:"Invalid file type",description:"Please select a JSON backup file",variant:"destructive"});return}N(M),f(!0)}},k=async()=>{if(b){f(!1),i(!0),o(null);try{r({title:"Reading backup file...",description:"Please wait while we validate the backup"});const R=await Vt.readBackupFile(b);r({title:"Restoring data...",description:"This may take several minutes. Do not close this window."});const M=await qc.restoreFromBackup(R,x,S=>{o(S)});M.success?r({title:"Restore completed successfully!",description:`Restored ${M.totalSuccess} records across ${Object.keys(M.collections).length} collections`}):(r({title:"Restore completed with errors",description:`${M.totalSuccess} succeeded, ${M.totalFailed} failed. Check console for details.`,variant:"destructive"}),console.error("Restore errors:",M.errors))}catch(R){console.error("Restore error:",R),r({title:"Restore failed",description:R.message||"An error occurred during restore",variant:"destructive"})}finally{i(!1),o(null),N(null),s.current&&(s.current.value="")}}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(Ue,{children:[e.jsx(vs,{className:"h-4 w-4"}),e.jsx(Ke,{children:"Always create a backup before making major changes. Store backups securely in multiple locations."})]}),t&&l&&e.jsxs(G,{children:[e.jsx(le,{children:e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"h-5 w-5 animate-spin"}),"Creating Backup..."]})}),e.jsx(Z,{className:"space-y-4",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsxs("span",{children:["Processing: ",l.currentCollection]}),e.jsxs("span",{children:[l.percentage,"%"]})]}),e.jsx(yt,{value:l.percentage}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:[l.processedCollections," / ",l.totalCollections," collections (",l.totalRecords," records)"]})]})})]}),n&&c&&e.jsxs(G,{children:[e.jsx(le,{children:e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"h-5 w-5 animate-spin"}),"Restoring Data..."]})}),e.jsx(Z,{className:"space-y-4",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsxs("span",{children:["Phase: ",c.phase]}),e.jsxs("span",{children:[c.percentage,"%"]})]}),e.jsx(yt,{value:c.percentage}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:[c.currentCollection&&`Processing: ${c.currentCollection}`,e.jsx("br",{}),c.processedCollections," / ",c.totalCollections," collections (",c.totalRecords," records)"]})]})})]}),e.jsxs(G,{children:[e.jsxs(le,{children:[e.jsx(ce,{children:"Create Backup"}),e.jsx(ye,{children:"Export all your data to a JSON file"})]}),e.jsxs(Z,{className:"space-y-4",children:[e.jsxs(Ue,{children:[e.jsx(Zt,{className:"h-4 w-4"}),e.jsx(Ke,{children:"Full backup includes all master data, transactions, tasks, and status records. The backup file will be downloaded to your computer."})]}),e.jsx(D,{onClick:E,disabled:t||n,className:"gap-2",children:t?e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"h-4 w-4 animate-spin"}),"Creating Backup..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Zt,{className:"h-4 w-4"}),"Create Full Backup"]})})]})]}),e.jsxs(G,{children:[e.jsxs(le,{children:[e.jsx(ce,{children:"Restore Data"}),e.jsx(ye,{children:"Import data from a backup file"})]}),e.jsxs(Z,{className:"space-y-4",children:[e.jsxs(Ue,{children:[e.jsx(vs,{className:"h-4 w-4"}),e.jsx(Ke,{children:"Warning: Restoring will replace current data. Make sure you have a recent backup before proceeding."})]}),e.jsx("input",{ref:s,type:"file",accept:".json",onChange:$,className:"hidden"}),e.jsxs(D,{variant:"outline",onClick:()=>s.current?.click(),disabled:t||n,className:"gap-2",children:[e.jsx(Xt,{className:"h-4 w-4"}),"Select Backup File"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Supported format: JSON backup files created by this system"})]})]}),e.jsx(Qe,{open:d,onOpenChange:f,children:e.jsxs(Ve,{className:"max-w-2xl",children:[e.jsxs(Be,{children:[e.jsx(ze,{children:"Confirm Data Restore"}),e.jsxs(Ye,{children:["You are about to restore data from: ",b?.name]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs(Ue,{children:[e.jsx(vs,{className:"h-4 w-4"}),e.jsx(Ke,{children:"This operation will modify your database. Please review the options carefully."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(_,{children:"Create Safety Backup First"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Backup current data before restoring"})]}),e.jsx(Ps,{checked:x.createSafetyBackup,onCheckedChange:R=>C({...x,createSafetyBackup:R})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(_,{children:"Clear Existing Data"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Remove all current data before restore"})]}),e.jsx(Ps,{checked:x.clearExisting,onCheckedChange:R=>C({...x,clearExisting:R})})]}),e.jsxs("div",{children:[e.jsx(_,{children:"Handle ID Conflicts"}),e.jsxs(te,{value:x.handleIdConflicts,onValueChange:R=>C({...x,handleIdConflicts:R}),children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"skip",children:"Skip existing records"}),e.jsx(v,{value:"overwrite",children:"Overwrite existing records"}),e.jsx(v,{value:"new",children:"Create with new IDs"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(_,{children:"Stop on Error"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Stop restore if any error occurs"})]}),e.jsx(Ps,{checked:x.stopOnError,onCheckedChange:R=>C({...x,stopOnError:R})})]})]})]}),e.jsxs(He,{children:[e.jsx(D,{variant:"outline",onClick:()=>f(!1),children:"Cancel"}),e.jsxs(D,{onClick:k,className:"gap-2",children:[e.jsx(Ms,{className:"h-4 w-4"}),"Start Restore"]})]})]})})]})}function Ic(){const{toast:r}=Ee(),[s,t]=u.useState({minPasswordLength:"8",requireUppercase:!0,requireLowercase:!0,requireNumbers:!0,requireSpecialChars:!0,passwordExpiry:"90",sessionTimeout:"30",maxSessions:"3",enable2FA:!1,loginAttempts:"5",lockoutDuration:"30"});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(G,{children:[e.jsxs(le,{children:[e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(qi,{className:"h-5 w-5"}),"Password Policy"]}),e.jsx(ye,{children:"Configure password requirements"})]}),e.jsxs(Z,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(_,{children:"Minimum Password Length"}),e.jsxs(te,{value:s.minPasswordLength,onValueChange:a=>t({...s,minPasswordLength:a}),children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsx(se,{children:[6,8,10,12,16].map(a=>e.jsxs(v,{value:String(a),children:[a," characters"]},a))})]})]}),e.jsxs("div",{children:[e.jsx(_,{children:"Password Expiry"}),e.jsxs(te,{value:s.passwordExpiry,onValueChange:a=>t({...s,passwordExpiry:a}),children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"never",children:"Never"}),e.jsx(v,{value:"30",children:"30 days"}),e.jsx(v,{value:"60",children:"60 days"}),e.jsx(v,{value:"90",children:"90 days"})]})]})]})]}),e.jsx("div",{className:"space-y-3",children:[{key:"requireUppercase",label:"Require Uppercase Letters"},{key:"requireLowercase",label:"Require Lowercase Letters"},{key:"requireNumbers",label:"Require Numbers"},{key:"requireSpecialChars",label:"Require Special Characters"}].map(({key:a,label:n})=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(_,{children:n}),e.jsx(Ps,{checked:s[a],onCheckedChange:i=>t({...s,[a]:i})})]},a))})]})]}),e.jsxs(G,{children:[e.jsxs(le,{children:[e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(Xr,{className:"h-5 w-5"}),"Session Management"]}),e.jsx(ye,{children:"Control user sessions and timeouts"})]}),e.jsx(Z,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(_,{children:"Session Timeout (minutes)"}),e.jsxs(te,{value:s.sessionTimeout,onValueChange:a=>t({...s,sessionTimeout:a}),children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsx(se,{children:[15,30,60,120].map(a=>e.jsxs(v,{value:String(a),children:[a," minutes"]},a))})]})]}),e.jsxs("div",{children:[e.jsx(_,{children:"Max Concurrent Sessions"}),e.jsxs(te,{value:s.maxSessions,onValueChange:a=>t({...s,maxSessions:a}),children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsx(se,{children:[1,2,3,5,10].map(a=>e.jsxs(v,{value:String(a),children:[a," session",a>1?"s":""]},a))})]})]})]})})]}),e.jsxs(G,{children:[e.jsxs(le,{children:[e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(Ir,{className:"h-5 w-5"}),"Access Control"]}),e.jsx(ye,{children:"Configure login security"})]}),e.jsxs(Z,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(_,{children:"Enable Two-Factor Authentication (2FA)"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Require 2FA for all users"})]}),e.jsx(Ps,{checked:s.enable2FA,onCheckedChange:a=>t({...s,enable2FA:a})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(_,{children:"Login Attempt Limit"}),e.jsxs(te,{value:s.loginAttempts,onValueChange:a=>t({...s,loginAttempts:a}),children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsx(se,{children:[3,5,10].map(a=>e.jsxs(v,{value:String(a),children:[a," attempts"]},a))})]})]}),e.jsxs("div",{children:[e.jsx(_,{children:"Account Lockout Duration"}),e.jsxs(te,{value:s.lockoutDuration,onValueChange:a=>t({...s,lockoutDuration:a}),children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsx(se,{children:[15,30,60].map(a=>e.jsxs(v,{value:String(a),children:[a," minutes"]},a))})]})]})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(D,{onClick:()=>r({title:"Security settings saved"}),className:"gap-2",children:[e.jsx(oa,{className:"h-4 w-4"}),"Save Security Settings"]})})]})}function $c(){const{toast:r}=Ee(),[s,t]=u.useState({host:"smtp.gmail.com",port:"587",username:"noreply@molaga.com",password:"",fromEmail:"noreply@molaga.com",fromName:"Molaga ERP",useTLS:!0}),[a,n]=u.useState({lowStockAlerts:!0,taskCompletion:!0,backupStatus:!0,userLogin:!1,dataImportExport:!0});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(G,{children:[e.jsxs(le,{children:[e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(qa,{className:"h-5 w-5"}),"Email Configuration"]}),e.jsx(ye,{children:"Configure SMTP settings for email notifications"})]}),e.jsxs(Z,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(_,{children:"SMTP Host"}),e.jsx(B,{value:s.host,onChange:i=>t({...s,host:i.target.value})})]}),e.jsxs("div",{children:[e.jsx(_,{children:"SMTP Port"}),e.jsx(B,{value:s.port,onChange:i=>t({...s,port:i.target.value})})]}),e.jsxs("div",{children:[e.jsx(_,{children:"Username"}),e.jsx(B,{value:s.username,onChange:i=>t({...s,username:i.target.value})})]}),e.jsxs("div",{children:[e.jsx(_,{children:"Password"}),e.jsx(B,{type:"password",value:s.password,onChange:i=>t({...s,password:i.target.value})})]}),e.jsxs("div",{children:[e.jsx(_,{children:"From Email"}),e.jsx(B,{type:"email",value:s.fromEmail,onChange:i=>t({...s,fromEmail:i.target.value})})]}),e.jsxs("div",{children:[e.jsx(_,{children:"From Name"}),e.jsx(B,{value:s.fromName,onChange:i=>t({...s,fromName:i.target.value})})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(_,{children:"Use TLS/SSL"}),e.jsx(Ps,{checked:s.useTLS,onCheckedChange:i=>t({...s,useTLS:i})})]}),e.jsxs(D,{variant:"outline",className:"gap-2",children:[e.jsx(Fi,{className:"h-4 w-4"}),"Send Test Email"]})]})]}),e.jsxs(G,{children:[e.jsxs(le,{children:[e.jsx(ce,{children:"Notification Preferences"}),e.jsx(ye,{children:"Choose which notifications to receive"})]}),e.jsx(Z,{className:"space-y-4",children:[{key:"lowStockAlerts",label:"Low Stock Alerts",desc:"Get notified when stock falls below minimum level"},{key:"taskCompletion",label:"Task Completion",desc:"Notifications when tasks are completed"},{key:"backupStatus",label:"Backup Success/Failure",desc:"Get notified about backup operations"},{key:"userLogin",label:"User Login Alerts",desc:"Notifications for user login activity"},{key:"dataImportExport",label:"Data Import/Export Status",desc:"Updates on data operations"}].map(({key:i,label:l,desc:h})=>e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{children:[e.jsx(_,{children:l}),e.jsx("p",{className:"text-sm text-muted-foreground",children:h})]}),e.jsx(Ps,{checked:a[i],onCheckedChange:c=>n({...a,[i]:c})})]},i))})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(D,{onClick:()=>r({title:"Notification settings saved"}),className:"gap-2",children:[e.jsx(oa,{className:"h-4 w-4"}),"Save Settings"]})})]})}const tr="molaga_data_settings",ar={importFormat:"csv",exportFormat:"csv",dateFormat:"DD/MM/YYYY",encoding:"utf8"};class Lc{settings;constructor(){this.settings=this.loadSettings()}loadSettings(){try{const s=localStorage.getItem(tr);if(s)return{...ar,...JSON.parse(s)}}catch(s){console.error("Error loading data settings:",s)}return ar}saveSettings(){try{localStorage.setItem(tr,JSON.stringify(this.settings))}catch(s){console.error("Error saving data settings:",s)}}getSettings(){return{...this.settings}}updateSettings(s){return this.settings={...this.settings,...s},this.saveSettings(),this.getSettings()}async archiveOldRecords(s){return new Promise(t=>{setTimeout(()=>{t({success:!0,count:0})},1e3)})}async deleteCancelledTasks(s){return new Promise(t=>{setTimeout(()=>{t({success:!0,count:0})},1e3)})}async clearAuditLogs(s){return new Promise(t=>{setTimeout(()=>{t({success:!0,count:0})},1e3)})}async optimizeDatabase(){return new Promise(s=>{setTimeout(()=>{s({success:!0,message:"Database optimized successfully"})},2e3)})}}const ut=new Lc;function Mc(){const[r,s]=u.useState(ut.getSettings()),[t,a]=u.useState(!1),n=u.useCallback(o=>{const d=ut.updateSettings(o);return s(d),d},[]),i=u.useCallback(async o=>{a(!0);try{return await ut.archiveOldRecords(o)}finally{a(!1)}},[]),l=u.useCallback(async o=>{a(!0);try{return await ut.deleteCancelledTasks(o)}finally{a(!1)}},[]),h=u.useCallback(async o=>{a(!0);try{return await ut.clearAuditLogs(o)}finally{a(!1)}},[]),c=u.useCallback(async()=>{a(!0);try{return await ut.optimizeDatabase()}finally{a(!1)}},[]);return{settings:r,updateSettings:n,archiveOldRecords:i,deleteCancelledTasks:l,clearAuditLogs:h,optimizeDatabase:c,isProcessing:t}}function Oc(){const{toast:r}=Ee(),{settings:s,updateSettings:t,archiveOldRecords:a,deleteCancelledTasks:n,clearAuditLogs:i,optimizeDatabase:l,isProcessing:h}=Mc(),c=async()=>{if(!confirm("Are you sure you want to archive old records?"))return;const b=await a(12);b.success&&r({title:`Archived ${b.count} records successfully`})},o=async()=>{if(!confirm("Are you sure you want to delete cancelled tasks?"))return;const b=await n(90);b.success&&r({title:`Deleted ${b.count} tasks successfully`})},d=async()=>{if(!confirm("Are you sure you want to clear audit logs?"))return;const b=await i(6);b.success&&r({title:`Cleared ${b.count} log entries successfully`})},f=async()=>{const b=await l();b.success&&r({title:b.message})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(G,{children:[e.jsxs(le,{children:[e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(gt,{className:"h-5 w-5"}),"Import/Export Settings"]}),e.jsx(ye,{children:"Configure default import and export preferences"})]}),e.jsx(Z,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(_,{children:"Default Import Format"}),e.jsxs(te,{value:s.importFormat,onValueChange:b=>t({importFormat:b}),children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"csv",children:"CSV"}),e.jsx(v,{value:"excel",children:"Excel"}),e.jsx(v,{value:"json",children:"JSON"})]})]})]}),e.jsxs("div",{children:[e.jsx(_,{children:"Default Export Format"}),e.jsxs(te,{value:s.exportFormat,onValueChange:b=>t({exportFormat:b}),children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"csv",children:"CSV"}),e.jsx(v,{value:"excel",children:"Excel"}),e.jsx(v,{value:"pdf",children:"PDF"})]})]})]}),e.jsxs("div",{children:[e.jsx(_,{children:"Date Format for Import/Export"}),e.jsxs(te,{value:s.dateFormat,onValueChange:b=>t({dateFormat:b}),children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"DD/MM/YYYY",children:"DD/MM/YYYY"}),e.jsx(v,{value:"MM/DD/YYYY",children:"MM/DD/YYYY"}),e.jsx(v,{value:"YYYY-MM-DD",children:"YYYY-MM-DD"})]})]})]}),e.jsxs("div",{children:[e.jsx(_,{children:"File Encoding"}),e.jsxs(te,{value:s.encoding,onValueChange:b=>t({encoding:b}),children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"utf8",children:"UTF-8"}),e.jsx(v,{value:"utf16",children:"UTF-16"}),e.jsx(v,{value:"ascii",children:"ASCII"})]})]})]})]})})]}),e.jsxs(G,{children:[e.jsxs(le,{children:[e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(Ts,{className:"h-5 w-5"}),"Data Cleanup"]}),e.jsx(ye,{children:"Manage old and unnecessary data"})]}),e.jsxs(Z,{className:"space-y-4",children:[e.jsxs(Ue,{children:[e.jsx(vs,{className:"h-4 w-4"}),e.jsx(Ke,{children:"Data cleanup operations are permanent. Always create a backup before proceeding."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx(_,{children:"Archive Old Records"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Move records older than 12 months to archive"})]}),e.jsx(D,{variant:"outline",onClick:c,disabled:h,children:h?e.jsx(Re,{className:"h-4 w-4 animate-spin"}):"Archive"})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx(_,{children:"Delete Cancelled Tasks"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Remove cancelled tasks older than 90 days"})]}),e.jsx(D,{variant:"outline",onClick:o,disabled:h,children:h?e.jsx(Re,{className:"h-4 w-4 animate-spin"}):"Delete"})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx(_,{children:"Clear Audit Logs"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Remove audit logs older than 6 months"})]}),e.jsx(D,{variant:"outline",onClick:d,disabled:h,children:h?e.jsx(Re,{className:"h-4 w-4 animate-spin"}):"Clear"})]})]})]})]}),e.jsxs(G,{children:[e.jsxs(le,{children:[e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(Zt,{className:"h-5 w-5"}),"Database Maintenance"]}),e.jsx(ye,{children:"Optimize database performance"})]}),e.jsx(Z,{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx(_,{children:"Optimize Database"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Rebuild indexes and optimize tables"})]}),e.jsx(D,{variant:"outline",onClick:f,disabled:h,children:h?e.jsx(Re,{className:"h-4 w-4 animate-spin"}):"Optimize"})]})})]})]})}const mt="molaga_api_keys";class Uc{generateKey(s,t,a){const n=this.createSecureKey(),i=new Date,l={id:this.generateId(),name:s,key:n,createdAt:i.toISOString(),expiresAt:a?new Date(i.getTime()+a*24*60*60*1e3).toISOString():void 0,permissions:t,isActive:!0};return this.saveKey(l),l}createSecureKey(){return`mlg_${this.generateRandomString(32)}`}generateRandomString(s){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let a="";const n=new Uint8Array(s);crypto.getRandomValues(n);for(let i=0;i<s;i++)a+=t[n[i]%t.length];return a}generateId(){return`key_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}saveKey(s){const t=this.getAllKeys();t.push(s),localStorage.setItem(mt,JSON.stringify(t))}getAllKeys(){try{const s=localStorage.getItem(mt);return s?JSON.parse(s):[]}catch(s){return console.error("Error loading API keys:",s),[]}}getKeyById(s){return this.getAllKeys().find(a=>a.id===s)||null}revokeKey(s){const t=this.getAllKeys(),a=t.findIndex(n=>n.id===s);return a!==-1?(t[a].isActive=!1,localStorage.setItem(mt,JSON.stringify(t)),!0):!1}deleteKey(s){const t=this.getAllKeys(),a=t.filter(n=>n.id!==s);return a.length!==t.length?(localStorage.setItem(mt,JSON.stringify(a)),!0):!1}validateKey(s){const a=this.getAllKeys().find(n=>n.key===s);return a?a.isActive?a.expiresAt&&new Date(a.expiresAt)<new Date?{valid:!1,error:"API key has expired"}:{valid:!0,apiKey:a}:{valid:!1,error:"API key has been revoked"}:{valid:!1,error:"Invalid API key"}}updateLastUsed(s){const t=this.getAllKeys(),a=t.findIndex(n=>n.id===s);a!==-1&&(t[a].lastUsed=new Date().toISOString(),localStorage.setItem(mt,JSON.stringify(t)))}regenerateKey(s){const t=this.getAllKeys(),a=t.findIndex(n=>n.id===s);return a!==-1?(t[a],t[a].key=this.createSecureKey(),t[a].createdAt=new Date().toISOString(),t[a].lastUsed=void 0,localStorage.setItem(mt,JSON.stringify(t)),t[a]):null}}const Ls=new Uc;function Kc(){const{toast:r}=Ee(),{user:s}=os(),[t,a]=u.useState(Ls.getAllKeys()),[n,i]=u.useState(!1),[l,h]=u.useState(!1),[c,o]=u.useState({name:"",expiresIn:"90",permissions:["read"]}),[d,f]=u.useState(null),b=s?.email==="varda3d@gmail.com",N=()=>{if(!c.name.trim()){r({title:"Validation error",description:"Please enter a key name",variant:"destructive"});return}const k=c.expiresIn==="never"?void 0:parseInt(c.expiresIn),R=Ls.generateKey(c.name,c.permissions,k);f(R),a(Ls.getAllKeys()),i(!1),h(!0),o({name:"",expiresIn:"90",permissions:["read"]}),r({title:"API key created",description:"Copy the key now - it won't be shown again"})},q=k=>{navigator.clipboard.writeText(k),r({title:"Copied",description:"API key copied to clipboard"})},L=k=>{Ls.revokeKey(k),a(Ls.getAllKeys()),r({title:"API key revoked",description:"The key can no longer be used"})},x=k=>{Ls.deleteKey(k),a(Ls.getAllKeys()),r({title:"API key deleted",description:"The key has been permanently removed"})},C=k=>{const R=Ls.regenerateKey(k);R&&(f(R),a(Ls.getAllKeys()),h(!0),r({title:"API key regenerated",description:"Copy the new key now"}))},E=k=>new Date(k).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),$=k=>k&&new Date(k)<new Date;return b?e.jsxs("div",{className:"space-y-6",children:[e.jsxs(G,{children:[e.jsx(le,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(Na,{className:"h-5 w-5"}),"API Keys"]}),e.jsx(ye,{children:"Generate and manage API keys for external integrations"})]}),e.jsxs(D,{onClick:()=>i(!0),className:"gap-2",children:[e.jsx(fs,{className:"h-4 w-4"}),"Create API Key"]})]})}),e.jsxs(Z,{children:[e.jsxs(Ue,{className:"mb-6",children:[e.jsx(vs,{className:"h-4 w-4"}),e.jsxs(Ke,{children:[e.jsx("strong",{children:"Security Notice:"})," API keys provide access to your system. Keep them secure and never share them publicly."]})]}),t.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(Na,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No API keys created yet"}),e.jsx("p",{className:"text-sm",children:"Create your first API key to get started"})]}):e.jsx("div",{className:"space-y-4",children:t.map(k=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h4",{className:"font-medium",children:k.name}),k.isActive?$(k.expiresAt)?e.jsx(Ae,{variant:"destructive",children:"Expired"}):e.jsx(Ae,{variant:"default",className:"bg-green-500",children:"Active"}):e.jsx(Ae,{variant:"secondary",children:"Revoked"})]}),e.jsxs("div",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsxs("p",{children:["Key: ",k.key.substring(0,20),"...",k.key.substring(k.key.length-4)]}),e.jsxs("p",{children:["Created: ",E(k.createdAt)]}),k.expiresAt&&e.jsxs("p",{children:["Expires: ",E(k.expiresAt)]}),k.lastUsed&&e.jsxs("p",{children:["Last used: ",E(k.lastUsed)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(D,{variant:"outline",size:"sm",onClick:()=>q(k.key),className:"gap-2",children:[e.jsx(At,{className:"h-3 w-3"}),"Copy"]}),k.isActive&&!$(k.expiresAt)&&e.jsxs(e.Fragment,{children:[e.jsxs(D,{variant:"outline",size:"sm",onClick:()=>C(k.id),className:"gap-2",children:[e.jsx(Pa,{className:"h-3 w-3"}),"Regenerate"]}),e.jsx(D,{variant:"outline",size:"sm",onClick:()=>L(k.id),className:"gap-2 text-orange-600 hover:text-orange-700",children:"Revoke"})]}),e.jsxs(D,{variant:"outline",size:"sm",onClick:()=>x(k.id),className:"gap-2 text-red-600 hover:text-red-700",children:[e.jsx(Ts,{className:"h-3 w-3"}),"Delete"]})]})]},k.id))})]})]}),e.jsx(Qe,{open:n,onOpenChange:i,children:e.jsxs(Ve,{children:[e.jsxs(Be,{children:[e.jsx(ze,{children:"Create New API Key"}),e.jsx(Ye,{children:"Generate a new API key for external integrations"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(_,{htmlFor:"keyName",children:"Key Name *"}),e.jsx(B,{id:"keyName",placeholder:"e.g., Mobile App Integration",value:c.name,onChange:k=>o({...c,name:k.target.value})})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"expiresIn",children:"Expires In"}),e.jsxs(te,{value:c.expiresIn,onValueChange:k=>o({...c,expiresIn:k}),children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(v,{value:"30",children:"30 days"}),e.jsx(v,{value:"90",children:"90 days"}),e.jsx(v,{value:"180",children:"180 days"}),e.jsx(v,{value:"365",children:"1 year"}),e.jsx(v,{value:"never",children:"Never"})]})]})]})]}),e.jsxs(He,{children:[e.jsx(D,{variant:"outline",onClick:()=>i(!1),children:"Cancel"}),e.jsx(D,{onClick:N,children:"Create Key"})]})]})}),e.jsx(Qe,{open:l,onOpenChange:h,children:e.jsxs(Ve,{children:[e.jsxs(Be,{children:[e.jsxs(ze,{className:"flex items-center gap-2",children:[e.jsx(Ms,{className:"h-5 w-5 text-green-500"}),"API Key Created"]}),e.jsx(Ye,{children:"Copy this key now - it won't be shown again"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs(Ue,{children:[e.jsx(vs,{className:"h-4 w-4"}),e.jsx(Ke,{children:"Store this key securely. You won't be able to see it again."})]}),e.jsxs("div",{children:[e.jsx(_,{children:"API Key"}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(B,{value:d?.key||"",readOnly:!0,className:"font-mono text-sm"}),e.jsxs(D,{variant:"outline",onClick:()=>q(d?.key||""),className:"gap-2",children:[e.jsx(At,{className:"h-4 w-4"}),"Copy"]})]})]})]}),e.jsx(He,{children:e.jsx(D,{onClick:()=>h(!1),children:"Done"})})]})})]}):e.jsxs(Ue,{children:[e.jsx(vs,{className:"h-4 w-4"}),e.jsx(Ke,{children:"Only Super Admins can manage API keys. Contact your administrator for access."})]})}const rr="molaga_custom_domain";class Vc{getConfig(){try{const s=localStorage.getItem(rr);if(s)return JSON.parse(s)}catch(s){console.error("Error loading domain config:",s)}return{customDomain:null,isVerified:!1,verificationToken:this.generateVerificationToken(),verifiedAt:null,createdAt:null}}setDomain(s){const t=this.getConfig();t.customDomain=s,t.isVerified=!1,t.verifiedAt=null,t.createdAt=new Date().toISOString(),t.verificationToken||(t.verificationToken=this.generateVerificationToken()),this.saveConfig(t)}verifyDomain(){const s=this.getConfig();s.isVerified=!0,s.verifiedAt=new Date().toISOString(),this.saveConfig(s)}removeDomain(){const s={customDomain:null,isVerified:!1,verificationToken:this.generateVerificationToken(),verifiedAt:null,createdAt:null};this.saveConfig(s)}generateVerificationToken(){const s=new Uint8Array(16);return crypto.getRandomValues(s),Array.from(s,t=>t.toString(16).padStart(2,"0")).join("")}saveConfig(s){try{localStorage.setItem(rr,JSON.stringify(s))}catch(t){console.error("Error saving domain config:",t)}}isCustomDomainActive(){const s=this.getConfig();return!!(s.customDomain&&s.isVerified)}getActiveDomain(){const s=this.getConfig();return s.isVerified?s.customDomain:null}}const et=new Vc;function Bc(){const{toast:r}=Ee(),{user:s}=os(),[t,a]=u.useState(et.getConfig()),[n,i]=u.useState(t.customDomain||""),[l,h]=u.useState(!1),c=s?.email==="varda3d@gmail.com",o=()=>{if(!n.trim()){r({title:"Validation error",description:"Please enter a domain name",variant:"destructive"});return}if(!/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(n)){r({title:"Invalid domain",description:"Please enter a valid domain name (e.g., erp.yourcompany.com)",variant:"destructive"});return}et.setDomain(n),a(et.getConfig()),r({title:"Domain saved",description:"Custom domain configuration updated"})},d=async()=>{h(!0),setTimeout(()=>{Math.random()>.3?(et.verifyDomain(),a(et.getConfig()),r({title:"Domain verified",description:"Your custom domain is now active"})):r({title:"Verification failed",description:"Please check your DNS records and try again",variant:"destructive"}),h(!1)},2e3)},f=()=>{et.removeDomain(),a(et.getConfig()),i(""),r({title:"Domain removed",description:"Custom domain configuration has been removed"})},b=N=>{navigator.clipboard.writeText(N),r({title:"Copied",description:"Copied to clipboard"})};return c?e.jsx("div",{className:"space-y-6",children:e.jsxs(G,{children:[e.jsxs(le,{children:[e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(wa,{className:"h-5 w-5"}),"Custom Domain"]}),e.jsx(ye,{children:"Configure a custom domain for your ERP system"})]}),e.jsxs(Z,{className:"space-y-6",children:[e.jsxs(Ue,{children:[e.jsx(vs,{className:"h-4 w-4"}),e.jsxs(Ke,{children:[e.jsx("strong",{children:"Note:"})," Custom domain configuration requires DNS changes. Make sure you have access to your domain's DNS settings."]})]}),t.customDomain&&e.jsxs("div",{className:"p-4 border rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(wa,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:t.customDomain})]}),t.isVerified?e.jsxs(Ae,{className:"bg-green-500",children:[e.jsx(Ms,{className:"h-3 w-3 mr-1"}),"Verified"]}):e.jsx(Ae,{variant:"secondary",children:"Pending Verification"})]}),t.verifiedAt&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Verified on ",new Date(t.verifiedAt).toLocaleDateString()]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(_,{htmlFor:"domain",children:"Domain Name"}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(B,{id:"domain",placeholder:"erp.yourcompany.com",value:n,onChange:N=>i(N.target.value),disabled:t.isVerified}),t.isVerified?e.jsx(D,{variant:"outline",onClick:f,className:"text-red-600",children:"Remove"}):e.jsx(D,{onClick:o,children:"Save"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Enter your custom domain (e.g., erp.yourcompany.com)"})]}),t.customDomain&&!t.isVerified&&e.jsxs(G,{children:[e.jsxs(le,{children:[e.jsx(ce,{className:"text-base",children:"DNS Configuration"}),e.jsx(ye,{children:"Add these DNS records to your domain provider"})]}),e.jsxs(Z,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"p-3 border rounded-lg bg-muted/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Type: CNAME"}),e.jsx(D,{variant:"ghost",size:"sm",onClick:()=>b("CNAME"),className:"h-6 px-2",children:e.jsx(At,{className:"h-3 w-3"})})]}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," ",t.customDomain]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Value:"})," molaga-erp.app"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"TTL:"})," 3600"]})]})]}),e.jsxs("div",{className:"p-3 border rounded-lg bg-muted/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Type: TXT (Verification)"}),e.jsx(D,{variant:"ghost",size:"sm",onClick:()=>b(`molaga-verification=${t.verificationToken}`),className:"h-6 px-2",children:e.jsx(At,{className:"h-3 w-3"})})]}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," _molaga-verification.",t.customDomain]}),e.jsxs("p",{className:"break-all",children:[e.jsx("strong",{children:"Value:"})," molaga-verification=",t.verificationToken]}),e.jsxs("p",{children:[e.jsx("strong",{children:"TTL:"})," 3600"]})]})]})]}),e.jsxs(Ue,{children:[e.jsx(vs,{className:"h-4 w-4"}),e.jsx(Ke,{children:'DNS changes can take up to 48 hours to propagate. After adding the records, click "Verify Domain" below.'})]}),e.jsx(D,{onClick:d,disabled:l,className:"w-full gap-2",children:l?e.jsx(e.Fragment,{children:"Verifying..."}):e.jsxs(e.Fragment,{children:[e.jsx(Ms,{className:"h-4 w-4"}),"Verify Domain"]})})]})]}),t.isVerified&&e.jsxs(G,{children:[e.jsxs(le,{children:[e.jsx(ce,{className:"text-base",children:"SSL Certificate"}),e.jsx(ye,{children:"Your domain is secured with SSL/TLS"})]}),e.jsxs(Z,{children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-600",children:[e.jsx(Ms,{className:"h-4 w-4"}),e.jsx("span",{children:"SSL certificate is active and valid"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Your custom domain is secured with automatic SSL certificate provisioning."})]})]}),e.jsxs(G,{children:[e.jsx(le,{children:e.jsx(ce,{className:"text-base",children:"Need Help?"})}),e.jsxs(Z,{className:"space-y-2",children:[e.jsxs("a",{href:"#",className:"flex items-center gap-2 text-sm text-primary hover:underline",children:[e.jsx(Bt,{className:"h-3 w-3"}),"How to configure DNS records"]}),e.jsxs("a",{href:"#",className:"flex items-center gap-2 text-sm text-primary hover:underline",children:[e.jsx(Bt,{className:"h-3 w-3"}),"Troubleshooting domain verification"]}),e.jsxs("a",{href:"#",className:"flex items-center gap-2 text-sm text-primary hover:underline",children:[e.jsx(Bt,{className:"h-3 w-3"}),"Contact support"]})]})]})]})]})]})}):e.jsxs(Ue,{children:[e.jsx(vs,{className:"h-4 w-4"}),e.jsx(Ke,{children:"Only Super Admins can configure custom domains. Contact your administrator for access."})]})}function Hc(){Ee();const{user:r}=os(),[s,t]=u.useState("overview"),a=r?.email==="varda3d@gmail.com";return e.jsxs("div",{className:"space-y-6",children:[!a&&e.jsxs(Ue,{children:[e.jsx(vs,{className:"h-4 w-4"}),e.jsxs(Ke,{children:[e.jsx("strong",{children:"Read-Only Mode:"})," Only Super Admin (varda3d@gmail.com) can modify integration settings."]})]}),e.jsxs(In,{value:s,onValueChange:t,children:[e.jsxs(Oa,{className:"grid w-full grid-cols-4",children:[e.jsx(pt,{value:"overview",children:"Overview"}),e.jsx(pt,{value:"api-keys",children:"API Keys"}),e.jsx(pt,{value:"domain",children:"Custom Domain"}),e.jsx(pt,{value:"webhooks",children:"Webhooks"})]}),e.jsxs(hs,{value:"overview",className:"space-y-6 mt-6",children:[e.jsxs(G,{children:[e.jsxs(le,{children:[e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(Na,{className:"h-5 w-5"}),"API Configuration"]}),e.jsx(ye,{children:"Quick overview of API settings"})]}),e.jsx(Z,{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(_,{children:"API Access Status"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage API keys in the API Keys tab"})]}),e.jsx(Ae,{variant:"secondary",children:"View Details â†’"})]})})]}),e.jsxs(G,{children:[e.jsxs(le,{children:[e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(wa,{className:"h-5 w-5"}),"Custom Domain"]}),e.jsx(ye,{children:"Configure your custom domain"})]}),e.jsx(Z,{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(_,{children:"Domain Status"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Configure custom domain in the Custom Domain tab"})]}),e.jsx(Ae,{variant:"secondary",children:"View Details â†’"})]})})]}),e.jsxs(G,{children:[e.jsxs(le,{children:[e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(Ii,{className:"h-5 w-5"}),"Third-Party Integrations"]}),e.jsx(ye,{children:"Connect with external services"})]}),e.jsx(Z,{className:"space-y-4",children:[{name:"Accounting Software",status:"Not Connected",available:!1},{name:"Payment Gateway",status:"Not Connected",available:!1},{name:"SMS Gateway",status:"Not Connected",available:!1},{name:"Cloud Storage",status:"Not Connected",available:!1}].map(n=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx(_,{children:n.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:n.status})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!n.available&&e.jsx(Ae,{variant:"secondary",children:"Coming Soon"}),e.jsx(D,{variant:"outline",size:"sm",disabled:!n.available||!a,children:"Configure"})]})]},n.name))})]})]}),e.jsx(hs,{value:"api-keys",className:"mt-6",children:e.jsx(Kc,{})}),e.jsx(hs,{value:"domain",className:"mt-6",children:e.jsx(Bc,{})}),e.jsx(hs,{value:"webhooks",className:"space-y-6 mt-6",children:e.jsxs(G,{children:[e.jsxs(le,{children:[e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx($i,{className:"h-5 w-5"}),"Webhooks"]}),e.jsx(ye,{children:"Configure webhook endpoints for real-time notifications"})]}),e.jsxs(Z,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(_,{children:"Webhook URL"}),e.jsx(B,{placeholder:"https://your-domain.com/webhook",disabled:!a}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Receive POST requests when events occur"})]}),e.jsxs("div",{children:[e.jsx(_,{children:"Events to Subscribe"}),e.jsx("div",{className:"space-y-2 mt-2",children:["Task Created","Task Completed","Low Stock Alert","Backup Completed"].map(n=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:n}),e.jsx(Ps,{disabled:!a})]},n))})]}),e.jsx(D,{variant:"outline",disabled:!a,children:"Test Webhook"})]})]})})]})]})}function zc(){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(G,{children:[e.jsxs(le,{children:[e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(Sa,{className:"h-5 w-5"}),"System Information"]}),e.jsx(ye,{children:"Details about your Molaga ERP installation"})]}),e.jsx(Z,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Application Name"}),e.jsx("p",{className:"font-medium",children:"Molaga ERP"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Version"}),e.jsxs("p",{className:"font-medium flex items-center gap-2",children:["1.0.0",e.jsxs(Ae,{variant:"default",className:"gap-1",children:[e.jsx(Ms,{className:"h-3 w-3"}),"Latest"]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Build Date"}),e.jsx("p",{className:"font-medium",children:"October 11, 2025"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"License Type"}),e.jsx("p",{className:"font-medium",children:"Enterprise"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Licensed To"}),e.jsx("p",{className:"font-medium",children:"Molaga Spices Pvt Ltd"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"License Expiry"}),e.jsx("p",{className:"font-medium",children:"October 11, 2026"})]})]})})]}),e.jsxs(G,{children:[e.jsxs(le,{children:[e.jsx(ce,{children:"Support & Help"}),e.jsx(ye,{children:"Get assistance with Molaga ERP"})]}),e.jsx(Z,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3 p-4 border rounded-lg",children:[e.jsx(gt,{className:"h-5 w-5 text-primary mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Documentation"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Comprehensive guides and tutorials"}),e.jsxs(D,{variant:"link",className:"h-auto p-0 gap-1",children:["View Docs",e.jsx(Bt,{className:"h-3 w-3"})]})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 border rounded-lg",children:[e.jsx(qa,{className:"h-5 w-5 text-primary mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Email Support"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"support@molagaerp.com"}),e.jsx(D,{variant:"link",className:"h-auto p-0",children:"Send Email"})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 border rounded-lg",children:[e.jsx(Li,{className:"h-5 w-5 text-primary mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Phone Support"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"+91 9876543210"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Mon-Fri, 9 AM - 6 PM IST"})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 border rounded-lg",children:[e.jsx(Sa,{className:"h-5 w-5 text-primary mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Submit Feedback"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Help us improve"}),e.jsx(D,{variant:"link",className:"h-auto p-0",children:"Give Feedback"})]})]})]})})]}),e.jsxs(G,{children:[e.jsxs(le,{children:[e.jsx(ce,{children:"Updates"}),e.jsx(ye,{children:"Check for system updates"})]}),e.jsxs(Z,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg bg-muted/50",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"You're running the latest version"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Last checked: October 11, 2025"})]}),e.jsx(D,{variant:"outline",children:"Check for Updates"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium mb-2",children:"Recent Updates"}),e.jsx("div",{className:"space-y-2",children:[{version:"1.0.0",date:"Oct 11, 2025",changes:"Initial release with full ERP features"},{version:"0.9.5",date:"Oct 1, 2025",changes:"Beta testing and bug fixes"},{version:"0.9.0",date:"Sep 15, 2025",changes:"Added validation system"}].map(r=>e.jsxs("div",{className:"p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("p",{className:"font-medium text-sm",children:["Version ",r.version]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r.date})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r.changes})]},r.version))})]})]})]}),e.jsxs(G,{children:[e.jsx(le,{children:e.jsx(ce,{children:"About Molaga ERP"})}),e.jsxs(Z,{children:[e.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed",children:"Molaga ERP is a comprehensive enterprise resource planning system designed specifically for spice manufacturing businesses. It streamlines operations from raw material procurement through production processes to final product sales, providing real-time insights and data-driven decision making capabilities."}),e.jsx("p",{className:"text-sm text-muted-foreground mt-4",children:"Â© 2025 Molaga ERP. All rights reserved."})]})]})]})}const Qc=[{value:"company",label:"Company Profile",icon:Pr},{value:"users",label:"User Management",icon:zr},{value:"approvals",label:"User Approvals",icon:Qr},{value:"system",label:"System Config",icon:Mi},{value:"backup",label:"Backup & Restore",icon:Zt},{value:"security",label:"Security",icon:Xr},{value:"notifications",label:"Notifications",icon:Tr},{value:"data",label:"Data Management",icon:gt},{value:"integrations",label:"Integrations",icon:rt},{value:"about",label:"About",icon:Sa}];function Yc(){const[r,s]=u.useState("company");return e.jsxs("div",{className:"container mx-auto p-6 max-w-7xl",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Settings"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage your system configuration and preferences"})]}),e.jsx(G,{className:"p-6",children:e.jsxs(In,{value:r,onValueChange:s,className:"space-y-6",children:[e.jsx(Oa,{className:"grid grid-cols-3 lg:grid-cols-10 gap-2 h-auto p-2",children:Qc.map(t=>e.jsxs(pt,{value:t.value,className:"flex flex-col items-center gap-1 py-3 data-[state=active]:bg-primary data-[state=active]:text-primary-foreground",children:[e.jsx(t.icon,{className:"h-4 w-4"}),e.jsx("span",{className:"text-xs",children:t.label})]},t.value))}),e.jsx(hs,{value:"company",className:"space-y-4",children:e.jsx(bc,{})}),e.jsx(hs,{value:"users",className:"space-y-4",children:e.jsx(Pc,{})}),e.jsx(hs,{value:"approvals",className:"space-y-4",children:e.jsx(Dc,{})}),e.jsx(hs,{value:"system",className:"space-y-4",children:e.jsx(Ec,{})}),e.jsx(hs,{value:"backup",className:"space-y-4",children:e.jsx(Fc,{})}),e.jsx(hs,{value:"security",className:"space-y-4",children:e.jsx(Ic,{})}),e.jsx(hs,{value:"notifications",className:"space-y-4",children:e.jsx($c,{})}),e.jsx(hs,{value:"data",className:"space-y-4",children:e.jsx(Oc,{})}),e.jsx(hs,{value:"integrations",className:"space-y-4",children:e.jsx(Hc,{})}),e.jsx(hs,{value:"about",className:"space-y-4",children:e.jsx(zc,{})})]})})]})}const Wc=new Ki({defaultOptions:{queries:{staleTime:300*1e3,gcTime:600*1e3,retry:(r,s)=>s?.code===401||s?.code===403?!1:r<3,refetchOnWindowFocus:!1,refetchOnMount:!0,refetchOnReconnect:!0},mutations:{retry:(r,s)=>s?.code===401||s?.code===403?!1:r<2}}}),Gc=Bi([{path:"/login",element:e.jsx(vl,{})},{path:"/register",element:e.jsx(bl,{})},{path:"/",element:e.jsx(Fe,{children:e.jsx(qe,{children:e.jsx(Pl,{})})})},{path:"/purchases",element:e.jsx(Fe,{children:e.jsx(qe,{children:e.jsx(ql,{})})})},{path:"/tasks",element:e.jsx(Fe,{children:e.jsx(qe,{children:e.jsx($l,{})})})},{path:"/status",element:e.jsx(Fe,{children:e.jsx(qe,{children:e.jsx(Ll,{})})})},{path:"/sales",element:e.jsx(Fe,{children:e.jsx(qe,{children:e.jsx(Ml,{})})})},{path:"/sales/units",element:e.jsx(Fe,{children:e.jsx(qe,{children:e.jsx(Kl,{})})})},{path:"/sales/records",element:e.jsx(Fe,{children:e.jsx(qe,{children:e.jsx(Vl,{})})})},{path:"/master",element:e.jsx(Fe,{children:e.jsx(qe,{children:e.jsx(Bl,{})})})},{path:"/master/stocks",element:e.jsx(Fe,{children:e.jsx(qe,{children:e.jsx(Ql,{})})})},{path:"/master/vendors",element:e.jsx(Fe,{children:e.jsx(qe,{children:e.jsx(Yl,{})})})},{path:"/master/staff",element:e.jsx(Fe,{children:e.jsx(qe,{children:e.jsx(Wl,{})})})},{path:"/master/processes",element:e.jsx(Fe,{children:e.jsx(qe,{children:e.jsx(Gl,{})})})},{path:"/master/raw-products",element:e.jsx(Fe,{children:e.jsx(qe,{children:e.jsx(Jl,{})})})},{path:"/master/products",element:e.jsx(Fe,{children:e.jsx(qe,{children:e.jsx(Xl,{})})})},{path:"/master/sales-channels",element:e.jsx(Fe,{children:e.jsx(qe,{children:e.jsx(Zl,{})})})},{path:"/analytics",element:e.jsx(Fe,{children:e.jsx(qe,{children:e.jsx(Hl,{})})})},{path:"/status/stock-status",element:e.jsx(Fe,{children:e.jsx(qe,{children:e.jsx(sc,{})})})},{path:"/status/pre-production-status",element:e.jsx(Fe,{children:e.jsx(qe,{children:e.jsx(ac,{})})})},{path:"/status/production-status",element:e.jsx(Fe,{children:e.jsx(qe,{children:e.jsx(rc,{})})})},{path:"/status/post-production-status",element:e.jsx(Fe,{children:e.jsx(qe,{children:e.jsx(ic,{})})})},{path:"/status/inventory-status",element:e.jsx(Fe,{children:e.jsx(qe,{children:e.jsx(oc,{})})})},{path:"/tasks/pre-production",element:e.jsx(Fe,{children:e.jsx(qe,{children:e.jsx(uc,{})})})},{path:"/tasks/production",element:e.jsx(Fe,{children:e.jsx(qe,{children:e.jsx(xc,{})})})},{path:"/tasks/post-production",element:e.jsx(Fe,{children:e.jsx(qe,{children:e.jsx(jc,{})})})},{path:"/settings",element:e.jsx(Fe,{children:e.jsx(qe,{children:e.jsx(Yc,{})})})},{path:"*",element:e.jsx(zl,{})}],{future:{v7_startTransition:!0}}),Jc=()=>e.jsx(Vi,{client:Wc,children:e.jsx(uo,{children:e.jsx(Eo,{children:e.jsxs(rn,{children:[e.jsx(ro,{}),e.jsx(no,{}),e.jsx($o,{}),e.jsx(Hi,{router:Gc,future:{v7_startTransition:!0}})]})})})});Un.createRoot(document.getElementById("root")).render(e.jsx(Jc,{}));

import{r as u,j as e,R as st,m as Yn}from"./0-react-core-BXPR0Mfe.js";import{V as jr,R as yr,A as vr,C as br,X as Ts,T as Nr,D as wr,P as Wn,j as Gn,$ as Jn,a as Sr,b as Xn,c as Zn,d as ei,S as Fs,W as ti,e as Ka,f as xs,g as _r,O as ba,h as kr,i as Na,k as Cr,l as wa,m as Sa,n as Pr,o as si,H as ai,p as Va,q as Ba,r as Ys,s as Dr,t as Fa,u as Tr,v as Er,w as Rr,x as Ar,y as ri,z as qr,I as Fr,B as $r,E as Ir,F as Lr,G as Mr,J as ni,L as Or,K as Ur,M as ii,N as oi,Q as Kr,U as Vr,Y as li,Z as ci,_ as Be,a0 as Br,a1 as Hr,a2 as di,a3 as Ha,a4 as zr,a5 as ui,a6 as Qr,a7 as mi,a8 as Yr,a9 as hi,aa as Wr,ab as Gr,ac as pi,ad as xi,ae as Jr,af as gi,ag as fi,ah as ji,ai as yi,aj as vi,ak as Xr,al as bi,am as Ni,an as Ws,ao as wi,ap as Zr,aq as Si,ar as Es,as as en,at as Xt,au as _i,av as ga,aw as is,ax as tr,ay as tn,az as ki,aA as Ci,aB as sn,aC as Pi,aD as gt,aE as ts,aF as sr,aG as Di,aH as Ti,aI as Ei,aJ as Lt,aK as ss,aL as an,aM as Ct,aN as Qt,aO as rn,aP as Ri,aQ as nn,aR as on,aS as Ai,aT as qi,aU as Fi,aV as $i,aW as za,aX as ln,aY as cn,aZ as dn,a_ as Ii,a$ as ar,b0 as _a,b1 as Li,b2 as Js,b3 as Hs,b4 as rr,b5 as Qa,b6 as ls,b7 as nr,b8 as un,b9 as Mi,ba as Bt,bb as fa,bc as Oi,bd as mn,be as Ui,bf as $a,bg as Ia,bh as la,bi as Ki,bj as Vi,bk as La,bl as Bi,bm as Hi}from"./1-ui-libs-CYfTKoHn.js";import{at as zi,x as Qi,au as gs,av as Yi}from"./9-vendor-Cgf2AHdi.js";import{u as ye,a as xt,b as Ae,Q as Wi}from"./2-react-query-Bm_g3SPE.js";import{u as cs,N as Ta,a as $s,b as Ya,L as Ft,c as Gi,R as Ji}from"./2-react-router-ChkSCE5l.js";import{C as Xi,A as Zi,D as eo,I as hs,Q as Ve}from"./9-appwrite-Di8VTjYU.js";import{e as Dt,s as Tt,F as Vs,o as Xe,j as zs,G as Kt,H as Ns,a as ws,P as Ms,I as Os}from"./9-utils-Dv0kHtgC.js";import{R as Xs,B as Zs,C as ea,X as ta,Y as sa,T as aa,L as ra,a as na}from"./3-recharts-Ak7A1SLL.js";import{u as St,w as ir,r as to,a as so}from"./9-xlsx-eYdzo_tC.js";import"./2-react-deps-CXNa4utQ.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function s(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(n){if(n.ep)return;n.ep=!0;const i=s(n);fetch(n.href,i)}})();const ao=1,ro=1e6;let Ea=0;function no(){return Ea=(Ea+1)%Number.MAX_SAFE_INTEGER,Ea.toString()}const Ra=new Map,or=r=>{if(Ra.has(r))return;const t=setTimeout(()=>{Ra.delete(r),Bs({type:"REMOVE_TOAST",toastId:r})},ro);Ra.set(r,t)},io=(r,t)=>{switch(t.type){case"ADD_TOAST":return{...r,toasts:[t.toast,...r.toasts].slice(0,ao)};case"UPDATE_TOAST":return{...r,toasts:r.toasts.map(s=>s.id===t.toast.id?{...s,...t.toast}:s)};case"DISMISS_TOAST":{const{toastId:s}=t;return s?or(s):r.toasts.forEach(a=>{or(a.id)}),{...r,toasts:r.toasts.map(a=>a.id===s||s===void 0?{...a,open:!1}:a)}}case"REMOVE_TOAST":return t.toastId===void 0?{...r,toasts:[]}:{...r,toasts:r.toasts.filter(s=>s.id!==t.toastId)}}},ca=[];let da={toasts:[]};function Bs(r){da=io(da,r),ca.forEach(t=>{t(da)})}function oo({...r}){const t=no(),s=n=>Bs({type:"UPDATE_TOAST",toast:{...n,id:t}}),a=()=>Bs({type:"DISMISS_TOAST",toastId:t});return Bs({type:"ADD_TOAST",toast:{...r,id:t,open:!0,onOpenChange:n=>{n||a()}}}),{id:t,dismiss:a,update:s}}function Fe(){const[r,t]=u.useState(da);return u.useEffect(()=>(ca.push(t),()=>{const s=ca.indexOf(t);s>-1&&ca.splice(s,1)}),[r]),{...r,toast:oo,dismiss:s=>Bs({type:"DISMISS_TOAST",toastId:s})}}function me(...r){return zi(Qi(r))}const lo=Wn,hn=u.forwardRef(({className:r,...t},s)=>e.jsx(jr,{ref:s,className:me("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",r),...t}));hn.displayName=jr.displayName;const co=gs("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),pn=u.forwardRef(({className:r,variant:t,...s},a)=>e.jsx(yr,{ref:a,className:me(co({variant:t}),r),...s}));pn.displayName=yr.displayName;const uo=u.forwardRef(({className:r,...t},s)=>e.jsx(vr,{ref:s,className:me("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors group-[.destructive]:border-muted/40 hover:bg-secondary group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 group-[.destructive]:focus:ring-destructive disabled:pointer-events-none disabled:opacity-50",r),...t}));uo.displayName=vr.displayName;const xn=u.forwardRef(({className:r,...t},s)=>e.jsx(br,{ref:s,className:me("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity group-hover:opacity-100 group-[.destructive]:text-red-300 hover:text-foreground group-[.destructive]:hover:text-red-50 focus:opacity-100 focus:outline-none focus:ring-2 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",r),"toast-close":"",...t,children:e.jsx(Ts,{className:"h-4 w-4"})}));xn.displayName=br.displayName;const gn=u.forwardRef(({className:r,...t},s)=>e.jsx(Nr,{ref:s,className:me("text-sm font-semibold",r),...t}));gn.displayName=Nr.displayName;const fn=u.forwardRef(({className:r,...t},s)=>e.jsx(wr,{ref:s,className:me("text-sm opacity-90",r),...t}));fn.displayName=wr.displayName;function mo(){const{toasts:r}=Fe();return e.jsxs(lo,{children:[r.map(function({id:t,title:s,description:a,action:n,...i}){return e.jsxs(pn,{...i,children:[e.jsxs("div",{className:"grid gap-1",children:[s&&e.jsx(gn,{children:s}),a&&e.jsx(fn,{children:a})]}),n,e.jsx(xn,{})]},t)}),e.jsx(hn,{})]})}const ho=({...r})=>{const{theme:t="system"}=Gn();return e.jsx(Jn,{theme:t,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...r})},jn=Xn,po=Zn,xo=ei,yn=u.forwardRef(({className:r,sideOffset:t=4,...s},a)=>e.jsx(Sr,{ref:a,sideOffset:t,className:me("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...s}));yn.displayName=Sr.displayName;const Ce={PRE_PRODUCTION_STATUS:"pre_production_status",PRODUCTION_STATUS:"production_status",POST_PRODUCTION_STATUS:"post_production_status",INVENTORY_STATUS:"inventory_status",STOCK_STATUS:"stock_status",TASKS:"tasks",PRE_PRODUCTION_TASKS:"pre_production_tasks",PRODUCTION_TASKS:"production_tasks",PRODUCTION_TASK_ITEMS:"production_task_items",POST_PRODUCTION_TASKS:"post_production_tasks",STOCKS:"stocks",RAW_PRODUCTS:"raw_products",VENDORS:"vendors",STAFF:"staff",PROCESSES:"processes",PRODUCTS:"products",SALES_CHANNELS:"sales_channels",PURCHASES:"purchases",SALES_ORDERS:"sales_orders",SALES_ORDER_ITEMS:"sales_order_items",SALES_UNITS:"sales_units",SALES_RECORDS:"sales_records"},go="https://fra.cloud.appwrite.io/v1",fo="68cb76af00043a1c3b77",ka=new Xi;ka.setEndpoint(go);ka.setProject(fo);const at=new eo(ka),Ht=new Zi(ka),rt="68cb77a000339977dcb0",vn=u.createContext(void 0),vt=()=>{const r=u.useContext(vn);if(r===void 0)throw new Error("useAuth must be used within an AuthProvider");return r},jo=({children:r})=>{const[t,s]=u.useState(null),[a,n]=u.useState(!0);u.useEffect(()=>{i()},[]);const i=async()=>{try{if(window.self!==window.top){console.log("Running in iframe environment (preview mode)");const j=localStorage.getItem("appwrite-auth-user");if(j)try{const f=JSON.parse(j);s(f),console.log("Using stored user data in iframe:",f.email),n(!1);return}catch{console.log("Invalid stored user data, clearing..."),localStorage.removeItem("appwrite-auth-user")}}const x=await Ht.get();s(x),localStorage.setItem("appwrite-auth-user",JSON.stringify(x)),console.log("Authenticated user:",x.email)}catch(b){s(null),localStorage.removeItem("appwrite-auth-user"),console.error("Authentication check failed:",{code:b.code,message:b.message,type:b.type,response:b.response,isInIframe:window.self!==window.top}),b.code===401?console.log("Session expired or invalid, user needs to login again"):console.log("Not authenticated:",b.message)}finally{n(!1)}},c=async(b,x)=>{try{await Ht.createEmailPasswordSession(b,x);const j=await Ht.get();s(j),localStorage.setItem("appwrite-auth-user",JSON.stringify(j)),console.log("Successfully authenticated user:",j.email)}catch(j){throw console.error("Authentication error:",j.message),j}},g={user:t,login:c,register:async(b,x,j)=>{try{await Ht.create("unique()",b,x,j),await c(b,x)}catch(f){throw f}},loginWithGoogle:async()=>{try{Ht.createOAuth2Session("google",`${window.location.origin}/`,`${window.location.origin}/login`)}catch(b){throw b}},logout:async()=>{try{await Ht.deleteSession("current"),s(null),localStorage.removeItem("appwrite-auth-user"),console.log("Successfully logged out")}catch(b){console.error("Logout error:",b.message),s(null),localStorage.removeItem("appwrite-auth-user")}},loading:a};return e.jsx(vn.Provider,{value:g,children:r})};class he{static field(t){return new yo(t)}static PATTERNS={EMAIL:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,PHONE:/^[\+]?[1-9][\d]{0,15}$/,PHONE_INTERNATIONAL:/^\+?[1-9]\d{1,14}$/,PHONE_US:/^(\+1|1)?[-.\s]?\(?[0-9]{3}\)?[-.\s]?[0-9]{3}[-.\s]?[0-9]{4}$/,URL:/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)$/,ALPHANUMERIC:/^[a-zA-Z0-9]+$/,ALPHA:/^[a-zA-Z]+$/,NUMERIC:/^[0-9]+$/,DECIMAL:/^[0-9]+(\.[0-9]+)?$/,DATE_ISO:/^\d{4}-\d{2}-\d{2}$/,DATE_US:/^(0[1-9]|1[0-2])\/(0[1-9]|[12][0-9]|3[01])\/\d{4}$/,TIME_24H:/^([01]?[0-9]|2[0-3]):[0-5][0-9]$/,TIME_12H:/^(0?[1-9]|1[0-2]):[0-5][0-9]\s?(AM|PM|am|pm)$/,SKU:/^[A-Z0-9\-_]+$/,CURRENCY:/^\$?[0-9]+(\.[0-9]{2})?$/};static COMMON_RULES={email:()=>({field:"email",type:"format",options:{pattern:he.PATTERNS.EMAIL},message:"Invalid email format"}),phone:()=>({field:"phone",type:"format",options:{pattern:he.PATTERNS.PHONE},message:"Invalid phone number format"}),currency:()=>({field:"amount",type:"format",options:{pattern:he.PATTERNS.CURRENCY},message:"Invalid currency format (e.g., 123.45 or $123.45)"}),sku:()=>({field:"sku",type:"format",options:{pattern:he.PATTERNS.SKU},message:"SKU must contain only uppercase letters, numbers, hyphens, and underscores"}),positiveNumber:t=>({field:t,type:"range",options:{min:0},message:"Value must be a positive number"}),percentage:t=>({field:t,type:"range",options:{min:0,max:100},message:"Percentage must be between 0 and 100"})};static isValidEmail(t){return this.PATTERNS.EMAIL.test(t)}static isValidPhone(t){return this.PATTERNS.PHONE.test(t)}static isValidDate(t){if(!t)return!1;if(t instanceof Date)return!isNaN(t.getTime());if(typeof t=="number"){if(t>1&&t<3e6){const s=new Date(1900,0,1),a=new Date(s.getTime()+(t-2)*864e5);return!isNaN(a.getTime())}return!1}if(typeof t=="string"){if(/^\d{4}-\d{2}-\d{2}$/.test(t.trim())){const a=new Date(t);return!isNaN(a.getTime())}const s=new Date(t);return!isNaN(s.getTime())}return!1}static isValidNumber(t,s,a){const n=Number(t);return!(isNaN(n)||s!==void 0&&n<s||a!==void 0&&n>a)}static isValidStringLength(t,s,a){return!(typeof t!="string"||s!==void 0&&t.length<s||a!==void 0&&t.length>a)}static isOneOf(t,s){return s.includes(t)}static isUnique(t,s,a,n){return a.filter((c,p)=>n!==void 0&&p===n?!1:c[s]===t).length===0}static sanitizeValue(t){if(typeof t=="string"){if(t=t.trim(),t==="")return null;t=t.replace(/[\u200B-\u200D\uFEFF]/g,""),t=t.replace(/\u00A0/g," ")}return t}static convertType(t,s){if(t==null)return null;switch(s){case"string":return String(t);case"number":const a=Number(t);return isNaN(a)?null:a;case"boolean":if(typeof t=="boolean")return t;if(typeof t=="string"){const i=t.toLowerCase();if(["true","1","yes","y","on"].includes(i))return!0;if(["false","0","no","n","off"].includes(i))return!1}return!!t;case"date":const n=new Date(t);return isNaN(n.getTime())?null:n;default:return t}}static formatErrorMessage(t,s,a){if(s.message)return s.message;switch(s.type){case"required":return`${t} is required`;case"format":return`${t} has invalid format`;case"range":return s.options?.min!==void 0&&s.options?.max!==void 0?`${t} must be between ${s.options.min} and ${s.options.max}`:s.options?.min!==void 0?`${t} must be at least ${s.options.min}`:s.options?.max!==void 0?`${t} must be at most ${s.options.max}`:`${t} is out of range`;case"unique":return`${t} must be unique (duplicate value: ${a})`;default:return`${t} validation failed`}}static createRulesForDataType(t,s,a=!1){const n=[];switch(a&&n.push({field:t,type:"required",message:`${t} is required`}),s.toLowerCase()){case"email":n.push(this.COMMON_RULES.email());break;case"phone":n.push(this.COMMON_RULES.phone());break;case"currency":case"money":n.push(this.COMMON_RULES.currency());break;case"sku":n.push(this.COMMON_RULES.sku());break;case"percentage":n.push(this.COMMON_RULES.percentage(t));break;case"positive_number":n.push(this.COMMON_RULES.positiveNumber(t));break;case"date":n.push({field:t,type:"custom",validator:i=>this.isValidDate(i),message:"Invalid date format"});break;case"url":n.push({field:t,type:"format",options:{pattern:this.PATTERNS.URL},message:"Invalid URL format"});break}return n}static createForeignKeyRule(t,s,a="id",n){return{field:t,type:"custom",validator:i=>i?s.some(c=>c[a]===i):!0,message:n||`${t} must reference a valid ${a}`}}static createConditionalRule(t,s,a){return{...a,field:t,validator:(n,i)=>{if(!s(i))return!0;if(a.validator)return a.validator(n,i);switch(a.type){case"required":return n!=null&&n!=="";case"format":return a.options?.pattern?a.options.pattern.test(String(n)):!0;default:return!0}}}}}class yo{constructor(t){this.field=t,this.rule={field:t}}rule;required(){return this.rule.type="required",this.rule.message=`${this.field} is required`,this}email(){return this.rule.type="format",this.rule.options={pattern:he.PATTERNS.EMAIL},this.rule.message="Invalid email format",this}phone(){return this.rule.type="format",this.rule.options={pattern:he.PATTERNS.PHONE},this.rule.message="Invalid phone number format",this}number(t,s){return this.rule.type="range",this.rule.options={min:t,max:s},t!==void 0&&s!==void 0?this.rule.message=`Must be between ${t} and ${s}`:t!==void 0?this.rule.message=`Must be at least ${t}`:s!==void 0&&(this.rule.message=`Must be at most ${s}`),this}string(t,s){return this.rule.type="custom",this.rule.validator=a=>he.isValidStringLength(String(a),t,s),t!==void 0&&s!==void 0?this.rule.message=`Must be between ${t} and ${s} characters`:t!==void 0?this.rule.message=`Must be at least ${t} characters`:s!==void 0&&(this.rule.message=`Must be at most ${s} characters`),this}date(){return this.rule.type="custom",this.rule.validator=t=>he.isValidDate(t),this.rule.message="Invalid date format",this}boolean(){return this.rule.type="custom",this.rule.validator=t=>{if(typeof t=="boolean")return!0;if(typeof t=="string"){const s=t.toLowerCase();return["true","false","1","0","yes","no","y","n"].includes(s)}return!1},this.rule.message="Must be a valid boolean value (true/false, yes/no, 1/0)",this}oneOf(t){return this.rule.type="custom",this.rule.validator=s=>he.isOneOf(s,t),this.rule.message=`Must be one of: ${t.join(", ")}`,this}pattern(t,s){return this.rule.type="format",this.rule.options={pattern:t},this.rule.message=s||"Invalid format",this}unique(){return this.rule.type="unique",this.rule.message=`${this.field} must be unique`,this}custom(t,s){return this.rule.type="custom",this.rule.validator=(a,n,i)=>{const c={row:n||{},rowNumber:n&&n._rowNumber||0,allData:i||[],fieldName:this.field};return t(a,c)},this.rule.message=s||"Custom validation failed",this}build(){return this.rule}}const vo=r=>{try{if(!r)return"No Date";const t=new Date(r);if(isNaN(t.getTime()))return console.warn("Invalid date value:",r),"Invalid Date";const s=String(t.getDate()).padStart(2,"0"),a=String(t.getMonth()+1).padStart(2,"0"),n=t.getFullYear();return`${s}/${a}/${n}`}catch(t){return console.error("Date formatting error:",t,"Input:",r),"Invalid Date"}},Ca=r=>{try{if(!r)return console.warn("formatTableDate: Empty date value received"),"No Date";if(r==="Invalid Date"||r==="NaN")return console.warn("formatTableDate: Invalid date string received:",r),"Invalid Date";let t;if(typeof r=="string"&&/^\d{2}\/\d{2}\/\d{4}$/.test(r)){const[c,p,m]=r.split("/");t=new Date(`${m}-${p}-${c}`)}else t=new Date(r);if(isNaN(t.getTime()))return console.warn("formatTableDate: Could not parse date:",r,"Type:",typeof r),"Invalid Date";const s=String(t.getDate()).padStart(2,"0"),a=String(t.getMonth()+1).padStart(2,"0"),n=t.getFullYear(),i=`${s}/${a}/${n}`;return console.log("ðŸ“… formatTableDate:",{input:r,output:i}),i}catch(t){return console.error("formatTableDate: Error formatting date:",t,"Input:",r),"Invalid Date"}},fs=r=>vo(r),bo={pageName:"stocks",exportEnabled:!0,importEnabled:!0,sortableColumns:["name","sku","category","unit","openingBalance","createdAt"],exportColumns:[{dataKey:"name",exportHeader:"Stock Name",required:!0},{dataKey:"sku",exportHeader:"SKU",required:!0},{dataKey:"category",exportHeader:"Category"},{dataKey:"unit",exportHeader:"Unit",required:!0},{dataKey:"openingBalance",exportHeader:"Opening Balance",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"description",exportHeader:"Description"},{dataKey:"createdAt",exportHeader:"Created Date",dataType:"date",formatter:r=>fs(r)}],importValidation:[he.field("name").required().string(1,100).build(),he.field("sku").required().pattern(he.PATTERNS.SKU).build(),he.field("unit").required().oneOf(["kg","g","l","ml","pcs","box","pack"]).build(),he.field("openingBalance").number(0).build(),he.field("category").string(0,50).build()],tableColumns:[{key:"name",label:"Stock Name",sortable:!0,dataType:"string"},{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"category",label:"Category",sortable:!0,dataType:"string"},{key:"unit",label:"Unit",sortable:!0,dataType:"string"},{key:"openingBalance",label:"Opening Balance",sortable:!0,dataType:"number",align:"right"},{key:"createdAt",label:"Created",sortable:!0,dataType:"date"}]},No={pageName:"products",exportEnabled:!0,importEnabled:!0,sortableColumns:["name","sku","category","price","createdAt"],exportColumns:[{dataKey:"name",exportHeader:"Product Name",required:!0},{dataKey:"sku",exportHeader:"SKU",required:!0},{dataKey:"category",exportHeader:"Category"},{dataKey:"price",exportHeader:"Price",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"description",exportHeader:"Description"},{dataKey:"isActive",exportHeader:"Active",dataType:"boolean",formatter:r=>r?"Yes":"No"},{dataKey:"createdAt",exportHeader:"Created Date",dataType:"date",formatter:r=>fs(r)}],importValidation:[he.field("name").required().string(1,100).build(),he.field("sku").required().pattern(he.PATTERNS.SKU).build(),he.field("price").number(0).build(),he.field("category").string(0,50).build(),he.field("isActive").boolean().build()],tableColumns:[{key:"name",label:"Product Name",sortable:!0,dataType:"string"},{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"category",label:"Category",sortable:!0,dataType:"string"},{key:"price",label:"Price",sortable:!0,dataType:"number",align:"right"},{key:"isActive",label:"Active",sortable:!0,dataType:"boolean"},{key:"createdAt",label:"Created",sortable:!0,dataType:"date"}]},wo={pageName:"raw-products",exportEnabled:!0,importEnabled:!0,sortableColumns:["name","sku","unit","costPerUnit","createdAt"],exportColumns:[{dataKey:"name",exportHeader:"Raw Product Name",required:!0},{dataKey:"sku",exportHeader:"SKU",required:!0},{dataKey:"unit",exportHeader:"Unit",required:!0},{dataKey:"costPerUnit",exportHeader:"Cost Per Unit",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"description",exportHeader:"Description"},{dataKey:"createdAt",exportHeader:"Created Date",dataType:"date",formatter:r=>fs(r)}],importValidation:[he.field("name").required().string(1,100).build(),he.field("sku").required().pattern(he.PATTERNS.SKU).build(),he.field("unit").required().oneOf(["kg","g","l","ml","pcs","box","pack"]).build(),he.field("costPerUnit").number(0).build()],tableColumns:[{key:"name",label:"Raw Product Name",sortable:!0,dataType:"string"},{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"unit",label:"Unit",sortable:!0,dataType:"string"},{key:"costPerUnit",label:"Cost Per Unit",sortable:!0,dataType:"number",align:"right"},{key:"createdAt",label:"Created",sortable:!0,dataType:"date"}]},So={pageName:"staff",exportEnabled:!0,importEnabled:!0,sortableColumns:["name","email","phone","role","isActive","createdAt"],exportColumns:[{dataKey:"name",exportHeader:"Staff Name",required:!0},{dataKey:"email",exportHeader:"Email",required:!0},{dataKey:"phone",exportHeader:"Phone"},{dataKey:"role",exportHeader:"Role",required:!0},{dataKey:"department",exportHeader:"Department"},{dataKey:"isActive",exportHeader:"Active",dataType:"boolean",formatter:r=>r?"Yes":"No"},{dataKey:"createdAt",exportHeader:"Created Date",dataType:"date",formatter:r=>fs(r)}],importValidation:[he.field("name").required().string(1,100).build(),he.field("email").required().email().build(),he.field("phone").phone().build(),he.field("role").required().oneOf(["admin","manager","operator","viewer"]).build(),he.field("department").string(0,50).build(),he.field("isActive").boolean().build()],tableColumns:[{key:"name",label:"Staff Name",sortable:!0,dataType:"string"},{key:"email",label:"Email",sortable:!0,dataType:"string"},{key:"phone",label:"Phone",sortable:!0,dataType:"string"},{key:"role",label:"Role",sortable:!0,dataType:"string"},{key:"isActive",label:"Active",sortable:!0,dataType:"boolean"},{key:"createdAt",label:"Created",sortable:!0,dataType:"date"}]},_o={pageName:"vendors",exportEnabled:!0,importEnabled:!0,sortableColumns:["name","email","phone","contactPerson","isActive","createdAt"],exportColumns:[{dataKey:"name",exportHeader:"Vendor Name",required:!0},{dataKey:"email",exportHeader:"Email"},{dataKey:"phone",exportHeader:"Phone"},{dataKey:"contactPerson",exportHeader:"Contact Person"},{dataKey:"address",exportHeader:"Address"},{dataKey:"isActive",exportHeader:"Active",dataType:"boolean",formatter:r=>r?"Yes":"No"},{dataKey:"createdAt",exportHeader:"Created Date",dataType:"date",formatter:r=>fs(r)}],importValidation:[he.field("name").required().string(1,100).build(),he.field("email").email().build(),he.field("phone").phone().build(),he.field("contactPerson").string(0,100).build(),he.field("address").string(0,200).build(),he.field("isActive").boolean().build()],tableColumns:[{key:"name",label:"Vendor Name",sortable:!0,dataType:"string"},{key:"email",label:"Email",sortable:!0,dataType:"string"},{key:"phone",label:"Phone",sortable:!0,dataType:"string"},{key:"contactPerson",label:"Contact Person",sortable:!0,dataType:"string"},{key:"isActive",label:"Active",sortable:!0,dataType:"boolean"},{key:"createdAt",label:"Created",sortable:!0,dataType:"date"}]},ko={pageName:"processes",exportEnabled:!0,importEnabled:!0,sortableColumns:["name","description","estimatedTime","isActive","createdAt"],exportColumns:[{dataKey:"name",exportHeader:"Process Name",required:!0},{dataKey:"description",exportHeader:"Description"},{dataKey:"estimatedTime",exportHeader:"Estimated Time (minutes)",dataType:"number"},{dataKey:"isActive",exportHeader:"Active",dataType:"boolean",formatter:r=>r?"Yes":"No"},{dataKey:"createdAt",exportHeader:"Created Date",dataType:"date",formatter:r=>fs(r)}],importValidation:[he.field("name").required().string(1,100).build(),he.field("description").string(0,500).build(),he.field("estimatedTime").number(0).build(),he.field("isActive").boolean().build()],tableColumns:[{key:"name",label:"Process Name",sortable:!0,dataType:"string"},{key:"description",label:"Description",sortable:!0,dataType:"string"},{key:"estimatedTime",label:"Est. Time (min)",sortable:!0,dataType:"number",align:"right"},{key:"isActive",label:"Active",sortable:!0,dataType:"boolean"},{key:"createdAt",label:"Created",sortable:!0,dataType:"date"}]},Co={pageName:"sales-channels",exportEnabled:!0,importEnabled:!0,sortableColumns:["name","type","commission","isActive","createdAt"],exportColumns:[{dataKey:"name",exportHeader:"Channel Name",required:!0},{dataKey:"type",exportHeader:"Type",required:!0},{dataKey:"commission",exportHeader:"Commission (%)",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"description",exportHeader:"Description"},{dataKey:"isActive",exportHeader:"Active",dataType:"boolean",formatter:r=>r?"Yes":"No"},{dataKey:"createdAt",exportHeader:"Created Date",dataType:"date",formatter:r=>fs(r)}],importValidation:[he.field("name").required().string(1,100).build(),he.field("type").required().oneOf(["online","retail","wholesale","distributor"]).build(),he.field("commission").number(0,100).build(),he.field("description").string(0,500).build(),he.field("isActive").boolean().build()],tableColumns:[{key:"name",label:"Channel Name",sortable:!0,dataType:"string"},{key:"type",label:"Type",sortable:!0,dataType:"string"},{key:"commission",label:"Commission (%)",sortable:!0,dataType:"number",align:"right"},{key:"isActive",label:"Active",sortable:!0,dataType:"boolean"},{key:"createdAt",label:"Created",sortable:!0,dataType:"date"}]},Po={pageName:"sales-units",exportEnabled:!0,importEnabled:!0,sortableColumns:["date","productName","sku","units","status","remarks"],exportColumns:[{dataKey:"date",exportHeader:"Date",dataType:"date",formatter:r=>new Date(r).toLocaleDateString("en-GB")},{dataKey:"productName",exportHeader:"Product",required:!0},{dataKey:"sku",exportHeader:"SKU",required:!0},{dataKey:"units",exportHeader:"Units",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"status",exportHeader:"Status"},{dataKey:"remarks",exportHeader:"Remarks"}],importValidation:[he.field("date").required().date().build(),he.field("productName").required().string(1,100).build(),he.field("sku").required().string(1,50).build(),he.field("units").required().number(.01).build(),he.field("status").string(0,50).build(),he.field("remarks").string(0,500).build()],tableColumns:[{key:"date",label:"Date",sortable:!0,dataType:"date"},{key:"productName",label:"Product",sortable:!0,dataType:"string"},{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"units",label:"Units",sortable:!0,dataType:"number",align:"right"},{key:"status",label:"Status",sortable:!0,dataType:"string"},{key:"remarks",label:"Remarks",sortable:!0,dataType:"string"}]},Do={pageName:"sales-record",exportEnabled:!0,importEnabled:!0,sortableColumns:["date","channelName","productName","sku","qty","rate","totalAmount","status","remarks"],exportColumns:[{dataKey:"date",exportHeader:"Date",dataType:"date",formatter:r=>new Date(r).toLocaleDateString("en-GB")},{dataKey:"channelName",exportHeader:"Sales Channel",required:!0},{dataKey:"productName",exportHeader:"Product",required:!0},{dataKey:"sku",exportHeader:"SKU",required:!0},{dataKey:"qty",exportHeader:"Qty",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"rate",exportHeader:"Rate",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"totalAmount",exportHeader:"Total Amount",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"status",exportHeader:"Status"},{dataKey:"remarks",exportHeader:"Remarks"}],importValidation:[he.field("date").required().date().build(),he.field("channelName").required().string(1,100).build(),he.field("productName").required().string(1,100).build(),he.field("sku").required().string(1,50).build(),he.field("qty").required().number(.01).build(),he.field("rate").required().number(.01).build(),he.field("remarks").string(0,500).build()],tableColumns:[{key:"date",label:"Date",sortable:!0,dataType:"date"},{key:"channelName",label:"Sales Channel",sortable:!0,dataType:"string"},{key:"productName",label:"Product",sortable:!0,dataType:"string"},{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"qty",label:"Qty",sortable:!0,dataType:"number",align:"right"},{key:"rate",label:"Rate",sortable:!0,dataType:"number",align:"right"},{key:"totalAmount",label:"Total Amount",sortable:!0,dataType:"number",align:"right"},{key:"status",label:"Status",sortable:!0,dataType:"string"},{key:"remarks",label:"Remarks",sortable:!0,dataType:"string"}]},To={pageName:"purchases",exportEnabled:!0,importEnabled:!0,sortableColumns:["purchaseCode","date","vendorName","stockName","quantity","rate","totalAmount","status"],exportColumns:[{dataKey:"purchaseCode",exportHeader:"Purchase Code",required:!0},{dataKey:"date",exportHeader:"Date",dataType:"date",formatter:r=>new Date(r).toLocaleDateString("en-GB")},{dataKey:"vendorName",exportHeader:"Vendor Name",required:!0},{dataKey:"stockName",exportHeader:"Stock Name",required:!0},{dataKey:"quantity",exportHeader:"Quantity",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"rate",exportHeader:"Rate",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"totalAmount",exportHeader:"Total Amount",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"status",exportHeader:"Status"}],importValidation:[he.field("purchaseCode").required().string(1,50).build(),he.field("date").required().date().build(),he.field("vendorName").required().string(1,100).build(),he.field("stockName").required().string(1,100).build(),he.field("quantity").required().number(.01).build(),he.field("rate").required().number(.01).build(),he.field("totalAmount").number(.01).build(),he.field("status").string(0,50).build()],tableColumns:[{key:"purchaseCode",label:"Purchase Code",sortable:!0,dataType:"string"},{key:"date",label:"Date",sortable:!0,dataType:"date"},{key:"vendorName",label:"Vendor Name",sortable:!0,dataType:"string"},{key:"stockName",label:"Stock Name",sortable:!0,dataType:"string"},{key:"quantity",label:"Quantity",sortable:!0,dataType:"number",align:"right"},{key:"unitPrice",label:"Unit Price",sortable:!0,dataType:"number",align:"right"},{key:"totalAmount",label:"Total",sortable:!0,dataType:"number",align:"right"},{key:"purchaseDate",label:"Purchase Date",sortable:!0,dataType:"date"},{key:"vendorName",label:"Vendor",sortable:!0,dataType:"string"},{key:"createdAt",label:"Created",sortable:!0,dataType:"date"}]},Eo={pageName:"pre-production-tasks",exportEnabled:!0,importEnabled:!0,sortableColumns:["task_id","stock_name","stock_source","date_assigned","process_name","assigned_quantity","staff_name","date_completed","completed_quantity","wastage_quantity","status"],exportColumns:[{dataKey:"task_id",exportHeader:"Task ID",required:!0},{dataKey:"stock_name",exportHeader:"Stock Name",required:!0},{dataKey:"stock_source",exportHeader:"Stock Source"},{dataKey:"date_assigned",exportHeader:"Date Assigned",dataType:"date",formatter:r=>new Date(r).toLocaleDateString("en-GB")},{dataKey:"process_name",exportHeader:"Process",required:!0},{dataKey:"assigned_quantity",exportHeader:"Assigned Qty",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"staff_name",exportHeader:"Staff Name"},{dataKey:"date_completed",exportHeader:"Date Completed",dataType:"date",formatter:r=>r?new Date(r).toLocaleDateString("en-GB"):""},{dataKey:"completed_quantity",exportHeader:"Completed Qty",dataType:"number",formatter:r=>r?Number(r).toFixed(2):"0.00"},{dataKey:"wastage_quantity",exportHeader:"Wastage Qty",dataType:"number",formatter:r=>r?Number(r).toFixed(2):"0.00"},{dataKey:"remarks",exportHeader:"Remarks"},{dataKey:"status",exportHeader:"Status"}],importValidation:[he.field("task_id").required().string(1,50).build(),he.field("stock_name").required().string(1,100).build(),he.field("assigned_quantity").required().number(.01).build(),he.field("date_assigned").date().build(),he.field("staff_name").string(0,100).build()],tableColumns:[{key:"task_id",label:"Task ID",sortable:!0,dataType:"string"},{key:"stock_name",label:"Stock Name",sortable:!0,dataType:"string"},{key:"stock_source",label:"Stock Source",sortable:!0,dataType:"string"},{key:"date_assigned",label:"Date Assigned",sortable:!0,dataType:"date"},{key:"process_name",label:"Process",sortable:!0,dataType:"string"},{key:"assigned_quantity",label:"Assigned Qty",sortable:!0,dataType:"number",align:"right"},{key:"staff_name",label:"Staff Name",sortable:!0,dataType:"string"},{key:"date_completed",label:"Date Completed",sortable:!0,dataType:"date"},{key:"completed_quantity",label:"Completed Qty",sortable:!0,dataType:"number",align:"right"},{key:"wastage_quantity",label:"Wastage Qty",sortable:!0,dataType:"number",align:"right"},{key:"status",label:"Status",sortable:!0,dataType:"string"}]},Ro={pageName:"production-tasks",exportEnabled:!0,importEnabled:!0,sortableColumns:["task_id","date","raw_product_name","process_name","source_process_name","staff_name","assigned_quantity","completed_quantity","date_completed","wastage_quantity","status"],exportColumns:[{dataKey:"task_id",exportHeader:"Task ID",required:!0},{dataKey:"date",exportHeader:"Date",dataType:"date",formatter:r=>new Date(r).toLocaleDateString("en-GB")},{dataKey:"raw_product_name",exportHeader:"Raw Product",required:!0},{dataKey:"process_name",exportHeader:"Process",required:!0},{dataKey:"source_process_name",exportHeader:"Source Process"},{dataKey:"staff_name",exportHeader:"Staff Name"},{dataKey:"assigned_quantity",exportHeader:"Assigned Qty",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"completed_quantity",exportHeader:"Completed Qty",dataType:"number",formatter:r=>r?Number(r).toFixed(2):"0.00"},{dataKey:"date_completed",exportHeader:"Date Completed",dataType:"date",formatter:r=>r?new Date(r).toLocaleDateString("en-GB"):""},{dataKey:"wastage_quantity",exportHeader:"Wastage Qty",dataType:"number",formatter:r=>r?Number(r).toFixed(2):"0.00"},{dataKey:"status",exportHeader:"Status"}],importValidation:[he.field("task_id").required().string(1,50).build(),he.field("raw_product_name").required().string(1,100).build(),he.field("process_name").required().string(1,100).build(),he.field("assigned_quantity").required().number(.01).build(),he.field("date").date().build(),he.field("staff_name").string(0,100).build()],tableColumns:[{key:"task_id",label:"Task ID",sortable:!0,dataType:"string"},{key:"date",label:"Date",sortable:!0,dataType:"date"},{key:"raw_product_name",label:"Raw Product",sortable:!0,dataType:"string"},{key:"process_name",label:"Process",sortable:!0,dataType:"string"},{key:"assignedQuantity",label:"Quantity",sortable:!0,dataType:"number",align:"right"},{key:"assignedTo",label:"Assigned To",sortable:!0,dataType:"string"},{key:"status",label:"Status",sortable:!0,dataType:"string"},{key:"dueDate",label:"Due Date",sortable:!0,dataType:"date"},{key:"createdAt",label:"Created",sortable:!0,dataType:"date"}]},Ao={pageName:"post-production-tasks",exportEnabled:!0,importEnabled:!0,sortableColumns:["task_id","date","date_completed","source_quantity","sku","product_name","process_name","staff_name","assigned_quantity","units","wastage_quantity","status"],exportColumns:[{dataKey:"task_id",exportHeader:"Task ID",required:!0},{dataKey:"date",exportHeader:"Date Assigned",dataType:"date",formatter:r=>new Date(r).toLocaleDateString("en-GB")},{dataKey:"date_completed",exportHeader:"Date Completed",dataType:"date",formatter:r=>r?new Date(r).toLocaleDateString("en-GB"):""},{dataKey:"source_quantity",exportHeader:"Source Qty",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"sku",exportHeader:"SKU",required:!0},{dataKey:"product_name",exportHeader:"Product",required:!0},{dataKey:"process_name",exportHeader:"Process",required:!0},{dataKey:"staff_name",exportHeader:"Staff Name"},{dataKey:"assigned_quantity",exportHeader:"Assigned Units",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"units",exportHeader:"Completed Units",dataType:"number",formatter:r=>r?Number(r).toFixed(2):"0.00"},{dataKey:"wastage_quantity",exportHeader:"Wastage Qty",dataType:"number",formatter:r=>r?Number(r).toFixed(2):"0.00"},{dataKey:"remarks",exportHeader:"Remarks"},{dataKey:"status",exportHeader:"Status"}],importValidation:[he.field("task_id").required().string(1,50).build(),he.field("product_name").required().string(1,100).build(),he.field("sku").required().string(1,50).build(),he.field("process_name").required().string(1,100).build(),he.field("source_quantity").required().number(.01).build(),he.field("assigned_quantity").required().number(.01).build(),he.field("date").date().build(),he.field("staff_name").string(0,100).build()],tableColumns:[{key:"task_id",label:"Task ID",sortable:!0,dataType:"string"},{key:"date",label:"Date Assigned",sortable:!0,dataType:"date"},{key:"date_completed",label:"Date Completed",sortable:!0,dataType:"date"},{key:"source_quantity",label:"Source Qty",sortable:!0,dataType:"number",align:"right"},{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"product_name",label:"Product",sortable:!0,dataType:"string"},{key:"process_name",label:"Process",sortable:!0,dataType:"string"},{key:"staff_name",label:"Staff Name",sortable:!0,dataType:"string"},{key:"assigned_quantity",label:"Assigned Units",sortable:!0,dataType:"number",align:"right"},{key:"units",label:"Completed Units",sortable:!0,dataType:"number",align:"right"},{key:"wastage_quantity",label:"Wastage Qty",sortable:!0,dataType:"number",align:"right"},{key:"status",label:"Status",sortable:!0,dataType:"string"}]},qo={pageName:"stock-status",exportEnabled:!0,importEnabled:!1,sortableColumns:["stockName","openingBalance","purchases","sales","closingBalance"],exportColumns:[{dataKey:"stockName",exportHeader:"Stock Name"},{dataKey:"openingBalance",exportHeader:"Opening Balance",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"purchases",exportHeader:"Purchases",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"sales",exportHeader:"Sales",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"closingBalance",exportHeader:"Closing Balance",dataType:"number",formatter:r=>Number(r).toFixed(2)}],importValidation:[],tableColumns:[{key:"stockName",label:"Stock Name",sortable:!0,dataType:"string"},{key:"openingBalance",label:"Opening Balance",sortable:!0,dataType:"number",align:"right"},{key:"purchases",label:"Purchases",sortable:!0,dataType:"number",align:"right"},{key:"sales",label:"Sales",sortable:!0,dataType:"number",align:"right"},{key:"closingBalance",label:"Closing Balance",sortable:!0,dataType:"number",align:"right"}]},Fo={pageName:"inventory-status",exportEnabled:!0,importEnabled:!1,sortableColumns:["stockName","openingBalance","salesUnits","soldUnits","closingBalance"],exportColumns:[{dataKey:"stockName",exportHeader:"Stock Name"},{dataKey:"openingBalance",exportHeader:"Opening Balance",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"salesUnits",exportHeader:"Sales Units",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"soldUnits",exportHeader:"Sold Units",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"closingBalance",exportHeader:"Closing Balance",dataType:"number",formatter:r=>Number(r).toFixed(2)}],importValidation:[],tableColumns:[{key:"stockName",label:"Stock Name",sortable:!0,dataType:"string"},{key:"openingBalance",label:"Opening Balance",sortable:!0,dataType:"number",align:"right"},{key:"salesUnits",label:"Sales Units",sortable:!0,dataType:"number",align:"right"},{key:"soldUnits",label:"Sold Units",sortable:!0,dataType:"number",align:"right"},{key:"closingBalance",label:"Closing Balance",sortable:!0,dataType:"number",align:"right"}]},bn={stocks:bo,products:No,"raw-products":wo,staff:So,vendors:_o,processes:ko,"sales-channels":Co,"sales-units":Po,"sales-record":Do,purchases:To,"pre-production-tasks":Eo,"production-tasks":Ro,"post-production-tasks":Ao,"stock-status":qo,"inventory-status":Fo},$o=r=>bn[r],Io={defaultExportFormat:"xlsx",maxImportFileSize:50,defaultBatchSize:100,enableProgressTracking:!0,autoRefreshInterval:300,cacheTimeout:30,enableValidationWarnings:!0,defaultSortDirection:"asc",enableMultiSort:!1,maxExportRows:1e5,enableBackgroundExport:!0},Nn=u.createContext(void 0),Lo=({children:r,initialSettings:t={}})=>{const[s,a]=u.useState({}),[n,i]=u.useState({...Io,...t}),[c,p]=u.useState(!1),[m,o]=u.useState(null);u.useEffect(()=>{try{const U=localStorage.getItem("dataManagementSettings");if(U){const Z=JSON.parse(U);i(O=>({...O,...Z}))}}catch(U){console.warn("Failed to load saved settings:",U)}},[]),u.useEffect(()=>{try{localStorage.setItem("dataManagementSettings",JSON.stringify(n))}catch(U){console.warn("Failed to save settings:",U)}},[n]),u.useEffect(()=>{if(n.autoRefreshInterval>0){const U=setInterval(()=>{g()},n.autoRefreshInterval*1e3);return()=>clearInterval(U)}},[n.autoRefreshInterval]);const g=()=>{const U=Date.now(),Z=n.cacheTimeout*60*1e3;a(O=>{const Q={...O};return Object.keys(Q).forEach(R=>{U-Q[R].timestamp>Z&&delete Q[R]}),Q})},b=u.useCallback(U=>{try{const Z=s[U],O=Date.now(),Q=n.cacheTimeout*60*1e3;if(Z&&O-Z.timestamp<Q)return Z.config;const R=$o(U);return R&&setTimeout(()=>{a(k=>({...k,[U]:{config:R,timestamp:O}}))},0),R}catch(Z){o(`Failed to get configuration for ${U}: ${Z instanceof Error?Z.message:"Unknown error"}`);return}},[s,n.cacheTimeout]),x=(U,Z)=>{try{const O=b(U);if(!O)throw new Error(`Configuration not found for page: ${U}`);const Q={...O,...Z};a(R=>({...R,[U]:{config:Q,timestamp:Date.now()}})),bn[U]=Q,o(null)}catch(O){o(`Failed to update configuration for ${U}: ${O instanceof Error?O.message:"Unknown error"}`)}},j=U=>{try{a(Z=>{const O={...Z};return delete O[U],O}),o(null)}catch(Z){o(`Failed to reset configuration for ${U}: ${Z instanceof Error?Z.message:"Unknown error"}`)}},f=U=>b(U)?.exportEnabled||!1,P=U=>b(U)?.importEnabled||!1,N=U=>b(U)?.exportColumns||[],T=U=>b(U)?.tableColumns||[],A=U=>b(U)?.importValidation||[],E=U=>{i(Z=>({...Z,...U})),o(null)},D=()=>{a({}),o(null)},V={getConfig:b,updateConfig:x,resetConfig:j,canExport:f,canImport:P,getExportColumns:N,getTableColumns:T,getValidationRules:A,globalSettings:n,updateGlobalSettings:E,clearCache:D,refreshConfig:U=>{U?a(Z=>{const O={...Z};return delete O[U],O}):D(),o(null)},isLoading:c,error:m};return e.jsx(Nn.Provider,{value:V,children:r})},Wa=()=>{const r=u.useContext(Nn);if(r===void 0)throw new Error("useDataManagement must be used within a DataManagementProvider");return r},Et=r=>{const{getConfig:t,updateConfig:s,resetConfig:a,canExport:n,canImport:i}=Wa(),c=t(r);return{config:c,canExport:n(r),canImport:i(r),updateConfig:p=>s(r,p),resetConfig:()=>a(r),isConfigured:!!c}},Rt=r=>{const{getValidationRules:t,canImport:s,globalSettings:a}=Wa();return{validationRules:t(r),canImport:s(r),maxFileSize:a.maxImportFileSize,batchSize:a.defaultBatchSize,enableWarnings:a.enableValidationWarnings}},Mo=r=>{const{getTableColumns:t,globalSettings:s}=Wa();return{columns:t(r),defaultSortDirection:s.defaultSortDirection,enableMultiSort:s.enableMultiSort}},Ma=gs("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),$=u.forwardRef(({className:r,variant:t,size:s,asChild:a=!1,...n},i)=>{const c=a?Fs:"button";return e.jsx(c,{className:me(Ma({variant:t,size:s,className:r})),ref:i,...n})});$.displayName="Button";const Oo=gs("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),Qe=u.forwardRef(({className:r,variant:t,...s},a)=>e.jsx("div",{ref:a,role:"alert",className:me(Oo({variant:t}),r),...s}));Qe.displayName="Alert";const Uo=u.forwardRef(({className:r,...t},s)=>e.jsx("h5",{ref:s,className:me("mb-1 font-medium leading-none tracking-tight",r),...t}));Uo.displayName="AlertTitle";const Ye=u.forwardRef(({className:r,...t},s)=>e.jsx("div",{ref:s,className:me("text-sm [&_p]:leading-relaxed",r),...t}));Ye.displayName="AlertDescription";class Ko{isDevelopment=!1;isVerbose=!1;log(...t){this.isDevelopment&&console.log(...t)}verbose(...t){this.isDevelopment&&this.isVerbose&&console.log(...t)}warn(...t){this.isDevelopment&&console.warn(...t)}error(...t){console.error(...t),this.isDevelopment}logWithContext(t,s,a){if(this.isDevelopment){const n=this.formatContext(s);console.log(`${n} ${t}`,a||"")}}performance(t,s){if(this.isDevelopment){console.time(t);const a=s();return console.timeEnd(t),a}return s()}async performanceAsync(t,s){if(this.isDevelopment){console.time(t);const a=await s();return console.timeEnd(t),a}return s()}group(t,s){this.isDevelopment&&(console.group(t),s(),console.groupEnd())}table(t){this.isDevelopment&&console.table(t)}json(t,s){this.isDevelopment&&console.log(`${t}:`,JSON.stringify(s,null,2))}assert(t,s){this.isDevelopment&&!t&&console.error(`Assertion failed: ${s}`)}formatContext(t){const s=[];return t.component&&s.push(`[${t.component}]`),t.hook&&s.push(`[${t.hook}]`),t.service&&s.push(`[${t.service}]`),s.join(" ")}}const kt=new Ko;kt.performance.bind(kt);kt.performanceAsync.bind(kt);kt.group.bind(kt);kt.table.bind(kt);kt.json.bind(kt);function Vo(){const[r,t]=u.useState(null),[s,a]=u.useState(!1),[n,i]=u.useState(!1),[c,p]=u.useState(navigator.onLine),[m,o]=u.useState(!1);return u.useEffect(()=>{window.matchMedia("(display-mode: standalone)").matches&&i(!0);const x=N=>{N.preventDefault(),t(N),a(!0)},j=()=>{i(!0),a(!1),t(null)},f=()=>p(!0),P=()=>p(!1);return window.addEventListener("beforeinstallprompt",x),window.addEventListener("appinstalled",j),window.addEventListener("online",f),window.addEventListener("offline",P),"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").then(N=>{kt.log("Service Worker registered:",N),N.addEventListener("updatefound",()=>{const T=N.installing;T&&T.addEventListener("statechange",()=>{T.state==="installed"&&navigator.serviceWorker.controller&&o(!0)})})}).catch(N=>{console.error("Service Worker registration failed:",N)}),()=>{window.removeEventListener("beforeinstallprompt",x),window.removeEventListener("appinstalled",j),window.removeEventListener("online",f),window.removeEventListener("offline",P)}},[]),{isInstallable:s,isInstalled:n,isOnline:c,updateAvailable:m,installApp:async()=>{if(!r)return!1;try{await r.prompt();const{outcome:x}=await r.userChoice;return x==="accepted"?(t(null),a(!1),!0):!1}catch(x){return console.error("Error installing app:",x),!1}},updateApp:()=>{"serviceWorker"in navigator&&navigator.serviceWorker.getRegistration().then(x=>{x&&x.waiting&&(x.waiting.postMessage({type:"SKIP_WAITING"}),window.location.reload())})}}}function Bo(){const{isInstallable:r,isInstalled:t,isOnline:s,updateAvailable:a,installApp:n,updateApp:i}=Vo(),{toast:c}=Fe(),[p,m]=u.useState(!1),[o,g]=u.useState(!1);u.useEffect(()=>{if(r&&!t&&!localStorage.getItem("pwa-install-dismissed")){const P=setTimeout(()=>{m(!0)},3e4);return()=>clearTimeout(P)}},[r,t]),u.useEffect(()=>{a&&g(!0)},[a]);const b=async()=>{await n()&&(m(!1),c({title:"App installed!",description:"Molaga ERP has been added to your home screen"}))},x=()=>{m(!1),localStorage.setItem("pwa-install-dismissed","true")},j=()=>{i(),g(!1)};return s?o?e.jsx("div",{className:"fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-96 z-50",children:e.jsxs(Qe,{className:"bg-blue-50 border-blue-200",children:[e.jsx(Ka,{className:"h-4 w-4 text-blue-600"}),e.jsx(Ye,{className:"text-blue-800",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"New version available!"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx($,{size:"sm",variant:"outline",onClick:()=>g(!1),className:"h-7",children:"Later"}),e.jsx($,{size:"sm",onClick:j,className:"h-7 bg-blue-600 hover:bg-blue-700",children:"Update"})]})]})})]})}):p&&!t?e.jsx("div",{className:"fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-96 z-50",children:e.jsxs(Qe,{className:"bg-primary/5 border-primary/20",children:[e.jsx(xs,{className:"h-4 w-4 text-primary"}),e.jsxs(Ye,{children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-foreground mb-1",children:"Install Molaga ERP"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Add to your home screen for quick access and offline use"})]}),e.jsx($,{size:"sm",variant:"ghost",onClick:x,className:"h-6 w-6 p-0",children:e.jsx(Ts,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx($,{size:"sm",variant:"outline",onClick:x,className:"flex-1",children:"Not now"}),e.jsx($,{size:"sm",onClick:b,className:"flex-1 bg-primary hover:bg-primary/90",children:"Install"})]})]})]})}):null:e.jsx("div",{className:"fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-96 z-50",children:e.jsxs(Qe,{className:"bg-orange-50 border-orange-200",children:[e.jsx(ti,{className:"h-4 w-4 text-orange-600"}),e.jsx(Ye,{className:"text-orange-800",children:"You're offline. Some features may be limited."})]})})}const Aa=768;function Ho(){const[r,t]=u.useState(void 0);return u.useEffect(()=>{const s=window.matchMedia(`(max-width: ${Aa-1}px)`),a=()=>{t(window.innerWidth<Aa)};return s.addEventListener("change",a),t(window.innerWidth<Aa),()=>s.removeEventListener("change",a)},[]),!!r}const G=u.forwardRef(({className:r,type:t,...s},a)=>e.jsx("input",{type:t,className:me("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:a,...s}));G.displayName="Input";const Pa=u.forwardRef(({className:r,orientation:t="horizontal",decorative:s=!0,...a},n)=>e.jsx(_r,{ref:n,decorative:s,orientation:t,className:me("shrink-0 bg-border",t==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",r),...a}));Pa.displayName=_r.displayName;const zo=Pr,Qo=kr,wn=u.forwardRef(({className:r,...t},s)=>e.jsx(ba,{className:me("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r),...t,ref:s}));wn.displayName=ba.displayName;const Yo=gs("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),Sn=u.forwardRef(({side:r="right",className:t,children:s,...a},n)=>e.jsxs(Qo,{children:[e.jsx(wn,{}),e.jsxs(Na,{ref:n,className:me(Yo({side:r}),t),...a,children:[s,e.jsxs(Cr,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-secondary hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[e.jsx(Ts,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Sn.displayName=Na.displayName;const Wo=u.forwardRef(({className:r,...t},s)=>e.jsx(wa,{ref:s,className:me("text-lg font-semibold text-foreground",r),...t}));Wo.displayName=wa.displayName;const Go=u.forwardRef(({className:r,...t},s)=>e.jsx(Sa,{ref:s,className:me("text-sm text-muted-foreground",r),...t}));Go.displayName=Sa.displayName;function lr({className:r,...t}){return e.jsx("div",{className:me("animate-pulse rounded-md bg-muted",r),...t})}const Jo="sidebar:state",Xo=3600*24*7,Zo="16rem",el="18rem",tl="3rem",sl="b",_n=u.createContext(null);function Gs(){const r=u.useContext(_n);if(!r)throw new Error("useSidebar must be used within a SidebarProvider.");return r}const kn=u.forwardRef(({defaultOpen:r=!0,open:t,onOpenChange:s,className:a,style:n,children:i,...c},p)=>{const m=Ho(),[o,g]=u.useState(!1),[b,x]=u.useState(r),j=t??b,f=u.useCallback(A=>{const E=typeof A=="function"?A(j):A;s?s(E):x(E),document.cookie=`${Jo}=${E}; path=/; max-age=${Xo}`},[s,j]),P=u.useCallback(()=>m?g(A=>!A):f(A=>!A),[m,f,g]);u.useEffect(()=>{const A=E=>{E.key===sl&&(E.metaKey||E.ctrlKey)&&(E.preventDefault(),P())};return window.addEventListener("keydown",A),()=>window.removeEventListener("keydown",A)},[P]);const N=j?"expanded":"collapsed",T=u.useMemo(()=>({state:N,open:j,setOpen:f,isMobile:m,openMobile:o,setOpenMobile:g,toggleSidebar:P}),[N,j,f,m,o,g,P]);return e.jsx(_n.Provider,{value:T,children:e.jsx(jn,{delayDuration:0,children:e.jsx("div",{style:{"--sidebar-width":Zo,"--sidebar-width-icon":tl,...n},className:me("group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar",a),ref:p,...c,children:i})})})});kn.displayName="SidebarProvider";const Cn=u.forwardRef(({side:r="left",variant:t="sidebar",collapsible:s="offcanvas",className:a,children:n,...i},c)=>{const{isMobile:p,state:m,openMobile:o,setOpenMobile:g}=Gs();return s==="none"?e.jsx("div",{className:me("flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground",a),ref:c,...i,children:n}):p?e.jsx(zo,{open:o,onOpenChange:g,...i,children:e.jsx(Sn,{"data-sidebar":"sidebar","data-mobile":"true",className:"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden",style:{"--sidebar-width":el},side:r,children:e.jsx("div",{className:"flex h-full w-full flex-col",children:n})})}):e.jsxs("div",{ref:c,className:"group peer hidden text-sidebar-foreground md:block","data-state":m,"data-collapsible":m==="collapsed"?s:"","data-variant":t,"data-side":r,children:[e.jsx("div",{className:me("relative h-svh w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear","group-data-[collapsible=offcanvas]:w-0","group-data-[side=right]:rotate-180",t==="floating"||t==="inset"?"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon]")}),e.jsx("div",{className:me("fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex",r==="left"?"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]":"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]",t==="floating"||t==="inset"?"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l",a),...i,children:e.jsx("div",{"data-sidebar":"sidebar",className:"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow",children:n})})]})});Cn.displayName="Sidebar";const Pn=u.forwardRef(({className:r,onClick:t,...s},a)=>{const{toggleSidebar:n}=Gs();return e.jsxs($,{ref:a,"data-sidebar":"trigger",variant:"ghost",size:"icon",className:me("h-7 w-7",r),onClick:i=>{t?.(i),n()},...s,children:[e.jsx(si,{}),e.jsx("span",{className:"sr-only",children:"Toggle Sidebar"})]})});Pn.displayName="SidebarTrigger";const al=u.forwardRef(({className:r,...t},s)=>{const{toggleSidebar:a}=Gs();return e.jsx("button",{ref:s,"data-sidebar":"rail","aria-label":"Toggle Sidebar",tabIndex:-1,onClick:a,title:"Toggle Sidebar",className:me("absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] group-data-[side=left]:-right-4 group-data-[side=right]:left-0 hover:after:bg-sidebar-border sm:flex","[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize","[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize","group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar","[[data-side=left][data-collapsible=offcanvas]_&]:-right-2","[[data-side=right][data-collapsible=offcanvas]_&]:-left-2",r),...t})});al.displayName="SidebarRail";const rl=u.forwardRef(({className:r,...t},s)=>e.jsx("main",{ref:s,className:me("relative flex min-h-svh flex-1 flex-col bg-background","peer-data-[variant=inset]:min-h-[calc(100svh-theme(spacing.4))] md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow",r),...t}));rl.displayName="SidebarInset";const nl=u.forwardRef(({className:r,...t},s)=>e.jsx(G,{ref:s,"data-sidebar":"input",className:me("h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring",r),...t}));nl.displayName="SidebarInput";const il=u.forwardRef(({className:r,...t},s)=>e.jsx("div",{ref:s,"data-sidebar":"header",className:me("flex flex-col gap-2 p-2",r),...t}));il.displayName="SidebarHeader";const ol=u.forwardRef(({className:r,...t},s)=>e.jsx("div",{ref:s,"data-sidebar":"footer",className:me("flex flex-col gap-2 p-2",r),...t}));ol.displayName="SidebarFooter";const ll=u.forwardRef(({className:r,...t},s)=>e.jsx(Pa,{ref:s,"data-sidebar":"separator",className:me("mx-2 w-auto bg-sidebar-border",r),...t}));ll.displayName="SidebarSeparator";const Dn=u.forwardRef(({className:r,...t},s)=>e.jsx("div",{ref:s,"data-sidebar":"content",className:me("flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden",r),...t}));Dn.displayName="SidebarContent";const ua=u.forwardRef(({className:r,...t},s)=>e.jsx("div",{ref:s,"data-sidebar":"group",className:me("relative flex w-full min-w-0 flex-col p-2",r),...t}));ua.displayName="SidebarGroup";const Oa=u.forwardRef(({className:r,asChild:t=!1,...s},a)=>{const n=t?Fs:"div";return e.jsx(n,{ref:a,"data-sidebar":"group-label",className:me("flex h-8 shrink-0 items-center rounded-md px-2 text-sm font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opa] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0",r),...s})});Oa.displayName="SidebarGroupLabel";const cl=u.forwardRef(({className:r,asChild:t=!1,...s},a)=>{const n=t?Fs:"button";return e.jsx(n,{ref:a,"data-sidebar":"group-action",className:me("absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","group-data-[collapsible=icon]:hidden",r),...s})});cl.displayName="SidebarGroupAction";const ma=u.forwardRef(({className:r,...t},s)=>e.jsx("div",{ref:s,"data-sidebar":"group-content",className:me("w-full text-sm",r),...t}));ma.displayName="SidebarGroupContent";const ha=u.forwardRef(({className:r,...t},s)=>e.jsx("ul",{ref:s,"data-sidebar":"menu",className:me("flex w-full min-w-0 flex-col gap-1",r),...t}));ha.displayName="SidebarMenu";const pa=u.forwardRef(({className:r,...t},s)=>e.jsx("li",{ref:s,"data-sidebar":"menu-item",className:me("group/menu-item relative",r),...t}));pa.displayName="SidebarMenuItem";const dl=gs("peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-base outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",{variants:{variant:{default:"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",outline:"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]"},size:{default:"h-8 text-base",sm:"h-7 text-sm",lg:"h-12 text-base group-data-[collapsible=icon]:!p-0"}},defaultVariants:{variant:"default",size:"default"}}),xa=u.forwardRef(({asChild:r=!1,isActive:t=!1,variant:s="default",size:a="default",tooltip:n,className:i,...c},p)=>{const m=r?Fs:"button",{isMobile:o,state:g}=Gs(),b=e.jsx(m,{ref:p,"data-sidebar":"menu-button","data-size":a,"data-active":t,className:me(dl({variant:s,size:a}),i),...c});return n?(typeof n=="string"&&(n={children:n}),e.jsxs(po,{children:[e.jsx(xo,{asChild:!0,children:b}),e.jsx(yn,{side:"right",align:"center",hidden:g!=="collapsed"||o,...n})]})):b});xa.displayName="SidebarMenuButton";const ul=u.forwardRef(({className:r,asChild:t=!1,showOnHover:s=!1,...a},n)=>{const i=t?Fs:"button";return e.jsx(i,{ref:n,"data-sidebar":"menu-action",className:me("absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform peer-hover/menu-button:text-sidebar-accent-foreground hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",s&&"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0",r),...a})});ul.displayName="SidebarMenuAction";const ml=u.forwardRef(({className:r,...t},s)=>e.jsx("div",{ref:s,"data-sidebar":"menu-badge",className:me("pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground","peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",r),...t}));ml.displayName="SidebarMenuBadge";const hl=u.forwardRef(({className:r,showIcon:t=!1,...s},a)=>{const n=u.useMemo(()=>`${Math.floor(Math.random()*40)+50}%`,[]);return e.jsxs("div",{ref:a,"data-sidebar":"menu-skeleton",className:me("flex h-8 items-center gap-2 rounded-md px-2",r),...s,children:[t&&e.jsx(lr,{className:"size-4 rounded-md","data-sidebar":"menu-skeleton-icon"}),e.jsx(lr,{className:"h-4 max-w-[--skeleton-width] flex-1","data-sidebar":"menu-skeleton-text",style:{"--skeleton-width":n}})]})});hl.displayName="SidebarMenuSkeleton";const pl=u.forwardRef(({className:r,...t},s)=>e.jsx("ul",{ref:s,"data-sidebar":"menu-sub",className:me("mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5","group-data-[collapsible=icon]:hidden",r),...t}));pl.displayName="SidebarMenuSub";const xl=u.forwardRef(({...r},t)=>e.jsx("li",{ref:t,...r}));xl.displayName="SidebarMenuSubItem";const gl=u.forwardRef(({asChild:r=!1,size:t="md",isActive:s,className:a,...n},i)=>{const c=r?Fs:"a";return e.jsx(c,{ref:i,"data-sidebar":"menu-sub-button","data-size":t,"data-active":s,className:me("flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring aria-disabled:pointer-events-none aria-disabled:opacity-50 hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground","data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground",t==="sm"&&"text-xs",t==="md"&&"text-sm","group-data-[collapsible=icon]:hidden",a),...n})});gl.displayName="SidebarMenuSubButton";const fl=[{title:"Dashboard",url:"/",icon:ai},{title:"Purchases",url:"/purchases",icon:Va},{title:"Tasks",url:"/tasks",icon:Ba},{title:"Status",url:"/status",icon:Ys},{title:"Sales",url:"/sales",icon:Dr}],jl=[{title:"Master Data",url:"/master",icon:Fa},{title:"Analytics",url:"/analytics",icon:Fa}],yl=[{title:"Settings",url:"/settings",icon:Tr}];function vl(){const{state:r}=Gs(),s=cs().pathname,a=r==="collapsed",[n,i]=u.useState(!1);u.useEffect(()=>{const o=()=>{const b=document.documentElement.classList.contains("dark");i(b)};o();const g=new MutationObserver(o);return g.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]}),()=>g.disconnect()},[]);const c=n?"/molaga-logo_dark.png":"/molaga-logo.png",p=o=>s===o||o!=="/"&&s.startsWith(o),m=({isActive:o})=>o?"bg-primary/10 text-primary font-medium border-r-2 border-primary":"hover:bg-muted/50 transition-colors";return e.jsx(Cn,{className:a?"w-14":"w-64",collapsible:"icon",children:e.jsxs(Dn,{className:"bg-sidebar",children:[e.jsx("div",{className:"h-16 border-b border-sidebar-border flex items-center justify-center px-4",children:a?e.jsxs("div",{className:"w-10 h-10 flex items-center justify-center",children:[e.jsx("img",{src:c,alt:"Molaga",className:"w-8 h-8 object-contain transition-opacity duration-200",onError:o=>{const g=o.target;g.style.display="none",g.nextElementSibling?.classList.remove("hidden")}}),e.jsx("div",{className:"w-8 h-8 rounded bg-gradient-to-br from-red-500 to-red-600 flex items-center justify-center text-white font-bold text-sm hidden",children:"M"})]}):e.jsxs("div",{className:"flex items-center justify-center w-full",children:[e.jsx("img",{src:c,alt:"Molaga ERP",className:"h-12 object-contain max-w-full transition-opacity duration-200",onError:o=>{const g=o.target;g.style.display="none",g.nextElementSibling?.classList.remove("hidden")}}),e.jsxs("div",{className:"hidden text-center",children:[e.jsx("h2",{className:"font-bold text-sidebar-foreground text-xl",children:"MOLAGA"}),e.jsx("p",{className:"text-sm text-sidebar-foreground/70",children:"Spice Manufacturing ERP"})]})]})}),e.jsxs(ua,{children:[e.jsx(Oa,{children:"Main Modules"}),e.jsx(ma,{children:e.jsx(ha,{children:fl.map(o=>e.jsx(pa,{children:e.jsx(xa,{asChild:!0,isActive:p(o.url),children:e.jsxs(Ta,{to:o.url,end:o.url==="/",className:m,children:[e.jsx(o.icon,{className:"h-4 w-4"}),!a&&e.jsx("span",{children:o.title})]})})},o.title))})})]}),e.jsxs(ua,{children:[e.jsx(Oa,{children:"Management"}),e.jsx(ma,{children:e.jsx(ha,{children:jl.map(o=>e.jsx(pa,{children:e.jsx(xa,{asChild:!0,children:e.jsxs(Ta,{to:o.url,className:m,children:[e.jsx(o.icon,{className:"h-4 w-4"}),!a&&e.jsx("span",{children:o.title})]})})},o.title))})})]}),e.jsx("div",{className:"mt-auto",children:e.jsx(ua,{children:e.jsx(ma,{children:e.jsx(ha,{children:yl.map(o=>e.jsx(pa,{children:e.jsx(xa,{asChild:!0,children:e.jsxs(Ta,{to:o.url,className:m,children:[e.jsx(o.icon,{className:"h-4 w-4"}),!a&&e.jsx("span",{children:o.title})]})})},o.title))})})})})]})})}const cr="molaga_settings",Pt={company:{companyName:"Molaga Spices Pvt Ltd",legalName:"Molaga Spices Private Limited",registrationNumber:"",taxId:"",industryType:"Manufacturing",address:"",city:"",state:"",postalCode:"",country:"India",phone:"",email:"",website:"",fiscalYearStart:"04",currency:"INR",timezone:"Asia/Kolkata"},system:{language:"en",dateFormat:"DD/MM/YYYY",timeFormat:"24",firstDayOfWeek:"monday",decimalPlaces:"2",thousandSeparator:",",decimalSeparator:".",recordsPerPage:"50",theme:"light",sidebarCollapsed:!1,showTooltips:!0,enableAnimations:!0},security:{minPasswordLength:"8",requireUppercase:!0,requireLowercase:!0,requireNumbers:!0,requireSpecialChars:!0,passwordExpiry:"90",sessionTimeout:"30",maxSessions:"3",enable2FA:!1,loginAttempts:"5",lockoutDuration:"30"},notifications:{smtp:{host:"smtp.gmail.com",port:"587",username:"",password:"",fromEmail:"",fromName:"Molaga ERP",useTLS:!0},notifications:{lowStockAlerts:!0,taskCompletion:!0,backupStatus:!0,userLogin:!1,dataImportExport:!0}},backup:{autoBackup:!0,frequency:"daily",time:"00:00",retention:"30"}};class bl{settings;constructor(){this.settings=this.loadSettings()}loadSettings(){try{const t=localStorage.getItem(cr);if(t){const s=JSON.parse(t);return{company:{...Pt.company,...s.company},system:{...Pt.system,...s.system},security:{...Pt.security,...s.security},notifications:{smtp:{...Pt.notifications.smtp,...s.notifications?.smtp},notifications:{...Pt.notifications.notifications,...s.notifications?.notifications}},backup:{...Pt.backup,...s.backup}}}}catch(t){console.error("Error loading settings:",t)}return Pt}saveSettings(){try{localStorage.setItem(cr,JSON.stringify(this.settings))}catch(t){console.error("Error saving settings:",t)}}getAll(){return{...this.settings}}getCompany(){return{...this.settings.company}}updateCompany(t){return this.settings.company={...this.settings.company,...t},this.saveSettings(),this.getCompany()}getSystem(){return{...this.settings.system}}updateSystem(t){return this.settings.system={...this.settings.system,...t},this.saveSettings(),this.getSystem()}getSecurity(){return{...this.settings.security}}updateSecurity(t){return this.settings.security={...this.settings.security,...t},this.saveSettings(),this.getSecurity()}getNotifications(){return{...this.settings.notifications}}updateNotifications(t){return this.settings.notifications={smtp:{...this.settings.notifications.smtp,...t.smtp},notifications:{...this.settings.notifications.notifications,...t.notifications}},this.saveSettings(),this.getNotifications()}getBackup(){return{...this.settings.backup}}updateBackup(t){return this.settings.backup={...this.settings.backup,...t},this.saveSettings(),this.getBackup()}resetToDefaults(){return this.settings={...Pt},this.saveSettings(),this.getAll()}exportSettings(){return JSON.stringify(this.settings,null,2)}importSettings(t){try{const s=JSON.parse(t);return this.settings={company:{...Pt.company,...s.company},system:{...Pt.system,...s.system},security:{...Pt.security,...s.security},notifications:{smtp:{...Pt.notifications.smtp,...s.notifications?.smtp},notifications:{...Pt.notifications.notifications,...s.notifications?.notifications}},backup:{...Pt.backup,...s.backup}},this.saveSettings(),!0}catch(s){return console.error("Error importing settings:",s),!1}}}const ja=new bl;function Tn(){const[r,t]=u.useState(ja.getCompany()),s=u.useCallback(a=>{const n=ja.updateCompany(a);return t(n),n},[]);return{settings:r,updateSettings:s}}function En(){const[r,t]=u.useState(ja.getSystem()),s=u.useCallback(a=>{const n=ja.updateSystem(a);return t(n),n},[]);return{settings:r,updateSettings:s}}const ya=ii,va=oi,Nl=u.forwardRef(({className:r,inset:t,children:s,...a},n)=>e.jsxs(Er,{ref:n,className:me("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[state=open]:bg-accent focus:bg-accent",t&&"pl-8",r),...a,children:[s,e.jsx(Rr,{className:"ml-auto h-4 w-4"})]}));Nl.displayName=Er.displayName;const wl=u.forwardRef(({className:r,...t},s)=>e.jsx(Ar,{ref:s,className:me("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...t}));wl.displayName=Ar.displayName;const Qs=u.forwardRef(({className:r,sideOffset:t=4,...s},a)=>e.jsx(ri,{children:e.jsx(qr,{ref:a,sideOffset:t,className:me("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...s})}));Qs.displayName=qr.displayName;const Rs=u.forwardRef(({className:r,inset:t,...s},a)=>e.jsx(Fr,{ref:a,className:me("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",t&&"pl-8",r),...s}));Rs.displayName=Fr.displayName;const Sl=u.forwardRef(({className:r,children:t,checked:s,...a},n)=>e.jsxs($r,{ref:n,className:me("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",r),checked:s,...a,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Ir,{children:e.jsx(Lr,{className:"h-4 w-4"})})}),t]}));Sl.displayName=$r.displayName;const _l=u.forwardRef(({className:r,children:t,...s},a)=>e.jsxs(Mr,{ref:a,className:me("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",r),...s,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Ir,{children:e.jsx(ni,{className:"h-2 w-2 fill-current"})})}),t]}));_l.displayName=Mr.displayName;const Rn=u.forwardRef(({className:r,inset:t,...s},a)=>e.jsx(Or,{ref:a,className:me("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",r),...s}));Rn.displayName=Or.displayName;const An=u.forwardRef(({className:r,...t},s)=>e.jsx(Ur,{ref:s,className:me("-mx-1 my-1 h-px bg-muted",r),...t}));An.displayName=Ur.displayName;function Ge({children:r}){const{user:t,logout:s}=vt(),{toast:a}=Fe(),{settings:n}=Tn(),{settings:i}=En();u.useEffect(()=>{const p=window.document.documentElement;if(p.classList.remove("light","dark"),i.theme==="auto"){const m=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";p.classList.add(m)}else p.classList.add(i.theme)},[i.theme]);const c=async()=>{try{await s(),a({title:"Success",description:"Logged out successfully"})}catch{a({title:"Error",description:"Failed to logout",variant:"destructive"})}};return e.jsx(kn,{children:e.jsxs("div",{className:"min-h-screen flex w-full bg-background",children:[e.jsx(vl,{}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("header",{className:"h-16 border-b border-border bg-card/50 backdrop-blur-sm sticky top-0 z-50",children:e.jsxs("div",{className:"flex items-center justify-between px-4 sm:px-6 h-full",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[e.jsx(Pn,{className:"hover:bg-primary/10 p-2"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"font-semibold text-foreground text-sm sm:text-base",children:"Molaga ERP"})})]}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[n.companyName&&e.jsxs("div",{className:"hidden sm:flex items-center gap-2 px-3 py-1.5 rounded-md bg-primary/5 border border-primary/10",children:[e.jsx(Kr,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:n.companyName})]}),e.jsx($,{variant:"ghost",size:"icon",className:"hover:bg-primary/10 h-8 w-8 sm:h-10 sm:w-10",children:e.jsx(Vr,{className:"h-4 w-4"})}),e.jsxs(ya,{children:[e.jsx(va,{asChild:!0,children:e.jsx($,{variant:"ghost",size:"icon",className:"hover:bg-primary/10 h-8 w-8 sm:h-10 sm:w-10",children:e.jsx(li,{className:"h-4 w-4"})})}),e.jsxs(Qs,{align:"end",className:"w-56",children:[e.jsx(Rn,{children:e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("p",{className:"text-sm font-medium leading-none",children:t?.name}),e.jsx("p",{className:"text-xs leading-none text-muted-foreground",children:t?.email})]})}),e.jsx(An,{}),e.jsxs(Rs,{onClick:c,className:"text-red-600 focus:text-red-600",children:[e.jsx(ci,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Log out"})]})]})]})]})]})}),e.jsx("main",{className:"flex-1 p-4 sm:p-6 bg-gradient-to-br from-background to-muted/20",children:r})]})]})})}const Je=({children:r})=>{const{user:t,loading:s}=vt(),a=cs();return s?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Be,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading..."})]})}):t?e.jsx(e.Fragment,{children:r}):e.jsx($s,{to:"/login",state:{from:a},replace:!0})},kl=gs("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),M=u.forwardRef(({className:r,...t},s)=>e.jsx(Br,{ref:s,className:me(kl(),r),...t}));M.displayName=Br.displayName;const te=u.forwardRef(({className:r,...t},s)=>e.jsx("div",{ref:s,className:me("rounded-lg border bg-card text-card-foreground shadow-sm",r),...t}));te.displayName="Card";const pe=u.forwardRef(({className:r,...t},s)=>e.jsx("div",{ref:s,className:me("flex flex-col space-y-1.5 p-6",r),...t}));pe.displayName="CardHeader";const xe=u.forwardRef(({className:r,...t},s)=>e.jsx("h3",{ref:s,className:me("text-2xl font-semibold leading-none tracking-tight",r),...t}));xe.displayName="CardTitle";const Te=u.forwardRef(({className:r,...t},s)=>e.jsx("p",{ref:s,className:me("text-sm text-muted-foreground",r),...t}));Te.displayName="CardDescription";const se=u.forwardRef(({className:r,...t},s)=>e.jsx("div",{ref:s,className:me("p-6 pt-0",r),...t}));se.displayName="CardContent";const Ut=u.forwardRef(({className:r,...t},s)=>e.jsx("div",{ref:s,className:me("flex items-center p-6 pt-0",r),...t}));Ut.displayName="CardFooter";const Cl=()=>{const[r,t]=u.useState(""),[s,a]=u.useState(""),[n,i]=u.useState(!1),[c,p]=u.useState(!1),{login:m,loginWithGoogle:o}=vt(),g=Ya(),{toast:b}=Fe(),x=async f=>{f.preventDefault(),i(!0);try{await m(r,s),b({title:"Success",description:"Logged in successfully"}),g("/")}catch(P){b({title:"Error",description:P.message||"Failed to login",variant:"destructive"})}finally{i(!1)}},j=async()=>{p(!0);try{await o()}catch(f){b({title:"Error",description:f.message||"Failed to login with Google",variant:"destructive"}),p(!1)}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs(te,{className:"w-full max-w-md",children:[e.jsxs(pe,{className:"space-y-1",children:[e.jsx(xe,{className:"text-2xl font-bold text-center",children:"MOLAGA ERP"}),e.jsx(Te,{className:"text-center",children:"Sign in to your account to continue"})]}),e.jsxs(se,{children:[e.jsxs("form",{onSubmit:x,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"email",children:"Email"}),e.jsx(G,{id:"email",type:"email",placeholder:"Enter your email",value:r,onChange:f=>t(f.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"password",children:"Password"}),e.jsx(G,{id:"password",type:"password",placeholder:"Enter your password",value:s,onChange:f=>a(f.target.value),required:!0})]}),e.jsxs($,{type:"submit",className:"w-full",disabled:n,children:[n&&e.jsx(Be,{className:"mr-2 h-4 w-4 animate-spin"}),"Sign In"]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx(Pa,{className:"w-full"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{className:"bg-background px-2 text-muted-foreground",children:"Or continue with"})})]}),e.jsxs($,{type:"button",variant:"outline",className:"w-full mt-4",onClick:j,disabled:c,children:[c&&e.jsx(Be,{className:"mr-2 h-4 w-4 animate-spin"}),e.jsxs("svg",{className:"mr-2 h-4 w-4",viewBox:"0 0 24 24",children:[e.jsx("path",{fill:"currentColor",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),e.jsx("path",{fill:"currentColor",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),e.jsx("path",{fill:"currentColor",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),e.jsx("path",{fill:"currentColor",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Continue with Google"]})]}),e.jsxs("div",{className:"mt-4 text-center text-sm",children:["Don't have an account?"," ",e.jsx(Ft,{to:"/register",className:"text-primary hover:underline",children:"Sign up"})]})]})]})})},Pl=()=>{const[r,t]=u.useState(""),[s,a]=u.useState(""),[n,i]=u.useState(""),[c,p]=u.useState(""),[m,o]=u.useState(!1),[g,b]=u.useState(!1),{register:x,loginWithGoogle:j}=vt(),f=Ya(),{toast:P}=Fe(),N=async A=>{if(A.preventDefault(),n!==c){P({title:"Error",description:"Passwords do not match",variant:"destructive"});return}if(n.length<8){P({title:"Error",description:"Password must be at least 8 characters long",variant:"destructive"});return}o(!0);try{await x(s,n,r),P({title:"Success",description:"Account created successfully"}),f("/")}catch(E){P({title:"Error",description:E.message||"Failed to create account",variant:"destructive"})}finally{o(!1)}},T=async()=>{b(!0);try{await j()}catch(A){P({title:"Error",description:A.message||"Failed to login with Google",variant:"destructive"}),b(!1)}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs(te,{className:"w-full max-w-md",children:[e.jsxs(pe,{className:"space-y-1",children:[e.jsx(xe,{className:"text-2xl font-bold text-center",children:"MOLAGA ERP"}),e.jsx(Te,{className:"text-center",children:"Create your account to get started"})]}),e.jsxs(se,{children:[e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"name",children:"Full Name"}),e.jsx(G,{id:"name",type:"text",placeholder:"Enter your full name",value:r,onChange:A=>t(A.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"email",children:"Email"}),e.jsx(G,{id:"email",type:"email",placeholder:"Enter your email",value:s,onChange:A=>a(A.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"password",children:"Password"}),e.jsx(G,{id:"password",type:"password",placeholder:"Enter your password (min 8 characters)",value:n,onChange:A=>i(A.target.value),required:!0,minLength:8})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"confirmPassword",children:"Confirm Password"}),e.jsx(G,{id:"confirmPassword",type:"password",placeholder:"Confirm your password",value:c,onChange:A=>p(A.target.value),required:!0})]}),e.jsxs($,{type:"submit",className:"w-full",disabled:m,children:[m&&e.jsx(Be,{className:"mr-2 h-4 w-4 animate-spin"}),"Create Account"]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx(Pa,{className:"w-full"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{className:"bg-background px-2 text-muted-foreground",children:"Or continue with"})})]}),e.jsxs($,{type:"button",variant:"outline",className:"w-full mt-4",onClick:T,disabled:g,children:[g&&e.jsx(Be,{className:"mr-2 h-4 w-4 animate-spin"}),e.jsxs("svg",{className:"mr-2 h-4 w-4",viewBox:"0 0 24 24",children:[e.jsx("path",{fill:"currentColor",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),e.jsx("path",{fill:"currentColor",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),e.jsx("path",{fill:"currentColor",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),e.jsx("path",{fill:"currentColor",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Continue with Google"]})]}),e.jsxs("div",{className:"mt-4 text-center text-sm",children:["Already have an account?"," ",e.jsx(Ft,{to:"/login",className:"text-primary hover:underline",children:"Sign in"})]})]})]})})},le=gi,ce=fi,ie=u.forwardRef(({className:r,children:t,...s},a)=>e.jsxs(Hr,{ref:a,className:me("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",r),...s,children:[t,e.jsx(di,{asChild:!0,children:e.jsx(Ha,{className:"h-4 w-4 opacity-50"})})]}));ie.displayName=Hr.displayName;const qn=u.forwardRef(({className:r,...t},s)=>e.jsx(zr,{ref:s,className:me("flex cursor-default items-center justify-center py-1",r),...t,children:e.jsx(ui,{className:"h-4 w-4"})}));qn.displayName=zr.displayName;const Fn=u.forwardRef(({className:r,...t},s)=>e.jsx(Qr,{ref:s,className:me("flex cursor-default items-center justify-center py-1",r),...t,children:e.jsx(Ha,{className:"h-4 w-4"})}));Fn.displayName=Qr.displayName;const oe=u.forwardRef(({className:r,children:t,position:s="popper",...a},n)=>e.jsx(mi,{children:e.jsxs(Yr,{ref:n,className:me("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",r),position:s,...a,children:[e.jsx(qn,{}),e.jsx(hi,{className:me("p-1",s==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),e.jsx(Fn,{})]})}));oe.displayName=Yr.displayName;const Dl=u.forwardRef(({className:r,...t},s)=>e.jsx(Wr,{ref:s,className:me("py-1.5 pl-8 pr-2 text-sm font-semibold",r),...t}));Dl.displayName=Wr.displayName;const S=u.forwardRef(({className:r,children:t,...s},a)=>e.jsxs(Gr,{ref:a,className:me("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",r),...s,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(pi,{children:e.jsx(Lr,{className:"h-4 w-4"})})}),e.jsx(xi,{children:t})]}));S.displayName=Gr.displayName;const Tl=u.forwardRef(({className:r,...t},s)=>e.jsx(Jr,{ref:s,className:me("-mx-1 my-1 h-px bg-muted",r),...t}));Tl.displayName=Jr.displayName;function $n({className:r,classNames:t,showOutsideDays:s=!0,presets:a,...n}){return e.jsxs("div",{className:"flex",children:[a&&e.jsx("div",{className:"flex flex-col items-start pr-4 border-r border-gray-200",children:a.map(i=>e.jsx($,{variant:"ghost",className:"w-full justify-start mb-1",onClick:()=>{n.onSelect&&typeof n.onSelect=="function"&&n.onSelect(i.range)},children:i.name},i.name))}),e.jsx(ji,{showOutsideDays:s,className:me("p-3",r),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:me(Ma({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:me(Ma({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...t},components:{IconLeft:({...i})=>e.jsx(yi,{className:"h-4 w-4"}),IconRight:({...i})=>e.jsx(Rr,{className:"h-4 w-4"})},...n})]})}$n.displayName="Calendar";const El=bi,Rl=Ni,In=u.forwardRef(({className:r,align:t="center",sideOffset:s=4,...a},n)=>e.jsx(vi,{children:e.jsx(Xr,{ref:n,align:t,sideOffset:s,className:me("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...a})}));In.displayName=Xr.displayName;function js({value:r,onChange:t,className:s}){const[a,n]=u.useState("this-month"),[i,c]=u.useState(!1),p=[{id:"this-month",name:"This month",range:{from:Tt(new Date),to:Dt(new Date)}},{id:"previous-month",name:"Previous month",range:{from:Tt(Vs(new Date,1)),to:Dt(Vs(new Date,1))}},{id:"last-6-months",name:"Last 6 months",range:{from:Vs(new Date,6),to:new Date}},{id:"custom",name:"Custom",range:void 0}],m=g=>{n(g);const b=p.find(x=>x.id===g);b&&b.id!=="custom"?(t(b.range),c(!1)):c(!0)},o=()=>r?.from?r.to?`${Xe(r.from,"dd MMM")} - ${Xe(r.to,"dd MMM yyyy")}`:Xe(r.from,"dd MMM yyyy"):"Select date range";return u.useEffect(()=>{if(!r&&a==="this-month"&&typeof t=="function"){const g=p.find(b=>b.id==="this-month");g&&t(g.range)}},[r,t,a,p]),e.jsxs("div",{className:me("flex items-center gap-2",s),children:[e.jsxs(le,{value:a,onValueChange:m,children:[e.jsx(ie,{className:"w-[150px]",children:e.jsx(ce,{})}),e.jsx(oe,{children:p.map(g=>e.jsx(S,{value:g.id,children:g.name},g.id))})]}),e.jsxs(El,{open:i,onOpenChange:c,children:[e.jsx(Rl,{asChild:!0,children:e.jsxs($,{id:"date",variant:"outline",className:me("min-w-[200px] justify-between text-left font-normal",!r&&"text-muted-foreground"),onClick:()=>{a==="custom"&&c(!i)},children:[o(),a==="custom"&&e.jsx(Ha,{className:"h-4 w-4 opacity-50"})]})}),a==="custom"&&e.jsx(In,{className:"w-auto p-0",align:"start",children:e.jsx($n,{initialFocus:!0,mode:"range",defaultMonth:r?.from,selected:r,onSelect:g=>{t(g),g?.from&&g?.to&&c(!1)},numberOfMonths:2})})]})]})}const mt=u.forwardRef(({className:r,...t},s)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:s,className:me("w-full caption-bottom text-sm",r),...t})}));mt.displayName="Table";const ht=u.forwardRef(({className:r,...t},s)=>e.jsx("thead",{ref:s,className:me("[&_tr]:border-b",r),...t}));ht.displayName="TableHeader";const pt=u.forwardRef(({className:r,...t},s)=>e.jsx("tbody",{ref:s,className:me("[&_tr:last-child]:border-0",r),...t}));pt.displayName="TableBody";const Al=u.forwardRef(({className:r,...t},s)=>e.jsx("tfoot",{ref:s,className:me("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",r),...t}));Al.displayName="TableFooter";const ke=u.forwardRef(({className:r,...t},s)=>e.jsx("tr",{ref:s,className:me("border-b transition-colors data-[state=selected]:bg-muted hover:bg-muted/50",r),...t}));ke.displayName="TableRow";const J=u.forwardRef(({className:r,...t},s)=>e.jsx("th",{ref:s,className:me("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",r),...t}));J.displayName="TableHead";const W=u.forwardRef(({className:r,...t},s)=>e.jsx("td",{ref:s,className:me("p-4 align-middle [&:has([role=checkbox])]:pr-0",r),...t}));W.displayName="TableCell";const ql=u.forwardRef(({className:r,...t},s)=>e.jsx("caption",{ref:s,className:me("mt-4 text-sm text-muted-foreground",r),...t}));ql.displayName="TableCaption";const Ue=r=>({async getAll(t=[]){let s=[],a=0;const n=100;let i=!0;for(;i;)try{const c=await at.listDocuments(rt,r,[...t,Ve.limit(n),Ve.offset(a)]);if(s.push(...c.documents),a+=n,i=c.documents.length===n,a>1e4){kt.warn(`âš ï¸ Pagination safety limit reached for ${r}, stopping at 10000 records`);break}}catch(c){throw kt.error(`Error fetching documents from ${r}:`,c),c}return kt.log(`ðŸ“¦ Fetched ${s.length} documents from ${r}`),s},async getPaginated(t=[],s={}){const a=s.limit||100,n=s.offset||0;try{const i=await at.listDocuments(rt,r,[...t,Ve.limit(a),Ve.offset(n)]);return{documents:i.documents,total:i.total,hasMore:n+a<i.total}}catch(i){throw kt.error(`Error fetching paginated documents from ${r}:`,i),i}},async getById(t){return await at.getDocument(rt,r,t)},async create(t){return await at.createDocument(rt,r,hs.unique(),t)},async update(t,s){return await at.updateDocument(rt,r,t,s)},async delete(t){await at.deleteDocument(rt,r,t)}}),Fl={...Ue(Ce.POST_PRODUCTION_STATUS),async getWithRelations(){const r=await this.getAll(),t=Ue(Ce.PRODUCTS),s=Ue(Ce.PROCESSES),a=await t.getAll(),n=await s.getAll(),i=new Map(a.map(p=>[p.$id,p.name])),c=new Map(n.map(p=>[p.$id,p.process_name]));return r.map(p=>({...p,product_name:i.get(p.product_id)||"Unknown",process_name:c.get(p.process_id)||"Unknown"}))}},$l={...Ue(Ce.STOCK_STATUS),async getStockStatusByDateRange(r,t){const s=[];return r&&s.push(Ve.greaterThanEqual("status_date",r)),t&&s.push(Ve.lessThanEqual("status_date",t)),await this.getAll(s)}},Wt={...Ue(Ce.PRODUCTION_TASKS),async getByDateRange(r,t){const s=[];return r&&s.push(Ve.greaterThanEqual("date",r.toISOString())),t&&s.push(Ve.lessThanEqual("date",t.toISOString())),this.getAll(s)},async getProductionTasksWithRelations(r,t,s){const a=[];r&&a.push(Ve.greaterThanEqual("date",r)),t&&a.push(Ve.lessThanEqual("date",t)),s&&a.push(Ve.equal("process_id",s));const n=await this.getAll(a),i=Ue(Ce.STAFF),c=Ue(Ce.PROCESSES),p=Ue(Ce.RAW_PRODUCTS),m=Ue(Ce.STOCKS),o=await i.getAll(),g=await c.getAll(),b=await p.getAll(),x=await m.getAll(),j=await Ks.getAll(),f=new Map(o.map(A=>[A.$id,A.staff_name])),P=new Map(g.map(A=>[A.$id,A.process_name])),N=new Map(b.map(A=>[A.$id,A.raw_product])),T=new Map(x.map(A=>[A.$id,A.stock_name]));return n.map(A=>{const D=j.filter(F=>F.production_task_id===A.$id).map(F=>({...F,stock_name:T.get(F.stock_id)||"Unknown"}));return{...A,staff_name:f.get(A.staff_id)||"Unknown",process_name:P.get(A.process_id)||"Unknown",source_process_name:P.get(A.source_process_id)||"Unknown",raw_product_name:N.get(A.raw_product_id)||"Unknown",stock_items:D}})}},es={...Ue(Ce.POST_PRODUCTION_TASKS),async getPostProductionTasksWithRelations(){const r=await this.getAll(),t=Ue(Ce.STAFF),s=Ue(Ce.PROCESSES),a=Ue(Ce.PRODUCTS),n=Ue(Ce.STOCKS),i=await t.getAll(),c=await s.getAll(),p=await a.getAll(),m=await n.getAll(),o=new Map(i.map(j=>[j.$id,j.staff_name])),g=new Map(c.map(j=>[j.$id,j.process_name])),b=new Map(p.map(j=>[j.$id,j.product])),x=new Map(m.map(j=>[j.$id,j.stock_name]));return r.map(j=>({...j,staff_name:o.get(j.staff_id)||"Unknown",process_name:g.get(j.process_id)||"Unknown",source_process_name:g.get(j.source_process_id)||"Unknown",product_name:b.get(j.product_id)||"Unknown",stock_name:x.get(j.sku)||"Unknown"}))}},Yt={...Ue(Ce.STOCKS),async getCategories(){const r=await this.getAll(),t=new Set(r.map(s=>s.category));return Array.from(t)}},Cs=Ue(Ce.RAW_PRODUCTS),Us=Ue(Ce.VENDORS),Il=Ue(Ce.STAFF),ys=Ue(Ce.PROCESSES),Vt=Ue(Ce.PRODUCTS),Ps=Ue(Ce.SALES_CHANNELS),os={...Ue(Ce.PURCHASES),async getByDateRange(r,t){const s=[];if(r){const a=new Date(r),n=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`;s.push(Ve.greaterThanEqual("date",n))}if(t){const a=new Date(t),n=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`;s.push(Ve.lessThanEqual("date",n))}return this.getAll(s)}},zt=Ue(Ce.SALES_UNITS),Zt=Ue(Ce.SALES_RECORDS),Ks={...Ue(Ce.PRODUCTION_TASK_ITEMS),async deleteByProductionTaskId(r){const t=await this.getAll([Ve.equal("production_task_id",r)]);await Promise.all(t.map(s=>this.delete(s.$id)))}},ps={...Ue(Ce.PRE_PRODUCTION_TASKS),async getByDateRange(r,t){const s=[];if(r){const a=new Date(r),n=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`;s.push(Ve.greaterThanEqual("date_assigned",n))}if(t){const a=new Date(t),n=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`;s.push(Ve.lessThanEqual("date_assigned",n))}return this.getAll(s)},async getPreProductionTasksWithRelations(){const r=await this.getAll(),t=Ue(Ce.STAFF),s=Ue(Ce.PROCESSES),a=Ue(Ce.STOCKS),n=await t.getAll(),i=await s.getAll(),c=await a.getAll(),p=new Map(n.map(g=>[g.$id,g.staff_name])),m=new Map(i.map(g=>[g.$id,g.process_name])),o=new Map(c.map(g=>[g.$id,g.stock_name]));return r.map(g=>({...g,staff_name:p.get(g.staff_id)||"Unknown",process_name:m.get(g.process_id)||"Unknown",stock_name:o.get(g.stock_id)||"Unknown"}))}},Ga=(r,t,s={})=>{const{category:a,searchTerm:n}=s,i=r?zs(r,1):void 0,c=r?Xe(r,"yyyy-MM-dd"):void 0,p=t?Xe(t,"yyyy-MM-dd"):void 0,m=i?Xe(i,"yyyy-MM-dd"):void 0,{data:o=[],isLoading:g}=ye({queryKey:["stocks"],queryFn:()=>Yt.getAll(),staleTime:600*1e3}),{data:b=[],isLoading:x}=ye({queryKey:["processes"],queryFn:()=>ys.getAll(),staleTime:600*1e3}),{data:j=[],isLoading:f}=ye({queryKey:["purchases",c,p],queryFn:()=>os.getByDateRange(r,t),enabled:!!r&&!!t,staleTime:300*1e3}),{data:P=[]}=ye({queryKey:["purchasesBefore",m],queryFn:()=>os.getByDateRange(void 0,i),enabled:!!i,staleTime:300*1e3}),{data:N=[],isLoading:T}=ye({queryKey:["cleaning-tasks",c,p],queryFn:async()=>(await ps.getByDateRange(r,t)).filter(V=>(V.process_name?.toLowerCase()||"").includes("cleaning")),enabled:!!r&&!!t,staleTime:300*1e3}),{data:A=[]}=ye({queryKey:["cleaning-tasksBefore",m],queryFn:async()=>(await ps.getByDateRange(void 0,i)).filter(V=>(V.process_name?.toLowerCase()||"").includes("cleaning")),enabled:!!i,staleTime:300*1e3});return{stockStatus:u.useMemo(()=>o.length?o.filter(F=>{if(a&&a!=="all"&&(F.category||F.Category)!==a)return!1;if(n){const V=n.toLowerCase();if(!(F.stock_name?.toLowerCase()||"").includes(V))return!1}return!0}).map(F=>{const V=P.filter(Y=>Y.stock_id===F.$id).reduce((Y,_)=>Y+(Number(_.quantity)||0),0),U=A.filter(Y=>Y.stock_id===F.$id&&Y.status==="completed").reduce((Y,_)=>Y+(Number(_.assigned_quantity)||0),0),Z=V-U,O=j.filter(Y=>Y.stock_id===F.$id).reduce((Y,_)=>Y+(Number(_.quantity)||0),0),Q=N.filter(Y=>Y.stock_id===F.$id&&Y.status==="completed").reduce((Y,_)=>Y+(Number(_.assigned_quantity)||0),0),R=Z+O-Q,k=F.min_level||0;let w="In Stock";return R<=0?w="Out of Stock":R<k&&(w="Low Stock"),{stock_id:F.$id,stock_name:F.stock_name,category:F.category||F.Category,opening_balance:Z,purchases:O,utilised:Q,closing_balance:R,min_level:k,status:w}}):[],[o,j,P,N,A,a,n]),isLoading:g||x||f||T,error:null}},Da=(r,t,s={})=>{const{processId:a}=s,n=r?Kt(r):void 0,i=t?Kt(t):void 0,c=n?zs(n,1):void 0,p=n?Xe(n,"yyyy-MM-dd"):void 0,m=i?Xe(i,"yyyy-MM-dd"):void 0,o=c?Xe(c,"yyyy-MM-dd"):void 0,{data:g=[],isLoading:b}=ye({queryKey:["stocks"],queryFn:()=>Yt.getAll(),staleTime:600*1e3}),{data:x=[],isLoading:j}=ye({queryKey:["processes"],queryFn:()=>ys.getAll(),staleTime:600*1e3}),{data:f=[],isLoading:P}=ye({queryKey:["preProductionTasks",p,m],queryFn:()=>ps.getByDateRange(n,i),enabled:!!n&&!!i,staleTime:300*1e3}),{data:N=[]}=ye({queryKey:["preProductionTasksBefore",o],queryFn:()=>ps.getByDateRange(void 0,c),enabled:!!c,staleTime:300*1e3}),{data:T=[]}=ye({queryKey:["productionTasksForPreStatus",p,m],queryFn:()=>Wt.getProductionTasksWithRelations(p,m),enabled:!!n&&!!i,staleTime:300*1e3}),{data:A=[]}=ye({queryKey:["productionTasksBeforeForPreStatus",o],queryFn:()=>Wt.getProductionTasksWithRelations(void 0,o),enabled:!!c,staleTime:300*1e3});return{statusRecords:u.useMemo(()=>{if(!g.length||!x.length)return[];new Map(x.map(Q=>[Q.$id,Q.process_name]));const F=["cleaning","c & d","roasting","rfp"],V=a?x.filter(Q=>{const R=Q.process_name?.toLowerCase();return Q.$id===a&&F.includes(R)}):x.filter(Q=>{const R=Q.process_name?.toLowerCase();return F.includes(R)}),U=Q=>{if(!Q)return!n&&!i;if(!n&&!i)return!0;const R=Kt(Q),k=n?R>=n:!0,w=i?R<=i:!0;return k&&w},Z=Q=>!Q||!c?!1:Kt(Q)<=c;return g.flatMap(Q=>V.map(R=>{const k=Q.stock_name,w=R.process_name;if(!k||!w)return null;const _=N.filter(ve=>ve.stock_id===Q.$id&&ve.process_id===R.$id&&ve.status==="completed"&&Z(ve.date_completed||ve.date_assigned)).reduce((ve,_e)=>{const He=_e.completed_quantity!==void 0&&_e.completed_quantity!==null?Number(_e.completed_quantity):Number(_e.assigned_quantity)||0,ze=Number(_e.wastage_quantity)||0;return ve+(He-ze)},0),B=N.filter(ve=>ve.stock_id===Q.$id&&ve.stock_source===w&&Z(ve.date_assigned)).reduce((ve,_e)=>ve+(Number(_e.assigned_quantity)||0),0),ne=A.filter(ve=>ve.source_process_id===R.$id).reduce((ve,_e)=>{const ze=(_e.stock_items||[]).filter(tt=>tt.stock_id===Q.$id).reduce((tt,bt)=>tt+(Number(bt.quantity)||0),0);return ve+ze},0),L=B+ne,ee=_-L,H=f.filter(ve=>ve.stock_id===Q.$id&&ve.process_id===R.$id&&U(ve.date_assigned)),de=H.filter(ve=>ve.status==="completed").reduce((ve,_e)=>{const He=_e.completed_quantity!==void 0&&_e.completed_quantity!==null?Number(_e.completed_quantity):Number(_e.assigned_quantity)||0,ze=Number(_e.wastage_quantity)||0;return ve+(He-ze)},0),K=H.reduce((ve,_e)=>ve+(Number(_e.wastage_quantity)||0),0),h=f.filter(ve=>ve.stock_id===Q.$id&&ve.stock_source===w&&U(ve.date_assigned)).reduce((ve,_e)=>ve+(Number(_e.assigned_quantity)||0),0),d=T.filter(ve=>ve.source_process_id===R.$id).reduce((ve,_e)=>{const ze=(_e.stock_items||[]).filter(tt=>tt.stock_id===Q.$id).reduce((tt,bt)=>tt+(Number(bt.quantity)||0),0);return ve+ze},0),I=h+d,C=ee+de-I,ae=Q.min_level||0;let Se="In Stock";return C<=0?Se="Out of Stock":C<ae&&(Se="Low Stock"),{stock_name:k,process:w,opening_balance:ee,effective_completed:de,wastage_qty:K,utilised:I,closing_balance:C,min_level:ae,status:Se}}).filter(R=>R!==null)).filter(Boolean)},[g,x,f,N,T,A,a,n,i,c]),isLoading:b||j||P,error:null}},Ll=()=>{const[r,t]=u.useState("this-month"),[s,a]=u.useState(void 0),n=u.useMemo(()=>{const R=new Date;switch(r){case"this-month":return{from:ws(Tt(R)),to:Ns(Dt(R))};case"previous-month":const k=Vs(R,1);return{from:ws(Tt(k)),to:Ns(Dt(k))};case"last-6-months":return{from:ws(Tt(Vs(R,5))),to:Ns(Dt(R))};case"custom":return s?.from&&s?.to?{from:ws(s.from),to:Ns(s.to)}:{from:ws(Tt(R)),to:Ns(Dt(R))};default:return{from:ws(Tt(R)),to:Ns(Dt(R))}}},[r,s]),{stockStatus:i,isLoading:c}=Ga(n.from,n.to),p=n.from?Xe(n.from,"yyyy-MM-dd"):void 0,m=n.to?Xe(n.to,"yyyy-MM-dd"):void 0,{statusRecords:o,isLoading:g}=Da(p,m),b=u.useMemo(()=>o.filter(R=>R.process?.toLowerCase()==="rfp"),[o]),x=u.useMemo(()=>{const R=[];return n.from&&R.push(Ve.greaterThanEqual("date",n.from.toISOString())),n.to&&R.push(Ve.lessThanEqual("date",n.to.toISOString())),R},[n.from,n.to]),{data:j=[],isLoading:f}=ye({queryKey:["sales-records-dashboard",n.from?.toISOString(),n.to?.toISOString()],queryFn:()=>Zt.getAll(x),enabled:!!n.from&&!!n.to}),{data:P=[]}=ye({queryKey:["sales-channels-dashboard"],queryFn:()=>Ps.getAll()}),{data:N=[]}=ye({queryKey:["products-dashboard"],queryFn:()=>Vt.getAll()}),T=u.useMemo(()=>{const R=[];return n.from&&R.push(Ve.greaterThanEqual("date",n.from.toISOString())),n.to&&R.push(Ve.lessThanEqual("date",n.to.toISOString())),R},[n.from,n.to]),{data:A=[],isLoading:E}=ye({queryKey:["sales-units-dashboard",n.from?.toISOString(),n.to?.toISOString()],queryFn:()=>zt.getAll(T),enabled:!!n.from&&!!n.to}),D=u.useMemo(()=>{const R=new Map;return j.forEach(k=>{const Y=P.find(B=>B.$id===k.sales_channel_id)?.channel_name||k.sales_channel_id,_=(k.sold_units||0)*(k.unit_price||0);if(R.has(k.sales_channel_id)){const B=R.get(k.sales_channel_id);B.totalAmount+=_}else R.set(k.sales_channel_id,{channelName:Y,totalAmount:_})}),Array.from(R.values()).sort((k,w)=>w.totalAmount-k.totalAmount)},[j,P]),F=u.useMemo(()=>{const R=new Map;return A.forEach(k=>{const w=N.find(B=>B.$id===k.product_id),Y=w?.product||w?.product_name||k.product_id,_=k.units||0;if(R.has(k.product_id)){const B=R.get(k.product_id);B.totalUnits+=_}else R.set(k.product_id,{productName:Y,totalUnits:_})}),Array.from(R.values()).sort((k,w)=>w.totalUnits-k.totalUnits)},[A,N]),V=u.useMemo(()=>i.map(R=>({name:R.stock_name,closingBalance:R.closing_balance})).sort((R,k)=>k.closingBalance-R.closingBalance).slice(0,10),[i]),U=u.useMemo(()=>b.map(R=>({name:R.stock_name,closingBalance:R.closing_balance})).sort((R,k)=>k.closingBalance-R.closingBalance).slice(0,10),[b]),Z=u.useMemo(()=>D.map(R=>({name:R.channelName,totalAmount:R.totalAmount})),[D]),O=u.useMemo(()=>F.map(R=>({name:R.productName,totalUnits:R.totalUnits})),[F]),Q=c||g||f||E;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Dashboard"}),e.jsx("p",{className:"text-muted-foreground",children:"Overview of Stock Status, RFP Status, and Sales Status"})]}),e.jsxs(te,{children:[e.jsx(pe,{children:e.jsx(xe,{children:"Date Range"})}),e.jsx(se,{children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(le,{value:r,onValueChange:R=>t(R),children:[e.jsx(ie,{className:"w-[200px]",children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"this-month",children:"This Month"}),e.jsx(S,{value:"previous-month",children:"Previous Month"}),e.jsx(S,{value:"last-6-months",children:"Last 6 Months"}),e.jsx(S,{value:"custom",children:"Custom Range"})]})]}),r==="custom"&&e.jsx(js,{value:s,onChange:a,className:"w-[300px]"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:n.from&&n.to&&e.jsxs("span",{children:[Xe(n.from,"MMM dd, yyyy")," - ",Xe(n.to,"MMM dd, yyyy")]})})]})})]}),Q?e.jsx(te,{children:e.jsxs(se,{className:"py-12 text-center",children:[e.jsx(Be,{className:"h-8 w-8 animate-spin mx-auto mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading dashboard data..."})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid gap-6 grid-cols-1 lg:grid-cols-2",children:[e.jsxs(te,{children:[e.jsx(pe,{children:e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(Ws,{className:"h-5 w-5 text-primary"}),"Stock Status"]})}),e.jsx(se,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-[300px]",children:e.jsx(Xs,{width:"100%",height:"100%",children:e.jsxs(Zs,{data:V,children:[e.jsx(ea,{strokeDasharray:"3 3"}),e.jsx(ta,{dataKey:"name",angle:-45,textAnchor:"end",height:100,interval:0}),e.jsx(sa,{}),e.jsx(aa,{}),e.jsx(ra,{}),e.jsx(na,{dataKey:"closingBalance",fill:"#8884d8",name:"Closing Balance"})]})})}),e.jsx("div",{className:"border rounded-md overflow-auto max-h-[400px]",children:e.jsxs(mt,{children:[e.jsx(ht,{children:e.jsxs(ke,{children:[e.jsx(J,{children:"Stock Name"}),e.jsx(J,{className:"text-right",children:"Closing Balance"})]})}),e.jsx(pt,{children:i.length===0?e.jsx(ke,{children:e.jsx(W,{colSpan:2,className:"text-center py-8 text-muted-foreground",children:"No stock data available"})}):i.map((R,k)=>e.jsxs(ke,{children:[e.jsx(W,{className:"font-medium",children:R.stock_name}),e.jsx(W,{className:"text-right font-semibold",children:e.jsx("span",{className:R.closing_balance<0?"text-red-600":"text-green-600",children:R.closing_balance.toLocaleString()})})]},R.stock_id||`stock-${k}`))})]})})]})})]}),e.jsxs(te,{children:[e.jsx(pe,{children:e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(Ys,{className:"h-5 w-5 text-primary"}),"RFP Status (Pre-Production)"]})}),e.jsx(se,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-[300px]",children:e.jsx(Xs,{width:"100%",height:"100%",children:e.jsxs(Zs,{data:U,children:[e.jsx(ea,{strokeDasharray:"3 3"}),e.jsx(ta,{dataKey:"name",angle:-45,textAnchor:"end",height:100,interval:0}),e.jsx(sa,{}),e.jsx(aa,{}),e.jsx(ra,{}),e.jsx(na,{dataKey:"closingBalance",fill:"#82ca9d",name:"Closing Balance"})]})})}),e.jsx("div",{className:"border rounded-md overflow-auto max-h-[400px]",children:e.jsxs(mt,{children:[e.jsx(ht,{children:e.jsxs(ke,{children:[e.jsx(J,{children:"Stock Name"}),e.jsx(J,{className:"text-right",children:"Closing Balance"})]})}),e.jsx(pt,{children:b.length===0?e.jsx(ke,{children:e.jsx(W,{colSpan:2,className:"text-center py-8 text-muted-foreground",children:"No RFP status data available"})}):b.map((R,k)=>e.jsxs(ke,{children:[e.jsx(W,{className:"font-medium",children:R.stock_name}),e.jsx(W,{className:"text-right font-semibold",children:e.jsx("span",{className:R.closing_balance<0?"text-red-600":"text-green-600",children:R.closing_balance.toFixed(2)})})]},`${R.stock_name}-${k}`))})]})})]})})]})]}),e.jsxs("div",{className:"grid gap-6 grid-cols-1 lg:grid-cols-2",children:[e.jsxs(te,{children:[e.jsx(pe,{children:e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(Va,{className:"h-5 w-5 text-primary"}),"Sales Status"]})}),e.jsx(se,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-[300px]",children:e.jsx(Xs,{width:"100%",height:"100%",children:e.jsxs(Zs,{data:Z,children:[e.jsx(ea,{strokeDasharray:"3 3"}),e.jsx(ta,{dataKey:"name",angle:-45,textAnchor:"end",height:100,interval:0}),e.jsx(sa,{}),e.jsx(aa,{formatter:R=>`â‚¹${R.toLocaleString()}`}),e.jsx(ra,{}),e.jsx(na,{dataKey:"totalAmount",fill:"#ffc658",name:"Total Amount (â‚¹)"})]})})}),e.jsx("div",{className:"border rounded-md overflow-auto max-h-[400px]",children:e.jsxs(mt,{children:[e.jsx(ht,{children:e.jsxs(ke,{children:[e.jsx(J,{children:"Channel Name"}),e.jsx(J,{className:"text-right",children:"Total Amount (â‚¹)"})]})}),e.jsx(pt,{children:D.length===0?e.jsx(ke,{children:e.jsx(W,{colSpan:2,className:"text-center py-8 text-muted-foreground",children:"No sales data available"})}):D.map((R,k)=>e.jsxs(ke,{children:[e.jsx(W,{className:"font-medium",children:R.channelName}),e.jsxs(W,{className:"text-right font-semibold text-green-600",children:["â‚¹",R.totalAmount.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})]})]},`channel-${k}`))})]})})]})})]}),e.jsxs(te,{children:[e.jsx(pe,{children:e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(wi,{className:"h-5 w-5 text-primary"}),"Sales Units - Status"]})}),e.jsx(se,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-[300px]",children:e.jsx(Xs,{width:"100%",height:"100%",children:e.jsxs(Zs,{data:O,children:[e.jsx(ea,{strokeDasharray:"3 3"}),e.jsx(ta,{dataKey:"name",angle:-45,textAnchor:"end",height:100,interval:0}),e.jsx(sa,{}),e.jsx(aa,{formatter:R=>`${R.toLocaleString()}`}),e.jsx(ra,{}),e.jsx(na,{dataKey:"totalUnits",fill:"#8884d8",name:"Total Units"})]})})}),e.jsx("div",{className:"border rounded-md overflow-auto max-h-[400px]",children:e.jsxs(mt,{children:[e.jsx(ht,{children:e.jsxs(ke,{children:[e.jsx(J,{children:"Product"}),e.jsx(J,{className:"text-right",children:"Units"})]})}),e.jsx(pt,{children:F.length===0?e.jsx(ke,{children:e.jsx(W,{colSpan:2,className:"text-center py-8 text-muted-foreground",children:"No sales units data available"})}):F.map((R,k)=>e.jsxs(ke,{children:[e.jsx(W,{className:"font-medium",children:R.productName}),e.jsx(W,{className:"text-right font-semibold text-blue-600",children:R.totalUnits.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})})]},`product-${k}`))})]})})]})})]})]})]})]})},As=u.forwardRef(({className:r,value:t,...s},a)=>e.jsx(Zr,{ref:a,className:me("relative h-4 w-full overflow-hidden rounded-full bg-secondary",r),...s,children:e.jsx(Si,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(t||0)}%)`}})}));As.displayName=Zr.displayName;class Gt{static CHUNK_SIZE=1e3;static MAX_MEMORY_RECORDS=1e4;static async exportToCSV(t,s){try{s?.({current:0,total:t.data.length,percentage:0,status:"preparing",message:"Preparing CSV export..."});const a=this.formatDataForExport(t.data,t.headers);s?.({current:t.data.length*.5,total:t.data.length,percentage:50,status:"processing",message:"Processing data..."});let n=a;t.metadata&&(n=[...this.createMetadataRows(t.metadata),[],t.headers,...a.slice(1)]),s?.({current:t.data.length*.8,total:t.data.length,percentage:80,status:"generating",message:"Generating CSV file..."});const i=Ms.unparse(n,{header:!1,skipEmptyLines:!1});s?.({current:t.data.length,total:t.data.length,percentage:95,status:"downloading",message:"Downloading file..."});const c=new Blob([i],{type:"text/csv;charset=utf-8;"}),p=this.generateFilename(t.filename,"csv");Os.saveAs(c,p),s?.({current:t.data.length,total:t.data.length,percentage:100,status:"complete",message:"Export completed successfully"})}catch(a){throw s?.({current:0,total:t.data.length,percentage:0,status:"error",message:`Export failed: ${a instanceof Error?a.message:"Unknown error"}`}),a}}static async exportToXLSX(t,s){try{s?.({current:0,total:t.data.length,percentage:0,status:"preparing",message:"Preparing Excel export..."});const a=St.book_new(),n=this.formatDataForExport(t.data,t.headers);s?.({current:t.data.length*.3,total:t.data.length,percentage:30,status:"processing",message:"Processing data..."});const i=St.aoa_to_sheet(n);if(this.applyExcelFormatting(i,t.headers.length,n.length),St.book_append_sheet(a,i,"Data"),s?.({current:t.data.length*.6,total:t.data.length,percentage:60,status:"processing",message:"Creating worksheets..."}),t.metadata){const o=this.createMetadataSheet(t.metadata);St.book_append_sheet(a,o,"Export Info")}s?.({current:t.data.length*.8,total:t.data.length,percentage:80,status:"generating",message:"Generating Excel file..."});const c=ir(a,{bookType:"xlsx",type:"array",compression:!0});s?.({current:t.data.length,total:t.data.length,percentage:95,status:"downloading",message:"Downloading file..."});const p=new Blob([c],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),m=this.generateFilename(t.filename,"xlsx");Os.saveAs(p,m),s?.({current:t.data.length,total:t.data.length,percentage:100,status:"complete",message:"Export completed successfully"})}catch(a){throw s?.({current:0,total:t.data.length,percentage:0,status:"error",message:`Export failed: ${a instanceof Error?a.message:"Unknown error"}`}),a}}static async exportLargeDataset(t,s){if(t.data.length<=this.MAX_MEMORY_RECORDS)return t.format==="csv"?this.exportToCSV(t,s):this.exportToXLSX(t,s);try{s?.({current:0,total:t.data.length,percentage:0,status:"preparing",message:"Preparing large dataset export..."});const a=this.chunkArray(t.data,this.CHUNK_SIZE);let n=0;t.format==="csv"?await this.exportLargeCSV(t,a,s):await this.exportLargeXLSX(t,a,s)}catch(a){throw s?.({current:0,total:t.data.length,percentage:0,status:"error",message:`Large export failed: ${a instanceof Error?a.message:"Unknown error"}`}),a}}static formatDataForExport(t,s){if(t.length===0)return[s];const a=[s];return t.forEach(n=>{const i=s.map(c=>{const p=n[c]||n[this.camelToSnake(c)]||"";return this.formatCellValue(p)});a.push(i)}),a}static formatCellValue(t){return t==null?"":typeof t=="boolean"?t?"Yes":"No":t instanceof Date?t.toLocaleDateString("en-GB"):typeof t=="number"?t%1===0?t.toString():t.toFixed(2):typeof t=="object"?JSON.stringify(t):String(t)}static generateFilename(t,s){const a=new Date().toISOString().slice(0,19).replace(/[:.]/g,"-");return`${t}_${a}.${s}`}static createMetadataRows(t){return[["Export Information"],["Exported At:",t.exportedAt.toLocaleString()],["Exported By:",t.exportedBy],["Page Source:",t.pageSource],["Record Count:",t.recordCount.toString()],["Version:",t.version],...t.filters?[["Filters:",JSON.stringify(t.filters)]]:[]]}static createMetadataSheet(t){const s=[["Export Information",""],["Exported At",t.exportedAt.toLocaleString()],["Exported By",t.exportedBy],["Page Source",t.pageSource],["Record Count",t.recordCount],["Version",t.version],...t.filters?[["Filters",JSON.stringify(t.filters)]]:[]];return St.aoa_to_sheet(s)}static applyExcelFormatting(t,s,a){const n=St.encode_range({s:{c:0,r:0},e:{c:s-1,r:a-1}});t["!ref"]=n;const i=Array(s).fill({wch:15});t["!cols"]=i;for(let c=0;c<s;c++){const p=St.encode_cell({r:0,c});t[p]&&(t[p].s={font:{bold:!0},fill:{fgColor:{rgb:"E2E8F0"}}})}}static async exportLargeCSV(t,s,a){let n="",i=0;if(n+=Ms.unparse([t.headers],{header:!1})+`
`,t.metadata){const m=this.createMetadataRows(t.metadata);n=Ms.unparse(m,{header:!1})+`

`+n}for(let m=0;m<s.length;m++){const o=s[m],g=this.formatDataForExport(o,t.headers).slice(1);n+=Ms.unparse(g,{header:!1}),m<s.length-1&&(n+=`
`),i+=o.length,a?.({current:i,total:t.data.length,percentage:Math.round(i/t.data.length*80),status:"processing",message:`Processing chunk ${m+1} of ${s.length}...`}),await new Promise(b=>setTimeout(b,10))}const c=new Blob([n],{type:"text/csv;charset=utf-8;"}),p=this.generateFilename(t.filename,"csv");Os.saveAs(c,p)}static async exportLargeXLSX(t,s,a){const n=St.book_new();let i=[t.headers],c=0;for(let b=0;b<s.length;b++){const x=s[b],j=this.formatDataForExport(x,t.headers).slice(1);i.push(...j),c+=x.length,a?.({current:c,total:t.data.length,percentage:Math.round(c/t.data.length*70),status:"processing",message:`Processing chunk ${b+1} of ${s.length}...`}),await new Promise(f=>setTimeout(f,10))}const p=St.aoa_to_sheet(i);if(this.applyExcelFormatting(p,t.headers.length,i.length),St.book_append_sheet(n,p,"Data"),t.metadata){const b=this.createMetadataSheet(t.metadata);St.book_append_sheet(n,b,"Export Info")}const m=ir(n,{bookType:"xlsx",type:"array",compression:!0}),o=new Blob([m],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),g=this.generateFilename(t.filename,"xlsx");Os.saveAs(o,g)}static chunkArray(t,s){const a=[];for(let n=0;n<t.length;n+=s)a.push(t.slice(n,n+s));return a}static camelToSnake(t){return t.replace(/[A-Z]/g,s=>`_${s.toLowerCase()}`)}}const At=({data:r,headers:t,filename:s,className:a,disabled:n=!1,includeMetadata:i=!0,metadata:c,onExportStart:p,onExportComplete:m,variant:o="outline",size:g="default"})=>{const[b,x]=u.useState(!1),[j,f]=u.useState(null),[P,N]=u.useState(null),T=async F=>{if(!(b||n))try{x(!0),N(F),f(null),p?.();const V=i?{exportedAt:new Date,exportedBy:"Current User",pageSource:s,recordCount:r.length,version:"1.0.0",...c}:void 0,U={filename:s,headers:t,data:r,format:F,metadata:V};f({current:0,total:r.length,percentage:0,status:"preparing",message:`Preparing ${F.toUpperCase()} export...`}),r.length>1e4?await Gt.exportLargeDataset(U,f):F==="csv"?await Gt.exportToCSV(U,f):await Gt.exportToXLSX(U,f),Xt.success(`Successfully exported ${r.length} records to ${F.toUpperCase()}`,{description:`File: ${s}_${new Date().toISOString().slice(0,19).replace(/[:.]/g,"-")}.${F}`}),m?.(!0)}catch(V){console.error("Export failed:",V),Xt.error("Export failed",{description:V instanceof Error?V.message:"An unexpected error occurred"}),m?.(!1)}finally{x(!1),N(null),f(null)}},A=()=>b&&P?`Exporting ${P.toUpperCase()}...`:"Export",E=()=>b?e.jsx(Be,{className:"h-4 w-4 animate-spin"}):e.jsx(xs,{className:"h-4 w-4"}),D=!r||r.length===0;return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(ya,{children:[e.jsx(va,{asChild:!0,children:e.jsxs($,{variant:o,size:g,className:a,disabled:n||b||D,children:[E(),A()]})}),e.jsxs(Qs,{align:"end",children:[e.jsxs(Rs,{onClick:()=>T("csv"),disabled:b||D,className:"cursor-pointer",children:[e.jsx(Es,{className:"h-4 w-4 mr-2"}),"Export as CSV"]}),e.jsxs(Rs,{onClick:()=>T("xlsx"),disabled:b||D,className:"cursor-pointer",children:[e.jsx(en,{className:"h-4 w-4 mr-2"}),"Export as Excel"]})]})]}),b&&j&&e.jsxs("div",{className:"space-y-2 min-w-[200px]",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:j.message||"Processing..."}),e.jsxs("span",{className:"text-muted-foreground",children:[j.percentage,"%"]})]}),e.jsx(As,{value:j.percentage,className:"h-2"}),j.currentBatch&&j.totalBatches&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Batch ",j.currentBatch," of ",j.totalBatches]})]}),D&&e.jsx("div",{className:"text-xs text-muted-foreground",children:"No data available to export"})]})},ct=Pr,vs=_i,Ml=kr,Ln=u.forwardRef(({className:r,...t},s)=>e.jsx(ba,{ref:s,className:me("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r),...t}));Ln.displayName=ba.displayName;const nt=u.forwardRef(({className:r,children:t,...s},a)=>e.jsxs(Ml,{children:[e.jsx(Ln,{}),e.jsxs(Na,{ref:a,className:me("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",r),...s,children:[t,e.jsxs(Cr,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-accent data-[state=open]:text-muted-foreground hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[e.jsx(Ts,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));nt.displayName=Na.displayName;const it=({className:r,...t})=>e.jsx("div",{className:me("flex flex-col space-y-1.5 text-center sm:text-left",r),...t});it.displayName="DialogHeader";const ot=({className:r,...t})=>e.jsx("div",{className:me("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",r),...t});ot.displayName="DialogFooter";const lt=u.forwardRef(({className:r,...t},s)=>e.jsx(wa,{ref:s,className:me("text-lg font-semibold leading-none tracking-tight",r),...t}));lt.displayName=wa.displayName;const dt=u.forwardRef(({className:r,...t},s)=>e.jsx(Sa,{ref:s,className:me("text-sm text-muted-foreground",r),...t}));dt.displayName=Sa.displayName;const Ol=gs("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function et({className:r,variant:t,...s}){return e.jsx("div",{className:me(Ol({variant:t}),r),...s})}class qa{static DEFAULT_BATCH_SIZE=100;static MAX_FILE_SIZE_MB=50;static SUPPORTED_FORMATS=[".csv",".xlsx",".xls"];static async parseFile(t,s){try{this.validateFile(t),s?.({current:0,total:100,percentage:0,status:"parsing",message:"Starting file parsing..."});const a=this.getFileExtension(t.name);let n=[];if(a===".csv")n=await this.parseCSVFile(t,s);else if(a===".xlsx"||a===".xls")n=await this.parseExcelFile(t,s);else throw new Error(`Unsupported file format: ${a}`);return s?.({current:100,total:100,percentage:100,status:"complete",message:`Successfully parsed ${n.length} rows`}),n}catch(a){throw s?.({current:0,total:100,percentage:0,status:"error",message:`Parsing failed: ${a instanceof Error?a.message:"Unknown error"}`}),a}}static validateData(t,s,a){const n={isValid:!0,errors:[],warnings:[],validData:[],invalidData:[]};if(t.length===0)return n.isValid=!1,n.errors.push({row:0,column:"file",message:"File contains no data rows",value:null,severity:"error"}),n;a?.({current:0,total:t.length,percentage:0,status:"validating",message:"Starting data validation..."});const i=Object.keys(t[0]),c=this.validateHeaders(i,s);c.isValid||(n.errors.push(...c.errors),n.isValid=!1),t.forEach((m,o)=>{const g=o+1,b=this.validateRow(m,s.validationRules,g,t,s);b.errors.length>0?(n.errors.push(...b.errors),n.invalidData.push({...m,_rowNumber:g})):n.validData.push({...m,_rowNumber:g}),b.warnings.length>0&&n.warnings.push(...b.warnings),(o%100===0||o===t.length-1)&&a?.({current:o+1,total:t.length,percentage:Math.round((o+1)/t.length*100),status:"validating",message:`Validating row ${o+1} of ${t.length}...`})});const p=this.detectDuplicates(t,s);return n.warnings.push(...p),n.isValid=n.errors.length===0,a?.({current:t.length,total:t.length,percentage:100,status:"complete",message:`Validation complete. ${n.validData.length} valid rows, ${n.invalidData.length} invalid rows`}),n}static async processImport(t,s,a){const n=s.batchSize||this.DEFAULT_BATCH_SIZE,i=this.createBatches(t,n),c={totalRows:t.length,successfulRows:0,failedRows:0,errors:[],warnings:[],processedData:[],skippedRows:0};a?.({current:0,total:t.length,percentage:0,status:"processing",message:"Starting import process...",currentBatch:0,totalBatches:i.length});try{if(s.dataProcessor)for(let p=0;p<t.length;p++){const m=t[p];try{let o={...m};if(s.columnMapper){const b={};Object.keys(m).forEach(x=>{const j=s.columnMapper(x);b[j]=m[x],b[x]=m[x]}),o={...o,...b}}console.log(`ðŸ”„ [ImportService] Processing row ${p+1}...`),console.log("ðŸ”„ [ImportService] Transformed row:",o);const g=await s.dataProcessor(o,t);console.log(`âœ… [ImportService] Row ${p+1} processed successfully. Saved data:`,g),c.processedData.push(g),c.successfulRows++,console.log(`âœ… [ImportService] Incremented successfulRows to: ${c.successfulRows}`)}catch(o){console.error(`âŒ [ImportService] Error processing row ${p+1}:`,o),console.error("âŒ [ImportService] Error details:",{message:o instanceof Error?o.message:"Unknown error",stack:o instanceof Error?o.stack:void 0,row:m}),c.errors.push({row:p+1,column:"processing",message:o instanceof Error?o.message:"Failed to process row",value:m,severity:"error"}),c.failedRows++}(p%10===0||p===t.length-1)&&a?.({current:p+1,total:t.length,percentage:Math.round((p+1)/t.length*100),status:"processing",message:`Processing row ${p+1} of ${t.length}...`,currentBatch:Math.floor(p/n)+1,totalBatches:i.length}),await new Promise(o=>setTimeout(o,10))}else for(let p=0;p<i.length;p++){const m=i[p],o=await this.processBatch(m,n,p+1);c.successfulRows+=o.processed,c.errors.push(...o.errors),c.warnings.push(...o.warnings),c.processedData.push(...o.data);const g=(p+1)*n,b=Math.min(g,t.length);a?.({current:b,total:t.length,percentage:Math.round(b/t.length*100),status:"processing",message:`Processing batch ${p+1} of ${i.length}...`,currentBatch:p+1,totalBatches:i.length}),await new Promise(x=>setTimeout(x,10))}return c.failedRows=c.totalRows-c.successfulRows,a?.({current:t.length,total:t.length,percentage:100,status:"complete",message:`Import complete. ${c.successfulRows} successful, ${c.failedRows} failed`}),s.onImportComplete(c),c}catch(p){throw a?.({current:0,total:t.length,percentage:0,status:"error",message:`Import failed: ${p instanceof Error?p.message:"Unknown error"}`}),p}}static async processBatch(t,s,a){const n={processed:0,errors:[],warnings:[],data:[]};try{return await new Promise(i=>setTimeout(i,50)),t.forEach((i,c)=>{try{const p=this.processRow(i);n.data.push(p),n.processed++}catch(p){n.errors.push({row:(a-1)*s+c+1,column:"processing",message:p instanceof Error?p.message:"Processing failed",value:i,severity:"error"})}}),n}catch(i){return t.forEach((c,p)=>{n.errors.push({row:(a-1)*s+p+1,column:"batch",message:`Batch processing failed: ${i instanceof Error?i.message:"Unknown error"}`,value:null,severity:"error"})}),n}}static validateFile(t){const s=this.MAX_FILE_SIZE_MB*1024*1024;if(t.size>s)throw new Error(`File size exceeds maximum allowed size of ${this.MAX_FILE_SIZE_MB}MB`);const a=this.getFileExtension(t.name);if(!this.SUPPORTED_FORMATS.includes(a))throw new Error(`Unsupported file format. Supported formats: ${this.SUPPORTED_FORMATS.join(", ")}`)}static async parseCSVFile(t,s){return new Promise((a,n)=>{Ms.parse(t,{header:!0,skipEmptyLines:!0,transformHeader:i=>i.trim(),transform:(i,c)=>{const p=i.trim();if(c.toLowerCase().includes("date")){if(p==="")return"";const m=p.match(/^(\d{2})-(\d{2})-(\d{4})$/);if(m){const[,g,b,x]=m,j=new Date(parseInt(x),parseInt(b)-1,parseInt(g));if(!isNaN(j.getTime()))return`${x}-${b}-${g}`}if(/^\d{4}-\d{2}-\d{2}$/.test(p))return p;const o=new Date(p);if(!isNaN(o.getTime())){const g=o.getFullYear(),b=String(o.getMonth()+1).padStart(2,"0"),x=String(o.getDate()).padStart(2,"0");return`${g}-${b}-${x}`}return p}if(c.toLowerCase().includes("quantity")||c.toLowerCase().includes("qty")||c.toLowerCase().includes("units")||c.toLowerCase().includes("rate")||c.toLowerCase().includes("price")||c.toLowerCase().includes("amount")||c.toLowerCase().includes("total")){if(p==="")return"";const m=parseFloat(p);return isNaN(m)?p:m}return p},step:(i,c)=>{const p=Math.round((t.size-c.streamer._input.length)/t.size*80);s?.({current:p,total:100,percentage:p,status:"parsing",message:"Parsing CSV file..."})},complete:i=>{if(i.errors.length>0){const c=i.errors.map(p=>`Row ${p.row}: ${p.message}`).join("; ");n(new Error(`CSV parsing errors: ${c}`))}else a(i.data)},error:i=>{n(new Error(`CSV parsing failed: ${i.message}`))}})})}static async parseExcelFile(t,s){return new Promise((a,n)=>{const i=new FileReader;i.onload=c=>{try{s?.({current:50,total:100,percentage:50,status:"parsing",message:"Reading Excel file..."});const p=new Uint8Array(c.target?.result),m=to(p,{type:"array"}),o=m.SheetNames[0],g=m.Sheets[o];s?.({current:80,total:100,percentage:80,status:"parsing",message:"Converting Excel data..."});const b=St.sheet_to_json(g,{header:1,defval:"",blankrows:!1,raw:!0});if(b.length===0){n(new Error("Excel file contains no data"));return}const x=(P,N,T)=>{if(P==null||P==="")return"";if(N.toLowerCase().includes("date")){if(typeof P=="string"){const A=P.trim();if(A==="")return"";const E=A.match(/^(\d{1,2})-(\d{1,2})-(\d{4})$/);if(E){const[,V,U,Z]=E,O=parseInt(V),Q=parseInt(U),R=parseInt(Z);if(O>=1&&O<=31&&Q>=1&&Q<=12&&R>=1900&&R<=2100){const k=new Date(R,Q-1,O);if(!isNaN(k.getTime())&&k.getFullYear()===R&&k.getMonth()===Q-1&&k.getDate()===O){const w=String(R),Y=String(Q).padStart(2,"0"),_=String(O).padStart(2,"0");return`${w}-${Y}-${_}`}}}const D=A.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);if(D){const[,V,U,Z]=D,O=parseInt(V),Q=parseInt(U),R=parseInt(Z);if(O>=1&&O<=31&&Q>=1&&Q<=12&&R>=1900&&R<=2100){const k=new Date(R,Q-1,O);if(!isNaN(k.getTime())&&k.getFullYear()===R&&k.getMonth()===Q-1&&k.getDate()===O){const w=String(R),Y=String(Q).padStart(2,"0"),_=String(O).padStart(2,"0");return`${w}-${Y}-${_}`}}}if(/^\d{4}-\d{2}-\d{2}$/.test(A)){const V=new Date(A);if(!isNaN(V.getTime()))return A}const F=new Date(A);if(!isNaN(F.getTime())){const V=F.getFullYear(),U=String(F.getMonth()+1).padStart(2,"0"),Z=String(F.getDate()).padStart(2,"0");return`${V}-${U}-${Z}`}return A}if(P instanceof Date){if(isNaN(P.getTime()))return"";const A=P.getFullYear(),E=String(P.getMonth()+1).padStart(2,"0"),D=String(P.getDate()).padStart(2,"0");return`${A}-${E}-${D}`}if(typeof P=="number"&&P>=1&&P<3e6){const A=new Date(1899,11,30),E=new Date(A.getTime()+P*864e5);if(!isNaN(E.getTime())){const D=E.getFullYear(),F=String(E.getMonth()+1).padStart(2,"0"),V=String(E.getDate()).padStart(2,"0");return`${D}-${F}-${V}`}}return""}if(N.toLowerCase().includes("quantity")||N.toLowerCase().includes("qty")||N.toLowerCase().includes("units")||N.toLowerCase().includes("rate")||N.toLowerCase().includes("price")||N.toLowerCase().includes("amount")||N.toLowerCase().includes("total")){if(typeof P=="number")return P;if(typeof P=="string"){const A=P.trim();if(A==="")return"";const E=parseFloat(A);if(!isNaN(E))return E}}return typeof P=="string"?P.trim():String(P)},j=b[0].map(P=>String(P).trim()),f=b.slice(1).map(P=>{const N={};return j.forEach((T,A)=>{N[T]=x(P[A],T)}),N});a(f)}catch(p){n(new Error(`Excel parsing failed: ${p instanceof Error?p.message:"Unknown error"}`))}},i.onerror=()=>{n(new Error("Failed to read Excel file"))},i.readAsArrayBuffer(t)})}static validateHeaders(t,s){const a=[];s.requiredColumns.forEach(i=>{t.includes(i)||a.push({row:0,column:i,message:`Required column '${i}' is missing`,value:null,severity:"error"})});const n=[...s.requiredColumns,...s.optionalColumns];return t.forEach(i=>{n.includes(i)||a.push({row:0,column:i,message:`Unknown column '${i}' will be ignored`,value:null,severity:"warning"})}),{isValid:a.filter(i=>i.severity==="error").length===0,errors:a}}static detectDuplicates(t,s){const a=[];if(t.length===0)return a;const n=t[0],i=Object.keys(n),c=j=>{i.map(f=>f.toLowerCase().trim());for(const f of j){const P=f.toLowerCase().trim(),N=i.find(A=>A.toLowerCase().trim()===P);if(N)return N;const T=i.find(A=>A.toLowerCase().includes(P)||P.includes(A.toLowerCase()));if(T)return T}return null},p=c(["Date","date","purchase_date","purchaseDate","Purchase Date","Date Assigned","date_assigned","Date Completed","date_completed"]),m=c(["Purchase Code","Purchase_Code","purchase_code","purchaseCode","Code","Task ID","Task_ID","task_id","taskId","Product","product","product_name","productName","SKU","sku"]);if(!m&&!p)return a;const o=(j,f)=>{if(!f)return null;const P=j[f];return P==null||P===""?null:String(P).trim()},g=j=>{if(!j)return null;if(/^\d{4}-\d{2}-\d{2}$/.test(j))return j;const f=new Date(j);if(!isNaN(f.getTime())){const P=f.getFullYear(),N=String(f.getMonth()+1).padStart(2,"0"),T=String(f.getDate()).padStart(2,"0");return`${P}-${N}-${T}`}return j.toLowerCase()},b=new Map,x=new Map;if(s.duplicateChecker&&t.length>1){const j=new Map;t.forEach((f,P)=>{const N=P+1,T=(f["Task ID"]||f.task_id||f.task_id||"").toLowerCase().trim(),A=(f["Stock Name"]||f.stock_name||f.stock_name||"").toLowerCase().trim(),E=(f["Stock Source"]||f.stock_source||f.stock_source||"").toLowerCase().trim(),D=f["Date Assigned"]||f.date_assigned||f.date_assigned||"",F=(f.Process||f.process_name||f.process_name||"").toLowerCase().trim();let V="";if(D)if(typeof D=="string"){const Z=D.match(/^(\d{2})-(\d{2})-(\d{4})$/);if(Z){const[,O,Q,R]=Z,k=new Date(parseInt(R),parseInt(Q)-1,parseInt(O));isNaN(k.getTime())||(V=k.toISOString().split("T")[0])}else{const O=new Date(D);isNaN(O.getTime())||(V=O.toISOString().split("T")[0])}}else D instanceof Date&&(V=D.toISOString().split("T")[0]);const U=`${T}|${A}|${E}|${V}|${F}`;j.has(U)||j.set(U,[]),j.get(U).push(N)}),j.forEach((f,P)=>{if(f.length>1){const[N,T,A,E,D]=P.split("|");f.forEach(F=>{a.push({row:F,column:"Multiple Fields",message:`âš ï¸ Duplicate detected: The combination of Task ID "${N}", Stock Name "${T}", Stock Source "${A}", Date Assigned "${E}", and Process "${D}" appears in ${f.length} row(s) (Rows: ${f.join(", ")}). This may create duplicate records. You can still import if these are intentional additions.`,value:P})})}})}else t.forEach((j,f)=>{const P=f+1,N=g(o(j,p)),T=o(j,m)?.toLowerCase();if(N&&T){const A=`${N}|${T}`;b.has(A)||b.set(A,[]),b.get(A).push(P)}T&&(x.has(T)||x.set(T,[]),x.get(T).push(P))});if(s.existingData&&s.existingData.length>0)if(s.duplicateChecker)t.forEach((j,f)=>{const P=f+1;s.duplicateChecker(j,s.existingData)&&a.push({row:P,column:"Multiple Fields",message:"âš ï¸ This record already exists in the database. The combination of Task ID, Stock Name, Stock Source, Date Assigned, and Process matches an existing record. This will create a duplicate.",value:"Duplicate Record"})});else{const j=new Set;s.existingData.forEach(f=>{const P=g(f.date||f.purchase_date||f.purchaseDate||f.date_assigned||f.date_completed),N=(f.purchase_code||f.purchaseCode||f.code||f.task_id||f.taskId||f.product_name||f.product||f.sku||"").toLowerCase().trim();P&&N&&j.add(`${P}|${N}`)}),t.forEach((f,P)=>{const N=P+1,T=g(o(f,p)),A=o(f,m)?.toLowerCase();if(T&&A){const E=`${T}|${A}`;j.has(E)&&a.push({row:N,column:m||"Identifier",message:`âš ï¸ This record already exists in the database: Date "${T}" and ${m||"Identifier"} "${A}" combination matches an existing record. This will create a duplicate.`,value:`${T}|${A}`})}})}return b.forEach((j,f)=>{if(j.length>1){const[P,N]=f.split("|");j.forEach(T=>{a.push({row:T,column:m||"Identifier",message:`âš ï¸ Duplicate detected: Date "${P}" and ${m||"Identifier"} "${N}" combination appears in ${j.length} row(s) (Rows: ${j.join(", ")}). This may create duplicate records. You can still import if these are intentional additions.`,value:`${P}|${N}`})})}}),x.forEach((j,f)=>{if(j.length>1){let P=!1;b.forEach((N,T)=>{T.endsWith(`|${f}`)&&N.length>1&&(P=!0)}),P||j.forEach(N=>{a.push({row:N,column:m||"Identifier",message:`âš ï¸ ${m||"Identifier"} "${f}" appears ${j.length} time(s) (Rows: ${j.join(", ")}). Please verify if these are duplicate records or separate additions.`,value:f})})}}),a.length>0&&(console.log("Duplicate detection found:",a.length,"warnings"),console.log("Date field found:",p),console.log("Purchase Code field found:",purchaseCodeFieldName)),a}static validateRow(t,s,a,n,i){const c=[],p=[];return s.forEach(m=>{let o=m.field;i.validationHeaderMapper&&(o=i.validationHeaderMapper(m.field));let g,b=o;if(t[o]!==void 0)g=t[o],b=o;else{const j=o.toLowerCase(),f=Object.keys(t).find(P=>P.toLowerCase()===j);if(f)g=t[f],b=f;else{const P=Object.keys(t).find(N=>N.toLowerCase().includes(j)||j.includes(N.toLowerCase()));P&&(g=t[P],b=P)}}const x=this.applyValidationRule(g,m,t,n);if(x!==!0){const j=typeof x=="string"?x:m.message||`Validation failed for ${m.field}`;m.type==="required"||m.validator&&x===!1?c.push({row:a,column:b,message:j,value:g,severity:"error"}):p.push({row:a,column:b,message:j,value:g})}}),{errors:c,warnings:p}}static applyValidationRule(t,s,a,n){switch(s.type){case"required":return t!=null&&t!=="";case"format":if(s.options?.pattern)return s.options.pattern.test(String(t));if(s.field.toLowerCase().includes("date")){if(!t||t==="")return!0;if(t instanceof Date)return isNaN(t.getTime())?"Invalid date format. Use DD-MM-YYYY format (e.g., 15-01-2024)":!0;if(typeof t=="string"){const p=t.trim();if(/^\d{2}-\d{2}-\d{4}$/.test(p)){const[,o,g,b]=p.match(/^(\d{2})-(\d{2})-(\d{4})$/)||[],x=new Date(parseInt(b),parseInt(g)-1,parseInt(o));return isNaN(x.getTime())?"Invalid date format. Use DD-MM-YYYY format (e.g., 15-01-2024)":!0}if(/^\d{4}-\d{2}-\d{2}$/.test(p)){const o=new Date(p);return isNaN(o.getTime())?"Invalid date format. Use DD-MM-YYYY format (e.g., 15-01-2024)":!0}const m=new Date(p);if(!isNaN(m.getTime()))return!0}return"Invalid date format. Use DD-MM-YYYY format (e.g., 15-01-2024) or YYYY-MM-DD format (e.g., 2024-01-15)"}return!0;case"range":let i;if(typeof t=="number")i=t;else if(typeof t=="string"&&t.trim()!=="")i=parseFloat(t.trim());else return t==null||t===""?!0:"Value must be a number";return isNaN(i)?"Value must be a number":s.options?.min!==void 0&&i<s.options.min?`Value must be at least ${s.options.min}`:s.options?.max!==void 0&&i>s.options.max?`Value must be at most ${s.options.max}`:!0;case"unique":return n.filter(p=>p[s.field]===t).length<=1||`Duplicate value found: ${t}`;case"custom":if(s.validator){if(s.field.toLowerCase().includes("date")&&t instanceof Date)return isNaN(t.getTime())?"Invalid date format":!0;if(typeof t=="number"&&!isNaN(t)){const p=s.validator(t,a,n);return p===!1&&typeof s.validator=="function"?s.validator(String(t),a,n):p}return s.validator(t,a,n)}return!0;default:return!0}}static processRow(t){const s={};return Object.keys(t).forEach(a=>{let n=t[a];if(a.startsWith("_")){s[a]=n;return}if(typeof n=="string"){if(n=n.trim(),n===""&&(n=null),n&&!isNaN(Number(n))&&!isNaN(parseFloat(n))){const i=parseFloat(n);(i.toString()===n||i.toFixed(2)===n)&&(n=i)}n==="true"||n==="True"||n==="TRUE"?n=!0:(n==="false"||n==="False"||n==="FALSE")&&(n=!1)}s[a]=n}),s}static createBatches(t,s){const a=[];for(let n=0;n<t.length;n+=s)a.push(t.slice(n,n+s));return a}static getFileExtension(t){return t.toLowerCase().substring(t.lastIndexOf("."))}}const qt=({config:r,className:t,disabled:s=!1,onImportComplete:a,onImportStart:n,variant:i="outline",size:c="default",acceptedFormats:p=[".csv",".xlsx",".xls","text/csv","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel"]})=>{const m=u.useRef(null),[o,g]=u.useState({isOpen:!1,step:"upload",file:null,parsedData:[],validationResult:null,importProgress:null,importResult:null,error:null}),b=()=>{g({isOpen:!1,step:"upload",file:null,parsedData:[],validationResult:null,importProgress:null,importResult:null,error:null})},x=()=>["ID","Created Date","Updated Date","Status"],j=()=>{const O=x(),Q=["Status","Total Amount"];return[...O,...Q]},f=()=>{const O=j(),R=r.requiredColumns.concat(r.optionalColumns||[]).filter(B=>!O.includes(B)),k=R.map(B=>B.toLowerCase().includes("date")?"15-01-2024":B.toLowerCase().includes("quantity")||B.toLowerCase().includes("qty")||B.toLowerCase().includes("units")||B.toLowerCase().includes("rate")||B.toLowerCase().includes("price")?10:B.toLowerCase().includes("code")||B.toLowerCase().includes("id")?"SAMPLE001":`Sample ${B}`),w=St.book_new(),Y=[R,k],_=St.aoa_to_sheet(Y);St.book_append_sheet(w,_,"Sample Data"),so(w,"sample-import-template.xls"),Xt.success("Sample XLS downloaded",{description:"Fill in your data and import the file"})},P=async O=>{try{g(k=>({...k,file:O,error:null,step:"preview"}));const Q=await qa.parseFile(O,k=>{g(w=>({...w,importProgress:k}))}),R=qa.validateData(Q,r,k=>{g(w=>({...w,importProgress:k}))});g(k=>({...k,parsedData:Q,validationResult:R,importProgress:null}))}catch(Q){g(R=>({...R,error:Q instanceof Error?Q.message:"Failed to parse file",importProgress:null}))}},N=async()=>{if(!o.validationResult)return;const O=o.validationResult.validData.length>0,Q=o.validationResult.errors.filter(k=>k.severity==="error").length===0&&o.validationResult.warnings.length>0;if(!O&&!Q){Xt.error("Cannot import",{description:"No valid rows to import. Please fix validation errors first."});return}const R=O?o.validationResult.validData:o.parsedData;try{g(w=>({...w,step:"processing",error:null})),n?.();const k=await qa.processImport(R,r,w=>{g(Y=>({...Y,importProgress:w}))});g(w=>({...w,step:"complete",importResult:k,importProgress:null})),k.successfulRows>0&&k.failedRows===0?Xt.success("Import completed successfully",{description:`${k.successfulRows} rows imported successfully`}):k.successfulRows>0&&k.failedRows>0?Xt.warning("Import completed with errors",{description:`${k.successfulRows} successful, ${k.failedRows} failed. Check console for details.`,duration:1e4}):k.failedRows>0?Xt.error("Import failed",{description:`All ${k.failedRows} rows failed. Check console for details.`,duration:1e4}):Xt.error("Import failed",{description:"No rows were imported. Check console for details.",duration:1e4}),console.log("ðŸ“Š Import Complete:",{totalRows:k.totalRows,successfulRows:k.successfulRows,failedRows:k.failedRows,errors:k.errors,warnings:k.warnings}),a?.(k)}catch(k){g(w=>({...w,error:k instanceof Error?k.message:"Import failed",importProgress:null})),Xt.error("Import failed",{description:k instanceof Error?k.message:"An unexpected error occurred"})}},T=O=>{O.preventDefault(),O.stopPropagation()},A=O=>{O.preventDefault(),O.stopPropagation();const R=Array.from(O.dataTransfer.files)[0];R&&P(R)},E=()=>{const O=j();r.requiredColumns.concat(r.optionalColumns||[]).filter(w=>!O.includes(w));const R=r.requiredColumns.filter(w=>!O.includes(w)),k=(r.optionalColumns||[]).filter(w=>!O.includes(w));return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(Qe,{children:[e.jsx(is,{className:"h-4 w-4"}),e.jsxs(Ye,{className:"space-y-2",children:[e.jsx("div",{className:"font-medium",children:"Import Instructions:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-sm",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Date Format:"})," Use ",e.jsx("code",{className:"bg-gray-100 px-1 rounded",children:"DD-MM-YYYY"})," format (e.g., 15-01-2024) or ",e.jsx("code",{className:"bg-gray-100 px-1 rounded",children:"YYYY-MM-DD"})," format (e.g., 2024-01-15)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Supported Formats:"})," CSV (",e.jsx("code",{className:"bg-gray-100 px-1 rounded",children:".csv"}),"), Excel (",e.jsx("code",{className:"bg-gray-100 px-1 rounded",children:".xlsx"}),", ",e.jsx("code",{className:"bg-gray-100 px-1 rounded",children:".xls"}),")"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Required Fields:"})," Must be filled in for all rows"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Optional Fields:"})," Can be left empty"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Auto-Generated Fields:"})," ",O.join(", ")," will be automatically generated by the system"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"CSV Format:"})," First row must contain column headers matching the sample template"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"File Size:"})," Maximum ",r.maxFileSize||50,"MB"]})]})]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 space-y-2",children:[e.jsx("div",{className:"font-medium text-blue-900",children:"Field Information:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-blue-800 mb-1",children:["Required Fields (",R.length,"):"]}),e.jsx("div",{className:"text-blue-700",children:R.length>0?e.jsx("ul",{className:"list-disc list-inside space-y-0.5",children:R.map((w,Y)=>e.jsx("li",{children:w},Y))}):e.jsx("span",{className:"text-gray-500",children:"None (all excluded)"})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-blue-800 mb-1",children:["Optional Fields (",k.length,"):"]}),e.jsx("div",{className:"text-blue-700",children:k.length>0?e.jsx("ul",{className:"list-disc list-inside space-y-0.5",children:k.map((w,Y)=>e.jsx("li",{children:w},Y))}):e.jsx("span",{className:"text-gray-500",children:"None"})})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs($,{variant:"outline",size:"sm",onClick:w=>{w.stopPropagation(),f()},className:"gap-2",children:[e.jsx(Es,{className:"h-4 w-4"}),"Download Sample XLS"]})}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-gray-400 transition-colors cursor-pointer",onDragOver:T,onDrop:A,onClick:()=>m.current?.click(),children:[e.jsx(ga,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"Drop your file here or click to browse"}),e.jsxs("p",{className:"text-sm text-gray-500 mb-4",children:["Supported formats: ",p.join(", ")]}),e.jsx($,{variant:"outline",children:"Choose File"})]}),e.jsx("input",{ref:m,type:"file",accept:p.join(","),onChange:w=>{const Y=w.target.files?.[0];Y&&P(Y)},className:"hidden"}),o.importProgress&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:o.importProgress.message}),e.jsxs("span",{children:[o.importProgress.percentage,"%"]})]}),e.jsx(As,{value:o.importProgress.percentage})]}),o.error&&e.jsxs(Qe,{variant:"destructive",children:[e.jsx(is,{className:"h-4 w-4"}),e.jsx(Ye,{children:o.error})]})]})},D=()=>{if(!o.validationResult)return null;const{validData:O,invalidData:Q,errors:R,warnings:k}=o.validationResult;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Import Preview"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(et,{variant:"outline",className:"text-green-600",children:[e.jsx(tr,{className:"h-3 w-3 mr-1"}),O.length," Valid"]}),Q.length>0&&e.jsxs(et,{variant:"outline",className:"text-red-600",children:[e.jsx(is,{className:"h-3 w-3 mr-1"}),Q.length," Invalid"]}),k.length>0&&e.jsxs(et,{variant:"outline",className:"text-yellow-600",children:[e.jsx(is,{className:"h-3 w-3 mr-1"}),k.length," Warnings"]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[o.file?.name.endsWith(".csv")?e.jsx(Es,{className:"h-4 w-4"}):e.jsx(en,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:o.file?.name})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[o.parsedData.length," rows found"]})]}),R.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-red-600",children:"Validation Errors"}),e.jsxs("div",{className:"max-h-32 overflow-y-auto space-y-1",children:[R.slice(0,10).map((w,Y)=>e.jsx(Qe,{variant:"destructive",className:"py-2",children:e.jsxs(Ye,{className:"text-xs",children:["Row ",w.row,', Column "',w.column,'": ',w.message]})},Y)),R.length>10&&e.jsxs("p",{className:"text-xs text-gray-500",children:["... and ",R.length-10," more errors"]})]})]}),k.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"font-medium text-yellow-600 flex items-center gap-2",children:[e.jsx(is,{className:"h-4 w-4"}),"Warnings (",k.length,")"]}),e.jsxs("div",{className:"max-h-48 overflow-y-auto space-y-2 border border-yellow-200 rounded-lg p-3 bg-yellow-50",children:[k.slice(0,10).map((w,Y)=>e.jsxs(Qe,{className:"py-2 border-yellow-300 bg-yellow-50",children:[e.jsx(is,{className:"h-4 w-4 text-yellow-600"}),e.jsxs(Ye,{className:"text-sm",children:[e.jsxs("strong",{className:"text-yellow-800",children:["Row ",w.row]})," - ",w.message]})]},Y)),k.length>10&&e.jsxs("p",{className:"text-xs text-yellow-700 font-medium",children:["... and ",k.length-10," more warnings. Please review all warnings before importing."]})]})]}),(O.length>0||o.parsedData.length>0)&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium",children:O.length>0?`Sample Data (First ${Math.min(3,O.length)} rows of ${O.length} valid)`:`Preview Data (First ${Math.min(3,o.parsedData.length)} rows of ${o.parsedData.length} total)`}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-xs border",children:[e.jsx("thead",{children:e.jsx("tr",{className:"bg-gray-50",children:(O.length>0?Object.keys(O[0]||{}):Object.keys(o.parsedData[0]||{})).slice(0,8).filter(w=>!w.startsWith("_")).map(w=>e.jsx("th",{className:"border px-2 py-1 text-left font-medium",children:w},w))})}),e.jsx("tbody",{children:(O.length>0?O:o.parsedData).slice(0,3).map((w,Y)=>e.jsx("tr",{children:Object.keys(w).slice(0,8).filter(_=>!_.startsWith("_")).map(_=>e.jsxs("td",{className:"border px-2 py-1",children:[String(w[_]||"").substring(0,20),String(w[_]||"").length>20&&"..."]},_))},Y))})]})})]}),O.length===0&&k.length>0&&e.jsxs(Qe,{className:"bg-yellow-50 border-yellow-200",children:[e.jsx(is,{className:"h-4 w-4 text-yellow-600"}),e.jsxs(Ye,{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"Note:"})," There are ",k.length,' warning(s) in the import file. Review the warnings above. If the data looks correct despite the warnings, you can still import it by clicking "Import Anyway".']})]}),O.length===0&&k.length===0&&o.parsedData.length>0&&e.jsxs(Qe,{className:"bg-red-50 border-red-200",children:[e.jsx(is,{className:"h-4 w-4 text-red-600"}),e.jsxs(Ye,{className:"text-sm text-red-800",children:[e.jsx("strong",{children:"No valid rows found."})," Please check the validation errors above and fix your data before importing."]})]})]})},F=()=>e.jsxs("div",{className:"space-y-4 text-center",children:[e.jsx(Be,{className:"h-12 w-12 animate-spin mx-auto text-blue-500"}),e.jsx("h3",{className:"text-lg font-medium",children:"Processing Import"}),o.importProgress&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:o.importProgress.message}),e.jsxs("span",{children:[o.importProgress.percentage,"%"]})]}),e.jsx(As,{value:o.importProgress.percentage}),o.importProgress.currentBatch&&o.importProgress.totalBatches&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Processing batch ",o.importProgress.currentBatch," of ",o.importProgress.totalBatches]})]})]}),V=()=>{if(!o.importResult)return null;const{successfulRows:O,failedRows:Q,totalRows:R,errors:k}=o.importResult;return e.jsxs("div",{className:"space-y-4 text-center",children:[e.jsx(tr,{className:"h-12 w-12 mx-auto text-green-500"}),e.jsx("h3",{className:"text-lg font-medium",children:"Import Complete"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{className:"bg-green-50 p-3 rounded-lg",children:[e.jsx("div",{className:"font-medium text-green-600",children:O}),e.jsx("div",{className:"text-green-600",children:"Successful"})]}),e.jsxs("div",{className:"bg-red-50 p-3 rounded-lg",children:[e.jsx("div",{className:"font-medium text-red-600",children:Q}),e.jsx("div",{className:"text-red-600",children:"Failed"})]}),e.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg",children:[e.jsx("div",{className:"font-medium text-blue-600",children:R}),e.jsx("div",{className:"text-blue-600",children:"Total"})]})]}),k.length>0&&e.jsxs("div",{className:"space-y-2 text-left",children:[e.jsx("h4",{className:"font-medium text-red-600",children:"Import Errors"}),e.jsxs("div",{className:"max-h-32 overflow-y-auto space-y-1",children:[k.slice(0,5).map((w,Y)=>e.jsx(Qe,{variant:"destructive",className:"py-2",children:e.jsxs(Ye,{className:"text-xs",children:["Row ",w.row,": ",w.message]})},Y)),k.length>5&&e.jsxs("p",{className:"text-xs text-gray-500",children:["... and ",k.length-5," more errors"]})]})]})]})},U=()=>{switch(o.step){case"upload":return"Import Data";case"preview":return"Review Import Data";case"processing":return"Processing Import";case"complete":return"Import Complete";default:return"Import Data"}},Z=()=>{if(o.step==="preview"&&o.validationResult){const O=o.validationResult.validData.length>0,Q=o.validationResult.errors.filter(R=>R.severity==="error").length===0&&o.validationResult.warnings.length>0;return O||Q}return!1};return e.jsxs(e.Fragment,{children:[e.jsxs($,{variant:i,size:c,className:t,disabled:s,onClick:()=>g(O=>({...O,isOpen:!0})),children:[e.jsx(ga,{className:"h-4 w-4 mr-2"}),"Import"]}),e.jsx(ct,{open:o.isOpen,onOpenChange:O=>{O||b()},children:e.jsxs(nt,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(it,{children:[e.jsx(lt,{children:U()}),e.jsxs(dt,{children:[o.step==="upload"&&"Select a file to import data",o.step==="preview"&&"Review the data before importing",o.step==="processing"&&"Please wait while we process your data",o.step==="complete"&&"Import has been completed"]})]}),e.jsxs("div",{className:"py-4",children:[o.step==="upload"&&E(),o.step==="preview"&&D(),o.step==="processing"&&F(),o.step==="complete"&&V()]}),e.jsxs(ot,{children:[o.step==="upload"&&e.jsx($,{variant:"outline",onClick:b,children:"Cancel"}),o.step==="preview"&&e.jsxs(e.Fragment,{children:[e.jsx($,{variant:"outline",onClick:()=>g(O=>({...O,step:"upload"})),children:"Back"}),e.jsx($,{onClick:N,disabled:!Z(),variant:(o.validationResult?.warnings&&o.validationResult.warnings.length>0,"default"),children:o.validationResult?.warnings&&o.validationResult.warnings.length>0?`Import Anyway (${o.validationResult.validData.length||o.parsedData.length} rows)`:`Import ${o.validationResult?.validData.length||o.parsedData.length||0} Rows`})]}),o.step==="complete"&&e.jsx($,{onClick:b,children:"Close"})]})]})})]})},Mn=u.forwardRef(({className:r,children:t,...s},a)=>e.jsxs(tn,{ref:a,className:me("relative overflow-hidden",r),...s,children:[e.jsx(ki,{className:"h-full w-full rounded-[inherit]",children:t}),e.jsx(On,{}),e.jsx(Ci,{})]}));Mn.displayName=tn.displayName;const On=u.forwardRef(({className:r,orientation:t="vertical",...s},a)=>e.jsx(sn,{ref:a,orientation:t,className:me("flex touch-none select-none transition-colors",t==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",t==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",r),...s,children:e.jsx(Pi,{className:"relative flex-1 rounded-full bg-border"})}));On.displayName=sn.displayName;const ds=({data:r,columns:t,onSort:s,currentSort:a,loading:n=!1,emptyMessage:i="No data available",searchable:c=!0,filterable:p=!1,actions:m=[],onRowClick:o,className:g,maxHeight:b="600px",stickyHeader:x=!0,striped:j=!0,bordered:f=!1,compact:P=!1,selectable:N=!1,selectedRows:T=[],onSelectionChange:A,rowKey:E="id"})=>{const[D,F]=u.useState(""),[V,U]=u.useState({}),Z=u.useMemo(()=>a?[...r].sort((L,ee)=>{const H=L[a.column],de=ee[a.column];let K=0;switch(a.dataType){case"number":K=(Number(H)||0)-(Number(de)||0);break;case"date":const h=new Date(H),d=new Date(de);K=h.getTime()-d.getTime();break;case"boolean":K=H===de?0:H?1:-1;break;default:K=String(H||"").localeCompare(String(de||""))}return a.direction==="desc"?-K:K}):r,[r,a]),O=u.useMemo(()=>{let L=Z;if(D&&c){const ee=D.toLowerCase();L=L.filter(H=>t.some(de=>de.searchable===!1?!1:String(H[de.key]||"").toLowerCase().includes(ee)))}return p&&Object.entries(V).forEach(([ee,H])=>{if(H){const de=H.toLowerCase();L=L.filter(K=>String(K[ee]||"").toLowerCase().includes(de))}}),L},[Z,D,V,t,c,p]),Q=L=>{if(!L.sortable||!s)return;let ee="asc";a?.column===L.key&&(ee=a.direction==="asc"?"desc":"asc"),s({column:L.key,direction:ee,dataType:L.dataType})},R=(L,ee)=>{if(!N||!A)return;const H=L[E];let de=[...T];ee?de.some(K=>K[E]===H)||de.push(L):de=de.filter(K=>K[E]!==H),A(de)},k=L=>{!N||!A||A(L?O:[])},w=L=>N?T.some(ee=>ee[E]===L[E]):!1,Y=()=>!N||O.length===0?!1:O.every(L=>w(L)),_=L=>L.sortable?a?.column===L.key?a.direction==="asc"?e.jsx(Di,{className:"h-4 w-4"}):e.jsx(Ti,{className:"h-4 w-4"}):e.jsx(Ei,{className:"h-4 w-4 opacity-50"}):null,B=(L,ee,H)=>{if(ee.formatter)return ee.formatter(L,H);if(L==null)return e.jsx("span",{className:"text-gray-400",children:"â€”"});switch(ee.dataType){case"boolean":return e.jsx(et,{variant:L?"default":"secondary",children:L?"Yes":"No"});case"date":return Ca(L);case"number":return typeof L=="number"?L.toLocaleString():L;default:return String(L)}},ne=L=>{switch(L){case"center":return"text-center";case"right":return"text-right";default:return"text-left"}};return e.jsxs("div",{className:`space-y-4 ${g}`,children:[(c||p)&&e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4",children:[c&&e.jsxs("div",{className:"relative flex-1",children:[e.jsx(gt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(G,{placeholder:"Search...",value:D,onChange:L=>F(L.target.value),className:"pl-10 text-sm"})]}),p&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ts,{className:"h-4 w-4 text-gray-400 mt-3"}),t.slice(0,3).map(L=>e.jsx(G,{placeholder:`Filter ${L.label}...`,value:V[L.key]||"",onChange:ee=>U(H=>({...H,[L.key]:ee.target.value})),className:"w-40"},L.key))]})]}),D&&e.jsxs("div",{className:"text-sm text-gray-500",children:["Showing ",O.length," of ",r.length," results"]}),e.jsx("div",{className:`rounded-md border ${f?"border-2":""} overflow-hidden`,children:b&&b!=="none"?e.jsx("div",{className:"overflow-x-auto",children:e.jsx(Mn,{style:{maxHeight:b},className:"relative",children:e.jsxs(mt,{className:"min-w-full",children:[e.jsx(ht,{className:x?"sticky top-0 bg-gray-100 z-10":"bg-gray-100",style:x?{position:"sticky",top:0,zIndex:10}:void 0,children:e.jsxs(ke,{children:[N&&e.jsx(J,{className:"w-12",children:e.jsx("input",{type:"checkbox",checked:Y(),onChange:L=>k(L.target.checked),className:"rounded border-gray-300"})}),t.map(L=>e.jsx(J,{className:`${ne(L.align)} ${L.sortable?"cursor-pointer hover:bg-gray-50":""} ${L.headerClassName||""}`,style:{width:L.width},onClick:()=>Q(L),children:e.jsxs("div",{className:`flex items-center gap-2 ${L.align==="right"?"justify-end":L.align==="center"?"justify-center":"justify-start"}`,children:[e.jsx("span",{children:L.label}),_(L)]})},L.key)),m.length>0&&e.jsx(J,{className:"w-12",children:"Actions"})]})}),e.jsx(pt,{children:n?e.jsx(ke,{children:e.jsx(W,{colSpan:t.length+(N?1:0)+(m.length>0?1:0),className:"text-center py-8",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-900"}),"Loading..."]})})}):O.length===0?e.jsx(ke,{children:e.jsx(W,{colSpan:t.length+(N?1:0)+(m.length>0?1:0),className:"text-center py-8 text-gray-500",children:i})}):O.map((L,ee)=>e.jsxs(ke,{className:`
                      ${j&&ee%2===1?"bg-gray-50":""}
                      ${P?"h-10":""}
                      ${o?"cursor-pointer hover:bg-gray-100":""}
                      ${w(L)?"bg-blue-50 border-blue-200":""}
                    `,onClick:()=>o?.(L),children:[N&&e.jsx(W,{children:e.jsx("input",{type:"checkbox",checked:w(L),onChange:H=>{H.stopPropagation(),R(L,H.target.checked)},className:"rounded border-gray-300"})}),t.map(H=>e.jsx(W,{className:`${ne(H.align)} ${H.cellClassName||""} ${H.dataType==="number"&&H.align==="right"?"font-mono tabular-nums":""}`,children:B(L[H.key],H,L)},H.key)),m.length>0&&e.jsx(W,{children:e.jsxs(ya,{children:[e.jsx(va,{asChild:!0,children:e.jsx($,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:H=>H.stopPropagation(),children:e.jsx(sr,{className:"h-4 w-4"})})}),e.jsx(Qs,{align:"end",children:m.map((H,de)=>e.jsxs(Rs,{onClick:K=>{K.stopPropagation(),H.onClick(L)},disabled:H.disabled?.(L),className:H.variant==="destructive"?"text-red-600":"",children:[H.icon&&e.jsx("span",{className:"mr-2",children:H.icon}),H.label]},de))})]})})]},L[E]||ee))})]})})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(mt,{className:"min-w-full",children:[e.jsx(ht,{className:x?"sticky top-0 bg-gray-100 z-10":"bg-gray-100",style:x?{position:"sticky",top:0,zIndex:10}:void 0,children:e.jsxs(ke,{children:[N&&e.jsx(J,{className:"w-12",children:e.jsx("input",{type:"checkbox",checked:Y(),onChange:L=>k(L.target.checked),className:"rounded border-gray-300"})}),t.map(L=>e.jsx(J,{className:`${ne(L.align)} ${L.sortable?"cursor-pointer hover:bg-gray-50":""} ${L.headerClassName||""}`,style:{width:L.width},onClick:()=>Q(L),children:e.jsxs("div",{className:`flex items-center gap-2 ${L.align==="right"?"justify-end":L.align==="center"?"justify-center":"justify-start"}`,children:[e.jsx("span",{children:L.label}),_(L)]})},L.key)),m.length>0&&e.jsx(J,{className:"w-12",children:"Actions"})]})}),e.jsx(pt,{children:n?e.jsx(ke,{children:e.jsx(W,{colSpan:t.length+(N?1:0)+(m.length>0?1:0),className:"text-center py-8",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-900"}),"Loading..."]})})}):O.length===0?e.jsx(ke,{children:e.jsx(W,{colSpan:t.length+(N?1:0)+(m.length>0?1:0),className:"text-center py-8 text-gray-500",children:i})}):O.map((L,ee)=>e.jsxs(ke,{className:`
                      ${j&&ee%2===1?"bg-gray-50":""}
                      ${P?"h-10":""}
                      ${o?"cursor-pointer hover:bg-gray-100":""}
                      ${w(L)?"bg-blue-50 border-blue-200":""}
                    `,onClick:()=>o?.(L),children:[N&&e.jsx(W,{children:e.jsx("input",{type:"checkbox",checked:w(L),onChange:H=>{H.stopPropagation(),R(L,H.target.checked)},className:"rounded border-gray-300"})}),t.map(H=>e.jsx(W,{className:`${ne(H.align)} ${H.cellClassName||""} ${H.dataType==="number"&&H.align==="right"?"font-mono tabular-nums":""}`,children:B(L[H.key],H,L)},H.key)),m.length>0&&e.jsx(W,{children:e.jsxs(ya,{children:[e.jsx(va,{asChild:!0,children:e.jsx($,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:H=>H.stopPropagation(),children:e.jsx(sr,{className:"h-4 w-4"})})}),e.jsx(Qs,{align:"end",children:m.map((H,de)=>e.jsxs(Rs,{onClick:K=>{K.stopPropagation(),H.onClick(L)},disabled:H.disabled?.(L),className:H.variant==="destructive"?"text-red-600":"",children:[H.icon&&e.jsx("span",{className:"mr-2",children:H.icon}),H.label]},de))})]})})]},L[E]||ee))})]})})}),N&&T.length>0&&e.jsxs("div",{className:"flex items-center justify-between bg-blue-50 p-3 rounded-lg",children:[e.jsxs("span",{className:"text-sm text-blue-700",children:[T.length," row",T.length>1?"s":""," selected"]}),e.jsx($,{variant:"outline",size:"sm",onClick:()=>A?.([]),children:"Clear Selection"})]})]})},qs={view:r=>({label:"View",icon:e.jsx(an,{className:"h-4 w-4"}),onClick:r}),edit:r=>({label:"Edit",icon:e.jsx(ss,{className:"h-4 w-4"}),onClick:r}),delete:r=>({label:"Delete",icon:e.jsx(Lt,{className:"h-4 w-4"}),onClick:r,variant:"destructive"})},as=r=>{const[t,s]=st.useState(r),a=st.useCallback(c=>{s(c)},[]),n=st.useCallback(()=>{s(void 0)},[]),i=st.useCallback(c=>t?[...c].sort((p,m)=>{const o=p[t.column],g=m[t.column];let b=0;switch(t.dataType){case"number":b=(Number(o)||0)-(Number(g)||0);break;case"date":const x=new Date(o),j=new Date(g);b=x.getTime()-j.getTime();break;case"boolean":b=o===g?0:o?1:-1;break;default:b=String(o||"").localeCompare(String(g||""))}return t.direction==="desc"?-b:b}):c,[t]);return{currentSort:t,handleSort:a,clearSort:n,getSortedData:i}},Ul=()=>{const[r,t]=u.useState(!1),[s,a]=u.useState(!1),[n,i]=u.useState(null),[c,p]=u.useState(null),[m,o]=u.useState(""),[g,b]=u.useState([]),[x,j]=u.useState("all"),[f,P]=u.useState("all"),[N,T]=u.useState({from:"",to:""}),[A,E]=u.useState(1),[D,F]=u.useState(50),V=xt(),{toast:U}=Fe(),{user:Z,loading:O}=vt(),{config:Q}=Et("purchases"),{validationRules:R,canImport:k}=Rt("purchases"),{currentSort:w,handleSort:Y,getSortedData:_}=as(),[B,ne]=u.useState({purchase_code:"",date:new Date().toISOString().split("T")[0],vendor_id:"",stock_id:"",quantity:"",rate:"",total_amount:""});u.useEffect(()=>{const{quantity:q,rate:je}=B;if(q&&je){const we=parseFloat(q)*parseFloat(je);ne(be=>({...be,total_amount:String(we)}))}else ne(we=>({...we,total_amount:""}))},[B.quantity,B.rate]);const{data:L,isLoading:ee,error:H}=ye({queryKey:["purchases"],queryFn:()=>os.getAll(),enabled:!!Z}),{data:de,isLoading:K,error:h}=ye({queryKey:["vendors"],queryFn:()=>Us.getAll(),enabled:!!Z}),{data:d,isLoading:I,error:C}=ye({queryKey:["stocks"],queryFn:()=>Yt.getAll(),enabled:!!Z}),ae=st.useMemo(()=>de?new Map(de.map(q=>[q.$id,q.vendor_name])):new Map,[de]),Se=st.useMemo(()=>d?new Map(d.map(q=>[q.$id,q.stock_name])):new Map,[d]),ve=st.useMemo(()=>L?L.map(q=>({...q,id:q.$id,vendor_name:ae.get(q.vendor_id)||"Unknown Vendor",stock_name:Se.get(q.stock_id)||"Unknown Stock"})):[],[L,ae,Se]),_e=Ae({mutationFn:q=>c?os.update(c.id,q):os.create(q),onSuccess:()=>{V.invalidateQueries({queryKey:["purchases"]}),t(!1),p(null),U({title:c?"Purchase Updated":"Purchase Created",description:`The purchase has been successfully ${c?"updated":"saved"}.`})},onError:q=>{U({title:"Error",description:q.message||`Failed to ${c?"update":"create"} purchase.`,variant:"destructive"})}}),He=Ae({mutationFn:q=>os.delete(q),onSuccess:()=>{V.invalidateQueries({queryKey:["purchases"]}),U({title:"Purchase Deleted",description:"The purchase has been successfully deleted."})},onError:q=>{U({title:"Error",description:q.message||"Failed to delete purchase.",variant:"destructive"})}}),ze=q=>{i(q),a(!0)},tt=()=>{n&&(He.mutate(n),i(null),a(!1))},bt=q=>{p(q),ne({...q,date:new Date(q.date).toISOString().split("T")[0],quantity:String(q.quantity),rate:String(q.rate),total_amount:String(q.total_amount),vendor_id:q.vendor_id,stock_id:q.stock_id}),t(!0)},Mt=q=>{if(q.preventDefault(),!B.purchase_code||!B.date||!B.vendor_id||!B.stock_id||!B.quantity||!B.rate){U({title:"Missing Fields",description:"Please fill out all required fields.",variant:"destructive"});return}const je={purchase_code:B.purchase_code,date:B.date,vendor_id:B.vendor_id,stock_id:B.stock_id,quantity:parseFloat(B.quantity),rate:parseFloat(B.rate),total_amount:parseFloat(B.total_amount)};_e.mutate(je)},ft=ve.filter(q=>{const je=q.purchase_code.toLowerCase().includes(m.toLowerCase())||q.vendor_name.toLowerCase().includes(m.toLowerCase())||q.stock_name.toLowerCase().includes(m.toLowerCase()),we=x==="all"||q.vendor_id===x,be=f==="all"||q.stock_id===f,yt=new Date(q.date),Re=(!N.from||yt>=new Date(N.from))&&(!N.to||yt<=new Date(N.to));return je&&we&&be&&Re}),jt=st.useMemo(()=>{const q=new Map;return ve.forEach(je=>{q.has(je.vendor_id)||q.set(je.vendor_id,{id:je.vendor_id,name:je.vendor_name})}),Array.from(q.values()).sort((je,we)=>je.name.localeCompare(we.name))},[ve]),Nt=st.useMemo(()=>{const q=new Map;return ve.forEach(je=>{q.has(je.stock_id)||q.set(je.stock_id,{id:je.stock_id,name:je.stock_name})}),Array.from(q.values()).sort((je,we)=>je.name.localeCompare(we.name))},[ve]),wt=ft.length,l=Math.ceil(wt/D),re=(A-1)*D,v=re+D,X=ft.slice(re,v);u.useEffect(()=>{E(1)},[m,x,f,N,D]);const fe=Ae({mutationFn:async q=>{await Promise.all(q.map(je=>os.delete(je)))},onSuccess:()=>{V.invalidateQueries({queryKey:["purchases"]}),b([]),U({title:"Success",description:"Selected purchases deleted successfully."})},onError:()=>{U({title:"Error",description:"Failed to delete selected purchases.",variant:"destructive"})}}),Ne=()=>{if(g.length===0){U({title:"No Selection",description:"Please select purchases to delete.",variant:"destructive"});return}confirm(`Are you sure you want to delete ${g.length} selected purchase(s)?`)&&fe.mutate(g.map(q=>q.id))},Ie=()=>{if(g.length===0){U({title:"No Selection",description:"Please select purchases to export.",variant:"destructive"});return}U({title:"Export",description:`Exporting ${g.length} selected purchase(s)...`})},Le=O||ee||K||I,Me=H||h||C;return Le?e.jsx("div",{children:"Loading..."}):Me?(console.error("Data loading error:",{purchasesError:H,vendorsError:h,stocksError:C}),e.jsx("div",{children:"Error loading data."})):e.jsx("div",{className:"p-4",children:e.jsxs(te,{children:[e.jsx(pe,{children:e.jsxs(xe,{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Purchases"}),e.jsxs($,{onClick:()=>t(!0),children:[e.jsx(Ct,{className:"mr-2 h-4 w-4"})," Add New Purchase"]})]})}),e.jsxs(se,{children:[e.jsx(te,{className:"mb-6",children:e.jsx(se,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(gt,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(G,{placeholder:"Search purchases...",className:"pl-10",value:m,onChange:q=>o(q.target.value)})]}),k&&Q&&e.jsx(qt,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:Q.exportColumns.filter(q=>q.required).map(q=>q.exportHeader),optionalColumns:Q.exportColumns.filter(q=>!q.required).map(q=>q.exportHeader),validationRules:R,maxFileSize:50,existingData:L||[],validationHeaderMapper:q=>{const je=Q.exportColumns.find(we=>we.dataKey===q);return je?je.exportHeader:q},columnMapper:q=>{const je=Q.exportColumns.find(we=>we.exportHeader===q);return je?je.dataKey==="vendorName"?"vendor_name":je.dataKey==="stockName"?"stock_name":{purchaseCode:"purchase_code",date:"date",quantity:"quantity",rate:"rate",totalAmount:"total_amount"}[je.dataKey]||je.dataKey:q},dataProcessor:async q=>{let je=q["Vendor Name"]||q.vendor_name||q.vendor_name||q.vendor_id;if(!je||je==="")throw new Error("Vendor Name is required");const we=String(je).trim(),be=de?.find(ue=>ue.vendor_name.toLowerCase()===we.toLowerCase());if(!be){const ue=de?.map(ge=>ge.vendor_name).slice(0,5).join(", ")||"None";throw new Error(`Vendor "${we}" not found. Available vendors: ${ue}${de&&de.length>5?"...":""}. Please check the vendor name matches exactly.`)}const yt=be.$id;let Re=q["Stock Name"]||q.stock_name||q.stock_name||q.stock_id;if(!Re||Re==="")throw new Error("Stock Name is required");const Pe=String(Re).trim(),Oe=d?.find(ue=>ue.stock_name.toLowerCase()===Pe.toLowerCase());if(!Oe){const ue=d?.map(ge=>ge.stock_name).slice(0,5).join(", ")||"None";throw new Error(`Stock "${Pe}" not found. Available stocks: ${ue}${d&&d.length>5?"...":""}. Please check the stock name matches exactly.`)}const Ke=Oe.$id;let $e=q.date;if($e&&typeof $e=="string"){const ue=$e.match(/^(\d{2})-(\d{2})-(\d{4})$/);if(ue){const[,ge,De,Ee]=ue,qe=new Date(parseInt(Ee),parseInt(De)-1,parseInt(ge));if(isNaN(qe.getTime()))throw new Error(`Invalid date format: ${$e}. Use DD-MM-YYYY format (e.g., 15-01-2024).`);$e=qe.toISOString().split("T")[0]}else{const ge=new Date($e);if(isNaN(ge.getTime()))throw new Error(`Invalid date format: ${$e}. Use DD-MM-YYYY format (e.g., 15-01-2024).`);$e=ge.toISOString().split("T")[0]}}else if($e instanceof Date){if(isNaN($e.getTime()))throw new Error("Invalid date. Use DD-MM-YYYY format (e.g., 15-01-2024).");$e=$e.toISOString().split("T")[0]}let y=q.total_amount;!y&&q.quantity&&q.rate&&(y=parseFloat(q.quantity)*parseFloat(q.rate));const z={purchase_code:q.purchase_code||q.Purchase_Code,date:$e||new Date().toISOString().split("T")[0],vendor_id:yt,stock_id:Ke,quantity:parseFloat(q.quantity||0),rate:parseFloat(q.rate||0),total_amount:parseFloat(y||0)};return await os.create(z)},onImportComplete:async q=>{await V.invalidateQueries({queryKey:["purchases"],refetchType:"active"}),await V.refetchQueries({queryKey:["purchases"]}),q.successfulRows>0&&U({title:"Import Successful",description:`${q.successfulRows} purchases imported successfully.`}),q.failedRows>0&&U({title:"Import Completed with Errors",description:`${q.successfulRows} successful, ${q.failedRows} failed.`,variant:"destructive"})}},variant:"outline"}),Q&&e.jsx(At,{data:ft.map(q=>{const je={};return Q.exportColumns.forEach(we=>{let be;switch(we.dataKey){case"purchaseCode":be=q.purchase_code;break;case"date":be=q.date;break;case"vendorName":be=q.vendor_name;break;case"stockName":be=q.stock_name;break;case"quantity":be=q.quantity;break;case"rate":be=q.rate;break;case"totalAmount":be=q.total_amount;break;case"status":be="Completed";break;default:be=q[we.dataKey]}je[we.exportHeader]=we.formatter?we.formatter(be):be}),je}),headers:Q.exportColumns.map(q=>q.exportHeader),filename:"purchases",variant:"outline"})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs(le,{value:x,onValueChange:j,children:[e.jsx(ie,{className:"w-[180px]",children:e.jsx(ce,{placeholder:"Filter by Vendor"})}),e.jsxs(oe,{children:[e.jsx(S,{value:"all",children:"All Vendors"}),jt.map(q=>e.jsx(S,{value:q.id,children:q.name},q.id))]})]}),e.jsxs(le,{value:f,onValueChange:P,children:[e.jsx(ie,{className:"w-[180px]",children:e.jsx(ce,{placeholder:"Filter by Stock"})}),e.jsxs(oe,{children:[e.jsx(S,{value:"all",children:"All Stocks"}),Nt.map(q=>e.jsx(S,{value:q.id,children:q.name},q.id))]})]}),e.jsx(G,{type:"date",placeholder:"From Date",className:"w-[150px]",value:N.from,onChange:q=>T(je=>({...je,from:q.target.value}))}),e.jsx(G,{type:"date",placeholder:"To Date",className:"w-[150px]",value:N.to,onChange:q=>T(je=>({...je,to:q.target.value}))})]})]})})}),e.jsx(ct,{open:r,onOpenChange:q=>{t(q),q||(p(null),ne({purchase_code:"",date:new Date().toISOString().split("T")[0],vendor_id:"",stock_id:"",quantity:"",rate:"",total_amount:""}))},children:e.jsxs(nt,{className:"sm:max-w-[600px]",children:[e.jsxs(it,{children:[e.jsx(lt,{children:c?"Edit Purchase":"Add New Purchase"}),e.jsx(dt,{children:c?"Update the purchase information below.":"Fill in the details to create a new purchase record."})]}),e.jsxs("form",{onSubmit:Mt,children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 py-4",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"purchase_code",children:"Purchase Code"}),e.jsx(G,{id:"purchase_code",value:B.purchase_code,onChange:q=>ne({...B,purchase_code:q.target.value})})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"date",children:"Date"}),e.jsx(G,{id:"date",type:"date",value:B.date,onChange:q=>ne({...B,date:q.target.value})})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"vendor_id",children:"Vendor"}),e.jsxs(le,{value:B.vendor_id,onValueChange:q=>ne({...B,vendor_id:q}),children:[e.jsx(ie,{id:"vendor_id",children:e.jsx(ce,{placeholder:"Select a vendor"})}),e.jsx(oe,{children:de?.map(q=>e.jsx(S,{value:q.$id,children:q.vendor_name},q.$id))})]})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"stock_id",children:"Stock"}),e.jsxs(le,{value:B.stock_id,onValueChange:q=>ne({...B,stock_id:q}),children:[e.jsx(ie,{id:"stock_id",children:e.jsx(ce,{placeholder:"Select a stock item"})}),e.jsx(oe,{children:d?.map(q=>e.jsx(S,{value:q.$id,children:q.stock_name},q.$id))})]})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"quantity",children:"Quantity"}),e.jsx(G,{id:"quantity",type:"number",value:B.quantity,onChange:q=>ne({...B,quantity:q.target.value})})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"rate",children:"Rate"}),e.jsx(G,{id:"rate",type:"number",value:B.rate,onChange:q=>ne({...B,rate:q.target.value})})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"total_amount",children:"Total Amount"}),e.jsx(G,{id:"total_amount",type:"number",value:B.total_amount,readOnly:!0,className:"bg-gray-100"})]})]}),e.jsx(ot,{children:e.jsx($,{type:"submit",disabled:_e.isPending,children:_e.isPending?"Saving...":c?"Update Purchase":"Create Purchase"})})]})]})}),e.jsx(ct,{open:s,onOpenChange:a,children:e.jsxs(nt,{children:[e.jsx(it,{children:e.jsx(lt,{children:"Are you sure?"})}),e.jsx("div",{className:"py-4",children:e.jsx("p",{children:"This action cannot be undone. This will permanently delete the purchase."})}),e.jsxs(ot,{children:[e.jsx($,{variant:"outline",onClick:()=>a(!1),children:"Cancel"}),e.jsx($,{variant:"destructive",onClick:tt,children:"Delete"})]})]})}),e.jsx(te,{children:e.jsxs(se,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",re+1," to ",Math.min(v,wt)," of ",wt," records"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Records per page:"}),e.jsxs(le,{value:D.toString(),onValueChange:q=>F(Number(q)),children:[e.jsx(ie,{className:"w-[100px]",children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"50",children:"50"}),e.jsx(S,{value:"100",children:"100"}),e.jsx(S,{value:"500",children:"500"})]})]})]})]}),g.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 p-3 bg-muted rounded-md",children:[e.jsxs("span",{className:"text-sm font-medium",children:[g.length," selected"]}),e.jsx($,{variant:"destructive",size:"sm",onClick:Ne,disabled:fe.isPending,children:"Delete Selected"}),e.jsx($,{variant:"outline",size:"sm",onClick:Ie,children:"Export Selected"})]}),e.jsx("div",{className:"border rounded-md",children:e.jsx("div",{className:"overflow-auto",style:{maxHeight:"600px"},children:e.jsx(ds,{data:_(X.map(q=>((!q.date||q.date==="Invalid Date")&&console.warn("Invalid purchase date found:",{id:q.$id,date:q.date,purchase_code:q.purchase_code}),{...q,formattedDate:Ca(q.date),status:"Completed"}))),columns:[{key:"purchase_code",label:"Purchase Code",sortable:!0,dataType:"string"},{key:"formattedDate",label:"Date",sortable:!0,dataType:"date"},{key:"vendor_name",label:"Vendor Name",sortable:!0,dataType:"string"},{key:"stock_name",label:"Stock Name",sortable:!0,dataType:"string"},{key:"quantity",label:"Quantity",sortable:!0,dataType:"number",align:"right",headerClassName:"bg-purple-50",cellClassName:"bg-purple-50 font-medium"},{key:"rate",label:"Rate",sortable:!0,dataType:"number",align:"right"},{key:"total_amount",label:"Total Amount",sortable:!0,dataType:"number",align:"right"},{key:"status",label:"Status",sortable:!0,dataType:"string",formatter:q=>e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${q==="Completed"?"bg-green-100 text-green-800":q==="In Progress"?"bg-yellow-100 text-yellow-800":q==="Pending"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:q})}],onSort:Y,currentSort:w,loading:Le,maxHeight:"none",stickyHeader:!0,bordered:!1,searchable:!1,rowKey:"$id",selectable:!0,selectedRows:g,onSelectionChange:b,actions:[{label:"Edit",onClick:bt,variant:"default"},{label:"Delete",onClick:q=>ze(q.id),variant:"destructive"}],emptyMessage:"No purchases found"})})}),l>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx($,{variant:"outline",size:"sm",onClick:()=>E(q=>Math.max(1,q-1)),disabled:A===1,children:"Previous"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",A," of ",l]})}),e.jsx($,{variant:"outline",size:"sm",onClick:()=>E(q=>Math.min(l,q+1)),disabled:A===l,children:"Next"})]})]})})]})]})})},Un=()=>{const{data:r=[],...t}=ye({queryKey:["preProductionTasks"],queryFn:async()=>ps.getPreProductionTasksWithRelations()});return{tasks:r,...t}},Kn=()=>{const{data:r=[],isLoading:t,error:s,refetch:a}=ye({queryKey:["production_tasks"],queryFn:async()=>await Wt.getProductionTasksWithRelations(),staleTime:12e4,gcTime:6e5,refetchOnWindowFocus:!1,retry:3,retryDelay:n=>Math.min(1e3*2**n,3e4)});return{tasks:r,isLoading:t,error:s,refetch:a}},Kl=()=>{const r=xt(),t=Ae({mutationFn:async({taskData:n,stockItems:i})=>{const c=await Wt.create(n);return i.length>0&&await Promise.all(i.map(p=>Ks.create({production_task_id:c.$id,stock_id:p.stock_id,quantity:p.quantity,action:p.action}))),c},onSuccess:()=>{queueMicrotask(()=>{r.invalidateQueries({queryKey:["production_tasks"]})})},onError:n=>{console.error("Error creating production task:",n)}}),s=Ae({mutationFn:async({id:n,taskData:i,stockItems:c})=>{const p=await Wt.update(n,i);return c&&(await Ks.deleteByProductionTaskId(n),c.length>0&&await Promise.all(c.map(m=>Ks.create({production_task_id:n,stock_id:m.stock_id,quantity:m.quantity,action:m.action})))),p},onSuccess:()=>{queueMicrotask(()=>{r.invalidateQueries({queryKey:["production_tasks"]})})},onError:n=>{console.error("Error updating production task:",n)}}),a=Ae({mutationFn:async n=>(await Ks.deleteByProductionTaskId(n),await Wt.delete(n)),onSuccess:()=>{queueMicrotask(()=>{r.invalidateQueries({queryKey:["production_tasks"]})})},onError:n=>{console.error("Error deleting production task:",n)}});return{createTask:t,updateTask:s,deleteTask:a}},Vn=()=>{const{data:r=[],isLoading:t,error:s,refetch:a}=ye({queryKey:["post_production_tasks"],queryFn:async()=>await es.getPostProductionTasksWithRelations(),staleTime:12e4,gcTime:6e5,refetchOnWindowFocus:!1,retry:3,retryDelay:n=>Math.min(1e3*2**n,3e4)});return{tasks:r,isLoading:t,error:s,refetch:a}},Vl=()=>{const r=xt(),t=Ae({mutationFn:n=>es.create(n),onSuccess:()=>{queueMicrotask(()=>{r.invalidateQueries({queryKey:["post_production_tasks"]})})},onError:n=>{console.error("Error creating post-production task:",n)}}),s=Ae({mutationFn:({id:n,data:i})=>es.update(n,i),onSuccess:()=>{queueMicrotask(()=>{r.invalidateQueries({queryKey:["post_production_tasks"]})})},onError:n=>{console.error("Error updating post-production task:",n)}}),a=Ae({mutationFn:n=>es.delete(n),onSuccess:()=>{queueMicrotask(()=>{r.invalidateQueries({queryKey:["post_production_tasks"]})})},onError:n=>{console.error("Error deleting post-production task:",n)}});return{createTask:t,updateTask:s,deleteTask:a}},Bl=()=>{const{tasks:r}=Un(),{tasks:t}=Kn(),{tasks:s}=Vn(),a=p=>({total:p.length,pending:p.filter(m=>m.status==="pending").length,inProgress:p.filter(m=>m.status==="in_progress").length,completed:p.filter(m=>m.status==="completed").length}),n=a(r),i=a(t),c=a(s);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Tasks Module"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage production tasks across all stages"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs(te,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(pe,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ba,{className:"h-5 w-5 text-primary"}),e.jsx(xe,{children:"Pre-Production Tasks"})]}),e.jsx(Te,{children:"Manage pre-production planning and preparation tasks"})]}),e.jsxs(se,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Track material requisitions, planning approvals, and preparation progress"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-orange-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-orange-700",children:n.pending}),e.jsx("div",{className:"text-orange-600",children:"Pending"})]}),e.jsxs("div",{className:"bg-blue-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-blue-700",children:n.inProgress}),e.jsx("div",{className:"text-blue-600",children:"In Progress"})]}),e.jsxs("div",{className:"bg-green-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-green-700",children:n.completed}),e.jsx("div",{className:"text-green-600",children:"Completed"})]}),e.jsxs("div",{className:"bg-gray-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-gray-700",children:n.total}),e.jsx("div",{className:"text-gray-600",children:"Total"})]})]})]}),e.jsx(Ut,{className:"border-t pt-4",children:e.jsx($,{asChild:!0,className:"w-full",children:e.jsxs(Ft,{to:"/tasks/pre-production",children:["View Pre-Production Tasks",e.jsx(Qt,{className:"ml-2 h-4 w-4"})]})})})]}),e.jsxs(te,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(pe,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(rn,{className:"h-5 w-5 text-primary"}),e.jsx(xe,{children:"Production Tasks"})]}),e.jsx(Te,{children:"Track manufacturing and production progress"})]}),e.jsxs(se,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Monitor work-in-progress, production timelines, and quality checks"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-orange-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-orange-700",children:i.pending}),e.jsx("div",{className:"text-orange-600",children:"Pending"})]}),e.jsxs("div",{className:"bg-blue-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-blue-700",children:i.inProgress}),e.jsx("div",{className:"text-blue-600",children:"In Progress"})]}),e.jsxs("div",{className:"bg-green-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-green-700",children:i.completed}),e.jsx("div",{className:"text-green-600",children:"Completed"})]}),e.jsxs("div",{className:"bg-gray-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-gray-700",children:i.total}),e.jsx("div",{className:"text-gray-600",children:"Total"})]})]})]}),e.jsx(Ut,{className:"border-t pt-4",children:e.jsx($,{asChild:!0,className:"w-full",children:e.jsxs(Ft,{to:"/tasks/production",children:["View Production Tasks",e.jsx(Qt,{className:"ml-2 h-4 w-4"})]})})})]}),e.jsxs(te,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(pe,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ws,{className:"h-5 w-5 text-primary"}),e.jsx(xe,{children:"Post-Production Tasks"})]}),e.jsx(Te,{children:"Track finishing, packaging, and shipping"})]}),e.jsxs(se,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Monitor finishing processes, packaging, and logistics"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-orange-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-orange-700",children:c.pending}),e.jsx("div",{className:"text-orange-600",children:"Pending"})]}),e.jsxs("div",{className:"bg-blue-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-blue-700",children:c.inProgress}),e.jsx("div",{className:"text-blue-600",children:"In Progress"})]}),e.jsxs("div",{className:"bg-green-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-green-700",children:c.completed}),e.jsx("div",{className:"text-green-600",children:"Completed"})]}),e.jsxs("div",{className:"bg-gray-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-gray-700",children:c.total}),e.jsx("div",{className:"text-gray-600",children:"Total"})]})]})]}),e.jsx(Ut,{className:"border-t pt-4",children:e.jsx($,{asChild:!0,className:"w-full",children:e.jsxs(Ft,{to:"/tasks/post-production",children:["View Post-Production Tasks",e.jsx(Qt,{className:"ml-2 h-4 w-4"})]})})})]})]}),e.jsxs(te,{children:[e.jsx(pe,{children:e.jsx(xe,{className:"flex items-center gap-2",children:"Task Management System"})}),e.jsx(se,{children:e.jsx("div",{className:"text-center py-6 text-muted-foreground",children:e.jsx("p",{className:"text-sm",children:"Comprehensive task management across all production stages with real-time tracking and reporting"})})})]})]})},Hl=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Status Module"}),e.jsx("p",{className:"text-muted-foreground",children:"Track real-time status across all production stages"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs(te,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(pe,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ri,{className:"h-5 w-5 text-primary"}),e.jsx(xe,{children:"Stock Status"})]}),e.jsx(Te,{children:"Track raw material and component inventory"})]}),e.jsx(se,{children:e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Monitor stock levels, movements, and availability of raw materials and components"})}),e.jsx(Ut,{className:"border-t pt-4",children:e.jsx($,{asChild:!0,className:"w-full",children:e.jsxs(Ft,{to:"/status/stock-status",children:["View Stock Status",e.jsx(Qt,{className:"ml-2 h-4 w-4"})]})})})]}),e.jsxs(te,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(pe,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ba,{className:"h-5 w-5 text-primary"}),e.jsx(xe,{children:"Pre-production Status"})]}),e.jsx(Te,{children:"Track pre-production planning and preparation"})]}),e.jsx(se,{children:e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Monitor material requisitions, planning approvals, and preparation progress"})}),e.jsx(Ut,{className:"border-t pt-4",children:e.jsx($,{asChild:!0,className:"w-full",children:e.jsxs(Ft,{to:"/status/pre-production-status",children:["View Pre-production Status",e.jsx(Qt,{className:"ml-2 h-4 w-4"})]})})})]}),e.jsxs(te,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(pe,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(rn,{className:"h-5 w-5 text-primary"}),e.jsx(xe,{children:"Production Status"})]}),e.jsx(Te,{children:"Track manufacturing and production progress"})]}),e.jsx(se,{children:e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Monitor work-in-progress, production timelines, and quality checks"})}),e.jsx(Ut,{className:"border-t pt-4",children:e.jsx($,{asChild:!0,className:"w-full",children:e.jsxs(Ft,{to:"/status/production-status",children:["View Production Status",e.jsx(Qt,{className:"ml-2 h-4 w-4"})]})})})]}),e.jsxs(te,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(pe,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ws,{className:"h-5 w-5 text-primary"}),e.jsx(xe,{children:"Post-Production Status"})]}),e.jsx(Te,{children:"Track finishing, packaging, and shipping"})]}),e.jsx(se,{children:e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Monitor finishing processes, packaging, and logistics"})}),e.jsx(Ut,{className:"border-t pt-4",children:e.jsx($,{asChild:!0,className:"w-full",children:e.jsxs(Ft,{to:"/status/post-production-status",children:["View Post-Production Status",e.jsx(Qt,{className:"ml-2 h-4 w-4"})]})})})]}),e.jsxs(te,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(pe,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ys,{className:"h-5 w-5 text-primary"}),e.jsx(xe,{children:"Inventory Status"})]}),e.jsx(Te,{children:"Track overall inventory movements and valuation"})]}),e.jsx(se,{children:e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Monitor opening/closing balances, receiving, issue, and inventory value"})}),e.jsx(Ut,{className:"border-t pt-4",children:e.jsx($,{asChild:!0,className:"w-full",children:e.jsxs(Ft,{to:"/status/inventory-status",children:["View Inventory Status",e.jsx(Qt,{className:"ml-2 h-4 w-4"})]})})})]})]}),e.jsxs(te,{children:[e.jsx(pe,{children:e.jsx(xe,{className:"flex items-center gap-2",children:"Database Connection"})}),e.jsx(se,{children:e.jsx("div",{className:"text-center py-6 text-muted-foreground",children:e.jsx("p",{className:"text-sm",children:"For real-time data tracking and management, ensure your application is connected to Appwrite database"})})})]})]}),Ua={products:["products"],stocks:["stocks"],vendors:["vendors"],staff:["staff"],processes:["processes"],rawProducts:["raw-products"],salesChannels:["sales-channels"],salesUnits:r=>["sales-units",r?.from,r?.to].filter(Boolean),salesRecords:r=>["sales-records",r?.from,r?.to].filter(Boolean),stockStatus:["stock-status"],preProductionStatus:["pre-production-status"],productionStatus:["production-status"],postProductionStatus:["post-production-status"],inventoryStatus:r=>["inventory-status",r?.from,r?.to].filter(Boolean),preProductionTasks:["pre-production-tasks"],productionTasks:["production-tasks"],postProductionTasks:["post-production-tasks"],purchases:["purchases"]},zl=()=>{const{data:r=[]}=ye({queryKey:Ua.salesUnits(),queryFn:()=>zt.getAll(),staleTime:3e5}),{data:t=[]}=ye({queryKey:Ua.salesRecords(),queryFn:()=>Zt.getAll(),staleTime:300*1e3}),s={total:r.length,totalUnits:r.reduce((n,i)=>n+(i.units||0),0),recentEntries:r.filter(n=>{const i=new Date(n.date),c=new Date;return c.setDate(c.getDate()-7),i>=c}).length,uniqueProducts:new Set(r.map(n=>n.product_id)).size},a={total:t.length,totalRevenue:t.reduce((n,i)=>n+(i.sold_units||0)*(i.unit_price||0),0),recentSales:t.filter(n=>{const i=new Date(n.date),c=new Date;return c.setDate(c.getDate()-7),i>=c}).length,totalUnitsSold:t.reduce((n,i)=>n+(i.sold_units||0),0)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Sales Module"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage sales units, records, and finished goods inventory"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(te,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(pe,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ws,{className:"h-5 w-5 text-primary"}),e.jsx(xe,{children:"Sales Units"})]}),e.jsx(Te,{children:"Track batch coding utilization and inventory movement"})]}),e.jsxs(se,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:'Sales units added by user using "Add Form" from "Batch Coding" process in Post Production tasks'}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-purple-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-purple-700",children:s.total}),e.jsx("div",{className:"text-purple-600",children:"Total Entries"})]}),e.jsxs("div",{className:"bg-blue-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-blue-700",children:s.totalUnits.toLocaleString()}),e.jsx("div",{className:"text-blue-600",children:"Total Units"})]}),e.jsxs("div",{className:"bg-green-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-green-700",children:s.recentEntries}),e.jsx("div",{className:"text-green-600",children:"This Week"})]}),e.jsxs("div",{className:"bg-orange-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-orange-700",children:s.uniqueProducts}),e.jsx("div",{className:"text-orange-600",children:"Products"})]})]})]}),e.jsx(Ut,{className:"border-t pt-4",children:e.jsx($,{asChild:!0,className:"w-full",children:e.jsxs(Ft,{to:"/sales/units",children:["View Sales Units",e.jsx(Qt,{className:"ml-2 h-4 w-4"})]})})})]}),e.jsxs(te,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(pe,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Dr,{className:"h-5 w-5 text-primary"}),e.jsx(xe,{children:"Sales Records"})]}),e.jsx(Te,{children:"Track sold units with pricing and revenue"})]}),e.jsxs(se,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:'Total sum of all the "sold units" for the respective SKU in date range in "Sales Record Page"'}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-green-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-green-700",children:a.total}),e.jsx("div",{className:"text-green-600",children:"Total Records"})]}),e.jsxs("div",{className:"bg-blue-50 p-2 rounded text-center",children:[e.jsxs("div",{className:"font-semibold text-blue-700",children:["â‚¹",a.totalRevenue.toLocaleString()]}),e.jsx("div",{className:"text-blue-600",children:"Total Revenue"})]}),e.jsxs("div",{className:"bg-purple-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-purple-700",children:a.recentSales}),e.jsx("div",{className:"text-purple-600",children:"Recent Sales"})]}),e.jsxs("div",{className:"bg-orange-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-orange-700",children:a.totalUnitsSold.toLocaleString()}),e.jsx("div",{className:"text-orange-600",children:"Units Sold"})]})]})]}),e.jsx(Ut,{className:"border-t pt-4",children:e.jsx($,{asChild:!0,className:"w-full",children:e.jsxs(Ft,{to:"/sales/records",children:["View Sales Records",e.jsx(Qt,{className:"ml-2 h-4 w-4"})]})})})]})]}),e.jsxs(te,{children:[e.jsx(pe,{children:e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(Ys,{className:"h-5 w-5 text-primary"}),"Sales Management System"]})}),e.jsx(se,{children:e.jsx("div",{className:"text-center py-6 text-muted-foreground",children:e.jsx("p",{className:"text-sm",children:"Comprehensive sales tracking from batch coding utilization to final revenue with real-time inventory management"})})})]})]})},dr=r=>r.toISOString();function Ql(){const{user:r,loading:t}=vt(),s=cs(),{toast:a}=Fe(),n=xt(),[i,c]=u.useState(void 0),[p,m]=u.useState(!1),[o,g]=u.useState(null),[b,x]=u.useState([]),[j,f]=u.useState("all"),[P,N]=u.useState("all"),[T,A]=u.useState(""),[E,D]=u.useState({from:"",to:""}),[F,V]=u.useState(1),[U,Z]=u.useState(50),{config:O}=Et("sales-units"),{validationRules:Q,canImport:R}=Rt("sales-units"),{currentSort:k,handleSort:w,getSortedData:Y}=as();if(st.useEffect(()=>{o&&p&&(console.log("ðŸ”„ Populating form for edit:",o),X({date:o.date,product_id:o.product_id,sku:o.sku,units:o.units,notes:o.notes||"",dateString:new Date(o.date).toISOString().split("T")[0]}))},[o,p]),t)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Be,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Validating authentication..."})]})});if(!r)return console.error("SalesUnits: User not authenticated, redirecting to login",{location:s.pathname,timestamp:new Date().toISOString(),userAgent:navigator.userAgent}),e.jsx($s,{to:"/login",state:{from:s},replace:!0});st.useEffect(()=>()=>{},[r,s]);const{data:_=[],error:B}=ye({queryKey:["products"],queryFn:async()=>{try{const y=await Vt.getAll();return console.log("ðŸ“¦ Products loaded for sales:",y.map(z=>({id:z.$id,name:z.product||z.product_name,sku:z.sku}))),y}catch(y){throw console.error("SalesUnits: Failed to fetch products",{error:y.message,code:y.code,type:y.type,userId:r?.$id,stack:y.stack}),y}},retry:(y,z)=>z.code===401||z.code===403?!1:y<3}),{data:ne=[]}=ye({queryKey:["post-production-tasks"],queryFn:async()=>{try{return await es.getAll()}catch(y){throw console.error("SalesUnits: Failed to fetch post-production tasks",y),y}},retry:(y,z)=>z.code===401||z.code===403?!1:y<3}),{data:L=[]}=ye({queryKey:["processes"],queryFn:async()=>{try{const y=await ys.getAll();return console.log("ðŸ”§ Processes loaded for sales validation:",y.map(z=>({id:z.$id,name:z.process_name,department:z.department}))),y}catch(y){throw console.error("SalesUnits: Failed to fetch processes",y),y}},staleTime:300*1e3}),{data:ee=[],isLoading:H,error:de}=ye({queryKey:["post-production-status"],queryFn:async()=>{console.log("ðŸš€ Starting post-production status query...");try{const y=await Fl.getAll();return console.log("âœ… Post-production status query successful:",y.length,"records"),console.log("ðŸ“‹ All PostProductionStatus records:",y.map(z=>({product_id:z.product_id,closing_balance:z.closing_balance,status_date:z.status_date}))),y}catch(y){throw console.error("âŒ SalesUnits: Failed to fetch post-production status",{message:y.message,code:y.code,type:y.type,stack:y.stack}),y}},retry:(y,z)=>(console.log(`ðŸ”„ Retrying post-production status query (attempt ${y+1})`),z.code===401||z.code===403?(console.log("ðŸš« Authentication error, not retrying"),!1):y<3),enabled:!!r});st.useEffect(()=>{console.log("ðŸ“Š Post-production status query status:",{isLoading:H,hasError:!!de,dataLength:ee.length,error:de?.message})},[H,de,ee.length]);const K=u.useMemo(()=>{const y=[];return i?.from&&y.push(Ve.greaterThanEqual("date",dr(i.from))),i?.to&&y.push(Ve.lessThanEqual("date",dr(i.to))),y},[i]),{data:h=[],isLoading:d,error:I}=ye({queryKey:["sales-units",i?.from?.toISOString(),i?.to?.toISOString()],queryFn:async()=>{try{return await zt.getAll(K)}catch(y){throw console.error("SalesUnits: Failed to fetch sales units",{error:y.message,code:y.code,type:y.type,queries:K,userId:r?.$id,stack:y.stack}),y}},retry:(y,z)=>z.code===401||z.code===403?!1:y<3});st.useEffect(()=>{I&&(console.error("SalesUnits: Sales units query error detected",I),a({title:"Data Loading Error",description:"Failed to load sales units. Please refresh the page.",variant:"destructive"}))},[I,a]),st.useEffect(()=>{B&&(console.error("SalesUnits: Products query error detected",B),a({title:"Products Loading Error",description:"Failed to load products. Some features may not work properly.",variant:"destructive"}))},[B,a]);const C=Ae({mutationFn:async y=>await be(async()=>await zt.create(y)),onMutate:()=>{if(Ie==="offline")throw a({title:"Offline",description:"You are currently offline. Please check your connection.",variant:"destructive"}),new Error("Network offline")},onError:(y,z)=>{try{throw console.error("SalesUnits: Failed to create sales unit",{error:y.message,code:y.code,type:y.type,payload:z,userId:r?.$id}),y.code===401?(a({title:"Authentication Error",description:"Your session has expired. Please log in again.",variant:"destructive"}),window.location.href="/login",y):y.code===403?(a({title:"Permission Denied",description:"You don't have permission to create sales units.",variant:"destructive"}),y):y.code>=500?(a({title:"Server Error",description:"A server error occurred. Please try again later.",variant:"destructive"}),y):we(y)?(a({title:"Network Error",description:Ie==="offline"?"You appear to be offline. Please check your internet connection.":"Network error occurred. Retrying...",variant:"destructive"}),y):(a({title:"Error",description:y.message||"Failed to create sales unit. Please try again.",variant:"destructive"}),y)}catch(ue){throw console.error("SalesUnits: Error in mutation error handler",ue),ue}},onSuccess:y=>{n.invalidateQueries({queryKey:["sales-units"]}),a({title:"Success",description:"Sales unit created successfully.",duration:3e3}),m(!1);const z={date:new Date().toISOString(),product_id:"",sku:"",units:0,notes:""};X(z),Ne({}),x([]),g(null)}}),ae=Ae({mutationFn:async({id:y,data:z})=>await be(async()=>await zt.update(y,z)),onSuccess:y=>{n.invalidateQueries({queryKey:["sales-units"]}),a({title:"Success",description:"Sales unit updated successfully.",duration:3e3}),m(!1),g(null);const z={date:new Date().toISOString(),product_id:"",sku:"",units:0,notes:""};X(z),Ne({})},onError:y=>{console.error("Failed to update sales unit:",y),a({title:"Error",description:y.message||"Failed to update sales unit. Please try again.",variant:"destructive"})}}),Se=Ae({mutationFn:y=>zt.delete(y),onSuccess:()=>{n.invalidateQueries({queryKey:["sales-units"]}),a({title:"Success",description:"Sales unit deleted successfully."})},onError:()=>{a({title:"Error",description:"Failed to delete sales unit.",variant:"destructive"})}}),ve=Ae({mutationFn:async y=>{await Promise.all(y.map(z=>zt.delete(z)))},onSuccess:()=>{n.invalidateQueries({queryKey:["sales-units"]}),x([]),a({title:"Success",description:"Selected units deleted successfully."})},onError:()=>{a({title:"Error",description:"Failed to delete selected units.",variant:"destructive"})}}),_e=y=>{console.log("ðŸ” Editing sales unit:",y),g(y),m(!0)},He=y=>{confirm("Are you sure you want to delete this sales unit?")&&Se.mutate(y)},ze=()=>{if(b.length===0){a({title:"No Selection",description:"Please select units to delete.",variant:"destructive"});return}confirm(`Are you sure you want to delete ${b.length} selected unit(s)?`)&&ve.mutate(b.map(y=>y.$id))},tt=h.filter(y=>{const z=!T||y.sku.toLowerCase().includes(T.toLowerCase())||y.notes&&y.notes.toLowerCase().includes(T.toLowerCase()),ue=j==="all"||y.product_id===j,ge=P==="all"||y.sku===P,De=new Date(y.date),Ee=(!E.from||De>=new Date(E.from))&&(!E.to||De<=new Date(E.to));return z&&ue&&ge&&Ee}),bt=st.useMemo(()=>{const y=new Map;return h.forEach(z=>{y.has(z.product_id)||y.set(z.product_id,{id:z.product_id,name:_.find(ue=>ue.$id===z.product_id)?.product||z.product_id})}),Array.from(y.values()).sort((z,ue)=>z.name.localeCompare(ue.name))},[h,_]),Mt=st.useMemo(()=>Array.from(new Set(h.map(y=>y.sku))).sort(),[h]),ft=tt.length,jt=Math.ceil(ft/U),Nt=(F-1)*U,wt=Nt+U,l=tt.slice(Nt,wt);st.useEffect(()=>{V(1)},[T,j,P,E,U]);const re=()=>{if(b.length===0){a({title:"No Selection",description:"Please select units to export.",variant:"destructive"});return}a({title:"Export",description:`Exporting ${b.length} selected unit(s)...`})},[v,X]=u.useState({date:new Date().toISOString(),product_id:"",sku:"",units:0,notes:""}),[fe,Ne]=u.useState({}),[Ie,Le]=u.useState("online"),[Me,q]=u.useState(0),je=st.useMemo(()=>{const y={date:new Date().toISOString(),product_id:"",sku:"",units:0,notes:""};return v.product_id!==y.product_id||v.sku!==y.sku||v.units!==y.units||(v.notes||"")!==y.notes||v.dateString&&v.dateString!==new Date().toISOString().split("T")[0]},[v]);st.useEffect(()=>{const y=()=>{Le("online"),a({title:"Connection Restored",description:"Your internet connection has been restored."})},z=()=>{Le("offline"),a({title:"Connection Lost",description:"Please check your internet connection.",variant:"destructive"})};return window.addEventListener("online",y),window.addEventListener("offline",z),Le(navigator.onLine?"online":"offline"),()=>{window.removeEventListener("online",y),window.removeEventListener("offline",z)}},[a]);const we=y=>y.message?.toLowerCase().includes("network")||y.message?.toLowerCase().includes("fetch")||y.message?.toLowerCase().includes("connection")||y.code==="NETWORK_ERROR"||!navigator.onLine,be=async(y,z=3)=>{let ue;for(let ge=1;ge<=z;ge++)try{if(q(ge-1),ge>1){const Ee=Math.min(1e3*Math.pow(2,ge-2),1e4);await new Promise(qe=>setTimeout(qe,Ee))}const De=await y();return q(0),De}catch(De){if(ue=De,console.error(`SalesUnits: Retry attempt ${ge} failed`,{error:De.message,isNetworkError:we(De),attempt:ge,maxRetries:z}),De.code===401||De.code===403||!we(De)&&ge===z)break}throw q(0),ue},yt=(y,z)=>{const ue={...fe};switch(y){case"product_id":z?delete ue.product_id:ue.product_id="Product is required";break;case"sku":z?delete ue.sku:ue.sku="SKU is required";break;case"units":!z||z<=0?ue.units="Units must be greater than 0":delete ue.units;break;case"dateString":z?delete ue.dateString:ue.dateString="Date is required";break}return Ne(ue),Object.keys(ue).length===0},Re=y=>{const z={...v,...y};X(z),Object.keys(y).forEach(ue=>{yt(ue,y[ue])})},Pe=async()=>{try{return r?!0:(a({title:"Session Expired",description:"Please log in again to continue.",variant:"destructive"}),!1)}catch{return a({title:"Session Error",description:"Unable to validate your session. Please log in again.",variant:"destructive"}),!1}},Oe=y=>{console.log("ðŸ” Checking if product has available batch coding units:",y);const z=ee.find(ue=>ue.product_id===y);if(console.log("ðŸ“‹ Post-production status for product:",z),z&&(z.closing_balance||0)>0){const ge=_.find(De=>De.$id===y)?.sku;if(ge){const De=h.filter(qe=>qe.sku===ge).reduce((qe,We)=>qe+(We.units||0),0),Ee=(z.closing_balance||0)-De;return console.log(`ðŸ“Š Availability using stored balance for ${ge}:`,{storedBalance:z.closing_balance,soldUnits:De,available:Ee}),Ee>0}}else{console.log("âš ï¸ No stored balance, checking completed batch coding tasks...");const ue=ne.filter(ge=>{const Ee=L.find(qe=>qe.$id===ge.process_id)?.process_name?.toLowerCase()==="batch coding";return ge.product_id===y&&ge.status==="completed"&&Ee});return console.log(`ðŸ“Š Found ${ue.length} completed batch coding tasks for product`),ue.length>0}return!1},Ke=(y,z,ue)=>{console.log("ðŸ” Getting available batch coding units:",{productId:y,sku:z,excludeRecordId:ue});const ge=_.find(We=>We.$id===y),De=ge?.sku;if(!ge||!De)return console.log("âš ï¸ Product not found or has no SKU:",{productId:y,productSku:De}),0;if(De!==z)return console.log("âš ï¸ SKU mismatch - requested SKU does not belong to this product:",{productId:y,requestedSku:z,productSku:De}),0;const Ee=ee.find(We=>We.product_id===y);console.log("ðŸŽ¯ PostProductionStatus record found for product:",Ee);let qe=0;if(Ee&&Ee.closing_balance!==void 0&&Ee.closing_balance!==null){const We=Ee.closing_balance||0;console.log("âœ… Using stored closing balance:",We);const ns=ue?h.filter(ut=>ut.sku===z&&ut.$id===ue).reduce((ut,Ze)=>ut+(Ze.units||0),0):0;qe=Math.max(0,We+ns)}else{console.log("âš ï¸ No stored closing balance found, calculating from completed tasks...");const We=ne.filter(Ze=>{const Ot=L.find(Qn=>Qn.$id===Ze.process_id),bs=Ot?.process_name?.toLowerCase()==="batch coding",Ls=Ze.product_id===y&&Ze.status==="completed"&&bs;return Ze.product_id===y&&console.log(`ðŸ” Task ${Ze.task_id}:`,{processId:Ze.process_id,processName:Ot?.process_name,isBatchCoding:bs,status:Ze.status,matches:Ls}),Ls});if(console.log("ðŸ“Š Completed batch coding tasks found:",We.length),We.length===0)return console.log("âš ï¸ No completed batch coding tasks found for this product"),0;const ns=We.reduce((Ze,Ot)=>{const bs=Ot.completed_quantity!==void 0&&Ot.completed_quantity!==null?Number(Ot.completed_quantity):Number(Ot.units)||0;return Ze+bs},0),ut=h.filter(Ze=>Ze.sku===z&&Ze.$id!==ue).reduce((Ze,Ot)=>Ze+(Ot.units||0),0);qe=Math.max(0,ns-ut),console.log("ðŸ“Š Calculated availability:",{totalCompletedUnits:ns,soldUnits:ut,availableUnits:qe})}return console.log("ðŸ“ˆ Final availability calculation:",{productId:y,sku:z,availableUnits:qe,excludedRecordId:ue,method:Ee?.closing_balance!==void 0?"stored_balance":"calculated_from_tasks"}),qe},$e=async y=>{if(y.preventDefault(),!await Pe()){console.error("SalesUnits: Session validation failed, aborting form submission");return}if(!v.product_id||!v.sku||!v.units||!v.dateString||v.product_id==="no-products"||v.sku==="no-skus"){a({title:"Validation Error",description:"Please fill all required fields: Product, SKU, Units, and Date.",variant:"destructive"});return}if(v.units<=0){a({title:"Validation Error",description:"Units must be greater than 0.",variant:"destructive"});return}const ue=Ke(v.product_id,v.sku,o?.$id);if(console.log("ðŸ”„ Edit Mode Validation Check:",{isEditing:!!o,editingRecordId:o?.$id,requestedUnits:v.units,availableUnits:ue,sku:v.sku,shouldTriggerValidation:v.units>ue}),v.units>ue){console.log("ðŸš¨ SALES UNITS VALIDATION TRIGGERED:",{requestedUnits:v.units,availableUnits:ue,productId:v.product_id,sku:v.sku}),console.log("ðŸ”„ Showing custom Sales Units validation dialog");const ge={isValid:!1,currentProcess:"sales_units",sourceProcess:"batch_coding",availableQuantity:ue,requiredQuantity:v.units,warningMessage:`Insufficient batch coding units. Available: ${ue} units, Requested: ${v.units} units`,suggestions:[`Reduce quantity to ${ue} units or less`,"Complete more batch coding tasks to increase availability","Check batch coding status for current availability"]};console.log("ðŸ“‹ Custom Validation Data Created:",ge),console.log("ðŸ§¹ Clearing regular validation state before showing custom dialog")}try{const ge={date:v.dateString?new Date(v.dateString).toISOString():v.date,product_id:v.product_id,sku:v.sku,units:v.units,notes:v.notes||void 0};o?ae.mutate({id:o.$id,data:ge}):C.mutate(ge)}catch(ge){console.error("SalesUnits: Form submission error",ge),a({title:"Error",description:"Failed to submit form. Please try again.",variant:"destructive"})}};return e.jsx("div",{className:"p-4",children:e.jsxs(te,{children:[e.jsx(pe,{children:e.jsxs(xe,{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Sales Units"}),e.jsxs("div",{className:"flex gap-2",children:[R&&O&&e.jsx(qt,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:O.exportColumns.filter(y=>y.required).map(y=>y.exportHeader),optionalColumns:O.exportColumns.filter(y=>!y.required).map(y=>y.exportHeader),validationRules:Q,maxFileSize:50,existingData:h||[],validationHeaderMapper:y=>{const z=O.exportColumns.find(ue=>ue.dataKey===y);return z?z.exportHeader:y},columnMapper:y=>{const z=O.exportColumns.find(ue=>ue.exportHeader===y);return z?z.dataKey==="productName"?"product_name":z.dataKey==="sku"?"sku":{date:"date",units:"units",status:"status",remarks:"remarks"}[z.dataKey]||z.dataKey:y},dataProcessor:async y=>{let z=y.Product||y.product_name||y.product_name,ue=y.SKU||y.sku||y.sku;if(!z||z==="")throw new Error("Product is required");const ge=String(z).trim(),De=_?.find(ut=>ut.product&&ut.product.toLowerCase()===ge.toLowerCase()||ut.sku&&ut.sku.toLowerCase()===(ue||"").toLowerCase());if(!De){const ut=_?.map(Ze=>Ze.product||Ze.sku).slice(0,5).join(", ")||"None";throw new Error(`Product "${ge}" not found. Available: ${ut}`)}const Ee=De.$id,qe=ue||De.sku||"";let We=y.Date||y.date||y.date||new Date().toISOString().split("T")[0];if(We&&typeof We=="string"){const ut=We.match(/^(\d{2})-(\d{2})-(\d{4})$/);if(ut){const[,Ze,Ot,bs]=ut,Ls=new Date(parseInt(bs),parseInt(Ot)-1,parseInt(Ze));isNaN(Ls.getTime())||(We=Ls.toISOString().split("T")[0])}else{const Ze=new Date(We);isNaN(Ze.getTime())||(We=Ze.toISOString().split("T")[0])}}else We instanceof Date&&(We=We.toISOString().split("T")[0]);const ns={date:We,product_id:Ee,sku:qe,units:parseFloat(y.Units||y.units||y.units||0),notes:y.Remarks||y.remarks||y.remarks||""};return await zt.create(ns)},onImportComplete:async y=>{await n.invalidateQueries({queryKey:["sales-units"],refetchType:"active"}),await n.refetchQueries({queryKey:["sales-units"]}),y.successfulRows>0&&a({title:"Import Successful",description:`${y.successfulRows} sales units imported successfully.`}),y.failedRows>0&&a({title:"Import Completed with Errors",description:`${y.successfulRows} successful, ${y.failedRows} failed.`,variant:"destructive"})}},variant:"outline"}),O&&e.jsx(At,{data:h.map(y=>{const z={};return O.exportColumns.forEach(ue=>{let ge;switch(ue.dataKey){case"date":ge=y.date;break;case"productName":ge=_.find(De=>De.$id===y.product_id)?.product||y.product_id;break;case"sku":ge=y.sku;break;case"units":ge=y.units;break;case"status":ge="Completed";break;case"remarks":ge=y.notes||"";break;default:ge=y[ue.dataKey]}z[ue.exportHeader]=ue.formatter?ue.formatter(ge):ge}),z}),headers:O.exportColumns.map(y=>y.exportHeader),filename:"sales-units",variant:"outline"}),e.jsxs($,{onClick:()=>m(!0),children:[e.jsx(Ct,{className:"mr-2 h-4 w-4"})," Add New Units"]})]})]})}),e.jsxs(se,{children:[e.jsx(te,{className:"mb-6",children:e.jsx(se,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex flex-wrap gap-4 items-center",children:e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(gt,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(G,{placeholder:"Search units...",className:"pl-10",value:T,onChange:y=>A(y.target.value)})]})}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs(le,{value:j,onValueChange:f,children:[e.jsx(ie,{className:"w-[180px]",children:e.jsx(ce,{placeholder:"Filter by Product"})}),e.jsxs(oe,{children:[e.jsx(S,{value:"all",children:"All Products"}),bt.map(y=>e.jsx(S,{value:y.id,children:y.name},y.id))]})]}),e.jsxs(le,{value:P,onValueChange:N,children:[e.jsx(ie,{className:"w-[180px]",children:e.jsx(ce,{placeholder:"Filter by SKU"})}),e.jsxs(oe,{children:[e.jsx(S,{value:"all",children:"All SKUs"}),Mt.map(y=>e.jsx(S,{value:y,children:y},y))]})]}),e.jsx(G,{type:"date",placeholder:"From Date",className:"w-[150px]",value:E.from,onChange:y=>D(z=>({...z,from:y.target.value}))}),e.jsx(G,{type:"date",placeholder:"To Date",className:"w-[150px]",value:E.to,onChange:y=>D(z=>({...z,to:y.target.value}))})]})]})})}),e.jsx(ct,{open:p,onOpenChange:y=>{if(!y&&(C.isPending||ae.isPending)){a({title:"Please wait",description:"Form is being submitted. Please wait for completion.",variant:"destructive"});return}if(!(!y&&je&&!(C.isPending||ae.isPending)&&!window.confirm("You have unsaved changes. Are you sure you want to close without saving?"))&&(m(y),!y)){const z={date:new Date().toISOString(),product_id:"",sku:"",units:0,notes:""};X(z),Ne({}),g(null)}},children:e.jsxs(nt,{className:"sm:max-w-[600px] max-w-[95vw] max-h-[90vh] overflow-y-auto",children:[e.jsxs(it,{children:[e.jsxs(lt,{className:"flex items-center gap-2",children:[o?"Edit Sales Unit":"Add New Sales Unit",je&&e.jsx("span",{className:"text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded",children:"Unsaved changes"})]}),e.jsx(dt,{children:"Enter sales unit details below."}),_.filter(y=>Oe(y.$id)).length===0&&e.jsxs("div",{className:"mt-2 p-3 bg-yellow-50 border border-yellow-200 rounded text-sm text-yellow-800",children:[e.jsx("strong",{children:"âš ï¸ No products available:"})," All products either have no completed batch coding units or all units have been sold."]})]}),e.jsxs("form",{onSubmit:$e,children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 py-4",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"date",children:"Date *"}),e.jsx(G,{id:"date",type:"date",value:v.dateString||"",onChange:y=>Re({dateString:y.target.value}),className:fe.dateString?"border-red-500":""}),fe.dateString&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:fe.dateString})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"product",children:"Product *"}),e.jsxs(le,{value:v.product_id,onValueChange:y=>Re({product_id:y,sku:_.find(z=>z.$id===y)?.sku||v.sku}),children:[e.jsx(ie,{id:"product",className:fe.product_id?"border-red-500":"",children:e.jsx(ce,{placeholder:"Select Product"})}),e.jsxs(oe,{children:[_.filter(y=>{const z=ee.find(ge=>ge.product_id===y.$id);let ue=!1;return z&&(z.closing_balance||0)>0?ue=!0:y.sku&&(ue=ne.filter(Ee=>Ee.product_id===y.$id&&Ee.status==="completed").length>0),console.log("ðŸ” Product filtering for sales:",{productId:y.$id,productName:y.product||y.product_name,sku:y.sku,postProdStatusFound:!!z,storedClosingBalance:z?.closing_balance,hasCompletedTasks:ne.filter(ge=>ge.product_id===y.$id&&ge.status==="completed").length>0,finalDecision:ue}),ue}).map(y=>e.jsx(S,{value:y.$id,children:y.product||y.$id},y.$id)),_.filter(y=>{const z=ee.find(ge=>ge.product_id===y.$id);return z&&(z.closing_balance||0)>0?!0:y.sku?ne.filter(De=>De.product_id===y.$id&&De.status==="completed").length>0:!1}).length===0&&e.jsx(S,{value:"no-products",disabled:!0,children:"No products with available batch coding units"})]})]}),fe.product_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:fe.product_id})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"sku",children:"SKU *"}),e.jsxs(le,{value:v.sku,onValueChange:y=>Re({sku:y}),children:[e.jsx(ie,{id:"sku",className:fe.sku?"border-red-500":"",children:e.jsx(ce,{placeholder:"Select SKU"})}),e.jsxs(oe,{children:[(()=>{if(!v.product_id)return[];const y=_.find(De=>De.$id===v.product_id);if(!y||!y.sku)return[];const z=y.sku,ue=Ke(v.product_id,z,o?.$id),ge=o&&z===o.sku;return ue>0||ge?[y]:[]})().map(y=>{const z=y.sku,ue=Ke(v.product_id,z,o?.$id),ge=o&&z===o.sku;return e.jsxs(S,{value:z,children:[z,y.product?` â€” ${y.product}`:"",e.jsxs("span",{className:`text-xs ml-2 ${ue>0?"text-gray-500":"text-red-500"}`,children:["(",ue," available",ge&&ue===0?" - Current":"",")"]})]},y.$id)}),v.product_id&&(()=>{const y=_.find(De=>De.$id===v.product_id);if(!y||!y.sku)return!0;const z=y.sku,ue=Ke(v.product_id,z,o?.$id),ge=o&&z===o.sku;return ue===0&&!ge})()&&e.jsx(S,{value:"no-skus",disabled:!0,children:"No SKUs with available batch coding units for this product"})]})]}),fe.sku&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:fe.sku}),v.product_id&&v.sku&&e.jsxs("div",{className:"mt-2 p-2 bg-blue-50 border border-blue-200 rounded text-sm",children:[e.jsx("span",{className:"text-blue-700 font-medium",children:"Available Batch Coding Units:"}),e.jsxs("span",{className:"text-blue-800 font-bold",children:[Ke(v.product_id,v.sku,o?.$id)," units"]})]})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"units",children:"Units *"}),e.jsx(G,{id:"units",type:"number",min:"1",value:v.units,onChange:y=>Re({units:Number(y.target.value)}),className:fe.units?"border-red-500":""}),fe.units&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:fe.units})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(M,{htmlFor:"notes",children:"Remarks"}),e.jsx(G,{id:"notes",type:"text",value:v.notes||"",onChange:y=>Re({notes:y.target.value})})]})]}),e.jsxs(ot,{className:"flex-col sm:flex-row gap-2 pt-4",children:[e.jsx($,{type:"button",variant:"outline",onClick:()=>m(!1),className:"w-full sm:w-auto",children:"Cancel"}),e.jsx($,{type:"submit",disabled:C.isPending||ae.isPending||Object.keys(fe).length>0,className:"w-full sm:w-auto",children:C.isPending||ae.isPending?e.jsxs(e.Fragment,{children:[e.jsx(Be,{className:"mr-2 h-4 w-4 animate-spin"}),"Savingâ€¦"]}):o?"Update Sales Unit":"Add Sales Unit"})]})]})]})}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{placeholder:"Search units...",value:T,onChange:y=>A(y.target.value),className:"max-w-sm"}),e.jsxs(le,{value:j,onValueChange:f,children:[e.jsx(ie,{className:"w-[180px]",children:e.jsx(ce,{placeholder:"Filter by Product"})}),e.jsxs(oe,{children:[e.jsx(S,{value:"all",children:"All Products"}),_.map(y=>e.jsx(S,{value:y.$id,children:y.product||y.$id},y.$id))]})]}),e.jsx(js,{value:i,onChange:c})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[Ie==="offline"&&e.jsxs("div",{className:"flex items-center gap-1 text-red-600 text-sm",children:[e.jsx("div",{className:"w-2 h-2 bg-red-600 rounded-full"}),"Offline"]}),Me>0&&e.jsxs("div",{className:"flex items-center gap-1 text-yellow-600 text-sm",children:[e.jsx(Be,{className:"h-3 w-3 animate-spin"}),"Retrying... (",Me,")"]})]})]}),e.jsx(te,{children:e.jsxs(se,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",Nt+1," to ",Math.min(wt,ft)," of ",ft," records"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Records per page:"}),e.jsxs(le,{value:U.toString(),onValueChange:y=>Z(Number(y)),children:[e.jsx(ie,{className:"w-[100px]",children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"50",children:"50"}),e.jsx(S,{value:"100",children:"100"}),e.jsx(S,{value:"500",children:"500"})]})]})]})]}),b.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 p-3 bg-muted rounded-md",children:[e.jsxs("span",{className:"text-sm font-medium",children:[b.length," selected"]}),e.jsx($,{variant:"destructive",size:"sm",onClick:ze,disabled:ve.isPending,children:"Delete Selected"}),e.jsx($,{variant:"outline",size:"sm",onClick:re,children:"Export Selected"})]}),e.jsx("div",{className:"border rounded-md",children:e.jsx("div",{className:"overflow-auto",style:{maxHeight:"600px"},children:e.jsx(ds,{data:Y(l.map(y=>((!y.date||y.date==="Invalid Date")&&console.warn("Invalid sales unit date found:",{id:y.$id,date:y.date}),{...y,productName:_.find(z=>z.$id===y.product_id)?.product||y.product_id,formattedDate:Ca(y.date),status:"Completed"}))),columns:[{key:"formattedDate",label:"Date",sortable:!0,dataType:"date"},{key:"productName",label:"Product",sortable:!0,dataType:"string"},{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"units",label:"Units",sortable:!0,dataType:"number",align:"right",headerClassName:"bg-purple-50",cellClassName:"bg-purple-50 font-medium"},{key:"status",label:"Status",sortable:!0,dataType:"string",formatter:y=>e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${y==="Completed"?"bg-green-100 text-green-800":y==="In Progress"?"bg-yellow-100 text-yellow-800":y==="Pending"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:y})},{key:"notes",label:"Remarks",sortable:!0,dataType:"string"}],onSort:w,currentSort:k,loading:d,maxHeight:"none",stickyHeader:!0,bordered:!1,searchable:!1,rowKey:"$id",selectable:!0,selectedRows:b,onSelectionChange:x,actions:[{label:"Edit",onClick:_e,variant:"default"},{label:"Delete",onClick:y=>He(y.$id),variant:"destructive"}],emptyMessage:"No sales units found"})})}),jt>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx($,{variant:"outline",size:"sm",onClick:()=>V(y=>Math.max(1,y-1)),disabled:F===1,children:"Previous"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",F," of ",jt]})}),e.jsx($,{variant:"outline",size:"sm",onClick:()=>V(y=>Math.min(jt,y+1)),disabled:F===jt,children:"Next"})]})]})})]})]})})}const ur=r=>r.toISOString();function Yl(){const{user:r,loading:t}=vt(),s=cs(),{toast:a}=Fe(),n=xt(),[i,c]=u.useState(void 0),[p,m]=u.useState(!1),[o,g]=u.useState(null),[b,x]=u.useState([]),[j,f]=u.useState("all"),[P,N]=u.useState("all"),[T,A]=u.useState("all"),[E,D]=u.useState(""),[F,V]=u.useState({from:"",to:""}),[U,Z]=u.useState(1),[O,Q]=u.useState(50),{config:R}=Et("sales-record"),{validationRules:k,canImport:w}=Rt("sales-record"),{currentSort:Y,handleSort:_,getSortedData:B}=as();if(st.useEffect(()=>{o&&p&&(console.log("ðŸ”„ Populating form for edit:",o),I({date:o.date,sales_channel_id:o.sales_channel_id,product_id:o.product_id,sku:o.sku,sold_units:o.sold_units,unit_price:o.unit_price,total_price:o.total_price,notes:o.notes||"",dateString:new Date(o.date).toISOString().split("T")[0]}))},[o,p]),t)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Be,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Validating authentication..."})]})});if(!r)return console.error("SalesRecord: User not authenticated, redirecting to login"),e.jsx($s,{to:"/login",state:{from:s},replace:!0});const{data:ne=[]}=ye({queryKey:["products"],queryFn:()=>Vt.getAll()}),{data:L=[]}=ye({queryKey:["sales-channels"],queryFn:()=>Ps.getAll()}),ee=u.useMemo(()=>{const v=[];return i?.from&&v.push(Ve.greaterThanEqual("date",ur(i.from))),i?.to&&v.push(Ve.lessThanEqual("date",ur(i.to))),v},[i]),{data:H=[],isLoading:de}=ye({queryKey:["sales-records",i?.from?.toISOString(),i?.to?.toISOString()],queryFn:()=>Zt.getAll(ee)}),K=Ae({mutationFn:async v=>{try{return await Zt.create(v)}catch(X){throw console.error("SalesRecord: Failed to create sales record",{error:X.message,code:X.code,type:X.type,payload:v,userId:r?.$id}),X.code===401?(a({title:"Authentication Error",description:"Your session has expired. Please log in again.",variant:"destructive"}),window.location.href="/login",X):X.code===403?(a({title:"Permission Denied",description:"You don't have permission to create sales records.",variant:"destructive"}),X):(a({title:"Error",description:X.message||"Failed to create sales record. Please try again.",variant:"destructive"}),X)}},onSuccess:v=>{n.invalidateQueries({queryKey:["sales-records"]}),a({title:"Success",description:"Sales record created successfully.",duration:3e3}),m(!1),x([]),I({date:new Date().toISOString(),sales_channel_id:"",product_id:"",sku:"",sold_units:0,unit_price:0,total_price:0,notes:""}),g(null)}}),h=Ae({mutationFn:async({id:v,data:X})=>await Zt.update(v,X),onSuccess:v=>{n.invalidateQueries({queryKey:["sales-records"]}),a({title:"Success",description:"Sales record updated successfully.",duration:3e3}),m(!1),g(null),I({date:new Date().toISOString(),sales_channel_id:"",product_id:"",sku:"",sold_units:0,unit_price:0,total_price:0,notes:""})},onError:v=>{console.error("Failed to update sales record:",v),a({title:"Error",description:v.message||"Failed to update sales record. Please try again.",variant:"destructive"})}}),[d,I]=u.useState({date:new Date().toISOString(),sales_channel_id:"",product_id:"",sku:"",sold_units:0,unit_price:0,total_price:0,notes:""}),C=Ae({mutationFn:v=>Zt.delete(v),onSuccess:()=>{n.invalidateQueries({queryKey:["sales-records"]}),a({title:"Success",description:"Sales record deleted successfully."})},onError:()=>{a({title:"Error",description:"Failed to delete sales record.",variant:"destructive"})}}),ae=Ae({mutationFn:async v=>{await Promise.all(v.map(X=>Zt.delete(X)))},onSuccess:()=>{n.invalidateQueries({queryKey:["sales-records"]}),x([]),a({title:"Success",description:"Selected records deleted successfully."})},onError:()=>{a({title:"Error",description:"Failed to delete selected records.",variant:"destructive"})}}),Se=v=>{console.log("ðŸ” Editing sales record:",v),g(v),m(!0)},ve=v=>{confirm("Are you sure you want to delete this sales record?")&&C.mutate(v)},_e=()=>{if(b.length===0){a({title:"No Selection",description:"Please select records to delete.",variant:"destructive"});return}confirm(`Are you sure you want to delete ${b.length} selected record(s)?`)&&ae.mutate(b.map(v=>v.$id))},He=()=>{if(b.length===0){a({title:"No Selection",description:"Please select records to export.",variant:"destructive"});return}a({title:"Export",description:`Exporting ${b.length} selected record(s)...`})},ze=H.filter(v=>{const X=!E||v.sku.toLowerCase().includes(E.toLowerCase())||v.notes&&v.notes.toLowerCase().includes(E.toLowerCase()),fe=j==="all"||v.sales_channel_id===j,Ne=P==="all"||v.product_id===P,Ie=T==="all"||v.sku===T,Le=new Date(v.date),Me=(!F.from||Le>=new Date(F.from))&&(!F.to||Le<=new Date(F.to));return X&&fe&&Ne&&Ie&&Me}),tt=st.useMemo(()=>{const v=new Map;return H.forEach(X=>{v.has(X.sales_channel_id)||v.set(X.sales_channel_id,{id:X.sales_channel_id,name:L.find(fe=>fe.$id===X.sales_channel_id)?.channel_name||X.sales_channel_id})}),Array.from(v.values()).sort((X,fe)=>X.name.localeCompare(fe.name))},[H,L]),bt=st.useMemo(()=>{const v=new Map;return H.forEach(X=>{v.has(X.product_id)||v.set(X.product_id,{id:X.product_id,name:ne.find(fe=>fe.$id===X.product_id)?.product||X.product_id})}),Array.from(v.values()).sort((X,fe)=>X.name.localeCompare(fe.name))},[H,ne]),Mt=st.useMemo(()=>Array.from(new Set(H.map(v=>v.sku))).sort(),[H]),ft=ze.length,jt=Math.ceil(ft/O),Nt=(U-1)*O,wt=Nt+O,l=ze.slice(Nt,wt);u.useEffect(()=>{Z(1)},[E,j,P,T,F,O]);const re=v=>{if(v.preventDefault(),!d.sales_channel_id||!d.product_id||!d.sku||!d.sold_units||!d.unit_price||!d.dateString){a({title:"Validation Error",description:"Please fill all required fields: Date, Sales Channel, Product, SKU, Quantity, and Rate.",variant:"destructive"});return}if(d.sold_units<=0){a({title:"Validation Error",description:"Quantity must be greater than 0.",variant:"destructive"});return}if(d.unit_price<=0){a({title:"Validation Error",description:"Rate must be greater than 0.",variant:"destructive"});return}const X={date:d.dateString?new Date(d.dateString).toISOString():d.date,sales_channel_id:d.sales_channel_id,product_id:d.product_id,sku:d.sku,sold_units:d.sold_units,unit_price:d.unit_price,total_price:Number((d.sold_units*d.unit_price).toFixed(2)),notes:d.notes||void 0};o?h.mutate({id:o.$id,data:X}):K.mutate(X)};return e.jsx("div",{className:"p-4",children:e.jsxs(te,{children:[e.jsx(pe,{children:e.jsxs(xe,{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Sales Records"}),e.jsxs("div",{className:"flex gap-2",children:[w&&R&&e.jsx(qt,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:R.exportColumns.filter(v=>v.required).map(v=>v.exportHeader),optionalColumns:R.exportColumns.filter(v=>!v.required).map(v=>v.exportHeader),validationRules:k,maxFileSize:50,existingData:H||[],validationHeaderMapper:v=>{const X=R.exportColumns.find(fe=>fe.dataKey===v);return X?X.exportHeader:v},columnMapper:v=>{const X=R.exportColumns.find(fe=>fe.exportHeader===v);return X?X.dataKey==="channelName"?"channel_name":X.dataKey==="productName"?"product_name":X.dataKey==="sku"?"sku":{date:"date",qty:"sold_units",rate:"unit_price",totalAmount:"total_amount",status:"status",remarks:"remarks"}[X.dataKey]||X.dataKey:v},dataProcessor:async(v,X)=>{console.log("ðŸ“ [SalesRecord] dataProcessor CALLED"),console.log("ðŸ“ [SalesRecord] Row data:",JSON.stringify(v,null,2));let fe=v["Sales Channel"]||v.channel_name||v.channel_name||v["Sales Channel Name"];if(console.log("ðŸ“ [SalesRecord] Channel name from row:",fe),!fe||fe==="")throw new Error("Sales Channel is required");const Ne=String(fe).trim(),Ie=L?.find(Ee=>Ee.channel_name.toLowerCase()===Ne.toLowerCase());if(!Ie){const Ee=L?.map(qe=>qe.channel_name).slice(0,5).join(", ")||"None";throw new Error(`Sales Channel "${Ne}" not found. Available channels: ${Ee}${L&&L.length>5?"...":""}. Please check the channel name matches exactly.`)}const Le=Ie.$id;let Me=v.Product||v.product_name||v.product_name,q=v.SKU||v.sku||v.sku;if(!Me||Me==="")throw new Error("Product is required");let je="";if(q&&typeof q=="string"){const Ee=q.trim(),qe=Ee.match(/^([^â€”\-]+?)(\s*[â€”\-]\s*|$)/);qe?je=qe[1].trim():je=Ee}else je=String(q||"").trim();const we=String(Me).trim();let be=ne?.find(Ee=>Ee.product&&Ee.product.toLowerCase()===we.toLowerCase());if(!be&&je&&(be=ne?.find(Ee=>Ee.sku&&Ee.sku.toLowerCase()===je.toLowerCase())),!be){const Ee=ne?.map(qe=>`${qe.product||qe.$id} (SKU: ${qe.sku||"N/A"})`).slice(0,5).join(", ")||"None";throw new Error(`Product "${we}" or SKU "${je||q}" not found. Available products: ${Ee}${ne&&ne.length>5?"...":""}. Please check the product name or SKU matches exactly.`)}const yt=be.$id,Re=be.sku||je||"";let Pe=v.Date||v.date||v.date,Oe;if(Pe&&typeof Pe=="string"){const Ee=Pe.match(/^(\d{2})-(\d{2})-(\d{4})$/);if(Ee){const[,qe,We,ns]=Ee,ut=new Date(parseInt(ns),parseInt(We)-1,parseInt(qe));if(isNaN(ut.getTime()))throw new Error(`Invalid date format: ${Pe}. Use DD-MM-YYYY format (e.g., 15-01-2024).`);Oe=ut.toISOString()}else{const qe=new Date(Pe);if(isNaN(qe.getTime()))throw new Error(`Invalid date format: ${Pe}. Use DD-MM-YYYY format (e.g., 15-01-2024).`);Oe=qe.toISOString()}}else if(Pe instanceof Date){if(isNaN(Pe.getTime()))throw new Error("Invalid date. Use DD-MM-YYYY format (e.g., 15-01-2024).");Oe=Pe.toISOString()}else Oe=new Date().toISOString();const Ke=parseFloat(v.Qty||v.qty||v.sold_units||"0"),$e=parseFloat(v.Rate||v.rate||v.unit_price||"0");if(!Ke||Ke<=0||isNaN(Ke))throw new Error(`Invalid Quantity: ${Ke}. Must be greater than 0.`);if(!$e||$e<=0||isNaN($e))throw new Error(`Invalid Rate: ${$e}. Must be greater than 0.`);const y=Number((Ke*$e).toFixed(2)),ue=(v.Remarks||v.remarks||v.notes||"").trim()||void 0,ge={date:Oe,sales_channel_id:Le,product_id:yt,sku:Re||"",sold_units:Ke,unit_price:$e,total_price:y,notes:ue};console.log("ðŸ”„ [SalesRecord] About to create record with:",JSON.stringify(ge,null,2));const De=await Zt.create(ge);return console.log("âœ… [SalesRecord] Record created successfully! ID:",De.$id),console.log("âœ… [SalesRecord] Full created object:",JSON.stringify(De,null,2)),De},onImportComplete:async v=>{if(console.log("ðŸ“Š Import Result:",v),console.log("âœ… Successful Rows:",v.successfulRows),console.log("âŒ Failed Rows:",v.failedRows),console.log("âš ï¸ Errors:",v.errors),await n.invalidateQueries({queryKey:["sales-records"],refetchType:"active"}),await n.refetchQueries({queryKey:["sales-records"]}),v.failedRows>0&&v.errors.length>0){const X=v.errors.slice(0,5).map(fe=>`Row ${fe.row}: ${fe.message}`).join(`
`);a({title:"Import Completed with Errors",description:`${v.successfulRows} successful, ${v.failedRows} failed.

First errors:
${X}`,variant:"destructive",duration:1e4})}else v.successfulRows>0?a({title:"Import Successful",description:`${v.successfulRows} sales records imported successfully.`}):a({title:"Import Failed",description:`No records were imported. ${v.errors.length>0?`Errors: ${v.errors[0]?.message}`:"Unknown error"}`,variant:"destructive"})}},variant:"outline"}),R&&e.jsx(At,{data:H.map(v=>{const X={};return R.exportColumns.forEach(fe=>{let Ne;switch(fe.dataKey){case"date":Ne=v.date;break;case"channelName":Ne=L.find(Ie=>Ie.$id===v.sales_channel_id)?.channel_name||v.sales_channel_id;break;case"productName":Ne=ne.find(Ie=>Ie.$id===v.product_id)?.product||v.product_id;break;case"sku":Ne=v.sku;break;case"qty":Ne=v.sold_units;break;case"rate":Ne=v.unit_price;break;case"totalAmount":Ne=Number((v.sold_units*v.unit_price).toFixed(2));break;case"status":Ne="Completed";break;case"remarks":Ne=v.notes||"";break;default:Ne=v[fe.dataKey]}X[fe.exportHeader]=fe.formatter?fe.formatter(Ne):Ne}),X}),headers:R.exportColumns.map(v=>v.exportHeader),filename:"sales-record",variant:"outline"}),e.jsxs($,{onClick:()=>m(!0),children:[e.jsx(Ct,{className:"mr-2 h-4 w-4"})," Add Sales Record"]})]})]})}),e.jsxs(se,{children:[e.jsx(te,{className:"mb-6",children:e.jsx(se,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex flex-wrap gap-4 items-center",children:e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(gt,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(G,{placeholder:"Search records...",className:"pl-10",value:E,onChange:v=>D(v.target.value)})]})}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs(le,{value:j,onValueChange:f,children:[e.jsx(ie,{className:"w-[180px]",children:e.jsx(ce,{placeholder:"Filter by Channel"})}),e.jsxs(oe,{children:[e.jsx(S,{value:"all",children:"All Channels"}),tt.map(v=>e.jsx(S,{value:v.id,children:v.name},v.id))]})]}),e.jsxs(le,{value:P,onValueChange:N,children:[e.jsx(ie,{className:"w-[180px]",children:e.jsx(ce,{placeholder:"Filter by Product"})}),e.jsxs(oe,{children:[e.jsx(S,{value:"all",children:"All Products"}),bt.map(v=>e.jsx(S,{value:v.id,children:v.name},v.id))]})]}),e.jsxs(le,{value:T,onValueChange:A,children:[e.jsx(ie,{className:"w-[180px]",children:e.jsx(ce,{placeholder:"Filter by SKU"})}),e.jsxs(oe,{children:[e.jsx(S,{value:"all",children:"All SKUs"}),Mt.map(v=>e.jsx(S,{value:v,children:v},v))]})]}),e.jsx(G,{type:"date",placeholder:"From Date",className:"w-[150px]",value:F.from,onChange:v=>V(X=>({...X,from:v.target.value}))}),e.jsx(G,{type:"date",placeholder:"To Date",className:"w-[150px]",value:F.to,onChange:v=>V(X=>({...X,to:v.target.value}))})]})]})})}),e.jsx(ct,{open:p,onOpenChange:v=>{m(v),v||(I({date:new Date().toISOString(),sales_channel_id:"",product_id:"",sku:"",sold_units:0,unit_price:0,total_price:0,notes:""}),g(null))},children:e.jsxs(nt,{className:"sm:max-w-[720px]",children:[e.jsxs(it,{children:[e.jsx(lt,{children:o?"Edit Sales Record":"Add New Sales Record"}),e.jsx(dt,{children:"Enter sales record details below."})]}),e.jsxs("form",{onSubmit:re,children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 py-4",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"date",children:"Date *"}),e.jsx(G,{id:"date",type:"date",value:d.dateString||"",onChange:v=>I(X=>({...X,dateString:v.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"channel",children:"Sales Channel *"}),e.jsxs(le,{value:d.sales_channel_id,onValueChange:v=>I(X=>({...X,sales_channel_id:v})),children:[e.jsx(ie,{id:"channel",children:e.jsx(ce,{placeholder:"Select Sales Channel"})}),e.jsx(oe,{children:L.map(v=>e.jsx(S,{value:v.$id,children:v.channel_name||v.$id},v.$id))})]})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"product",children:"Product *"}),e.jsxs(le,{value:d.product_id,onValueChange:v=>I(X=>({...X,product_id:v,sku:ne.find(fe=>fe.$id===v)?.sku||X.sku})),children:[e.jsx(ie,{id:"product",children:e.jsx(ce,{placeholder:"Select Product"})}),e.jsx(oe,{children:ne.map(v=>e.jsx(S,{value:v.$id,children:v.product||v.$id},v.$id))})]})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"sku",children:"SKU *"}),e.jsxs(le,{value:d.sku,onValueChange:v=>I(X=>({...X,sku:v})),children:[e.jsx(ie,{id:"sku",children:e.jsx(ce,{placeholder:"Select SKU"})}),e.jsx(oe,{children:ne.filter(v=>v.sku).map(v=>e.jsx(S,{value:v.sku,children:v.sku},v.$id))})]})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"qty",children:"Quantity *"}),e.jsx(G,{id:"qty",type:"number",min:"1",value:d.sold_units,onChange:v=>I(X=>({...X,sold_units:Number(v.target.value),total_price:Number((Number(v.target.value)*X.unit_price).toFixed(2))})),required:!0})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"rate",children:"Rate *"}),e.jsx(G,{id:"rate",type:"number",step:"0.01",min:"0.01",value:d.unit_price,onChange:v=>I(X=>({...X,unit_price:Number(v.target.value),total_price:Number((X.sold_units*Number(v.target.value)).toFixed(2))})),required:!0})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"total",children:"Total Amount"}),e.jsx(G,{id:"total",type:"number",step:"0.01",value:Number((d.sold_units*d.unit_price).toFixed(2)),readOnly:!0,className:"bg-gray-100"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(M,{htmlFor:"notes",children:"Remarks"}),e.jsx(G,{id:"notes",type:"text",value:d.notes||"",onChange:v=>I(X=>({...X,notes:v.target.value}))})]})]}),e.jsx(ot,{children:e.jsx($,{type:"submit",disabled:K.isPending||h.isPending,children:K.isPending||h.isPending?e.jsxs(e.Fragment,{children:[e.jsx(Be,{className:"mr-2 h-4 w-4 animate-spin"}),"Savingâ€¦"]}):o?"Update Sales Record":"Add Sales Record"})})]})]})}),e.jsx(te,{children:e.jsxs(se,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",Nt+1," to ",Math.min(wt,ft)," of ",ft," records"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Records per page:"}),e.jsxs(le,{value:O.toString(),onValueChange:v=>Q(Number(v)),children:[e.jsx(ie,{className:"w-[100px]",children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"50",children:"50"}),e.jsx(S,{value:"100",children:"100"}),e.jsx(S,{value:"500",children:"500"})]})]})]})]}),b.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 p-3 bg-muted rounded-md",children:[e.jsxs("span",{className:"text-sm font-medium",children:[b.length," selected"]}),e.jsx($,{variant:"destructive",size:"sm",onClick:_e,disabled:ae.isPending,children:"Delete Selected"}),e.jsx($,{variant:"outline",size:"sm",onClick:He,children:"Export Selected"})]}),e.jsx("div",{className:"border rounded-md",children:e.jsx("div",{className:"overflow-auto",style:{maxHeight:"600px"},children:e.jsx(ds,{data:B(l.map(v=>((!v.date||v.date==="Invalid Date")&&console.warn("Invalid sales record date found:",{id:v.$id,date:v.date}),{...v,formattedDate:Ca(v.date),channelName:L.find(X=>X.$id===v.sales_channel_id)?.channel_name||v.sales_channel_id,productName:ne.find(X=>X.$id===v.product_id)?.product||v.product_id,totalAmount:Number((v.sold_units*v.unit_price).toFixed(2)),status:"Completed"}))),columns:[{key:"formattedDate",label:"Date",sortable:!0,dataType:"date"},{key:"channelName",label:"Sales Channel",sortable:!0,dataType:"string"},{key:"productName",label:"Product",sortable:!0,dataType:"string"},{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"sold_units",label:"Qty",sortable:!0,dataType:"number",align:"right",headerClassName:"bg-purple-50",cellClassName:"bg-purple-50 font-medium"},{key:"unit_price",label:"Rate",sortable:!0,dataType:"number",align:"right"},{key:"totalAmount",label:"Total Amount",sortable:!0,dataType:"number",align:"right",headerClassName:"bg-green-50",cellClassName:"bg-green-50 font-medium"},{key:"status",label:"Status",sortable:!0,dataType:"string",formatter:v=>e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${v==="Completed"?"bg-green-100 text-green-800":v==="In Progress"?"bg-yellow-100 text-yellow-800":v==="Pending"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:v})},{key:"notes",label:"Remarks",sortable:!0,dataType:"string"}],onSort:_,currentSort:Y,loading:de,maxHeight:"none",stickyHeader:!0,bordered:!1,searchable:!1,rowKey:"$id",selectable:!0,selectedRows:b,onSelectionChange:x,actions:[{label:"Edit",onClick:Se,variant:"default"},{label:"Delete",onClick:v=>ve(v.$id),variant:"destructive"}],emptyMessage:"No sales records found"})})}),jt>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx($,{variant:"outline",size:"sm",onClick:()=>Z(v=>Math.max(1,v-1)),disabled:U===1,children:"Previous"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",U," of ",jt]})}),e.jsx($,{variant:"outline",size:"sm",onClick:()=>Z(v=>Math.min(jt,v+1)),disabled:U===jt,children:"Next"})]})]})})]})]})})}const Wl=()=>{const r=Ya(),t=[{title:"Stocks",description:"Manage inventory and stock levels",icon:Ws,path:"/master/stocks",color:"text-blue-600"},{title:"Vendors",description:"Manage supplier information",icon:nn,path:"/master/vendors",color:"text-green-600"},{title:"Staff",description:"Manage employee records",icon:on,path:"/master/staff",color:"text-purple-600"},{title:"Processes",description:"Manage business processes",icon:Tr,path:"/master/processes",color:"text-orange-600"},{title:"Raw Products",description:"Manage raw materials",icon:Va,path:"/master/raw-products",color:"text-red-600"},{title:"Products",description:"Manage finished products",icon:Ai,path:"/master/products",color:"text-indigo-600"},{title:"Sales Channels",description:"Manage sales channels",icon:qi,path:"/master/sales-channels",color:"text-teal-600"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Master Data"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your core business data and configurations"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map(s=>{const a=s.icon;return e.jsxs(te,{className:"hover:shadow-lg transition-shadow cursor-pointer",children:[e.jsxs(pe,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(a,{className:`h-6 w-6 ${s.color}`}),e.jsx(xe,{className:"text-lg",children:s.title})]}),e.jsx(Te,{children:s.description})]}),e.jsx(se,{children:e.jsxs($,{onClick:()=>r(s.path),className:"w-full",variant:"outline",children:["Manage ",s.title]})})]},s.title)})})]})},Gl=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Analytics"}),e.jsx("p",{className:"text-muted-foreground",children:"Business intelligence and performance analytics"})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(te,{children:[e.jsx(pe,{children:e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(Fa,{className:"h-5 w-5 text-primary"}),"Production Analytics"]})}),e.jsx(se,{children:e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"Production performance charts"}),e.jsx("p",{className:"text-sm",children:"Database connection required"})]})})]}),e.jsxs(te,{children:[e.jsx(pe,{children:e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(Ys,{className:"h-5 w-5 text-primary"}),"Sales Trends"]})}),e.jsx(se,{children:e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"Sales performance analysis"}),e.jsx("p",{className:"text-sm",children:"Database connection required"})]})})]}),e.jsxs(te,{children:[e.jsx(pe,{children:e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(Fi,{className:"h-5 w-5 text-primary"}),"Inventory Distribution"]})}),e.jsx(se,{children:e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"Stock distribution charts"}),e.jsx("p",{className:"text-sm",children:"Database connection required"})]})})]}),e.jsxs(te,{children:[e.jsx(pe,{children:e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx($i,{className:"h-5 w-5 text-primary"}),"Efficiency Metrics"]})}),e.jsx(se,{children:e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"Process efficiency analysis"}),e.jsx("p",{className:"text-sm",children:"Database connection required"})]})})]})]})]}),Jl=()=>{const r=cs();return u.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",r.pathname)},[r.pathname]),e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-gray-100",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"mb-4 text-4xl font-bold",children:"404"}),e.jsx("p",{className:"mb-4 text-xl text-gray-600",children:"Oops! Page not found"}),e.jsx("a",{href:"/",className:"text-blue-500 underline hover:text-blue-700",children:"Return to Home"})]})})},Xl=()=>{const[r,t]=u.useState(!1),[s,a]=u.useState(null),[n,i]=u.useState(""),[c,p]=u.useState([]),{toast:m}=Fe(),[o,g]=u.useState(50),b=xt(),{user:x}=vt(),{config:j}=Et("stocks"),{validationRules:f,canImport:P}=Rt("stocks"),{currentSort:N,handleSort:T,getSortedData:A}=as(),[E,D]=u.useState({stock_code:"",stock_name:"",category:"",uom:"",min_level:"",status:"Active"}),{data:F=[],isLoading:V,error:U}=ye({queryKey:["stocks"],queryFn:async()=>await Yt.getAll(),enabled:!!x}),Z=Ae({mutationFn:async K=>{const h={stock_code:K.stock_code,stock_name:K.stock_name,category:K.category||"",uom:K.uom||"",min_level:K.min_level,status:K.status||"Active"},d=await Yt.create(h);if(d&&d.$id)try{const I=new Date().toISOString().split("T")[0];await $l.create({stock_id:d.$id,opening_balance:0,purchases:0,used_in_production:0,status_date:I})}catch(I){console.error("Error creating stock status entry:",I)}return d},onSuccess:()=>{b.invalidateQueries({queryKey:["stocks"]}),b.invalidateQueries({queryKey:["stock_status"]}),m({title:"Success",description:"Stock created successfully"}),t(!1),a(null),B()},onError:K=>{m({title:"Error",description:"Failed to create stock",variant:"destructive"}),console.error("Error creating stock:",K)}}),O=Ae({mutationFn:async({id:K,data:h})=>{const d={stock_code:h.stock_code,stock_name:h.stock_name,category:h.category||"",uom:h.uom||"",min_level:h.min_level,status:h.status||"Active"};return await Yt.update(K,d)},onSuccess:()=>{b.invalidateQueries({queryKey:["stocks"]}),b.invalidateQueries({queryKey:["stock_status"]}),m({title:"Success",description:"Stock updated successfully"}),t(!1),a(null),B()},onError:K=>{m({title:"Error",description:"Failed to update stock",variant:"destructive"}),console.error("Error updating stock:",K)}}),Q=Ae({mutationFn:K=>Yt.delete(K),onSuccess:()=>{b.invalidateQueries({queryKey:["stocks"]}),m({title:"Success",description:"Stock deleted successfully"})},onError:K=>{m({title:"Error",description:"Failed to delete stock",variant:"destructive"}),console.error("Error deleting stock:",K)}}),R=async K=>{if(K.preventDefault(),!E.stock_code.trim()){m({title:"Error",description:"Stock Code is required",variant:"destructive"});return}if(!E.stock_name?.trim()){m({title:"Error",description:"Stock Name is required",variant:"destructive"});return}if(!E.category.trim()){m({title:"Error",description:"Category is required",variant:"destructive"});return}if(!E.uom.trim()){m({title:"Error",description:"UoM is required",variant:"destructive"});return}if(!E.min_level.trim()){m({title:"Error",description:"Min Level is required",variant:"destructive"});return}const h={...E,min_level:E.min_level?parseFloat(E.min_level):void 0};s?O.mutate({id:s.$id,data:h}):Z.mutate(h)},k=K=>{a(K),D({stock_code:K.stock_code,stock_name:K.stock_name||"",category:K.category||"",uom:K.uom||"",min_level:K.min_level?.toString()||"",status:K.status}),t(!0)},w=async K=>{await requestDeletion("stock",K.$id,K.stock_name,()=>Q.mutate(K.$id))},Y=async()=>{if(c.length===0){m({title:"Error",description:"Please select stocks to delete",variant:"destructive"});return}if(window.confirm(`Are you sure you want to delete ${c.length} selected stock(s)?`))try{const K=c.length;await Promise.all(c.map(h=>new Promise((d,I)=>{Q.mutate(h.$id,{onSuccess:d,onError:I})}))),p([]),m({title:"Success",description:`${K} stocks deleted successfully`})}catch(K){console.error("Error deleting stocks:",K),m({title:"Error",description:"Failed to delete selected stocks",variant:"destructive"})}},_=async()=>{if(c.length===0){m({title:"Error",description:"Please select stocks to export",variant:"destructive"});return}if(j)try{const K=c.map(h=>{const d={};return j.exportColumns.forEach(I=>{let C;switch(I.dataKey){case"name":case"stock_name":C=h.stock_name;break;case"sku":case"stock_code":C=h.stock_code;break;case"category":C=h.category||"";break;case"unit":case"uom":C=h.uom||"";break;case"openingBalance":case"min_level":C=h.min_level||0;break;default:C=h[I.dataKey]}d[I.exportHeader]=I.formatter?I.formatter(C):C}),d});await Gt.exportToXLSX({filename:"stocks-selected",headers:j.exportColumns.map(h=>h.exportHeader),data:K,format:"xlsx"}),m({title:"Success",description:`Exported ${c.length} selected stock(s) successfully`})}catch(K){console.error("Export error:",K),m({title:"Error",description:"Failed to export selected stocks",variant:"destructive"})}},B=()=>{D({stock_code:"",stock_name:"",category:"",uom:"",min_level:"",status:"Active"})},ne=()=>{a(null),B(),t(!0)},L=F.filter(K=>K.stock_name.toLowerCase().includes(n.toLowerCase())||K.stock_code.toLowerCase().includes(n.toLowerCase())||K.category.toLowerCase().includes(n.toLowerCase())),ee=A(L),H=ee.length,de=ee.slice(0,o);return U?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("p",{className:"text-red-500",children:["Error loading stocks: ",U.message]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Stocks"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage raw materials and stock items"})]}),e.jsxs(ct,{open:r,onOpenChange:t,children:[e.jsx(vs,{asChild:!0,children:e.jsxs($,{onClick:ne,className:"bg-primary hover:bg-primary/90",children:[e.jsx(Ct,{className:"h-4 w-4 mr-2"}),"Add New Stock"]})}),e.jsxs(nt,{className:"sm:max-w-[425px]",children:[e.jsxs(it,{children:[e.jsx(lt,{children:s?"Edit Stock":"Add New Stock"}),e.jsxs(dt,{children:[s?"Update stock information":"Enter stock details to add a new stock",e.jsxs("span",{className:"mt-2 text-sm text-muted-foreground",children:["Fields marked with ",e.jsx("span",{className:"text-red-500",children:"*"})," are required."]})]})]}),e.jsxs("form",{onSubmit:R,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(M,{htmlFor:"stock_code",className:"text-right",children:["Stock Code ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(G,{id:"stock_code",value:E.stock_code,onChange:K=>D({...E,stock_code:K.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(M,{htmlFor:"stock_name",className:"text-right",children:["Stock Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(G,{id:"stock_name",value:E.stock_name,onChange:K=>D({...E,stock_name:K.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(M,{htmlFor:"category",className:"text-right",children:["Category ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(G,{id:"category",value:E.category,onChange:K=>D({...E,category:K.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(M,{htmlFor:"uom",className:"text-right",children:["UoM ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(le,{value:E.uom,onValueChange:K=>D({...E,uom:K}),children:[e.jsx(ie,{className:"col-span-3",children:e.jsx(ce,{placeholder:"Select unit of measure"})}),e.jsxs(oe,{children:[e.jsx(S,{value:"kg",children:"kg"}),e.jsx(S,{value:"g",children:"g"}),e.jsx(S,{value:"ltr",children:"ltr"}),e.jsx(S,{value:"ml",children:"ml"}),e.jsx(S,{value:"pcs",children:"pcs"}),e.jsx(S,{value:"bags",children:"bags"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(M,{htmlFor:"min_level",className:"text-right",children:["Min Level ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(G,{id:"min_level",type:"number",step:"0.01",value:E.min_level,onChange:K=>D({...E,min_level:K.target.value}),className:"col-span-3",maxLength:6})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(M,{htmlFor:"status",className:"text-right",children:"Status"}),e.jsxs(le,{value:E.status,onValueChange:K=>D({...E,status:K}),children:[e.jsx(ie,{className:"col-span-3",children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"Active",children:"Active"}),e.jsx(S,{value:"Inactive",children:"Inactive"})]})]})]})]}),e.jsx(ot,{children:e.jsx($,{type:"submit",disabled:Z.isPending||O.isPending,children:Z.isPending||O.isPending?"Saving...":s?"Update":"Create"})})]})]})]})]}),e.jsx(te,{children:e.jsx(se,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(gt,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(G,{placeholder:"Search stocks...",className:"pl-10",value:n,onChange:K=>i(K.target.value)})]}),e.jsxs($,{variant:"outline",children:[e.jsx(ts,{className:"h-4 w-4 mr-2"}),"Filter"]}),P&&e.jsx(qt,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:["Stock Name","SKU","Unit"],optionalColumns:["Category","Opening Balance"],validationRules:f,onImportComplete:K=>{K.successfulRows>0&&(b.invalidateQueries({queryKey:["stocks"]}),m({title:"Import Successful",description:`${K.successfulRows} stocks imported successfully.`}))}},variant:"outline"}),j&&e.jsx(At,{data:L.map(K=>({name:K.stock_name,sku:K.stock_code,category:K.category,unit:K.uom,openingBalance:K.min_level||0,createdAt:K.$createdAt})),headers:j.exportColumns.map(K=>K.exportHeader),filename:"stocks",variant:"outline"})]})})}),e.jsxs(te,{children:[e.jsx(pe,{children:e.jsxs(xe,{children:["Stock Items (",L.length,")"]})}),e.jsxs(se,{children:[c.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 p-3 bg-muted rounded-md",children:[e.jsxs("span",{className:"text-sm font-medium",children:[c.length," selected"]}),e.jsx($,{variant:"destructive",size:"sm",onClick:Y,disabled:Q.isPending,children:"Delete Selected"}),e.jsx($,{variant:"outline",size:"sm",onClick:_,children:"Export Selected"})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",Math.min(de.length,H)," of ",H," records"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Records per page:"}),e.jsxs(le,{value:o.toString(),onValueChange:K=>g(Number(K)),children:[e.jsx(ie,{className:"w-[100px]",children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"50",children:"50"}),e.jsx(S,{value:"100",children:"100"}),e.jsx(S,{value:"500",children:"500"})]})]})]})]}),e.jsx("div",{className:"border rounded-md overflow-auto",style:{maxHeight:"70vh"},children:e.jsx(ds,{maxHeight:"none",selectable:!0,selectedRows:c,onSelectionChange:p,rowKey:"$id",data:de.map(K=>({...K,stock_code:K.stock_code||"",stock_name:K.stock_name||"",category:K.category||"-",uom:K.uom||"-",min_level:K.min_level||0,status:K.status||"Active"})),columns:[{key:"stock_code",label:"Stock Code",sortable:!0,dataType:"string"},{key:"stock_name",label:"Stock Name",sortable:!0,dataType:"string"},{key:"category",label:"Category",sortable:!0,dataType:"string"},{key:"uom",label:"UoM",sortable:!0,dataType:"string"},{key:"min_level",label:"Min Level",sortable:!0,dataType:"number",align:"right"},{key:"status",label:"Status",sortable:!0,dataType:"string"}],onSort:T,currentSort:N,loading:V,emptyMessage:"No stocks found",actions:[{label:"Edit",icon:e.jsx(ss,{className:"h-4 w-4"}),onClick:k},{label:"Delete",icon:e.jsx(Lt,{className:"h-4 w-4"}),onClick:K=>w(K),variant:"destructive"}]})})]})]})]})},rs=u.forwardRef(({className:r,...t},s)=>e.jsx("textarea",{className:me("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:s,...t}));rs.displayName="Textarea";const Zl=()=>{const[r,t]=u.useState(""),[s,a]=u.useState("all"),[n,i]=u.useState(!1),[c,p]=u.useState(null),[m,o]=u.useState([]),[g,b]=u.useState(50),[x,j]=u.useState({vendor_name:"",contact_person:"",phone:"",email:"",address:"",gstin:"",status:"Active"}),{toast:f}=Fe(),P=xt(),{config:N}=Et("vendors"),{validationRules:T,canImport:A}=Rt("vendors"),{data:E=[],isLoading:D,error:F}=ye({queryKey:["vendors"],queryFn:async()=>await Us.getAll()}),V=Ae({mutationFn:h=>{const d={vendor_name:h.vendor_name,contact_person:h.contact_person||"",phone:h.phone||"",address:h.address||"",gstin:h.gstin||"",status:h.status||"Active"};return h.email&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(h.email)&&(d.email=h.email),Us.create(d)},onSuccess:()=>{P.invalidateQueries({queryKey:["vendors"]}),f({title:"Success",description:"Vendor created successfully"}),i(!1),O()},onError:h=>{f({title:"Error",description:"Failed to create vendor",variant:"destructive"}),console.error("Error creating vendor:",h)}}),U=Ae({mutationFn:({id:h,data:d})=>{const I={vendor_name:d.vendor_name,contact_person:d.contact_person||"",phone:d.phone||"",address:d.address||"",gstin:d.gstin||"",status:d.status||"Active"};return d.email&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(d.email)?I.email=d.email:d.email===""&&(I.email=""),Us.update(h,I)},onSuccess:()=>{P.invalidateQueries({queryKey:["vendors"]}),f({title:"Success",description:"Vendor updated successfully"}),i(!1),O()},onError:h=>{f({title:"Error",description:"Failed to update vendor",variant:"destructive"}),console.error("Error updating vendor:",h)}}),Z=Ae({mutationFn:h=>Us.delete(h),onSuccess:()=>{P.invalidateQueries({queryKey:["vendors"]}),f({title:"Success",description:"Vendor deleted successfully"})},onError:h=>{f({title:"Error",description:"Failed to delete vendor",variant:"destructive"}),console.error("Error deleting vendor:",h)}}),O=()=>{j({vendor_name:"",contact_person:"",phone:"",email:"",address:"",gstin:"",status:"Active"}),p(null)},Q=h=>{if(h.preventDefault(),!x.vendor_name.trim()){f({title:"Error",description:"Vendor Name is required",variant:"destructive"});return}if(!x.contact_person.trim()){f({title:"Error",description:"Contact Person is required",variant:"destructive"});return}if(x.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(x.email)){f({title:"Error",description:"Please enter a valid email address",variant:"destructive"});return}c?U.mutate({id:c.$id,data:x}):V.mutate(x)},R=h=>{p(h),j({vendor_name:h.vendor_name,contact_person:h.contact_person||"",phone:h.phone||"",email:h.email||"",address:h.address||"",gstin:h.gstin||"",status:h.status}),i(!0)},k=h=>{confirm("Are you sure you want to delete this vendor?")&&Z.mutate(h)},w=async()=>{if(m.length===0){f({title:"Error",description:"Please select vendors to delete",variant:"destructive"});return}if(window.confirm(`Are you sure you want to delete ${m.length} selected vendor(s)?`))try{const h=m.length;await Promise.all(m.map(d=>new Promise((I,C)=>{Z.mutate(d.$id,{onSuccess:I,onError:C})}))),o([]),f({title:"Success",description:`${h} vendors deleted successfully`})}catch(h){console.error("Error deleting vendors:",h),f({title:"Error",description:"Failed to delete selected vendors",variant:"destructive"})}},Y=async()=>{if(m.length===0){f({title:"Error",description:"Please select vendors to export",variant:"destructive"});return}if(N)try{const h=m.map(d=>{const I={};return N.exportColumns.forEach(C=>{let ae;switch(C.dataKey){case"name":case"vendor_name":ae=d.vendor_name;break;case"contact_person":ae=d.contact_person||"";break;case"phone":ae=d.phone||"";break;case"email":ae=d.email||"";break;case"address":ae=d.address||"";break;case"gstin":ae=d.gstin||"";break;case"status":ae=d.status;break;default:ae=d[C.dataKey]}I[C.exportHeader]=C.formatter?C.formatter(ae):ae}),I});await Gt.exportToXLSX({filename:"vendors-selected",headers:N.exportColumns.map(d=>d.exportHeader),data:h,format:"xlsx"}),f({title:"Success",description:`Exported ${m.length} selected vendor(s) successfully`})}catch(h){console.error("Export error:",h),f({title:"Error",description:"Failed to export selected vendors",variant:"destructive"})}},_=()=>{p(null),O(),i(!0)},B=E.filter(h=>{const d=h.vendor_name.toLowerCase().includes(r.toLowerCase())||h.contact_person?.toLowerCase().includes(r.toLowerCase())||h.email?.toLowerCase().includes(r.toLowerCase()),I=s==="all"||h.status===s;return d&&I}),ne=B.length,L=B.slice(0,g),ee=(h,d)=>{o(d?[...m,h]:m.filter(I=>I.$id!==h.$id))},H=h=>{o(h?[...L]:[])},de=L.length>0&&L.every(h=>m.some(d=>d.$id===h.$id)),K=m.length>0&&!de;return F?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("p",{className:"text-red-500",children:["Error loading vendors: ",F.message]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Vendors"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage vendor information and relationships"})]}),e.jsxs(ct,{open:n,onOpenChange:i,children:[e.jsx(vs,{asChild:!0,children:e.jsxs($,{onClick:_,className:"bg-primary hover:bg-primary/90",children:[e.jsx(Ct,{className:"h-4 w-4 mr-2"}),"Add New Vendor"]})}),e.jsxs(nt,{className:"sm:max-w-[500px]",children:[e.jsxs(it,{children:[e.jsx(lt,{children:c?"Edit Vendor":"Add New Vendor"}),e.jsxs(dt,{children:[c?"Update vendor information":"Enter vendor details to add a new vendor",e.jsxs("p",{className:"mt-2 text-sm text-muted-foreground",children:["Fields marked with ",e.jsx("span",{className:"text-red-500",children:"*"})," are required."]})]})]}),e.jsxs("form",{onSubmit:Q,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(M,{htmlFor:"vendor_name",className:"text-right",children:["Vendor Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(G,{id:"vendor_name",value:x.vendor_name,onChange:h=>j({...x,vendor_name:h.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(M,{htmlFor:"contact_person",className:"text-right",children:["Contact Person ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(G,{id:"contact_person",value:x.contact_person,onChange:h=>j({...x,contact_person:h.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(M,{htmlFor:"phone",className:"text-right",children:"Phone"}),e.jsx(G,{id:"phone",value:x.phone,onChange:h=>j({...x,phone:h.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(M,{htmlFor:"email",className:"text-right",children:"Email"}),e.jsx(G,{id:"email",type:"email",value:x.email,onChange:h=>j({...x,email:h.target.value}),className:"col-span-3",placeholder:"Optional"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(M,{htmlFor:"address",className:"text-right",children:"Address"}),e.jsx(rs,{id:"address",value:x.address,onChange:h=>j({...x,address:h.target.value}),className:"col-span-3",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(M,{htmlFor:"gstin",className:"text-right",children:"GSTIN"}),e.jsx(G,{id:"gstin",value:x.gstin,onChange:h=>j({...x,gstin:h.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(M,{htmlFor:"status",className:"text-right",children:"Status"}),e.jsxs(le,{value:x.status,onValueChange:h=>j({...x,status:h}),children:[e.jsx(ie,{className:"col-span-3",children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"Active",children:"Active"}),e.jsx(S,{value:"Inactive",children:"Inactive"})]})]})]})]}),e.jsx(ot,{children:e.jsx($,{type:"submit",children:c?"Update":"Create"})})]})]})]})]}),e.jsx(te,{children:e.jsx(se,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(gt,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(G,{placeholder:"Search vendors...",className:"pl-10",value:r,onChange:h=>t(h.target.value)})]}),e.jsxs($,{variant:"outline",children:[e.jsx(ts,{className:"h-4 w-4 mr-2"}),"Filter"]}),A&&e.jsx(qt,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:["Vendor Name"],optionalColumns:["Email","Phone","Contact Person","Address"],validationRules:T,onImportComplete:h=>{h.successfulRows>0&&(P.invalidateQueries({queryKey:["vendors"]}),f({title:"Import Successful",description:`${h.successfulRows} vendors imported successfully.`}))}},variant:"outline"}),N&&e.jsx(At,{data:B.map(h=>({name:h.vendor_name,email:h.email||"",phone:h.phone||"",contactPerson:h.contact_person||"",address:h.address||"",isActive:h.status==="Active",createdAt:h.$createdAt})),headers:N.exportColumns.map(h=>h.exportHeader),filename:"vendors",variant:"outline"})]})})}),e.jsxs(te,{children:[e.jsx(pe,{children:e.jsxs(xe,{children:["Vendors (",B.length,")"]})}),e.jsxs(se,{children:[m.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 p-3 bg-muted rounded-md",children:[e.jsxs("span",{className:"text-sm font-medium",children:[m.length," selected"]}),e.jsx($,{variant:"destructive",size:"sm",onClick:w,disabled:Z.isPending,children:"Delete Selected"}),e.jsx($,{variant:"outline",size:"sm",onClick:Y,children:"Export Selected"})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",Math.min(L.length,ne)," of ",ne," records"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Records per page:"}),e.jsxs(le,{value:g.toString(),onValueChange:h=>b(Number(h)),children:[e.jsx(ie,{className:"w-[100px]",children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"50",children:"50"}),e.jsx(S,{value:"100",children:"100"}),e.jsx(S,{value:"500",children:"500"})]})]})]})]}),D?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:e.jsx("span",{children:"Loading vendors..."})}):B.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("p",{className:"text-lg mb-2",children:"No vendors found"}),e.jsx("p",{className:"text-sm",children:"Add your first vendor to get started"})]}):e.jsx("div",{className:"border rounded-md overflow-auto",style:{maxHeight:"70vh"},children:e.jsxs(mt,{children:[e.jsx(ht,{children:e.jsxs(ke,{children:[e.jsx(J,{className:"w-12",children:e.jsx("input",{type:"checkbox",checked:de,ref:h=>{h&&(h.indeterminate=K)},onChange:h=>H(h.target.checked),className:"rounded border-gray-300"})}),e.jsx(J,{children:"Vendor Name"}),e.jsx(J,{children:"Contact Person"}),e.jsx(J,{children:"Phone"}),e.jsx(J,{children:"Email"}),e.jsx(J,{children:"Address"}),e.jsx(J,{children:"GSTIN"}),e.jsx(J,{children:"Status"}),e.jsx(J,{children:"Actions"})]})}),e.jsx(pt,{children:L.map(h=>{const d=m.some(I=>I.$id===h.$id);return e.jsxs(ke,{children:[e.jsx(W,{children:e.jsx("input",{type:"checkbox",checked:d,onChange:I=>ee(h,I.target.checked),className:"rounded border-gray-300"})}),e.jsx(W,{className:"font-medium",children:h.vendor_name}),e.jsx(W,{children:h.contact_person||"-"}),e.jsx(W,{children:h.phone||"-"}),e.jsx(W,{children:h.email||"-"}),e.jsx(W,{className:"max-w-xs truncate",children:h.address||"-"}),e.jsx(W,{children:h.gstin||"-"}),e.jsx(W,{children:e.jsx(et,{variant:h.status==="Active"?"default":"secondary",children:h.status})}),e.jsx(W,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx($,{variant:"outline",size:"sm",onClick:()=>R(h),children:e.jsx(ss,{className:"h-4 w-4"})}),e.jsx($,{variant:"outline",size:"sm",onClick:()=>k(h.$id),children:e.jsx(Lt,{className:"h-4 w-4"})})]})})]},h.$id)})})]})})]})]})]})},ec=()=>{const[r,t]=u.useState(""),[s,a]=u.useState("all"),[n,i]=u.useState(!1),[c,p]=u.useState(null),[m,o]=u.useState([]),[g,b]=u.useState(50),[x,j]=u.useState({staff_code:"",staff_name:"",role:"",department:"",email:"",phone:"",joining_date:"",status:"Active"}),{toast:f}=Fe(),P=xt(),{config:N}=Et("staff"),{validationRules:T,canImport:A}=Rt("staff"),{getSortedData:E}=as(),D={async getAll(){return(await at.listDocuments(rt,Ce.STAFF)).documents},async create(C){return await at.createDocument(rt,Ce.STAFF,hs.unique(),C)},async update(C,ae){return await at.updateDocument(rt,Ce.STAFF,C,ae)},async delete(C){return await at.deleteDocument(rt,Ce.STAFF,C)}},{data:F=[],isLoading:V,error:U}=ye({queryKey:["staff"],queryFn:async()=>await D.getAll()}),Z=Ae({mutationFn:C=>{const ae={staff_code:C.staff_code,staff_name:C.staff_name,role:C.role,department:C.department||"",phone:C.phone||"",email:C.email||"",joining_date:C.joining_date||"",status:C.status||"Active"};return D.create(ae)},onSuccess:()=>{P.invalidateQueries({queryKey:["staff"]}),f({title:"Success",description:"Staff member created successfully"}),i(!1),R()},onError:C=>{f({title:"Error",description:"Failed to create staff member",variant:"destructive"}),console.error("Error creating staff:",C)}}),O=Ae({mutationFn:({id:C,data:ae})=>{const Se={staff_code:ae.staff_code,staff_name:ae.staff_name,role:ae.role,department:ae.department||"",phone:ae.phone||"",email:ae.email||"",joining_date:ae.joining_date||"",status:ae.status||"Active"};return D.update(C,Se)},onSuccess:()=>{P.invalidateQueries({queryKey:["staff"]}),f({title:"Success",description:"Staff member updated successfully"}),i(!1),R()},onError:C=>{f({title:"Error",description:"Failed to update staff member",variant:"destructive"}),console.error("Error updating staff:",C)}}),Q=Ae({mutationFn:C=>D.delete(C),onSuccess:()=>{P.invalidateQueries({queryKey:["staff"]}),f({title:"Success",description:"Staff member deleted successfully"})},onError:C=>{f({title:"Error",description:"Failed to delete staff member",variant:"destructive"}),console.error("Error deleting staff:",C)}}),R=()=>{j({staff_code:"",staff_name:"",role:"",department:"",email:"",phone:"",joining_date:"",status:"Active"}),p(null)},k=C=>{if(C.preventDefault(),!x.staff_code.trim()){f({title:"Error",description:"Staff Code is required",variant:"destructive"});return}if(!x.staff_name.trim()){f({title:"Error",description:"Staff Name is required",variant:"destructive"});return}if(!x.role.trim()){f({title:"Error",description:"Role is required",variant:"destructive"});return}if(!x.department.trim()){f({title:"Error",description:"Department is required",variant:"destructive"});return}if(x.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(x.email)){f({title:"Error",description:"Please enter a valid email address",variant:"destructive"});return}c?O.mutate({id:c.$id,data:x}):Z.mutate(x)},w=C=>{p(C),j({staff_code:C.staff_code,staff_name:C.staff_name,role:C.role,department:C.department||"",email:C.email||"",phone:C.phone||"",joining_date:C.joining_date||"",status:C.status}),i(!0)},Y=C=>{confirm("Are you sure you want to delete this staff member?")&&Q.mutate(C)},_=async()=>{if(m.length===0){f({title:"Error",description:"Please select staff to delete",variant:"destructive"});return}if(window.confirm(`Are you sure you want to delete ${m.length} selected staff member(s)?`))try{const C=m.length;await Promise.all(m.map(ae=>new Promise((Se,ve)=>{Q.mutate(ae.$id,{onSuccess:Se,onError:ve})}))),o([]),f({title:"Success",description:`${C} staff members deleted successfully`})}catch(C){console.error("Error deleting staff:",C),f({title:"Error",description:"Failed to delete selected staff",variant:"destructive"})}},B=async()=>{if(m.length===0){f({title:"Error",description:"Please select staff to export",variant:"destructive"});return}if(N)try{const C=m.map(ae=>{const Se={};return N.exportColumns.forEach(ve=>{let _e;switch(ve.dataKey){case"name":case"staff_name":_e=ae.staff_name;break;case"email":_e=ae.email||"";break;case"phone":_e=ae.phone||"";break;case"role":_e=ae.role;break;case"department":_e=ae.department||"";break;case"isActive":_e=ae.status==="Active";break;default:_e=ae[ve.dataKey]}Se[ve.exportHeader]=ve.formatter?ve.formatter(_e):_e}),Se});await Gt.exportToXLSX({filename:"staff-selected",headers:N.exportColumns.map(ae=>ae.exportHeader),data:C,format:"xlsx"}),f({title:"Success",description:`Exported ${m.length} selected staff member(s) successfully`})}catch(C){console.error("Export error:",C),f({title:"Error",description:"Failed to export selected staff",variant:"destructive"})}},ne=()=>{p(null),R(),i(!0)},L=F.filter(C=>{const ae=C.staff_name.toLowerCase().includes(r.toLowerCase())||C.staff_code.toLowerCase().includes(r.toLowerCase())||C.role.toLowerCase().includes(r.toLowerCase())||C.department?.toLowerCase().includes(r.toLowerCase()),Se=s==="all"||C.status===s;return ae&&Se}),ee=E(L),H=ee.length,de=ee.slice(0,g),K=(C,ae)=>{o(ae?[...m,C]:m.filter(Se=>Se.$id!==C.$id))},h=C=>{o(C?[...de]:[])},d=de.length>0&&de.every(C=>m.some(ae=>ae.$id===C.$id)),I=m.length>0&&!d;return U?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("p",{className:"text-red-500",children:["Error loading staff: ",U.message]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Staff"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage employee data and roles"})]}),e.jsxs(ct,{open:n,onOpenChange:i,children:[e.jsx(vs,{asChild:!0,children:e.jsxs($,{onClick:ne,className:"bg-primary hover:bg-primary/90",children:[e.jsx(Ct,{className:"h-4 w-4 mr-2"}),"Add New Staff"]})}),e.jsxs(nt,{className:"sm:max-w-[500px]",children:[e.jsxs(it,{children:[e.jsx(lt,{children:c?"Edit Staff":"Add New Staff"}),e.jsxs(dt,{children:[c?"Update staff information":"Enter staff details to add a new employee",e.jsxs("p",{className:"mt-2 text-sm text-muted-foreground",children:["Fields marked with ",e.jsx("span",{className:"text-red-500",children:"*"})," are required."]})]})]}),e.jsxs("form",{onSubmit:k,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(M,{htmlFor:"staff_code",className:"text-right",children:["Staff Code ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(G,{id:"staff_code",value:x.staff_code,onChange:C=>j({...x,staff_code:C.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(M,{htmlFor:"staff_name",className:"text-right",children:["Staff Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(G,{id:"staff_name",value:x.staff_name,onChange:C=>j({...x,staff_name:C.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(M,{htmlFor:"role",className:"text-right",children:["Role ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(le,{value:x.role,onValueChange:C=>j({...x,role:C}),children:[e.jsx(ie,{className:"col-span-3",children:e.jsx(ce,{placeholder:"Select role"})}),e.jsxs(oe,{children:[e.jsx(S,{value:"Manager",children:"Manager"}),e.jsx(S,{value:"Supervisor",children:"Supervisor"}),e.jsx(S,{value:"Operator",children:"Operator"}),e.jsx(S,{value:"Quality Controller",children:"Quality Controller"}),e.jsx(S,{value:"Warehouse Staff",children:"Warehouse Staff"}),e.jsx(S,{value:"Admin",children:"Admin"}),e.jsx(S,{value:"Accountant",children:"Accountant"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(M,{htmlFor:"department",className:"text-right",children:["Department ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(le,{value:x.department,onValueChange:C=>j({...x,department:C}),children:[e.jsx(ie,{className:"col-span-3",children:e.jsx(ce,{placeholder:"Select department"})}),e.jsxs(oe,{children:[e.jsx(S,{value:"Production",children:"Production"}),e.jsx(S,{value:"Quality Control",children:"Quality Control"}),e.jsx(S,{value:"Warehouse",children:"Warehouse"}),e.jsx(S,{value:"Administration",children:"Administration"}),e.jsx(S,{value:"Accounts",children:"Accounts"}),e.jsx(S,{value:"Sales",children:"Sales"}),e.jsx(S,{value:"Purchase",children:"Purchase"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(M,{htmlFor:"email",className:"text-right",children:"Email"}),e.jsx(G,{id:"email",type:"email",value:x.email,onChange:C=>j({...x,email:C.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(M,{htmlFor:"phone",className:"text-right",children:"Phone"}),e.jsx(G,{id:"phone",value:x.phone,onChange:C=>j({...x,phone:C.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(M,{htmlFor:"joining_date",className:"text-right",children:"Joining Date"}),e.jsx(G,{id:"joining_date",type:"date",value:x.joining_date,onChange:C=>j({...x,joining_date:C.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(M,{htmlFor:"status",className:"text-right",children:"Status"}),e.jsxs(le,{value:x.status,onValueChange:C=>j({...x,status:C}),children:[e.jsx(ie,{className:"col-span-3",children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"Active",children:"Active"}),e.jsx(S,{value:"Inactive",children:"Inactive"})]})]})]})]}),e.jsx(ot,{children:e.jsx($,{type:"submit",children:c?"Update":"Create"})})]})]})]})]}),e.jsx(te,{children:e.jsx(se,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(gt,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(G,{placeholder:"Search staff...",className:"pl-10",value:r,onChange:C=>t(C.target.value)})]}),e.jsxs($,{variant:"outline",children:[e.jsx(ts,{className:"h-4 w-4 mr-2"}),"Filter"]}),A&&e.jsx(qt,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:["Staff Name","Email","Role"],optionalColumns:["Phone","Department"],validationRules:T,onImportComplete:C=>{C.successfulRows>0&&(P.invalidateQueries({queryKey:["staff"]}),f({title:"Import Successful",description:`${C.successfulRows} staff members imported successfully.`}))}},variant:"outline"}),N&&e.jsx(At,{data:L.map(C=>({name:C.staff_name,email:C.email||"",phone:C.phone||"",role:C.role,department:C.department||"",isActive:C.status==="Active",createdAt:C.$createdAt})),headers:N.exportColumns.map(C=>C.exportHeader),filename:"staff",variant:"outline"})]})})}),e.jsxs(te,{children:[e.jsx(pe,{children:e.jsxs(xe,{children:["Staff Members (",L.length,")"]})}),e.jsxs(se,{children:[m.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 p-3 bg-muted rounded-md",children:[e.jsxs("span",{className:"text-sm font-medium",children:[m.length," selected"]}),e.jsx($,{variant:"destructive",size:"sm",onClick:_,disabled:Q.isPending,children:"Delete Selected"}),e.jsx($,{variant:"outline",size:"sm",onClick:B,children:"Export Selected"})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",Math.min(de.length,H)," of ",H," records"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Records per page:"}),e.jsxs(le,{value:g.toString(),onValueChange:C=>b(Number(C)),children:[e.jsx(ie,{className:"w-[100px]",children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"50",children:"50"}),e.jsx(S,{value:"100",children:"100"}),e.jsx(S,{value:"500",children:"500"})]})]})]})]}),V?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:e.jsx("span",{children:"Loading staff..."})}):L.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("p",{className:"text-lg mb-2",children:"No staff found"}),e.jsx("p",{className:"text-sm",children:"Add your first staff member to get started"})]}):e.jsx("div",{className:"border rounded-md overflow-auto",style:{maxHeight:"70vh"},children:e.jsxs(mt,{children:[e.jsx(ht,{children:e.jsxs(ke,{children:[e.jsx(J,{className:"w-12",children:e.jsx("input",{type:"checkbox",checked:d,ref:C=>{C&&(C.indeterminate=I)},onChange:C=>h(C.target.checked),className:"rounded border-gray-300"})}),e.jsx(J,{children:"Staff Code"}),e.jsx(J,{children:"Staff Name"}),e.jsx(J,{children:"Role"}),e.jsx(J,{children:"Department"}),e.jsx(J,{children:"Email"}),e.jsx(J,{children:"Phone"}),e.jsx(J,{children:"Joining Date"}),e.jsx(J,{children:"Status"}),e.jsx(J,{children:"Actions"})]})}),e.jsx(pt,{children:de.map(C=>{const ae=m.some(Se=>Se.$id===C.$id);return e.jsxs(ke,{children:[e.jsx(W,{children:e.jsx("input",{type:"checkbox",checked:ae,onChange:Se=>K(C,Se.target.checked),className:"rounded border-gray-300"})}),e.jsx(W,{className:"font-medium",children:C.staff_code}),e.jsx(W,{children:C.staff_name}),e.jsx(W,{children:C.role}),e.jsx(W,{children:C.department||"-"}),e.jsx(W,{children:C.email||"-"}),e.jsx(W,{children:C.phone||"-"}),e.jsx(W,{children:C.joining_date?new Date(C.joining_date).toLocaleDateString("en-GB"):"-"}),e.jsx(W,{children:e.jsx(et,{variant:C.status==="Active"?"default":"secondary",children:C.status})}),e.jsx(W,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx($,{variant:"outline",size:"sm",onClick:()=>w(C),children:e.jsx(ss,{className:"h-4 w-4"})}),e.jsx($,{variant:"outline",size:"sm",onClick:()=>Y(C.$id),children:e.jsx(Lt,{className:"h-4 w-4"})})]})})]},C.$id)})})]})})]})]})]})},tc=()=>{const[r,t]=u.useState(""),[s,a]=u.useState("all"),[n,i]=u.useState(!1),[c,p]=u.useState(null),[m,o]=u.useState([]),[g,b]=u.useState(50),[x,j]=u.useState({name:"",department:"",description:"",status:"Active"}),{toast:f}=Fe(),P=xt(),{config:N}=Et("processes"),{validationRules:T,canImport:A}=Rt("processes"),E={async getAll(){return(await at.listDocuments(rt,Ce.PROCESSES)).documents},async create(d){return await at.createDocument(rt,Ce.PROCESSES,hs.unique(),d)},async update(d,I){return await at.updateDocument(rt,Ce.PROCESSES,d,I)},async delete(d){return await at.deleteDocument(rt,Ce.PROCESSES,d)}},{data:D=[],isLoading:F,error:V}=ye({queryKey:["processes"],queryFn:async()=>await E.getAll()}),U=Ae({mutationFn:d=>{const I={process_name:d.name,department:d.department||"",description:d.description||"",status:d.status||"Active"};return E.create(I)},onSuccess:()=>{P.invalidateQueries({queryKey:["processes"]}),f({title:"Success",description:"Process created successfully"}),i(!1),Q()},onError:d=>{f({title:"Error",description:"Failed to create process",variant:"destructive"}),console.error("Error creating process:",d)}}),Z=Ae({mutationFn:({id:d,data:I})=>{const C={process_name:I.name,department:I.department||"",description:I.description||"",status:I.status||"Active"};return E.update(d,C)},onSuccess:()=>{P.invalidateQueries({queryKey:["processes"]}),f({title:"Success",description:"Process updated successfully"}),i(!1),Q()},onError:d=>{f({title:"Error",description:"Failed to update process",variant:"destructive"}),console.error("Error updating process:",d)}}),O=Ae({mutationFn:d=>E.delete(d),onSuccess:()=>{P.invalidateQueries({queryKey:["processes"]}),f({title:"Success",description:"Process deleted successfully"})},onError:d=>{f({title:"Error",description:"Failed to delete process",variant:"destructive"}),console.error("Error deleting process:",d)}}),Q=()=>{j({name:"",department:"",description:"",status:"Active"}),p(null)},R=d=>{if(d.preventDefault(),!x.name?.trim()){f({title:"Error",description:"Process Name is required",variant:"destructive"});return}if(!x.department.trim()){f({title:"Error",description:"Department is required",variant:"destructive"});return}c?Z.mutate({id:c.$id,data:x}):U.mutate(x)},k=d=>{p(d),j({name:d.process_name,department:d.department||"",description:d.description||"",status:d.status}),i(!0)},w=d=>{confirm("Are you sure you want to delete this process?")&&O.mutate(d)},Y=async()=>{if(m.length===0){f({title:"Error",description:"Please select processes to delete",variant:"destructive"});return}if(window.confirm(`Are you sure you want to delete ${m.length} selected process(es)?`))try{const d=m.length;await Promise.all(m.map(I=>new Promise((C,ae)=>{O.mutate(I.$id,{onSuccess:C,onError:ae})}))),o([]),f({title:"Success",description:`${d} processes deleted successfully`})}catch(d){console.error("Error deleting processes:",d),f({title:"Error",description:"Failed to delete selected processes",variant:"destructive"})}},_=async()=>{if(m.length===0){f({title:"Error",description:"Please select processes to export",variant:"destructive"});return}if(N)try{const d=m.map(I=>{const C={};return N.exportColumns.forEach(ae=>{let Se;switch(ae.dataKey){case"name":case"process_name":Se=I.process_name;break;case"description":Se=I.description||"";break;case"estimatedTime":Se=0;break;case"isActive":Se=I.status==="Active";break;default:Se=I[ae.dataKey]}C[ae.exportHeader]=ae.formatter?ae.formatter(Se):Se}),C});await Gt.exportToXLSX({filename:"processes-selected",headers:N.exportColumns.map(I=>I.exportHeader),data:d,format:"xlsx"}),f({title:"Success",description:`Exported ${m.length} selected process(es) successfully`})}catch(d){console.error("Export error:",d),f({title:"Error",description:"Failed to export selected processes",variant:"destructive"})}},B=()=>{p(null),Q(),i(!0)},ne=D.filter(d=>(d.process_name.toLowerCase().includes(r.toLowerCase())||d.department?.toLowerCase().includes(r.toLowerCase())||d.description?.toLowerCase().includes(r.toLowerCase()))&&(s==="all"||d.status===s)),L=ne.length,ee=ne.slice(0,g),H=(d,I)=>{o(I?[...m,d]:m.filter(C=>C.$id!==d.$id))},de=d=>{o(d?[...ee]:[])},K=ee.length>0&&ee.every(d=>m.some(I=>I.$id===d.$id)),h=m.length>0&&!K;return V?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("p",{className:"text-red-500",children:["Error loading processes: ",V.message]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Processes"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage manufacturing and operational processes"})]}),e.jsxs(ct,{open:n,onOpenChange:i,children:[e.jsx(vs,{asChild:!0,children:e.jsxs($,{onClick:B,className:"bg-primary hover:bg-primary/90",children:[e.jsx(Ct,{className:"h-4 w-4 mr-2"}),"Add New Process"]})}),e.jsxs(nt,{className:"sm:max-w-[500px]",children:[e.jsxs(it,{children:[e.jsx(lt,{children:c?"Edit Process":"Add New Process"}),e.jsxs(dt,{children:[c?"Update process information":"Enter process details to add a new process",e.jsxs("span",{className:"mt-2 text-sm text-muted-foreground",children:["Fields marked with ",e.jsx("span",{className:"text-red-500",children:"*"})," are required."]})]})]}),e.jsxs("form",{onSubmit:R,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(M,{htmlFor:"name",className:"text-right",children:["Process Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(G,{id:"name",value:x.name,onChange:d=>j({...x,name:d.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(M,{htmlFor:"department",className:"text-right",children:["Department ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(le,{value:x.department||"",onValueChange:d=>j({...x,department:d}),children:[e.jsx(ie,{className:"col-span-3",children:e.jsx(ce,{placeholder:"Select department"})}),e.jsxs(oe,{children:[e.jsx(S,{value:"Pre-Production",children:"Pre-Production"}),e.jsx(S,{value:"Production",children:"Production"}),e.jsx(S,{value:"Post Production",children:"Post Production"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-start gap-4",children:[e.jsx(M,{htmlFor:"description",className:"text-right mt-2",children:"Description"}),e.jsx(rs,{id:"description",value:x.description,onChange:d=>j({...x,description:d.target.value}),className:"col-span-3",rows:3,placeholder:"Enter process description..."})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(M,{htmlFor:"status",className:"text-right",children:"Status"}),e.jsxs(le,{value:x.status,onValueChange:d=>j({...x,status:d}),children:[e.jsx(ie,{className:"col-span-3",children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"Active",children:"Active"}),e.jsx(S,{value:"Inactive",children:"Inactive"}),e.jsx(S,{value:"Under Review",children:"Under Review"})]})]})]})]}),e.jsx(ot,{children:e.jsx($,{type:"submit",children:c?"Update":"Create"})})]})]})]})]}),e.jsx(te,{children:e.jsx(se,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(gt,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(G,{placeholder:"Search processes...",className:"pl-10",value:r,onChange:d=>t(d.target.value)})]}),e.jsxs($,{variant:"outline",children:[e.jsx(ts,{className:"h-4 w-4 mr-2"}),"Filter"]}),A&&e.jsx(qt,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:["Process Name"],optionalColumns:["Description","Estimated Time (minutes)"],validationRules:T,onImportComplete:d=>{d.successfulRows>0&&(P.invalidateQueries({queryKey:["processes"]}),f({title:"Import Successful",description:`${d.successfulRows} processes imported successfully.`}))}},variant:"outline"}),N&&e.jsx(At,{data:ne.map(d=>({name:d.process_name,description:d.description||"",estimatedTime:0,isActive:d.status==="Active",createdAt:d.$createdAt})),headers:N.exportColumns.map(d=>d.exportHeader),filename:"processes",variant:"outline"})]})})}),e.jsxs(te,{children:[e.jsx(pe,{children:e.jsxs(xe,{children:["Manufacturing Processes (",ne.length,")"]})}),e.jsxs(se,{children:[m.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 p-3 bg-muted rounded-md",children:[e.jsxs("span",{className:"text-sm font-medium",children:[m.length," selected"]}),e.jsx($,{variant:"destructive",size:"sm",onClick:Y,disabled:O.isPending,children:"Delete Selected"}),e.jsx($,{variant:"outline",size:"sm",onClick:_,children:"Export Selected"})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",Math.min(ee.length,L)," of ",L," records"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Records per page:"}),e.jsxs(le,{value:g.toString(),onValueChange:d=>b(Number(d)),children:[e.jsx(ie,{className:"w-[100px]",children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"50",children:"50"}),e.jsx(S,{value:"100",children:"100"}),e.jsx(S,{value:"500",children:"500"})]})]})]})]}),F?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:e.jsx("span",{children:"Loading processes..."})}):ne.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("p",{className:"text-lg mb-2",children:"No processes found"}),e.jsx("p",{className:"text-sm",children:"Add your first process to get started"})]}):e.jsx("div",{className:"border rounded-md overflow-auto",style:{maxHeight:"70vh"},children:e.jsxs(mt,{children:[e.jsx(ht,{children:e.jsxs(ke,{children:[e.jsx(J,{className:"w-12",children:e.jsx("input",{type:"checkbox",checked:K,ref:d=>{d&&(d.indeterminate=h)},onChange:d=>de(d.target.checked),className:"rounded border-gray-300"})}),e.jsx(J,{children:"Process Name"}),e.jsx(J,{children:"Department"}),e.jsx(J,{children:"Description"}),e.jsx(J,{children:"Status"}),e.jsx(J,{children:"Actions"})]})}),e.jsx(pt,{children:ee.map(d=>{const I=m.some(C=>C.$id===d.$id);return e.jsxs(ke,{children:[e.jsx(W,{children:e.jsx("input",{type:"checkbox",checked:I,onChange:C=>H(d,C.target.checked),className:"rounded border-gray-300"})}),e.jsx(W,{className:"font-medium",children:d.process_name}),e.jsx(W,{children:d.department||"-"}),e.jsx(W,{className:"max-w-xs truncate",children:d.description||"-"}),e.jsx(W,{children:e.jsx(et,{variant:d.status==="Active"?"default":d.status==="Under Review"?"secondary":"outline",children:d.status})}),e.jsx(W,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx($,{variant:"outline",size:"sm",onClick:()=>k(d),children:e.jsx(ss,{className:"h-4 w-4"})}),e.jsx($,{variant:"outline",size:"sm",onClick:()=>w(d.$id),children:e.jsx(Lt,{className:"h-4 w-4"})})]})})]},d.$id)})})]})})]})]})]})},sc=()=>{const[r,t]=u.useState(""),[s,a]=u.useState("all"),[n,i]=u.useState(!1),[c,p]=u.useState(null),[m,o]=u.useState([]),[g,b]=u.useState(50),[x,j]=u.useState({code:"",raw_product:"",uom:"",source:"Manufactured",status:"Active"}),{toast:f}=Fe(),P=xt(),{config:N}=Et("raw-products"),{validationRules:T,canImport:A}=Rt("raw-products"),{data:E=[],isLoading:D,error:F}=ye({queryKey:["rawProducts"],queryFn:async()=>await Cs.getAll()}),V=Ae({mutationFn:h=>{const d={code:h.code,raw_product:h.raw_product,uom:h.uom||"",source:h.source||"",status:h.status||"Active"};return Cs.create(d)},onSuccess:()=>{P.invalidateQueries({queryKey:["rawProducts"]}),f({title:"Success",description:"Raw product created successfully"}),i(!1),O()},onError:h=>{f({title:"Error",description:"Failed to create raw product",variant:"destructive"}),console.error("Error creating raw product:",h)}}),U=Ae({mutationFn:({id:h,data:d})=>{const I={code:d.code,raw_product:d.raw_product,uom:d.uom||"",source:d.source||"",status:d.status||"Active"};return Cs.update(h,I)},onSuccess:()=>{P.invalidateQueries({queryKey:["rawProducts"]}),f({title:"Success",description:"Raw product updated successfully"}),i(!1),O()},onError:h=>{f({title:"Error",description:"Failed to update raw product",variant:"destructive"}),console.error("Error updating raw product:",h)}}),Z=Ae({mutationFn:h=>Cs.delete(h),onSuccess:()=>{P.invalidateQueries({queryKey:["rawProducts"]}),f({title:"Success",description:"Raw product deleted successfully"})},onError:h=>{f({title:"Error",description:"Failed to delete raw product",variant:"destructive"}),console.error("Error deleting raw product:",h)}}),O=()=>{j({code:"",raw_product:"",uom:"",source:"Manufactured",status:"Active"}),p(null)},Q=h=>{if(h.preventDefault(),!x.code.trim()){f({title:"Error",description:"Code is required",variant:"destructive"});return}if(!x.raw_product.trim()){f({title:"Error",description:"Raw Product is required",variant:"destructive"});return}if(!x.uom.trim()){f({title:"Error",description:"UoM is required",variant:"destructive"});return}if(!x.source.trim()){f({title:"Error",description:"Source is required",variant:"destructive"});return}c?U.mutate({id:c.$id,data:x}):V.mutate(x)},R=h=>{p(h),j({code:h.code,raw_product:h.raw_product,uom:h.uom||"",source:h.source||"Manufactured",status:h.status}),i(!0)},k=h=>{window.confirm("Are you sure you want to delete this raw product?")&&Z.mutate(h)},w=async()=>{if(m.length===0){f({title:"Error",description:"Please select raw products to delete",variant:"destructive"});return}if(window.confirm(`Are you sure you want to delete ${m.length} selected raw product(s)?`))try{const h=m.length;await Promise.all(m.map(d=>new Promise((I,C)=>{Z.mutate(d.$id,{onSuccess:I,onError:C})}))),o([]),f({title:"Success",description:`${h} raw products deleted successfully`})}catch(h){console.error("Error deleting raw products:",h),f({title:"Error",description:"Failed to delete selected raw products",variant:"destructive"})}},Y=async()=>{if(m.length===0){f({title:"Error",description:"Please select raw products to export",variant:"destructive"});return}if(N)try{const h=m.map(d=>{const I={};return N.exportColumns.forEach(C=>{let ae;switch(C.dataKey){case"name":case"raw_product":ae=d.raw_product;break;case"code":ae=d.code;break;case"uom":ae=d.uom||"";break;case"source":ae=d.source||"";break;case"status":ae=d.status;break;default:ae=d[C.dataKey]}I[C.exportHeader]=C.formatter?C.formatter(ae):ae}),I});await Gt.exportToXLSX({filename:"raw-products-selected",headers:N.exportColumns.map(d=>d.exportHeader),data:h,format:"xlsx"}),f({title:"Success",description:`Exported ${m.length} selected raw product(s) successfully`})}catch(h){console.error("Export error:",h),f({title:"Error",description:"Failed to export selected raw products",variant:"destructive"})}},_=()=>{p(null),O(),i(!0)},B=E.filter(h=>{const d=h.raw_product.toLowerCase().includes(r.toLowerCase())||h.code.toLowerCase().includes(r.toLowerCase())||h.source?.toLowerCase().includes(r.toLowerCase()),I=s==="all"||h.status===s;return d&&I}),ne=B.length,L=B.slice(0,g),ee=(h,d)=>{o(d?[...m,h]:m.filter(I=>I.$id!==h.$id))},H=h=>{o(h?[...L]:[])},de=L.length>0&&L.every(h=>m.some(d=>d.$id===h.$id)),K=m.length>0&&!de;return F?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("p",{className:"text-red-500",children:["Error loading raw products: ",F.message]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Raw Products"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage raw materials and ingredients"})]}),e.jsxs(ct,{open:n,onOpenChange:i,children:[e.jsx(vs,{asChild:!0,children:e.jsxs($,{onClick:_,className:"bg-primary hover:bg-primary/90",children:[e.jsx(Ct,{className:"h-4 w-4 mr-2"}),"Add New Raw Product"]})}),e.jsxs(nt,{className:"sm:max-w-[500px]",children:[e.jsxs(it,{children:[e.jsx(lt,{children:c?"Edit Raw Product":"Add New Raw Product"}),e.jsxs(dt,{children:[c?"Update raw product information":"Enter raw product details to add a new material",e.jsxs("p",{className:"mt-2 text-sm text-muted-foreground",children:["Fields marked with ",e.jsx("span",{className:"text-red-500",children:"*"})," are required."]})]})]}),e.jsxs("form",{onSubmit:Q,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(M,{htmlFor:"code",className:"text-right",children:["Code ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(G,{id:"code",value:x.code,onChange:h=>j({...x,code:h.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(M,{htmlFor:"raw_product",className:"text-right",children:["Raw Product ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(G,{id:"raw_product",value:x.raw_product,onChange:h=>j({...x,raw_product:h.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(M,{htmlFor:"uom",className:"text-right",children:["UoM ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(le,{value:x.uom,onValueChange:h=>j({...x,uom:h}),children:[e.jsx(ie,{className:"col-span-3",children:e.jsx(ce,{placeholder:"Select unit of measure"})}),e.jsxs(oe,{children:[e.jsx(S,{value:"kg",children:"Kilogram (kg)"}),e.jsx(S,{value:"g",children:"Gram (g)"}),e.jsx(S,{value:"l",children:"Liter (l)"}),e.jsx(S,{value:"ml",children:"Milliliter (ml)"}),e.jsx(S,{value:"pcs",children:"Pieces (pcs)"}),e.jsx(S,{value:"box",children:"Box"}),e.jsx(S,{value:"bag",children:"Bag"}),e.jsx(S,{value:"ton",children:"Ton"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(M,{htmlFor:"source",className:"text-right",children:["Source ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(le,{value:x.source,onValueChange:h=>j({...x,source:h}),children:[e.jsx(ie,{className:"col-span-3",children:e.jsx(ce,{placeholder:"Select source type"})}),e.jsxs(oe,{children:[e.jsx(S,{value:"Manufactured",children:"Manufactured"}),e.jsx(S,{value:"Purchased",children:"Purchased"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(M,{htmlFor:"status",className:"text-right",children:"Status"}),e.jsxs(le,{value:x.status,onValueChange:h=>j({...x,status:h}),children:[e.jsx(ie,{className:"col-span-3",children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"Active",children:"Active"}),e.jsx(S,{value:"Inactive",children:"Inactive"}),e.jsx(S,{value:"Discontinued",children:"Discontinued"})]})]})]})]}),e.jsx(ot,{children:e.jsx($,{type:"submit",children:c?"Update":"Create"})})]})]})]})]}),e.jsx(te,{children:e.jsx(se,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(gt,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(G,{placeholder:"Search raw products...",className:"pl-10",value:r,onChange:h=>t(h.target.value)})]}),e.jsxs($,{variant:"outline",children:[e.jsx(ts,{className:"h-4 w-4 mr-2"}),"Filter"]}),A&&e.jsx(qt,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:["Raw Product Name","SKU","Unit"],optionalColumns:["Cost Per Unit","Description"],validationRules:T,onImportComplete:h=>{h.successfulRows>0&&(P.invalidateQueries({queryKey:["rawProducts"]}),f({title:"Import Successful",description:`${h.successfulRows} raw products imported successfully.`}))}},variant:"outline"}),N&&e.jsx(At,{data:B.map(h=>({name:h.raw_product,sku:h.code,unit:h.uom||"",costPerUnit:0,description:"",createdAt:h.$createdAt})),headers:N.exportColumns.map(h=>h.exportHeader),filename:"raw-products",variant:"outline"})]})})}),e.jsxs(te,{children:[e.jsx(pe,{children:e.jsxs(xe,{children:["Raw Materials (",B.length,")"]})}),e.jsxs(se,{children:[m.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 p-3 bg-muted rounded-md",children:[e.jsxs("span",{className:"text-sm font-medium",children:[m.length," selected"]}),e.jsx($,{variant:"destructive",size:"sm",onClick:w,disabled:Z.isPending,children:"Delete Selected"}),e.jsx($,{variant:"outline",size:"sm",onClick:Y,children:"Export Selected"})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",Math.min(L.length,ne)," of ",ne," records"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Records per page:"}),e.jsxs(le,{value:g.toString(),onValueChange:h=>b(Number(h)),children:[e.jsx(ie,{className:"w-[100px]",children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"50",children:"50"}),e.jsx(S,{value:"100",children:"100"}),e.jsx(S,{value:"500",children:"500"})]})]})]})]}),D?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:e.jsx("span",{children:"Loading raw products..."})}):B.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("p",{className:"text-lg mb-2",children:"No raw products found"}),e.jsx("p",{className:"text-sm",children:"Add your first raw product to get started"})]}):e.jsx("div",{className:"border rounded-md overflow-auto",style:{maxHeight:"70vh"},children:e.jsxs(mt,{children:[e.jsx(ht,{children:e.jsxs(ke,{children:[e.jsx(J,{className:"w-12",children:e.jsx("input",{type:"checkbox",checked:de,ref:h=>{h&&(h.indeterminate=K)},onChange:h=>H(h.target.checked),className:"rounded border-gray-300"})}),e.jsx(J,{children:"Code"}),e.jsx(J,{children:"Raw Product"}),e.jsx(J,{children:"UoM"}),e.jsx(J,{children:"Source"}),e.jsx(J,{children:"Status"}),e.jsx(J,{children:"Actions"})]})}),e.jsx(pt,{children:L.map(h=>{const d=m.some(I=>I.$id===h.$id);return e.jsxs(ke,{children:[e.jsx(W,{children:e.jsx("input",{type:"checkbox",checked:d,onChange:I=>ee(h,I.target.checked),className:"rounded border-gray-300"})}),e.jsx(W,{className:"font-medium",children:h.code}),e.jsx(W,{children:h.raw_product}),e.jsx(W,{children:h.uom||"-"}),e.jsx(W,{children:h.source&&e.jsx(et,{variant:h.source==="Manufactured"?"default":"secondary",children:h.source})}),e.jsx(W,{children:e.jsx(et,{variant:h.status==="Active"?"default":h.status==="Discontinued"?"destructive":"secondary",children:h.status})}),e.jsx(W,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx($,{variant:"outline",size:"sm",onClick:()=>R(h),children:e.jsx(ss,{className:"h-4 w-4"})}),e.jsx($,{variant:"outline",size:"sm",onClick:()=>k(h.$id),children:e.jsx(Lt,{className:"h-4 w-4"})})]})})]},h.$id)})})]})})]})]})]})},ac=()=>{const[r,t]=u.useState(""),[s,a]=u.useState("all"),[n,i]=u.useState(!1),[c,p]=u.useState(null),[m,o]=u.useState([]),[g,b]=u.useState(50),[x,j]=u.useState({sku:"",name:"",uom:"",min_level:"",status:"Active"}),{toast:f}=Fe(),P=xt(),{user:N}=vt(),{config:T}=Et("products"),{validationRules:A,canImport:E}=Rt("products"),{currentSort:D,handleSort:F,getSortedData:V}=as(),{data:U=[],isLoading:Z,error:O}=ye({queryKey:["products"],queryFn:async()=>await Vt.getAll(),enabled:!!N}),Q=Ae({mutationFn:d=>{const I={sku:d.sku,product:d.name,uom:d.uom||"",min_level:d.min_level,status:d.status||"Active"};return Vt.create(I)},onSuccess:()=>{P.invalidateQueries({queryKey:["products"]}),f({title:"Success",description:"Product created successfully"}),i(!1),w()},onError:d=>{f({title:"Error",description:"Failed to create product",variant:"destructive"}),console.error("Error creating product:",d)}}),R=Ae({mutationFn:({id:d,data:I})=>{const C={sku:I.sku,product:I.name,uom:I.uom||"",min_level:I.min_level,status:I.status||"Active"};return Vt.update(d,C)},onSuccess:()=>{P.invalidateQueries({queryKey:["products"]}),f({title:"Success",description:"Product updated successfully"}),i(!1),w()},onError:d=>{f({title:"Error",description:"Failed to update product",variant:"destructive"}),console.error("Error updating product:",d)}}),k=Ae({mutationFn:d=>Vt.delete(d),onSuccess:()=>{P.invalidateQueries({queryKey:["products"]}),f({title:"Success",description:"Product deleted successfully"})},onError:d=>{f({title:"Error",description:"Failed to delete product",variant:"destructive"}),console.error("Error deleting product:",d)}}),w=()=>{j({sku:"",name:"",uom:"",min_level:"",status:"Active"}),p(null)},Y=d=>{if(d.preventDefault(),!x.sku?.trim()){f({title:"Error",description:"SKU is required",variant:"destructive"});return}if(!x.name?.trim()){f({title:"Error",description:"Product Name is required",variant:"destructive"});return}if(!x.uom?.trim()){f({title:"Error",description:"Unit of Measure is required",variant:"destructive"});return}if(!x.min_level?.trim()){f({title:"Error",description:"Minimum Level is required",variant:"destructive"});return}const I={...x,min_level:x.min_level?parseInt(x.min_level):void 0};c?R.mutate({id:c.$id,data:I}):Q.mutate(I)},_=d=>{p(d),j({sku:d.sku,name:d.product,uom:d.uom||"",min_level:d.min_level?.toString()||"",status:d.status}),i(!0)},B=d=>{confirm("Are you sure you want to delete this product?")&&k.mutate(d)},ne=async()=>{if(m.length===0){f({title:"Error",description:"Please select products to delete",variant:"destructive"});return}if(window.confirm(`Are you sure you want to delete ${m.length} selected product(s)?`))try{const d=m.length;await Promise.all(m.map(I=>new Promise((C,ae)=>{k.mutate(I.$id,{onSuccess:C,onError:ae})}))),o([]),f({title:"Success",description:`${d} products deleted successfully`})}catch(d){console.error("Error deleting products:",d),f({title:"Error",description:"Failed to delete selected products",variant:"destructive"})}},L=async()=>{if(m.length===0){f({title:"Error",description:"Please select products to export",variant:"destructive"});return}if(T)try{const d=m.map(I=>{const C={};return T.exportColumns.forEach(ae=>{let Se;switch(ae.dataKey){case"sku":Se=I.sku;break;case"name":case"product":Se=I.product;break;case"uom":Se=I.uom||"";break;case"min_level":Se=I.min_level||0;break;case"status":Se=I.status;break;default:Se=I[ae.dataKey]}C[ae.exportHeader]=ae.formatter?ae.formatter(Se):Se}),C});await Gt.exportToXLSX({filename:"products-selected",headers:T.exportColumns.map(I=>I.exportHeader),data:d,format:"xlsx"}),f({title:"Success",description:`Exported ${m.length} selected product(s) successfully`})}catch(d){console.error("Export error:",d),f({title:"Error",description:"Failed to export selected products",variant:"destructive"})}},ee=()=>{p(null),w(),i(!0)},H=U.filter(d=>{const I=d.product.toLowerCase().includes(r.toLowerCase())||d.sku.toLowerCase().includes(r.toLowerCase()),C=s==="all"||d.status===s;return I&&C}),de=V(H),K=de.length,h=de.slice(0,g);return O?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("p",{className:"text-red-500",children:["Error loading products: ",O.message]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Products"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage finished products and inventory"})]}),e.jsxs(ct,{open:n,onOpenChange:i,children:[e.jsx(vs,{asChild:!0,children:e.jsxs($,{onClick:ee,className:"bg-primary hover:bg-primary/90",children:[e.jsx(Ct,{className:"h-4 w-4 mr-2"}),"Add New Product"]})}),e.jsxs(nt,{className:"sm:max-w-[500px]",children:[e.jsxs(it,{children:[e.jsx(lt,{children:c?"Edit Product":"Add New Product"}),e.jsxs(dt,{children:[c?"Update product information":"Enter product details to add a new finished product",e.jsxs("span",{className:"mt-2 text-sm text-muted-foreground",children:["Fields marked with ",e.jsx("span",{className:"text-red-500",children:"*"})," are required."]})]})]}),e.jsxs("form",{onSubmit:Y,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(M,{htmlFor:"sku",className:"text-right",children:["SKU ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(G,{id:"sku",value:x.sku,onChange:d=>j({...x,sku:d.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(M,{htmlFor:"product",className:"text-right",children:["Product ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(G,{id:"product",value:x.name,onChange:d=>j({...x,name:d.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(M,{htmlFor:"uom",className:"text-right",children:["UoM ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(le,{value:x.uom,onValueChange:d=>j({...x,uom:d}),children:[e.jsx(ie,{className:"col-span-3",children:e.jsx(ce,{placeholder:"Select unit of measure"})}),e.jsxs(oe,{children:[e.jsx(S,{value:"kg",children:"Kilogram (kg)"}),e.jsx(S,{value:"g",children:"Gram (g)"}),e.jsx(S,{value:"l",children:"Liter (l)"}),e.jsx(S,{value:"ml",children:"Milliliter (ml)"}),e.jsx(S,{value:"pcs",children:"Pieces (pcs)"}),e.jsx(S,{value:"box",children:"Box"}),e.jsx(S,{value:"pack",children:"Pack"}),e.jsx(S,{value:"bottle",children:"Bottle"}),e.jsx(S,{value:"can",children:"Can"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(M,{htmlFor:"min_level",className:"text-right",children:["Min Level ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(G,{id:"min_level",type:"number",value:x.min_level,onChange:d=>j({...x,min_level:d.target.value}),className:"col-span-3",min:"0",maxLength:6,placeholder:"Minimum stock level"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(M,{htmlFor:"status",className:"text-right",children:"Status"}),e.jsxs(le,{value:x.status,onValueChange:d=>j({...x,status:d}),children:[e.jsx(ie,{className:"col-span-3",children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"Active",children:"Active"}),e.jsx(S,{value:"Inactive",children:"Inactive"}),e.jsx(S,{value:"Discontinued",children:"Discontinued"})]})]})]})]}),e.jsx(ot,{children:e.jsx($,{type:"submit",children:c?"Update":"Create"})})]})]})]})]}),e.jsx(te,{children:e.jsx(se,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(gt,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(G,{placeholder:"Search products...",className:"pl-10",value:r,onChange:d=>t(d.target.value)})]}),e.jsxs($,{variant:"outline",children:[e.jsx(ts,{className:"h-4 w-4 mr-2"}),"Filter"]}),E&&e.jsx(qt,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:["Product Name","SKU"],optionalColumns:["Category","Price","Description"],validationRules:A,onImportComplete:d=>{d.successfulRows>0&&(P.invalidateQueries({queryKey:["products"]}),f({title:"Import Successful",description:`${d.successfulRows} products imported successfully.`}))}},variant:"outline"}),T&&e.jsx(At,{data:H.map(d=>({name:d.product,sku:d.sku,category:"",price:0,description:"",isActive:d.status==="Active",createdAt:d.$createdAt})),headers:T.exportColumns.map(d=>d.exportHeader),filename:"products",variant:"outline"})]})})}),e.jsxs(te,{children:[e.jsx(pe,{children:e.jsxs(xe,{children:["Finished Products (",H.length,")"]})}),e.jsxs(se,{children:[m.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 p-3 bg-muted rounded-md",children:[e.jsxs("span",{className:"text-sm font-medium",children:[m.length," selected"]}),e.jsx($,{variant:"destructive",size:"sm",onClick:ne,disabled:k.isPending,children:"Delete Selected"}),e.jsx($,{variant:"outline",size:"sm",onClick:L,children:"Export Selected"})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",Math.min(h.length,K)," of ",K," records"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Records per page:"}),e.jsxs(le,{value:g.toString(),onValueChange:d=>b(Number(d)),children:[e.jsx(ie,{className:"w-[100px]",children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"50",children:"50"}),e.jsx(S,{value:"100",children:"100"}),e.jsx(S,{value:"500",children:"500"})]})]})]})]}),e.jsx("div",{className:"border rounded-md overflow-auto",style:{maxHeight:"70vh"},children:e.jsx(ds,{maxHeight:"none",selectable:!0,selectedRows:m,onSelectionChange:o,rowKey:"$id",data:h.map(d=>({...d,sku:d.sku||"",product:d.product||"",uom:d.uom||"-",min_level:d.min_level||0,status:d.status||"Active"})),columns:[{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"product",label:"Product Name",sortable:!0,dataType:"string"},{key:"uom",label:"UoM",sortable:!0,dataType:"string"},{key:"min_level",label:"Min Level",sortable:!0,dataType:"number",align:"right"},{key:"status",label:"Status",sortable:!0,dataType:"string"}],onSort:F,currentSort:D,loading:Z,emptyMessage:"No products found",actions:[{label:"Edit",icon:e.jsx(ss,{className:"h-4 w-4"}),onClick:_},{label:"Delete",icon:e.jsx(Lt,{className:"h-4 w-4"}),onClick:d=>B(d.$id),variant:"destructive"}]})})]})]})]})},rc=()=>{const[r,t]=u.useState(""),[s,a]=u.useState("all"),[n,i]=u.useState(!1),[c,p]=u.useState(null),[m,o]=u.useState([]),[g,b]=u.useState(50),[x,j]=u.useState({channel_name:"",description:"",type:"Online",contact_person:"",phone:"",email:"",status:"Active"}),{toast:f}=Fe(),P=xt(),{config:N}=Et("sales-channels"),{validationRules:T,canImport:A}=Rt("sales-channels"),{data:E=[],isLoading:D,error:F}=ye({queryKey:["salesChannels"],queryFn:async()=>await Ps.getAll()}),V=Ae({mutationFn:h=>{const d={channel_name:h.channel_name,type:h.type,description:h.description||"",contact_person:h.contact_person||"",phone:h.phone||"",status:h.status||"Active"};return h.email&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(h.email)&&(d.email=h.email),Ps.create(d)},onSuccess:()=>{P.invalidateQueries({queryKey:["salesChannels"]}),f({title:"Success",description:"Sales channel created successfully"}),i(!1),O()},onError:h=>{f({title:"Error",description:"Failed to create sales channel",variant:"destructive"}),console.error("Error creating sales channel:",h)}}),U=Ae({mutationFn:({id:h,data:d})=>{const I={channel_name:d.channel_name,type:d.type,description:d.description||"",contact_person:d.contact_person||"",phone:d.phone||"",status:d.status||"Active"};return d.email&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(d.email)?I.email=d.email:d.email===""&&(I.email=""),Ps.update(h,I)},onSuccess:()=>{P.invalidateQueries({queryKey:["salesChannels"]}),f({title:"Success",description:"Sales channel updated successfully"}),i(!1),O()},onError:h=>{f({title:"Error",description:"Failed to update sales channel",variant:"destructive"}),console.error("Error updating sales channel:",h)}}),Z=Ae({mutationFn:h=>Ps.delete(h),onSuccess:()=>{P.invalidateQueries({queryKey:["salesChannels"]}),f({title:"Success",description:"Sales channel deleted successfully"})},onError:h=>{f({title:"Error",description:"Failed to delete sales channel",variant:"destructive"}),console.error("Error deleting sales channel:",h)}}),O=()=>{j({channel_name:"",description:"",type:"Online",contact_person:"",phone:"",email:"",status:"Active"}),p(null)},Q=h=>{if(h.preventDefault(),!x.channel_name.trim()){f({title:"Error",description:"Channel Name is required",variant:"destructive"});return}if(!x.type.trim()){f({title:"Error",description:"Type is required",variant:"destructive"});return}if(x.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(x.email)){f({title:"Error",description:"Please enter a valid email address",variant:"destructive"});return}c?U.mutate({id:c.$id,data:x}):V.mutate(x)},R=h=>{p(h),j({channel_name:h.channel_name,description:h.description||"",type:h.type||"Online",contact_person:h.contact_person||"",phone:h.phone||"",email:h.email||"",status:h.status}),i(!0)},k=h=>{confirm("Are you sure you want to delete this sales channel?")&&Z.mutate(h)},w=async()=>{if(m.length===0){f({title:"Error",description:"Please select sales channels to delete",variant:"destructive"});return}if(window.confirm(`Are you sure you want to delete ${m.length} selected sales channel(s)?`))try{const h=m.length;await Promise.all(m.map(d=>new Promise((I,C)=>{Z.mutate(d.$id,{onSuccess:I,onError:C})}))),o([]),f({title:"Success",description:`${h} sales channels deleted successfully`})}catch(h){console.error("Error deleting sales channels:",h),f({title:"Error",description:"Failed to delete selected sales channels",variant:"destructive"})}},Y=async()=>{if(m.length===0){f({title:"Error",description:"Please select sales channels to export",variant:"destructive"});return}if(N)try{const h=m.map(d=>{const I={};return N.exportColumns.forEach(C=>{let ae;switch(C.dataKey){case"name":case"channel_name":ae=d.channel_name;break;case"description":ae=d.description||"";break;case"isActive":ae=d.status==="Active";break;default:ae=d[C.dataKey]}I[C.exportHeader]=C.formatter?C.formatter(ae):ae}),I});await Gt.exportToXLSX({filename:"sales-channels-selected",headers:N.exportColumns.map(d=>d.exportHeader),data:h,format:"xlsx"}),f({title:"Success",description:`Exported ${m.length} selected sales channel(s) successfully`})}catch(h){console.error("Export error:",h),f({title:"Error",description:"Failed to export selected sales channels",variant:"destructive"})}},_=()=>{p(null),O(),i(!0)},B=E.filter(h=>{const d=h.channel_name.toLowerCase().includes(r.toLowerCase())||h.type?.toLowerCase().includes(r.toLowerCase())||h.contact_person?.toLowerCase().includes(r.toLowerCase()),I=s==="all"||h.status===s;return d&&I}),ne=B.length,L=B.slice(0,g),ee=(h,d)=>{o(d?[...m,h]:m.filter(I=>I.$id!==h.$id))},H=h=>{o(h?[...L]:[])},de=L.length>0&&L.every(h=>m.some(d=>d.$id===h.$id)),K=m.length>0&&!de;return F?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("p",{className:"text-red-500",children:["Error loading sales channels: ",F.message]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Sales Channels"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage sales distribution channels and partners"})]}),e.jsxs(ct,{open:n,onOpenChange:i,children:[e.jsx(vs,{asChild:!0,children:e.jsxs($,{onClick:_,className:"bg-primary hover:bg-primary/90",children:[e.jsx(Ct,{className:"h-4 w-4 mr-2"}),"Add New Channel"]})}),e.jsxs(nt,{className:"sm:max-w-[500px]",children:[e.jsxs(it,{children:[e.jsx(lt,{children:c?"Edit Sales Channel":"Add New Sales Channel"}),e.jsxs(dt,{children:[c?"Update sales channel information":"Enter sales channel details to add a new distribution partner",e.jsxs("p",{className:"mt-2 text-sm text-muted-foreground",children:["Fields marked with ",e.jsx("span",{className:"text-red-500",children:"*"})," are required."]})]})]}),e.jsxs("form",{onSubmit:Q,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(M,{htmlFor:"channel_name",className:"text-right",children:["Channel Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(G,{id:"channel_name",value:x.channel_name,onChange:h=>j({...x,channel_name:h.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-start gap-4",children:[e.jsx(M,{htmlFor:"description",className:"text-right mt-2",children:"Description"}),e.jsx(rs,{id:"description",value:x.description,onChange:h=>j({...x,description:h.target.value}),className:"col-span-3",rows:3,placeholder:"Enter channel description..."})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(M,{htmlFor:"type",className:"text-right",children:["Type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(le,{value:x.type,onValueChange:h=>j({...x,type:h}),children:[e.jsx(ie,{className:"col-span-3",children:e.jsx(ce,{placeholder:"Select channel type"})}),e.jsxs(oe,{children:[e.jsx(S,{value:"Online",children:"Online"}),e.jsx(S,{value:"Retail",children:"Retail"}),e.jsx(S,{value:"Wholesale",children:"Wholesale"}),e.jsx(S,{value:"Direct Sales",children:"Direct Sales"}),e.jsx(S,{value:"Distributor",children:"Distributor"}),e.jsx(S,{value:"E-commerce",children:"E-commerce"}),e.jsx(S,{value:"Export",children:"Export"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(M,{htmlFor:"contact_person",className:"text-right",children:"Contact Person"}),e.jsx(G,{id:"contact_person",value:x.contact_person,onChange:h=>j({...x,contact_person:h.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(M,{htmlFor:"phone",className:"text-right",children:"Phone"}),e.jsx(G,{id:"phone",value:x.phone,onChange:h=>j({...x,phone:h.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(M,{htmlFor:"email",className:"text-right",children:"Email"}),e.jsx(G,{id:"email",type:"email",value:x.email,onChange:h=>j({...x,email:h.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(M,{htmlFor:"status",className:"text-right",children:"Status"}),e.jsxs(le,{value:x.status,onValueChange:h=>j({...x,status:h}),children:[e.jsx(ie,{className:"col-span-3",children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"Active",children:"Active"}),e.jsx(S,{value:"Inactive",children:"Inactive"}),e.jsx(S,{value:"Pending",children:"Pending"})]})]})]})]}),e.jsx(ot,{children:e.jsx($,{type:"submit",children:c?"Update":"Create"})})]})]})]})]}),e.jsx(te,{children:e.jsx(se,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(gt,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(G,{placeholder:"Search sales channels...",className:"pl-10",value:r,onChange:h=>t(h.target.value)})]}),e.jsxs($,{variant:"outline",children:[e.jsx(ts,{className:"h-4 w-4 mr-2"}),"Filter"]}),A&&e.jsx(qt,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:["Channel Name","Type"],optionalColumns:["Commission (%)","Description"],validationRules:T,onImportComplete:h=>{h.successfulRows>0&&(P.invalidateQueries({queryKey:["salesChannels"]}),f({title:"Import Successful",description:`${h.successfulRows} sales channels imported successfully.`}))}},variant:"outline"}),N&&e.jsx(At,{data:B.map(h=>({name:h.channel_name,type:h.type||"",commission:0,description:h.description||"",isActive:h.status==="Active",createdAt:h.$createdAt})),headers:N.exportColumns.map(h=>h.exportHeader),filename:"sales-channels",variant:"outline"})]})})}),e.jsxs(te,{children:[e.jsx(pe,{children:e.jsxs(xe,{children:["Distribution Channels (",B.length,")"]})}),e.jsxs(se,{children:[m.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 p-3 bg-muted rounded-md",children:[e.jsxs("span",{className:"text-sm font-medium",children:[m.length," selected"]}),e.jsx($,{variant:"destructive",size:"sm",onClick:w,disabled:Z.isPending,children:"Delete Selected"}),e.jsx($,{variant:"outline",size:"sm",onClick:Y,children:"Export Selected"})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",Math.min(L.length,ne)," of ",ne," records"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Records per page:"}),e.jsxs(le,{value:g.toString(),onValueChange:h=>b(Number(h)),children:[e.jsx(ie,{className:"w-[100px]",children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"50",children:"50"}),e.jsx(S,{value:"100",children:"100"}),e.jsx(S,{value:"500",children:"500"})]})]})]})]}),D?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:e.jsx("span",{children:"Loading sales channels..."})}):B.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("p",{className:"text-lg mb-2",children:"No sales channels found"}),e.jsx("p",{className:"text-sm",children:"Add your first sales channel to get started"})]}):e.jsx("div",{className:"border rounded-md overflow-auto",style:{maxHeight:"70vh"},children:e.jsxs(mt,{children:[e.jsx(ht,{children:e.jsxs(ke,{children:[e.jsx(J,{className:"w-12",children:e.jsx("input",{type:"checkbox",checked:de,ref:h=>{h&&(h.indeterminate=K)},onChange:h=>H(h.target.checked),className:"rounded border-gray-300"})}),e.jsx(J,{children:"Channel Name"}),e.jsx(J,{children:"Description"}),e.jsx(J,{children:"Type"}),e.jsx(J,{children:"Contact Person"}),e.jsx(J,{children:"Phone"}),e.jsx(J,{children:"Email"}),e.jsx(J,{children:"Status"}),e.jsx(J,{children:"Actions"})]})}),e.jsx(pt,{children:L.map(h=>{const d=m.some(I=>I.$id===h.$id);return e.jsxs(ke,{children:[e.jsx(W,{children:e.jsx("input",{type:"checkbox",checked:d,onChange:I=>ee(h,I.target.checked),className:"rounded border-gray-300"})}),e.jsx(W,{className:"font-medium",children:h.channel_name}),e.jsx(W,{className:"max-w-xs truncate",children:h.description||"-"}),e.jsx(W,{children:h.type&&e.jsx(et,{variant:"outline",children:h.type})}),e.jsx(W,{children:h.contact_person||"-"}),e.jsx(W,{children:h.phone||"-"}),e.jsx(W,{children:h.email||"-"}),e.jsx(W,{children:e.jsx(et,{variant:h.status==="Active"?"default":h.status==="Pending"?"secondary":"outline",children:h.status})}),e.jsx(W,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx($,{variant:"outline",size:"sm",onClick:()=>R(h),children:e.jsx(ss,{className:"h-4 w-4"})}),e.jsx($,{variant:"outline",size:"sm",onClick:()=>k(h.$id),children:e.jsx(Lt,{className:"h-4 w-4"})})]})})]},h.$id)})})]})})]})]})]})},nc=()=>{const{data:r,isLoading:t,error:s}=ye({queryKey:["stock-categories"],queryFn:()=>Yt.getCategories()});return{categories:r,isLoading:t,error:s}},ic=()=>{const[r,t]=u.useState({from:Tt(new Date),to:Dt(new Date)}),[s,a]=u.useState(void 0),[n,i]=u.useState(""),{toast:c}=Fe(),p=xt(),{stockStatus:m,isLoading:o}=Ga(r?.from,r?.to,{category:s,searchTerm:n}),{categories:g}=nc(),b=async()=>{try{await p.invalidateQueries({queryKey:["stocks"]}),await p.invalidateQueries({queryKey:["purchases"]}),await p.invalidateQueries({queryKey:["tasks"]}),c({title:"Stock Data Refreshed",description:"Data updated successfully"})}catch{c({title:"Refresh Failed",description:"Please try again",variant:"destructive"})}};return e.jsxs(te,{children:[e.jsxs(pe,{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(xe,{children:"Stock Status"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs($,{variant:"outline",onClick:b,disabled:o,children:[e.jsx(Ka,{className:`h-4 w-4 mr-1 ${o?"animate-spin":""}`}),"Refresh Data"]}),e.jsx($,{variant:"outline",children:"Export"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-4",children:[e.jsx(js,{value:r,onChange:t,className:"w-[300px]"}),e.jsxs(le,{onValueChange:a,value:s,children:[e.jsx(ie,{className:"w-[180px]",children:e.jsx(ce,{placeholder:"All Categories"})}),e.jsxs(oe,{children:[e.jsx(S,{value:"all",children:"All Categories"}),g?.map(x=>e.jsx(S,{value:x,children:x},x))]})]}),e.jsx(G,{placeholder:"Search...",className:"w-[200px]",value:n,onChange:x=>i(x.target.value)})]})]}),e.jsx(se,{children:e.jsxs(mt,{children:[e.jsx(ht,{children:e.jsxs(ke,{children:[e.jsx(J,{children:"Stock Name"}),e.jsx(J,{children:"Category"}),e.jsx(J,{className:"text-right",children:"Opening Balance"}),e.jsx(J,{className:"text-right bg-purple-50",children:"Purchases"}),e.jsx(J,{className:"text-right bg-green-50",children:"Utilised"}),e.jsx(J,{className:"text-right",children:"Closing Balance"}),e.jsx(J,{className:"text-right",children:"Min Level"}),e.jsx(J,{children:"Status"})]})}),e.jsx(pt,{children:o?e.jsx(ke,{children:e.jsxs(W,{colSpan:8,className:"text-center py-12",children:[e.jsx(Be,{className:"h-8 w-8 animate-spin mx-auto mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading stock status..."})]})}):m.length===0?e.jsx(ke,{children:e.jsx(W,{colSpan:8,className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"No stock data found for the selected criteria"})})}):m.map((x,j)=>e.jsxs(ke,{children:[e.jsx(W,{children:x.stock_name}),e.jsx(W,{children:x.category||"N/A"}),e.jsx(W,{className:"text-right",children:(x.opening_balance||0).toLocaleString()}),e.jsx(W,{className:"text-right bg-purple-50 font-medium",children:(x.purchases||0).toLocaleString()}),e.jsx(W,{className:"text-right bg-green-50 font-medium",children:(x.utilised||0).toLocaleString()}),e.jsx(W,{className:"text-right font-semibold",children:e.jsx("span",{className:(x.closing_balance||0)<0?"text-red-600":"text-green-600",children:(x.closing_balance||0).toLocaleString()})}),e.jsx(W,{className:"text-right text-muted-foreground",children:(x.min_level||0).toLocaleString()}),e.jsx(W,{children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${x.status==="Out of Stock"?"bg-red-100 text-red-800":x.status==="Low Stock"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:x.status||"In Stock"})})]},x.stock_id||`stock-${j}`))})]})})]})},Ja=()=>{const{data:r=[],isLoading:t,error:s}=ye({queryKey:["stocks"],queryFn:async()=>await Yt.getAll()});return{data:r,isLoading:t,error:s}},Is=()=>{const{data:r=[],isLoading:t,error:s}=ye({queryKey:["staff"],queryFn:async()=>await Il.getAll(),staleTime:3e5,gcTime:9e5,refetchOnWindowFocus:!1});return{data:r,isLoading:t,error:s}},us=()=>{const{data:r=[],isLoading:t,error:s}=ye({queryKey:["processes"],queryFn:async()=>await ys.getAll(),staleTime:3e5,gcTime:9e5,refetchOnWindowFocus:!1});return{data:r,isLoading:t,error:s}},Bn=()=>{const{data:r=[],isLoading:t,error:s}=ye({queryKey:["products"],queryFn:async()=>await Vt.getAll(),staleTime:3e5,gcTime:9e5,refetchOnWindowFocus:!1});return{data:r,isLoading:t,error:s}},Xa=()=>{const{data:r=[],isLoading:t,error:s}=ye({queryKey:["rawProducts"],queryFn:async()=>await Cs.getAll(),staleTime:3e5,gcTime:9e5,refetchOnWindowFocus:!1});return{data:r,isLoading:t,error:s}},oc=()=>{const r=xt(),[t,s]=u.useState(""),[a,n]=u.useState({from:Tt(new Date),to:Dt(new Date)}),[i,c]=u.useState(""),{data:p}=us(),m=a.from?Xe(a.from,"yyyy-MM-dd"):void 0,o=a.to?Xe(a.to,"yyyy-MM-dd"):void 0,{toast:g}=Fe(),{statusRecords:b,isLoading:x}=Da(m,o,{processId:i||void 0}),j=u.useMemo(()=>b?b.filter(N=>(N.stock_name||"").toLowerCase().includes(t.toLowerCase())||(N.process||"").toLowerCase().includes(t.toLowerCase())):[],[b,t]),f=async()=>{try{await r.invalidateQueries({queryKey:["stocks"]}),await r.invalidateQueries({queryKey:["processes"]}),await r.invalidateQueries({queryKey:["preProductionTasks"]}),await r.invalidateQueries({queryKey:["productionTasksForPreStatus"]}),g({title:"Pre-Production Data Refreshed",description:"Data updated successfully"})}catch{g({title:"Refresh Failed",description:"Please try again",variant:"destructive"})}},P=()=>{const T=[["Stock Name","Process","Opening Balance","Effective Completed","Wastage Qty","Utilised","Closing Balance","Min Level","Status"].join(","),...j.map(V=>[`"${V.stock_name}"`,`"${V.process}"`,V.opening_balance.toFixed(2),V.effective_completed.toFixed(2),V.wastage_qty.toFixed(2),V.utilised.toFixed(2),V.closing_balance.toFixed(2),(V.min_level||0).toFixed(2),`"${V.status||"In Stock"}"`].join(","))].join(`
`),A=new Blob([T],{type:"text/csv;charset=utf-8;"}),E=URL.createObjectURL(A),D=document.createElement("a");D.setAttribute("href",E);const F=m&&o?`_${m}_to_${o}`:"";D.setAttribute("download",`pre-production-status${F}_${new Date().toISOString().split("T")[0]}.csv`),D.style.visibility="hidden",document.body.appendChild(D),D.click(),document.body.removeChild(D)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Pre-Production Status"}),e.jsx("p",{className:"text-muted-foreground",children:"Track material flow through pre-production stages"})]}),e.jsx(te,{children:e.jsx(se,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("div",{className:"relative w-full md:w-auto",children:[e.jsx(gt,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(G,{placeholder:"Search stock or process...",className:"w-full pl-8 md:w-[200px] lg:w-[300px]",value:t,onChange:N=>s(N.target.value)})]}),e.jsx(js,{value:a,onChange:N=>{N?.from&&N?.to&&n({from:N.from,to:N.to})}}),e.jsxs(le,{value:i||"all",onValueChange:N=>c(N==="all"?"":N),children:[e.jsx(ie,{className:"w-[180px]",children:e.jsx(ce,{placeholder:"All Processes"})}),e.jsxs(oe,{children:[e.jsx(S,{value:"all",children:"All Processes"}),p?.filter(N=>{const T=N.process_name?.toLowerCase();return["cleaning","c & d","roasting","rfp"].includes(T)}).map(N=>e.jsx(S,{value:N.$id,children:N.process_name},N.$id))]})]}),e.jsx($,{onClick:f,variant:"outline",size:"icon",disabled:x,children:e.jsx(za,{className:`h-4 w-4 ${x?"animate-spin":""}`})}),e.jsx($,{onClick:P,variant:"outline",size:"icon",disabled:!j||j.length===0,children:e.jsx(xs,{className:"h-4 w-4"})})]})})}),x?e.jsx(te,{children:e.jsxs(se,{className:"py-12 text-center",children:[e.jsx(Be,{className:"h-8 w-8 animate-spin mx-auto mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading pre-production status..."})]})}):e.jsxs(te,{children:[e.jsx(pe,{children:e.jsx(xe,{children:"Status Details"})}),e.jsx(se,{children:e.jsxs(mt,{children:[e.jsx(ht,{children:e.jsxs(ke,{children:[e.jsx(J,{children:"Stock Name"}),e.jsx(J,{children:"Process"}),e.jsx(J,{className:"text-right",children:"Opening Balance"}),e.jsx(J,{className:"text-right bg-purple-50",children:"Effective Completed"}),e.jsx(J,{className:"text-right",children:"Wastage Qty"}),e.jsx(J,{className:"text-right bg-green-50",children:"Utilised"}),e.jsx(J,{className:"text-right",children:"Closing Balance"}),e.jsx(J,{className:"text-right",children:"Min Level"}),e.jsx(J,{children:"Status"})]})}),e.jsx(pt,{children:j&&j.length>0?j.map((N,T)=>e.jsxs(ke,{children:[e.jsx(W,{children:N.stock_name}),e.jsx(W,{children:N.process}),e.jsx(W,{className:"text-right",children:N.opening_balance.toFixed(2)}),e.jsx(W,{className:"text-right bg-purple-50 font-medium",children:N.effective_completed.toFixed(2)}),e.jsx(W,{className:"text-right",children:N.wastage_qty.toFixed(2)}),e.jsx(W,{className:"text-right bg-green-50 font-medium",children:N.utilised.toFixed(2)}),e.jsx(W,{className:"text-right font-semibold",children:e.jsx("span",{className:N.closing_balance<0?"text-red-600":"text-green-600",children:N.closing_balance.toFixed(2)})}),e.jsx(W,{className:"text-right text-muted-foreground",children:(N.min_level||0).toFixed(2)}),e.jsx(W,{children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${N.status==="Out of Stock"?"bg-red-100 text-red-800":N.status==="Low Stock"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:N.status||"In Stock"})})]},`${N.stock_name}-${N.process}-${T}`)):e.jsx(ke,{children:e.jsx(W,{colSpan:9,className:"text-center",children:"No pre-production status found for the selected criteria."})})})]})})]})]})},Za=(r,t,s={})=>{const{processId:a}=s,n=r?Kt(r):void 0,i=t?Kt(t):void 0,c=n?zs(n,1):void 0,p=n?Xe(n,"yyyy-MM-dd"):void 0,m=i?Xe(i,"yyyy-MM-dd"):void 0,o=c?Xe(c,"yyyy-MM-dd"):void 0,{data:g=[],isLoading:b}=ye({queryKey:["stocks"],queryFn:()=>Yt.getAll(),staleTime:600*1e3}),{data:x=[],isLoading:j}=ye({queryKey:["processes"],queryFn:()=>ys.getAll(),staleTime:600*1e3}),{data:f=[],isLoading:P}=ye({queryKey:["rawProducts"],queryFn:()=>Cs.getAll(),staleTime:600*1e3}),{data:N=[],isLoading:T}=ye({queryKey:["products"],queryFn:()=>Vt.getAll(),staleTime:600*1e3}),{data:A=[],isLoading:E}=ye({queryKey:["productionTasks",p,m,a],queryFn:()=>Wt.getProductionTasksWithRelations(p,m,a),enabled:!!n&&!!i,staleTime:300*1e3}),{data:D=[]}=ye({queryKey:["productionTasksBefore",o,a],queryFn:()=>Wt.getProductionTasksWithRelations(void 0,o,a),enabled:!!c,staleTime:300*1e3}),{data:F=[]}=ye({queryKey:["postProductionTasks",p,m],queryFn:()=>es.getPostProductionTasksWithRelations(),enabled:!!n&&!!i,staleTime:300*1e3});return{statusRecords:u.useMemo(()=>{if(!x.length||!f.length||!N.length)return[];const Z=a?x.filter(_=>_.$id===a):x.filter(_=>{const B=_.process_name?.toLowerCase();return B==="grinding"||B==="blending"}),O=new Map(Z.map(_=>[_.$id,_.process_name])),Q=new Map(f.map(_=>[_.$id,_])),R=_=>{const B=N.find(ee=>ee.$id===_);if(!B)return null;const ne=B.product||B.product_name||B.Product_Name||B.name;if(!ne)return null;let L=f.find(ee=>ee.raw_product?.toLowerCase()===ne.toLowerCase());return L||(L=f.find(ee=>{const H=ee.raw_product?.toLowerCase()||"",de=ne.toLowerCase();return H.includes(de)||de.includes(H)})),L},k=new Map,w=_=>{if(!_)return!n&&!i;if(!n&&!i)return!0;const B=Kt(_),ne=n?B>=n:!0,L=i?B<=i:!0;return ne&&L},Y=new Set(Z.map(_=>_.$id));return D.filter(_=>Y.has(_.process_id)).forEach(_=>{const B=`${_.raw_product_id}-${_.process_id}`,ne=Array.isArray(_.stock_items)?_.stock_items.reduce((de,K)=>de+(Number(K.quantity)||0),0):0,L=_.assigned_quantity!==void 0&&_.assigned_quantity!==null?Number(_.assigned_quantity):ne,ee=Number(_.wastage_quantity)||0,H=L-ee;k.has(B)?k.get(B).opening_balance+=H:k.set(B,{stock_name:_.raw_product_name||"Unknown",process:O.get(_.process_id)||"Unknown",opening_balance:H,assigned:0,effective_completed:0,wastage_qty:0,utilised:0,closing_balance:0})}),A.filter(_=>Y.has(_.process_id)).forEach(_=>{const B=`${_.raw_product_id}-${_.process_id}`,ne=Array.isArray(_.stock_items)?_.stock_items.reduce((de,K)=>de+(Number(K.quantity)||0),0):0,L=_.assigned_quantity!==void 0&&_.assigned_quantity!==null?Number(_.assigned_quantity):ne,ee=Number(_.wastage_quantity)||0,H=L-ee;if(k.has(B)){const de=k.get(B);de.assigned+=L,de.wastage_qty+=ee,de.effective_completed+=H}else k.set(B,{stock_name:_.raw_product_name||"Unknown",process:O.get(_.process_id)||"Unknown",opening_balance:0,assigned:L,wastage_qty:ee,effective_completed:H,utilised:0,closing_balance:0})}),k.forEach((_,B)=>{const[ne,L]=B.split("-");Q.get(ne);const ee=(F||[]).filter(H=>{const de=H.source_process_id===L,K=R(H.product_id),h=K&&K.$id===ne,d=w(H.date_assigned)||w(H.date_completed);return de&&h&&d}).reduce((H,de)=>{const K=Number(de.source_quantity)||0;return H+K},0);_.utilised=ee}),k.forEach(_=>{_.closing_balance=_.opening_balance+_.effective_completed-_.utilised,_.closing_balance<=0?_.status="Out of Stock":_.closing_balance<0?_.status="Low Stock":_.status="In Stock"}),Array.from(k.values())},[g,x,A,D,F,f,N,n,i,c,a]),isLoading:b||j||P||T||E,error:null}},lc=()=>{const{user:r,loading:t}=vt(),s=cs(),{toast:a}=Fe(),n=xt(),[i,c]=u.useState(""),[p,m]=u.useState({from:Tt(new Date),to:Dt(new Date)}),[o,g]=u.useState(""),{data:b,isLoading:x}=us(),j=p.from?Xe(p.from,"yyyy-MM-dd"):void 0,f=p.to?Xe(p.to,"yyyy-MM-dd"):void 0,{statusRecords:P,isLoading:N}=Za(j,f,{processId:o||void 0}),T=u.useMemo(()=>P?P.filter(F=>(F.stock_name||"").toLowerCase().includes(i.toLowerCase())||(F.process||"").toLowerCase().includes(i.toLowerCase())):[],[P,i]),A=async()=>{try{await n.invalidateQueries({queryKey:["stocks"]}),await n.invalidateQueries({queryKey:["processes"]}),await n.invalidateQueries({queryKey:["productionTasks"]}),await n.invalidateQueries({queryKey:["postProductionTasks"]}),await n.invalidateQueries({queryKey:["rawProducts"]}),await n.invalidateQueries({queryKey:["products"]}),a({title:"Production Data Refreshed",description:"Data updated successfully"})}catch{a({title:"Refresh Failed",description:"Please try again",variant:"destructive"})}},E=()=>{const V=[["Raw Product","Process","Opening Balance","Assigned","Effective Completed","Wastage Qty","Utilised","Closing Bal","Min Level","Status"].join(","),...T.map(R=>[`"${R.stock_name}"`,`"${R.process}"`,R.opening_balance.toFixed(2),R.assigned.toFixed(2),R.effective_completed.toFixed(2),R.wastage_qty.toFixed(2),R.utilised.toFixed(2),R.closing_balance.toFixed(2),(R.min_level||0).toFixed(2),`"${R.status||"In Stock"}"`].join(","))].join(`
`),U=new Blob([V],{type:"text/csv;charset=utf-8;"}),Z=URL.createObjectURL(U),O=document.createElement("a");O.setAttribute("href",Z);const Q=j&&f?`_${j}_to_${f}`:"";O.setAttribute("download",`production-status${Q}_${new Date().toISOString().split("T")[0]}.csv`),O.style.visibility="hidden",document.body.appendChild(O),O.click(),document.body.removeChild(O)},D=N||x;return t?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Be,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading..."})]})}):r?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Production Status"}),e.jsx("p",{className:"text-muted-foreground",children:"Track material flow through production stages"})]}),e.jsx(te,{children:e.jsx(se,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("div",{className:"relative w-full md:w-auto",children:[e.jsx(gt,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(G,{placeholder:"Search stock or process...",className:"w-full pl-8 md:w-[200px] lg:w-[300px]",value:i,onChange:F=>c(F.target.value)})]}),e.jsx(js,{value:p,onChange:F=>{F?.from&&F?.to&&m(F)}}),e.jsxs(le,{value:o,onValueChange:g,children:[e.jsx(ie,{className:"w-[180px]",children:e.jsx(ce,{placeholder:"All Processes"})}),e.jsx(oe,{children:b?.filter(F=>{const V=F.process_name?.toLowerCase();return V==="grinding"||V==="blending"}).map(F=>e.jsx(S,{value:F.$id,children:F.process_name},F.$id))})]}),e.jsx($,{onClick:A,variant:"outline",size:"icon",disabled:D,children:e.jsx(za,{className:`h-4 w-4 ${D?"animate-spin":""}`})}),e.jsx($,{onClick:E,variant:"outline",size:"icon",disabled:!T||T.length===0,children:e.jsx(xs,{className:"h-4 w-4"})})]})})}),D?e.jsx(te,{children:e.jsxs(se,{className:"py-12 text-center",children:[e.jsx(Be,{className:"h-8 w-8 animate-spin mx-auto mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading production status..."})]})}):e.jsxs(te,{children:[e.jsxs(pe,{className:"flex flex-row items-center justify-between",children:[e.jsxs(xe,{children:["Production Status Records (",T.length,")"]}),e.jsx("div",{className:"flex items-center gap-2"})]}),e.jsx(se,{children:e.jsxs(mt,{children:[e.jsx(ht,{children:e.jsxs(ke,{children:[e.jsx(J,{children:"Raw Product"}),e.jsx(J,{children:"Process"}),e.jsx(J,{className:"text-right",children:"Opening Balance"}),e.jsx(J,{className:"text-right",children:"Assigned"}),e.jsx(J,{className:"text-right bg-purple-50",children:"Effective Completed"}),e.jsx(J,{className:"text-right",children:"Wastage Qty"}),e.jsx(J,{className:"text-right bg-green-50",children:"Utilised"}),e.jsx(J,{className:"text-right",children:"Closing Bal"}),e.jsx(J,{className:"text-right",children:"Min Level"}),e.jsx(J,{children:"Status"})]})}),e.jsx(pt,{children:T&&T.length>0?T.map((F,V)=>e.jsxs(ke,{children:[e.jsx(W,{children:F.stock_name}),e.jsx(W,{children:F.process}),e.jsx(W,{className:"text-right",children:F.opening_balance.toFixed(2)}),e.jsx(W,{className:"text-right",children:F.assigned.toFixed(2)}),e.jsx(W,{className:"text-right bg-purple-50 font-medium",children:F.effective_completed.toFixed(2)}),e.jsx(W,{className:"text-right",children:F.wastage_qty.toFixed(2)}),e.jsx(W,{className:"text-right bg-green-50 font-medium",children:F.utilised.toFixed(2)}),e.jsx(W,{className:"text-right font-semibold",children:e.jsx("span",{className:F.closing_balance<0?"text-red-600":"text-green-600",children:F.closing_balance.toFixed(2)})}),e.jsx(W,{className:"text-right text-muted-foreground",children:(F.min_level||0).toFixed(2)}),e.jsx(W,{children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${F.status==="Out of Stock"?"bg-red-100 text-red-800":F.status==="Low Stock"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:F.status||"In Stock"})})]},`${F.stock_name}-${F.process}-${V}`)):e.jsx(ke,{children:e.jsx(W,{colSpan:10,className:"text-center",children:"No production status found for the selected criteria."})})})]})})]})]}):e.jsx($s,{to:"/login",state:{from:s},replace:!0})},cc=(r,t)=>r.filter(s=>{const a=s.$id;return a&&a.trim()!==""}),ia={ALL:"all"},Hn=(r,t,s={})=>{const{processId:a}=s,n=r?Kt(r):void 0,i=t?Kt(t):void 0;n&&zs(n,1);const c=n?Xe(n,"yyyy-MM-dd"):void 0,p=i?Xe(i,"yyyy-MM-dd"):void 0,{data:m=[],isLoading:o}=ye({queryKey:["products"],queryFn:()=>Vt.getAll(),staleTime:600*1e3}),{data:g=[],isLoading:b}=ye({queryKey:["processes"],queryFn:()=>ys.getAll(),staleTime:600*1e3}),{data:x=[],isLoading:j}=ye({queryKey:["postProductionTasks",c,p],queryFn:()=>es.getPostProductionTasksWithRelations(),enabled:!!n&&!!i,staleTime:300*1e3}),{data:f=[]}=ye({queryKey:["salesUnits",c,p],queryFn:()=>zt.getAll(),staleTime:60*1e3});return{statusRecords:u.useMemo(()=>{if(!m.length||!g.length)return[];const T=n?zs(n,1):void 0,A=a?g.filter(V=>V.$id===a):g.filter(V=>{const U=V.process_name?.toLowerCase();return U==="packing"||U==="batch coding"}),E=V=>{if(!V)return!n&&!i;if(!n&&!i)return!0;const U=Kt(V),Z=n?U>=n:!0,O=i?U<=i:!0;return Z&&O},D=V=>!V||!T?!1:Kt(V)<=T,F=[];return m.forEach(V=>{A.forEach(U=>{const Z=V.sku||V.SKU||"",O=V.product||"",Q=U.process_name,R=V.min_level||V.minLevel||0;if(!Z||!O||!Q)return;const w=x.filter(d=>d.product_id===V.$id&&d.process_id===U.$id&&d.status==="completed"&&D(d.date_completed||d.date_assigned)).reduce((d,I)=>d+(Number(I.units)||0),0),Y=x.filter(d=>d.source_process_id===U.$id&&d.product_id===V.$id&&D(d.date_assigned||d.date_completed)).reduce((d,I)=>d+(Number(I.units)||0),0);let _=0;Q.toLowerCase()==="batch coding"&&(_=f.filter(d=>d.product_id===V.$id&&D(d.date||d.$createdAt)).reduce((d,I)=>d+(Number(I.units)||0),0));const B=w-Y-_,L=x.filter(d=>d.product_id===V.$id&&d.process_id===U.$id&&d.status==="completed"&&E(d.date_completed||d.date_assigned)).reduce((d,I)=>d+(Number(I.units)||0),0),ee=x.filter(d=>d.source_process_id===U.$id&&d.product_id===V.$id&&E(d.date_assigned||d.date_completed)).reduce((d,I)=>{const C=Number(I.units)||0;return d+C},0);let H=0;Q.toLowerCase()==="batch coding"&&(H=f.filter(d=>d.product_id===V.$id&&E(d.date||d.$createdAt)).reduce((d,I)=>{const C=Number(I.units)||0;return d+C},0));const de=ee+H,K=B+L-de;let h="In Stock";K<=0?h="Out of Stock":K<R&&(h="Low Stock"),F.push({sku:Z,product_name:O,process_name:Q,opening_balance:B,completed_units:L,utilised:de,closing_balance:K,status:h,min_level:R})})}),F},[m,g,x,f,a,n,i]),isLoading:o||b||j,error:null}},dc=()=>{const{user:r,loading:t}=vt(),s=cs(),{toast:a}=Fe(),n=xt(),[i,c]=u.useState(""),[p,m]=u.useState({from:Tt(new Date),to:Dt(new Date)}),[o,g]=u.useState(ia.ALL);if(t)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Be,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Validating authentication..."})]})});if(!r)return console.error("PostProductionStatus: User not authenticated, redirecting to login"),e.jsx($s,{to:"/login",state:{from:s},replace:!0});const{data:b=[],isLoading:x}=ye({queryKey:Ua.processes,queryFn:async()=>await ys.getAll()}),{statusRecords:j=[],isLoading:f}=Hn(p?.from?Xe(p.from,"yyyy-MM-dd"):void 0,p?.to?Xe(p.to,"yyyy-MM-dd"):void 0,{processId:o!==ia.ALL?o:void 0}),P=u.useMemo(()=>{if(!j)return[];let E=[...j];if(i&&(E=E.filter(D=>D.product_name?.toLowerCase().includes(i.toLowerCase())||D.process_name?.toLowerCase().includes(i.toLowerCase())||D.sku?.toLowerCase().includes(i.toLowerCase()))),o!==ia.ALL){const D=b.find(F=>F.$id===o)?.process_name;D&&(E=E.filter(F=>F.process_name===D))}return E},[j,i,o,b]),N=x||f,T=async()=>{try{await n.invalidateQueries({queryKey:["products"]}),await n.invalidateQueries({queryKey:["processes"]}),await n.invalidateQueries({queryKey:["postProductionTasks"]}),await n.invalidateQueries({queryKey:["salesUnits"]}),a({title:"Post-Production Data Refreshed",description:"Data updated successfully"})}catch{a({title:"Refresh Failed",description:"Please try again",variant:"destructive"})}},A=()=>{try{const E=[["SKU","Product","Process","Source Qty (kg)","Opening Balance","Completed Units","Utilised","Closing Balance","Min Level","Status"],...P.map(U=>[U.sku||"",U.product_name||"",U.process_name||"",U.source_qty??"N/A",U.opening_balance||0,U.completed_units||0,U.utilised||0,U.closing_balance||0,U.min_level||0,`"${U.status||"In Stock"}"`])].map(U=>U.join(",")).join(`
`),D=new Blob([E],{type:"text/csv"}),F=window.URL.createObjectURL(D),V=document.createElement("a");V.href=F,V.download=`post-production-status-${Xe(new Date,"yyyy-MM-dd")}.csv`,V.click(),window.URL.revokeObjectURL(F),a({title:"Export Successful",description:"Post-production status data exported successfully."})}catch(E){console.error("PostProductionStatus: Export failed",E),a({title:"Export Failed",description:"Failed to export data. Please try again.",variant:"destructive"})}};return e.jsxs("div",{className:"space-y-6 p-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Post-Production Status"}),e.jsx("p",{className:"text-muted-foreground",children:"Track quality checks and post-production status"})]}),e.jsx(te,{children:e.jsx(se,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("div",{className:"relative w-full md:w-auto",children:[e.jsx(gt,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(G,{placeholder:"Search product, process or SKU...",className:"w-full pl-8 md:w-[200px] lg:w-[300px]",value:i,onChange:E=>c(E.target.value)})]}),e.jsx(js,{value:p,onChange:E=>{E?.from&&E?.to&&m(E)}}),e.jsxs(le,{value:o,onValueChange:g,children:[e.jsx(ie,{className:"w-[180px]",children:e.jsx(ce,{placeholder:"Select Process"})}),e.jsxs(oe,{children:[e.jsx(S,{value:ia.ALL,children:"All Processes"}),cc(b).filter(E=>{const D=E.process_name?.toLowerCase();return D==="packing"||D==="batch coding"}).map(E=>e.jsx(S,{value:E.$id,children:E.process_name},E.$id))]})]}),e.jsx($,{onClick:T,variant:"outline",size:"icon",disabled:N,children:e.jsx(za,{className:`h-4 w-4 ${N?"animate-spin":""}`})}),e.jsx($,{onClick:A,variant:"outline",size:"icon",disabled:!P||P.length===0,title:"Export to CSV",children:e.jsx(xs,{className:"h-4 w-4"})})]})})}),e.jsxs(te,{children:[e.jsx(pe,{className:"flex flex-row items-center justify-between",children:e.jsxs(xe,{children:["Post-Production Status Records (",P.length,")"]})}),e.jsx(se,{children:N?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(Be,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("span",{children:"Loading post-production status..."})]}):P.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("p",{className:"text-lg mb-2",children:"No post-production status found"}),e.jsx("p",{className:"text-sm",children:i?"No matching records found":"Post-production status data will be populated from packing tasks and sales"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(mt,{children:[e.jsx(ht,{children:e.jsxs(ke,{children:[e.jsx(J,{children:"SKU"}),e.jsx(J,{children:"Product"}),e.jsx(J,{children:"Process"}),e.jsx(J,{className:"text-right",children:"Source Qty (kg)"}),e.jsx(J,{className:"text-right",children:"Opening Balance"}),e.jsx(J,{className:"text-right bg-purple-50",children:"Completed Units"}),e.jsx(J,{className:"text-right bg-green-50",children:"Utilised"}),e.jsx(J,{className:"text-right",children:"Closing Balance"}),e.jsx(J,{className:"text-right",children:"Min Level"}),e.jsx(J,{children:"Status"})]})}),e.jsx(pt,{children:P.map((E,D)=>e.jsxs(ke,{children:[e.jsx(W,{className:"font-medium",children:E.sku}),e.jsx(W,{children:E.product_name}),e.jsx(W,{children:E.process_name}),e.jsx(W,{className:"text-right",children:E.source_qty??"N/A"}),e.jsx(W,{className:"text-right",children:E.opening_balance||0}),e.jsx(W,{className:"text-right bg-purple-50 font-medium",children:E.completed_units||0}),e.jsx(W,{className:"text-right bg-green-50 font-medium",children:E.utilised||0}),e.jsx(W,{className:"text-right font-semibold",children:e.jsx("span",{className:(E.closing_balance||0)<0?"text-red-600":"text-green-600",children:E.closing_balance||0})}),e.jsx(W,{className:"text-right text-muted-foreground",children:E.min_level||0}),e.jsx(W,{children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${E.status==="Out of Stock"?"bg-red-100 text-red-800":E.status==="Low Stock"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:E.status||"In Stock"})})]},`${E.sku}-${E.process_name}-${D}`))})]})})})]})]})};function uc(){const{user:r,loading:t}=vt(),s=cs(),[a,n]=u.useState(""),[i,c]=u.useState(void 0);if(t)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Be,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Validating authentication..."})]})});if(!r)return console.error("InventoryStatus: User not authenticated, redirecting to login"),e.jsx($s,{to:"/login",state:{from:s},replace:!0});const{data:p=[],isLoading:m}=ye({queryKey:["products"],queryFn:async()=>await Vt.getAll()}),o=u.useMemo(()=>{const T=[];return i?.from&&T.push(Ve.greaterThanEqual("date",i.from.toISOString())),i?.to&&T.push(Ve.lessThanEqual("date",i.to.toISOString())),T},[i]),{data:g=[],isLoading:b}=ye({queryKey:["sales-units-inventory",i?.from?.toISOString(),i?.to?.toISOString()],queryFn:async()=>await zt.getAll(o)}),{data:x=[],isLoading:j}=ye({queryKey:["sales-records-inventory",i?.from?.toISOString(),i?.to?.toISOString()],queryFn:async()=>await Zt.getAll(o)}),f=u.useMemo(()=>p.length?p.map(T=>{const A=T.sku||"",E=T.product||T.name||"",D=T.min_level||T.minLevel||0,F=g.filter(Q=>Q.sku===A).reduce((Q,R)=>Q+(R.units||0),0),V=x.filter(Q=>Q.sku===A).reduce((Q,R)=>Q+(R.sold_units||0),0),U=0,Z=U+F-V;let O="In Stock";return Z<=0?O="Out of Stock":Z<=D&&(O="Low Stock"),{sku:A,product:E,opening_balance:U,sales_units:F,sold:V,closing_balance:Z,min_level:D,status:O}}):[],[p,g,x]),P=u.useMemo(()=>a?f.filter(T=>T.sku.toLowerCase().includes(a.toLowerCase())||T.product.toLowerCase().includes(a.toLowerCase())):f,[f,a]),N=m||b||j;return e.jsxs("div",{className:"space-y-6 p-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Inventory Status"}),e.jsx("p",{className:"text-muted-foreground",children:"Track current inventory levels based on sales units and sold units"})]}),e.jsx(te,{children:e.jsx(se,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4 items-center flex-wrap",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(gt,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(G,{placeholder:"Search by SKU or Product...",className:"pl-10",value:a,onChange:T=>n(T.target.value)})]}),e.jsx("div",{className:"min-w-[250px]",children:e.jsx(js,{value:i,onChange:c,placeholder:"Select date range for calculations"})}),e.jsxs($,{variant:"outline",children:[e.jsx(ts,{className:"h-4 w-4 mr-2"}),"Filter"]}),e.jsxs($,{variant:"outline",children:[e.jsx(xs,{className:"h-4 w-4 mr-2"}),"Export"]})]})})}),e.jsxs(te,{children:[e.jsx(pe,{children:e.jsxs(xe,{children:["Inventory Status (",P.length,")",i?.from&&i?.to&&e.jsxs("span",{className:"text-sm font-normal text-muted-foreground ml-2",children:["(",i.from.toLocaleDateString("en-GB")," - ",i.to.toLocaleDateString("en-GB"),")"]})]})}),e.jsx(se,{children:N?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(Be,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("span",{children:"Loading inventory status..."})]}):P.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("p",{className:"text-lg mb-2",children:"No inventory data found"}),e.jsx("p",{className:"text-sm",children:a?"Try adjusting your search criteria":"Add products and sales data to see inventory status"})]}):e.jsxs(mt,{children:[e.jsx(ht,{children:e.jsxs(ke,{children:[e.jsx(J,{children:"SKU"}),e.jsx(J,{children:"Product"}),e.jsx(J,{className:"text-right",children:"Opening Bal"}),e.jsx(J,{className:"text-right bg-purple-50",children:"Sales Units"}),e.jsx(J,{className:"text-right bg-green-50",children:"Sold"}),e.jsx(J,{className:"text-right",children:"Closing Bal"}),e.jsx(J,{className:"text-right",children:"Min Level"}),e.jsx(J,{children:"Status"})]})}),e.jsx(pt,{children:P.map((T,A)=>e.jsxs(ke,{children:[e.jsx(W,{className:"font-medium",children:T.sku}),e.jsx(W,{children:T.product}),e.jsx(W,{className:"text-right",children:T.opening_balance.toLocaleString()}),e.jsx(W,{className:"text-right bg-purple-50 font-medium",children:T.sales_units.toLocaleString()}),e.jsx(W,{className:"text-right bg-green-50 font-medium",children:T.sold.toLocaleString()}),e.jsx(W,{className:"text-right font-semibold",children:e.jsx("span",{className:T.closing_balance<0?"text-red-600":"text-green-600",children:T.closing_balance.toLocaleString()})}),e.jsx(W,{className:"text-right text-muted-foreground",children:T.min_level.toLocaleString()}),e.jsx(W,{children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${T.status==="Out of Stock"?"bg-red-100 text-red-800":T.status==="Low Stock"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:T.status})})]},`${T.sku}-${A}`))})]})})]}),e.jsxs(te,{children:[e.jsx(pe,{children:e.jsx(xe,{children:"Summary"})}),e.jsx(se,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:P.length}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Products"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:P.reduce((T,A)=>T+A.sales_units,0).toLocaleString()}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Sales Units"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:P.reduce((T,A)=>T+A.sold,0).toLocaleString()}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Sold"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:P.reduce((T,A)=>T+A.closing_balance,0).toLocaleString()}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Net Closing Balance"})]})]})})]})]})}const mc=[{value:"pending",label:"Pending"},{value:"in_progress",label:"In Progress"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"}],hc=({isOpen:r,onClose:t,onSubmit:s,editingTask:a,isLoading:n=!1})=>{const{data:i}=Ja(),{data:c}=Is(),{data:p}=us(),m=new Date,o=Tt(m),g=Dt(m),{statusRecords:b}=Da(o.toISOString().split("T")[0],g.toISOString().split("T")[0],{processId:void 0}),{stockStatus:x,isLoading:j}=Ga(o,g,{category:void 0,searchTerm:void 0});u.useEffect(()=>{console.log("ðŸ” RTQV DATA SOURCE DEBUG:",{dateRange:`${o.toISOString().split("T")[0]} to ${g.toISOString().split("T")[0]}`,isLoading:j,dataLength:x?.length,sampleData:x?.slice(0,2),timestamp:new Date().toISOString()})},[x,j]);const f=["Stock","Cleaning","C & D","Roasting","RFP"],P=p.filter(k=>{const w=k.process_name?.toLowerCase();return["cleaning","c & d","roasting","rfp"].includes(w)}),[N,T]=u.useState({task_id:"",stock_id:"",stock_source:"",date_assigned:new Date().toISOString().split("T")[0],process_id:"",assigned_quantity:"",completed_quantity:"",staff_id:"",date_completed:"",wastage_quantity:"",remarks:"",status:"pending"}),[A,E]=u.useState({}),[D,F]=u.useState(null),V=u.useRef(!1),U=u.useRef(""),Z=()=>{if(!N.stock_id||!N.stock_source||!N.assigned_quantity){F(null);return}const k=i?.find(K=>K.$id===N.stock_id);if(!k){F({isValid:!1,availableQty:0,requiredQty:0,stockName:"Unknown Stock",stockSource:N.stock_source,error:"Stock not found",validationClass:"bg-red-50 text-red-700 border-red-200",validationMessage:"Selected stock not found"});return}const w=parseFloat(N.assigned_quantity);if(w<=0){F({isValid:!1,availableQty:0,requiredQty:w,stockName:k.stock_name,stockSource:N.stock_source,error:"Invalid quantity",validationClass:"bg-yellow-50 text-yellow-700 border-yellow-200",validationMessage:"Quantity must be greater than 0"});return}let Y=0,_="",B=!1;if(N.stock_source==="Stock"){if(_="Stock Status",B=j,B){F({isValid:!1,availableQty:0,requiredQty:w,stockName:k.stock_name,stockSource:N.stock_source,dataSource:_,isLoading:!0,validationClass:"bg-blue-50 text-blue-700 border-blue-200",validationMessage:"Loading stock data..."});return}const K=x?.find(h=>h.stock_name?.toLowerCase()===k.stock_name?.toLowerCase());Y=K?.closing_balance??0,console.log("ðŸ” RTQV Stock Status Check:",{stock_name:k.stock_name,stockRecord_found:!!K,closing_balance:K?.closing_balance,availableQty:Y,dataSource:_,forced_fresh:!0})}else{_="Pre-Production Status";const K=b?.find(h=>h.stock_name===k.stock_name&&h.process===N.stock_source);Y=K?.closing_balance??0,console.log("ðŸ” RTQV Pre-Production Status Check:",{stock_name:k.stock_name,stock_source:N.stock_source,statusRecord_found:!!K,closing_balance:K?.closing_balance,availableQty:Y,dataSource:_,forced_fresh:!0})}const ne=Y>=w;let L="",ee="";ne?(L="bg-green-50 text-green-700 border-green-200",ee=`âœ“ Available: ${Y}kg (Required: ${w}kg)`):Y===0?(L="bg-red-50 text-red-700 border-red-200",ee=`âœ— Out of stock (Required: ${w}kg)`):(L="bg-orange-50 text-orange-700 border-orange-200",ee=`âš  Insufficient stock: ${Y}kg available (Required: ${w}kg)`);const H={isValid:ne,availableQty:Y,requiredQty:w,stockName:k.stock_name,stockSource:N.stock_source,dataSource:_,isLoading:!1,validationClass:L,validationMessage:ee},de=`${N.stock_id}-${N.stock_source}-${N.assigned_quantity}-${Y}-${w}`;U.current!==de&&(U.current=de,F(H))};u.useEffect(()=>{V.current||(V.current=!0,Z(),queueMicrotask(()=>{V.current=!1}))},[N.stock_id,N.stock_source,N.assigned_quantity]),u.useEffect(()=>{!N.stock_id||!N.stock_source||!N.assigned_quantity||V.current||(V.current=!0,Z(),queueMicrotask(()=>{V.current=!1}))},[x?.length,b?.length,j]),u.useEffect(()=>{if(r)if(a)T({task_id:a.task_id,stock_id:a.stock_id,stock_source:a.stock_source,date_assigned:a.date_assigned,process_id:a.process_id,assigned_quantity:a.assigned_quantity.toString(),completed_quantity:a.completed_quantity?.toString()||"",staff_id:a.staff_id,date_completed:a.date_completed||"",wastage_quantity:a.wastage_quantity?.toString()||"",remarks:a.remarks||"",status:a.status});else{const k=`TASK${Date.now().toString().slice(-6)}`;T({task_id:k,stock_id:"",stock_source:"",date_assigned:new Date().toISOString().split("T")[0],process_id:"",assigned_quantity:"",completed_quantity:"",staff_id:"",date_completed:"",wastage_quantity:"",remarks:"",status:"pending"})}},[a,r]);const O=()=>{const k={};return N.task_id.trim()||(k.task_id="Task ID is required"),N.stock_id||(k.stock_id="Stock is required"),N.stock_source||(k.stock_source="Stock source is required"),N.date_assigned||(k.date_assigned="Date assigned is required"),N.process_id||(k.process_id="Process is required"),(!N.assigned_quantity||parseFloat(N.assigned_quantity)<=0)&&(k.assigned_quantity="Assigned quantity must be greater than 0"),N.staff_id||(k.staff_id="Staff is required"),N.wastage_quantity&&parseFloat(N.wastage_quantity)<0&&(k.wastage_quantity="Wastage quantity cannot be negative"),E(k),Object.keys(k).length===0},Q=k=>{if(k.preventDefault(),!O())return;const w={task_id:N.task_id,stock_id:N.stock_id,stock_source:N.stock_source,date_assigned:N.date_assigned,process_id:N.process_id,assigned_quantity:parseFloat(N.assigned_quantity),completed_quantity:N.completed_quantity?parseFloat(N.completed_quantity):void 0,staff_id:N.staff_id,date_completed:N.date_completed||void 0,wastage_quantity:N.wastage_quantity?parseFloat(N.wastage_quantity):void 0,remarks:N.remarks||void 0,status:N.status};s(w)},R=()=>{T({task_id:"",stock_id:"",stock_source:"",date_assigned:new Date().toISOString().split("T")[0],process_id:"",assigned_quantity:"",completed_quantity:"",staff_id:"",date_completed:"",wastage_quantity:"",remarks:"",status:"pending"}),E({}),F(null),t()};return e.jsx(ct,{open:r,onOpenChange:R,children:e.jsxs(nt,{className:"sm:max-w-[600px] max-w-[95vw] max-h-[90vh] overflow-y-auto",children:[e.jsxs(it,{children:[e.jsx(lt,{children:a?"Edit Pre-Production Task":"Add New Pre-Production Task"}),e.jsx(dt,{children:a?"Update the details of the pre-production task below.":"Fill in the details to create a new pre-production task."})]}),e.jsxs("form",{onSubmit:Q,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"task_id",children:"Task ID *"}),e.jsx(G,{id:"task_id",value:N.task_id,onChange:k=>T({...N,task_id:k.target.value}),className:A.task_id?"border-red-500":""}),A.task_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:A.task_id})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"date_assigned",children:"Date Assigned *"}),e.jsx(G,{id:"date_assigned",type:"date",value:N.date_assigned,onChange:k=>T({...N,date_assigned:k.target.value}),className:A.date_assigned?"border-red-500":""}),A.date_assigned&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:A.date_assigned})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"stock_id",children:"Stock Name *"}),e.jsxs(le,{value:N.stock_id,onValueChange:k=>T({...N,stock_id:k}),children:[e.jsx(ie,{className:A.stock_id?"border-red-500":"",children:e.jsx(ce,{placeholder:"Select Stock"})}),e.jsx(oe,{children:i.map(k=>e.jsx(S,{value:k.$id||"",children:k.stock_name},k.$id))})]}),A.stock_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:A.stock_id})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"stock_source",children:"Stock Source *"}),e.jsxs(le,{value:N.stock_source,onValueChange:k=>T({...N,stock_source:k}),children:[e.jsx(ie,{className:A.stock_source?"border-red-500":"",children:e.jsx(ce,{placeholder:"Select Source"})}),e.jsx(oe,{children:f.map(k=>e.jsx(S,{value:k,children:k},k))})]}),A.stock_source&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:A.stock_source})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"process_id",children:"Process *"}),e.jsxs(le,{value:N.process_id,onValueChange:k=>T({...N,process_id:k}),children:[e.jsx(ie,{className:A.process_id?"border-red-500":"",children:e.jsx(ce,{placeholder:"Select Process"})}),e.jsx(oe,{children:P.map(k=>e.jsx(S,{value:k.$id||"",children:k.process_name},k.$id))})]}),A.process_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:A.process_id})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"assigned_quantity",children:"Assigned Quantity *"}),e.jsx(G,{id:"assigned_quantity",type:"number",step:"0.01",min:"0",value:N.assigned_quantity,onChange:k=>T({...N,assigned_quantity:k.target.value}),className:A.assigned_quantity?"border-red-500":"",placeholder:"Enter quantity in kg"}),A.assigned_quantity&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:A.assigned_quantity}),D&&e.jsxs("div",{className:`mt-2 p-3 rounded-md border text-sm ${D.validationClass}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("div",{className:"font-medium",children:D.stockName}),e.jsxs("div",{className:"text-xs opacity-75",children:["Source: ",D.dataSource]})]}),e.jsx("div",{className:"mb-1",children:D.validationMessage}),D.error&&e.jsxs("div",{className:"text-xs mt-1 opacity-75",children:["Error: ",D.error]}),D.isLoading&&e.jsxs("div",{className:"flex items-center gap-2 text-xs mt-1",children:[e.jsx("div",{className:"animate-spin h-3 w-3 border border-current border-t-transparent rounded-full"}),"Loading fresh data from ",D.dataSource,"..."]})]})]})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"staff_id",children:"Assigned To *"}),e.jsxs(le,{value:N.staff_id,onValueChange:k=>T({...N,staff_id:k}),children:[e.jsx(ie,{className:A.staff_id?"border-red-500":"",children:e.jsx(ce,{placeholder:"Select Staff"})}),e.jsx(oe,{children:c.map(k=>e.jsx(S,{value:k.$id||"",children:k.staff_name},k.$id))})]}),A.staff_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:A.staff_id})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"completed_quantity",children:"Completed Quantity"}),e.jsx(G,{id:"completed_quantity",type:"number",value:N.completed_quantity,onChange:k=>T({...N,completed_quantity:k.target.value})})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"date_completed",children:"Date Completed"}),e.jsx(G,{id:"date_completed",type:"date",value:N.date_completed,onChange:k=>T({...N,date_completed:k.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"wastage_quantity",children:"Wastage Quantity"}),e.jsx(G,{id:"wastage_quantity",type:"number",step:"0.01",min:"0",value:N.wastage_quantity,onChange:k=>T({...N,wastage_quantity:k.target.value}),className:A.wastage_quantity?"border-red-500":""}),A.wastage_quantity&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:A.wastage_quantity})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"status",children:"Status"}),e.jsxs(le,{value:N.status,onValueChange:k=>T({...N,status:k}),children:[e.jsx(ie,{children:e.jsx(ce,{placeholder:"Select Status"})}),e.jsx(oe,{children:mc.map(k=>e.jsx(S,{value:k.value,children:k.label},k.value))})]})]})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"remarks",children:"Remarks"}),e.jsx(rs,{id:"remarks",value:N.remarks,onChange:k=>T({...N,remarks:k.target.value}),placeholder:"Enter any remarks",rows:3})]})]}),e.jsxs(ot,{className:"flex-col sm:flex-row gap-2 pt-4",children:[e.jsx($,{type:"button",variant:"outline",onClick:R,className:"w-full sm:w-auto",children:"Cancel"}),e.jsx($,{type:"submit",disabled:n,className:"w-full sm:w-auto",children:n?"Saving...":a?"Update":"Save"})]})]})]})})},pc=()=>{const r=xt(),t=Ae({mutationFn:n=>at.createDocument(rt,Ce.PRE_PRODUCTION_TASKS,hs.unique(),n),onSuccess:()=>{queueMicrotask(()=>{r.invalidateQueries({queryKey:["preProductionTasks"]})})}}),s=Ae({mutationFn:({id:n,data:i})=>at.updateDocument(rt,Ce.PRE_PRODUCTION_TASKS,n,i),onSuccess:()=>{queueMicrotask(()=>{r.invalidateQueries({queryKey:["preProductionTasks"]})})}}),a=Ae({mutationFn:n=>at.deleteDocument(rt,Ce.PRE_PRODUCTION_TASKS,n),onSuccess:()=>{queueMicrotask(()=>{r.invalidateQueries({queryKey:["preProductionTasks"]})})}});return{createTask:t,updateTask:s,deleteTask:a}},xc=()=>{const r=xt(),[t,s]=u.useState(""),[a,n]=u.useState(!1),[i,c]=u.useState(null),[p,m]=u.useState([]),[o,g]=u.useState({show:!1,message:"",type:"success"}),[b,x]=u.useState("all"),[j,f]=u.useState("all"),[P,N]=u.useState("all"),[T,A]=u.useState({from:"",to:""}),[E,D]=u.useState(1),[F,V]=u.useState(50),{tasks:U,isLoading:Z,error:O,refetch:Q}=Un(),{createTask:R,updateTask:k,deleteTask:w}=pc(),{config:Y}=Et("pre-production-tasks"),{validationRules:_,canImport:B}=Rt("pre-production-tasks");Mo("pre-production-tasks");const{currentSort:ne,handleSort:L,getSortedData:ee}=as(),{data:H}=us(),{data:de}=Ja(),{data:K}=Is(),{toast:h}=Fe(),{data:d}=ye({queryKey:["pre-production-tasks","all","with-relations"],queryFn:()=>ps.getPreProductionTasksWithRelations()}),I=(l,re)=>{g({show:!0,message:l,type:re}),setTimeout(()=>g({show:!1,message:"",type:"success"}),3e3)},C=U.filter(l=>{const re=l.task_id.toLowerCase().includes(t.toLowerCase())||l.stock_name.toLowerCase().includes(t.toLowerCase())||l.staff_name.toLowerCase().includes(t.toLowerCase())||l.process_name.toLowerCase().includes(t.toLowerCase()),v=b==="all"||l.stock_name.toLowerCase().includes(b.toLowerCase()),X=j==="all"||l.process_name.toLowerCase().includes(j.toLowerCase()),fe=P==="all"||l.staff_name.toLowerCase().includes(P.toLowerCase()),Ne=(!T.from||l.date_assigned>=T.from)&&(!T.to||l.date_assigned<=T.to);return re&&v&&X&&fe&&Ne}),ae=Array.from(new Set(U.map(l=>l.stock_name))).sort(),Se=Array.from(new Set(U.map(l=>l.process_name))).sort(),ve=Array.from(new Set(U.map(l=>l.staff_name))).sort(),_e=C.length,He=Math.ceil(_e/F),ze=(E-1)*F,tt=ze+F,bt=C.slice(ze,tt);u.useEffect(()=>{D(1)},[t,b,j,P,T,F]);const Mt=async l=>{try{i?(await k.mutateAsync({id:i.$id,data:l}),I("Pre-production task updated successfully","success")):(await R.mutateAsync(l),I("Pre-production task created successfully","success")),n(!1),c(null)}catch(re){console.error("Error saving task:",re),I("Failed to save task","error")}},ft=l=>{c(l),n(!0)},jt=async l=>{if(window.confirm("Are you sure you want to delete this task?"))try{await w.mutateAsync(l.$id),I("Pre-production task deleted successfully","success")}catch(re){console.error("Error deleting task:",re),I("Failed to delete task","error")}},Nt=async()=>{if(p.length===0){I("Please select tasks to delete","error");return}if(window.confirm(`Are you sure you want to delete ${p.length} selected task(s)?`))try{await Promise.all(p.map(l=>w.mutateAsync(l.$id))),m([]),I(`${p.length} tasks deleted successfully`,"success")}catch(l){console.error("Error deleting tasks:",l),I("Failed to delete selected tasks","error")}},wt=()=>{if(p.length===0){I("Please select tasks to export","error");return}I(`Exporting ${p.length} selected task(s)...`,"success")};return O?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Pre-Production Tasks"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage pre-production processing tasks"})]}),e.jsx(te,{children:e.jsx(se,{className:"pt-6",children:e.jsxs("div",{className:"text-center py-12 text-red-600",children:[e.jsx("p",{className:"text-lg mb-2",children:"Error loading tasks"}),e.jsx("p",{className:"text-sm mb-4",children:O.message}),e.jsx($,{onClick:()=>Q(),variant:"outline",children:"Retry"})]})})})]}):e.jsxs("div",{className:"space-y-6",children:[o.show&&e.jsx("div",{className:`fixed top-4 right-4 px-4 py-2 rounded-md shadow-lg z-50 ${o.type==="success"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300"}`,children:o.message}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Pre-Production Tasks"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage pre-production processing tasks"})]}),e.jsxs($,{className:"bg-primary hover:bg-primary/90",onClick:()=>{c(null),n(!0)},children:[e.jsx(Ct,{className:"h-4 w-4 mr-2"}),"Add New"]})]}),e.jsx(te,{children:e.jsx(se,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(gt,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(G,{placeholder:"Search tasks...",className:"pl-10",value:t,onChange:l=>s(l.target.value)})]}),B&&Y&&e.jsx(qt,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:Y.exportColumns.filter(l=>l.required).map(l=>l.exportHeader),optionalColumns:Y.exportColumns.filter(l=>!l.required).map(l=>l.exportHeader),validationRules:_,maxFileSize:50,existingData:d||[],duplicateChecker:(l,re)=>{const v=(l["Task ID"]||l.task_id||l.task_id||"").toLowerCase().trim(),X=(l["Stock Name"]||l.stock_name||l.stock_name||"").toLowerCase().trim(),fe=(l["Stock Source"]||l.stock_source||l.stock_source||"").toLowerCase().trim(),Ne=l["Date Assigned"]||l.date_assigned||l.date_assigned||"",Ie=(l.Process||l.process_name||l.process_name||"").toLowerCase().trim();let Le="";if(Ne)if(typeof Ne=="string"){const Me=Ne.match(/^(\d{2})-(\d{2})-(\d{4})$/);if(Me){const[,q,je,we]=Me,be=new Date(parseInt(we),parseInt(je)-1,parseInt(q));isNaN(be.getTime())||(Le=be.toISOString().split("T")[0])}else{const q=new Date(Ne);isNaN(q.getTime())||(Le=q.toISOString().split("T")[0])}}else Ne instanceof Date&&(Le=Ne.toISOString().split("T")[0]);return re.some(Me=>{const q=(Me.task_id||"").toLowerCase().trim(),je=(Me.stock_name||"").toLowerCase().trim(),we=(Me.stock_source||"").toLowerCase().trim(),be=Me.date_assigned||"",yt=(Me.process_name||"").toLowerCase().trim();let Re="";return be&&(typeof be=="string"?Re=be:be instanceof Date&&(Re=be.toISOString().split("T")[0])),v===q&&X===je&&fe===we&&Le===Re&&Ie===yt})},validationHeaderMapper:l=>{const re=Y.exportColumns.find(v=>v.dataKey===l);return re?re.exportHeader:l},columnMapper:l=>{const re=Y.exportColumns.find(v=>v.exportHeader===l);if(re){if(re.dataKey==="stock_name")return"stock_name";if(re.dataKey==="process_name")return"process_name";if(re.dataKey==="staff_name")return"staff_name";const v={task_id:"task_id",stock_source:"stock_source",date_assigned:"date_assigned",assigned_quantity:"assigned_quantity",date_completed:"date_completed",completed_quantity:"completed_quantity",wastage_quantity:"wastage_quantity",remarks:"remarks",status:"status"};return re.dataKey==="date_completed"?"date_completed":re.dataKey==="completed_quantity"?"completed_quantity":v[re.dataKey]||re.dataKey}return l},dataProcessor:async l=>{let re=l["Stock Name"]||l.stock_name||l.stock_name;if(!re||re==="")throw new Error("Stock Name is required");const v=String(re).trim(),X=de?.find(Pe=>Pe.stock_name.toLowerCase()===v.toLowerCase());if(!X){const Pe=de?.map(Oe=>Oe.stock_name).slice(0,5).join(", ")||"None";throw new Error(`Stock "${v}" not found. Available: ${Pe}`)}const fe=X.$id;let Ne=l.Process||l.process_name||l.process_name;if(!Ne||Ne==="")throw new Error("Process is required");const Ie=String(Ne).trim(),Le=H?.find(Pe=>Pe.process_name.toLowerCase()===Ie.toLowerCase());if(!Le){const Pe=H?.map(Oe=>Oe.process_name).slice(0,5).join(", ")||"None";throw new Error(`Process "${Ie}" not found. Available: ${Pe}`)}const Me=Le.$id;let q="",je=l["Staff Name"]||l.staff_name||l.staff_name;if(je&&je!==""){const Pe=String(je).trim(),Oe=K?.find(Ke=>Ke.staff_name.toLowerCase()===Pe.toLowerCase());Oe&&(q=Oe.$id)}const we=(Pe,Oe)=>{if(!Pe)return Oe||"";let Ke=Pe;if(typeof Ke=="string"){const $e=Ke.match(/^(\d{2})-(\d{2})-(\d{4})$/);if($e){const[,y,z,ue]=$e,ge=new Date(parseInt(ue),parseInt(z)-1,parseInt(y));if(!isNaN(ge.getTime()))return ge.toISOString().split("T")[0]}else{const y=new Date(Ke);if(!isNaN(y.getTime()))return y.toISOString().split("T")[0]}}else if(Ke instanceof Date)return Ke.toISOString().split("T")[0];return Oe||""},be=we(l["Date Assigned"]||l.date_assigned||l.date_assigned,new Date().toISOString().split("T")[0]),yt=we(l["Date Completed"]||l.date_completed||l.date_completed,""),Re={task_id:l["Task ID"]||l.task_id||l.task_id,stock_id:fe,stock_source:l["Stock Source"]||l.stock_source||l.stock_source||"",date_assigned:be,date_completed:yt||void 0,process_id:Me,staff_id:q||"",assigned_quantity:parseFloat(l["Assigned Qty"]||l.assigned_quantity||l.assigned_quantity||0),completed_quantity:parseFloat(l["Completed Qty"]||l.completed_quantity||l.completed_quantity||0),wastage_quantity:parseFloat(l["Wastage Qty"]||l.wastage_quantity||l.wastage_quantity||0),status:"completed",remarks:l.Remarks||l.remarks||l.remarks||""};return await ps.create(Re)},onImportComplete:async l=>{await r.invalidateQueries({queryKey:["pre-production-tasks"],refetchType:"active"}),await r.refetchQueries({queryKey:["pre-production-tasks"]}),Q(),l.successfulRows>0&&h({title:"Import Successful",description:`${l.successfulRows} pre-production tasks imported successfully.`}),l.failedRows>0&&h({title:"Import Completed with Errors",description:`${l.successfulRows} successful, ${l.failedRows} failed.`,variant:"destructive"})}},variant:"outline"}),Y&&e.jsx(At,{data:C.map(l=>{const re={};return Y.exportColumns.forEach(v=>{const X=l[v.dataKey];re[v.exportHeader]=v.formatter?v.formatter(X):X}),re}),headers:Y.exportColumns.map(l=>l.exportHeader),filename:"pre-production-tasks",variant:"outline"})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs(le,{value:b,onValueChange:x,children:[e.jsx(ie,{className:"w-[180px]",children:e.jsx(ce,{placeholder:"Stock Name"})}),e.jsxs(oe,{children:[e.jsx(S,{value:"all",children:"All Stocks"}),ae.map(l=>e.jsx(S,{value:l,children:l},l))]})]}),e.jsxs(le,{value:j,onValueChange:f,children:[e.jsx(ie,{className:"w-[180px]",children:e.jsx(ce,{placeholder:"Process"})}),e.jsxs(oe,{children:[e.jsx(S,{value:"all",children:"All Processes"}),Se.map(l=>e.jsx(S,{value:l,children:l},l))]})]}),e.jsxs(le,{value:P,onValueChange:N,children:[e.jsx(ie,{className:"w-[180px]",children:e.jsx(ce,{placeholder:"Staff Name"})}),e.jsxs(oe,{children:[e.jsx(S,{value:"all",children:"All Staff"}),ve.map(l=>e.jsx(S,{value:l,children:l},l))]})]}),e.jsx(G,{type:"date",placeholder:"From Date",className:"w-[150px]",value:T.from,onChange:l=>A(re=>({...re,from:l.target.value}))}),e.jsx(G,{type:"date",placeholder:"To Date",className:"w-[150px]",value:T.to,onChange:l=>A(re=>({...re,to:l.target.value}))})]})]})})}),e.jsx(te,{children:e.jsxs(se,{className:"pt-6",children:[p.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 p-3 bg-muted rounded-md",children:[e.jsxs("span",{className:"text-sm font-medium",children:[p.length," selected"]}),e.jsx($,{variant:"destructive",size:"sm",onClick:Nt,children:"Delete Selected"}),e.jsx($,{variant:"outline",size:"sm",onClick:wt,children:"Export Selected"})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",ze+1," to ",Math.min(tt,_e)," of ",_e," records"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Records per page:"}),e.jsxs(le,{value:F.toString(),onValueChange:l=>V(Number(l)),children:[e.jsx(ie,{className:"w-[100px]",children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"50",children:"50"}),e.jsx(S,{value:"100",children:"100"}),e.jsx(S,{value:"500",children:"500"})]})]})]})]}),e.jsx("div",{className:"border rounded-md",children:e.jsx("div",{className:"overflow-auto",style:{maxHeight:"600px"},children:e.jsx(ds,{data:ee(bt.map(l=>({...l,formattedDateAssigned:new Date(l.date_assigned).toLocaleDateString("en-GB"),formattedDateCompleted:l.date_completed?new Date(l.date_completed).toLocaleDateString("en-GB"):"-"}))),columns:[{key:"task_id",label:"Task ID",sortable:!0,dataType:"string"},{key:"stock_name",label:"Stock Name",sortable:!0,dataType:"string"},{key:"stock_source",label:"Stock Source",sortable:!0,dataType:"string"},{key:"formattedDateAssigned",label:"Date Assigned",sortable:!0,dataType:"date"},{key:"process_name",label:"Process",sortable:!0,dataType:"string"},{key:"assigned_quantity",label:"Assigned Qty",sortable:!0,dataType:"number",align:"right",headerClassName:"bg-purple-50",cellClassName:"bg-purple-50 font-medium"},{key:"staff_name",label:"Staff Name",sortable:!0,dataType:"string"},{key:"formattedDateCompleted",label:"Date Completed",sortable:!0,dataType:"date"},{key:"completed_quantity",label:"Completed Qty",sortable:!0,dataType:"number",align:"right",headerClassName:"bg-green-50",cellClassName:"bg-green-50 font-medium"},{key:"wastage_quantity",label:"Wastage Qty",sortable:!0,dataType:"number",align:"right"},{key:"remarks",label:"Remarks",sortable:!0,dataType:"string"},{key:"status",label:"Status",sortable:!0,dataType:"string",formatter:l=>e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${l==="completed"?"bg-green-100 text-green-800":l==="in_progress"?"bg-yellow-100 text-yellow-800":l==="pending"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:l==="in_progress"?"In Progress":l.charAt(0).toUpperCase()+l.slice(1)})}],onSort:L,currentSort:ne,loading:Z,maxHeight:"none",stickyHeader:!0,bordered:!1,searchable:!1,selectable:!0,selectedRows:p,onSelectionChange:m,rowKey:"$id",actions:[qs.edit(l=>ft(l)),qs.delete(l=>jt(l))],emptyMessage:"No pre-production tasks found"})})}),He>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx($,{variant:"outline",size:"sm",onClick:()=>D(l=>Math.max(1,l-1)),disabled:E===1,children:"Previous"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",E," of ",He]})}),e.jsx($,{variant:"outline",size:"sm",onClick:()=>D(l=>Math.min(He,l+1)),disabled:E===He,children:"Next"})]})]})}),e.jsx(hc,{isOpen:a,onClose:()=>{n(!1),c(null)},onSubmit:Mt,editingTask:i,isLoading:R.isPending||k.isPending})]})},gc=({items:r,onItemsChange:t,availableStocks:s,isLoading:a=!1})=>{const n=()=>{const m={stock_id:"",stock_name:"",quantity:0,action:""};t([...r,m])},i=m=>{const o=r.filter((g,b)=>b!==m);t(o)},c=(m,o,g)=>{const b=[...r];if(b[m]={...b[m],[o]:g},o==="stock_id"){const x=s.find(j=>j.$id===g);b[m].stock_name=x?.stock_name||""}t(b)},p=()=>r.reduce((m,o)=>m+(o.quantity||0),0);return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(M,{className:"text-xs font-medium",children:"Stock Items"}),e.jsxs($,{type:"button",variant:"outline",size:"sm",onClick:n,disabled:a,className:"h-7 px-2 text-xs",children:[e.jsx(Ct,{className:"h-3 w-3 mr-1"}),"Add Row"]})]}),r.length===0?e.jsxs("div",{className:"text-center py-4 text-muted-foreground border-2 border-dashed rounded-lg",children:[e.jsx("p",{className:"text-xs",children:"No stock items added"}),e.jsx("p",{className:"text-xs",children:'Click "Add Row" to add stock items'})]}):e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsx("div",{className:"max-h-64 overflow-y-auto",children:e.jsxs(mt,{children:[e.jsx(ht,{className:"sticky top-0 bg-white z-10",children:e.jsxs(ke,{children:[e.jsx(J,{className:"text-xs py-2",children:"Stock Name"}),e.jsx(J,{className:"text-xs py-2 w-24",children:"Qty (kg)"}),e.jsx(J,{className:"text-xs py-2 w-20",children:"Action"}),e.jsx(J,{className:"text-xs py-2 w-12",children:"Remove"})]})}),e.jsx(pt,{children:r.map((m,o)=>e.jsxs(ke,{className:"h-10",children:[e.jsx(W,{className:"py-1",children:e.jsxs(le,{value:m.stock_id,onValueChange:g=>c(o,"stock_id",g),disabled:a,children:[e.jsx(ie,{className:"h-7 text-xs",children:e.jsx(ce,{placeholder:"Select Stock"})}),e.jsx(oe,{children:s.map(g=>e.jsxs(S,{value:g.$id||"",children:[g.stock_name," (",g.stock_code,")"]},g.$id))})]})}),e.jsx(W,{className:"py-1",children:e.jsx(G,{type:"number",step:"0.01",min:"0",value:m.quantity||"",onChange:g=>c(o,"quantity",parseFloat(g.target.value)||0),placeholder:"0",disabled:a,className:"h-7 text-xs",maxLength:10})}),e.jsx(W,{className:"py-1",children:e.jsx(G,{value:m.action||"",onChange:g=>c(o,"action",g.target.value),placeholder:"Action",disabled:a,className:"h-7 text-xs"})}),e.jsx(W,{className:"py-1",children:e.jsx($,{type:"button",variant:"ghost",size:"sm",className:"h-6 w-6 p-0 text-red-500 hover:text-red-700 hover:bg-red-50",onClick:()=>i(o),disabled:a,children:e.jsx(Lt,{className:"h-3 w-3"})})})]},o))})]})})}),r.length>0&&e.jsx("div",{className:"flex justify-end bg-gray-50 px-3 py-1 rounded",children:e.jsxs("div",{className:"text-xs font-medium",children:["Total Quantity: ",p().toFixed(2)," kg"]})})]})},fc=[{value:"pending",label:"Pending"},{value:"in_progress",label:"In Progress"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"}],jc=({isOpen:r,onClose:t,onSubmit:s,editingTask:a,isLoading:n=!1})=>{const{data:i}=Ja(),{data:c}=Is(),{data:p}=us(),{data:m}=Xa(),o=p.filter(w=>{const Y=w.department?.toLowerCase();return Y&&Y==="production"?!0:w.process_name?.toLowerCase()==="grinding"}),[g,b]=u.useState({task_id:"",date_assigned:new Date().toISOString().split("T")[0],raw_product_id:"",process_id:"",staff_id:"",source_process_id:"",completed_quantity:"",date_completed:"",wastage_quantity:"",remarks:"",status:"pending"}),[x,j]=u.useState([]),[f,P]=u.useState({}),[N,T]=u.useState(null),A=new Date,E=Tt(A),D=Dt(A),{statusRecords:F}=Za(E.toISOString().split("T")[0],D.toISOString().split("T")[0],{processId:void 0}),{statusRecords:V}=Da(E.toISOString().split("T")[0],D.toISOString().split("T")[0],{processId:void 0}),U=()=>{if(!g.source_process_id||!x.length||!g.raw_product_id){T(null);return}const w=x.reduce((d,I)=>d+(I.quantity||0),0);if(w<=0){T({isValid:!1,availableQty:0,requiredQty:w,stockName:"Stock Items",stockSource:"Unknown",error:"Invalid quantity",validationClass:"bg-yellow-50 text-yellow-700 border-yellow-200",validationMessage:"Total quantity must be greater than 0"});return}const Y=p?.find(d=>d.$id===g.source_process_id),_=m?.find(d=>d.$id===g.raw_product_id);if(!Y||!_){T({isValid:!1,availableQty:0,requiredQty:w,stockName:_?.raw_product||"Unknown Product",stockSource:Y?.process_name||"Unknown Process",error:"Missing reference data",validationClass:"bg-red-50 text-red-700 border-red-200",validationMessage:"Source process or raw product not found"});return}const B="Pre-Production Status",L=x[0]?.stock_name||_.raw_product;let ee=V?.find(d=>d.stock_name===L&&d.process===Y.process_name);if(!ee&&L&&(ee=V?.find(d=>d.stock_name?.toLowerCase().includes(L.toLowerCase().split("(")[0].trim())&&d.process===Y.process_name)),!ee){const d=L?.toLowerCase().split("(")[0].trim()||_.raw_product?.toLowerCase();ee=V?.find(I=>I.process===Y.process_name&&I.stock_name?.toLowerCase().includes(d))}const H=ee?.closing_balance??0,de=H>=w;console.log("ðŸ” RTQV Production Status Check (Enhanced):",{raw_product:_.raw_product,stock_name_from_items:L,source_process:Y.process_name,statusRecord_found:!!ee,statusRecord_stock_name:ee?.stock_name,statusRecord_process:ee?.process,closing_balance:ee?.closing_balance,availableQty:H,totalRequiredQty:w,dataSource:B,forced_fresh:!0,stock_items:x.map(d=>({stock_name:d.stock_name,quantity:d.quantity})),all_preproduction_records:V?.map(d=>({stock_name:d.stock_name,process:d.process,closing_balance:d.closing_balance}))});let K="",h="";de?(K="bg-green-50 text-green-700 border-green-200",h=`âœ“ Available: ${H}kg (Required: ${w}kg)`):H===0?(K="bg-red-50 text-red-700 border-red-200",h=`âœ— Out of stock (Required: ${w}kg)`):(K="bg-orange-50 text-orange-700 border-orange-200",h=`âš  Insufficient stock: ${H}kg available (Required: ${w}kg)`),T({isValid:de,availableQty:H,requiredQty:w,stockName:L||_.raw_product,stockSource:Y.process_name,dataSource:B,isLoading:!1,validationClass:K,validationMessage:h})};u.useEffect(()=>{U()},[g.source_process_id,g.raw_product_id,x,p,m,F,V]);const Z=p.filter(w=>w.process_name==="RFP");u.useEffect(()=>{if(r)if(a)b({task_id:a.task_id||"",date_assigned:a.date||"",raw_product_id:a.raw_product_id||"",process_id:a.process_id||"",staff_id:a.staff_id||"",source_process_id:a.source_process_id||"",completed_quantity:a.completed_quantity?.toString()||"",date_completed:a.date_completed||"",wastage_quantity:a.wastage_quantity?.toString()||"",remarks:a.remarks||"",status:a.status||"pending"}),a.stock_items&&j(a.stock_items.map(w=>({stock_id:w.stock_id,stock_name:w.stock_name,quantity:w.quantity,action:w.action||""})));else{const w=`PROD${Date.now().toString().slice(-6)}`;b({task_id:w,date_assigned:new Date().toISOString().split("T")[0],raw_product_id:"",process_id:"",staff_id:"",source_process_id:"",completed_quantity:"",date_completed:"",wastage_quantity:"",remarks:"",status:"pending"}),j([])}},[a,r]);const O=()=>x.reduce((w,Y)=>w+(Y.quantity||0),0),Q=()=>{const w={};return g.task_id.trim()||(w.task_id="Task ID is required"),g.date_assigned||(w.date_assigned="Date is required"),g.raw_product_id||(w.raw_product_id="Raw product is required"),g.process_id||(w.process_id="Process is required"),g.staff_id||(w.staff_id="Staff is required"),g.source_process_id||(w.source_process_id="Source process is required"),(!g.completed_quantity||parseFloat(g.completed_quantity)<=0)&&(w.completed_quantity="Completed quantity is required and must be greater than 0"),x.length===0&&(w.stock_items="At least one stock item is required"),g.wastage_quantity&&parseFloat(g.wastage_quantity)<0&&(w.wastage_quantity="Wastage quantity cannot be negative"),x.forEach((Y,_)=>{Y.stock_id||(w[`stock_item_${_}_stock`]=`Stock is required for item ${_+1}`),(!Y.quantity||Y.quantity<=0)&&(w[`stock_item_${_}_quantity`]=`Quantity must be greater than 0 for item ${_+1}`)}),P(w),Object.keys(w).length===0},R=w=>{if(w.preventDefault(),!Q())return;const Y={task_id:g.task_id,date:g.date_assigned,raw_product_id:g.raw_product_id,process_id:g.process_id,staff_id:g.staff_id,source_process_id:g.source_process_id,assigned_quantity:O(),completed_quantity:parseFloat(g.completed_quantity),wastage_quantity:g.wastage_quantity?parseFloat(g.wastage_quantity):void 0,remarks:g.remarks||void 0,status:g.status};g.date_completed&&g.date_completed.trim()!==""&&(Y.date_completed=g.date_completed),s({taskData:Y,stockItems:x})},k=()=>{b({task_id:"",date_assigned:new Date().toISOString().split("T")[0],raw_product_id:"",process_id:"",staff_id:"",source_process_id:"",completed_quantity:"",date_completed:"",wastage_quantity:"",remarks:"",status:"pending"}),j([]),P({}),t()};return e.jsx(ct,{open:r,onOpenChange:k,children:e.jsxs(nt,{className:"sm:max-w-[800px] max-w-[95vw] max-h-[90vh] overflow-y-auto",children:[e.jsxs(it,{className:"pb-2",children:[e.jsx(lt,{className:"text-lg",children:a?"Edit Production Task":"Add New Production Task"}),e.jsx(dt,{className:"text-sm",children:a?"Update the production task details below.":"Fill in the details to create a new production task."})]}),e.jsxs("form",{onSubmit:R,children:[e.jsxs("div",{className:"grid gap-3 py-3",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"task_id",className:"text-xs font-medium",children:"Task ID *"}),e.jsx(G,{id:"task_id",value:g.task_id,onChange:w=>b({...g,task_id:w.target.value}),className:`h-8 text-sm ${f.task_id?"border-red-500":""}`,maxLength:15}),f.task_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:f.task_id})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"date_assigned",className:"text-xs font-medium",children:"Date *"}),e.jsx(G,{id:"date_assigned",type:"date",value:g.date_assigned,onChange:w=>b({...g,date_assigned:w.target.value}),className:`h-8 text-sm ${f.date_assigned?"border-red-500":""}`}),f.date_assigned&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:f.date_assigned})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"process_id",className:"text-xs font-medium",children:"Process *"}),e.jsxs(le,{value:g.process_id,onValueChange:w=>b({...g,process_id:w}),children:[e.jsx(ie,{className:`h-8 text-sm ${f.process_id?"border-red-500":""}`,children:e.jsx(ce,{placeholder:"Select Process"})}),e.jsx(oe,{children:o.map(w=>e.jsx(S,{value:w.$id||"",children:w.process_name},w.$id))})]}),f.process_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:f.process_id})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"source_process_id",className:"text-xs font-medium",children:"Source Process *"}),e.jsxs(le,{value:g.source_process_id,onValueChange:w=>b({...g,source_process_id:w}),children:[e.jsx(ie,{className:`h-8 text-sm ${f.source_process_id?"border-red-500":""}`,children:e.jsx(ce,{placeholder:"Select Source"})}),e.jsx(oe,{children:Z.map(w=>e.jsx(S,{value:w.$id||"",children:w.process_name},w.$id))})]}),f.source_process_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:f.source_process_id})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"raw_product_id",className:"text-xs font-medium",children:"Raw Product *"}),e.jsxs(le,{value:g.raw_product_id,onValueChange:w=>b({...g,raw_product_id:w}),children:[e.jsx(ie,{className:`h-8 text-sm ${f.raw_product_id?"border-red-500":""}`,children:e.jsx(ce,{placeholder:"Select Raw Product"})}),e.jsx(oe,{children:m.map(w=>e.jsx(S,{value:w.$id||"",children:w.raw_product},w.$id))})]}),f.raw_product_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:f.raw_product_id})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"staff_id",className:"text-xs font-medium",children:"Staff Name *"}),e.jsxs(le,{value:g.staff_id,onValueChange:w=>b({...g,staff_id:w}),children:[e.jsx(ie,{className:`h-8 text-sm ${f.staff_id?"border-red-500":""}`,children:e.jsx(ce,{placeholder:"Select Staff"})}),e.jsx(oe,{children:c.map(w=>e.jsx(S,{value:w.$id||"",children:w.staff_name},w.$id))})]}),f.staff_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:f.staff_id})]})]}),e.jsxs("div",{children:[e.jsx(M,{className:"text-base font-semibold",children:"Stock Items"}),e.jsx(gc,{items:x,onItemsChange:j,availableStocks:i,isLoading:n}),f.stock_items&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:f.stock_items}),N&&e.jsxs("div",{className:`mt-2 p-3 rounded-md border text-sm ${N.validationClass}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("div",{className:"font-medium",children:N.stockName}),e.jsxs("div",{className:"text-xs opacity-75",children:["Source: ",N.dataSource]})]}),e.jsx("div",{className:"mb-1",children:N.validationMessage}),N.error&&e.jsxs("div",{className:"text-xs mt-1 opacity-75",children:["Error: ",N.error]}),N.isLoading&&e.jsxs("div",{className:"flex items-center gap-2 text-xs mt-1",children:[e.jsx("div",{className:"animate-spin h-3 w-3 border border-current border-t-transparent rounded-full"}),"Loading fresh data from ",N.dataSource,"..."]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"assigned_quantity",className:"text-xs font-medium",children:"Assigned Qty (Auto-calculated)"}),e.jsxs("div",{className:"relative",children:[e.jsx(G,{id:"assigned_quantity",type:"number",value:O().toFixed(2),disabled:!0,className:"bg-gray-50 h-8 text-sm pr-8",maxLength:10}),e.jsx("span",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-xs text-gray-500",children:"kg"})]})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"completed_quantity",className:"text-xs font-medium",children:"Completed Qty *"}),e.jsxs("div",{className:"relative",children:[e.jsx(G,{id:"completed_quantity",type:"number",step:"0.01",min:"0",value:g.completed_quantity,onChange:w=>b({...g,completed_quantity:w.target.value}),className:`h-8 text-sm pr-8 ${f.completed_quantity?"border-red-500":""}`,maxLength:10}),e.jsx("span",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-xs text-gray-500",children:"kg"})]}),f.completed_quantity&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:f.completed_quantity})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"wastage_quantity",className:"text-xs font-medium",children:"Wastage Qty"}),e.jsxs("div",{className:"relative",children:[e.jsx(G,{id:"wastage_quantity",type:"number",step:"0.01",min:"0",value:g.wastage_quantity,onChange:w=>b({...g,wastage_quantity:w.target.value}),className:`h-8 text-sm pr-8 ${f.wastage_quantity?"border-red-500":""}`,maxLength:10}),e.jsx("span",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-xs text-gray-500",children:"kg"})]}),f.wastage_quantity&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:f.wastage_quantity})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"date_completed",className:"text-xs font-medium",children:"Date Completed"}),e.jsx(G,{id:"date_completed",type:"date",value:g.date_completed,onChange:w=>b({...g,date_completed:w.target.value}),className:"h-8 text-sm"})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"status",className:"text-xs font-medium",children:"Status"}),e.jsxs(le,{value:g.status,onValueChange:w=>b({...g,status:w}),children:[e.jsx(ie,{className:"h-8 text-sm",children:e.jsx(ce,{})}),e.jsx(oe,{children:fc.map(w=>e.jsx(S,{value:w.value,children:w.label},w.value))})]})]})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"remarks",className:"text-xs font-medium",children:"Remarks"}),e.jsx(rs,{id:"remarks",value:g.remarks,onChange:w=>b({...g,remarks:w.target.value}),placeholder:"Enter any remarks",rows:2,className:"text-sm resize-none"})]})]}),e.jsxs(ot,{className:"pt-3 flex-col sm:flex-row gap-2",children:[e.jsx($,{type:"button",variant:"outline",onClick:k,className:"h-8 px-4 text-sm w-full sm:w-auto",children:"Cancel"}),e.jsx($,{type:"submit",disabled:n,className:"h-8 px-4 text-sm w-full sm:w-auto",children:n?"Saving...":a?"Update":"Save"})]})]})]})})},yc=()=>{const r=xt(),[t,s]=u.useState(""),[a,n]=u.useState(!1),[i,c]=u.useState(null),[p,m]=u.useState([]),[o,g]=u.useState({show:!1,message:"",type:"success"}),[b,x]=u.useState("all"),[j,f]=u.useState("all"),[P,N]=u.useState("all"),[T,A]=u.useState({from:"",to:""}),[E,D]=u.useState(1),[F,V]=u.useState(50),{tasks:U,isLoading:Z,error:O,refetch:Q}=Kn(),{createTask:R,updateTask:k,deleteTask:w}=Kl(),{config:Y}=Et("production-tasks"),{validationRules:_,canImport:B}=Rt("production-tasks"),{currentSort:ne,handleSort:L,getSortedData:ee}=as(),{data:H}=us(),{data:de}=Xa(),{data:K}=Is(),{toast:h}=Fe(),{data:d}=ye({queryKey:["production-tasks","all"],queryFn:()=>Wt.getAll()}),I=(l,re)=>{g({show:!0,message:l,type:re}),setTimeout(()=>g({show:!1,message:"",type:"success"}),3e3)},C=U.filter(l=>{const re=l.task_id.toLowerCase().includes(t.toLowerCase())||l.raw_product_name.toLowerCase().includes(t.toLowerCase())||l.staff_name.toLowerCase().includes(t.toLowerCase())||l.process_name.toLowerCase().includes(t.toLowerCase()),v=b==="all"||l.raw_product_name.toLowerCase().includes(b.toLowerCase()),X=j==="all"||l.process_name.toLowerCase().includes(j.toLowerCase()),fe=P==="all"||l.staff_name.toLowerCase().includes(P.toLowerCase()),Ne=(!T.from||l.date>=T.from)&&(!T.to||l.date<=T.to);return re&&v&&X&&fe&&Ne}),ae=Array.from(new Set(U.map(l=>l.raw_product_name))).sort(),Se=Array.from(new Set(U.map(l=>l.process_name))).sort(),ve=Array.from(new Set(U.map(l=>l.staff_name))).sort(),_e=C.length,He=Math.ceil(_e/F),ze=(E-1)*F,tt=ze+F,bt=C.slice(ze,tt);u.useEffect(()=>{D(1)},[t,b,j,P,T,F]);const Mt=async l=>{try{i?(await k.mutateAsync({id:i.$id,taskData:l.taskData,stockItems:l.stockItems}),I("Production task updated successfully","success")):(await R.mutateAsync(l),I("Production task created successfully","success")),n(!1),c(null)}catch(re){console.error("Error saving task:",re),I("Failed to save task","error")}},ft=l=>{c(l),n(!0)},jt=async l=>{if(window.confirm("Are you sure you want to delete this task?"))try{await w.mutateAsync(l.$id),I("Production task deleted successfully","success")}catch(re){console.error("Error deleting task:",re),I("Failed to delete task","error")}},Nt=async()=>{if(p.length===0){I("Please select tasks to delete","error");return}if(window.confirm(`Are you sure you want to delete ${p.length} selected task(s)?`))try{await Promise.all(p.map(l=>w.mutateAsync(l.$id))),m([]),I(`${p.length} tasks deleted successfully`,"success")}catch(l){console.error("Error deleting tasks:",l),I("Failed to delete selected tasks","error")}},wt=()=>{if(p.length===0){I("Please select tasks to export","error");return}I(`Exporting ${p.length} selected task(s)...`,"success")};return O?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Production Tasks"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage production processing tasks"})]}),e.jsx(te,{children:e.jsx(se,{className:"pt-6",children:e.jsxs("div",{className:"text-center py-12 text-red-600",children:[e.jsx("p",{className:"text-lg mb-2",children:"Error loading tasks"}),e.jsx("p",{className:"text-sm mb-4",children:O.message}),e.jsx($,{onClick:()=>Q(),variant:"outline",children:"Retry"})]})})})]}):e.jsxs("div",{className:"space-y-6",children:[o.show&&e.jsx("div",{className:`fixed top-4 right-4 px-4 py-2 rounded-md shadow-lg z-50 ${o.type==="success"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300"}`,children:o.message}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Production Tasks"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage production processing tasks"})]}),e.jsxs($,{className:"bg-primary hover:bg-primary/90 w-full sm:w-auto",onClick:()=>{c(null),n(!0)},children:[e.jsx(Ct,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"sm:inline",children:"Add New"})]})]}),e.jsx(te,{children:e.jsx(se,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4 items-stretch sm:items-center",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(gt,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(G,{placeholder:"Search tasks...",className:"pl-10",value:t,onChange:l=>s(l.target.value)})]}),B&&Y&&e.jsx(qt,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:Y.exportColumns.filter(l=>l.required).map(l=>l.exportHeader),optionalColumns:Y.exportColumns.filter(l=>!l.required).map(l=>l.exportHeader),validationRules:_,maxFileSize:50,existingData:d||[],validationHeaderMapper:l=>{const re=Y.exportColumns.find(v=>v.dataKey===l);return re?re.exportHeader:l},columnMapper:l=>{const re=Y.exportColumns.find(v=>v.exportHeader===l);return re?re.dataKey==="raw_product_name"?"raw_product_name":re.dataKey==="process_name"?"process_name":re.dataKey==="source_process_name"?"source_process_name":re.dataKey==="staff_name"?"staff_name":re.dataKey==="date_completed"?"date_completed":re.dataKey==="completed_quantity"?"completed_quantity":{task_id:"task_id",date:"date",assigned_quantity:"assigned_quantity",wastage_quantity:"wastage_quantity",status:"status"}[re.dataKey]||re.dataKey:l},dataProcessor:async l=>{let re=l["Raw Product"]||l.raw_product_name||l.raw_product_name;if(!re||re==="")throw new Error("Raw Product is required");const v=String(re).trim(),X=de?.find(y=>y.product_name.toLowerCase()===v.toLowerCase());if(!X){const y=de?.map(z=>z.product_name).slice(0,5).join(", ")||"None";throw new Error(`Raw Product "${v}" not found. Available: ${y}`)}const fe=X.$id;let Ne=l.Process||l.process_name||l.process_name;if(!Ne||Ne==="")throw new Error("Process is required");const Ie=String(Ne).trim(),Le=H?.find(y=>y.process_name.toLowerCase()===Ie.toLowerCase());if(!Le){const y=H?.map(z=>z.process_name).slice(0,5).join(", ")||"None";throw new Error(`Process "${Ie}" not found. Available: ${y}`)}const Me=Le.$id;let q="",je=l["Staff Name"]||l.staff_name||l.staff_name;if(je&&je!==""){const y=String(je).trim(),z=K?.find(ue=>ue.staff_name.toLowerCase()===y.toLowerCase());z&&(q=z.$id)}if(!q&&K&&K.length>0&&(q=K[0].$id),!q)throw new Error("Staff is required. Please ensure staff data is available.");let we="",be=l["Source Process"]||l.source_process_name||l.source_process_name;if(be&&be!==""){const y=String(be).trim(),z=H?.find(ue=>ue.process_name.toLowerCase()===y.toLowerCase());z&&(we=z.$id)}if(!we){const y=H?.find(z=>z.process_name.toLowerCase()==="rfp");y?we=y.$id:H&&H.length>0&&(we=H[0].$id)}if(!we)throw new Error("Source Process is required. Please ensure process data is available.");const yt=y=>{if(!y||y==="")return"";let z=y;if(typeof y=="string"){const ue=y.match(/^(\d{2})-(\d{2})-(\d{4})$/);if(ue){const[,ge,De,Ee]=ue,qe=new Date(parseInt(Ee),parseInt(De)-1,parseInt(ge));isNaN(qe.getTime())||(z=qe.toISOString().split("T")[0])}else{const ge=new Date(y);isNaN(ge.getTime())||(z=ge.toISOString().split("T")[0])}}else y instanceof Date&&(z=y.toISOString().split("T")[0]);return z};let Re=l.Date||l.date||l.date||new Date().toISOString().split("T")[0];Re=yt(Re)||new Date().toISOString().split("T")[0];let Pe=l["Date Completed"]||l.date_completed||l.date_completed||Re;Pe=yt(Pe)||Re;const Oe=l["Completed Qty"]||l.completed_quantity||l.completed_quantity,Ke=Oe!=null&&Oe!==""?parseFloat(String(Oe)):void 0,$e={task_id:l["Task ID"]||l.task_id||l.task_id,date:Re,raw_product_id:fe,process_id:Me,staff_id:q,source_process_id:we,assigned_quantity:parseFloat(l["Assigned Qty"]||l.assigned_quantity||l.assigned_quantity||0),wastage_quantity:parseFloat(l["Wastage Qty"]||l.wastage_quantity||l.wastage_quantity||0),status:"completed"};return Ke!==void 0&&!isNaN(Ke)&&($e.completed_quantity=Ke),Pe&&($e.date_completed=Pe),await Wt.create($e)},onImportComplete:async l=>{await r.invalidateQueries({queryKey:["production-tasks"],refetchType:"active"}),await r.refetchQueries({queryKey:["production-tasks"]}),Q(),l.successfulRows>0&&h({title:"Import Successful",description:`${l.successfulRows} production tasks imported successfully.`}),l.failedRows>0&&h({title:"Import Completed with Errors",description:`${l.successfulRows} successful, ${l.failedRows} failed.`,variant:"destructive"})}},variant:"outline"}),Y&&e.jsx(At,{data:C.map(l=>{const re={};return Y.exportColumns.forEach(v=>{const X=l[v.dataKey];re[v.exportHeader]=v.formatter?v.formatter(X):X}),re}),headers:Y.exportColumns.map(l=>l.exportHeader),filename:"production-tasks",variant:"outline"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-3 sm:gap-4",children:[e.jsxs(le,{value:b,onValueChange:x,children:[e.jsx(ie,{className:"w-full",children:e.jsx(ce,{placeholder:"Raw Product"})}),e.jsxs(oe,{children:[e.jsx(S,{value:"all",children:"All Raw Products"}),ae.map(l=>e.jsx(S,{value:l,children:l},l))]})]}),e.jsxs(le,{value:j,onValueChange:f,children:[e.jsx(ie,{className:"w-full",children:e.jsx(ce,{placeholder:"Process"})}),e.jsxs(oe,{children:[e.jsx(S,{value:"all",children:"All Processes"}),Se.map(l=>e.jsx(S,{value:l,children:l},l))]})]}),e.jsxs(le,{value:P,onValueChange:N,children:[e.jsx(ie,{className:"w-full",children:e.jsx(ce,{placeholder:"Staff Name"})}),e.jsxs(oe,{children:[e.jsx(S,{value:"all",children:"All Staff"}),ve.map(l=>e.jsx(S,{value:l,children:l},l))]})]}),e.jsx(G,{type:"date",placeholder:"From Date",className:"w-full",value:T.from,onChange:l=>A(re=>({...re,from:l.target.value}))}),e.jsx(G,{type:"date",placeholder:"To Date",className:"w-full",value:T.to,onChange:l=>A(re=>({...re,to:l.target.value}))})]})]})})}),e.jsx(te,{children:e.jsxs(se,{className:"pt-6",children:[p.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 p-3 bg-muted rounded-md",children:[e.jsxs("span",{className:"text-sm font-medium",children:[p.length," selected"]}),e.jsx($,{variant:"destructive",size:"sm",onClick:Nt,children:"Delete Selected"}),e.jsx($,{variant:"outline",size:"sm",onClick:wt,children:"Export Selected"})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",ze+1," to ",Math.min(tt,_e)," of ",_e," records"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Records per page:"}),e.jsxs(le,{value:F.toString(),onValueChange:l=>V(Number(l)),children:[e.jsx(ie,{className:"w-[100px]",children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"50",children:"50"}),e.jsx(S,{value:"100",children:"100"}),e.jsx(S,{value:"500",children:"500"})]})]})]})]}),e.jsx("div",{className:"border rounded-md",children:e.jsx("div",{className:"overflow-auto",style:{maxHeight:"600px"},children:e.jsx(ds,{data:ee(bt.map(l=>({...l,formattedDate:new Date(l.date).toLocaleDateString("en-GB")}))),columns:[{key:"task_id",label:"Task ID",sortable:!0,dataType:"string"},{key:"formattedDate",label:"Date",sortable:!0,dataType:"date"},{key:"raw_product_name",label:"Raw Product",sortable:!0,dataType:"string"},{key:"process_name",label:"Process",sortable:!0,dataType:"string"},{key:"staff_name",label:"Staff Name",sortable:!0,dataType:"string"},{key:"assigned_quantity",label:"Assigned Qty",sortable:!0,dataType:"number",align:"right",headerClassName:"bg-purple-50",cellClassName:"bg-purple-50 font-medium"},{key:"completed_quantity",label:"Completed Qty",sortable:!0,dataType:"number",align:"right",headerClassName:"bg-green-50",cellClassName:"bg-green-50 font-medium"},{key:"wastage_quantity",label:"Wastage Qty",sortable:!0,dataType:"number",align:"right"},{key:"status",label:"Status",sortable:!0,dataType:"string",formatter:l=>e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${l==="completed"?"bg-green-100 text-green-800":l==="in_progress"?"bg-yellow-100 text-yellow-800":l==="pending"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:l==="in_progress"?"In Progress":l.charAt(0).toUpperCase()+l.slice(1)})}],onSort:L,currentSort:ne,loading:Z,maxHeight:"none",stickyHeader:!0,bordered:!1,searchable:!1,selectable:!0,selectedRows:p,onSelectionChange:m,rowKey:"$id",actions:[qs.edit(l=>ft(l)),qs.delete(l=>jt(l))],emptyMessage:"No production tasks found"})})}),He>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx($,{variant:"outline",size:"sm",onClick:()=>D(l=>Math.max(1,l-1)),disabled:E===1,children:"Previous"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",E," of ",He]})}),e.jsx($,{variant:"outline",size:"sm",onClick:()=>D(l=>Math.min(He,l+1)),disabled:E===He,children:"Next"})]})]})}),e.jsx(jc,{isOpen:a,onClose:()=>{n(!1),c(null)},onSubmit:Mt,editingTask:i,isLoading:R.isPending||k.isPending})]})},vc=[{value:"pending",label:"Pending"},{value:"in_progress",label:"In Progress"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"}],bc=({isOpen:r,onClose:t,onSubmit:s,editingTask:a,isLoading:n=!1})=>{const{data:i}=Is(),{data:c}=us(),{data:p}=Bn(),{data:m}=Xa(),[o,g]=u.useState({task_id:"",date_assigned:new Date().toISOString().split("T")[0],date_completed:"",raw_product_id:"",source_process_id:"",source_quantity:"",sku:"",product_id:"",process_id:"",staff_id:"",completed_quantity:"",wastage_quantity:"",remarks:"",status:"pending"}),[b,x]=u.useState({}),[j,f]=u.useState(null),P=new Date,N=Tt(P),T=Dt(P),{statusRecords:A}=Hn(N.toISOString().split("T")[0],T.toISOString().split("T")[0]),{statusRecords:E}=Za(N.toISOString().split("T")[0],T.toISOString().split("T")[0]),D=()=>{if(!o.source_process_id||!o.source_quantity||!o.product_id){f(null);return}const _=parseFloat(o.source_quantity);if(_<=0){f({isValid:!1,availableQty:0,requiredQty:_,stockName:"Source Material",stockSource:"Unknown",error:"Invalid quantity",validationClass:"bg-yellow-50 text-yellow-700 border-yellow-200",validationMessage:"Source quantity must be greater than 0"});return}const B=c?.find(C=>C.$id===o.source_process_id),ne=p?.find(C=>C.$id===o.product_id);if(!B||!ne){f({isValid:!1,availableQty:0,requiredQty:_,stockName:ne?.product_name||"Unknown Product",stockSource:B?.process_name||"Unknown Process",error:"Missing reference data",validationClass:"bg-red-50 text-red-700 border-red-200",validationMessage:"Source process or product not found"});return}let L="",ee=null,H=0;const de=B.process_name?.toLowerCase();if(de==="grinding"){L="Production Status";const C=ne.product_name;if(ee=E?.find(ae=>ae.stock_name===C&&ae.process===B.process_name),!ee&&C){const ae=C.toLowerCase().split(" ")[0];ee=E?.find(Se=>Se.stock_name?.toLowerCase().includes(ae)&&Se.process===B.process_name)}ee||(ee=E?.find(ae=>ae.process===B.process_name&&(ae.stock_name?.toLowerCase().includes("chilli")||ae.stock_name?.toLowerCase().includes("powder"))))}else de==="packing"&&(L="Post-Production Status",ee=A?.find(C=>C.product_name===ne.product_name&&C.process_name===B.process_name));H=ee?.closing_balance??0;const K=H>=_;console.log("ðŸ” RTQV Post-Production Status Check (Enhanced):",{product_name:ne.product_name,source_process:B.process_name,source_process_type:de,statusRecord_found:!!ee,statusRecord_stock_name:ee?.stock_name,statusRecord_process:ee?.process,closing_balance:ee?.closing_balance,availableQty:H,requiredQty:_,dataSource:L,forced_fresh:!0,all_production_records:de==="grinding"?E?.map(C=>({stock_name:C.stock_name,process:C.process,closing_balance:C.closing_balance})):[],all_postproduction_records:de==="packing"?A?.map(C=>({product_name:C.product_name,process_name:C.process_name,closing_balance:C.closing_balance})):[]});let h="",d="";const I=de==="grinding"?"kg":"units";K?(h="bg-green-50 text-green-700 border-green-200",d=`âœ“ Available: ${H}${I} (Required: ${_}${I})`):H===0?(h="bg-red-50 text-red-700 border-red-200",d=`âœ— Out of stock (Required: ${_}${I})`):(h="bg-orange-50 text-orange-700 border-orange-200",d=`âš  Insufficient stock: ${H}${I} available (Required: ${_}${I})`),f({isValid:K,availableQty:H,requiredQty:_,stockName:ne.product_name,stockSource:B.process_name,dataSource:L,isLoading:!1,validationClass:h,validationMessage:d})};u.useEffect(()=>{D()},[o.source_process_id,o.product_id,o.source_quantity,c,p,A,E]);const F=c.filter(_=>{const B=_.department?.toLowerCase();if(B&&B==="post-production")return!0;const ne=_.process_name?.toLowerCase();return["packing","batch coding"].includes(ne)});console.log("All Processes:",c.map(_=>_.process_name)),console.log("Post Production Processes:",F.map(_=>_.process_name));const V=c.find(_=>_.$id===o.process_id),U=V?.process_name==="Batch Coding",Z=V?.process_name==="Packing",O=()=>U,R=(()=>{if(!o.process_id)return[];const _=c.find(ne=>ne.$id===o.process_id);if(!_)return[];const B=_.process_name?.toLowerCase();return B==="packing"?c.filter(ne=>ne.process_name?.toLowerCase()==="grinding"):B==="batch coding"?c.filter(ne=>ne.process_name?.toLowerCase()==="packing"):[]})();u.useEffect(()=>{o.process_id&&(g(_=>({..._,source_process_id:"",source_quantity:U?"":_.source_quantity,raw_product_id:U?"":_.raw_product_id})),console.log("Selected Process:",V?.process_name),console.log("Is Batch Coding:",U))},[o.process_id,c,U,V]),u.useEffect(()=>{if(r)if(a){const _=B=>{if(!B)return"";try{const ne=new Date(B);return isNaN(ne.getTime())?"":ne.toISOString().split("T")[0]}catch{return""}};g({task_id:a.task_id,date_assigned:_(a.date),date_completed:_(a.date_completed||""),raw_product_id:a.raw_product_id||"",source_process_id:a.source_process_id,source_quantity:a.source_quantity.toString(),sku:a.sku,product_id:a.product_id,process_id:a.process_id,staff_id:a.staff_id,completed_quantity:a.units?.toString()||"",wastage_quantity:a.wastage_quantity?.toString()||"",remarks:a.remarks||"",status:a.status})}else{const _=`POST${Date.now().toString().slice(-6)}`;g({task_id:_,date_assigned:new Date().toISOString().split("T")[0],date_completed:"",raw_product_id:"",source_process_id:"",source_quantity:"",sku:"",product_id:"",process_id:"",staff_id:"",completed_quantity:"",wastage_quantity:"",remarks:"",status:"pending"})}},[a,r]);const k=()=>{const _={},ne=c.find(L=>L.$id===o.process_id)?.process_name==="Batch Coding";return o.task_id.trim()||(_.task_id="Task ID is required"),o.date_assigned||(_.date_assigned="Date is required"),!ne&&!o.raw_product_id&&(_.raw_product_id="Raw Product is required"),o.process_id||(_.process_id="Process is required"),o.source_process_id||(_.source_process_id="Source process is required"),!ne&&(!o.source_quantity||parseFloat(o.source_quantity)<=0)&&(_.source_quantity="Source quantity must be greater than 0"),o.sku.trim()||(_.sku="SKU is required"),o.product_id||(_.product_id="Product is required"),o.staff_id||(_.staff_id="Staff is required"),o.status==="completed"&&((!o.completed_quantity||parseFloat(o.completed_quantity)<=0)&&(_.completed_quantity="Completed units must be greater than 0"),o.wastage_quantity&&parseFloat(o.wastage_quantity)<0&&(_.wastage_quantity="Wastage quantity cannot be negative")),x(_),Object.keys(_).length===0},w=_=>{if(_.preventDefault(),!k())return;const ne=c.find(ee=>ee.$id===o.process_id)?.process_name==="Batch Coding",L={task_id:o.task_id,date:o.date_assigned,date_completed:o.status==="completed"?o.date_completed:void 0,source_process_id:o.source_process_id,source_quantity:ne?0:parseFloat(o.source_quantity)||0,sku:o.sku,product_id:o.product_id,process_id:o.process_id,staff_id:o.staff_id,units:o.completed_quantity?parseFloat(o.completed_quantity):0,wastage_quantity:o.status==="completed"&&o.wastage_quantity?parseFloat(o.wastage_quantity):void 0,remarks:o.remarks||void 0,status:o.status};console.log("ðŸš€ SUBMITTING POST-PRODUCTION TASK DATA:",L),s(L)},Y=()=>{g({task_id:"",date_assigned:new Date().toISOString().split("T")[0],date_completed:"",raw_product_id:"",source_process_id:"",source_quantity:"",sku:"",product_id:"",process_id:"",staff_id:"",completed_quantity:"",wastage_quantity:"",remarks:"",status:"pending"}),x({}),t()};return e.jsx(ct,{open:r,onOpenChange:Y,children:e.jsxs(nt,{className:"sm:max-w-[600px] max-w-[95vw] max-h-[90vh] overflow-y-auto",children:[e.jsxs(it,{children:[e.jsx(lt,{children:a?"Edit Post-Production Task":"Add New Post-Production Task"}),e.jsx(dt,{children:a?"Update the post-production task details below.":"Fill in the details to create a new post-production task."})]}),e.jsxs("form",{onSubmit:w,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"task_id",children:"Task ID *"}),e.jsx(G,{id:"task_id",value:o.task_id,onChange:_=>g({...o,task_id:_.target.value}),className:b.task_id?"border-red-500":""}),b.task_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:b.task_id})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"date_assigned",children:"Date Assigned *"}),e.jsx(G,{id:"date_assigned",type:"date",value:o.date_assigned,onChange:_=>g({...o,date_assigned:_.target.value}),className:b.date_assigned?"border-red-500":""}),b.date_assigned&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:b.date_assigned})]})]}),e.jsxs("div",{children:[e.jsxs(M,{htmlFor:"raw_product_id",children:["Raw Product ",!U&&"*",U&&e.jsx("span",{className:"text-muted-foreground",children:"(N/A for Batch Coding)"})]}),U?e.jsx(G,{value:"N/A",disabled:!0,className:"bg-gray-100 text-muted-foreground"}):e.jsxs(le,{value:o.raw_product_id,onValueChange:_=>g({...o,raw_product_id:_}),children:[e.jsx(ie,{className:b.raw_product_id?"border-red-500":"",children:e.jsx(ce,{placeholder:"Select Raw Product"})}),e.jsx(oe,{children:m?.map(_=>e.jsx(S,{value:_.$id||"",children:_.raw_product},_.$id))})]}),b.raw_product_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:b.raw_product_id}),e.jsx("p",{className:"text-muted-foreground text-xs mt-1",children:U?"Batch Coding works with finished products (units), not raw products":"Select the raw product powder (kg) from Grinding process to be packed into units"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"process_id",children:"Process *"}),e.jsxs(le,{value:o.process_id,onValueChange:_=>g({...o,process_id:_,source_process_id:""}),children:[e.jsx(ie,{className:b.process_id?"border-red-500":"",children:e.jsx(ce,{placeholder:"Select Process"})}),e.jsx(oe,{children:F.map(_=>e.jsx(S,{value:_.$id||"",children:_.process_name},_.$id))})]}),b.process_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:b.process_id})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"source_process_id",children:"Source Process *"}),e.jsxs(le,{value:o.source_process_id,onValueChange:_=>g({...o,source_process_id:_}),children:[e.jsx(ie,{className:b.source_process_id?"border-red-500":"",disabled:!o.process_id,children:e.jsx(ce,{placeholder:o.process_id?"Select Source Process":"First select a Process"})}),e.jsx(oe,{children:R.map(_=>e.jsx(S,{value:_.$id||"",children:_.process_name},_.$id))})]}),b.source_process_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:b.source_process_id})]})]}),e.jsxs("div",{children:[e.jsxs(M,{htmlFor:"source_quantity",children:[Z?"Source Qty (kg) *":"Source Qty"," ",!O()&&!Z&&"*"]}),e.jsx(G,{id:"source_quantity",type:"number",step:"0.01",min:"0",value:O()?"N/A":o.source_quantity,onChange:_=>!O()&&g({...o,source_quantity:_.target.value}),className:b.source_quantity?"border-red-500":"",disabled:O(),placeholder:O()?"N/A":Z?"Raw product quantity in kg":"Enter source quantity"}),b.source_quantity&&!O()&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:b.source_quantity}),O()&&e.jsx("p",{className:"text-muted-foreground text-xs mt-1",children:"Source quantity is not required for Batch Coding"}),Z&&e.jsx("p",{className:"text-muted-foreground text-xs mt-1",children:"Raw product powder quantity from Grinding process"}),j&&!O()&&e.jsxs("div",{className:`mt-2 p-3 rounded-md border text-sm ${j.validationClass}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("div",{className:"font-medium",children:j.stockName}),e.jsxs("div",{className:"text-xs opacity-75",children:["Source: ",j.dataSource]})]}),e.jsx("div",{className:"mb-1",children:j.validationMessage}),j.error&&e.jsxs("div",{className:"text-xs mt-1 opacity-75",children:["Error: ",j.error]}),j.isLoading&&e.jsxs("div",{className:"flex items-center gap-2 text-xs mt-1",children:[e.jsx("div",{className:"animate-spin h-3 w-3 border border-current border-t-transparent rounded-full"}),"Loading fresh data from ",j.dataSource,"..."]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"sku",children:"SKU *"}),e.jsx(G,{id:"sku",value:o.sku,onChange:_=>g({...o,sku:_.target.value}),className:b.sku?"border-red-500":"",placeholder:"Enter SKU"}),b.sku&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:b.sku})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"product_id",children:"Product *"}),e.jsxs(le,{value:o.product_id,onValueChange:_=>g({...o,product_id:_}),children:[e.jsx(ie,{className:b.product_id?"border-red-500":"",children:e.jsx(ce,{placeholder:"Select Product"})}),e.jsx(oe,{children:p.map(_=>e.jsx(S,{value:_.$id||"",children:_.product},_.$id))})]}),b.product_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:b.product_id})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"staff_id",children:"Staff Name *"}),e.jsxs(le,{value:o.staff_id,onValueChange:_=>g({...o,staff_id:_}),children:[e.jsx(ie,{className:b.staff_id?"border-red-500":"",children:e.jsx(ce,{placeholder:"Select Staff"})}),e.jsx(oe,{children:i.map(_=>e.jsx(S,{value:_.$id||"",children:_.staff_name},_.$id))})]}),b.staff_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:b.staff_id})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"status",children:"Status"}),e.jsxs(le,{value:o.status,onValueChange:_=>g({...o,status:_}),children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsx(oe,{children:vc.map(_=>e.jsx(S,{value:_.value,children:_.label},_.value))})]})]})]}),o.status==="completed"&&e.jsxs("div",{className:"grid grid-cols-3 gap-4 p-4 border rounded-md bg-muted/50",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"date_completed",children:"Date Completed *"}),e.jsx(G,{id:"date_completed",type:"date",value:o.date_completed,onChange:_=>g({...o,date_completed:_.target.value}),className:b.date_completed?"border-red-500":""}),b.date_completed&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:b.date_completed})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"completed_quantity",children:"Completed Units *"}),e.jsx(G,{id:"completed_quantity",type:"number",step:"0.01",min:"0",value:o.completed_quantity,onChange:_=>g({...o,completed_quantity:_.target.value}),className:b.completed_quantity?"border-red-500":"",placeholder:"Enter completed units"}),b.completed_quantity&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:b.completed_quantity})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"wastage_quantity",children:"Wastage Qty"}),e.jsx(G,{id:"wastage_quantity",type:"number",step:"0.01",min:"0",value:o.wastage_quantity,onChange:_=>g({...o,wastage_quantity:_.target.value}),className:b.wastage_quantity?"border-red-500":"",placeholder:"Enter wastage qty (optional)"}),b.wastage_quantity&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:b.wastage_quantity})]})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"remarks",children:"Remarks"}),e.jsx(rs,{id:"remarks",value:o.remarks,onChange:_=>g({...o,remarks:_.target.value}),placeholder:"Enter any remarks",rows:3})]})]}),e.jsxs(ot,{className:"flex-col sm:flex-row gap-2 pt-4",children:[e.jsx($,{type:"button",variant:"outline",onClick:Y,className:"w-full sm:w-auto",children:"Cancel"}),e.jsx($,{type:"submit",disabled:n,className:"w-full sm:w-auto",children:n?"Saving...":a?"Update":"Save"})]})]})]})})},Nc=()=>{const r=xt(),[t,s]=u.useState(""),[a,n]=u.useState(!1),[i,c]=u.useState(null),[p,m]=u.useState([]),[o,g]=u.useState({show:!1,message:"",type:"success"}),[b,x]=u.useState("all"),[j,f]=u.useState("all"),[P,N]=u.useState("all"),[T,A]=u.useState({from:"",to:""}),[E,D]=u.useState(1),[F,V]=u.useState(50),{tasks:U,isLoading:Z,error:O,refetch:Q}=Vn(),{createTask:R,updateTask:k,deleteTask:w}=Vl(),{config:Y}=Et("post-production-tasks"),{validationRules:_,canImport:B}=Rt("post-production-tasks"),{currentSort:ne,handleSort:L,getSortedData:ee}=as(),{data:H}=us(),{data:de}=Bn(),{data:K}=Is(),{toast:h}=Fe(),{data:d}=ye({queryKey:["post-production-tasks","all"],queryFn:()=>es.getAll()}),I=(l,re)=>{g({show:!0,message:l,type:re}),setTimeout(()=>g({show:!1,message:"",type:"success"}),3e3)},C=U.filter(l=>{const re=l.task_id.toLowerCase().includes(t.toLowerCase())||l.product_name.toLowerCase().includes(t.toLowerCase())||l.staff_name.toLowerCase().includes(t.toLowerCase())||l.process_name.toLowerCase().includes(t.toLowerCase())||l.stock_name&&l.stock_name.toLowerCase().includes(t.toLowerCase())||l.sku&&l.sku.toLowerCase().includes(t.toLowerCase()),v=b==="all"||l.product_name.toLowerCase().includes(b.toLowerCase()),X=j==="all"||l.process_name.toLowerCase().includes(j.toLowerCase()),fe=P==="all"||l.staff_name.toLowerCase().includes(P.toLowerCase()),Ne=(!T.from||l.date_assigned>=T.from)&&(!T.to||l.date_assigned<=T.to);return re&&v&&X&&fe&&Ne}),ae=Array.from(new Set(U.map(l=>l.product_name))).sort(),Se=Array.from(new Set(U.map(l=>l.process_name))).sort(),ve=Array.from(new Set(U.map(l=>l.staff_name))).sort(),_e=C.length,He=Math.ceil(_e/F),ze=(E-1)*F,tt=ze+F,bt=C.slice(ze,tt);u.useEffect(()=>{D(1)},[t,b,j,P,T,F]);const Mt=async l=>{try{const re=H.find(X=>X.$id===l.process_id),v=re?.process_name?.toLowerCase()||"packing";if(console.log("ðŸ” Post-production task validation data:",{isEdit:!!i,processId:l.process_id,selectedProcess:re,processName:v,rawProductId:l.product_id,sourceProcessId:l.source_process_id,sourceQuantity:l.source_quantity,productId:l.product_id,allData:l}),i){const X=i.source_quantity||0,fe=parseFloat(l.source_quantity)||0,Ne=fe-X;if(console.log("ðŸ”„ Post-production task edit validation:",{originalQuantity:X,newQuantity:fe,quantityDifference:Ne,needsValidation:Ne>0}),Ne<=0)await k.mutateAsync({id:i.$id,data:l}),I("Post-production task updated successfully","success"),n(!1),c(null);else{const Le=H.find(we=>we.$id===l.source_process_id)?.process_name||"Grinding",Me=v==="batch_coding"||v==="batch coding",q=parseFloat(l.source_quantity)||0;console.log("ðŸš¨ POST-PRODUCTION EDIT VALIDATION TRIGGERED:",{processName:v,sourceProcess:Le,rawProductId:l.product_id,sourceQuantity:l.source_quantity,quantityToValidate:q,newQuantity:fe,productId:l.product_id});const je=await validateTaskCreation(v,Le,q,void 0,l.product_id,async we=>{const be=we?{...l,source_quantity:we}:l;console.log("ðŸ”„ UPDATING POST-PRODUCTION TASK WITH ADJUSTED QUANTITY:",be),await k.mutateAsync({id:i.$id,data:be}),I("Post-production task updated successfully","success"),n(!1),c(null)});console.log("ðŸ” POST-PRODUCTION EDIT VALIDATION RESULT:",je)}}else{const fe=H.find(Me=>Me.$id===l.source_process_id)?.process_name||"Grinding",Ne=v==="batch_coding"||v==="batch coding",Ie=parseFloat(l.source_quantity)||0;console.log("ðŸ” PROCESS TYPE DEBUG:",{processName:v,isBatchCoding:Ne,sourceQuantity:l.source_quantity,quantityToValidate:Ie}),console.log("ðŸš¨ POST-PRODUCTION NEW TASK VALIDATION:",{processName:v,sourceProcess:fe,rawProductId:l.product_id,sourceQuantity:l.source_quantity,quantityToValidate:Ie,productId:l.product_id});const Le=l;await R.mutateAsync(Le),I("Post-production task created successfully","success"),n(!1),c(null)}}catch(re){console.error("Error saving task:",re),I("Failed to save task","error")}},ft=l=>{c(l),n(!0)},jt=async l=>{if(window.confirm("Are you sure you want to delete this task?"))try{await w.mutateAsync(l.$id),I("Post-production task deleted successfully","success")}catch(re){console.error("Error deleting task:",re),I("Failed to delete task","error")}},Nt=async()=>{if(p.length===0){I("Please select tasks to delete","error");return}if(window.confirm(`Are you sure you want to delete ${p.length} selected task(s)?`))try{await Promise.all(p.map(l=>w.mutateAsync(l.$id))),m([]),I(`${p.length} tasks deleted successfully`,"success")}catch(l){console.error("Error deleting tasks:",l),I("Failed to delete selected tasks","error")}},wt=()=>{if(p.length===0){I("Please select tasks to export","error");return}I(`Exporting ${p.length} selected task(s)...`,"success")};return O?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Post-Production Tasks"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage post-production processing tasks"})]}),e.jsx(te,{children:e.jsx(se,{className:"pt-6",children:e.jsxs("div",{className:"text-center py-12 text-red-600",children:[e.jsx("p",{className:"text-lg mb-2",children:"Error loading tasks"}),e.jsx("p",{className:"text-sm mb-4",children:O.message}),e.jsx($,{onClick:()=>Q(),variant:"outline",children:"Retry"})]})})})]}):e.jsxs("div",{className:"space-y-6",children:[o.show&&e.jsx("div",{className:`fixed top-4 right-4 px-4 py-2 rounded-md shadow-lg z-50 ${o.type==="success"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300"}`,children:o.message}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Post-Production Tasks"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage post-production processing tasks"})]}),e.jsxs($,{className:"bg-primary hover:bg-primary/90",onClick:()=>{c(null),n(!0)},children:[e.jsx(Ct,{className:"h-4 w-4 mr-2"}),"Add New"]})]}),e.jsx(te,{children:e.jsx(se,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(gt,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(G,{placeholder:"Search tasks...",className:"pl-10",value:t,onChange:l=>s(l.target.value)})]}),B&&Y&&e.jsx(qt,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:Y.exportColumns.filter(l=>l.required).map(l=>l.exportHeader),optionalColumns:Y.exportColumns.filter(l=>!l.required).map(l=>l.exportHeader),validationRules:_,maxFileSize:50,existingData:d||[],validationHeaderMapper:l=>{const re=Y.exportColumns.find(v=>v.dataKey===l);return re?re.exportHeader:l},columnMapper:l=>{const re=Y.exportColumns.find(v=>v.exportHeader===l);return re?re.dataKey==="product_name"?"product_name":re.dataKey==="sku"?"sku":re.dataKey==="process_name"?"process_name":re.dataKey==="staff_name"?"staff_name":{task_id:"task_id",date:"date",date_completed:"date_completed",source_quantity:"source_quantity",assigned_quantity:"assigned_quantity",units:"units",wastage_quantity:"wastage_quantity",remarks:"remarks",status:"status"}[re.dataKey]||re.dataKey:l},dataProcessor:async l=>{let re=l.Product||l.product_name||l.product_name,v=l.SKU||l.sku||l.sku;if(!re||re==="")throw new Error("Product is required");const X=String(re).trim(),fe=de?.find(Re=>Re.product&&Re.product.toLowerCase()===X.toLowerCase()||Re.sku&&Re.sku.toLowerCase()===(v||"").toLowerCase());if(!fe){const Re=de?.map(Pe=>Pe.product||Pe.sku).slice(0,5).join(", ")||"None";throw new Error(`Product "${X}" not found. Available: ${Re}`)}const Ne=fe.$id;let Ie=l.Process||l.process_name||l.process_name;if(!Ie||Ie==="")throw new Error("Process is required");const Le=String(Ie).trim(),Me=H?.find(Re=>Re.process_name.toLowerCase()===Le.toLowerCase());if(!Me){const Re=H?.map(Pe=>Pe.process_name).slice(0,5).join(", ")||"None";throw new Error(`Process "${Le}" not found. Available: ${Re}`)}const q=Me.$id;let je="",we=l["Staff Name"]||l.staff_name||l.staff_name;if(we&&we!==""){const Re=String(we).trim(),Pe=K?.find(Oe=>Oe.staff_name.toLowerCase()===Re.toLowerCase());Pe&&(je=Pe.$id)}let be=l["Date Assigned"]||l.Date||l.date_assigned||l.date||new Date().toISOString().split("T")[0];if(be&&typeof be=="string"){const Re=be.match(/^(\d{2})-(\d{2})-(\d{4})$/);if(Re){const[,Pe,Oe,Ke]=Re,$e=new Date(parseInt(Ke),parseInt(Oe)-1,parseInt(Pe));isNaN($e.getTime())||(be=$e.toISOString().split("T")[0])}else{const Pe=new Date(be);isNaN(Pe.getTime())||(be=Pe.toISOString().split("T")[0])}}else be instanceof Date&&(be=be.toISOString().split("T")[0]);const yt={task_id:l["Task ID"]||l.task_id||l.task_id,date:be,source_process_id:q,source_quantity:parseFloat(l["Source Qty"]||l.source_quantity||l.source_quantity||0),sku:v||fe.sku||"",product_id:Ne,process_id:q,staff_id:je||"",assigned_quantity:parseFloat(l["Assigned Units"]||l.assigned_quantity||l.assigned_quantity||0),units:parseFloat(l["Completed Units"]||l.units||l.units||0),wastage_quantity:parseFloat(l["Wastage Qty"]||l.wastage_quantity||l.wastage_quantity||0),remarks:l.Remarks||l.remarks||l.remarks||"",status:"completed"};return await es.create(yt)},onImportComplete:async l=>{await r.invalidateQueries({queryKey:["post-production-tasks"],refetchType:"active"}),await r.refetchQueries({queryKey:["post-production-tasks"]}),Q(),l.successfulRows>0&&h({title:"Import Successful",description:`${l.successfulRows} post-production tasks imported successfully.`}),l.failedRows>0&&h({title:"Import Completed with Errors",description:`${l.successfulRows} successful, ${l.failedRows} failed.`,variant:"destructive"})}},variant:"outline"}),Y&&e.jsx(At,{data:C.map(l=>{const re={};return Y.exportColumns.forEach(v=>{const X=l[v.dataKey];re[v.exportHeader]=v.formatter?v.formatter(X):X}),re}),headers:Y.exportColumns.map(l=>l.exportHeader),filename:"post-production-tasks",variant:"outline"})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs(le,{value:b,onValueChange:x,children:[e.jsx(ie,{className:"w-[180px]",children:e.jsx(ce,{placeholder:"Product"})}),e.jsxs(oe,{children:[e.jsx(S,{value:"all",children:"All Products"}),ae.map(l=>e.jsx(S,{value:l,children:l},l))]})]}),e.jsxs(le,{value:j,onValueChange:f,children:[e.jsx(ie,{className:"w-[180px]",children:e.jsx(ce,{placeholder:"Process"})}),e.jsxs(oe,{children:[e.jsx(S,{value:"all",children:"All Processes"}),Se.map(l=>e.jsx(S,{value:l,children:l},l))]})]}),e.jsxs(le,{value:P,onValueChange:N,children:[e.jsx(ie,{className:"w-[180px]",children:e.jsx(ce,{placeholder:"Staff Name"})}),e.jsxs(oe,{children:[e.jsx(S,{value:"all",children:"All Staff"}),ve.map(l=>e.jsx(S,{value:l,children:l},l))]})]}),e.jsx(G,{type:"date",placeholder:"From Date",className:"w-[150px]",value:T.from,onChange:l=>A(re=>({...re,from:l.target.value}))}),e.jsx(G,{type:"date",placeholder:"To Date",className:"w-[150px]",value:T.to,onChange:l=>A(re=>({...re,to:l.target.value}))})]})]})})}),e.jsx(te,{children:e.jsxs(se,{className:"pt-6",children:[p.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 p-3 bg-muted rounded-md",children:[e.jsxs("span",{className:"text-sm font-medium",children:[p.length," selected"]}),e.jsx($,{variant:"destructive",size:"sm",onClick:Nt,children:"Delete Selected"}),e.jsx($,{variant:"outline",size:"sm",onClick:wt,children:"Export Selected"})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",ze+1," to ",Math.min(tt,_e)," of ",_e," records"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Records per page:"}),e.jsxs(le,{value:F.toString(),onValueChange:l=>V(Number(l)),children:[e.jsx(ie,{className:"w-[100px]",children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"50",children:"50"}),e.jsx(S,{value:"100",children:"100"}),e.jsx(S,{value:"500",children:"500"})]})]})]})]}),e.jsx("div",{className:"border rounded-md",children:e.jsx("div",{className:"overflow-auto",style:{maxHeight:"600px"},children:e.jsx(ds,{data:ee(bt),columns:[{key:"task_id",label:"Task ID",sortable:!0,dataType:"string"},{key:"date",label:"Date Assigned",sortable:!0,dataType:"date"},{key:"date_completed",label:"Date Completed",sortable:!0,dataType:"date"},{key:"source_quantity",label:"Source Qty",sortable:!0,dataType:"number",align:"right"},{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"product_name",label:"Product",sortable:!0,dataType:"string"},{key:"process_name",label:"Process",sortable:!0,dataType:"string"},{key:"staff_name",label:"Staff Name",sortable:!0,dataType:"string"},{key:"units",label:"Completed Units",sortable:!0,dataType:"number",align:"right",headerClassName:"bg-green-50",cellClassName:"bg-green-50 font-medium"},{key:"wastage_quantity",label:"Wastage Qty",sortable:!0,dataType:"number",align:"right"},{key:"remarks",label:"Remarks",sortable:!0,dataType:"string"},{key:"status",label:"Status",sortable:!0,dataType:"string",formatter:l=>e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${l==="completed"?"bg-green-100 text-green-800":l==="in_progress"?"bg-yellow-100 text-yellow-800":l==="pending"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:l==="in_progress"?"In Progress":l.charAt(0).toUpperCase()+l.slice(1)})}],onSort:L,currentSort:ne,loading:Z,maxHeight:"none",stickyHeader:!0,bordered:!1,searchable:!1,selectable:!0,selectedRows:p,onSelectionChange:m,rowKey:"$id",actions:[qs.edit(l=>ft(l)),qs.delete(l=>jt(l))],emptyMessage:"No post-production tasks found"})})}),He>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx($,{variant:"outline",size:"sm",onClick:()=>D(l=>Math.max(1,l-1)),disabled:E===1,children:"Previous"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",E," of ",He]})}),e.jsx($,{variant:"outline",size:"sm",onClick:()=>D(l=>Math.min(He,l+1)),disabled:E===He,children:"Next"})]})]})}),e.jsx(bc,{isOpen:a,onClose:()=>{n(!1),c(null)},onSubmit:Mt,editingTask:i,isLoading:R.isPending||k.isPending})]})},zn=Ii,er=u.forwardRef(({className:r,...t},s)=>e.jsx(ln,{ref:s,className:me("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",r),...t}));er.displayName=ln.displayName;const Ds=u.forwardRef(({className:r,...t},s)=>e.jsx(cn,{ref:s,className:me("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",r),...t}));Ds.displayName=cn.displayName;const _t=u.forwardRef(({className:r,...t},s)=>e.jsx(dn,{ref:s,className:me("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",r),...t}));_t.displayName=dn.displayName;class wc{DEFAULT_OPTIONS={maxWidth:200,maxHeight:90,maxSizeKB:500,allowedTypes:["image/jpeg","image/jpg","image/png","image/svg+xml","image/webp"]};async uploadLogo(t,s={}){const a={...this.DEFAULT_OPTIONS,...s};try{return a.allowedTypes.includes(t.type)?t.size/1024>a.maxSizeKB?{success:!1,error:`File too large. Maximum: ${a.maxSizeKB}KB`}:t.type==="image/svg+xml"?{success:!0,logoBase64:await this.fileToBase64(t)}:{success:!0,logoBase64:await this.scaleImage(t,a.maxWidth,a.maxHeight)}:{success:!1,error:`Invalid file type. Allowed: ${a.allowedTypes.join(", ")}`}}catch(n){return{success:!1,error:n.message||"Failed to process logo"}}}async scaleImage(t,s,a){return new Promise((n,i)=>{const c=new Image,p=document.createElement("canvas"),m=p.getContext("2d");if(!m){i(new Error("Canvas context not available"));return}c.onload=()=>{const{width:g,height:b}=this.calculateDimensions(c.width,c.height,s,a);p.width=g,p.height=b,m.drawImage(c,0,0,g,b);const x=p.toDataURL("image/png",.9);n(x)},c.onerror=()=>i(new Error("Failed to load image"));const o=new FileReader;o.onload=g=>{c.src=g.target?.result},o.onerror=()=>i(new Error("Failed to read file")),o.readAsDataURL(t)})}calculateDimensions(t,s,a,n){let{width:i,height:c}={width:t,height:s};if(i>a||c>n){const p=a/i,m=n/c,o=Math.min(p,m);i=Math.round(i*o),c=Math.round(c*o)}return{width:i,height:c}}fileToBase64(t){return new Promise((s,a)=>{const n=new FileReader;n.onload=()=>s(n.result),n.onerror=()=>a(new Error("Failed to read file")),n.readAsDataURL(t)})}}const Sc=new wc;function _c(){const{toast:r}=Fe(),{settings:t,updateSettings:s}=Tn(),[a,n]=u.useState(!1),[i,c]=u.useState(t.logo||null),p=u.useRef(null),m=(j,f)=>{s({[j]:f})},o=()=>{s({logo:i||void 0}),r({title:"Success",description:"Company profile saved successfully"})},g=async j=>{const f=j.target.files?.[0];if(f){n(!0);try{const P=await Sc.uploadLogo(f,{maxWidth:200,maxHeight:90,maxSizeKB:500});P.success&&P.logoBase64?(c(P.logoBase64),r({title:"Logo uploaded successfully",description:"Logo has been scaled to fit 200x90px"})):r({title:"Upload failed",description:P.error||"Unknown error",variant:"destructive"})}catch(P){r({title:"Upload failed",description:P.message||"Failed to process logo",variant:"destructive"})}finally{n(!1),p.current&&(p.current.value="")}}},b=()=>{c(null),r({title:"Logo removed",description:"Logo has been removed"})},x=()=>{p.current?.click()};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(te,{children:[e.jsxs(pe,{children:[e.jsx(xe,{children:"Company Information"}),e.jsx(Te,{children:"Basic information about your company"})]}),e.jsxs(se,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(M,{children:"Company Logo"}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:i?e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"w-48 h-20 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg flex items-center justify-center bg-gray-50 dark:bg-gray-800 overflow-hidden",children:e.jsx("img",{src:i,alt:"Company Logo",className:"max-w-full max-h-full object-contain dark:brightness-90"})}),e.jsx($,{variant:"destructive",size:"sm",className:"absolute -top-2 -right-2 h-6 w-6 rounded-full p-0 opacity-0 group-hover:opacity-100 transition-opacity",onClick:b,children:e.jsx(Ts,{className:"h-3 w-3"})})]}):e.jsx("div",{className:"w-48 h-20 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg flex items-center justify-center bg-gray-50 dark:bg-gray-800 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:x,children:e.jsxs("div",{className:"text-center",children:[e.jsx(ar,{className:"h-8 w-8 mx-auto text-gray-400 dark:text-gray-500 mb-2"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Click to upload"}),e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:"200x90px"})]})})}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs($,{variant:"outline",onClick:x,disabled:a,className:"gap-2",children:[e.jsx(ga,{className:"h-4 w-4"}),a?"Uploading...":"Upload Logo"]}),i&&e.jsxs($,{variant:"ghost",onClick:b,className:"gap-2 text-red-600 hover:text-red-700",children:[e.jsx(Ts,{className:"h-4 w-4"}),"Remove"]})]}),e.jsxs(Qe,{children:[e.jsx(ar,{className:"h-4 w-4"}),e.jsxs(Ye,{children:[e.jsx("strong",{children:"Requirements:"})," Max 500KB â€¢ 200x90px recommended â€¢ PNG, JPG, SVG, WebP â€¢ Auto-scaled to fit"]})]})]})]}),e.jsx("input",{ref:p,type:"file",accept:"image/*",onChange:g,className:"hidden"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"companyName",children:"Company Name *"}),e.jsx(G,{id:"companyName",value:t.companyName,onChange:j=>m("companyName",j.target.value)})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"legalName",children:"Legal Name"}),e.jsx(G,{id:"legalName",value:t.legalName,onChange:j=>m("legalName",j.target.value)})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"registrationNumber",children:"Registration Number"}),e.jsx(G,{id:"registrationNumber",value:t.registrationNumber,onChange:j=>m("registrationNumber",j.target.value)})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"taxId",children:"Tax ID / GST Number"}),e.jsx(G,{id:"taxId",value:t.taxId,onChange:j=>m("taxId",j.target.value)})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"industryType",children:"Industry Type"}),e.jsxs(le,{value:t.industryType,onValueChange:j=>m("industryType",j),children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"Manufacturing",children:"Manufacturing"}),e.jsx(S,{value:"Trading",children:"Trading"}),e.jsx(S,{value:"Services",children:"Services"}),e.jsx(S,{value:"Retail",children:"Retail"})]})]})]})]})]})]}),e.jsxs(te,{children:[e.jsxs(pe,{children:[e.jsx(xe,{children:"Contact Information"}),e.jsx(Te,{children:"How to reach your company"})]}),e.jsxs(se,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"address",children:"Address"}),e.jsx(rs,{id:"address",value:t.address,onChange:j=>m("address",j.target.value),rows:2})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"city",children:"City"}),e.jsx(G,{id:"city",value:t.city,onChange:j=>m("city",j.target.value)})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"state",children:"State"}),e.jsx(G,{id:"state",value:t.state,onChange:j=>m("state",j.target.value)})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"postalCode",children:"Postal Code"}),e.jsx(G,{id:"postalCode",value:t.postalCode,onChange:j=>m("postalCode",j.target.value)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"phone",children:"Phone"}),e.jsx(G,{id:"phone",value:t.phone,onChange:j=>m("phone",j.target.value)})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"email",children:"Email"}),e.jsx(G,{id:"email",type:"email",value:t.email,onChange:j=>m("email",j.target.value)})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"website",children:"Website"}),e.jsx(G,{id:"website",value:t.website,onChange:j=>m("website",j.target.value)})]})]})]})]}),e.jsxs(te,{children:[e.jsxs(pe,{children:[e.jsx(xe,{children:"Business Settings"}),e.jsx(Te,{children:"Configure your business preferences"})]}),e.jsx(se,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"fiscalYearStart",children:"Fiscal Year Start Month"}),e.jsxs(le,{value:t.fiscalYearStart,onValueChange:j=>m("fiscalYearStart",j),children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"01",children:"January"}),e.jsx(S,{value:"04",children:"April"}),e.jsx(S,{value:"07",children:"July"}),e.jsx(S,{value:"10",children:"October"})]})]})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"currency",children:"Default Currency"}),e.jsxs(le,{value:t.currency,onValueChange:j=>m("currency",j),children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"INR",children:"INR - Indian Rupee"}),e.jsx(S,{value:"USD",children:"USD - US Dollar"}),e.jsx(S,{value:"EUR",children:"EUR - Euro"}),e.jsx(S,{value:"GBP",children:"GBP - British Pound"})]})]})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"timezone",children:"Time Zone"}),e.jsxs(le,{value:t.timezone,onValueChange:j=>m("timezone",j),children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"Asia/Kolkata",children:"Asia/Kolkata (IST)"}),e.jsx(S,{value:"America/New_York",children:"America/New_York (EST)"}),e.jsx(S,{value:"Europe/London",children:"Europe/London (GMT)"}),e.jsx(S,{value:"Asia/Dubai",children:"Asia/Dubai (GST)"})]})]})]})]})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs($,{onClick:o,className:"gap-2",children:[e.jsx(_a,{className:"h-4 w-4"}),"Save Changes"]})})]})}const mr="molaga_users",hr="molaga_roles",pr=[{id:"super_admin",name:"Super Admin",description:"Full system access",permissions:{masterData:"full",purchases:"full",tasks:"full",sales:"full",status:"full",reports:"full",settings:"full"},isSystemRole:!0},{id:"admin",name:"Admin",description:"All except system configuration",permissions:{masterData:"full",purchases:"full",tasks:"full",sales:"full",status:"full",reports:"full",settings:"edit"},isSystemRole:!0},{id:"manager",name:"Manager",description:"View all, edit assigned",permissions:{masterData:"view",purchases:"edit",tasks:"edit",sales:"edit",status:"view",reports:"view",settings:"none"},isSystemRole:!0},{id:"staff",name:"Staff",description:"Limited access",permissions:{masterData:"view",purchases:"view",tasks:"edit",sales:"view",status:"view",reports:"none",settings:"none"},isSystemRole:!0},{id:"viewer",name:"Viewer",description:"Read-only access",permissions:{masterData:"view",purchases:"view",tasks:"view",sales:"view",status:"view",reports:"view",settings:"none"},isSystemRole:!0}],kc=[{id:"1",name:"Admin User",email:"admin@molaga.com",role:"super_admin",status:"active",lastLogin:new Date().toISOString(),createdAt:new Date().toISOString()}];class Cc{users;roles;constructor(){this.users=this.loadUsers(),this.roles=this.loadRoles()}loadUsers(){try{const t=localStorage.getItem(mr);if(t)return JSON.parse(t)}catch(t){console.error("Error loading users:",t)}return[...kc]}saveUsers(){try{localStorage.setItem(mr,JSON.stringify(this.users))}catch(t){console.error("Error saving users:",t)}}getAllUsers(){return[...this.users]}getUserById(t){return this.users.find(s=>s.id===t)}createUser(t){const s={...t,id:Date.now().toString(),createdAt:new Date().toISOString()};return this.users.push(s),this.saveUsers(),s}updateUser(t,s){const a=this.users.findIndex(n=>n.id===t);return a===-1?null:(this.users[a]={...this.users[a],...s},this.saveUsers(),this.users[a])}deleteUser(t){const s=this.users.findIndex(a=>a.id===t);return s===-1?!1:(this.users.splice(s,1),this.saveUsers(),!0)}loadRoles(){try{const t=localStorage.getItem(hr);if(t){const s=JSON.parse(t),a=[...pr];return s.forEach(n=>{n.isSystemRole||a.push(n)}),a}}catch(t){console.error("Error loading roles:",t)}return[...pr]}saveRoles(){try{const t=this.roles.filter(s=>!s.isSystemRole);localStorage.setItem(hr,JSON.stringify(t))}catch(t){console.error("Error saving roles:",t)}}getAllRoles(){return[...this.roles]}getRoleById(t){return this.roles.find(s=>s.id===t)}createRole(t){const s={...t,id:Date.now().toString(),isSystemRole:!1};return this.roles.push(s),this.saveRoles(),s}updateRole(t,s){const a=this.roles.findIndex(n=>n.id===t);return a===-1||this.roles[a].isSystemRole?null:(this.roles[a]={...this.roles[a],...s},this.saveRoles(),this.roles[a])}deleteRole(t){const s=this.roles.findIndex(a=>a.id===t);return s===-1||this.roles[s].isSystemRole?!1:(this.roles.splice(s,1),this.saveRoles(),!0)}}const $t=new Cc;function Pc(){const[r,t]=u.useState($t.getAllUsers()),s=u.useCallback(()=>{t($t.getAllUsers())},[]),a=u.useCallback(c=>{const p=$t.createUser(c);return s(),p},[s]),n=u.useCallback((c,p)=>{const m=$t.updateUser(c,p);return s(),m},[s]),i=u.useCallback(c=>{const p=$t.deleteUser(c);return p&&s(),p},[s]);return{users:r,createUser:a,updateUser:n,deleteUser:i,refreshUsers:s}}function Dc(){const[r,t]=u.useState($t.getAllRoles()),s=u.useCallback(()=>{t($t.getAllRoles())},[]),a=u.useCallback(c=>{const p=$t.createRole(c);return s(),p},[s]),n=u.useCallback((c,p)=>{const m=$t.updateRole(c,p);return s(),m},[s]),i=u.useCallback(c=>{const p=$t.deleteRole(c);return p&&s(),p},[s]);return{roles:r,createRole:a,updateRole:n,deleteRole:i,refreshRoles:s}}class Tc{RESET_LOG_KEY="password_reset_log";FORCE_CHANGE_KEY="force_password_change";generateTempPassword(){const s="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*";let a="";a+="ABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(Math.random()*26)],a+="abcdefghijklmnopqrstuvwxyz"[Math.floor(Math.random()*26)],a+="0123456789"[Math.floor(Math.random()*10)],a+="!@#$%^&*"[Math.floor(Math.random()*8)];for(let n=a.length;n<12;n++)a+=s[Math.floor(Math.random()*s.length)];return a.split("").sort(()=>Math.random()-.5).join("")}async resetUserPassword(t,s,a,n,i){try{const c=this.generateTempPassword();return this.logPasswordReset({id:Date.now().toString(),userId:t,userName:s,userEmail:a,resetBy:`${i} (${n})`,resetAt:new Date().toISOString(),tempPassword:c,mustChangePassword:!0}),this.setForcePasswordChange(t,!0),{success:!0,tempPassword:c,message:"Password reset successfully. User must change password on next login."}}catch(c){return console.error("Password reset error:",c),{success:!1,message:c.message||"Failed to reset password"}}}logPasswordReset(t){try{const s=this.getResetLogs();s.unshift(t),s.length>100&&s.splice(100),localStorage.setItem(this.RESET_LOG_KEY,JSON.stringify(s))}catch(s){console.error("Error logging password reset:",s)}}getResetLogs(){try{const t=localStorage.getItem(this.RESET_LOG_KEY);return t?JSON.parse(t):[]}catch(t){return console.error("Error loading reset logs:",t),[]}}setForcePasswordChange(t,s){try{const a=this.getForceChangeFlags();a[t]=s,localStorage.setItem(this.FORCE_CHANGE_KEY,JSON.stringify(a))}catch(a){console.error("Error setting force change flag:",a)}}mustChangePassword(t){try{return this.getForceChangeFlags()[t]===!0}catch(s){return console.error("Error checking force change flag:",s),!1}}clearForcePasswordChange(t){this.setForcePasswordChange(t,!1)}getForceChangeFlags(){try{const t=localStorage.getItem(this.FORCE_CHANGE_KEY);return t?JSON.parse(t):{}}catch(t){return console.error("Error loading force change flags:",t),{}}}getUserResetLogs(t){return this.getResetLogs().filter(a=>a.userId===t)}clearOldLogs(){try{const t=this.getResetLogs(),s=new Date;s.setDate(s.getDate()-90);const a=t.filter(i=>new Date(i.resetAt)>s),n=t.length-a.length;return localStorage.setItem(this.RESET_LOG_KEY,JSON.stringify(a)),n}catch(t){return console.error("Error clearing old logs:",t),0}}}const Ec=new Tc;function Rc(){const{toast:r}=Fe(),{user:t}=vt(),{users:s,createUser:a,updateUser:n,deleteUser:i}=Pc(),{roles:c}=Dc(),[p,m]=u.useState(""),[o,g]=u.useState(!1),[b,x]=u.useState(null),[j,f]=u.useState(!1),[P,N]=u.useState(null),[T,A]=u.useState(""),[E,D]=u.useState({name:"",email:"",phone:"",role:"",department:"",employeeId:"",status:"active"}),F=s.filter(w=>w.name.toLowerCase().includes(p.toLowerCase())||w.email.toLowerCase().includes(p.toLowerCase())),V=()=>{x(null),D({name:"",email:"",phone:"",role:"",department:"",employeeId:"",status:"active"}),g(!0)},U=w=>{x(w),D({name:w.name,email:w.email,phone:w.phone||"",role:w.role,department:w.department||"",employeeId:w.employeeId||"",status:w.status}),g(!0)},Z=w=>{confirm("Are you sure you want to delete this user?")&&i(w)&&r({title:"User deleted successfully"})},O=w=>{N(w),A(""),f(!0)},Q=async()=>{if(!P||!t)return;const w=await Ec.resetUserPassword(P.id,P.name,P.email,t.$id,t.name);w.success&&w.tempPassword?(A(w.tempPassword),r({title:"Password Reset Successfully",description:"Temporary password has been generated. Please share it securely with the user."})):(r({title:"Password Reset Failed",description:w.message,variant:"destructive"}),f(!1),N(null))},R=()=>{navigator.clipboard.writeText(T),r({title:"Copied!",description:"Temporary password copied to clipboard"})},k=()=>{if(!E.name||!E.email||!E.role){r({title:"Please fill in all required fields",variant:"destructive"});return}b?(n(b.id,E),r({title:"User updated successfully"})):(a(E),r({title:"User created successfully"})),g(!1)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(te,{children:[e.jsx(pe,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(xe,{children:"User Management"}),e.jsx(Te,{children:"Manage system users and their access"})]}),e.jsxs($,{onClick:V,className:"gap-2",children:[e.jsx(Li,{className:"h-4 w-4"}),"Add User"]})]})}),e.jsxs(se,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gt,{className:"h-4 w-4 text-muted-foreground"}),e.jsx(G,{placeholder:"Search users...",value:p,onChange:w=>m(w.target.value),className:"max-w-sm"})]}),e.jsxs(mt,{children:[e.jsx(ht,{children:e.jsxs(ke,{children:[e.jsx(J,{children:"Name"}),e.jsx(J,{children:"Email"}),e.jsx(J,{children:"Role"}),e.jsx(J,{children:"Status"}),e.jsx(J,{children:"Last Login"}),e.jsx(J,{className:"text-right",children:"Actions"})]})}),e.jsx(pt,{children:F.map(w=>e.jsxs(ke,{children:[e.jsx(W,{className:"font-medium",children:w.name}),e.jsx(W,{children:w.email}),e.jsx(W,{children:w.role}),e.jsx(W,{children:e.jsx(et,{variant:w.status==="active"?"default":"secondary",children:w.status})}),e.jsx(W,{children:w.lastLogin}),e.jsx(W,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx($,{variant:"ghost",size:"sm",onClick:()=>O(w),title:"Reset Password",children:e.jsx(Js,{className:"h-4 w-4"})}),e.jsx($,{variant:"ghost",size:"sm",onClick:()=>U(w),children:e.jsx(ss,{className:"h-4 w-4"})}),e.jsx($,{variant:"ghost",size:"sm",onClick:()=>Z(w.id),children:e.jsx(Lt,{className:"h-4 w-4"})})]})})]},w.id))})]})]})]}),e.jsxs(te,{children:[e.jsxs(pe,{children:[e.jsx(xe,{children:"Roles & Permissions"}),e.jsx(Te,{children:"Configure user roles and their permissions"})]}),e.jsx(se,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:c.map(w=>e.jsxs(te,{children:[e.jsxs(pe,{children:[e.jsx(xe,{className:"text-base",children:w.name}),w.isSystemRole&&e.jsx(et,{variant:"secondary",className:"w-fit",children:"System Role"})]}),e.jsxs(se,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:w.description}),e.jsx("div",{className:"text-xs text-muted-foreground mb-3",children:e.jsx("div",{className:"grid grid-cols-2 gap-1",children:Object.entries(w.permissions).slice(0,4).map(([Y,_])=>e.jsxs("div",{children:[Y,": ",e.jsx("span",{className:"font-medium",children:_})]},Y))})}),e.jsx($,{variant:"outline",size:"sm",className:"w-full",disabled:w.isSystemRole,children:w.isSystemRole?"View Permissions":"Edit Permissions"})]})]},w.id))})})]}),e.jsx(ct,{open:o,onOpenChange:g,children:e.jsxs(nt,{children:[e.jsxs(it,{children:[e.jsx(lt,{children:b?"Edit User":"Add New User"}),e.jsx(dt,{children:b?"Update user information":"Create a new user account"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"name",children:"Full Name *"}),e.jsx(G,{id:"name",placeholder:"John Doe",value:E.name,onChange:w=>D({...E,name:w.target.value})})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"email",children:"Email *"}),e.jsx(G,{id:"email",type:"email",placeholder:"john@example.com",value:E.email,onChange:w=>D({...E,email:w.target.value})})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"phone",children:"Phone"}),e.jsx(G,{id:"phone",placeholder:"+91 9876543210",value:E.phone,onChange:w=>D({...E,phone:w.target.value})})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"role",children:"Role *"}),e.jsxs(le,{value:E.role,onValueChange:w=>D({...E,role:w}),children:[e.jsx(ie,{children:e.jsx(ce,{placeholder:"Select role"})}),e.jsx(oe,{children:c.map(w=>e.jsx(S,{value:w.id,children:w.name},w.id))})]})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"department",children:"Department"}),e.jsx(G,{id:"department",placeholder:"Production",value:E.department,onChange:w=>D({...E,department:w.target.value})})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"employeeId",children:"Employee ID"}),e.jsx(G,{id:"employeeId",placeholder:"EMP001",value:E.employeeId,onChange:w=>D({...E,employeeId:w.target.value})})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"status",children:"Status"}),e.jsxs(le,{value:E.status,onValueChange:w=>D({...E,status:w}),children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"active",children:"Active"}),e.jsx(S,{value:"inactive",children:"Inactive"})]})]})]})]}),e.jsxs(ot,{children:[e.jsx($,{variant:"outline",onClick:()=>g(!1),children:"Cancel"}),e.jsx($,{onClick:k,children:b?"Update":"Create"})]})]})}),e.jsx(ct,{open:j,onOpenChange:f,children:e.jsxs(nt,{children:[e.jsxs(it,{children:[e.jsx(lt,{children:"Reset Password"}),e.jsxs(dt,{children:["Reset password for ",P?.name]})]}),e.jsx("div",{className:"space-y-4 py-4",children:T?e.jsxs(e.Fragment,{children:[e.jsxs(Qe,{children:[e.jsx(Js,{className:"h-4 w-4"}),e.jsx(Ye,{children:"Password reset successfully! Please share this temporary password securely with the user."})]}),e.jsxs("div",{children:[e.jsx(M,{children:"Temporary Password"}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(G,{value:T,readOnly:!0,className:"font-mono"}),e.jsx($,{variant:"outline",size:"icon",onClick:R,children:e.jsx(Hs,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"User must change this password on next login"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(Qe,{children:[e.jsx(Js,{className:"h-4 w-4"}),e.jsx(Ye,{children:"A temporary password will be generated. The user will be required to change it on next login."})]}),e.jsxs("div",{children:[e.jsx(M,{children:"User Email"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:P?.email})]})]})}),e.jsx(ot,{children:T?e.jsx($,{onClick:()=>{f(!1),N(null),A("")},children:"Close"}):e.jsxs(e.Fragment,{children:[e.jsx($,{variant:"outline",onClick:()=>f(!1),children:"Cancel"}),e.jsxs($,{onClick:Q,className:"gap-2",children:[e.jsx(Js,{className:"h-4 w-4"}),"Generate Password"]})]})})]})})]})}class Ac{async registerWithApproval(t,s,a){try{const n=await Ht.create(hs.unique(),t,s,a),i={approvalStatus:"pending",registeredAt:new Date().toISOString(),role:"viewer"};await Ht.updatePrefs(i);try{await Ht.deleteSession("current")}catch{}return{success:!0,message:"Registration successful. Please wait for admin approval.",userId:n.$id}}catch(n){return console.error("Registration error:",n),{success:!1,message:n.message||"Registration failed"}}}async checkApprovalStatus(t){try{const a=(await Ht.get()).prefs;return!a.approvalStatus||a.approvalStatus==="approved"?{approved:!0,status:"approved",message:"User is approved"}:a.approvalStatus==="pending"?{approved:!1,status:"pending",message:"Your account is pending approval. Please wait for admin approval."}:a.approvalStatus==="rejected"?{approved:!1,status:"rejected",message:`Your account was rejected. Reason: ${a.rejectionReason||"Not specified"}`}:{approved:!1,status:"pending",message:"Unknown approval status"}}catch(s){return console.error("Approval check error:",s),{approved:!1,status:"pending",message:"Could not verify approval status"}}}async approveUser(t,s,a="viewer"){try{return{success:!0,message:"User approved successfully"}}catch(n){return console.error("Approval error:",n),{success:!1,message:n.message||"Failed to approve user"}}}async rejectUser(t,s,a){try{return{success:!0,message:"User rejected"}}catch(n){return console.error("Rejection error:",n),{success:!1,message:n.message||"Failed to reject user"}}}getPendingUsers(){try{const t=localStorage.getItem("pending_users");return t?JSON.parse(t):[]}catch(t){return console.error("Error loading pending users:",t),[]}}addPendingUser(t){try{const s=this.getPendingUsers();s.push(t),localStorage.setItem("pending_users",JSON.stringify(s))}catch(s){console.error("Error adding pending user:",s)}}removePendingUser(t){try{const a=this.getPendingUsers().filter(n=>n.$id!==t);localStorage.setItem("pending_users",JSON.stringify(a))}catch(s){console.error("Error removing pending user:",s)}}updatePendingUserStatus(t,s,a){try{const n=this.getPendingUsers(),i=n.find(c=>c.$id===t);i&&(i.approvalStatus=s,a&&(i.rejectionReason=a),localStorage.setItem("pending_users",JSON.stringify(n)))}catch(n){console.error("Error updating pending user:",n)}}}const Ss=new Ac;function qc(){const{toast:r}=Fe(),{user:t}=vt(),[s,a]=u.useState(Ss.getPendingUsers()),[n,i]=u.useState(null),[c,p]=u.useState(!1),[m,o]=u.useState(!1),[g,b]=u.useState("viewer"),[x,j]=u.useState(""),f=$t.getAllRoles(),P=()=>{a(Ss.getPendingUsers())},N=D=>{i(D),b("viewer"),p(!0)},T=D=>{i(D),j(""),o(!0)},A=async()=>{if(!(!n||!t))try{$t.createUser({name:n.name,email:n.email,role:g,status:"active"}),Ss.updatePendingUserStatus(n.$id,"approved"),Ss.removePendingUser(n.$id),r({title:"User Approved",description:`${n.name} has been approved and can now login.`}),P(),p(!1),i(null)}catch(D){r({title:"Approval Failed",description:D.message||"Failed to approve user",variant:"destructive"})}},E=async()=>{if(!(!n||!t)){if(!x.trim()){r({title:"Reason Required",description:"Please provide a reason for rejection",variant:"destructive"});return}try{Ss.updatePendingUserStatus(n.$id,"rejected",x),Ss.removePendingUser(n.$id),r({title:"User Rejected",description:`${n.name} has been rejected.`}),P(),o(!1),i(null),j("")}catch(D){r({title:"Rejection Failed",description:D.message||"Failed to reject user",variant:"destructive"})}}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(te,{children:[e.jsxs(pe,{children:[e.jsx(xe,{children:"Pending User Approvals"}),e.jsx(Te,{children:"Review and approve new user registrations"})]}),e.jsx(se,{children:s.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(rr,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No pending user approvals"})]}):e.jsxs(mt,{children:[e.jsx(ht,{children:e.jsxs(ke,{children:[e.jsx(J,{children:"Name"}),e.jsx(J,{children:"Email"}),e.jsx(J,{children:"Provider"}),e.jsx(J,{children:"Registered"}),e.jsx(J,{children:"Status"}),e.jsx(J,{className:"text-right",children:"Actions"})]})}),e.jsx(pt,{children:s.map(D=>e.jsxs(ke,{children:[e.jsx(W,{className:"font-medium",children:D.name}),e.jsx(W,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qa,{className:"h-4 w-4 text-muted-foreground"}),D.email]})}),e.jsx(W,{children:e.jsx(et,{variant:"outline",children:D.provider})}),e.jsx(W,{children:new Date(D.registeredAt).toLocaleDateString()}),e.jsx(W,{children:e.jsxs(et,{variant:"secondary",children:[e.jsx(rr,{className:"h-3 w-3 mr-1"}),"Pending"]})}),e.jsx(W,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx($,{variant:"ghost",size:"sm",onClick:()=>N(D),className:"text-green-600 hover:text-green-700",children:e.jsx(ls,{className:"h-4 w-4"})}),e.jsx($,{variant:"ghost",size:"sm",onClick:()=>T(D),className:"text-red-600 hover:text-red-700",children:e.jsx(nr,{className:"h-4 w-4"})})]})})]},D.$id))})]})})]}),e.jsx(ct,{open:c,onOpenChange:p,children:e.jsxs(nt,{children:[e.jsxs(it,{children:[e.jsx(lt,{children:"Approve User"}),e.jsxs(dt,{children:["Approve ",n?.name," to access the system"]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(M,{children:"Email"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:n?.email})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"role",children:"Assign Role"}),e.jsxs(le,{value:g,onValueChange:b,children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsx(oe,{children:f.map(D=>e.jsx(S,{value:D.id,children:D.name},D.id))})]})]})]}),e.jsxs(ot,{children:[e.jsx($,{variant:"outline",onClick:()=>p(!1),children:"Cancel"}),e.jsxs($,{onClick:A,className:"gap-2",children:[e.jsx(ls,{className:"h-4 w-4"}),"Approve User"]})]})]})}),e.jsx(ct,{open:m,onOpenChange:o,children:e.jsxs(nt,{children:[e.jsxs(it,{children:[e.jsx(lt,{children:"Reject User"}),e.jsxs(dt,{children:["Reject ",n?.name,"'s registration request"]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(M,{children:"Email"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:n?.email})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"reason",children:"Rejection Reason *"}),e.jsx(rs,{id:"reason",placeholder:"Please provide a reason for rejection...",value:x,onChange:D=>j(D.target.value),rows:4})]})]}),e.jsxs(ot,{children:[e.jsx($,{variant:"outline",onClick:()=>o(!1),children:"Cancel"}),e.jsxs($,{onClick:E,variant:"destructive",className:"gap-2",children:[e.jsx(nr,{className:"h-4 w-4"}),"Reject User"]})]})]})})]})}const It=u.forwardRef(({className:r,...t},s)=>e.jsx(un,{className:me("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",r),...t,ref:s,children:e.jsx(Mi,{className:me("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));It.displayName=un.displayName;function Fc(){const{toast:r}=Fe(),{settings:t,updateSettings:s}=En(),a=(i,c)=>{s({[i]:c})},n=()=>{r({title:"System configuration saved successfully"})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(te,{children:[e.jsxs(pe,{children:[e.jsx(xe,{children:"General Settings"}),e.jsx(Te,{children:"Configure system-wide preferences"})]}),e.jsx(se,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"language",children:"Default Language"}),e.jsxs(le,{value:t.language,onValueChange:i=>a("language",i),children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"en",children:"English"}),e.jsx(S,{value:"hi",children:"Hindi"}),e.jsx(S,{value:"ta",children:"Tamil"}),e.jsx(S,{value:"te",children:"Telugu"})]})]})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"dateFormat",children:"Date Format"}),e.jsxs(le,{value:t.dateFormat,onValueChange:i=>a("dateFormat",i),children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"DD/MM/YYYY",children:"DD/MM/YYYY"}),e.jsx(S,{value:"MM/DD/YYYY",children:"MM/DD/YYYY"}),e.jsx(S,{value:"YYYY-MM-DD",children:"YYYY-MM-DD"})]})]})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"timeFormat",children:"Time Format"}),e.jsxs(le,{value:t.timeFormat,onValueChange:i=>a("timeFormat",i),children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"12",children:"12-hour"}),e.jsx(S,{value:"24",children:"24-hour"})]})]})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"firstDayOfWeek",children:"First Day of Week"}),e.jsxs(le,{value:t.firstDayOfWeek,onValueChange:i=>a("firstDayOfWeek",i),children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"sunday",children:"Sunday"}),e.jsx(S,{value:"monday",children:"Monday"})]})]})]})]})})]}),e.jsxs(te,{children:[e.jsxs(pe,{children:[e.jsx(xe,{children:"Number Formatting"}),e.jsx(Te,{children:"Configure how numbers are displayed"})]}),e.jsx(se,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"decimalPlaces",children:"Decimal Places"}),e.jsxs(le,{value:t.decimalPlaces,onValueChange:i=>a("decimalPlaces",i),children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"0",children:"0"}),e.jsx(S,{value:"1",children:"1"}),e.jsx(S,{value:"2",children:"2"}),e.jsx(S,{value:"3",children:"3"}),e.jsx(S,{value:"4",children:"4"})]})]})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"thousandSeparator",children:"Thousand Separator"}),e.jsxs(le,{value:t.thousandSeparator,onValueChange:i=>a("thousandSeparator",i),children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:",",children:", (Comma)"}),e.jsx(S,{value:".",children:". (Period)"}),e.jsx(S,{value:" ",children:"  (Space)"})]})]})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"decimalSeparator",children:"Decimal Separator"}),e.jsxs(le,{value:t.decimalSeparator,onValueChange:i=>a("decimalSeparator",i),children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:".",children:". (Period)"}),e.jsx(S,{value:",",children:", (Comma)"})]})]})]})]})})]}),e.jsxs(te,{children:[e.jsxs(pe,{children:[e.jsx(xe,{children:"Display Settings"}),e.jsx(Te,{children:"Customize the user interface"})]}),e.jsxs(se,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"recordsPerPage",children:"Records Per Page"}),e.jsxs(le,{value:t.recordsPerPage,onValueChange:i=>a("recordsPerPage",i),children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"25",children:"25"}),e.jsx(S,{value:"50",children:"50"}),e.jsx(S,{value:"100",children:"100"}),e.jsx(S,{value:"200",children:"200"})]})]})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"theme",children:"Theme"}),e.jsxs(le,{value:t.theme,onValueChange:i=>a("theme",i),children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"light",children:"Light"}),e.jsx(S,{value:"dark",children:"Dark"}),e.jsx(S,{value:"auto",children:"Auto"})]})]})]})]}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"sidebarCollapsed",children:"Sidebar Collapsed by Default"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Start with a collapsed sidebar"})]}),e.jsx(It,{id:"sidebarCollapsed",checked:t.sidebarCollapsed,onCheckedChange:i=>a("sidebarCollapsed",i)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"showTooltips",children:"Show Tooltips"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Display helpful tooltips"})]}),e.jsx(It,{id:"showTooltips",checked:t.showTooltips,onCheckedChange:i=>a("showTooltips",i)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"enableAnimations",children:"Enable Animations"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Use smooth transitions"})]}),e.jsx(It,{id:"enableAnimations",checked:t.enableAnimations,onCheckedChange:i=>a("enableAnimations",i)})]})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs($,{onClick:n,className:"gap-2",children:[e.jsx(_a,{className:"h-4 w-4"}),"Save Configuration"]})})]})}class $c{BACKUP_VERSION="1.0";APP_VERSION="1.0.0";getCollectionsList(){return["purchases","vendors","stocks","products","raw_products","processes","staff","sales_channels","pre_production_tasks","production_tasks","post_production_tasks","sales_units","sales_records","stock_status","pre_production_status","production_status","post_production_status"]}async exportCollection(t,s){const a=[];let n=0;const i=100;let c=!0;try{for(;c;){const p=await at.listDocuments(rt,Ce[t],[Ve.limit(i),Ve.offset(n)]);a.push(...p.documents),s&&s(a.length,p.total),p.documents.length<i?c=!1:n+=i}return console.log(`âœ“ Exported ${a.length} documents from ${t}`),a}catch(p){return console.error(`Error exporting ${t}:`,p),[]}}async createFullBackup(t){const s=this.getCollectionsList(),a={metadata:{version:this.BACKUP_VERSION,timestamp:new Date().toISOString(),appVersion:this.APP_VERSION,totalRecords:0,totalCollections:s.length,collections:s},collections:{}};let n=0;for(const i of s)try{const c=await this.exportCollection(i,(p,m)=>{t&&t({currentCollection:i,processedCollections:n,totalCollections:s.length,currentRecords:p,totalRecords:a.metadata.totalRecords+p,percentage:Math.round((n+p/m)/s.length*100)})});a.collections[i]=c,a.metadata.totalRecords+=c.length,n++,t&&t({currentCollection:i,processedCollections:n,totalCollections:s.length,currentRecords:c.length,totalRecords:a.metadata.totalRecords,percentage:Math.round(n/s.length*100)})}catch(c){console.error(`Failed to backup ${i}:`,c),a.collections[i]=[]}return a}async createPartialBackup(t,s){const a={metadata:{version:this.BACKUP_VERSION,timestamp:new Date().toISOString(),appVersion:this.APP_VERSION,totalRecords:0,totalCollections:t.length,collections:t},collections:{}};let n=0;for(const i of t){const c=await this.exportCollection(i);a.collections[i]=c,a.metadata.totalRecords+=c.length,n++,s&&s({currentCollection:i,processedCollections:n,totalCollections:t.length,currentRecords:c.length,totalRecords:a.metadata.totalRecords,percentage:Math.round(n/t.length*100)})}return a}async downloadBackup(t,s){const a=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),n=`molaga-backup-${new Date().toISOString().split("T")[0]}.json`;Os.saveAs(a,s||n)}getBackupSize(t){const s=JSON.stringify(t),a=new Blob([s]).size;return a<1024?`${a} B`:a<1024*1024?`${(a/1024).toFixed(2)} KB`:`${(a/(1024*1024)).toFixed(2)} MB`}async readBackupFile(t){return new Promise((s,a)=>{const n=new FileReader;n.onload=i=>{try{const c=i.target?.result,p=JSON.parse(c);s(p)}catch{a(new Error("Invalid backup file format"))}},n.onerror=()=>{a(new Error("Failed to read backup file"))},n.readAsText(t)})}}const oa=new $c;class Ic{RESTORE_ORDER=["vendors","stocks","raw_products","processes","products","staff","sales_channels","purchases","pre_production_tasks","production_tasks","post_production_tasks","sales_units","sales_records","stock_status","pre_production_status","production_status","post_production_status"];async validateBackup(t){const s=[],a=[];if(t.metadata?.version||s.push("Missing backup version"),t.metadata?.timestamp||s.push("Missing backup timestamp"),!t.collections||typeof t.collections!="object")return s.push("Invalid or missing collections data"),{valid:!1,errors:s,warnings:a};const n=["products","stocks","vendors"];for(const c of n)t.collections[c]||a.push(`Missing recommended collection: ${c}`);for(const[c,p]of Object.entries(t.collections))Array.isArray(p)?p.length>0&&(p[0].$id||a.push(`Documents in ${c} may be missing $id field`)):s.push(`Invalid data format for collection: ${c}`);const i=Object.values(t.collections).reduce((c,p)=>c+p.length,0);return t.metadata.totalRecords!==i&&a.push(`Metadata record count (${t.metadata.totalRecords}) doesn't match actual count (${i})`),{valid:s.length===0,errors:s,warnings:a}}cleanDocument(t){const{$id:s,$createdAt:a,$updatedAt:n,$permissions:i,$collectionId:c,$databaseId:p,...m}=t;return m}async documentExists(t,s){try{return await at.getDocument(rt,Ce[t],s),!0}catch{return!1}}async clearCollection(t){let s=0,a=!0;try{for(;a;){const n=await at.listDocuments(rt,Ce[t],[]);for(const i of n.documents)try{await at.deleteDocument(rt,Ce[t],i.$id),s++}catch(c){console.error(`Failed to delete document ${i.$id}:`,c)}a=n.documents.length>0}}catch(n){console.error(`Error clearing collection ${t}:`,n)}return s}async restoreCollection(t,s,a,n){const i={total:s.length,success:0,failed:0,skipped:0,errors:[]};for(let c=0;c<s.length;c++){const p=s[c];try{const m=this.cleanDocument(p),o=p.$id||hs.unique();if(a.handleIdConflicts==="skip"){if(await this.documentExists(t,o)){i.skipped++;continue}}else a.handleIdConflicts==="overwrite"&&await this.documentExists(t,o)&&await at.deleteDocument(rt,Ce[t],o);await at.createDocument(rt,Ce[t],a.handleIdConflicts==="new"?hs.unique():o,m),i.success++}catch(m){if(i.failed++,i.errors.push({documentId:p.$id||"unknown",error:m.message||"Unknown error"}),a.stopOnError)throw m}n&&n(c+1,s.length)}return i}async restoreFromBackup(t,s,a){const n={success:!0,collections:{},errors:[],totalProcessed:0,totalSuccess:0,totalFailed:0};try{a&&a({currentCollection:"",processedCollections:0,totalCollections:0,currentRecords:0,totalRecords:0,percentage:0,phase:"validating"});const i=await this.validateBackup(t);if(!i.valid)throw new Error(`Invalid backup: ${i.errors.join(", ")}`);const c=this.RESTORE_ORDER.filter(o=>t.collections[o]&&t.collections[o].length>0),p=c.length;let m=0;if(s.clearExisting){a&&a({currentCollection:"",processedCollections:0,totalCollections:p,currentRecords:0,totalRecords:0,percentage:0,phase:"clearing"});for(const o of c)await this.clearCollection(o)}for(const o of c){a&&a({currentCollection:o,processedCollections:m,totalCollections:p,currentRecords:0,totalRecords:n.totalProcessed,percentage:Math.round(m/p*100),phase:"restoring"});try{const g=t.collections[o],b=await this.restoreCollection(o,g,s,(x,j)=>{a&&a({currentCollection:o,processedCollections:m,totalCollections:p,currentRecords:x,totalRecords:n.totalProcessed+x,percentage:Math.round((m+x/j)/p*100),phase:"restoring"})});n.collections[o]=b,n.totalProcessed+=b.total,n.totalSuccess+=b.success,n.totalFailed+=b.failed,m++}catch(g){if(n.success=!1,n.errors.push({collection:o,error:g.message||"Unknown error"}),s.stopOnError)throw g}}a&&a({currentCollection:"",processedCollections:p,totalCollections:p,currentRecords:n.totalProcessed,totalRecords:n.totalProcessed,percentage:100,phase:"complete"})}catch(i){n.success=!1,n.errors.push({collection:"general",error:i.message||"Unknown error"})}return n}getRestoreSummary(t){const s=[`Total Collections: ${Object.keys(t.collections).length}`,`Total Records Processed: ${t.totalProcessed}`,`Successful: ${t.totalSuccess}`,`Failed: ${t.totalFailed}`];return t.errors.length>0&&(s.push(`
Errors: ${t.errors.length}`),t.errors.forEach(a=>{s.push(`  - ${a.collection}: ${a.error}`)})),s.join(`
`)}}const Lc=new Ic;function Mc(){const{toast:r}=Fe(),t=u.useRef(null),[s,a]=u.useState(!1),[n,i]=u.useState(!1),[c,p]=u.useState(null),[m,o]=u.useState(null),[g,b]=u.useState(!1),[x,j]=u.useState(null),[f,P]=u.useState({autoBackup:!0,frequency:"daily",time:"00:00",retention:"30"}),[N,T]=u.useState({createSafetyBackup:!0,clearExisting:!0,handleIdConflicts:"skip",stopOnError:!1}),A=async()=>{a(!0),p(null);try{r({title:"Creating backup...",description:"This may take a few minutes depending on data size"});const F=await oa.createFullBackup(U=>{p(U)}),V=oa.getBackupSize(F);await oa.downloadBackup(F),r({title:"Backup created successfully!",description:`Downloaded ${V} backup file with ${F.metadata.totalRecords} records`})}catch(F){console.error("Backup error:",F),r({title:"Backup failed",description:F.message||"An error occurred during backup",variant:"destructive"})}finally{a(!1),p(null)}},E=F=>{const V=F.target.files?.[0];if(V){if(!V.name.endsWith(".json")){r({title:"Invalid file type",description:"Please select a JSON backup file",variant:"destructive"});return}j(V),b(!0)}},D=async()=>{if(x){b(!1),i(!0),o(null);try{r({title:"Reading backup file...",description:"Please wait while we validate the backup"});const F=await oa.readBackupFile(x);r({title:"Restoring data...",description:"This may take several minutes. Do not close this window."});const V=await Lc.restoreFromBackup(F,N,U=>{o(U)});V.success?r({title:"Restore completed successfully!",description:`Restored ${V.totalSuccess} records across ${Object.keys(V.collections).length} collections`}):(r({title:"Restore completed with errors",description:`${V.totalSuccess} succeeded, ${V.totalFailed} failed. Check console for details.`,variant:"destructive"}),console.error("Restore errors:",V.errors))}catch(F){console.error("Restore error:",F),r({title:"Restore failed",description:F.message||"An error occurred during restore",variant:"destructive"})}finally{i(!1),o(null),j(null),t.current&&(t.current.value="")}}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(Qe,{children:[e.jsx(Bt,{className:"h-4 w-4"}),e.jsx(Ye,{children:"Always create a backup before making major changes. Store backups securely in multiple locations."})]}),s&&c&&e.jsxs(te,{children:[e.jsx(pe,{children:e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"h-5 w-5 animate-spin"}),"Creating Backup..."]})}),e.jsx(se,{className:"space-y-4",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsxs("span",{children:["Processing: ",c.currentCollection]}),e.jsxs("span",{children:[c.percentage,"%"]})]}),e.jsx(As,{value:c.percentage}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:[c.processedCollections," / ",c.totalCollections," collections (",c.totalRecords," records)"]})]})})]}),n&&m&&e.jsxs(te,{children:[e.jsx(pe,{children:e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"h-5 w-5 animate-spin"}),"Restoring Data..."]})}),e.jsx(se,{className:"space-y-4",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsxs("span",{children:["Phase: ",m.phase]}),e.jsxs("span",{children:[m.percentage,"%"]})]}),e.jsx(As,{value:m.percentage}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:[m.currentCollection&&`Processing: ${m.currentCollection}`,e.jsx("br",{}),m.processedCollections," / ",m.totalCollections," collections (",m.totalRecords," records)"]})]})})]}),e.jsxs(te,{children:[e.jsxs(pe,{children:[e.jsx(xe,{children:"Create Backup"}),e.jsx(Te,{children:"Export all your data to a JSON file"})]}),e.jsxs(se,{className:"space-y-4",children:[e.jsxs(Qe,{children:[e.jsx(fa,{className:"h-4 w-4"}),e.jsx(Ye,{children:"Full backup includes all master data, transactions, tasks, and status records. The backup file will be downloaded to your computer."})]}),e.jsx($,{onClick:A,disabled:s||n,className:"gap-2",children:s?e.jsxs(e.Fragment,{children:[e.jsx(Be,{className:"h-4 w-4 animate-spin"}),"Creating Backup..."]}):e.jsxs(e.Fragment,{children:[e.jsx(fa,{className:"h-4 w-4"}),"Create Full Backup"]})})]})]}),e.jsxs(te,{children:[e.jsxs(pe,{children:[e.jsx(xe,{children:"Restore Data"}),e.jsx(Te,{children:"Import data from a backup file"})]}),e.jsxs(se,{className:"space-y-4",children:[e.jsxs(Qe,{children:[e.jsx(Bt,{className:"h-4 w-4"}),e.jsx(Ye,{children:"Warning: Restoring will replace current data. Make sure you have a recent backup before proceeding."})]}),e.jsx("input",{ref:t,type:"file",accept:".json",onChange:E,className:"hidden"}),e.jsxs($,{variant:"outline",onClick:()=>t.current?.click(),disabled:s||n,className:"gap-2",children:[e.jsx(ga,{className:"h-4 w-4"}),"Select Backup File"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Supported format: JSON backup files created by this system"})]})]}),e.jsx(ct,{open:g,onOpenChange:b,children:e.jsxs(nt,{className:"max-w-2xl",children:[e.jsxs(it,{children:[e.jsx(lt,{children:"Confirm Data Restore"}),e.jsxs(dt,{children:["You are about to restore data from: ",x?.name]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs(Qe,{children:[e.jsx(Bt,{className:"h-4 w-4"}),e.jsx(Ye,{children:"This operation will modify your database. Please review the options carefully."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(M,{children:"Create Safety Backup First"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Backup current data before restoring"})]}),e.jsx(It,{checked:N.createSafetyBackup,onCheckedChange:F=>T({...N,createSafetyBackup:F})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(M,{children:"Clear Existing Data"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Remove all current data before restore"})]}),e.jsx(It,{checked:N.clearExisting,onCheckedChange:F=>T({...N,clearExisting:F})})]}),e.jsxs("div",{children:[e.jsx(M,{children:"Handle ID Conflicts"}),e.jsxs(le,{value:N.handleIdConflicts,onValueChange:F=>T({...N,handleIdConflicts:F}),children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"skip",children:"Skip existing records"}),e.jsx(S,{value:"overwrite",children:"Overwrite existing records"}),e.jsx(S,{value:"new",children:"Create with new IDs"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(M,{children:"Stop on Error"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Stop restore if any error occurs"})]}),e.jsx(It,{checked:N.stopOnError,onCheckedChange:F=>T({...N,stopOnError:F})})]})]})]}),e.jsxs(ot,{children:[e.jsx($,{variant:"outline",onClick:()=>b(!1),children:"Cancel"}),e.jsxs($,{onClick:D,className:"gap-2",children:[e.jsx(ls,{className:"h-4 w-4"}),"Start Restore"]})]})]})})]})}function Oc(){const{toast:r}=Fe(),[t,s]=u.useState({minPasswordLength:"8",requireUppercase:!0,requireLowercase:!0,requireNumbers:!0,requireSpecialChars:!0,passwordExpiry:"90",sessionTimeout:"30",maxSessions:"3",enable2FA:!1,loginAttempts:"5",lockoutDuration:"30"});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(te,{children:[e.jsxs(pe,{children:[e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(Oi,{className:"h-5 w-5"}),"Password Policy"]}),e.jsx(Te,{children:"Configure password requirements"})]}),e.jsxs(se,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(M,{children:"Minimum Password Length"}),e.jsxs(le,{value:t.minPasswordLength,onValueChange:a=>s({...t,minPasswordLength:a}),children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsx(oe,{children:[6,8,10,12,16].map(a=>e.jsxs(S,{value:String(a),children:[a," characters"]},a))})]})]}),e.jsxs("div",{children:[e.jsx(M,{children:"Password Expiry"}),e.jsxs(le,{value:t.passwordExpiry,onValueChange:a=>s({...t,passwordExpiry:a}),children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"never",children:"Never"}),e.jsx(S,{value:"30",children:"30 days"}),e.jsx(S,{value:"60",children:"60 days"}),e.jsx(S,{value:"90",children:"90 days"})]})]})]})]}),e.jsx("div",{className:"space-y-3",children:[{key:"requireUppercase",label:"Require Uppercase Letters"},{key:"requireLowercase",label:"Require Lowercase Letters"},{key:"requireNumbers",label:"Require Numbers"},{key:"requireSpecialChars",label:"Require Special Characters"}].map(({key:a,label:n})=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(M,{children:n}),e.jsx(It,{checked:t[a],onCheckedChange:i=>s({...t,[a]:i})})]},a))})]})]}),e.jsxs(te,{children:[e.jsxs(pe,{children:[e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(mn,{className:"h-5 w-5"}),"Session Management"]}),e.jsx(Te,{children:"Control user sessions and timeouts"})]}),e.jsx(se,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(M,{children:"Session Timeout (minutes)"}),e.jsxs(le,{value:t.sessionTimeout,onValueChange:a=>s({...t,sessionTimeout:a}),children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsx(oe,{children:[15,30,60,120].map(a=>e.jsxs(S,{value:String(a),children:[a," minutes"]},a))})]})]}),e.jsxs("div",{children:[e.jsx(M,{children:"Max Concurrent Sessions"}),e.jsxs(le,{value:t.maxSessions,onValueChange:a=>s({...t,maxSessions:a}),children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsx(oe,{children:[1,2,3,5,10].map(a=>e.jsxs(S,{value:String(a),children:[a," session",a>1?"s":""]},a))})]})]})]})})]}),e.jsxs(te,{children:[e.jsxs(pe,{children:[e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(an,{className:"h-5 w-5"}),"Access Control"]}),e.jsx(Te,{children:"Configure login security"})]}),e.jsxs(se,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(M,{children:"Enable Two-Factor Authentication (2FA)"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Require 2FA for all users"})]}),e.jsx(It,{checked:t.enable2FA,onCheckedChange:a=>s({...t,enable2FA:a})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(M,{children:"Login Attempt Limit"}),e.jsxs(le,{value:t.loginAttempts,onValueChange:a=>s({...t,loginAttempts:a}),children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsx(oe,{children:[3,5,10].map(a=>e.jsxs(S,{value:String(a),children:[a," attempts"]},a))})]})]}),e.jsxs("div",{children:[e.jsx(M,{children:"Account Lockout Duration"}),e.jsxs(le,{value:t.lockoutDuration,onValueChange:a=>s({...t,lockoutDuration:a}),children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsx(oe,{children:[15,30,60].map(a=>e.jsxs(S,{value:String(a),children:[a," minutes"]},a))})]})]})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs($,{onClick:()=>r({title:"Security settings saved"}),className:"gap-2",children:[e.jsx(_a,{className:"h-4 w-4"}),"Save Security Settings"]})})]})}function Uc(){const{toast:r}=Fe(),[t,s]=u.useState({host:"smtp.gmail.com",port:"587",username:"noreply@molaga.com",password:"",fromEmail:"noreply@molaga.com",fromName:"Molaga ERP",useTLS:!0}),[a,n]=u.useState({lowStockAlerts:!0,taskCompletion:!0,backupStatus:!0,userLogin:!1,dataImportExport:!0});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(te,{children:[e.jsxs(pe,{children:[e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(Qa,{className:"h-5 w-5"}),"Email Configuration"]}),e.jsx(Te,{children:"Configure SMTP settings for email notifications"})]}),e.jsxs(se,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(M,{children:"SMTP Host"}),e.jsx(G,{value:t.host,onChange:i=>s({...t,host:i.target.value})})]}),e.jsxs("div",{children:[e.jsx(M,{children:"SMTP Port"}),e.jsx(G,{value:t.port,onChange:i=>s({...t,port:i.target.value})})]}),e.jsxs("div",{children:[e.jsx(M,{children:"Username"}),e.jsx(G,{value:t.username,onChange:i=>s({...t,username:i.target.value})})]}),e.jsxs("div",{children:[e.jsx(M,{children:"Password"}),e.jsx(G,{type:"password",value:t.password,onChange:i=>s({...t,password:i.target.value})})]}),e.jsxs("div",{children:[e.jsx(M,{children:"From Email"}),e.jsx(G,{type:"email",value:t.fromEmail,onChange:i=>s({...t,fromEmail:i.target.value})})]}),e.jsxs("div",{children:[e.jsx(M,{children:"From Name"}),e.jsx(G,{value:t.fromName,onChange:i=>s({...t,fromName:i.target.value})})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(M,{children:"Use TLS/SSL"}),e.jsx(It,{checked:t.useTLS,onCheckedChange:i=>s({...t,useTLS:i})})]}),e.jsxs($,{variant:"outline",className:"gap-2",children:[e.jsx(Ui,{className:"h-4 w-4"}),"Send Test Email"]})]})]}),e.jsxs(te,{children:[e.jsxs(pe,{children:[e.jsx(xe,{children:"Notification Preferences"}),e.jsx(Te,{children:"Choose which notifications to receive"})]}),e.jsx(se,{className:"space-y-4",children:[{key:"lowStockAlerts",label:"Low Stock Alerts",desc:"Get notified when stock falls below minimum level"},{key:"taskCompletion",label:"Task Completion",desc:"Notifications when tasks are completed"},{key:"backupStatus",label:"Backup Success/Failure",desc:"Get notified about backup operations"},{key:"userLogin",label:"User Login Alerts",desc:"Notifications for user login activity"},{key:"dataImportExport",label:"Data Import/Export Status",desc:"Updates on data operations"}].map(({key:i,label:c,desc:p})=>e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{children:[e.jsx(M,{children:c}),e.jsx("p",{className:"text-sm text-muted-foreground",children:p})]}),e.jsx(It,{checked:a[i],onCheckedChange:m=>n({...a,[i]:m})})]},i))})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs($,{onClick:()=>r({title:"Notification settings saved"}),className:"gap-2",children:[e.jsx(_a,{className:"h-4 w-4"}),"Save Settings"]})})]})}const xr="molaga_data_settings",gr={importFormat:"csv",exportFormat:"csv",dateFormat:"DD/MM/YYYY",encoding:"utf8"};class Kc{settings;constructor(){this.settings=this.loadSettings()}loadSettings(){try{const t=localStorage.getItem(xr);if(t)return{...gr,...JSON.parse(t)}}catch(t){console.error("Error loading data settings:",t)}return gr}saveSettings(){try{localStorage.setItem(xr,JSON.stringify(this.settings))}catch(t){console.error("Error saving data settings:",t)}}getSettings(){return{...this.settings}}updateSettings(t){return this.settings={...this.settings,...t},this.saveSettings(),this.getSettings()}async archiveOldRecords(t){return new Promise(s=>{setTimeout(()=>{s({success:!0,count:0})},1e3)})}async deleteCancelledTasks(t){return new Promise(s=>{setTimeout(()=>{s({success:!0,count:0})},1e3)})}async clearAuditLogs(t){return new Promise(s=>{setTimeout(()=>{s({success:!0,count:0})},1e3)})}async optimizeDatabase(){return new Promise(t=>{setTimeout(()=>{t({success:!0,message:"Database optimized successfully"})},2e3)})}}const _s=new Kc;function Vc(){const[r,t]=u.useState(_s.getSettings()),[s,a]=u.useState(!1),n=u.useCallback(o=>{const g=_s.updateSettings(o);return t(g),g},[]),i=u.useCallback(async o=>{a(!0);try{return await _s.archiveOldRecords(o)}finally{a(!1)}},[]),c=u.useCallback(async o=>{a(!0);try{return await _s.deleteCancelledTasks(o)}finally{a(!1)}},[]),p=u.useCallback(async o=>{a(!0);try{return await _s.clearAuditLogs(o)}finally{a(!1)}},[]),m=u.useCallback(async()=>{a(!0);try{return await _s.optimizeDatabase()}finally{a(!1)}},[]);return{settings:r,updateSettings:n,archiveOldRecords:i,deleteCancelledTasks:c,clearAuditLogs:p,optimizeDatabase:m,isProcessing:s}}function Bc(){const{toast:r}=Fe(),{settings:t,updateSettings:s,archiveOldRecords:a,deleteCancelledTasks:n,clearAuditLogs:i,optimizeDatabase:c,isProcessing:p}=Vc(),m=async()=>{if(!confirm("Are you sure you want to archive old records?"))return;const x=await a(12);x.success&&r({title:`Archived ${x.count} records successfully`})},o=async()=>{if(!confirm("Are you sure you want to delete cancelled tasks?"))return;const x=await n(90);x.success&&r({title:`Deleted ${x.count} tasks successfully`})},g=async()=>{if(!confirm("Are you sure you want to clear audit logs?"))return;const x=await i(6);x.success&&r({title:`Cleared ${x.count} log entries successfully`})},b=async()=>{const x=await c();x.success&&r({title:x.message})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(te,{children:[e.jsxs(pe,{children:[e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(Es,{className:"h-5 w-5"}),"Import/Export Settings"]}),e.jsx(Te,{children:"Configure default import and export preferences"})]}),e.jsx(se,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(M,{children:"Default Import Format"}),e.jsxs(le,{value:t.importFormat,onValueChange:x=>s({importFormat:x}),children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"csv",children:"CSV"}),e.jsx(S,{value:"excel",children:"Excel"}),e.jsx(S,{value:"json",children:"JSON"})]})]})]}),e.jsxs("div",{children:[e.jsx(M,{children:"Default Export Format"}),e.jsxs(le,{value:t.exportFormat,onValueChange:x=>s({exportFormat:x}),children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"csv",children:"CSV"}),e.jsx(S,{value:"excel",children:"Excel"}),e.jsx(S,{value:"pdf",children:"PDF"})]})]})]}),e.jsxs("div",{children:[e.jsx(M,{children:"Date Format for Import/Export"}),e.jsxs(le,{value:t.dateFormat,onValueChange:x=>s({dateFormat:x}),children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"DD/MM/YYYY",children:"DD/MM/YYYY"}),e.jsx(S,{value:"MM/DD/YYYY",children:"MM/DD/YYYY"}),e.jsx(S,{value:"YYYY-MM-DD",children:"YYYY-MM-DD"})]})]})]}),e.jsxs("div",{children:[e.jsx(M,{children:"File Encoding"}),e.jsxs(le,{value:t.encoding,onValueChange:x=>s({encoding:x}),children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"utf8",children:"UTF-8"}),e.jsx(S,{value:"utf16",children:"UTF-16"}),e.jsx(S,{value:"ascii",children:"ASCII"})]})]})]})]})})]}),e.jsxs(te,{children:[e.jsxs(pe,{children:[e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(Lt,{className:"h-5 w-5"}),"Data Cleanup"]}),e.jsx(Te,{children:"Manage old and unnecessary data"})]}),e.jsxs(se,{className:"space-y-4",children:[e.jsxs(Qe,{children:[e.jsx(Bt,{className:"h-4 w-4"}),e.jsx(Ye,{children:"Data cleanup operations are permanent. Always create a backup before proceeding."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx(M,{children:"Archive Old Records"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Move records older than 12 months to archive"})]}),e.jsx($,{variant:"outline",onClick:m,disabled:p,children:p?e.jsx(Be,{className:"h-4 w-4 animate-spin"}):"Archive"})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx(M,{children:"Delete Cancelled Tasks"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Remove cancelled tasks older than 90 days"})]}),e.jsx($,{variant:"outline",onClick:o,disabled:p,children:p?e.jsx(Be,{className:"h-4 w-4 animate-spin"}):"Delete"})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx(M,{children:"Clear Audit Logs"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Remove audit logs older than 6 months"})]}),e.jsx($,{variant:"outline",onClick:g,disabled:p,children:p?e.jsx(Be,{className:"h-4 w-4 animate-spin"}):"Clear"})]})]})]})]}),e.jsxs(te,{children:[e.jsxs(pe,{children:[e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(fa,{className:"h-5 w-5"}),"Database Maintenance"]}),e.jsx(Te,{children:"Optimize database performance"})]}),e.jsx(se,{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx(M,{children:"Optimize Database"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Rebuild indexes and optimize tables"})]}),e.jsx($,{variant:"outline",onClick:b,disabled:p,children:p?e.jsx(Be,{className:"h-4 w-4 animate-spin"}):"Optimize"})]})})]})]})}const ks="molaga_api_keys";class Hc{generateKey(t,s,a){const n=this.createSecureKey(),i=new Date,c={id:this.generateId(),name:t,key:n,createdAt:i.toISOString(),expiresAt:a?new Date(i.getTime()+a*24*60*60*1e3).toISOString():void 0,permissions:s,isActive:!0};return this.saveKey(c),c}createSecureKey(){return`mlg_${this.generateRandomString(32)}`}generateRandomString(t){const s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let a="";const n=new Uint8Array(t);crypto.getRandomValues(n);for(let i=0;i<t;i++)a+=s[n[i]%s.length];return a}generateId(){return`key_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}saveKey(t){const s=this.getAllKeys();s.push(t),localStorage.setItem(ks,JSON.stringify(s))}getAllKeys(){try{const t=localStorage.getItem(ks);return t?JSON.parse(t):[]}catch(t){return console.error("Error loading API keys:",t),[]}}getKeyById(t){return this.getAllKeys().find(a=>a.id===t)||null}revokeKey(t){const s=this.getAllKeys(),a=s.findIndex(n=>n.id===t);return a!==-1?(s[a].isActive=!1,localStorage.setItem(ks,JSON.stringify(s)),!0):!1}deleteKey(t){const s=this.getAllKeys(),a=s.filter(n=>n.id!==t);return a.length!==s.length?(localStorage.setItem(ks,JSON.stringify(a)),!0):!1}validateKey(t){const a=this.getAllKeys().find(n=>n.key===t);return a?a.isActive?a.expiresAt&&new Date(a.expiresAt)<new Date?{valid:!1,error:"API key has expired"}:{valid:!0,apiKey:a}:{valid:!1,error:"API key has been revoked"}:{valid:!1,error:"Invalid API key"}}updateLastUsed(t){const s=this.getAllKeys(),a=s.findIndex(n=>n.id===t);a!==-1&&(s[a].lastUsed=new Date().toISOString(),localStorage.setItem(ks,JSON.stringify(s)))}regenerateKey(t){const s=this.getAllKeys(),a=s.findIndex(n=>n.id===t);return a!==-1?(s[a],s[a].key=this.createSecureKey(),s[a].createdAt=new Date().toISOString(),s[a].lastUsed=void 0,localStorage.setItem(ks,JSON.stringify(s)),s[a]):null}}const Jt=new Hc;function zc(){const{toast:r}=Fe(),{user:t}=vt(),[s,a]=u.useState(Jt.getAllKeys()),[n,i]=u.useState(!1),[c,p]=u.useState(!1),[m,o]=u.useState({name:"",expiresIn:"90",permissions:["read"]}),[g,b]=u.useState(null),x=t?.email==="varda3d@gmail.com",j=()=>{if(!m.name.trim()){r({title:"Validation error",description:"Please enter a key name",variant:"destructive"});return}const D=m.expiresIn==="never"?void 0:parseInt(m.expiresIn),F=Jt.generateKey(m.name,m.permissions,D);b(F),a(Jt.getAllKeys()),i(!1),p(!0),o({name:"",expiresIn:"90",permissions:["read"]}),r({title:"API key created",description:"Copy the key now - it won't be shown again"})},f=D=>{navigator.clipboard.writeText(D),r({title:"Copied",description:"API key copied to clipboard"})},P=D=>{Jt.revokeKey(D),a(Jt.getAllKeys()),r({title:"API key revoked",description:"The key can no longer be used"})},N=D=>{Jt.deleteKey(D),a(Jt.getAllKeys()),r({title:"API key deleted",description:"The key has been permanently removed"})},T=D=>{const F=Jt.regenerateKey(D);F&&(b(F),a(Jt.getAllKeys()),p(!0),r({title:"API key regenerated",description:"Copy the new key now"}))},A=D=>new Date(D).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),E=D=>D&&new Date(D)<new Date;return x?e.jsxs("div",{className:"space-y-6",children:[e.jsxs(te,{children:[e.jsx(pe,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx($a,{className:"h-5 w-5"}),"API Keys"]}),e.jsx(Te,{children:"Generate and manage API keys for external integrations"})]}),e.jsxs($,{onClick:()=>i(!0),className:"gap-2",children:[e.jsx(Ct,{className:"h-4 w-4"}),"Create API Key"]})]})}),e.jsxs(se,{children:[e.jsxs(Qe,{className:"mb-6",children:[e.jsx(Bt,{className:"h-4 w-4"}),e.jsxs(Ye,{children:[e.jsx("strong",{children:"Security Notice:"})," API keys provide access to your system. Keep them secure and never share them publicly."]})]}),s.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx($a,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No API keys created yet"}),e.jsx("p",{className:"text-sm",children:"Create your first API key to get started"})]}):e.jsx("div",{className:"space-y-4",children:s.map(D=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h4",{className:"font-medium",children:D.name}),D.isActive?E(D.expiresAt)?e.jsx(et,{variant:"destructive",children:"Expired"}):e.jsx(et,{variant:"default",className:"bg-green-500",children:"Active"}):e.jsx(et,{variant:"secondary",children:"Revoked"})]}),e.jsxs("div",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsxs("p",{children:["Key: ",D.key.substring(0,20),"...",D.key.substring(D.key.length-4)]}),e.jsxs("p",{children:["Created: ",A(D.createdAt)]}),D.expiresAt&&e.jsxs("p",{children:["Expires: ",A(D.expiresAt)]}),D.lastUsed&&e.jsxs("p",{children:["Last used: ",A(D.lastUsed)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs($,{variant:"outline",size:"sm",onClick:()=>f(D.key),className:"gap-2",children:[e.jsx(Hs,{className:"h-3 w-3"}),"Copy"]}),D.isActive&&!E(D.expiresAt)&&e.jsxs(e.Fragment,{children:[e.jsxs($,{variant:"outline",size:"sm",onClick:()=>T(D.id),className:"gap-2",children:[e.jsx(Ka,{className:"h-3 w-3"}),"Regenerate"]}),e.jsx($,{variant:"outline",size:"sm",onClick:()=>P(D.id),className:"gap-2 text-orange-600 hover:text-orange-700",children:"Revoke"})]}),e.jsxs($,{variant:"outline",size:"sm",onClick:()=>N(D.id),className:"gap-2 text-red-600 hover:text-red-700",children:[e.jsx(Lt,{className:"h-3 w-3"}),"Delete"]})]})]},D.id))})]})]}),e.jsx(ct,{open:n,onOpenChange:i,children:e.jsxs(nt,{children:[e.jsxs(it,{children:[e.jsx(lt,{children:"Create New API Key"}),e.jsx(dt,{children:"Generate a new API key for external integrations"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"keyName",children:"Key Name *"}),e.jsx(G,{id:"keyName",placeholder:"e.g., Mobile App Integration",value:m.name,onChange:D=>o({...m,name:D.target.value})})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"expiresIn",children:"Expires In"}),e.jsxs(le,{value:m.expiresIn,onValueChange:D=>o({...m,expiresIn:D}),children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"30",children:"30 days"}),e.jsx(S,{value:"90",children:"90 days"}),e.jsx(S,{value:"180",children:"180 days"}),e.jsx(S,{value:"365",children:"1 year"}),e.jsx(S,{value:"never",children:"Never"})]})]})]})]}),e.jsxs(ot,{children:[e.jsx($,{variant:"outline",onClick:()=>i(!1),children:"Cancel"}),e.jsx($,{onClick:j,children:"Create Key"})]})]})}),e.jsx(ct,{open:c,onOpenChange:p,children:e.jsxs(nt,{children:[e.jsxs(it,{children:[e.jsxs(lt,{className:"flex items-center gap-2",children:[e.jsx(ls,{className:"h-5 w-5 text-green-500"}),"API Key Created"]}),e.jsx(dt,{children:"Copy this key now - it won't be shown again"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs(Qe,{children:[e.jsx(Bt,{className:"h-4 w-4"}),e.jsx(Ye,{children:"Store this key securely. You won't be able to see it again."})]}),e.jsxs("div",{children:[e.jsx(M,{children:"API Key"}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(G,{value:g?.key||"",readOnly:!0,className:"font-mono text-sm"}),e.jsxs($,{variant:"outline",onClick:()=>f(g?.key||""),className:"gap-2",children:[e.jsx(Hs,{className:"h-4 w-4"}),"Copy"]})]})]})]}),e.jsx(ot,{children:e.jsx($,{onClick:()=>p(!1),children:"Done"})})]})})]}):e.jsxs(Qe,{children:[e.jsx(Bt,{className:"h-4 w-4"}),e.jsx(Ye,{children:"Only Super Admins can manage API keys. Contact your administrator for access."})]})}const fr="molaga_custom_domain";class Qc{getConfig(){try{const t=localStorage.getItem(fr);if(t)return JSON.parse(t)}catch(t){console.error("Error loading domain config:",t)}return{customDomain:null,isVerified:!1,verificationToken:this.generateVerificationToken(),verifiedAt:null,createdAt:null}}setDomain(t){const s=this.getConfig();s.customDomain=t,s.isVerified=!1,s.verifiedAt=null,s.createdAt=new Date().toISOString(),s.verificationToken||(s.verificationToken=this.generateVerificationToken()),this.saveConfig(s)}verifyDomain(){const t=this.getConfig();t.isVerified=!0,t.verifiedAt=new Date().toISOString(),this.saveConfig(t)}removeDomain(){const t={customDomain:null,isVerified:!1,verificationToken:this.generateVerificationToken(),verifiedAt:null,createdAt:null};this.saveConfig(t)}generateVerificationToken(){const t=new Uint8Array(16);return crypto.getRandomValues(t),Array.from(t,s=>s.toString(16).padStart(2,"0")).join("")}saveConfig(t){try{localStorage.setItem(fr,JSON.stringify(t))}catch(s){console.error("Error saving domain config:",s)}}isCustomDomainActive(){const t=this.getConfig();return!!(t.customDomain&&t.isVerified)}getActiveDomain(){const t=this.getConfig();return t.isVerified?t.customDomain:null}}const ms=new Qc;function Yc(){const{toast:r}=Fe(),{user:t}=vt(),[s,a]=u.useState(ms.getConfig()),[n,i]=u.useState(s.customDomain||""),[c,p]=u.useState(!1),m=t?.email==="varda3d@gmail.com",o=()=>{if(!n.trim()){r({title:"Validation error",description:"Please enter a domain name",variant:"destructive"});return}if(!/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(n)){r({title:"Invalid domain",description:"Please enter a valid domain name (e.g., erp.yourcompany.com)",variant:"destructive"});return}ms.setDomain(n),a(ms.getConfig()),r({title:"Domain saved",description:"Custom domain configuration updated"})},g=async()=>{p(!0),setTimeout(()=>{Math.random()>.3?(ms.verifyDomain(),a(ms.getConfig()),r({title:"Domain verified",description:"Your custom domain is now active"})):r({title:"Verification failed",description:"Please check your DNS records and try again",variant:"destructive"}),p(!1)},2e3)},b=()=>{ms.removeDomain(),a(ms.getConfig()),i(""),r({title:"Domain removed",description:"Custom domain configuration has been removed"})},x=j=>{navigator.clipboard.writeText(j),r({title:"Copied",description:"Copied to clipboard"})};return m?e.jsx("div",{className:"space-y-6",children:e.jsxs(te,{children:[e.jsxs(pe,{children:[e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(Ia,{className:"h-5 w-5"}),"Custom Domain"]}),e.jsx(Te,{children:"Configure a custom domain for your ERP system"})]}),e.jsxs(se,{className:"space-y-6",children:[e.jsxs(Qe,{children:[e.jsx(Bt,{className:"h-4 w-4"}),e.jsxs(Ye,{children:[e.jsx("strong",{children:"Note:"})," Custom domain configuration requires DNS changes. Make sure you have access to your domain's DNS settings."]})]}),s.customDomain&&e.jsxs("div",{className:"p-4 border rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ia,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:s.customDomain})]}),s.isVerified?e.jsxs(et,{className:"bg-green-500",children:[e.jsx(ls,{className:"h-3 w-3 mr-1"}),"Verified"]}):e.jsx(et,{variant:"secondary",children:"Pending Verification"})]}),s.verifiedAt&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Verified on ",new Date(s.verifiedAt).toLocaleDateString()]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"domain",children:"Domain Name"}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(G,{id:"domain",placeholder:"erp.yourcompany.com",value:n,onChange:j=>i(j.target.value),disabled:s.isVerified}),s.isVerified?e.jsx($,{variant:"outline",onClick:b,className:"text-red-600",children:"Remove"}):e.jsx($,{onClick:o,children:"Save"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Enter your custom domain (e.g., erp.yourcompany.com)"})]}),s.customDomain&&!s.isVerified&&e.jsxs(te,{children:[e.jsxs(pe,{children:[e.jsx(xe,{className:"text-base",children:"DNS Configuration"}),e.jsx(Te,{children:"Add these DNS records to your domain provider"})]}),e.jsxs(se,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"p-3 border rounded-lg bg-muted/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Type: CNAME"}),e.jsx($,{variant:"ghost",size:"sm",onClick:()=>x("CNAME"),className:"h-6 px-2",children:e.jsx(Hs,{className:"h-3 w-3"})})]}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," ",s.customDomain]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Value:"})," molaga-erp.app"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"TTL:"})," 3600"]})]})]}),e.jsxs("div",{className:"p-3 border rounded-lg bg-muted/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Type: TXT (Verification)"}),e.jsx($,{variant:"ghost",size:"sm",onClick:()=>x(`molaga-verification=${s.verificationToken}`),className:"h-6 px-2",children:e.jsx(Hs,{className:"h-3 w-3"})})]}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," _molaga-verification.",s.customDomain]}),e.jsxs("p",{className:"break-all",children:[e.jsx("strong",{children:"Value:"})," molaga-verification=",s.verificationToken]}),e.jsxs("p",{children:[e.jsx("strong",{children:"TTL:"})," 3600"]})]})]})]}),e.jsxs(Qe,{children:[e.jsx(Bt,{className:"h-4 w-4"}),e.jsx(Ye,{children:'DNS changes can take up to 48 hours to propagate. After adding the records, click "Verify Domain" below.'})]}),e.jsx($,{onClick:g,disabled:c,className:"w-full gap-2",children:c?e.jsx(e.Fragment,{children:"Verifying..."}):e.jsxs(e.Fragment,{children:[e.jsx(ls,{className:"h-4 w-4"}),"Verify Domain"]})})]})]}),s.isVerified&&e.jsxs(te,{children:[e.jsxs(pe,{children:[e.jsx(xe,{className:"text-base",children:"SSL Certificate"}),e.jsx(Te,{children:"Your domain is secured with SSL/TLS"})]}),e.jsxs(se,{children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-600",children:[e.jsx(ls,{className:"h-4 w-4"}),e.jsx("span",{children:"SSL certificate is active and valid"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Your custom domain is secured with automatic SSL certificate provisioning."})]})]}),e.jsxs(te,{children:[e.jsx(pe,{children:e.jsx(xe,{className:"text-base",children:"Need Help?"})}),e.jsxs(se,{className:"space-y-2",children:[e.jsxs("a",{href:"#",className:"flex items-center gap-2 text-sm text-primary hover:underline",children:[e.jsx(la,{className:"h-3 w-3"}),"How to configure DNS records"]}),e.jsxs("a",{href:"#",className:"flex items-center gap-2 text-sm text-primary hover:underline",children:[e.jsx(la,{className:"h-3 w-3"}),"Troubleshooting domain verification"]}),e.jsxs("a",{href:"#",className:"flex items-center gap-2 text-sm text-primary hover:underline",children:[e.jsx(la,{className:"h-3 w-3"}),"Contact support"]})]})]})]})]})]})}):e.jsxs(Qe,{children:[e.jsx(Bt,{className:"h-4 w-4"}),e.jsx(Ye,{children:"Only Super Admins can configure custom domains. Contact your administrator for access."})]})}function Wc(){Fe();const{user:r}=vt(),[t,s]=u.useState("overview"),a=r?.email==="varda3d@gmail.com";return e.jsxs("div",{className:"space-y-6",children:[!a&&e.jsxs(Qe,{children:[e.jsx(Bt,{className:"h-4 w-4"}),e.jsxs(Ye,{children:[e.jsx("strong",{children:"Read-Only Mode:"})," Only Super Admin (varda3d@gmail.com) can modify integration settings."]})]}),e.jsxs(zn,{value:t,onValueChange:s,children:[e.jsxs(er,{className:"grid w-full grid-cols-4",children:[e.jsx(Ds,{value:"overview",children:"Overview"}),e.jsx(Ds,{value:"api-keys",children:"API Keys"}),e.jsx(Ds,{value:"domain",children:"Custom Domain"}),e.jsx(Ds,{value:"webhooks",children:"Webhooks"})]}),e.jsxs(_t,{value:"overview",className:"space-y-6 mt-6",children:[e.jsxs(te,{children:[e.jsxs(pe,{children:[e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx($a,{className:"h-5 w-5"}),"API Configuration"]}),e.jsx(Te,{children:"Quick overview of API settings"})]}),e.jsx(se,{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(M,{children:"API Access Status"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage API keys in the API Keys tab"})]}),e.jsx(et,{variant:"secondary",children:"View Details â†’"})]})})]}),e.jsxs(te,{children:[e.jsxs(pe,{children:[e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(Ia,{className:"h-5 w-5"}),"Custom Domain"]}),e.jsx(Te,{children:"Configure your custom domain"})]}),e.jsx(se,{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(M,{children:"Domain Status"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Configure custom domain in the Custom Domain tab"})]}),e.jsx(et,{variant:"secondary",children:"View Details â†’"})]})})]}),e.jsxs(te,{children:[e.jsxs(pe,{children:[e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(Ki,{className:"h-5 w-5"}),"Third-Party Integrations"]}),e.jsx(Te,{children:"Connect with external services"})]}),e.jsx(se,{className:"space-y-4",children:[{name:"Accounting Software",status:"Not Connected",available:!1},{name:"Payment Gateway",status:"Not Connected",available:!1},{name:"SMS Gateway",status:"Not Connected",available:!1},{name:"Cloud Storage",status:"Not Connected",available:!1}].map(n=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx(M,{children:n.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:n.status})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!n.available&&e.jsx(et,{variant:"secondary",children:"Coming Soon"}),e.jsx($,{variant:"outline",size:"sm",disabled:!n.available||!a,children:"Configure"})]})]},n.name))})]})]}),e.jsx(_t,{value:"api-keys",className:"mt-6",children:e.jsx(zc,{})}),e.jsx(_t,{value:"domain",className:"mt-6",children:e.jsx(Yc,{})}),e.jsx(_t,{value:"webhooks",className:"space-y-6 mt-6",children:e.jsxs(te,{children:[e.jsxs(pe,{children:[e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(Vi,{className:"h-5 w-5"}),"Webhooks"]}),e.jsx(Te,{children:"Configure webhook endpoints for real-time notifications"})]}),e.jsxs(se,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(M,{children:"Webhook URL"}),e.jsx(G,{placeholder:"https://your-domain.com/webhook",disabled:!a}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Receive POST requests when events occur"})]}),e.jsxs("div",{children:[e.jsx(M,{children:"Events to Subscribe"}),e.jsx("div",{className:"space-y-2 mt-2",children:["Task Created","Task Completed","Low Stock Alert","Backup Completed"].map(n=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:n}),e.jsx(It,{disabled:!a})]},n))})]}),e.jsx($,{variant:"outline",disabled:!a,children:"Test Webhook"})]})]})})]})]})}function Gc(){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(te,{children:[e.jsxs(pe,{children:[e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(La,{className:"h-5 w-5"}),"System Information"]}),e.jsx(Te,{children:"Details about your Molaga ERP installation"})]}),e.jsx(se,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Application Name"}),e.jsx("p",{className:"font-medium",children:"Molaga ERP"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Version"}),e.jsxs("p",{className:"font-medium flex items-center gap-2",children:["1.0.0",e.jsxs(et,{variant:"default",className:"gap-1",children:[e.jsx(ls,{className:"h-3 w-3"}),"Latest"]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Build Date"}),e.jsx("p",{className:"font-medium",children:"October 11, 2025"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"License Type"}),e.jsx("p",{className:"font-medium",children:"Enterprise"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Licensed To"}),e.jsx("p",{className:"font-medium",children:"Molaga Spices Pvt Ltd"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"License Expiry"}),e.jsx("p",{className:"font-medium",children:"October 11, 2026"})]})]})})]}),e.jsxs(te,{children:[e.jsxs(pe,{children:[e.jsx(xe,{children:"Support & Help"}),e.jsx(Te,{children:"Get assistance with Molaga ERP"})]}),e.jsx(se,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3 p-4 border rounded-lg",children:[e.jsx(Es,{className:"h-5 w-5 text-primary mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Documentation"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Comprehensive guides and tutorials"}),e.jsxs($,{variant:"link",className:"h-auto p-0 gap-1",children:["View Docs",e.jsx(la,{className:"h-3 w-3"})]})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 border rounded-lg",children:[e.jsx(Qa,{className:"h-5 w-5 text-primary mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Email Support"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"support@molagaerp.com"}),e.jsx($,{variant:"link",className:"h-auto p-0",children:"Send Email"})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 border rounded-lg",children:[e.jsx(Bi,{className:"h-5 w-5 text-primary mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Phone Support"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"+91 9876543210"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Mon-Fri, 9 AM - 6 PM IST"})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 border rounded-lg",children:[e.jsx(La,{className:"h-5 w-5 text-primary mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Submit Feedback"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Help us improve"}),e.jsx($,{variant:"link",className:"h-auto p-0",children:"Give Feedback"})]})]})]})})]}),e.jsxs(te,{children:[e.jsxs(pe,{children:[e.jsx(xe,{children:"Updates"}),e.jsx(Te,{children:"Check for system updates"})]}),e.jsxs(se,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg bg-muted/50",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"You're running the latest version"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Last checked: October 11, 2025"})]}),e.jsx($,{variant:"outline",children:"Check for Updates"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium mb-2",children:"Recent Updates"}),e.jsx("div",{className:"space-y-2",children:[{version:"1.0.0",date:"Oct 11, 2025",changes:"Initial release with full ERP features"},{version:"0.9.5",date:"Oct 1, 2025",changes:"Beta testing and bug fixes"},{version:"0.9.0",date:"Sep 15, 2025",changes:"Added validation system"}].map(r=>e.jsxs("div",{className:"p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("p",{className:"font-medium text-sm",children:["Version ",r.version]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r.date})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r.changes})]},r.version))})]})]})]}),e.jsxs(te,{children:[e.jsx(pe,{children:e.jsx(xe,{children:"About Molaga ERP"})}),e.jsxs(se,{children:[e.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed",children:"Molaga ERP is a comprehensive enterprise resource planning system designed specifically for spice manufacturing businesses. It streamlines operations from raw material procurement through production processes to final product sales, providing real-time insights and data-driven decision making capabilities."}),e.jsx("p",{className:"text-sm text-muted-foreground mt-4",children:"Â© 2025 Molaga ERP. All rights reserved."})]})]})]})}const Jc=[{value:"company",label:"Company Profile",icon:Kr},{value:"users",label:"User Management",icon:nn},{value:"approvals",label:"User Approvals",icon:on},{value:"system",label:"System Config",icon:Hi},{value:"backup",label:"Backup & Restore",icon:fa},{value:"security",label:"Security",icon:mn},{value:"notifications",label:"Notifications",icon:Vr},{value:"data",label:"Data Management",icon:Es},{value:"integrations",label:"Integrations",icon:xs},{value:"about",label:"About",icon:La}];function Xc(){const[r,t]=u.useState("company");return e.jsxs("div",{className:"container mx-auto p-6 max-w-7xl",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Settings"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage your system configuration and preferences"})]}),e.jsx(te,{className:"p-6",children:e.jsxs(zn,{value:r,onValueChange:t,className:"space-y-6",children:[e.jsx(er,{className:"grid grid-cols-3 lg:grid-cols-10 gap-2 h-auto p-2",children:Jc.map(s=>e.jsxs(Ds,{value:s.value,className:"flex flex-col items-center gap-1 py-3 data-[state=active]:bg-primary data-[state=active]:text-primary-foreground",children:[e.jsx(s.icon,{className:"h-4 w-4"}),e.jsx("span",{className:"text-xs",children:s.label})]},s.value))}),e.jsx(_t,{value:"company",className:"space-y-4",children:e.jsx(_c,{})}),e.jsx(_t,{value:"users",className:"space-y-4",children:e.jsx(Rc,{})}),e.jsx(_t,{value:"approvals",className:"space-y-4",children:e.jsx(qc,{})}),e.jsx(_t,{value:"system",className:"space-y-4",children:e.jsx(Fc,{})}),e.jsx(_t,{value:"backup",className:"space-y-4",children:e.jsx(Mc,{})}),e.jsx(_t,{value:"security",className:"space-y-4",children:e.jsx(Oc,{})}),e.jsx(_t,{value:"notifications",className:"space-y-4",children:e.jsx(Uc,{})}),e.jsx(_t,{value:"data",className:"space-y-4",children:e.jsx(Bc,{})}),e.jsx(_t,{value:"integrations",className:"space-y-4",children:e.jsx(Wc,{})}),e.jsx(_t,{value:"about",className:"space-y-4",children:e.jsx(Gc,{})})]})})]})}const Zc=new Yi({defaultOptions:{queries:{staleTime:300*1e3,gcTime:600*1e3,retry:(r,t)=>t?.code===401||t?.code===403?!1:r<3,refetchOnWindowFocus:!1,refetchOnMount:!0,refetchOnReconnect:!0},mutations:{retry:(r,t)=>t?.code===401||t?.code===403?!1:r<2}}}),ed=Gi([{path:"/login",element:e.jsx(Cl,{})},{path:"/register",element:e.jsx(Pl,{})},{path:"/",element:e.jsx(Je,{children:e.jsx(Ge,{children:e.jsx(Ll,{})})})},{path:"/purchases",element:e.jsx(Je,{children:e.jsx(Ge,{children:e.jsx(Ul,{})})})},{path:"/tasks",element:e.jsx(Je,{children:e.jsx(Ge,{children:e.jsx(Bl,{})})})},{path:"/status",element:e.jsx(Je,{children:e.jsx(Ge,{children:e.jsx(Hl,{})})})},{path:"/sales",element:e.jsx(Je,{children:e.jsx(Ge,{children:e.jsx(zl,{})})})},{path:"/sales/units",element:e.jsx(Je,{children:e.jsx(Ge,{children:e.jsx(Ql,{})})})},{path:"/sales/records",element:e.jsx(Je,{children:e.jsx(Ge,{children:e.jsx(Yl,{})})})},{path:"/master",element:e.jsx(Je,{children:e.jsx(Ge,{children:e.jsx(Wl,{})})})},{path:"/master/stocks",element:e.jsx(Je,{children:e.jsx(Ge,{children:e.jsx(Xl,{})})})},{path:"/master/vendors",element:e.jsx(Je,{children:e.jsx(Ge,{children:e.jsx(Zl,{})})})},{path:"/master/staff",element:e.jsx(Je,{children:e.jsx(Ge,{children:e.jsx(ec,{})})})},{path:"/master/processes",element:e.jsx(Je,{children:e.jsx(Ge,{children:e.jsx(tc,{})})})},{path:"/master/raw-products",element:e.jsx(Je,{children:e.jsx(Ge,{children:e.jsx(sc,{})})})},{path:"/master/products",element:e.jsx(Je,{children:e.jsx(Ge,{children:e.jsx(ac,{})})})},{path:"/master/sales-channels",element:e.jsx(Je,{children:e.jsx(Ge,{children:e.jsx(rc,{})})})},{path:"/analytics",element:e.jsx(Je,{children:e.jsx(Ge,{children:e.jsx(Gl,{})})})},{path:"/status/stock-status",element:e.jsx(Je,{children:e.jsx(Ge,{children:e.jsx(ic,{})})})},{path:"/status/pre-production-status",element:e.jsx(Je,{children:e.jsx(Ge,{children:e.jsx(oc,{})})})},{path:"/status/production-status",element:e.jsx(Je,{children:e.jsx(Ge,{children:e.jsx(lc,{})})})},{path:"/status/post-production-status",element:e.jsx(Je,{children:e.jsx(Ge,{children:e.jsx(dc,{})})})},{path:"/status/inventory-status",element:e.jsx(Je,{children:e.jsx(Ge,{children:e.jsx(uc,{})})})},{path:"/tasks/pre-production",element:e.jsx(Je,{children:e.jsx(Ge,{children:e.jsx(xc,{})})})},{path:"/tasks/production",element:e.jsx(Je,{children:e.jsx(Ge,{children:e.jsx(yc,{})})})},{path:"/tasks/post-production",element:e.jsx(Je,{children:e.jsx(Ge,{children:e.jsx(Nc,{})})})},{path:"/settings",element:e.jsx(Je,{children:e.jsx(Ge,{children:e.jsx(Xc,{})})})},{path:"*",element:e.jsx(Jl,{})}],{future:{v7_startTransition:!0}}),td=()=>e.jsx(Wi,{client:Zc,children:e.jsx(jo,{children:e.jsx(Lo,{children:e.jsxs(jn,{children:[e.jsx(mo,{}),e.jsx(ho,{}),e.jsx(Bo,{}),e.jsx(Ji,{router:ed,future:{v7_startTransition:!0}})]})})})});Yn.createRoot(document.getElementById("root")).render(e.jsx(td,{}));

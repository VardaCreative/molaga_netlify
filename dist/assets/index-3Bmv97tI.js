import{r as p,j as e,b as et,k as Kn}from"./0-react-core-CTNHgvAJ.js";import{V as dr,R as ur,A as mr,C as pr,X as _s,T as hr,D as xr,P as Vn,j as Bn,$ as Hn,a as gr,b as zn,c as Qn,d as Yn,S as Ds,W as Wn,e as qa,f as hs,g as fr,O as ca,h as jr,i as da,k as yr,l as ua,m as ma,n as vr,o as Gn,H as Jn,p as Aa,q as Fa,r as Hs,s as br,t as Sa,u as Ia,v as Nr,w as wr,x as Sr,y as Xn,z as _r,I as kr,B as Cr,E as Pr,F as Tr,G as Dr,J as Zn,L as Er,K as Rr,M as ei,N as ti,Q as qr,U as Ar,Y as si,Z as ai,_ as Ve,a0 as Fr,a1 as Ir,a2 as Es,a3 as ri,a4 as ni,a5 as Ot,a6 as Et,a7 as _a,a8 as Jt,a9 as ka,aa as $r,ab as ii,ac as ks,ad as Lr,ae as Yt,af as oi,ag as ra,ah as is,ai as Qa,aj as Mr,ak as li,al as ci,am as Or,an as di,ao as pt,ap as ts,aq as Ya,ar as ui,as as mi,at as pi,au as $t,av as ss,aw as Ur,ax as Kr,ay as hi,az as $a,aA as Vr,aB as xi,aC as Br,aD as gi,aE as Hr,aF as fi,aG as zr,aH as Qr,aI as ji,aJ as yi,aK as Yr,aL as vi,aM as bi,aN as Tt,aO as Wr,aP as Ni,aQ as wi,aR as Si,aS as _i,aT as Gr,aU as ki,aV as Ci,aW as Jr,aX as Xr,aY as Pi,aZ as Ti,a_ as Di,a$ as Ei,b0 as La,b1 as Zr,b2 as en,b3 as tn,b4 as Ri,b5 as Wa,b6 as pa,b7 as qi,b8 as Qs,b9 as Ks,ba as Ma,bb as sn,bc as Ai,bd as na,be as Fi,bf as an,bg as Ii,bh as Ca,bi as Pa,bj as Gs,bk as $i,bl as Li,bm as Ta,bn as Mi,bo as Oi}from"./1-ui-libs-BpjiZ-VE.js";import{t as Ui,q as Ki,r as xs,u as Vi}from"./9-vendor-CWobMp5c.js";import{u as fe,a as ut,b as De,Q as Bi}from"./2-react-query-BDX7x6OE.js";import{u as cs,N as fa,a as Rs,b as Oa,L as At,c as Hi,R as zi}from"./2-react-router-DJ5FTyjX.js";import{C as Qi,A as Yi,D as Wi,I as ps,Q as Ze}from"./9-appwrite-Di8VTjYU.js";import{F as Ga,P as Is,G as $s,e as Zt,s as es,H as ja,o as ct,j as Vs,I as Kt}from"./9-utils-CXq3ZHxZ.js";import{u as St,w as Ja,r as Gi,a as Ji}from"./9-xlsx-eYdzo_tC.js";import"./2-react-deps-DlpLfDCO.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function s(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(n){if(n.ep)return;n.ep=!0;const i=s(n);fetch(n.href,i)}})();const Xi=1,Zi=1e6;let ya=0;function eo(){return ya=(ya+1)%Number.MAX_SAFE_INTEGER,ya.toString()}const va=new Map,Xa=r=>{if(va.has(r))return;const t=setTimeout(()=>{va.delete(r),Us({type:"REMOVE_TOAST",toastId:r})},Zi);va.set(r,t)},to=(r,t)=>{switch(t.type){case"ADD_TOAST":return{...r,toasts:[t.toast,...r.toasts].slice(0,Xi)};case"UPDATE_TOAST":return{...r,toasts:r.toasts.map(s=>s.id===t.toast.id?{...s,...t.toast}:s)};case"DISMISS_TOAST":{const{toastId:s}=t;return s?Xa(s):r.toasts.forEach(a=>{Xa(a.id)}),{...r,toasts:r.toasts.map(a=>a.id===s||s===void 0?{...a,open:!1}:a)}}case"REMOVE_TOAST":return t.toastId===void 0?{...r,toasts:[]}:{...r,toasts:r.toasts.filter(s=>s.id!==t.toastId)}}},Js=[];let Xs={toasts:[]};function Us(r){Xs=to(Xs,r),Js.forEach(t=>{t(Xs)})}function so({...r}){const t=eo(),s=n=>Us({type:"UPDATE_TOAST",toast:{...n,id:t}}),a=()=>Us({type:"DISMISS_TOAST",toastId:t});return Us({type:"ADD_TOAST",toast:{...r,id:t,open:!0,onOpenChange:n=>{n||a()}}}),{id:t,dismiss:a,update:s}}function Fe(){const[r,t]=p.useState(Xs);return p.useEffect(()=>(Js.push(t),()=>{const s=Js.indexOf(t);s>-1&&Js.splice(s,1)}),[r]),{...r,toast:so,dismiss:s=>Us({type:"DISMISS_TOAST",toastId:s})}}function ie(...r){return Ui(Ki(r))}const ao=Vn,rn=p.forwardRef(({className:r,...t},s)=>e.jsx(dr,{ref:s,className:ie("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",r),...t}));rn.displayName=dr.displayName;const ro=xs("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),nn=p.forwardRef(({className:r,variant:t,...s},a)=>e.jsx(ur,{ref:a,className:ie(ro({variant:t}),r),...s}));nn.displayName=ur.displayName;const no=p.forwardRef(({className:r,...t},s)=>e.jsx(mr,{ref:s,className:ie("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors group-[.destructive]:border-muted/40 hover:bg-secondary group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 group-[.destructive]:focus:ring-destructive disabled:pointer-events-none disabled:opacity-50",r),...t}));no.displayName=mr.displayName;const on=p.forwardRef(({className:r,...t},s)=>e.jsx(pr,{ref:s,className:ie("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity group-hover:opacity-100 group-[.destructive]:text-red-300 hover:text-foreground group-[.destructive]:hover:text-red-50 focus:opacity-100 focus:outline-none focus:ring-2 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",r),"toast-close":"",...t,children:e.jsx(_s,{className:"h-4 w-4"})}));on.displayName=pr.displayName;const ln=p.forwardRef(({className:r,...t},s)=>e.jsx(hr,{ref:s,className:ie("text-sm font-semibold",r),...t}));ln.displayName=hr.displayName;const cn=p.forwardRef(({className:r,...t},s)=>e.jsx(xr,{ref:s,className:ie("text-sm opacity-90",r),...t}));cn.displayName=xr.displayName;function io(){const{toasts:r}=Fe();return e.jsxs(ao,{children:[r.map(function({id:t,title:s,description:a,action:n,...i}){return e.jsxs(nn,{...i,children:[e.jsxs("div",{className:"grid gap-1",children:[s&&e.jsx(ln,{children:s}),a&&e.jsx(cn,{children:a})]}),n,e.jsx(on,{})]},t)}),e.jsx(rn,{})]})}const oo=({...r})=>{const{theme:t="system"}=Bn();return e.jsx(Hn,{theme:t,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...r})},dn=zn,lo=Qn,co=Yn,un=p.forwardRef(({className:r,sideOffset:t=4,...s},a)=>e.jsx(gr,{ref:a,sideOffset:t,className:ie("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...s}));un.displayName=gr.displayName;const be={PRE_PRODUCTION_STATUS:"pre_production_status",PRODUCTION_STATUS:"production_status",POST_PRODUCTION_STATUS:"post_production_status",INVENTORY_STATUS:"inventory_status",STOCK_STATUS:"stock_status",TASKS:"tasks",PRE_PRODUCTION_TASKS:"pre_production_tasks",PRODUCTION_TASKS:"production_tasks",PRODUCTION_TASK_ITEMS:"production_task_items",POST_PRODUCTION_TASKS:"post_production_tasks",STOCKS:"stocks",RAW_PRODUCTS:"raw_products",VENDORS:"vendors",STAFF:"staff",PROCESSES:"processes",PRODUCTS:"products",SALES_CHANNELS:"sales_channels",PURCHASES:"purchases",SALES_ORDERS:"sales_orders",SALES_ORDER_ITEMS:"sales_order_items",SALES_UNITS:"sales_units",SALES_RECORDS:"sales_records"},uo="https://fra.cloud.appwrite.io/v1",mo="68cb76af00043a1c3b77",ha=new Qi;ha.setEndpoint(uo);ha.setProject(mo);const tt=new Wi(ha),Vt=new Yi(ha),st="68cb77a000339977dcb0",mn=p.createContext(void 0),ft=()=>{const r=p.useContext(mn);if(r===void 0)throw new Error("useAuth must be used within an AuthProvider");return r},po=({children:r})=>{const[t,s]=p.useState(null),[a,n]=p.useState(!0);p.useEffect(()=>{i()},[]);const i=async()=>{try{if(window.self!==window.top){console.log("Running in iframe environment (preview mode)");const v=localStorage.getItem("appwrite-auth-user");if(v)try{const _=JSON.parse(v);s(_),console.log("Using stored user data in iframe:",_.email),n(!1);return}catch{console.log("Invalid stored user data, clearing..."),localStorage.removeItem("appwrite-auth-user")}}const N=await Vt.get();s(N),localStorage.setItem("appwrite-auth-user",JSON.stringify(N)),console.log("Authenticated user:",N.email)}catch(y){s(null),localStorage.removeItem("appwrite-auth-user"),console.error("Authentication check failed:",{code:y.code,message:y.message,type:y.type,response:y.response,isInIframe:window.self!==window.top}),y.code===401?console.log("Session expired or invalid, user needs to login again"):console.log("Not authenticated:",y.message)}finally{n(!1)}},c=async(y,N)=>{try{await Vt.createEmailPasswordSession(y,N);const v=await Vt.get();s(v),localStorage.setItem("appwrite-auth-user",JSON.stringify(v)),console.log("Successfully authenticated user:",v.email)}catch(v){throw console.error("Authentication error:",v.message),v}},m={user:t,login:c,register:async(y,N,v)=>{try{await Vt.create("unique()",y,N,v),await c(y,N)}catch(_){throw _}},loginWithGoogle:async()=>{try{Vt.createOAuth2Session("google",`${window.location.origin}/`,`${window.location.origin}/login`)}catch(y){throw y}},logout:async()=>{try{await Vt.deleteSession("current"),s(null),localStorage.removeItem("appwrite-auth-user"),console.log("Successfully logged out")}catch(y){console.error("Logout error:",y.message),s(null),localStorage.removeItem("appwrite-auth-user")}},loading:a};return e.jsx(mn.Provider,{value:m,children:r})};class oe{static field(t){return new ho(t)}static PATTERNS={EMAIL:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,PHONE:/^[\+]?[1-9][\d]{0,15}$/,PHONE_INTERNATIONAL:/^\+?[1-9]\d{1,14}$/,PHONE_US:/^(\+1|1)?[-.\s]?\(?[0-9]{3}\)?[-.\s]?[0-9]{3}[-.\s]?[0-9]{4}$/,URL:/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)$/,ALPHANUMERIC:/^[a-zA-Z0-9]+$/,ALPHA:/^[a-zA-Z]+$/,NUMERIC:/^[0-9]+$/,DECIMAL:/^[0-9]+(\.[0-9]+)?$/,DATE_ISO:/^\d{4}-\d{2}-\d{2}$/,DATE_US:/^(0[1-9]|1[0-2])\/(0[1-9]|[12][0-9]|3[01])\/\d{4}$/,TIME_24H:/^([01]?[0-9]|2[0-3]):[0-5][0-9]$/,TIME_12H:/^(0?[1-9]|1[0-2]):[0-5][0-9]\s?(AM|PM|am|pm)$/,SKU:/^[A-Z0-9\-_]+$/,CURRENCY:/^\$?[0-9]+(\.[0-9]{2})?$/};static COMMON_RULES={email:()=>({field:"email",type:"format",options:{pattern:oe.PATTERNS.EMAIL},message:"Invalid email format"}),phone:()=>({field:"phone",type:"format",options:{pattern:oe.PATTERNS.PHONE},message:"Invalid phone number format"}),currency:()=>({field:"amount",type:"format",options:{pattern:oe.PATTERNS.CURRENCY},message:"Invalid currency format (e.g., 123.45 or $123.45)"}),sku:()=>({field:"sku",type:"format",options:{pattern:oe.PATTERNS.SKU},message:"SKU must contain only uppercase letters, numbers, hyphens, and underscores"}),positiveNumber:t=>({field:t,type:"range",options:{min:0},message:"Value must be a positive number"}),percentage:t=>({field:t,type:"range",options:{min:0,max:100},message:"Percentage must be between 0 and 100"})};static isValidEmail(t){return this.PATTERNS.EMAIL.test(t)}static isValidPhone(t){return this.PATTERNS.PHONE.test(t)}static isValidDate(t){if(!t)return!1;if(t instanceof Date)return!isNaN(t.getTime());if(typeof t=="number"){if(t>1&&t<3e6){const s=new Date(1900,0,1),a=new Date(s.getTime()+(t-2)*864e5);return!isNaN(a.getTime())}return!1}if(typeof t=="string"){if(/^\d{4}-\d{2}-\d{2}$/.test(t.trim())){const a=new Date(t);return!isNaN(a.getTime())}const s=new Date(t);return!isNaN(s.getTime())}return!1}static isValidNumber(t,s,a){const n=Number(t);return!(isNaN(n)||s!==void 0&&n<s||a!==void 0&&n>a)}static isValidStringLength(t,s,a){return!(typeof t!="string"||s!==void 0&&t.length<s||a!==void 0&&t.length>a)}static isOneOf(t,s){return s.includes(t)}static isUnique(t,s,a,n){return a.filter((c,u)=>n!==void 0&&u===n?!1:c[s]===t).length===0}static sanitizeValue(t){if(typeof t=="string"){if(t=t.trim(),t==="")return null;t=t.replace(/[\u200B-\u200D\uFEFF]/g,""),t=t.replace(/\u00A0/g," ")}return t}static convertType(t,s){if(t==null)return null;switch(s){case"string":return String(t);case"number":const a=Number(t);return isNaN(a)?null:a;case"boolean":if(typeof t=="boolean")return t;if(typeof t=="string"){const i=t.toLowerCase();if(["true","1","yes","y","on"].includes(i))return!0;if(["false","0","no","n","off"].includes(i))return!1}return!!t;case"date":const n=new Date(t);return isNaN(n.getTime())?null:n;default:return t}}static formatErrorMessage(t,s,a){if(s.message)return s.message;switch(s.type){case"required":return`${t} is required`;case"format":return`${t} has invalid format`;case"range":return s.options?.min!==void 0&&s.options?.max!==void 0?`${t} must be between ${s.options.min} and ${s.options.max}`:s.options?.min!==void 0?`${t} must be at least ${s.options.min}`:s.options?.max!==void 0?`${t} must be at most ${s.options.max}`:`${t} is out of range`;case"unique":return`${t} must be unique (duplicate value: ${a})`;default:return`${t} validation failed`}}static createRulesForDataType(t,s,a=!1){const n=[];switch(a&&n.push({field:t,type:"required",message:`${t} is required`}),s.toLowerCase()){case"email":n.push(this.COMMON_RULES.email());break;case"phone":n.push(this.COMMON_RULES.phone());break;case"currency":case"money":n.push(this.COMMON_RULES.currency());break;case"sku":n.push(this.COMMON_RULES.sku());break;case"percentage":n.push(this.COMMON_RULES.percentage(t));break;case"positive_number":n.push(this.COMMON_RULES.positiveNumber(t));break;case"date":n.push({field:t,type:"custom",validator:i=>this.isValidDate(i),message:"Invalid date format"});break;case"url":n.push({field:t,type:"format",options:{pattern:this.PATTERNS.URL},message:"Invalid URL format"});break}return n}static createForeignKeyRule(t,s,a="id",n){return{field:t,type:"custom",validator:i=>i?s.some(c=>c[a]===i):!0,message:n||`${t} must reference a valid ${a}`}}static createConditionalRule(t,s,a){return{...a,field:t,validator:(n,i)=>{if(!s(i))return!0;if(a.validator)return a.validator(n,i);switch(a.type){case"required":return n!=null&&n!=="";case"format":return a.options?.pattern?a.options.pattern.test(String(n)):!0;default:return!0}}}}}class ho{constructor(t){this.field=t,this.rule={field:t}}rule;required(){return this.rule.type="required",this.rule.message=`${this.field} is required`,this}email(){return this.rule.type="format",this.rule.options={pattern:oe.PATTERNS.EMAIL},this.rule.message="Invalid email format",this}phone(){return this.rule.type="format",this.rule.options={pattern:oe.PATTERNS.PHONE},this.rule.message="Invalid phone number format",this}number(t,s){return this.rule.type="range",this.rule.options={min:t,max:s},t!==void 0&&s!==void 0?this.rule.message=`Must be between ${t} and ${s}`:t!==void 0?this.rule.message=`Must be at least ${t}`:s!==void 0&&(this.rule.message=`Must be at most ${s}`),this}string(t,s){return this.rule.type="custom",this.rule.validator=a=>oe.isValidStringLength(String(a),t,s),t!==void 0&&s!==void 0?this.rule.message=`Must be between ${t} and ${s} characters`:t!==void 0?this.rule.message=`Must be at least ${t} characters`:s!==void 0&&(this.rule.message=`Must be at most ${s} characters`),this}date(){return this.rule.type="custom",this.rule.validator=t=>oe.isValidDate(t),this.rule.message="Invalid date format",this}boolean(){return this.rule.type="custom",this.rule.validator=t=>{if(typeof t=="boolean")return!0;if(typeof t=="string"){const s=t.toLowerCase();return["true","false","1","0","yes","no","y","n"].includes(s)}return!1},this.rule.message="Must be a valid boolean value (true/false, yes/no, 1/0)",this}oneOf(t){return this.rule.type="custom",this.rule.validator=s=>oe.isOneOf(s,t),this.rule.message=`Must be one of: ${t.join(", ")}`,this}pattern(t,s){return this.rule.type="format",this.rule.options={pattern:t},this.rule.message=s||"Invalid format",this}unique(){return this.rule.type="unique",this.rule.message=`${this.field} must be unique`,this}custom(t,s){return this.rule.type="custom",this.rule.validator=(a,n,i)=>{const c={row:n||{},rowNumber:n&&n._rowNumber||0,allData:i||[],fieldName:this.field};return t(a,c)},this.rule.message=s||"Custom validation failed",this}build(){return this.rule}}const xo=r=>{try{if(!r)return"No Date";const t=new Date(r);if(isNaN(t.getTime()))return console.warn("Invalid date value:",r),"Invalid Date";const s=String(t.getDate()).padStart(2,"0"),a=String(t.getMonth()+1).padStart(2,"0"),n=t.getFullYear();return`${s}/${a}/${n}`}catch(t){return console.error("Date formatting error:",t,"Input:",r),"Invalid Date"}},xa=r=>{try{if(!r)return console.warn("formatTableDate: Empty date value received"),"No Date";if(r==="Invalid Date"||r==="NaN")return console.warn("formatTableDate: Invalid date string received:",r),"Invalid Date";let t;if(typeof r=="string"&&/^\d{2}\/\d{2}\/\d{4}$/.test(r)){const[c,u,d]=r.split("/");t=new Date(`${d}-${u}-${c}`)}else t=new Date(r);if(isNaN(t.getTime()))return console.warn("formatTableDate: Could not parse date:",r,"Type:",typeof r),"Invalid Date";const s=String(t.getDate()).padStart(2,"0"),a=String(t.getMonth()+1).padStart(2,"0"),n=t.getFullYear(),i=`${s}/${a}/${n}`;return console.log("ðŸ“… formatTableDate:",{input:r,output:i}),i}catch(t){return console.error("formatTableDate: Error formatting date:",t,"Input:",r),"Invalid Date"}},gs=r=>xo(r),go={pageName:"stocks",exportEnabled:!0,importEnabled:!0,sortableColumns:["name","sku","category","unit","openingBalance","createdAt"],exportColumns:[{dataKey:"name",exportHeader:"Stock Name",required:!0},{dataKey:"sku",exportHeader:"SKU",required:!0},{dataKey:"category",exportHeader:"Category"},{dataKey:"unit",exportHeader:"Unit",required:!0},{dataKey:"openingBalance",exportHeader:"Opening Balance",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"description",exportHeader:"Description"},{dataKey:"createdAt",exportHeader:"Created Date",dataType:"date",formatter:r=>gs(r)}],importValidation:[oe.field("name").required().string(1,100).build(),oe.field("sku").required().pattern(oe.PATTERNS.SKU).build(),oe.field("unit").required().oneOf(["kg","g","l","ml","pcs","box","pack"]).build(),oe.field("openingBalance").number(0).build(),oe.field("category").string(0,50).build()],tableColumns:[{key:"name",label:"Stock Name",sortable:!0,dataType:"string"},{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"category",label:"Category",sortable:!0,dataType:"string"},{key:"unit",label:"Unit",sortable:!0,dataType:"string"},{key:"openingBalance",label:"Opening Balance",sortable:!0,dataType:"number",align:"right"},{key:"createdAt",label:"Created",sortable:!0,dataType:"date"}]},fo={pageName:"products",exportEnabled:!0,importEnabled:!0,sortableColumns:["name","sku","category","price","createdAt"],exportColumns:[{dataKey:"name",exportHeader:"Product Name",required:!0},{dataKey:"sku",exportHeader:"SKU",required:!0},{dataKey:"category",exportHeader:"Category"},{dataKey:"price",exportHeader:"Price",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"description",exportHeader:"Description"},{dataKey:"isActive",exportHeader:"Active",dataType:"boolean",formatter:r=>r?"Yes":"No"},{dataKey:"createdAt",exportHeader:"Created Date",dataType:"date",formatter:r=>gs(r)}],importValidation:[oe.field("name").required().string(1,100).build(),oe.field("sku").required().pattern(oe.PATTERNS.SKU).build(),oe.field("price").number(0).build(),oe.field("category").string(0,50).build(),oe.field("isActive").boolean().build()],tableColumns:[{key:"name",label:"Product Name",sortable:!0,dataType:"string"},{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"category",label:"Category",sortable:!0,dataType:"string"},{key:"price",label:"Price",sortable:!0,dataType:"number",align:"right"},{key:"isActive",label:"Active",sortable:!0,dataType:"boolean"},{key:"createdAt",label:"Created",sortable:!0,dataType:"date"}]},jo={pageName:"raw-products",exportEnabled:!0,importEnabled:!0,sortableColumns:["name","sku","unit","costPerUnit","createdAt"],exportColumns:[{dataKey:"name",exportHeader:"Raw Product Name",required:!0},{dataKey:"sku",exportHeader:"SKU",required:!0},{dataKey:"unit",exportHeader:"Unit",required:!0},{dataKey:"costPerUnit",exportHeader:"Cost Per Unit",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"description",exportHeader:"Description"},{dataKey:"createdAt",exportHeader:"Created Date",dataType:"date",formatter:r=>gs(r)}],importValidation:[oe.field("name").required().string(1,100).build(),oe.field("sku").required().pattern(oe.PATTERNS.SKU).build(),oe.field("unit").required().oneOf(["kg","g","l","ml","pcs","box","pack"]).build(),oe.field("costPerUnit").number(0).build()],tableColumns:[{key:"name",label:"Raw Product Name",sortable:!0,dataType:"string"},{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"unit",label:"Unit",sortable:!0,dataType:"string"},{key:"costPerUnit",label:"Cost Per Unit",sortable:!0,dataType:"number",align:"right"},{key:"createdAt",label:"Created",sortable:!0,dataType:"date"}]},yo={pageName:"staff",exportEnabled:!0,importEnabled:!0,sortableColumns:["name","email","phone","role","isActive","createdAt"],exportColumns:[{dataKey:"name",exportHeader:"Staff Name",required:!0},{dataKey:"email",exportHeader:"Email",required:!0},{dataKey:"phone",exportHeader:"Phone"},{dataKey:"role",exportHeader:"Role",required:!0},{dataKey:"department",exportHeader:"Department"},{dataKey:"isActive",exportHeader:"Active",dataType:"boolean",formatter:r=>r?"Yes":"No"},{dataKey:"createdAt",exportHeader:"Created Date",dataType:"date",formatter:r=>gs(r)}],importValidation:[oe.field("name").required().string(1,100).build(),oe.field("email").required().email().build(),oe.field("phone").phone().build(),oe.field("role").required().oneOf(["admin","manager","operator","viewer"]).build(),oe.field("department").string(0,50).build(),oe.field("isActive").boolean().build()],tableColumns:[{key:"name",label:"Staff Name",sortable:!0,dataType:"string"},{key:"email",label:"Email",sortable:!0,dataType:"string"},{key:"phone",label:"Phone",sortable:!0,dataType:"string"},{key:"role",label:"Role",sortable:!0,dataType:"string"},{key:"isActive",label:"Active",sortable:!0,dataType:"boolean"},{key:"createdAt",label:"Created",sortable:!0,dataType:"date"}]},vo={pageName:"vendors",exportEnabled:!0,importEnabled:!0,sortableColumns:["name","email","phone","contactPerson","isActive","createdAt"],exportColumns:[{dataKey:"name",exportHeader:"Vendor Name",required:!0},{dataKey:"email",exportHeader:"Email"},{dataKey:"phone",exportHeader:"Phone"},{dataKey:"contactPerson",exportHeader:"Contact Person"},{dataKey:"address",exportHeader:"Address"},{dataKey:"isActive",exportHeader:"Active",dataType:"boolean",formatter:r=>r?"Yes":"No"},{dataKey:"createdAt",exportHeader:"Created Date",dataType:"date",formatter:r=>gs(r)}],importValidation:[oe.field("name").required().string(1,100).build(),oe.field("email").email().build(),oe.field("phone").phone().build(),oe.field("contactPerson").string(0,100).build(),oe.field("address").string(0,200).build(),oe.field("isActive").boolean().build()],tableColumns:[{key:"name",label:"Vendor Name",sortable:!0,dataType:"string"},{key:"email",label:"Email",sortable:!0,dataType:"string"},{key:"phone",label:"Phone",sortable:!0,dataType:"string"},{key:"contactPerson",label:"Contact Person",sortable:!0,dataType:"string"},{key:"isActive",label:"Active",sortable:!0,dataType:"boolean"},{key:"createdAt",label:"Created",sortable:!0,dataType:"date"}]},bo={pageName:"processes",exportEnabled:!0,importEnabled:!0,sortableColumns:["name","description","estimatedTime","isActive","createdAt"],exportColumns:[{dataKey:"name",exportHeader:"Process Name",required:!0},{dataKey:"description",exportHeader:"Description"},{dataKey:"estimatedTime",exportHeader:"Estimated Time (minutes)",dataType:"number"},{dataKey:"isActive",exportHeader:"Active",dataType:"boolean",formatter:r=>r?"Yes":"No"},{dataKey:"createdAt",exportHeader:"Created Date",dataType:"date",formatter:r=>gs(r)}],importValidation:[oe.field("name").required().string(1,100).build(),oe.field("description").string(0,500).build(),oe.field("estimatedTime").number(0).build(),oe.field("isActive").boolean().build()],tableColumns:[{key:"name",label:"Process Name",sortable:!0,dataType:"string"},{key:"description",label:"Description",sortable:!0,dataType:"string"},{key:"estimatedTime",label:"Est. Time (min)",sortable:!0,dataType:"number",align:"right"},{key:"isActive",label:"Active",sortable:!0,dataType:"boolean"},{key:"createdAt",label:"Created",sortable:!0,dataType:"date"}]},No={pageName:"sales-channels",exportEnabled:!0,importEnabled:!0,sortableColumns:["name","type","commission","isActive","createdAt"],exportColumns:[{dataKey:"name",exportHeader:"Channel Name",required:!0},{dataKey:"type",exportHeader:"Type",required:!0},{dataKey:"commission",exportHeader:"Commission (%)",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"description",exportHeader:"Description"},{dataKey:"isActive",exportHeader:"Active",dataType:"boolean",formatter:r=>r?"Yes":"No"},{dataKey:"createdAt",exportHeader:"Created Date",dataType:"date",formatter:r=>gs(r)}],importValidation:[oe.field("name").required().string(1,100).build(),oe.field("type").required().oneOf(["online","retail","wholesale","distributor"]).build(),oe.field("commission").number(0,100).build(),oe.field("description").string(0,500).build(),oe.field("isActive").boolean().build()],tableColumns:[{key:"name",label:"Channel Name",sortable:!0,dataType:"string"},{key:"type",label:"Type",sortable:!0,dataType:"string"},{key:"commission",label:"Commission (%)",sortable:!0,dataType:"number",align:"right"},{key:"isActive",label:"Active",sortable:!0,dataType:"boolean"},{key:"createdAt",label:"Created",sortable:!0,dataType:"date"}]},wo={pageName:"sales-units",exportEnabled:!0,importEnabled:!0,sortableColumns:["date","productName","sku","units","status","remarks"],exportColumns:[{dataKey:"date",exportHeader:"Date",dataType:"date",formatter:r=>new Date(r).toLocaleDateString("en-GB")},{dataKey:"productName",exportHeader:"Product",required:!0},{dataKey:"sku",exportHeader:"SKU",required:!0},{dataKey:"units",exportHeader:"Units",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"status",exportHeader:"Status"},{dataKey:"remarks",exportHeader:"Remarks"}],importValidation:[oe.field("date").required().date().build(),oe.field("productName").required().string(1,100).build(),oe.field("sku").required().string(1,50).build(),oe.field("units").required().number(.01).build(),oe.field("status").string(0,50).build(),oe.field("remarks").string(0,500).build()],tableColumns:[{key:"date",label:"Date",sortable:!0,dataType:"date"},{key:"productName",label:"Product",sortable:!0,dataType:"string"},{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"units",label:"Units",sortable:!0,dataType:"number",align:"right"},{key:"status",label:"Status",sortable:!0,dataType:"string"},{key:"remarks",label:"Remarks",sortable:!0,dataType:"string"}]},So={pageName:"sales-record",exportEnabled:!0,importEnabled:!0,sortableColumns:["date","channelName","productName","sku","qty","rate","totalAmount","status","remarks"],exportColumns:[{dataKey:"date",exportHeader:"Date",dataType:"date",formatter:r=>new Date(r).toLocaleDateString("en-GB")},{dataKey:"channelName",exportHeader:"Sales Channel",required:!0},{dataKey:"productName",exportHeader:"Product",required:!0},{dataKey:"sku",exportHeader:"SKU",required:!0},{dataKey:"qty",exportHeader:"Qty",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"rate",exportHeader:"Rate",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"totalAmount",exportHeader:"Total Amount",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"status",exportHeader:"Status"},{dataKey:"remarks",exportHeader:"Remarks"}],importValidation:[oe.field("date").required().date().build(),oe.field("channelName").required().string(1,100).build(),oe.field("productName").required().string(1,100).build(),oe.field("sku").required().string(1,50).build(),oe.field("qty").required().number(.01).build(),oe.field("rate").required().number(.01).build(),oe.field("remarks").string(0,500).build()],tableColumns:[{key:"date",label:"Date",sortable:!0,dataType:"date"},{key:"channelName",label:"Sales Channel",sortable:!0,dataType:"string"},{key:"productName",label:"Product",sortable:!0,dataType:"string"},{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"qty",label:"Qty",sortable:!0,dataType:"number",align:"right"},{key:"rate",label:"Rate",sortable:!0,dataType:"number",align:"right"},{key:"totalAmount",label:"Total Amount",sortable:!0,dataType:"number",align:"right"},{key:"status",label:"Status",sortable:!0,dataType:"string"},{key:"remarks",label:"Remarks",sortable:!0,dataType:"string"}]},_o={pageName:"purchases",exportEnabled:!0,importEnabled:!0,sortableColumns:["purchaseCode","date","vendorName","stockName","quantity","rate","totalAmount","status"],exportColumns:[{dataKey:"purchaseCode",exportHeader:"Purchase Code",required:!0},{dataKey:"date",exportHeader:"Date",dataType:"date",formatter:r=>new Date(r).toLocaleDateString("en-GB")},{dataKey:"vendorName",exportHeader:"Vendor Name",required:!0},{dataKey:"stockName",exportHeader:"Stock Name",required:!0},{dataKey:"quantity",exportHeader:"Quantity",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"rate",exportHeader:"Rate",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"totalAmount",exportHeader:"Total Amount",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"status",exportHeader:"Status"}],importValidation:[oe.field("purchaseCode").required().string(1,50).build(),oe.field("date").required().date().build(),oe.field("vendorName").required().string(1,100).build(),oe.field("stockName").required().string(1,100).build(),oe.field("quantity").required().number(.01).build(),oe.field("rate").required().number(.01).build(),oe.field("totalAmount").number(.01).build(),oe.field("status").string(0,50).build()],tableColumns:[{key:"purchaseCode",label:"Purchase Code",sortable:!0,dataType:"string"},{key:"date",label:"Date",sortable:!0,dataType:"date"},{key:"vendorName",label:"Vendor Name",sortable:!0,dataType:"string"},{key:"stockName",label:"Stock Name",sortable:!0,dataType:"string"},{key:"quantity",label:"Quantity",sortable:!0,dataType:"number",align:"right"},{key:"unitPrice",label:"Unit Price",sortable:!0,dataType:"number",align:"right"},{key:"totalAmount",label:"Total",sortable:!0,dataType:"number",align:"right"},{key:"purchaseDate",label:"Purchase Date",sortable:!0,dataType:"date"},{key:"vendorName",label:"Vendor",sortable:!0,dataType:"string"},{key:"createdAt",label:"Created",sortable:!0,dataType:"date"}]},ko={pageName:"pre-production-tasks",exportEnabled:!0,importEnabled:!0,sortableColumns:["task_id","stock_name","stock_source","date_assigned","process_name","assigned_quantity","staff_name","date_completed","completed_quantity","wastage_quantity","status"],exportColumns:[{dataKey:"task_id",exportHeader:"Task ID",required:!0},{dataKey:"stock_name",exportHeader:"Stock Name",required:!0},{dataKey:"stock_source",exportHeader:"Stock Source"},{dataKey:"date_assigned",exportHeader:"Date Assigned",dataType:"date",formatter:r=>new Date(r).toLocaleDateString("en-GB")},{dataKey:"process_name",exportHeader:"Process",required:!0},{dataKey:"assigned_quantity",exportHeader:"Assigned Qty",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"staff_name",exportHeader:"Staff Name"},{dataKey:"date_completed",exportHeader:"Date Completed",dataType:"date",formatter:r=>r?new Date(r).toLocaleDateString("en-GB"):""},{dataKey:"completed_quantity",exportHeader:"Completed Qty",dataType:"number",formatter:r=>r?Number(r).toFixed(2):"0.00"},{dataKey:"wastage_quantity",exportHeader:"Wastage Qty",dataType:"number",formatter:r=>r?Number(r).toFixed(2):"0.00"},{dataKey:"remarks",exportHeader:"Remarks"},{dataKey:"status",exportHeader:"Status"}],importValidation:[oe.field("task_id").required().string(1,50).build(),oe.field("stock_name").required().string(1,100).build(),oe.field("assigned_quantity").required().number(.01).build(),oe.field("date_assigned").date().build(),oe.field("staff_name").string(0,100).build()],tableColumns:[{key:"task_id",label:"Task ID",sortable:!0,dataType:"string"},{key:"stock_name",label:"Stock Name",sortable:!0,dataType:"string"},{key:"stock_source",label:"Stock Source",sortable:!0,dataType:"string"},{key:"date_assigned",label:"Date Assigned",sortable:!0,dataType:"date"},{key:"process_name",label:"Process",sortable:!0,dataType:"string"},{key:"assigned_quantity",label:"Assigned Qty",sortable:!0,dataType:"number",align:"right"},{key:"staff_name",label:"Staff Name",sortable:!0,dataType:"string"},{key:"date_completed",label:"Date Completed",sortable:!0,dataType:"date"},{key:"completed_quantity",label:"Completed Qty",sortable:!0,dataType:"number",align:"right"},{key:"wastage_quantity",label:"Wastage Qty",sortable:!0,dataType:"number",align:"right"},{key:"status",label:"Status",sortable:!0,dataType:"string"}]},Co={pageName:"production-tasks",exportEnabled:!0,importEnabled:!0,sortableColumns:["task_id","date","raw_product_name","process_name","source_process_name","staff_name","assigned_quantity","completed_quantity","date_completed","wastage_quantity","status"],exportColumns:[{dataKey:"task_id",exportHeader:"Task ID",required:!0},{dataKey:"date",exportHeader:"Date",dataType:"date",formatter:r=>new Date(r).toLocaleDateString("en-GB")},{dataKey:"raw_product_name",exportHeader:"Raw Product",required:!0},{dataKey:"process_name",exportHeader:"Process",required:!0},{dataKey:"source_process_name",exportHeader:"Source Process"},{dataKey:"staff_name",exportHeader:"Staff Name"},{dataKey:"assigned_quantity",exportHeader:"Assigned Qty",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"completed_quantity",exportHeader:"Completed Qty",dataType:"number",formatter:r=>r?Number(r).toFixed(2):"0.00"},{dataKey:"date_completed",exportHeader:"Date Completed",dataType:"date",formatter:r=>r?new Date(r).toLocaleDateString("en-GB"):""},{dataKey:"wastage_quantity",exportHeader:"Wastage Qty",dataType:"number",formatter:r=>r?Number(r).toFixed(2):"0.00"},{dataKey:"status",exportHeader:"Status"}],importValidation:[oe.field("task_id").required().string(1,50).build(),oe.field("raw_product_name").required().string(1,100).build(),oe.field("process_name").required().string(1,100).build(),oe.field("assigned_quantity").required().number(.01).build(),oe.field("date").date().build(),oe.field("staff_name").string(0,100).build()],tableColumns:[{key:"task_id",label:"Task ID",sortable:!0,dataType:"string"},{key:"date",label:"Date",sortable:!0,dataType:"date"},{key:"raw_product_name",label:"Raw Product",sortable:!0,dataType:"string"},{key:"process_name",label:"Process",sortable:!0,dataType:"string"},{key:"assignedQuantity",label:"Quantity",sortable:!0,dataType:"number",align:"right"},{key:"assignedTo",label:"Assigned To",sortable:!0,dataType:"string"},{key:"status",label:"Status",sortable:!0,dataType:"string"},{key:"dueDate",label:"Due Date",sortable:!0,dataType:"date"},{key:"createdAt",label:"Created",sortable:!0,dataType:"date"}]},Po={pageName:"post-production-tasks",exportEnabled:!0,importEnabled:!0,sortableColumns:["task_id","date","date_completed","source_quantity","sku","product_name","process_name","staff_name","assigned_quantity","units","wastage_quantity","status"],exportColumns:[{dataKey:"task_id",exportHeader:"Task ID",required:!0},{dataKey:"date",exportHeader:"Date Assigned",dataType:"date",formatter:r=>new Date(r).toLocaleDateString("en-GB")},{dataKey:"date_completed",exportHeader:"Date Completed",dataType:"date",formatter:r=>r?new Date(r).toLocaleDateString("en-GB"):""},{dataKey:"source_quantity",exportHeader:"Source Qty",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"sku",exportHeader:"SKU",required:!0},{dataKey:"product_name",exportHeader:"Product",required:!0},{dataKey:"process_name",exportHeader:"Process",required:!0},{dataKey:"staff_name",exportHeader:"Staff Name"},{dataKey:"assigned_quantity",exportHeader:"Assigned Units",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"units",exportHeader:"Completed Units",dataType:"number",formatter:r=>r?Number(r).toFixed(2):"0.00"},{dataKey:"wastage_quantity",exportHeader:"Wastage Qty",dataType:"number",formatter:r=>r?Number(r).toFixed(2):"0.00"},{dataKey:"remarks",exportHeader:"Remarks"},{dataKey:"status",exportHeader:"Status"}],importValidation:[oe.field("task_id").required().string(1,50).build(),oe.field("product_name").required().string(1,100).build(),oe.field("sku").required().string(1,50).build(),oe.field("process_name").required().string(1,100).build(),oe.field("source_quantity").required().number(.01).build(),oe.field("assigned_quantity").required().number(.01).build(),oe.field("date").date().build(),oe.field("staff_name").string(0,100).build()],tableColumns:[{key:"task_id",label:"Task ID",sortable:!0,dataType:"string"},{key:"date",label:"Date Assigned",sortable:!0,dataType:"date"},{key:"date_completed",label:"Date Completed",sortable:!0,dataType:"date"},{key:"source_quantity",label:"Source Qty",sortable:!0,dataType:"number",align:"right"},{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"product_name",label:"Product",sortable:!0,dataType:"string"},{key:"process_name",label:"Process",sortable:!0,dataType:"string"},{key:"staff_name",label:"Staff Name",sortable:!0,dataType:"string"},{key:"assigned_quantity",label:"Assigned Units",sortable:!0,dataType:"number",align:"right"},{key:"units",label:"Completed Units",sortable:!0,dataType:"number",align:"right"},{key:"wastage_quantity",label:"Wastage Qty",sortable:!0,dataType:"number",align:"right"},{key:"status",label:"Status",sortable:!0,dataType:"string"}]},To={pageName:"stock-status",exportEnabled:!0,importEnabled:!1,sortableColumns:["stockName","openingBalance","purchases","sales","closingBalance"],exportColumns:[{dataKey:"stockName",exportHeader:"Stock Name"},{dataKey:"openingBalance",exportHeader:"Opening Balance",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"purchases",exportHeader:"Purchases",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"sales",exportHeader:"Sales",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"closingBalance",exportHeader:"Closing Balance",dataType:"number",formatter:r=>Number(r).toFixed(2)}],importValidation:[],tableColumns:[{key:"stockName",label:"Stock Name",sortable:!0,dataType:"string"},{key:"openingBalance",label:"Opening Balance",sortable:!0,dataType:"number",align:"right"},{key:"purchases",label:"Purchases",sortable:!0,dataType:"number",align:"right"},{key:"sales",label:"Sales",sortable:!0,dataType:"number",align:"right"},{key:"closingBalance",label:"Closing Balance",sortable:!0,dataType:"number",align:"right"}]},Do={pageName:"inventory-status",exportEnabled:!0,importEnabled:!1,sortableColumns:["stockName","openingBalance","salesUnits","soldUnits","closingBalance"],exportColumns:[{dataKey:"stockName",exportHeader:"Stock Name"},{dataKey:"openingBalance",exportHeader:"Opening Balance",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"salesUnits",exportHeader:"Sales Units",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"soldUnits",exportHeader:"Sold Units",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"closingBalance",exportHeader:"Closing Balance",dataType:"number",formatter:r=>Number(r).toFixed(2)}],importValidation:[],tableColumns:[{key:"stockName",label:"Stock Name",sortable:!0,dataType:"string"},{key:"openingBalance",label:"Opening Balance",sortable:!0,dataType:"number",align:"right"},{key:"salesUnits",label:"Sales Units",sortable:!0,dataType:"number",align:"right"},{key:"soldUnits",label:"Sold Units",sortable:!0,dataType:"number",align:"right"},{key:"closingBalance",label:"Closing Balance",sortable:!0,dataType:"number",align:"right"}]},pn={stocks:go,products:fo,"raw-products":jo,staff:yo,vendors:vo,processes:bo,"sales-channels":No,"sales-units":wo,"sales-record":So,purchases:_o,"pre-production-tasks":ko,"production-tasks":Co,"post-production-tasks":Po,"stock-status":To,"inventory-status":Do},Eo=r=>pn[r],Ro={defaultExportFormat:"xlsx",maxImportFileSize:50,defaultBatchSize:100,enableProgressTracking:!0,autoRefreshInterval:300,cacheTimeout:30,enableValidationWarnings:!0,defaultSortDirection:"asc",enableMultiSort:!1,maxExportRows:1e5,enableBackgroundExport:!0},hn=p.createContext(void 0),qo=({children:r,initialSettings:t={}})=>{const[s,a]=p.useState({}),[n,i]=p.useState({...Ro,...t}),[c,u]=p.useState(!1),[d,o]=p.useState(null);p.useEffect(()=>{try{const O=localStorage.getItem("dataManagementSettings");if(O){const ee=JSON.parse(O);i(L=>({...L,...ee}))}}catch(O){console.warn("Failed to load saved settings:",O)}},[]),p.useEffect(()=>{try{localStorage.setItem("dataManagementSettings",JSON.stringify(n))}catch(O){console.warn("Failed to save settings:",O)}},[n]),p.useEffect(()=>{if(n.autoRefreshInterval>0){const O=setInterval(()=>{m()},n.autoRefreshInterval*1e3);return()=>clearInterval(O)}},[n.autoRefreshInterval]);const m=()=>{const O=Date.now(),ee=n.cacheTimeout*60*1e3;a(L=>{const P={...L};return Object.keys(P).forEach(h=>{O-P[h].timestamp>ee&&delete P[h]}),P})},y=p.useCallback(O=>{try{const ee=s[O],L=Date.now(),P=n.cacheTimeout*60*1e3;if(ee&&L-ee.timestamp<P)return ee.config;const h=Eo(O);return h&&setTimeout(()=>{a(k=>({...k,[O]:{config:h,timestamp:L}}))},0),h}catch(ee){o(`Failed to get configuration for ${O}: ${ee instanceof Error?ee.message:"Unknown error"}`);return}},[s,n.cacheTimeout]),N=(O,ee)=>{try{const L=y(O);if(!L)throw new Error(`Configuration not found for page: ${O}`);const P={...L,...ee};a(h=>({...h,[O]:{config:P,timestamp:Date.now()}})),pn[O]=P,o(null)}catch(L){o(`Failed to update configuration for ${O}: ${L instanceof Error?L.message:"Unknown error"}`)}},v=O=>{try{a(ee=>{const L={...ee};return delete L[O],L}),o(null)}catch(ee){o(`Failed to reset configuration for ${O}: ${ee instanceof Error?ee.message:"Unknown error"}`)}},_=O=>y(O)?.exportEnabled||!1,C=O=>y(O)?.importEnabled||!1,g=O=>y(O)?.exportColumns||[],S=O=>y(O)?.tableColumns||[],D=O=>y(O)?.importValidation||[],I=O=>{i(ee=>({...ee,...O})),o(null)},E=()=>{a({}),o(null)},U={getConfig:y,updateConfig:N,resetConfig:v,canExport:_,canImport:C,getExportColumns:g,getTableColumns:S,getValidationRules:D,globalSettings:n,updateGlobalSettings:I,clearCache:E,refreshConfig:O=>{O?a(ee=>{const L={...ee};return delete L[O],L}):E(),o(null)},isLoading:c,error:d};return e.jsx(hn.Provider,{value:U,children:r})},Ua=()=>{const r=p.useContext(hn);if(r===void 0)throw new Error("useDataManagement must be used within a DataManagementProvider");return r},Rt=r=>{const{getConfig:t,updateConfig:s,resetConfig:a,canExport:n,canImport:i}=Ua(),c=t(r);return{config:c,canExport:n(r),canImport:i(r),updateConfig:u=>s(r,u),resetConfig:()=>a(r),isConfigured:!!c}},qt=r=>{const{getValidationRules:t,canImport:s,globalSettings:a}=Ua();return{validationRules:t(r),canImport:s(r),maxFileSize:a.maxImportFileSize,batchSize:a.defaultBatchSize,enableWarnings:a.enableValidationWarnings}},Ao=r=>{const{getTableColumns:t,globalSettings:s}=Ua();return{columns:t(r),defaultSortDirection:s.defaultSortDirection,enableMultiSort:s.enableMultiSort}},Da=xs("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),$=p.forwardRef(({className:r,variant:t,size:s,asChild:a=!1,...n},i)=>{const c=a?Ds:"button";return e.jsx(c,{className:ie(Da({variant:t,size:s,className:r})),ref:i,...n})});$.displayName="Button";const Fo=xs("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),He=p.forwardRef(({className:r,variant:t,...s},a)=>e.jsx("div",{ref:a,role:"alert",className:ie(Fo({variant:t}),r),...s}));He.displayName="Alert";const Io=p.forwardRef(({className:r,...t},s)=>e.jsx("h5",{ref:s,className:ie("mb-1 font-medium leading-none tracking-tight",r),...t}));Io.displayName="AlertTitle";const ze=p.forwardRef(({className:r,...t},s)=>e.jsx("div",{ref:s,className:ie("text-sm [&_p]:leading-relaxed",r),...t}));ze.displayName="AlertDescription";class $o{isDevelopment=!1;isVerbose=!1;log(...t){this.isDevelopment&&console.log(...t)}verbose(...t){this.isDevelopment&&this.isVerbose&&console.log(...t)}warn(...t){this.isDevelopment&&console.warn(...t)}error(...t){console.error(...t),this.isDevelopment}logWithContext(t,s,a){if(this.isDevelopment){const n=this.formatContext(s);console.log(`${n} ${t}`,a||"")}}performance(t,s){if(this.isDevelopment){console.time(t);const a=s();return console.timeEnd(t),a}return s()}async performanceAsync(t,s){if(this.isDevelopment){console.time(t);const a=await s();return console.timeEnd(t),a}return s()}group(t,s){this.isDevelopment&&(console.group(t),s(),console.groupEnd())}table(t){this.isDevelopment&&console.table(t)}json(t,s){this.isDevelopment&&console.log(`${t}:`,JSON.stringify(s,null,2))}assert(t,s){this.isDevelopment&&!t&&console.error(`Assertion failed: ${s}`)}formatContext(t){const s=[];return t.component&&s.push(`[${t.component}]`),t.hook&&s.push(`[${t.hook}]`),t.service&&s.push(`[${t.service}]`),s.join(" ")}}const kt=new $o;kt.performance.bind(kt);kt.performanceAsync.bind(kt);kt.group.bind(kt);kt.table.bind(kt);kt.json.bind(kt);function Lo(){const[r,t]=p.useState(null),[s,a]=p.useState(!1),[n,i]=p.useState(!1),[c,u]=p.useState(navigator.onLine),[d,o]=p.useState(!1);return p.useEffect(()=>{window.matchMedia("(display-mode: standalone)").matches&&i(!0);const N=g=>{g.preventDefault(),t(g),a(!0)},v=()=>{i(!0),a(!1),t(null)},_=()=>u(!0),C=()=>u(!1);return window.addEventListener("beforeinstallprompt",N),window.addEventListener("appinstalled",v),window.addEventListener("online",_),window.addEventListener("offline",C),"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").then(g=>{kt.log("Service Worker registered:",g),g.addEventListener("updatefound",()=>{const S=g.installing;S&&S.addEventListener("statechange",()=>{S.state==="installed"&&navigator.serviceWorker.controller&&o(!0)})})}).catch(g=>{console.error("Service Worker registration failed:",g)}),()=>{window.removeEventListener("beforeinstallprompt",N),window.removeEventListener("appinstalled",v),window.removeEventListener("online",_),window.removeEventListener("offline",C)}},[]),{isInstallable:s,isInstalled:n,isOnline:c,updateAvailable:d,installApp:async()=>{if(!r)return!1;try{await r.prompt();const{outcome:N}=await r.userChoice;return N==="accepted"?(t(null),a(!1),!0):!1}catch(N){return console.error("Error installing app:",N),!1}},updateApp:()=>{"serviceWorker"in navigator&&navigator.serviceWorker.getRegistration().then(N=>{N&&N.waiting&&(N.waiting.postMessage({type:"SKIP_WAITING"}),window.location.reload())})}}}function Mo(){const{isInstallable:r,isInstalled:t,isOnline:s,updateAvailable:a,installApp:n,updateApp:i}=Lo(),{toast:c}=Fe(),[u,d]=p.useState(!1),[o,m]=p.useState(!1);p.useEffect(()=>{if(r&&!t&&!localStorage.getItem("pwa-install-dismissed")){const C=setTimeout(()=>{d(!0)},3e4);return()=>clearTimeout(C)}},[r,t]),p.useEffect(()=>{a&&m(!0)},[a]);const y=async()=>{await n()&&(d(!1),c({title:"App installed!",description:"Molaga ERP has been added to your home screen"}))},N=()=>{d(!1),localStorage.setItem("pwa-install-dismissed","true")},v=()=>{i(),m(!1)};return s?o?e.jsx("div",{className:"fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-96 z-50",children:e.jsxs(He,{className:"bg-blue-50 border-blue-200",children:[e.jsx(qa,{className:"h-4 w-4 text-blue-600"}),e.jsx(ze,{className:"text-blue-800",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"New version available!"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx($,{size:"sm",variant:"outline",onClick:()=>m(!1),className:"h-7",children:"Later"}),e.jsx($,{size:"sm",onClick:v,className:"h-7 bg-blue-600 hover:bg-blue-700",children:"Update"})]})]})})]})}):u&&!t?e.jsx("div",{className:"fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-96 z-50",children:e.jsxs(He,{className:"bg-primary/5 border-primary/20",children:[e.jsx(hs,{className:"h-4 w-4 text-primary"}),e.jsxs(ze,{children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-foreground mb-1",children:"Install Molaga ERP"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Add to your home screen for quick access and offline use"})]}),e.jsx($,{size:"sm",variant:"ghost",onClick:N,className:"h-6 w-6 p-0",children:e.jsx(_s,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx($,{size:"sm",variant:"outline",onClick:N,className:"flex-1",children:"Not now"}),e.jsx($,{size:"sm",onClick:y,className:"flex-1 bg-primary hover:bg-primary/90",children:"Install"})]})]})]})}):null:e.jsx("div",{className:"fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-96 z-50",children:e.jsxs(He,{className:"bg-orange-50 border-orange-200",children:[e.jsx(Wn,{className:"h-4 w-4 text-orange-600"}),e.jsx(ze,{className:"text-orange-800",children:"You're offline. Some features may be limited."})]})})}const ba=768;function Oo(){const[r,t]=p.useState(void 0);return p.useEffect(()=>{const s=window.matchMedia(`(max-width: ${ba-1}px)`),a=()=>{t(window.innerWidth<ba)};return s.addEventListener("change",a),t(window.innerWidth<ba),()=>s.removeEventListener("change",a)},[]),!!r}const B=p.forwardRef(({className:r,type:t,...s},a)=>e.jsx("input",{type:t,className:ie("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:a,...s}));B.displayName="Input";const ga=p.forwardRef(({className:r,orientation:t="horizontal",decorative:s=!0,...a},n)=>e.jsx(fr,{ref:n,decorative:s,orientation:t,className:ie("shrink-0 bg-border",t==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",r),...a}));ga.displayName=fr.displayName;const Uo=vr,Ko=jr,xn=p.forwardRef(({className:r,...t},s)=>e.jsx(ca,{className:ie("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r),...t,ref:s}));xn.displayName=ca.displayName;const Vo=xs("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),gn=p.forwardRef(({side:r="right",className:t,children:s,...a},n)=>e.jsxs(Ko,{children:[e.jsx(xn,{}),e.jsxs(da,{ref:n,className:ie(Vo({side:r}),t),...a,children:[s,e.jsxs(yr,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-secondary hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[e.jsx(_s,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));gn.displayName=da.displayName;const Bo=p.forwardRef(({className:r,...t},s)=>e.jsx(ua,{ref:s,className:ie("text-lg font-semibold text-foreground",r),...t}));Bo.displayName=ua.displayName;const Ho=p.forwardRef(({className:r,...t},s)=>e.jsx(ma,{ref:s,className:ie("text-sm text-muted-foreground",r),...t}));Ho.displayName=ma.displayName;function Za({className:r,...t}){return e.jsx("div",{className:ie("animate-pulse rounded-md bg-muted",r),...t})}const zo="sidebar:state",Qo=3600*24*7,Yo="16rem",Wo="18rem",Go="3rem",Jo="b",fn=p.createContext(null);function zs(){const r=p.useContext(fn);if(!r)throw new Error("useSidebar must be used within a SidebarProvider.");return r}const jn=p.forwardRef(({defaultOpen:r=!0,open:t,onOpenChange:s,className:a,style:n,children:i,...c},u)=>{const d=Oo(),[o,m]=p.useState(!1),[y,N]=p.useState(r),v=t??y,_=p.useCallback(D=>{const I=typeof D=="function"?D(v):D;s?s(I):N(I),document.cookie=`${zo}=${I}; path=/; max-age=${Qo}`},[s,v]),C=p.useCallback(()=>d?m(D=>!D):_(D=>!D),[d,_,m]);p.useEffect(()=>{const D=I=>{I.key===Jo&&(I.metaKey||I.ctrlKey)&&(I.preventDefault(),C())};return window.addEventListener("keydown",D),()=>window.removeEventListener("keydown",D)},[C]);const g=v?"expanded":"collapsed",S=p.useMemo(()=>({state:g,open:v,setOpen:_,isMobile:d,openMobile:o,setOpenMobile:m,toggleSidebar:C}),[g,v,_,d,o,m,C]);return e.jsx(fn.Provider,{value:S,children:e.jsx(dn,{delayDuration:0,children:e.jsx("div",{style:{"--sidebar-width":Yo,"--sidebar-width-icon":Go,...n},className:ie("group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar",a),ref:u,...c,children:i})})})});jn.displayName="SidebarProvider";const yn=p.forwardRef(({side:r="left",variant:t="sidebar",collapsible:s="offcanvas",className:a,children:n,...i},c)=>{const{isMobile:u,state:d,openMobile:o,setOpenMobile:m}=zs();return s==="none"?e.jsx("div",{className:ie("flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground",a),ref:c,...i,children:n}):u?e.jsx(Uo,{open:o,onOpenChange:m,...i,children:e.jsx(gn,{"data-sidebar":"sidebar","data-mobile":"true",className:"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden",style:{"--sidebar-width":Wo},side:r,children:e.jsx("div",{className:"flex h-full w-full flex-col",children:n})})}):e.jsxs("div",{ref:c,className:"group peer hidden text-sidebar-foreground md:block","data-state":d,"data-collapsible":d==="collapsed"?s:"","data-variant":t,"data-side":r,children:[e.jsx("div",{className:ie("relative h-svh w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear","group-data-[collapsible=offcanvas]:w-0","group-data-[side=right]:rotate-180",t==="floating"||t==="inset"?"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon]")}),e.jsx("div",{className:ie("fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex",r==="left"?"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]":"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]",t==="floating"||t==="inset"?"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l",a),...i,children:e.jsx("div",{"data-sidebar":"sidebar",className:"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow",children:n})})]})});yn.displayName="Sidebar";const vn=p.forwardRef(({className:r,onClick:t,...s},a)=>{const{toggleSidebar:n}=zs();return e.jsxs($,{ref:a,"data-sidebar":"trigger",variant:"ghost",size:"icon",className:ie("h-7 w-7",r),onClick:i=>{t?.(i),n()},...s,children:[e.jsx(Gn,{}),e.jsx("span",{className:"sr-only",children:"Toggle Sidebar"})]})});vn.displayName="SidebarTrigger";const Xo=p.forwardRef(({className:r,...t},s)=>{const{toggleSidebar:a}=zs();return e.jsx("button",{ref:s,"data-sidebar":"rail","aria-label":"Toggle Sidebar",tabIndex:-1,onClick:a,title:"Toggle Sidebar",className:ie("absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] group-data-[side=left]:-right-4 group-data-[side=right]:left-0 hover:after:bg-sidebar-border sm:flex","[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize","[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize","group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar","[[data-side=left][data-collapsible=offcanvas]_&]:-right-2","[[data-side=right][data-collapsible=offcanvas]_&]:-left-2",r),...t})});Xo.displayName="SidebarRail";const Zo=p.forwardRef(({className:r,...t},s)=>e.jsx("main",{ref:s,className:ie("relative flex min-h-svh flex-1 flex-col bg-background","peer-data-[variant=inset]:min-h-[calc(100svh-theme(spacing.4))] md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow",r),...t}));Zo.displayName="SidebarInset";const el=p.forwardRef(({className:r,...t},s)=>e.jsx(B,{ref:s,"data-sidebar":"input",className:ie("h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring",r),...t}));el.displayName="SidebarInput";const tl=p.forwardRef(({className:r,...t},s)=>e.jsx("div",{ref:s,"data-sidebar":"header",className:ie("flex flex-col gap-2 p-2",r),...t}));tl.displayName="SidebarHeader";const sl=p.forwardRef(({className:r,...t},s)=>e.jsx("div",{ref:s,"data-sidebar":"footer",className:ie("flex flex-col gap-2 p-2",r),...t}));sl.displayName="SidebarFooter";const al=p.forwardRef(({className:r,...t},s)=>e.jsx(ga,{ref:s,"data-sidebar":"separator",className:ie("mx-2 w-auto bg-sidebar-border",r),...t}));al.displayName="SidebarSeparator";const bn=p.forwardRef(({className:r,...t},s)=>e.jsx("div",{ref:s,"data-sidebar":"content",className:ie("flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden",r),...t}));bn.displayName="SidebarContent";const Zs=p.forwardRef(({className:r,...t},s)=>e.jsx("div",{ref:s,"data-sidebar":"group",className:ie("relative flex w-full min-w-0 flex-col p-2",r),...t}));Zs.displayName="SidebarGroup";const Ea=p.forwardRef(({className:r,asChild:t=!1,...s},a)=>{const n=t?Ds:"div";return e.jsx(n,{ref:a,"data-sidebar":"group-label",className:ie("flex h-8 shrink-0 items-center rounded-md px-2 text-sm font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opa] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0",r),...s})});Ea.displayName="SidebarGroupLabel";const rl=p.forwardRef(({className:r,asChild:t=!1,...s},a)=>{const n=t?Ds:"button";return e.jsx(n,{ref:a,"data-sidebar":"group-action",className:ie("absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","group-data-[collapsible=icon]:hidden",r),...s})});rl.displayName="SidebarGroupAction";const ea=p.forwardRef(({className:r,...t},s)=>e.jsx("div",{ref:s,"data-sidebar":"group-content",className:ie("w-full text-sm",r),...t}));ea.displayName="SidebarGroupContent";const ta=p.forwardRef(({className:r,...t},s)=>e.jsx("ul",{ref:s,"data-sidebar":"menu",className:ie("flex w-full min-w-0 flex-col gap-1",r),...t}));ta.displayName="SidebarMenu";const sa=p.forwardRef(({className:r,...t},s)=>e.jsx("li",{ref:s,"data-sidebar":"menu-item",className:ie("group/menu-item relative",r),...t}));sa.displayName="SidebarMenuItem";const nl=xs("peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-base outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",{variants:{variant:{default:"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",outline:"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]"},size:{default:"h-8 text-base",sm:"h-7 text-sm",lg:"h-12 text-base group-data-[collapsible=icon]:!p-0"}},defaultVariants:{variant:"default",size:"default"}}),aa=p.forwardRef(({asChild:r=!1,isActive:t=!1,variant:s="default",size:a="default",tooltip:n,className:i,...c},u)=>{const d=r?Ds:"button",{isMobile:o,state:m}=zs(),y=e.jsx(d,{ref:u,"data-sidebar":"menu-button","data-size":a,"data-active":t,className:ie(nl({variant:s,size:a}),i),...c});return n?(typeof n=="string"&&(n={children:n}),e.jsxs(lo,{children:[e.jsx(co,{asChild:!0,children:y}),e.jsx(un,{side:"right",align:"center",hidden:m!=="collapsed"||o,...n})]})):y});aa.displayName="SidebarMenuButton";const il=p.forwardRef(({className:r,asChild:t=!1,showOnHover:s=!1,...a},n)=>{const i=t?Ds:"button";return e.jsx(i,{ref:n,"data-sidebar":"menu-action",className:ie("absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform peer-hover/menu-button:text-sidebar-accent-foreground hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",s&&"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0",r),...a})});il.displayName="SidebarMenuAction";const ol=p.forwardRef(({className:r,...t},s)=>e.jsx("div",{ref:s,"data-sidebar":"menu-badge",className:ie("pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground","peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",r),...t}));ol.displayName="SidebarMenuBadge";const ll=p.forwardRef(({className:r,showIcon:t=!1,...s},a)=>{const n=p.useMemo(()=>`${Math.floor(Math.random()*40)+50}%`,[]);return e.jsxs("div",{ref:a,"data-sidebar":"menu-skeleton",className:ie("flex h-8 items-center gap-2 rounded-md px-2",r),...s,children:[t&&e.jsx(Za,{className:"size-4 rounded-md","data-sidebar":"menu-skeleton-icon"}),e.jsx(Za,{className:"h-4 max-w-[--skeleton-width] flex-1","data-sidebar":"menu-skeleton-text",style:{"--skeleton-width":n}})]})});ll.displayName="SidebarMenuSkeleton";const cl=p.forwardRef(({className:r,...t},s)=>e.jsx("ul",{ref:s,"data-sidebar":"menu-sub",className:ie("mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5","group-data-[collapsible=icon]:hidden",r),...t}));cl.displayName="SidebarMenuSub";const dl=p.forwardRef(({...r},t)=>e.jsx("li",{ref:t,...r}));dl.displayName="SidebarMenuSubItem";const ul=p.forwardRef(({asChild:r=!1,size:t="md",isActive:s,className:a,...n},i)=>{const c=r?Ds:"a";return e.jsx(c,{ref:i,"data-sidebar":"menu-sub-button","data-size":t,"data-active":s,className:ie("flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring aria-disabled:pointer-events-none aria-disabled:opacity-50 hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground","data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground",t==="sm"&&"text-xs",t==="md"&&"text-sm","group-data-[collapsible=icon]:hidden",a),...n})});ul.displayName="SidebarMenuSubButton";const ml=[{title:"Dashboard",url:"/",icon:Jn},{title:"Purchases",url:"/purchases",icon:Aa},{title:"Tasks",url:"/tasks",icon:Fa},{title:"Status",url:"/status",icon:Hs},{title:"Sales",url:"/sales",icon:br}],pl=[{title:"Master Data",url:"/master",icon:Sa},{title:"Analytics",url:"/analytics",icon:Sa}],hl=[{title:"Settings",url:"/settings",icon:Ia}];function xl(){const{state:r}=zs(),s=cs().pathname,a=r==="collapsed",[n,i]=p.useState(!1);p.useEffect(()=>{const o=()=>{const y=document.documentElement.classList.contains("dark");i(y)};o();const m=new MutationObserver(o);return m.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]}),()=>m.disconnect()},[]);const c=n?"/molaga-logo_dark.png":"/molaga-logo.png",u=o=>s===o||o!=="/"&&s.startsWith(o),d=({isActive:o})=>o?"bg-primary/10 text-primary font-medium border-r-2 border-primary":"hover:bg-muted/50 transition-colors";return e.jsx(yn,{className:a?"w-14":"w-64",collapsible:"icon",children:e.jsxs(bn,{className:"bg-sidebar",children:[e.jsx("div",{className:"h-16 border-b border-sidebar-border flex items-center justify-center px-4",children:a?e.jsxs("div",{className:"w-10 h-10 flex items-center justify-center",children:[e.jsx("img",{src:c,alt:"Molaga",className:"w-8 h-8 object-contain transition-opacity duration-200",onError:o=>{const m=o.target;m.style.display="none",m.nextElementSibling?.classList.remove("hidden")}}),e.jsx("div",{className:"w-8 h-8 rounded bg-gradient-to-br from-red-500 to-red-600 flex items-center justify-center text-white font-bold text-sm hidden",children:"M"})]}):e.jsxs("div",{className:"flex items-center justify-center w-full",children:[e.jsx("img",{src:c,alt:"Molaga ERP",className:"h-12 object-contain max-w-full transition-opacity duration-200",onError:o=>{const m=o.target;m.style.display="none",m.nextElementSibling?.classList.remove("hidden")}}),e.jsxs("div",{className:"hidden text-center",children:[e.jsx("h2",{className:"font-bold text-sidebar-foreground text-xl",children:"MOLAGA"}),e.jsx("p",{className:"text-sm text-sidebar-foreground/70",children:"Spice Manufacturing ERP"})]})]})}),e.jsxs(Zs,{children:[e.jsx(Ea,{children:"Main Modules"}),e.jsx(ea,{children:e.jsx(ta,{children:ml.map(o=>e.jsx(sa,{children:e.jsx(aa,{asChild:!0,isActive:u(o.url),children:e.jsxs(fa,{to:o.url,end:o.url==="/",className:d,children:[e.jsx(o.icon,{className:"h-4 w-4"}),!a&&e.jsx("span",{children:o.title})]})})},o.title))})})]}),e.jsxs(Zs,{children:[e.jsx(Ea,{children:"Management"}),e.jsx(ea,{children:e.jsx(ta,{children:pl.map(o=>e.jsx(sa,{children:e.jsx(aa,{asChild:!0,children:e.jsxs(fa,{to:o.url,className:d,children:[e.jsx(o.icon,{className:"h-4 w-4"}),!a&&e.jsx("span",{children:o.title})]})})},o.title))})})]}),e.jsx("div",{className:"mt-auto",children:e.jsx(Zs,{children:e.jsx(ea,{children:e.jsx(ta,{children:hl.map(o=>e.jsx(sa,{children:e.jsx(aa,{asChild:!0,children:e.jsxs(fa,{to:o.url,className:d,children:[e.jsx(o.icon,{className:"h-4 w-4"}),!a&&e.jsx("span",{children:o.title})]})})},o.title))})})})})]})})}const er="molaga_settings",Dt={company:{companyName:"Molaga Spices Pvt Ltd",legalName:"Molaga Spices Private Limited",registrationNumber:"",taxId:"",industryType:"Manufacturing",address:"",city:"",state:"",postalCode:"",country:"India",phone:"",email:"",website:"",fiscalYearStart:"04",currency:"INR",timezone:"Asia/Kolkata"},system:{language:"en",dateFormat:"DD/MM/YYYY",timeFormat:"24",firstDayOfWeek:"monday",decimalPlaces:"2",thousandSeparator:",",decimalSeparator:".",recordsPerPage:"50",theme:"light",sidebarCollapsed:!1,showTooltips:!0,enableAnimations:!0},security:{minPasswordLength:"8",requireUppercase:!0,requireLowercase:!0,requireNumbers:!0,requireSpecialChars:!0,passwordExpiry:"90",sessionTimeout:"30",maxSessions:"3",enable2FA:!1,loginAttempts:"5",lockoutDuration:"30"},notifications:{smtp:{host:"smtp.gmail.com",port:"587",username:"",password:"",fromEmail:"",fromName:"Molaga ERP",useTLS:!0},notifications:{lowStockAlerts:!0,taskCompletion:!0,backupStatus:!0,userLogin:!1,dataImportExport:!0}},backup:{autoBackup:!0,frequency:"daily",time:"00:00",retention:"30"}};class gl{settings;constructor(){this.settings=this.loadSettings()}loadSettings(){try{const t=localStorage.getItem(er);if(t){const s=JSON.parse(t);return{company:{...Dt.company,...s.company},system:{...Dt.system,...s.system},security:{...Dt.security,...s.security},notifications:{smtp:{...Dt.notifications.smtp,...s.notifications?.smtp},notifications:{...Dt.notifications.notifications,...s.notifications?.notifications}},backup:{...Dt.backup,...s.backup}}}}catch(t){console.error("Error loading settings:",t)}return Dt}saveSettings(){try{localStorage.setItem(er,JSON.stringify(this.settings))}catch(t){console.error("Error saving settings:",t)}}getAll(){return{...this.settings}}getCompany(){return{...this.settings.company}}updateCompany(t){return this.settings.company={...this.settings.company,...t},this.saveSettings(),this.getCompany()}getSystem(){return{...this.settings.system}}updateSystem(t){return this.settings.system={...this.settings.system,...t},this.saveSettings(),this.getSystem()}getSecurity(){return{...this.settings.security}}updateSecurity(t){return this.settings.security={...this.settings.security,...t},this.saveSettings(),this.getSecurity()}getNotifications(){return{...this.settings.notifications}}updateNotifications(t){return this.settings.notifications={smtp:{...this.settings.notifications.smtp,...t.smtp},notifications:{...this.settings.notifications.notifications,...t.notifications}},this.saveSettings(),this.getNotifications()}getBackup(){return{...this.settings.backup}}updateBackup(t){return this.settings.backup={...this.settings.backup,...t},this.saveSettings(),this.getBackup()}resetToDefaults(){return this.settings={...Dt},this.saveSettings(),this.getAll()}exportSettings(){return JSON.stringify(this.settings,null,2)}importSettings(t){try{const s=JSON.parse(t);return this.settings={company:{...Dt.company,...s.company},system:{...Dt.system,...s.system},security:{...Dt.security,...s.security},notifications:{smtp:{...Dt.notifications.smtp,...s.notifications?.smtp},notifications:{...Dt.notifications.notifications,...s.notifications?.notifications}},backup:{...Dt.backup,...s.backup}},this.saveSettings(),!0}catch(s){return console.error("Error importing settings:",s),!1}}}const ia=new gl;function Nn(){const[r,t]=p.useState(ia.getCompany()),s=p.useCallback(a=>{const n=ia.updateCompany(a);return t(n),n},[]);return{settings:r,updateSettings:s}}function wn(){const[r,t]=p.useState(ia.getSystem()),s=p.useCallback(a=>{const n=ia.updateSystem(a);return t(n),n},[]);return{settings:r,updateSettings:s}}const oa=ei,la=ti,fl=p.forwardRef(({className:r,inset:t,children:s,...a},n)=>e.jsxs(Nr,{ref:n,className:ie("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[state=open]:bg-accent focus:bg-accent",t&&"pl-8",r),...a,children:[s,e.jsx(wr,{className:"ml-auto h-4 w-4"})]}));fl.displayName=Nr.displayName;const jl=p.forwardRef(({className:r,...t},s)=>e.jsx(Sr,{ref:s,className:ie("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...t}));jl.displayName=Sr.displayName;const Bs=p.forwardRef(({className:r,sideOffset:t=4,...s},a)=>e.jsx(Xn,{children:e.jsx(_r,{ref:a,sideOffset:t,className:ie("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...s})}));Bs.displayName=_r.displayName;const Cs=p.forwardRef(({className:r,inset:t,...s},a)=>e.jsx(kr,{ref:a,className:ie("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",t&&"pl-8",r),...s}));Cs.displayName=kr.displayName;const yl=p.forwardRef(({className:r,children:t,checked:s,...a},n)=>e.jsxs(Cr,{ref:n,className:ie("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",r),checked:s,...a,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Pr,{children:e.jsx(Tr,{className:"h-4 w-4"})})}),t]}));yl.displayName=Cr.displayName;const vl=p.forwardRef(({className:r,children:t,...s},a)=>e.jsxs(Dr,{ref:a,className:ie("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",r),...s,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Pr,{children:e.jsx(Zn,{className:"h-2 w-2 fill-current"})})}),t]}));vl.displayName=Dr.displayName;const Sn=p.forwardRef(({className:r,inset:t,...s},a)=>e.jsx(Er,{ref:a,className:ie("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",r),...s}));Sn.displayName=Er.displayName;const _n=p.forwardRef(({className:r,...t},s)=>e.jsx(Rr,{ref:s,className:ie("-mx-1 my-1 h-px bg-muted",r),...t}));_n.displayName=Rr.displayName;function We({children:r}){const{user:t,logout:s}=ft(),{toast:a}=Fe(),{settings:n}=Nn(),{settings:i}=wn();p.useEffect(()=>{const u=window.document.documentElement;if(u.classList.remove("light","dark"),i.theme==="auto"){const d=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";u.classList.add(d)}else u.classList.add(i.theme)},[i.theme]);const c=async()=>{try{await s(),a({title:"Success",description:"Logged out successfully"})}catch{a({title:"Error",description:"Failed to logout",variant:"destructive"})}};return e.jsx(jn,{children:e.jsxs("div",{className:"min-h-screen flex w-full bg-background",children:[e.jsx(xl,{}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("header",{className:"h-16 border-b border-border bg-card/50 backdrop-blur-sm sticky top-0 z-50",children:e.jsxs("div",{className:"flex items-center justify-between px-4 sm:px-6 h-full",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[e.jsx(vn,{className:"hover:bg-primary/10 p-2"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"font-semibold text-foreground text-sm sm:text-base",children:"Molaga ERP"})})]}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[n.companyName&&e.jsxs("div",{className:"hidden sm:flex items-center gap-2 px-3 py-1.5 rounded-md bg-primary/5 border border-primary/10",children:[e.jsx(qr,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:n.companyName})]}),e.jsx($,{variant:"ghost",size:"icon",className:"hover:bg-primary/10 h-8 w-8 sm:h-10 sm:w-10",children:e.jsx(Ar,{className:"h-4 w-4"})}),e.jsxs(oa,{children:[e.jsx(la,{asChild:!0,children:e.jsx($,{variant:"ghost",size:"icon",className:"hover:bg-primary/10 h-8 w-8 sm:h-10 sm:w-10",children:e.jsx(si,{className:"h-4 w-4"})})}),e.jsxs(Bs,{align:"end",className:"w-56",children:[e.jsx(Sn,{children:e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("p",{className:"text-sm font-medium leading-none",children:t?.name}),e.jsx("p",{className:"text-xs leading-none text-muted-foreground",children:t?.email})]})}),e.jsx(_n,{}),e.jsxs(Cs,{onClick:c,className:"text-red-600 focus:text-red-600",children:[e.jsx(ai,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Log out"})]})]})]})]})]})}),e.jsx("main",{className:"flex-1 p-4 sm:p-6 bg-gradient-to-br from-background to-muted/20",children:r})]})]})})}const Ge=({children:r})=>{const{user:t,loading:s}=ft(),a=cs();return s?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ve,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading..."})]})}):t?e.jsx(e.Fragment,{children:r}):e.jsx(Rs,{to:"/login",state:{from:a},replace:!0})},bl=xs("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),F=p.forwardRef(({className:r,...t},s)=>e.jsx(Fr,{ref:s,className:ie(bl(),r),...t}));F.displayName=Fr.displayName;const G=p.forwardRef(({className:r,...t},s)=>e.jsx("div",{ref:s,className:ie("rounded-lg border bg-card text-card-foreground shadow-sm",r),...t}));G.displayName="Card";const me=p.forwardRef(({className:r,...t},s)=>e.jsx("div",{ref:s,className:ie("flex flex-col space-y-1.5 p-6",r),...t}));me.displayName="CardHeader";const pe=p.forwardRef(({className:r,...t},s)=>e.jsx("h3",{ref:s,className:ie("text-2xl font-semibold leading-none tracking-tight",r),...t}));pe.displayName="CardTitle";const ke=p.forwardRef(({className:r,...t},s)=>e.jsx("p",{ref:s,className:ie("text-sm text-muted-foreground",r),...t}));ke.displayName="CardDescription";const Z=p.forwardRef(({className:r,...t},s)=>e.jsx("div",{ref:s,className:ie("p-6 pt-0",r),...t}));Z.displayName="CardContent";const Ut=p.forwardRef(({className:r,...t},s)=>e.jsx("div",{ref:s,className:ie("flex items-center p-6 pt-0",r),...t}));Ut.displayName="CardFooter";const Nl=()=>{const[r,t]=p.useState(""),[s,a]=p.useState(""),[n,i]=p.useState(!1),[c,u]=p.useState(!1),{login:d,loginWithGoogle:o}=ft(),m=Oa(),{toast:y}=Fe(),N=async _=>{_.preventDefault(),i(!0);try{await d(r,s),y({title:"Success",description:"Logged in successfully"}),m("/")}catch(C){y({title:"Error",description:C.message||"Failed to login",variant:"destructive"})}finally{i(!1)}},v=async()=>{u(!0);try{await o()}catch(_){y({title:"Error",description:_.message||"Failed to login with Google",variant:"destructive"}),u(!1)}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs(G,{className:"w-full max-w-md",children:[e.jsxs(me,{className:"space-y-1",children:[e.jsx(pe,{className:"text-2xl font-bold text-center",children:"MOLAGA ERP"}),e.jsx(ke,{className:"text-center",children:"Sign in to your account to continue"})]}),e.jsxs(Z,{children:[e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"email",children:"Email"}),e.jsx(B,{id:"email",type:"email",placeholder:"Enter your email",value:r,onChange:_=>t(_.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"password",children:"Password"}),e.jsx(B,{id:"password",type:"password",placeholder:"Enter your password",value:s,onChange:_=>a(_.target.value),required:!0})]}),e.jsxs($,{type:"submit",className:"w-full",disabled:n,children:[n&&e.jsx(Ve,{className:"mr-2 h-4 w-4 animate-spin"}),"Sign In"]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx(ga,{className:"w-full"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{className:"bg-background px-2 text-muted-foreground",children:"Or continue with"})})]}),e.jsxs($,{type:"button",variant:"outline",className:"w-full mt-4",onClick:v,disabled:c,children:[c&&e.jsx(Ve,{className:"mr-2 h-4 w-4 animate-spin"}),e.jsxs("svg",{className:"mr-2 h-4 w-4",viewBox:"0 0 24 24",children:[e.jsx("path",{fill:"currentColor",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),e.jsx("path",{fill:"currentColor",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),e.jsx("path",{fill:"currentColor",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),e.jsx("path",{fill:"currentColor",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Continue with Google"]})]}),e.jsxs("div",{className:"mt-4 text-center text-sm",children:["Don't have an account?"," ",e.jsx(At,{to:"/register",className:"text-primary hover:underline",children:"Sign up"})]})]})]})})},wl=()=>{const[r,t]=p.useState(""),[s,a]=p.useState(""),[n,i]=p.useState(""),[c,u]=p.useState(""),[d,o]=p.useState(!1),[m,y]=p.useState(!1),{register:N,loginWithGoogle:v}=ft(),_=Oa(),{toast:C}=Fe(),g=async D=>{if(D.preventDefault(),n!==c){C({title:"Error",description:"Passwords do not match",variant:"destructive"});return}if(n.length<8){C({title:"Error",description:"Password must be at least 8 characters long",variant:"destructive"});return}o(!0);try{await N(s,n,r),C({title:"Success",description:"Account created successfully"}),_("/")}catch(I){C({title:"Error",description:I.message||"Failed to create account",variant:"destructive"})}finally{o(!1)}},S=async()=>{y(!0);try{await v()}catch(D){C({title:"Error",description:D.message||"Failed to login with Google",variant:"destructive"}),y(!1)}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs(G,{className:"w-full max-w-md",children:[e.jsxs(me,{className:"space-y-1",children:[e.jsx(pe,{className:"text-2xl font-bold text-center",children:"MOLAGA ERP"}),e.jsx(ke,{className:"text-center",children:"Create your account to get started"})]}),e.jsxs(Z,{children:[e.jsxs("form",{onSubmit:g,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"name",children:"Full Name"}),e.jsx(B,{id:"name",type:"text",placeholder:"Enter your full name",value:r,onChange:D=>t(D.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"email",children:"Email"}),e.jsx(B,{id:"email",type:"email",placeholder:"Enter your email",value:s,onChange:D=>a(D.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"password",children:"Password"}),e.jsx(B,{id:"password",type:"password",placeholder:"Enter your password (min 8 characters)",value:n,onChange:D=>i(D.target.value),required:!0,minLength:8})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"confirmPassword",children:"Confirm Password"}),e.jsx(B,{id:"confirmPassword",type:"password",placeholder:"Confirm your password",value:c,onChange:D=>u(D.target.value),required:!0})]}),e.jsxs($,{type:"submit",className:"w-full",disabled:d,children:[d&&e.jsx(Ve,{className:"mr-2 h-4 w-4 animate-spin"}),"Create Account"]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx(ga,{className:"w-full"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{className:"bg-background px-2 text-muted-foreground",children:"Or continue with"})})]}),e.jsxs($,{type:"button",variant:"outline",className:"w-full mt-4",onClick:S,disabled:m,children:[m&&e.jsx(Ve,{className:"mr-2 h-4 w-4 animate-spin"}),e.jsxs("svg",{className:"mr-2 h-4 w-4",viewBox:"0 0 24 24",children:[e.jsx("path",{fill:"currentColor",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),e.jsx("path",{fill:"currentColor",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),e.jsx("path",{fill:"currentColor",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),e.jsx("path",{fill:"currentColor",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Continue with Google"]})]}),e.jsxs("div",{className:"mt-4 text-center text-sm",children:["Already have an account?"," ",e.jsx(At,{to:"/login",className:"text-primary hover:underline",children:"Sign in"})]})]})]})})},Sl=xs("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function Qe({className:r,variant:t,...s}){return e.jsx("div",{className:ie(Sl({variant:t}),r),...s})}function _l({title:r,value:t,change:s,changeType:a="neutral",icon:n,description:i}){const c={positive:"text-green-600 bg-green-50",negative:"text-red-600 bg-red-50",neutral:"text-muted-foreground bg-muted"}[a];return e.jsxs(G,{className:"hover:shadow-lg transition-all duration-300 border-l-4 border-l-primary",children:[e.jsxs(me,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(pe,{className:"text-xs sm:text-sm font-medium text-muted-foreground",children:r}),e.jsx(n,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"})]}),e.jsxs(Z,{children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-foreground",children:t}),s&&e.jsx(Qe,{variant:"secondary",className:`text-xs mt-2 ${c}`,children:s}),i&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:i})]})]})}const tr=[{id:1,name:"Procurement",icon:Es,description:"Raw Materials",status:"active"},{id:2,name:"Pre-Production",icon:Ia,description:"Clean/Roast",status:"active"},{id:3,name:"Production",icon:Ir,description:"Grinding",status:"active"},{id:4,name:"Post-Production",icon:ri,description:"Packing",status:"pending"},{id:5,name:"Sales",icon:ni,description:"Customer",status:"pending"}];function kl(){return e.jsxs(G,{className:"col-span-full",children:[e.jsx(me,{children:e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(Ir,{className:"h-5 w-5 text-primary"}),"Production Flow Status"]})}),e.jsx(Z,{children:e.jsx("div",{className:"flex items-center justify-between overflow-x-auto pb-4",children:tr.map((r,t)=>e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"flex flex-col items-center min-w-0 flex-shrink-0",children:[e.jsx("div",{className:`
                  w-16 h-16 rounded-full border-2 flex items-center justify-center mb-2
                  ${r.status==="active"?"bg-primary/10 border-primary text-primary":"bg-muted border-muted-foreground/30 text-muted-foreground"}
                `,children:e.jsx(r.icon,{className:"h-6 w-6"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-medium text-sm",children:r.name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:r.description})]})]}),t<tr.length-1&&e.jsx(Ot,{className:"h-5 w-5 text-muted-foreground mx-6 flex-shrink-0"})]},r.id))})})]})}const Ae=r=>({async getAll(t=[]){let s=[],a=0;const n=100;let i=!0;for(;i;)try{const c=await tt.listDocuments(st,r,[...t,Ze.limit(n),Ze.offset(a)]);if(s.push(...c.documents),a+=n,i=c.documents.length===n,a>1e4){kt.warn(`âš ï¸ Pagination safety limit reached for ${r}, stopping at 10000 records`);break}}catch(c){throw kt.error(`Error fetching documents from ${r}:`,c),c}return kt.log(`ðŸ“¦ Fetched ${s.length} documents from ${r}`),s},async getPaginated(t=[],s={}){const a=s.limit||100,n=s.offset||0;try{const i=await tt.listDocuments(st,r,[...t,Ze.limit(a),Ze.offset(n)]);return{documents:i.documents,total:i.total,hasMore:n+a<i.total}}catch(i){throw kt.error(`Error fetching paginated documents from ${r}:`,i),i}},async getById(t){return await tt.getDocument(st,r,t)},async create(t){return await tt.createDocument(st,r,ps.unique(),t)},async update(t,s){return await tt.updateDocument(st,r,t,s)},async delete(t){await tt.deleteDocument(st,r,t)}});({...Ae(be.PRODUCTION_STATUS)});const Cl={...Ae(be.POST_PRODUCTION_STATUS),async getWithRelations(){const r=await this.getAll(),t=Ae(be.PRODUCTS),s=Ae(be.PROCESSES),a=await t.getAll(),n=await s.getAll(),i=new Map(a.map(u=>[u.$id,u.name])),c=new Map(n.map(u=>[u.$id,u.process_name]));return r.map(u=>({...u,product_name:i.get(u.product_id)||"Unknown",process_name:c.get(u.process_id)||"Unknown"}))}};({...Ae(be.INVENTORY_STATUS)});const kn={...Ae(be.STOCK_STATUS),async getStockStatusByDateRange(r,t){const s=[];return r&&s.push(Ze.greaterThanEqual("status_date",r)),t&&s.push(Ze.lessThanEqual("status_date",t)),await this.getAll(s)}},zt={...Ae(be.PRODUCTION_TASKS),async getByDateRange(r,t){const s=[];return r&&s.push(Ze.greaterThanEqual("date",r.toISOString())),t&&s.push(Ze.lessThanEqual("date",t.toISOString())),this.getAll(s)},async getProductionTasksWithRelations(r,t,s){const a=[];r&&a.push(Ze.greaterThanEqual("date",r)),t&&a.push(Ze.lessThanEqual("date",t)),s&&a.push(Ze.equal("process_id",s));const n=await this.getAll(a),i=Ae(be.STAFF),c=Ae(be.PROCESSES),u=Ae(be.RAW_PRODUCTS),d=Ae(be.STOCKS),o=await i.getAll(),m=await c.getAll(),y=await u.getAll(),N=await d.getAll(),v=await Os.getAll(),_=new Map(o.map(D=>[D.$id,D.staff_name])),C=new Map(m.map(D=>[D.$id,D.process_name])),g=new Map(y.map(D=>[D.$id,D.raw_product])),S=new Map(N.map(D=>[D.$id,D.stock_name]));return n.map(D=>{const E=v.filter(q=>q.production_task_id===D.$id).map(q=>({...q,stock_name:S.get(q.stock_id)||"Unknown"}));return{...D,staff_name:_.get(D.staff_id)||"Unknown",process_name:C.get(D.process_id)||"Unknown",source_process_name:C.get(D.source_process_id)||"Unknown",raw_product_name:g.get(D.raw_product_id)||"Unknown",stock_items:E}})}},Xt={...Ae(be.POST_PRODUCTION_TASKS),async getPostProductionTasksWithRelations(){const r=await this.getAll(),t=Ae(be.STAFF),s=Ae(be.PROCESSES),a=Ae(be.PRODUCTS),n=Ae(be.STOCKS),i=await t.getAll(),c=await s.getAll(),u=await a.getAll(),d=await n.getAll(),o=new Map(i.map(v=>[v.$id,v.staff_name])),m=new Map(c.map(v=>[v.$id,v.process_name])),y=new Map(u.map(v=>[v.$id,v.product])),N=new Map(d.map(v=>[v.$id,v.stock_name]));return r.map(v=>({...v,staff_name:o.get(v.staff_id)||"Unknown",process_name:m.get(v.process_id)||"Unknown",source_process_name:m.get(v.source_process_id)||"Unknown",product_name:y.get(v.product_id)||"Unknown",stock_name:N.get(v.sku)||"Unknown"}))}},Bt={...Ae(be.STOCKS),async getCategories(){const r=await this.getAll(),t=new Set(r.map(s=>s.category));return Array.from(t)}},ws=Ae(be.RAW_PRODUCTS),Ls=Ae(be.VENDORS),Pl=Ae(be.STAFF),fs=Ae(be.PROCESSES),Ht=Ae(be.PRODUCTS),Ms=Ae(be.SALES_CHANNELS),Wt={...Ae(be.PURCHASES),async getByDateRange(r,t){const s=[];if(r){const a=new Date(r),n=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`;s.push(Ze.greaterThanEqual("date",n))}if(t){const a=new Date(t),n=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`;s.push(Ze.lessThanEqual("date",n))}return this.getAll(s)}},Tl=Ae(be.SALES_ORDERS),Gt=Ae(be.SALES_UNITS),os=Ae(be.SALES_RECORDS);({...Ae(be.PRE_PRODUCTION_STATUS)});const Os={...Ae(be.PRODUCTION_TASK_ITEMS),async deleteByProductionTaskId(r){const t=await this.getAll([Ze.equal("production_task_id",r)]);await Promise.all(t.map(s=>this.delete(s.$id)))}},ls={...Ae(be.PRE_PRODUCTION_TASKS),async getByDateRange(r,t){const s=[];if(r){const a=new Date(r),n=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`;s.push(Ze.greaterThanEqual("date_assigned",n))}if(t){const a=new Date(t),n=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`;s.push(Ze.lessThanEqual("date_assigned",n))}return this.getAll(s)},async getPreProductionTasksWithRelations(){const r=await this.getAll(),t=Ae(be.STAFF),s=Ae(be.PROCESSES),a=Ae(be.STOCKS),n=await t.getAll(),i=await s.getAll(),c=await a.getAll(),u=new Map(n.map(m=>[m.$id,m.staff_name])),d=new Map(i.map(m=>[m.$id,m.process_name])),o=new Map(c.map(m=>[m.$id,m.stock_name]));return r.map(m=>({...m,staff_name:u.get(m.staff_id)||"Unknown",process_name:d.get(m.process_id)||"Unknown",stock_name:o.get(m.stock_id)||"Unknown"}))}},Dl=()=>{const{data:r=[],isLoading:t}=fe({queryKey:["dashboard","stock-status"],queryFn:()=>kn.getStockStatusByDateRange(),staleTime:6e4}),{data:s=[],isLoading:a}=fe({queryKey:["dashboard","sales-orders"],queryFn:async()=>{const{documents:g}=await Tl.list();return g},staleTime:6e4}),{data:n=[],isLoading:i}=fe({queryKey:["dashboard","recent-purchases"],queryFn:async()=>{const{documents:g}=await Wt.list();return g.sort((S,D)=>new Date(D.$createdAt||D.date).getTime()-new Date(S.$createdAt||S.date).getTime()).slice(0,5)},staleTime:6e4}),{data:c=[],isLoading:u}=fe({queryKey:["dashboard","recent-prepro-tasks"],queryFn:async()=>{const{documents:g}=await ls.list();return g.sort((S,D)=>new Date(D.$createdAt||D.date_assigned).getTime()-new Date(S.$createdAt||S.date_assigned).getTime()).slice(0,5)},staleTime:6e4}),d=(r||[]).reduce((g,S)=>g+(S.closing_bal||0),0),o=(s||[]).filter(g=>g.status!=="delivered"&&g.status!=="cancelled").length,m=(c||[]).reduce((g,S)=>g+(S.assigned_quantity||0),0),y=(c||[]).reduce((g,S)=>g+((S.assigned_quantity||0)-(S.wastage_quantity||0)),0),N=m>0?y/m*100:0,v=(r||[]).filter(g=>(g.closing_bal||0)<=(g.min_level||0)).map(g=>({name:g.stock_name,current:`${g.closing_bal||0} kg`,minimum:`${g.min_level||0} kg`,severity:(g.closing_bal||0)===0?"critical":"warning"})).slice(0,5),_=[...(n||[]).map(g=>({id:g.$id||`purchase-${g.date}`,action:"New purchase",item:`${g.stock_id} - ${g.quantity} units @ ${g.rate}`,time:Ga(new Date(g.date||g.$createdAt),{addSuffix:!0}),status:"success"})),...(c||[]).map(g=>({id:g.$id||`task-${g.date_assigned}`,action:`${g.status==="completed"?"Task completed":g.status==="in_progress"?"Task in progress":"Task created"}`,item:`${g.process_id} - ${g.assigned_quantity} units (${g.stock_id})`,time:Ga(new Date(g.date_completed||g.date_assigned||g.$createdAt),{addSuffix:!0}),status:g.status==="completed"?"success":"error"}))].sort((g,S)=>g.time>S.time?-1:1).slice(0,5),C=[{title:"Total Raw Stock",value:`${d.toLocaleString()} kg`,changeType:"neutral",icon:Es,description:"Sum of closing balances across stocks"},{title:"Active Orders",value:o,changeType:"neutral",icon:Aa,description:"Not delivered or cancelled"},{title:"Production Efficiency",value:`${N.toFixed(1)}%`,changeType:N>=90?"positive":"negative",icon:Hs,description:"Effective completed vs assigned (recent)"},{title:"Low Stock Alerts",value:v.length,changeType:v.length>0?"negative":"neutral",icon:Et,description:"Closing balance below minimum"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Dashboard"}),e.jsx("p",{className:"text-muted-foreground",children:"Welcome to Molaga ERP - Your complete spice manufacturing solution"})]}),e.jsx("div",{className:"grid gap-3 sm:gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-4",children:C.map((g,S)=>e.jsx(_l,{...g},S))}),e.jsx(kl,{}),e.jsxs("div",{className:"grid gap-4 sm:gap-6 grid-cols-1 lg:grid-cols-2",children:[e.jsxs(G,{children:[e.jsx(me,{children:e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(_a,{className:"h-5 w-5 text-primary"}),"Recent Activities"]})}),e.jsx(Z,{children:e.jsxs("div",{className:"space-y-4",children:[_.map(g=>e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg hover:bg-muted/50 transition-colors",children:[e.jsx("div",{className:`mt-0.5 ${g.status==="success"?"text-green-600":"text-red-600"}`,children:g.status==="success"?e.jsx(Jt,{className:"h-4 w-4"}):e.jsx(ka,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:g.action}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:g.item}),e.jsx("p",{className:"text-xs text-muted-foreground",children:g.time})]})]},g.id)),(t||a||i||u)&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading real data..."}),!_.length&&!(t||a||i||u)&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"No recent activities found."})]})})]}),e.jsxs(G,{children:[e.jsx(me,{children:e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(Et,{className:"h-5 w-5 text-destructive"}),"Low Stock Alerts"]})}),e.jsx(Z,{children:e.jsxs("div",{className:"space-y-3",children:[v.map((g,S)=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-border",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm text-foreground",children:g.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Current: ",g.current," | Min: ",g.minimum]})]}),e.jsx(Qe,{variant:g.severity==="critical"?"destructive":"secondary",className:g.severity==="critical"?"bg-red-100 text-red-800":g.severity==="warning"?"bg-yellow-100 text-yellow-800":"bg-orange-100 text-orange-800",children:g.severity})]},S)),!v.length&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"No low stock alerts."})]})})]})]})]})},Ps=p.forwardRef(({className:r,value:t,...s},a)=>e.jsx($r,{ref:a,className:ie("relative h-4 w-full overflow-hidden rounded-full bg-secondary",r),...s,children:e.jsx(ii,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(t||0)}%)`}})}));Ps.displayName=$r.displayName;class Na{static CHUNK_SIZE=1e3;static MAX_MEMORY_RECORDS=1e4;static async exportToCSV(t,s){try{s?.({current:0,total:t.data.length,percentage:0,status:"preparing",message:"Preparing CSV export..."});const a=this.formatDataForExport(t.data,t.headers);s?.({current:t.data.length*.5,total:t.data.length,percentage:50,status:"processing",message:"Processing data..."});let n=a;t.metadata&&(n=[...this.createMetadataRows(t.metadata),[],t.headers,...a.slice(1)]),s?.({current:t.data.length*.8,total:t.data.length,percentage:80,status:"generating",message:"Generating CSV file..."});const i=Is.unparse(n,{header:!1,skipEmptyLines:!1});s?.({current:t.data.length,total:t.data.length,percentage:95,status:"downloading",message:"Downloading file..."});const c=new Blob([i],{type:"text/csv;charset=utf-8;"}),u=this.generateFilename(t.filename,"csv");$s.saveAs(c,u),s?.({current:t.data.length,total:t.data.length,percentage:100,status:"complete",message:"Export completed successfully"})}catch(a){throw s?.({current:0,total:t.data.length,percentage:0,status:"error",message:`Export failed: ${a instanceof Error?a.message:"Unknown error"}`}),a}}static async exportToXLSX(t,s){try{s?.({current:0,total:t.data.length,percentage:0,status:"preparing",message:"Preparing Excel export..."});const a=St.book_new(),n=this.formatDataForExport(t.data,t.headers);s?.({current:t.data.length*.3,total:t.data.length,percentage:30,status:"processing",message:"Processing data..."});const i=St.aoa_to_sheet(n);if(this.applyExcelFormatting(i,t.headers.length,n.length),St.book_append_sheet(a,i,"Data"),s?.({current:t.data.length*.6,total:t.data.length,percentage:60,status:"processing",message:"Creating worksheets..."}),t.metadata){const o=this.createMetadataSheet(t.metadata);St.book_append_sheet(a,o,"Export Info")}s?.({current:t.data.length*.8,total:t.data.length,percentage:80,status:"generating",message:"Generating Excel file..."});const c=Ja(a,{bookType:"xlsx",type:"array",compression:!0});s?.({current:t.data.length,total:t.data.length,percentage:95,status:"downloading",message:"Downloading file..."});const u=new Blob([c],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),d=this.generateFilename(t.filename,"xlsx");$s.saveAs(u,d),s?.({current:t.data.length,total:t.data.length,percentage:100,status:"complete",message:"Export completed successfully"})}catch(a){throw s?.({current:0,total:t.data.length,percentage:0,status:"error",message:`Export failed: ${a instanceof Error?a.message:"Unknown error"}`}),a}}static async exportLargeDataset(t,s){if(t.data.length<=this.MAX_MEMORY_RECORDS)return t.format==="csv"?this.exportToCSV(t,s):this.exportToXLSX(t,s);try{s?.({current:0,total:t.data.length,percentage:0,status:"preparing",message:"Preparing large dataset export..."});const a=this.chunkArray(t.data,this.CHUNK_SIZE);let n=0;t.format==="csv"?await this.exportLargeCSV(t,a,s):await this.exportLargeXLSX(t,a,s)}catch(a){throw s?.({current:0,total:t.data.length,percentage:0,status:"error",message:`Large export failed: ${a instanceof Error?a.message:"Unknown error"}`}),a}}static formatDataForExport(t,s){if(t.length===0)return[s];const a=[s];return t.forEach(n=>{const i=s.map(c=>{const u=n[c]||n[this.camelToSnake(c)]||"";return this.formatCellValue(u)});a.push(i)}),a}static formatCellValue(t){return t==null?"":typeof t=="boolean"?t?"Yes":"No":t instanceof Date?t.toLocaleDateString("en-GB"):typeof t=="number"?t%1===0?t.toString():t.toFixed(2):typeof t=="object"?JSON.stringify(t):String(t)}static generateFilename(t,s){const a=new Date().toISOString().slice(0,19).replace(/[:.]/g,"-");return`${t}_${a}.${s}`}static createMetadataRows(t){return[["Export Information"],["Exported At:",t.exportedAt.toLocaleString()],["Exported By:",t.exportedBy],["Page Source:",t.pageSource],["Record Count:",t.recordCount.toString()],["Version:",t.version],...t.filters?[["Filters:",JSON.stringify(t.filters)]]:[]]}static createMetadataSheet(t){const s=[["Export Information",""],["Exported At",t.exportedAt.toLocaleString()],["Exported By",t.exportedBy],["Page Source",t.pageSource],["Record Count",t.recordCount],["Version",t.version],...t.filters?[["Filters",JSON.stringify(t.filters)]]:[]];return St.aoa_to_sheet(s)}static applyExcelFormatting(t,s,a){const n=St.encode_range({s:{c:0,r:0},e:{c:s-1,r:a-1}});t["!ref"]=n;const i=Array(s).fill({wch:15});t["!cols"]=i;for(let c=0;c<s;c++){const u=St.encode_cell({r:0,c});t[u]&&(t[u].s={font:{bold:!0},fill:{fgColor:{rgb:"E2E8F0"}}})}}static async exportLargeCSV(t,s,a){let n="",i=0;if(n+=Is.unparse([t.headers],{header:!1})+`
`,t.metadata){const d=this.createMetadataRows(t.metadata);n=Is.unparse(d,{header:!1})+`

`+n}for(let d=0;d<s.length;d++){const o=s[d],m=this.formatDataForExport(o,t.headers).slice(1);n+=Is.unparse(m,{header:!1}),d<s.length-1&&(n+=`
`),i+=o.length,a?.({current:i,total:t.data.length,percentage:Math.round(i/t.data.length*80),status:"processing",message:`Processing chunk ${d+1} of ${s.length}...`}),await new Promise(y=>setTimeout(y,10))}const c=new Blob([n],{type:"text/csv;charset=utf-8;"}),u=this.generateFilename(t.filename,"csv");$s.saveAs(c,u)}static async exportLargeXLSX(t,s,a){const n=St.book_new();let i=[t.headers],c=0;for(let y=0;y<s.length;y++){const N=s[y],v=this.formatDataForExport(N,t.headers).slice(1);i.push(...v),c+=N.length,a?.({current:c,total:t.data.length,percentage:Math.round(c/t.data.length*70),status:"processing",message:`Processing chunk ${y+1} of ${s.length}...`}),await new Promise(_=>setTimeout(_,10))}const u=St.aoa_to_sheet(i);if(this.applyExcelFormatting(u,t.headers.length,i.length),St.book_append_sheet(n,u,"Data"),t.metadata){const y=this.createMetadataSheet(t.metadata);St.book_append_sheet(n,y,"Export Info")}const d=Ja(n,{bookType:"xlsx",type:"array",compression:!0}),o=new Blob([d],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),m=this.generateFilename(t.filename,"xlsx");$s.saveAs(o,m)}static chunkArray(t,s){const a=[];for(let n=0;n<t.length;n+=s)a.push(t.slice(n,n+s));return a}static camelToSnake(t){return t.replace(/[A-Z]/g,s=>`_${s.toLowerCase()}`)}}const Ct=({data:r,headers:t,filename:s,className:a,disabled:n=!1,includeMetadata:i=!0,metadata:c,onExportStart:u,onExportComplete:d,variant:o="outline",size:m="default"})=>{const[y,N]=p.useState(!1),[v,_]=p.useState(null),[C,g]=p.useState(null),S=async q=>{if(!(y||n))try{N(!0),g(q),_(null),u?.();const U=i?{exportedAt:new Date,exportedBy:"Current User",pageSource:s,recordCount:r.length,version:"1.0.0",...c}:void 0,O={filename:s,headers:t,data:r,format:q,metadata:U};_({current:0,total:r.length,percentage:0,status:"preparing",message:`Preparing ${q.toUpperCase()} export...`}),r.length>1e4?await Na.exportLargeDataset(O,_):q==="csv"?await Na.exportToCSV(O,_):await Na.exportToXLSX(O,_),Yt.success(`Successfully exported ${r.length} records to ${q.toUpperCase()}`,{description:`File: ${s}_${new Date().toISOString().slice(0,19).replace(/[:.]/g,"-")}.${q}`}),d?.(!0)}catch(U){console.error("Export failed:",U),Yt.error("Export failed",{description:U instanceof Error?U.message:"An unexpected error occurred"}),d?.(!1)}finally{N(!1),g(null),_(null)}},D=()=>y&&C?`Exporting ${C.toUpperCase()}...`:"Export",I=()=>y?e.jsx(Ve,{className:"h-4 w-4 animate-spin"}):e.jsx(hs,{className:"h-4 w-4"}),E=!r||r.length===0;return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(oa,{children:[e.jsx(la,{asChild:!0,children:e.jsxs($,{variant:o,size:m,className:a,disabled:n||y||E,children:[I(),D()]})}),e.jsxs(Bs,{align:"end",children:[e.jsxs(Cs,{onClick:()=>S("csv"),disabled:y||E,className:"cursor-pointer",children:[e.jsx(ks,{className:"h-4 w-4 mr-2"}),"Export as CSV"]}),e.jsxs(Cs,{onClick:()=>S("xlsx"),disabled:y||E,className:"cursor-pointer",children:[e.jsx(Lr,{className:"h-4 w-4 mr-2"}),"Export as Excel"]})]})]}),y&&v&&e.jsxs("div",{className:"space-y-2 min-w-[200px]",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:v.message||"Processing..."}),e.jsxs("span",{className:"text-muted-foreground",children:[v.percentage,"%"]})]}),e.jsx(Ps,{value:v.percentage,className:"h-2"}),v.currentBatch&&v.totalBatches&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Batch ",v.currentBatch," of ",v.totalBatches]})]}),E&&e.jsx("div",{className:"text-xs text-muted-foreground",children:"No data available to export"})]})},ot=vr,js=oi,El=jr,Cn=p.forwardRef(({className:r,...t},s)=>e.jsx(ca,{ref:s,className:ie("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r),...t}));Cn.displayName=ca.displayName;const at=p.forwardRef(({className:r,children:t,...s},a)=>e.jsxs(El,{children:[e.jsx(Cn,{}),e.jsxs(da,{ref:a,className:ie("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",r),...s,children:[t,e.jsxs(yr,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-accent data-[state=open]:text-muted-foreground hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[e.jsx(_s,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));at.displayName=da.displayName;const rt=({className:r,...t})=>e.jsx("div",{className:ie("flex flex-col space-y-1.5 text-center sm:text-left",r),...t});rt.displayName="DialogHeader";const nt=({className:r,...t})=>e.jsx("div",{className:ie("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",r),...t});nt.displayName="DialogFooter";const it=p.forwardRef(({className:r,...t},s)=>e.jsx(ua,{ref:s,className:ie("text-lg font-semibold leading-none tracking-tight",r),...t}));it.displayName=ua.displayName;const lt=p.forwardRef(({className:r,...t},s)=>e.jsx(ma,{ref:s,className:ie("text-sm text-muted-foreground",r),...t}));lt.displayName=ma.displayName;class wa{static DEFAULT_BATCH_SIZE=100;static MAX_FILE_SIZE_MB=50;static SUPPORTED_FORMATS=[".csv",".xlsx",".xls"];static async parseFile(t,s){try{this.validateFile(t),s?.({current:0,total:100,percentage:0,status:"parsing",message:"Starting file parsing..."});const a=this.getFileExtension(t.name);let n=[];if(a===".csv")n=await this.parseCSVFile(t,s);else if(a===".xlsx"||a===".xls")n=await this.parseExcelFile(t,s);else throw new Error(`Unsupported file format: ${a}`);return s?.({current:100,total:100,percentage:100,status:"complete",message:`Successfully parsed ${n.length} rows`}),n}catch(a){throw s?.({current:0,total:100,percentage:0,status:"error",message:`Parsing failed: ${a instanceof Error?a.message:"Unknown error"}`}),a}}static validateData(t,s,a){const n={isValid:!0,errors:[],warnings:[],validData:[],invalidData:[]};if(t.length===0)return n.isValid=!1,n.errors.push({row:0,column:"file",message:"File contains no data rows",value:null,severity:"error"}),n;a?.({current:0,total:t.length,percentage:0,status:"validating",message:"Starting data validation..."});const i=Object.keys(t[0]),c=this.validateHeaders(i,s);c.isValid||(n.errors.push(...c.errors),n.isValid=!1),t.forEach((d,o)=>{const m=o+1,y=this.validateRow(d,s.validationRules,m,t,s);y.errors.length>0?(n.errors.push(...y.errors),n.invalidData.push({...d,_rowNumber:m})):n.validData.push({...d,_rowNumber:m}),y.warnings.length>0&&n.warnings.push(...y.warnings),(o%100===0||o===t.length-1)&&a?.({current:o+1,total:t.length,percentage:Math.round((o+1)/t.length*100),status:"validating",message:`Validating row ${o+1} of ${t.length}...`})});const u=this.detectDuplicates(t,s);return n.warnings.push(...u),n.isValid=n.errors.length===0,a?.({current:t.length,total:t.length,percentage:100,status:"complete",message:`Validation complete. ${n.validData.length} valid rows, ${n.invalidData.length} invalid rows`}),n}static async processImport(t,s,a){const n=s.batchSize||this.DEFAULT_BATCH_SIZE,i=this.createBatches(t,n),c={totalRows:t.length,successfulRows:0,failedRows:0,errors:[],warnings:[],processedData:[],skippedRows:0};a?.({current:0,total:t.length,percentage:0,status:"processing",message:"Starting import process...",currentBatch:0,totalBatches:i.length});try{if(s.dataProcessor)for(let u=0;u<t.length;u++){const d=t[u];try{let o={...d};if(s.columnMapper){const y={};Object.keys(d).forEach(N=>{const v=s.columnMapper(N);y[v]=d[N],y[N]=d[N]}),o={...o,...y}}console.log(`ðŸ”„ [ImportService] Processing row ${u+1}...`),console.log("ðŸ”„ [ImportService] Transformed row:",o);const m=await s.dataProcessor(o,t);console.log(`âœ… [ImportService] Row ${u+1} processed successfully. Saved data:`,m),c.processedData.push(m),c.successfulRows++,console.log(`âœ… [ImportService] Incremented successfulRows to: ${c.successfulRows}`)}catch(o){console.error(`âŒ [ImportService] Error processing row ${u+1}:`,o),console.error("âŒ [ImportService] Error details:",{message:o instanceof Error?o.message:"Unknown error",stack:o instanceof Error?o.stack:void 0,row:d}),c.errors.push({row:u+1,column:"processing",message:o instanceof Error?o.message:"Failed to process row",value:d,severity:"error"}),c.failedRows++}(u%10===0||u===t.length-1)&&a?.({current:u+1,total:t.length,percentage:Math.round((u+1)/t.length*100),status:"processing",message:`Processing row ${u+1} of ${t.length}...`,currentBatch:Math.floor(u/n)+1,totalBatches:i.length}),await new Promise(o=>setTimeout(o,10))}else for(let u=0;u<i.length;u++){const d=i[u],o=await this.processBatch(d,n,u+1);c.successfulRows+=o.processed,c.errors.push(...o.errors),c.warnings.push(...o.warnings),c.processedData.push(...o.data);const m=(u+1)*n,y=Math.min(m,t.length);a?.({current:y,total:t.length,percentage:Math.round(y/t.length*100),status:"processing",message:`Processing batch ${u+1} of ${i.length}...`,currentBatch:u+1,totalBatches:i.length}),await new Promise(N=>setTimeout(N,10))}return c.failedRows=c.totalRows-c.successfulRows,a?.({current:t.length,total:t.length,percentage:100,status:"complete",message:`Import complete. ${c.successfulRows} successful, ${c.failedRows} failed`}),s.onImportComplete(c),c}catch(u){throw a?.({current:0,total:t.length,percentage:0,status:"error",message:`Import failed: ${u instanceof Error?u.message:"Unknown error"}`}),u}}static async processBatch(t,s,a){const n={processed:0,errors:[],warnings:[],data:[]};try{return await new Promise(i=>setTimeout(i,50)),t.forEach((i,c)=>{try{const u=this.processRow(i);n.data.push(u),n.processed++}catch(u){n.errors.push({row:(a-1)*s+c+1,column:"processing",message:u instanceof Error?u.message:"Processing failed",value:i,severity:"error"})}}),n}catch(i){return t.forEach((c,u)=>{n.errors.push({row:(a-1)*s+u+1,column:"batch",message:`Batch processing failed: ${i instanceof Error?i.message:"Unknown error"}`,value:null,severity:"error"})}),n}}static validateFile(t){const s=this.MAX_FILE_SIZE_MB*1024*1024;if(t.size>s)throw new Error(`File size exceeds maximum allowed size of ${this.MAX_FILE_SIZE_MB}MB`);const a=this.getFileExtension(t.name);if(!this.SUPPORTED_FORMATS.includes(a))throw new Error(`Unsupported file format. Supported formats: ${this.SUPPORTED_FORMATS.join(", ")}`)}static async parseCSVFile(t,s){return new Promise((a,n)=>{Is.parse(t,{header:!0,skipEmptyLines:!0,transformHeader:i=>i.trim(),transform:(i,c)=>{const u=i.trim();if(c.toLowerCase().includes("date")){if(u==="")return"";const d=u.match(/^(\d{2})-(\d{2})-(\d{4})$/);if(d){const[,m,y,N]=d,v=new Date(parseInt(N),parseInt(y)-1,parseInt(m));if(!isNaN(v.getTime()))return`${N}-${y}-${m}`}if(/^\d{4}-\d{2}-\d{2}$/.test(u))return u;const o=new Date(u);if(!isNaN(o.getTime())){const m=o.getFullYear(),y=String(o.getMonth()+1).padStart(2,"0"),N=String(o.getDate()).padStart(2,"0");return`${m}-${y}-${N}`}return u}if(c.toLowerCase().includes("quantity")||c.toLowerCase().includes("qty")||c.toLowerCase().includes("units")||c.toLowerCase().includes("rate")||c.toLowerCase().includes("price")||c.toLowerCase().includes("amount")||c.toLowerCase().includes("total")){if(u==="")return"";const d=parseFloat(u);return isNaN(d)?u:d}return u},step:(i,c)=>{const u=Math.round((t.size-c.streamer._input.length)/t.size*80);s?.({current:u,total:100,percentage:u,status:"parsing",message:"Parsing CSV file..."})},complete:i=>{if(i.errors.length>0){const c=i.errors.map(u=>`Row ${u.row}: ${u.message}`).join("; ");n(new Error(`CSV parsing errors: ${c}`))}else a(i.data)},error:i=>{n(new Error(`CSV parsing failed: ${i.message}`))}})})}static async parseExcelFile(t,s){return new Promise((a,n)=>{const i=new FileReader;i.onload=c=>{try{s?.({current:50,total:100,percentage:50,status:"parsing",message:"Reading Excel file..."});const u=new Uint8Array(c.target?.result),d=Gi(u,{type:"array"}),o=d.SheetNames[0],m=d.Sheets[o];s?.({current:80,total:100,percentage:80,status:"parsing",message:"Converting Excel data..."});const y=St.sheet_to_json(m,{header:1,defval:"",blankrows:!1,raw:!0});if(y.length===0){n(new Error("Excel file contains no data"));return}const N=(C,g,S)=>{if(C==null||C==="")return"";if(g.toLowerCase().includes("date")){if(typeof C=="string"){const D=C.trim();if(D==="")return"";const I=D.match(/^(\d{1,2})-(\d{1,2})-(\d{4})$/);if(I){const[,U,O,ee]=I,L=parseInt(U),P=parseInt(O),h=parseInt(ee);if(L>=1&&L<=31&&P>=1&&P<=12&&h>=1900&&h<=2100){const k=new Date(h,P-1,L);if(!isNaN(k.getTime())&&k.getFullYear()===h&&k.getMonth()===P-1&&k.getDate()===L){const x=String(h),T=String(P).padStart(2,"0"),b=String(L).padStart(2,"0");return`${x}-${T}-${b}`}}}const E=D.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);if(E){const[,U,O,ee]=E,L=parseInt(U),P=parseInt(O),h=parseInt(ee);if(L>=1&&L<=31&&P>=1&&P<=12&&h>=1900&&h<=2100){const k=new Date(h,P-1,L);if(!isNaN(k.getTime())&&k.getFullYear()===h&&k.getMonth()===P-1&&k.getDate()===L){const x=String(h),T=String(P).padStart(2,"0"),b=String(L).padStart(2,"0");return`${x}-${T}-${b}`}}}if(/^\d{4}-\d{2}-\d{2}$/.test(D)){const U=new Date(D);if(!isNaN(U.getTime()))return D}const q=new Date(D);if(!isNaN(q.getTime())){const U=q.getFullYear(),O=String(q.getMonth()+1).padStart(2,"0"),ee=String(q.getDate()).padStart(2,"0");return`${U}-${O}-${ee}`}return D}if(C instanceof Date){if(isNaN(C.getTime()))return"";const D=C.getFullYear(),I=String(C.getMonth()+1).padStart(2,"0"),E=String(C.getDate()).padStart(2,"0");return`${D}-${I}-${E}`}if(typeof C=="number"&&C>=1&&C<3e6){const D=new Date(1899,11,30),I=new Date(D.getTime()+C*864e5);if(!isNaN(I.getTime())){const E=I.getFullYear(),q=String(I.getMonth()+1).padStart(2,"0"),U=String(I.getDate()).padStart(2,"0");return`${E}-${q}-${U}`}}return""}if(g.toLowerCase().includes("quantity")||g.toLowerCase().includes("qty")||g.toLowerCase().includes("units")||g.toLowerCase().includes("rate")||g.toLowerCase().includes("price")||g.toLowerCase().includes("amount")||g.toLowerCase().includes("total")){if(typeof C=="number")return C;if(typeof C=="string"){const D=C.trim();if(D==="")return"";const I=parseFloat(D);if(!isNaN(I))return I}}return typeof C=="string"?C.trim():String(C)},v=y[0].map(C=>String(C).trim()),_=y.slice(1).map(C=>{const g={};return v.forEach((S,D)=>{g[S]=N(C[D],S)}),g});a(_)}catch(u){n(new Error(`Excel parsing failed: ${u instanceof Error?u.message:"Unknown error"}`))}},i.onerror=()=>{n(new Error("Failed to read Excel file"))},i.readAsArrayBuffer(t)})}static validateHeaders(t,s){const a=[];s.requiredColumns.forEach(i=>{t.includes(i)||a.push({row:0,column:i,message:`Required column '${i}' is missing`,value:null,severity:"error"})});const n=[...s.requiredColumns,...s.optionalColumns];return t.forEach(i=>{n.includes(i)||a.push({row:0,column:i,message:`Unknown column '${i}' will be ignored`,value:null,severity:"warning"})}),{isValid:a.filter(i=>i.severity==="error").length===0,errors:a}}static detectDuplicates(t,s){const a=[];if(t.length===0)return a;const n=t[0],i=Object.keys(n),c=v=>{i.map(_=>_.toLowerCase().trim());for(const _ of v){const C=_.toLowerCase().trim(),g=i.find(D=>D.toLowerCase().trim()===C);if(g)return g;const S=i.find(D=>D.toLowerCase().includes(C)||C.includes(D.toLowerCase()));if(S)return S}return null},u=c(["Date","date","purchase_date","purchaseDate","Purchase Date","Date Assigned","date_assigned","Date Completed","date_completed"]),d=c(["Purchase Code","Purchase_Code","purchase_code","purchaseCode","Code","Task ID","Task_ID","task_id","taskId","Product","product","product_name","productName","SKU","sku"]);if(!d&&!u)return a;const o=(v,_)=>{if(!_)return null;const C=v[_];return C==null||C===""?null:String(C).trim()},m=v=>{if(!v)return null;if(/^\d{4}-\d{2}-\d{2}$/.test(v))return v;const _=new Date(v);if(!isNaN(_.getTime())){const C=_.getFullYear(),g=String(_.getMonth()+1).padStart(2,"0"),S=String(_.getDate()).padStart(2,"0");return`${C}-${g}-${S}`}return v.toLowerCase()},y=new Map,N=new Map;if(s.duplicateChecker&&t.length>1){const v=new Map;t.forEach((_,C)=>{const g=C+1,S=(_["Task ID"]||_.task_id||_.task_id||"").toLowerCase().trim(),D=(_["Stock Name"]||_.stock_name||_.stock_name||"").toLowerCase().trim(),I=(_["Stock Source"]||_.stock_source||_.stock_source||"").toLowerCase().trim(),E=_["Date Assigned"]||_.date_assigned||_.date_assigned||"",q=(_.Process||_.process_name||_.process_name||"").toLowerCase().trim();let U="";if(E)if(typeof E=="string"){const ee=E.match(/^(\d{2})-(\d{2})-(\d{4})$/);if(ee){const[,L,P,h]=ee,k=new Date(parseInt(h),parseInt(P)-1,parseInt(L));isNaN(k.getTime())||(U=k.toISOString().split("T")[0])}else{const L=new Date(E);isNaN(L.getTime())||(U=L.toISOString().split("T")[0])}}else E instanceof Date&&(U=E.toISOString().split("T")[0]);const O=`${S}|${D}|${I}|${U}|${q}`;v.has(O)||v.set(O,[]),v.get(O).push(g)}),v.forEach((_,C)=>{if(_.length>1){const[g,S,D,I,E]=C.split("|");_.forEach(q=>{a.push({row:q,column:"Multiple Fields",message:`âš ï¸ Duplicate detected: The combination of Task ID "${g}", Stock Name "${S}", Stock Source "${D}", Date Assigned "${I}", and Process "${E}" appears in ${_.length} row(s) (Rows: ${_.join(", ")}). This may create duplicate records. You can still import if these are intentional additions.`,value:C})})}})}else t.forEach((v,_)=>{const C=_+1,g=m(o(v,u)),S=o(v,d)?.toLowerCase();if(g&&S){const D=`${g}|${S}`;y.has(D)||y.set(D,[]),y.get(D).push(C)}S&&(N.has(S)||N.set(S,[]),N.get(S).push(C))});if(s.existingData&&s.existingData.length>0)if(s.duplicateChecker)t.forEach((v,_)=>{const C=_+1;s.duplicateChecker(v,s.existingData)&&a.push({row:C,column:"Multiple Fields",message:"âš ï¸ This record already exists in the database. The combination of Task ID, Stock Name, Stock Source, Date Assigned, and Process matches an existing record. This will create a duplicate.",value:"Duplicate Record"})});else{const v=new Set;s.existingData.forEach(_=>{const C=m(_.date||_.purchase_date||_.purchaseDate||_.date_assigned||_.date_completed),g=(_.purchase_code||_.purchaseCode||_.code||_.task_id||_.taskId||_.product_name||_.product||_.sku||"").toLowerCase().trim();C&&g&&v.add(`${C}|${g}`)}),t.forEach((_,C)=>{const g=C+1,S=m(o(_,u)),D=o(_,d)?.toLowerCase();if(S&&D){const I=`${S}|${D}`;v.has(I)&&a.push({row:g,column:d||"Identifier",message:`âš ï¸ This record already exists in the database: Date "${S}" and ${d||"Identifier"} "${D}" combination matches an existing record. This will create a duplicate.`,value:`${S}|${D}`})}})}return y.forEach((v,_)=>{if(v.length>1){const[C,g]=_.split("|");v.forEach(S=>{a.push({row:S,column:d||"Identifier",message:`âš ï¸ Duplicate detected: Date "${C}" and ${d||"Identifier"} "${g}" combination appears in ${v.length} row(s) (Rows: ${v.join(", ")}). This may create duplicate records. You can still import if these are intentional additions.`,value:`${C}|${g}`})})}}),N.forEach((v,_)=>{if(v.length>1){let C=!1;y.forEach((g,S)=>{S.endsWith(`|${_}`)&&g.length>1&&(C=!0)}),C||v.forEach(g=>{a.push({row:g,column:d||"Identifier",message:`âš ï¸ ${d||"Identifier"} "${_}" appears ${v.length} time(s) (Rows: ${v.join(", ")}). Please verify if these are duplicate records or separate additions.`,value:_})})}}),a.length>0&&(console.log("Duplicate detection found:",a.length,"warnings"),console.log("Date field found:",u),console.log("Purchase Code field found:",purchaseCodeFieldName)),a}static validateRow(t,s,a,n,i){const c=[],u=[];return s.forEach(d=>{let o=d.field;i.validationHeaderMapper&&(o=i.validationHeaderMapper(d.field));let m,y=o;if(t[o]!==void 0)m=t[o],y=o;else{const v=o.toLowerCase(),_=Object.keys(t).find(C=>C.toLowerCase()===v);if(_)m=t[_],y=_;else{const C=Object.keys(t).find(g=>g.toLowerCase().includes(v)||v.includes(g.toLowerCase()));C&&(m=t[C],y=C)}}const N=this.applyValidationRule(m,d,t,n);if(N!==!0){const v=typeof N=="string"?N:d.message||`Validation failed for ${d.field}`;d.type==="required"||d.validator&&N===!1?c.push({row:a,column:y,message:v,value:m,severity:"error"}):u.push({row:a,column:y,message:v,value:m})}}),{errors:c,warnings:u}}static applyValidationRule(t,s,a,n){switch(s.type){case"required":return t!=null&&t!=="";case"format":if(s.options?.pattern)return s.options.pattern.test(String(t));if(s.field.toLowerCase().includes("date")){if(!t||t==="")return!0;if(t instanceof Date)return isNaN(t.getTime())?"Invalid date format. Use DD-MM-YYYY format (e.g., 15-01-2024)":!0;if(typeof t=="string"){const u=t.trim();if(/^\d{2}-\d{2}-\d{4}$/.test(u)){const[,o,m,y]=u.match(/^(\d{2})-(\d{2})-(\d{4})$/)||[],N=new Date(parseInt(y),parseInt(m)-1,parseInt(o));return isNaN(N.getTime())?"Invalid date format. Use DD-MM-YYYY format (e.g., 15-01-2024)":!0}if(/^\d{4}-\d{2}-\d{2}$/.test(u)){const o=new Date(u);return isNaN(o.getTime())?"Invalid date format. Use DD-MM-YYYY format (e.g., 15-01-2024)":!0}const d=new Date(u);if(!isNaN(d.getTime()))return!0}return"Invalid date format. Use DD-MM-YYYY format (e.g., 15-01-2024) or YYYY-MM-DD format (e.g., 2024-01-15)"}return!0;case"range":let i;if(typeof t=="number")i=t;else if(typeof t=="string"&&t.trim()!=="")i=parseFloat(t.trim());else return t==null||t===""?!0:"Value must be a number";return isNaN(i)?"Value must be a number":s.options?.min!==void 0&&i<s.options.min?`Value must be at least ${s.options.min}`:s.options?.max!==void 0&&i>s.options.max?`Value must be at most ${s.options.max}`:!0;case"unique":return n.filter(u=>u[s.field]===t).length<=1||`Duplicate value found: ${t}`;case"custom":if(s.validator){if(s.field.toLowerCase().includes("date")&&t instanceof Date)return isNaN(t.getTime())?"Invalid date format":!0;if(typeof t=="number"&&!isNaN(t)){const u=s.validator(t,a,n);return u===!1&&typeof s.validator=="function"?s.validator(String(t),a,n):u}return s.validator(t,a,n)}return!0;default:return!0}}static processRow(t){const s={};return Object.keys(t).forEach(a=>{let n=t[a];if(a.startsWith("_")){s[a]=n;return}if(typeof n=="string"){if(n=n.trim(),n===""&&(n=null),n&&!isNaN(Number(n))&&!isNaN(parseFloat(n))){const i=parseFloat(n);(i.toString()===n||i.toFixed(2)===n)&&(n=i)}n==="true"||n==="True"||n==="TRUE"?n=!0:(n==="false"||n==="False"||n==="FALSE")&&(n=!1)}s[a]=n}),s}static createBatches(t,s){const a=[];for(let n=0;n<t.length;n+=s)a.push(t.slice(n,n+s));return a}static getFileExtension(t){return t.toLowerCase().substring(t.lastIndexOf("."))}}const Pt=({config:r,className:t,disabled:s=!1,onImportComplete:a,onImportStart:n,variant:i="outline",size:c="default",acceptedFormats:u=[".csv",".xlsx",".xls","text/csv","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel"]})=>{const d=p.useRef(null),[o,m]=p.useState({isOpen:!1,step:"upload",file:null,parsedData:[],validationResult:null,importProgress:null,importResult:null,error:null}),y=()=>{m({isOpen:!1,step:"upload",file:null,parsedData:[],validationResult:null,importProgress:null,importResult:null,error:null})},N=()=>["ID","Created Date","Updated Date","Status"],v=()=>{const L=N(),P=["Status","Total Amount"];return[...L,...P]},_=()=>{const L=v(),h=r.requiredColumns.concat(r.optionalColumns||[]).filter(R=>!L.includes(R)),k=h.map(R=>R.toLowerCase().includes("date")?"15-01-2024":R.toLowerCase().includes("quantity")||R.toLowerCase().includes("qty")||R.toLowerCase().includes("units")||R.toLowerCase().includes("rate")||R.toLowerCase().includes("price")?10:R.toLowerCase().includes("code")||R.toLowerCase().includes("id")?"SAMPLE001":`Sample ${R}`),x=St.book_new(),T=[h,k],b=St.aoa_to_sheet(T);St.book_append_sheet(x,b,"Sample Data"),Ji(x,"sample-import-template.xls"),Yt.success("Sample XLS downloaded",{description:"Fill in your data and import the file"})},C=async L=>{try{m(k=>({...k,file:L,error:null,step:"preview"}));const P=await wa.parseFile(L,k=>{m(x=>({...x,importProgress:k}))}),h=wa.validateData(P,r,k=>{m(x=>({...x,importProgress:k}))});m(k=>({...k,parsedData:P,validationResult:h,importProgress:null}))}catch(P){m(h=>({...h,error:P instanceof Error?P.message:"Failed to parse file",importProgress:null}))}},g=async()=>{if(!o.validationResult)return;const L=o.validationResult.validData.length>0,P=o.validationResult.errors.filter(k=>k.severity==="error").length===0&&o.validationResult.warnings.length>0;if(!L&&!P){Yt.error("Cannot import",{description:"No valid rows to import. Please fix validation errors first."});return}const h=L?o.validationResult.validData:o.parsedData;try{m(x=>({...x,step:"processing",error:null})),n?.();const k=await wa.processImport(h,r,x=>{m(T=>({...T,importProgress:x}))});m(x=>({...x,step:"complete",importResult:k,importProgress:null})),k.successfulRows>0&&k.failedRows===0?Yt.success("Import completed successfully",{description:`${k.successfulRows} rows imported successfully`}):k.successfulRows>0&&k.failedRows>0?Yt.warning("Import completed with errors",{description:`${k.successfulRows} successful, ${k.failedRows} failed. Check console for details.`,duration:1e4}):k.failedRows>0?Yt.error("Import failed",{description:`All ${k.failedRows} rows failed. Check console for details.`,duration:1e4}):Yt.error("Import failed",{description:"No rows were imported. Check console for details.",duration:1e4}),console.log("ðŸ“Š Import Complete:",{totalRows:k.totalRows,successfulRows:k.successfulRows,failedRows:k.failedRows,errors:k.errors,warnings:k.warnings}),a?.(k)}catch(k){m(x=>({...x,error:k instanceof Error?k.message:"Import failed",importProgress:null})),Yt.error("Import failed",{description:k instanceof Error?k.message:"An unexpected error occurred"})}},S=L=>{L.preventDefault(),L.stopPropagation()},D=L=>{L.preventDefault(),L.stopPropagation();const h=Array.from(L.dataTransfer.files)[0];h&&C(h)},I=()=>{const L=v();r.requiredColumns.concat(r.optionalColumns||[]).filter(x=>!L.includes(x));const h=r.requiredColumns.filter(x=>!L.includes(x)),k=(r.optionalColumns||[]).filter(x=>!L.includes(x));return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(He,{children:[e.jsx(is,{className:"h-4 w-4"}),e.jsxs(ze,{className:"space-y-2",children:[e.jsx("div",{className:"font-medium",children:"Import Instructions:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-sm",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Date Format:"})," Use ",e.jsx("code",{className:"bg-gray-100 px-1 rounded",children:"DD-MM-YYYY"})," format (e.g., 15-01-2024) or ",e.jsx("code",{className:"bg-gray-100 px-1 rounded",children:"YYYY-MM-DD"})," format (e.g., 2024-01-15)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Supported Formats:"})," CSV (",e.jsx("code",{className:"bg-gray-100 px-1 rounded",children:".csv"}),"), Excel (",e.jsx("code",{className:"bg-gray-100 px-1 rounded",children:".xlsx"}),", ",e.jsx("code",{className:"bg-gray-100 px-1 rounded",children:".xls"}),")"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Required Fields:"})," Must be filled in for all rows"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Optional Fields:"})," Can be left empty"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Auto-Generated Fields:"})," ",L.join(", ")," will be automatically generated by the system"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"CSV Format:"})," First row must contain column headers matching the sample template"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"File Size:"})," Maximum ",r.maxFileSize||50,"MB"]})]})]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 space-y-2",children:[e.jsx("div",{className:"font-medium text-blue-900",children:"Field Information:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-blue-800 mb-1",children:["Required Fields (",h.length,"):"]}),e.jsx("div",{className:"text-blue-700",children:h.length>0?e.jsx("ul",{className:"list-disc list-inside space-y-0.5",children:h.map((x,T)=>e.jsx("li",{children:x},T))}):e.jsx("span",{className:"text-gray-500",children:"None (all excluded)"})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-blue-800 mb-1",children:["Optional Fields (",k.length,"):"]}),e.jsx("div",{className:"text-blue-700",children:k.length>0?e.jsx("ul",{className:"list-disc list-inside space-y-0.5",children:k.map((x,T)=>e.jsx("li",{children:x},T))}):e.jsx("span",{className:"text-gray-500",children:"None"})})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs($,{variant:"outline",size:"sm",onClick:x=>{x.stopPropagation(),_()},className:"gap-2",children:[e.jsx(ks,{className:"h-4 w-4"}),"Download Sample XLS"]})}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-gray-400 transition-colors cursor-pointer",onDragOver:S,onDrop:D,onClick:()=>d.current?.click(),children:[e.jsx(ra,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"Drop your file here or click to browse"}),e.jsxs("p",{className:"text-sm text-gray-500 mb-4",children:["Supported formats: ",u.join(", ")]}),e.jsx($,{variant:"outline",children:"Choose File"})]}),e.jsx("input",{ref:d,type:"file",accept:u.join(","),onChange:x=>{const T=x.target.files?.[0];T&&C(T)},className:"hidden"}),o.importProgress&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:o.importProgress.message}),e.jsxs("span",{children:[o.importProgress.percentage,"%"]})]}),e.jsx(Ps,{value:o.importProgress.percentage})]}),o.error&&e.jsxs(He,{variant:"destructive",children:[e.jsx(is,{className:"h-4 w-4"}),e.jsx(ze,{children:o.error})]})]})},E=()=>{if(!o.validationResult)return null;const{validData:L,invalidData:P,errors:h,warnings:k}=o.validationResult;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Import Preview"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Qe,{variant:"outline",className:"text-green-600",children:[e.jsx(Qa,{className:"h-3 w-3 mr-1"}),L.length," Valid"]}),P.length>0&&e.jsxs(Qe,{variant:"outline",className:"text-red-600",children:[e.jsx(is,{className:"h-3 w-3 mr-1"}),P.length," Invalid"]}),k.length>0&&e.jsxs(Qe,{variant:"outline",className:"text-yellow-600",children:[e.jsx(is,{className:"h-3 w-3 mr-1"}),k.length," Warnings"]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[o.file?.name.endsWith(".csv")?e.jsx(ks,{className:"h-4 w-4"}):e.jsx(Lr,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:o.file?.name})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[o.parsedData.length," rows found"]})]}),h.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-red-600",children:"Validation Errors"}),e.jsxs("div",{className:"max-h-32 overflow-y-auto space-y-1",children:[h.slice(0,10).map((x,T)=>e.jsx(He,{variant:"destructive",className:"py-2",children:e.jsxs(ze,{className:"text-xs",children:["Row ",x.row,', Column "',x.column,'": ',x.message]})},T)),h.length>10&&e.jsxs("p",{className:"text-xs text-gray-500",children:["... and ",h.length-10," more errors"]})]})]}),k.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"font-medium text-yellow-600 flex items-center gap-2",children:[e.jsx(is,{className:"h-4 w-4"}),"Warnings (",k.length,")"]}),e.jsxs("div",{className:"max-h-48 overflow-y-auto space-y-2 border border-yellow-200 rounded-lg p-3 bg-yellow-50",children:[k.slice(0,10).map((x,T)=>e.jsxs(He,{className:"py-2 border-yellow-300 bg-yellow-50",children:[e.jsx(is,{className:"h-4 w-4 text-yellow-600"}),e.jsxs(ze,{className:"text-sm",children:[e.jsxs("strong",{className:"text-yellow-800",children:["Row ",x.row]})," - ",x.message]})]},T)),k.length>10&&e.jsxs("p",{className:"text-xs text-yellow-700 font-medium",children:["... and ",k.length-10," more warnings. Please review all warnings before importing."]})]})]}),(L.length>0||o.parsedData.length>0)&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium",children:L.length>0?`Sample Data (First ${Math.min(3,L.length)} rows of ${L.length} valid)`:`Preview Data (First ${Math.min(3,o.parsedData.length)} rows of ${o.parsedData.length} total)`}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-xs border",children:[e.jsx("thead",{children:e.jsx("tr",{className:"bg-gray-50",children:(L.length>0?Object.keys(L[0]||{}):Object.keys(o.parsedData[0]||{})).slice(0,8).filter(x=>!x.startsWith("_")).map(x=>e.jsx("th",{className:"border px-2 py-1 text-left font-medium",children:x},x))})}),e.jsx("tbody",{children:(L.length>0?L:o.parsedData).slice(0,3).map((x,T)=>e.jsx("tr",{children:Object.keys(x).slice(0,8).filter(b=>!b.startsWith("_")).map(b=>e.jsxs("td",{className:"border px-2 py-1",children:[String(x[b]||"").substring(0,20),String(x[b]||"").length>20&&"..."]},b))},T))})]})})]}),L.length===0&&k.length>0&&e.jsxs(He,{className:"bg-yellow-50 border-yellow-200",children:[e.jsx(is,{className:"h-4 w-4 text-yellow-600"}),e.jsxs(ze,{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"Note:"})," There are ",k.length,' warning(s) in the import file. Review the warnings above. If the data looks correct despite the warnings, you can still import it by clicking "Import Anyway".']})]}),L.length===0&&k.length===0&&o.parsedData.length>0&&e.jsxs(He,{className:"bg-red-50 border-red-200",children:[e.jsx(is,{className:"h-4 w-4 text-red-600"}),e.jsxs(ze,{className:"text-sm text-red-800",children:[e.jsx("strong",{children:"No valid rows found."})," Please check the validation errors above and fix your data before importing."]})]})]})},q=()=>e.jsxs("div",{className:"space-y-4 text-center",children:[e.jsx(Ve,{className:"h-12 w-12 animate-spin mx-auto text-blue-500"}),e.jsx("h3",{className:"text-lg font-medium",children:"Processing Import"}),o.importProgress&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:o.importProgress.message}),e.jsxs("span",{children:[o.importProgress.percentage,"%"]})]}),e.jsx(Ps,{value:o.importProgress.percentage}),o.importProgress.currentBatch&&o.importProgress.totalBatches&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Processing batch ",o.importProgress.currentBatch," of ",o.importProgress.totalBatches]})]})]}),U=()=>{if(!o.importResult)return null;const{successfulRows:L,failedRows:P,totalRows:h,errors:k}=o.importResult;return e.jsxs("div",{className:"space-y-4 text-center",children:[e.jsx(Qa,{className:"h-12 w-12 mx-auto text-green-500"}),e.jsx("h3",{className:"text-lg font-medium",children:"Import Complete"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{className:"bg-green-50 p-3 rounded-lg",children:[e.jsx("div",{className:"font-medium text-green-600",children:L}),e.jsx("div",{className:"text-green-600",children:"Successful"})]}),e.jsxs("div",{className:"bg-red-50 p-3 rounded-lg",children:[e.jsx("div",{className:"font-medium text-red-600",children:P}),e.jsx("div",{className:"text-red-600",children:"Failed"})]}),e.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg",children:[e.jsx("div",{className:"font-medium text-blue-600",children:h}),e.jsx("div",{className:"text-blue-600",children:"Total"})]})]}),k.length>0&&e.jsxs("div",{className:"space-y-2 text-left",children:[e.jsx("h4",{className:"font-medium text-red-600",children:"Import Errors"}),e.jsxs("div",{className:"max-h-32 overflow-y-auto space-y-1",children:[k.slice(0,5).map((x,T)=>e.jsx(He,{variant:"destructive",className:"py-2",children:e.jsxs(ze,{className:"text-xs",children:["Row ",x.row,": ",x.message]})},T)),k.length>5&&e.jsxs("p",{className:"text-xs text-gray-500",children:["... and ",k.length-5," more errors"]})]})]})]})},O=()=>{switch(o.step){case"upload":return"Import Data";case"preview":return"Review Import Data";case"processing":return"Processing Import";case"complete":return"Import Complete";default:return"Import Data"}},ee=()=>{if(o.step==="preview"&&o.validationResult){const L=o.validationResult.validData.length>0,P=o.validationResult.errors.filter(h=>h.severity==="error").length===0&&o.validationResult.warnings.length>0;return L||P}return!1};return e.jsxs(e.Fragment,{children:[e.jsxs($,{variant:i,size:c,className:t,disabled:s,onClick:()=>m(L=>({...L,isOpen:!0})),children:[e.jsx(ra,{className:"h-4 w-4 mr-2"}),"Import"]}),e.jsx(ot,{open:o.isOpen,onOpenChange:L=>{L||y()},children:e.jsxs(at,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(rt,{children:[e.jsx(it,{children:O()}),e.jsxs(lt,{children:[o.step==="upload"&&"Select a file to import data",o.step==="preview"&&"Review the data before importing",o.step==="processing"&&"Please wait while we process your data",o.step==="complete"&&"Import has been completed"]})]}),e.jsxs("div",{className:"py-4",children:[o.step==="upload"&&I(),o.step==="preview"&&E(),o.step==="processing"&&q(),o.step==="complete"&&U()]}),e.jsxs(nt,{children:[o.step==="upload"&&e.jsx($,{variant:"outline",onClick:y,children:"Cancel"}),o.step==="preview"&&e.jsxs(e.Fragment,{children:[e.jsx($,{variant:"outline",onClick:()=>m(L=>({...L,step:"upload"})),children:"Back"}),e.jsx($,{onClick:g,disabled:!ee(),variant:(o.validationResult?.warnings&&o.validationResult.warnings.length>0,"default"),children:o.validationResult?.warnings&&o.validationResult.warnings.length>0?`Import Anyway (${o.validationResult.validData.length||o.parsedData.length} rows)`:`Import ${o.validationResult?.validData.length||o.parsedData.length||0} Rows`})]}),o.step==="complete"&&e.jsx($,{onClick:y,children:"Close"})]})]})})]})},Pn=p.forwardRef(({className:r,children:t,...s},a)=>e.jsxs(Mr,{ref:a,className:ie("relative overflow-hidden",r),...s,children:[e.jsx(li,{className:"h-full w-full rounded-[inherit]",children:t}),e.jsx(Tn,{}),e.jsx(ci,{})]}));Pn.displayName=Mr.displayName;const Tn=p.forwardRef(({className:r,orientation:t="vertical",...s},a)=>e.jsx(Or,{ref:a,orientation:t,className:ie("flex touch-none select-none transition-colors",t==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",t==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",r),...s,children:e.jsx(di,{className:"relative flex-1 rounded-full bg-border"})}));Tn.displayName=Or.displayName;const jt=p.forwardRef(({className:r,...t},s)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:s,className:ie("w-full caption-bottom text-sm",r),...t})}));jt.displayName="Table";const yt=p.forwardRef(({className:r,...t},s)=>e.jsx("thead",{ref:s,className:ie("[&_tr]:border-b",r),...t}));yt.displayName="TableHeader";const vt=p.forwardRef(({className:r,...t},s)=>e.jsx("tbody",{ref:s,className:ie("[&_tr:last-child]:border-0",r),...t}));vt.displayName="TableBody";const Rl=p.forwardRef(({className:r,...t},s)=>e.jsx("tfoot",{ref:s,className:ie("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",r),...t}));Rl.displayName="TableFooter";const Ee=p.forwardRef(({className:r,...t},s)=>e.jsx("tr",{ref:s,className:ie("border-b transition-colors data-[state=selected]:bg-muted hover:bg-muted/50",r),...t}));Ee.displayName="TableRow";const X=p.forwardRef(({className:r,...t},s)=>e.jsx("th",{ref:s,className:ie("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",r),...t}));X.displayName="TableHead";const Q=p.forwardRef(({className:r,...t},s)=>e.jsx("td",{ref:s,className:ie("p-4 align-middle [&:has([role=checkbox])]:pr-0",r),...t}));Q.displayName="TableCell";const ql=p.forwardRef(({className:r,...t},s)=>e.jsx("caption",{ref:s,className:ie("mt-4 text-sm text-muted-foreground",r),...t}));ql.displayName="TableCaption";const ds=({data:r,columns:t,onSort:s,currentSort:a,loading:n=!1,emptyMessage:i="No data available",searchable:c=!0,filterable:u=!1,actions:d=[],onRowClick:o,className:m,maxHeight:y="600px",stickyHeader:N=!0,striped:v=!0,bordered:_=!1,compact:C=!1,selectable:g=!1,selectedRows:S=[],onSelectionChange:D,rowKey:I="id"})=>{const[E,q]=p.useState(""),[U,O]=p.useState({}),ee=p.useMemo(()=>a?[...r].sort((M,J)=>{const V=M[a.column],le=J[a.column];let ge=0;switch(a.dataType){case"number":ge=(Number(V)||0)-(Number(le)||0);break;case"date":const we=new Date(V),H=new Date(le);ge=we.getTime()-H.getTime();break;case"boolean":ge=V===le?0:V?1:-1;break;default:ge=String(V||"").localeCompare(String(le||""))}return a.direction==="desc"?-ge:ge}):r,[r,a]),L=p.useMemo(()=>{let M=ee;if(E&&c){const J=E.toLowerCase();M=M.filter(V=>t.some(le=>le.searchable===!1?!1:String(V[le.key]||"").toLowerCase().includes(J)))}return u&&Object.entries(U).forEach(([J,V])=>{if(V){const le=V.toLowerCase();M=M.filter(ge=>String(ge[J]||"").toLowerCase().includes(le))}}),M},[ee,E,U,t,c,u]),P=M=>{if(!M.sortable||!s)return;let J="asc";a?.column===M.key&&(J=a.direction==="asc"?"desc":"asc"),s({column:M.key,direction:J,dataType:M.dataType})},h=(M,J)=>{if(!g||!D)return;const V=M[I];let le=[...S];J?le.some(ge=>ge[I]===V)||le.push(M):le=le.filter(ge=>ge[I]!==V),D(le)},k=M=>{!g||!D||D(M?L:[])},x=M=>g?S.some(J=>J[I]===M[I]):!1,T=()=>!g||L.length===0?!1:L.every(M=>x(M)),b=M=>M.sortable?a?.column===M.key?a.direction==="asc"?e.jsx(ui,{className:"h-4 w-4"}):e.jsx(mi,{className:"h-4 w-4"}):e.jsx(pi,{className:"h-4 w-4 opacity-50"}):null,R=(M,J,V)=>{if(J.formatter)return J.formatter(M,V);if(M==null)return e.jsx("span",{className:"text-gray-400",children:"â€”"});switch(J.dataType){case"boolean":return e.jsx(Qe,{variant:M?"default":"secondary",children:M?"Yes":"No"});case"date":return xa(M);case"number":return typeof M=="number"?M.toLocaleString():M;default:return String(M)}},Y=M=>{switch(M){case"center":return"text-center";case"right":return"text-right";default:return"text-left"}};return e.jsxs("div",{className:`space-y-4 ${m}`,children:[(c||u)&&e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4",children:[c&&e.jsxs("div",{className:"relative flex-1",children:[e.jsx(pt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(B,{placeholder:"Search...",value:E,onChange:M=>q(M.target.value),className:"pl-10 text-sm"})]}),u&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ts,{className:"h-4 w-4 text-gray-400 mt-3"}),t.slice(0,3).map(M=>e.jsx(B,{placeholder:`Filter ${M.label}...`,value:U[M.key]||"",onChange:J=>O(V=>({...V,[M.key]:J.target.value})),className:"w-40"},M.key))]})]}),E&&e.jsxs("div",{className:"text-sm text-gray-500",children:["Showing ",L.length," of ",r.length," results"]}),e.jsx("div",{className:`rounded-md border ${_?"border-2":""} overflow-hidden`,children:y&&y!=="none"?e.jsx("div",{className:"overflow-x-auto",children:e.jsx(Pn,{style:{maxHeight:y},className:"relative",children:e.jsxs(jt,{className:"min-w-full",children:[e.jsx(yt,{className:N?"sticky top-0 bg-gray-100 z-10":"bg-gray-100",style:N?{position:"sticky",top:0,zIndex:10}:void 0,children:e.jsxs(Ee,{children:[g&&e.jsx(X,{className:"w-12",children:e.jsx("input",{type:"checkbox",checked:T(),onChange:M=>k(M.target.checked),className:"rounded border-gray-300"})}),t.map(M=>e.jsx(X,{className:`${Y(M.align)} ${M.sortable?"cursor-pointer hover:bg-gray-50":""} ${M.headerClassName||""}`,style:{width:M.width},onClick:()=>P(M),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:M.label}),b(M)]})},M.key)),d.length>0&&e.jsx(X,{className:"w-12",children:"Actions"})]})}),e.jsx(vt,{children:n?e.jsx(Ee,{children:e.jsx(Q,{colSpan:t.length+(g?1:0)+(d.length>0?1:0),className:"text-center py-8",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-900"}),"Loading..."]})})}):L.length===0?e.jsx(Ee,{children:e.jsx(Q,{colSpan:t.length+(g?1:0)+(d.length>0?1:0),className:"text-center py-8 text-gray-500",children:i})}):L.map((M,J)=>e.jsxs(Ee,{className:`
                      ${v&&J%2===1?"bg-gray-50":""}
                      ${C?"h-10":""}
                      ${o?"cursor-pointer hover:bg-gray-100":""}
                      ${x(M)?"bg-blue-50 border-blue-200":""}
                    `,onClick:()=>o?.(M),children:[g&&e.jsx(Q,{children:e.jsx("input",{type:"checkbox",checked:x(M),onChange:V=>{V.stopPropagation(),h(M,V.target.checked)},className:"rounded border-gray-300"})}),t.map(V=>e.jsx(Q,{className:`${Y(V.align)} ${V.cellClassName||""}`,children:R(M[V.key],V,M)},V.key)),d.length>0&&e.jsx(Q,{children:e.jsxs(oa,{children:[e.jsx(la,{asChild:!0,children:e.jsx($,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:V=>V.stopPropagation(),children:e.jsx(Ya,{className:"h-4 w-4"})})}),e.jsx(Bs,{align:"end",children:d.map((V,le)=>e.jsxs(Cs,{onClick:ge=>{ge.stopPropagation(),V.onClick(M)},disabled:V.disabled?.(M),className:V.variant==="destructive"?"text-red-600":"",children:[V.icon&&e.jsx("span",{className:"mr-2",children:V.icon}),V.label]},le))})]})})]},M[I]||J))})]})})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(jt,{className:"min-w-full",children:[e.jsx(yt,{className:N?"sticky top-0 bg-gray-100 z-10":"bg-gray-100",style:N?{position:"sticky",top:0,zIndex:10}:void 0,children:e.jsxs(Ee,{children:[g&&e.jsx(X,{className:"w-12",children:e.jsx("input",{type:"checkbox",checked:T(),onChange:M=>k(M.target.checked),className:"rounded border-gray-300"})}),t.map(M=>e.jsx(X,{className:`${Y(M.align)} ${M.sortable?"cursor-pointer hover:bg-gray-50":""} ${M.headerClassName||""}`,style:{width:M.width},onClick:()=>P(M),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:M.label}),b(M)]})},M.key)),d.length>0&&e.jsx(X,{className:"w-12",children:"Actions"})]})}),e.jsx(vt,{children:n?e.jsx(Ee,{children:e.jsx(Q,{colSpan:t.length+(g?1:0)+(d.length>0?1:0),className:"text-center py-8",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-900"}),"Loading..."]})})}):L.length===0?e.jsx(Ee,{children:e.jsx(Q,{colSpan:t.length+(g?1:0)+(d.length>0?1:0),className:"text-center py-8 text-gray-500",children:i})}):L.map((M,J)=>e.jsxs(Ee,{className:`
                      ${v&&J%2===1?"bg-gray-50":""}
                      ${C?"h-10":""}
                      ${o?"cursor-pointer hover:bg-gray-100":""}
                      ${x(M)?"bg-blue-50 border-blue-200":""}
                    `,onClick:()=>o?.(M),children:[g&&e.jsx(Q,{children:e.jsx("input",{type:"checkbox",checked:x(M),onChange:V=>{V.stopPropagation(),h(M,V.target.checked)},className:"rounded border-gray-300"})}),t.map(V=>e.jsx(Q,{className:`${Y(V.align)} ${V.cellClassName||""}`,children:R(M[V.key],V,M)},V.key)),d.length>0&&e.jsx(Q,{children:e.jsxs(oa,{children:[e.jsx(la,{asChild:!0,children:e.jsx($,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:V=>V.stopPropagation(),children:e.jsx(Ya,{className:"h-4 w-4"})})}),e.jsx(Bs,{align:"end",children:d.map((V,le)=>e.jsxs(Cs,{onClick:ge=>{ge.stopPropagation(),V.onClick(M)},disabled:V.disabled?.(M),className:V.variant==="destructive"?"text-red-600":"",children:[V.icon&&e.jsx("span",{className:"mr-2",children:V.icon}),V.label]},le))})]})})]},M[I]||J))})]})})}),g&&S.length>0&&e.jsxs("div",{className:"flex items-center justify-between bg-blue-50 p-3 rounded-lg",children:[e.jsxs("span",{className:"text-sm text-blue-700",children:[S.length," row",S.length>1?"s":""," selected"]}),e.jsx($,{variant:"outline",size:"sm",onClick:()=>D?.([]),children:"Clear Selection"})]})]})},Ts={view:r=>({label:"View",icon:e.jsx(Ur,{className:"h-4 w-4"}),onClick:r}),edit:r=>({label:"Edit",icon:e.jsx(ss,{className:"h-4 w-4"}),onClick:r}),delete:r=>({label:"Delete",icon:e.jsx($t,{className:"h-4 w-4"}),onClick:r,variant:"destructive"})},as=r=>{const[t,s]=et.useState(r),a=et.useCallback(c=>{s(c)},[]),n=et.useCallback(()=>{s(void 0)},[]),i=et.useCallback(c=>t?[...c].sort((u,d)=>{const o=u[t.column],m=d[t.column];let y=0;switch(t.dataType){case"number":y=(Number(o)||0)-(Number(m)||0);break;case"date":const N=new Date(o),v=new Date(m);y=N.getTime()-v.getTime();break;case"boolean":y=o===m?0:o?1:-1;break;default:y=String(o||"").localeCompare(String(m||""))}return t.direction==="desc"?-y:y}):c,[t]);return{currentSort:t,handleSort:a,clearSort:n,getSortedData:i}},re=vi,ne=bi,se=p.forwardRef(({className:r,children:t,...s},a)=>e.jsxs(Kr,{ref:a,className:ie("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",r),...s,children:[t,e.jsx(hi,{asChild:!0,children:e.jsx($a,{className:"h-4 w-4 opacity-50"})})]}));se.displayName=Kr.displayName;const Dn=p.forwardRef(({className:r,...t},s)=>e.jsx(Vr,{ref:s,className:ie("flex cursor-default items-center justify-center py-1",r),...t,children:e.jsx(xi,{className:"h-4 w-4"})}));Dn.displayName=Vr.displayName;const En=p.forwardRef(({className:r,...t},s)=>e.jsx(Br,{ref:s,className:ie("flex cursor-default items-center justify-center py-1",r),...t,children:e.jsx($a,{className:"h-4 w-4"})}));En.displayName=Br.displayName;const ae=p.forwardRef(({className:r,children:t,position:s="popper",...a},n)=>e.jsx(gi,{children:e.jsxs(Hr,{ref:n,className:ie("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",r),position:s,...a,children:[e.jsx(Dn,{}),e.jsx(fi,{className:ie("p-1",s==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),e.jsx(En,{})]})}));ae.displayName=Hr.displayName;const Al=p.forwardRef(({className:r,...t},s)=>e.jsx(zr,{ref:s,className:ie("py-1.5 pl-8 pr-2 text-sm font-semibold",r),...t}));Al.displayName=zr.displayName;const w=p.forwardRef(({className:r,children:t,...s},a)=>e.jsxs(Qr,{ref:a,className:ie("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",r),...s,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(ji,{children:e.jsx(Tr,{className:"h-4 w-4"})})}),e.jsx(yi,{children:t})]}));w.displayName=Qr.displayName;const Fl=p.forwardRef(({className:r,...t},s)=>e.jsx(Yr,{ref:s,className:ie("-mx-1 my-1 h-px bg-muted",r),...t}));Fl.displayName=Yr.displayName;const Il=()=>{const[r,t]=p.useState(!1),[s,a]=p.useState(!1),[n,i]=p.useState(null),[c,u]=p.useState(null),[d,o]=p.useState(""),[m,y]=p.useState([]),[N,v]=p.useState("all"),[_,C]=p.useState("all"),[g,S]=p.useState({from:"",to:""}),[D,I]=p.useState(1),[E,q]=p.useState(50),U=ut(),{toast:O}=Fe(),{user:ee,loading:L}=ft(),{config:P}=Rt("purchases"),{validationRules:h,canImport:k}=qt("purchases"),{currentSort:x,handleSort:T,getSortedData:b}=as(),[R,Y]=p.useState({purchase_code:"",date:new Date().toISOString().split("T")[0],vendor_id:"",stock_id:"",quantity:"",rate:"",total_amount:""});p.useEffect(()=>{const{quantity:A,rate:he}=R;if(A&&he){const ve=parseFloat(A)*parseFloat(he);Y(je=>({...je,total_amount:String(ve)}))}else Y(ve=>({...ve,total_amount:""}))},[R.quantity,R.rate]);const{data:M,isLoading:J,error:V}=fe({queryKey:["purchases"],queryFn:()=>Wt.getAll(),enabled:!!ee}),{data:le,isLoading:ge,error:we}=fe({queryKey:["vendors"],queryFn:()=>Ls.getAll(),enabled:!!ee}),{data:H,isLoading:de,error:Ne}=fe({queryKey:["stocks"],queryFn:()=>Bt.getAll(),enabled:!!ee}),Le=et.useMemo(()=>le?new Map(le.map(A=>[A.$id,A.vendor_name])):new Map,[le]),mt=et.useMemo(()=>H?new Map(H.map(A=>[A.$id,A.stock_name])):new Map,[H]),ye=et.useMemo(()=>M?M.map(A=>({...A,id:A.$id,vendor_name:Le.get(A.vendor_id)||"Unknown Vendor",stock_name:mt.get(A.stock_id)||"Unknown Stock"})):[],[M,Le,mt]),Pe=De({mutationFn:A=>c?Wt.update(c.id,A):Wt.create(A),onSuccess:()=>{U.invalidateQueries({queryKey:["purchases"]}),t(!1),u(null),O({title:c?"Purchase Updated":"Purchase Created",description:`The purchase has been successfully ${c?"updated":"saved"}.`})},onError:A=>{O({title:"Error",description:A.message||`Failed to ${c?"update":"create"} purchase.`,variant:"destructive"})}}),Be=De({mutationFn:A=>Wt.delete(A),onSuccess:()=>{U.invalidateQueries({queryKey:["purchases"]}),O({title:"Purchase Deleted",description:"The purchase has been successfully deleted."})},onError:A=>{O({title:"Error",description:A.message||"Failed to delete purchase.",variant:"destructive"})}}),Ke=A=>{i(A),a(!0)},Je=()=>{n&&(Be.mutate(n),i(null),a(!1))},bt=A=>{u(A),Y({...A,date:new Date(A.date).toISOString().split("T")[0],quantity:String(A.quantity),rate:String(A.rate),total_amount:String(A.total_amount),vendor_id:A.vendor_id,stock_id:A.stock_id}),t(!0)},Lt=A=>{if(A.preventDefault(),!R.purchase_code||!R.date||!R.vendor_id||!R.stock_id||!R.quantity||!R.rate){O({title:"Missing Fields",description:"Please fill out all required fields.",variant:"destructive"});return}const he={purchase_code:R.purchase_code,date:R.date,vendor_id:R.vendor_id,stock_id:R.stock_id,quantity:parseFloat(R.quantity),rate:parseFloat(R.rate),total_amount:parseFloat(R.total_amount)};Pe.mutate(he)},ht=ye.filter(A=>{const he=A.purchase_code.toLowerCase().includes(d.toLowerCase())||A.vendor_name.toLowerCase().includes(d.toLowerCase())||A.stock_name.toLowerCase().includes(d.toLowerCase()),ve=N==="all"||A.vendor_id===N,je=_==="all"||A.stock_id===_,gt=new Date(A.date),Te=(!g.from||gt>=new Date(g.from))&&(!g.to||gt<=new Date(g.to));return he&&ve&&je&&Te}),xt=et.useMemo(()=>{const A=new Map;return ye.forEach(he=>{A.has(he.vendor_id)||A.set(he.vendor_id,{id:he.vendor_id,name:he.vendor_name})}),Array.from(A.values()).sort((he,ve)=>he.name.localeCompare(ve.name))},[ye]),Nt=et.useMemo(()=>{const A=new Map;return ye.forEach(he=>{A.has(he.stock_id)||A.set(he.stock_id,{id:he.stock_id,name:he.stock_name})}),Array.from(A.values()).sort((he,ve)=>he.name.localeCompare(ve.name))},[ye]),wt=ht.length,l=Math.ceil(wt/E),W=(D-1)*E,f=W+E,z=ht.slice(W,f);p.useEffect(()=>{I(1)},[d,N,_,g,E]);const ue=De({mutationFn:async A=>{await Promise.all(A.map(he=>Wt.delete(he)))},onSuccess:()=>{U.invalidateQueries({queryKey:["purchases"]}),y([]),O({title:"Success",description:"Selected purchases deleted successfully."})},onError:()=>{O({title:"Error",description:"Failed to delete selected purchases.",variant:"destructive"})}}),xe=()=>{if(m.length===0){O({title:"No Selection",description:"Please select purchases to delete.",variant:"destructive"});return}confirm(`Are you sure you want to delete ${m.length} selected purchase(s)?`)&&ue.mutate(m.map(A=>A.id))},qe=()=>{if(m.length===0){O({title:"No Selection",description:"Please select purchases to export.",variant:"destructive"});return}O({title:"Export",description:`Exporting ${m.length} selected purchase(s)...`})},$e=L||J||ge||de,Me=V||we||Ne;return $e?e.jsx("div",{children:"Loading..."}):Me?(console.error("Data loading error:",{purchasesError:V,vendorsError:we,stocksError:Ne}),e.jsx("div",{children:"Error loading data."})):e.jsx("div",{className:"p-4",children:e.jsxs(G,{children:[e.jsx(me,{children:e.jsxs(pe,{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Purchases"}),e.jsxs($,{onClick:()=>t(!0),children:[e.jsx(Tt,{className:"mr-2 h-4 w-4"})," Add New Purchase"]})]})}),e.jsxs(Z,{children:[e.jsx(G,{className:"mb-6",children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(pt,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(B,{placeholder:"Search purchases...",className:"pl-10",value:d,onChange:A=>o(A.target.value)})]}),k&&P&&e.jsx(Pt,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:P.exportColumns.filter(A=>A.required).map(A=>A.exportHeader),optionalColumns:P.exportColumns.filter(A=>!A.required).map(A=>A.exportHeader),validationRules:h,maxFileSize:50,existingData:M||[],validationHeaderMapper:A=>{const he=P.exportColumns.find(ve=>ve.dataKey===A);return he?he.exportHeader:A},columnMapper:A=>{const he=P.exportColumns.find(ve=>ve.exportHeader===A);return he?he.dataKey==="vendorName"?"vendor_name":he.dataKey==="stockName"?"stock_name":{purchaseCode:"purchase_code",date:"date",quantity:"quantity",rate:"rate",totalAmount:"total_amount"}[he.dataKey]||he.dataKey:A},dataProcessor:async A=>{let he=A["Vendor Name"]||A.vendor_name||A.vendor_name||A.vendor_id;if(!he||he==="")throw new Error("Vendor Name is required");const ve=String(he).trim(),je=le?.find(te=>te.vendor_name.toLowerCase()===ve.toLowerCase());if(!je){const te=le?.map(ce=>ce.vendor_name).slice(0,5).join(", ")||"None";throw new Error(`Vendor "${ve}" not found. Available vendors: ${te}${le&&le.length>5?"...":""}. Please check the vendor name matches exactly.`)}const gt=je.$id;let Te=A["Stock Name"]||A.stock_name||A.stock_name||A.stock_id;if(!Te||Te==="")throw new Error("Stock Name is required");const _e=String(Te).trim(),Oe=H?.find(te=>te.stock_name.toLowerCase()===_e.toLowerCase());if(!Oe){const te=H?.map(ce=>ce.stock_name).slice(0,5).join(", ")||"None";throw new Error(`Stock "${_e}" not found. Available stocks: ${te}${H&&H.length>5?"...":""}. Please check the stock name matches exactly.`)}const Ue=Oe.$id;let Ie=A.date;if(Ie&&typeof Ie=="string"){const te=Ie.match(/^(\d{2})-(\d{2})-(\d{4})$/);if(te){const[,ce,Se,Ce]=te,Re=new Date(parseInt(Ce),parseInt(Se)-1,parseInt(ce));if(isNaN(Re.getTime()))throw new Error(`Invalid date format: ${Ie}. Use DD-MM-YYYY format (e.g., 15-01-2024).`);Ie=Re.toISOString().split("T")[0]}else{const ce=new Date(Ie);if(isNaN(ce.getTime()))throw new Error(`Invalid date format: ${Ie}. Use DD-MM-YYYY format (e.g., 15-01-2024).`);Ie=ce.toISOString().split("T")[0]}}else if(Ie instanceof Date){if(isNaN(Ie.getTime()))throw new Error("Invalid date. Use DD-MM-YYYY format (e.g., 15-01-2024).");Ie=Ie.toISOString().split("T")[0]}let j=A.total_amount;!j&&A.quantity&&A.rate&&(j=parseFloat(A.quantity)*parseFloat(A.rate));const K={purchase_code:A.purchase_code||A.Purchase_Code,date:Ie||new Date().toISOString().split("T")[0],vendor_id:gt,stock_id:Ue,quantity:parseFloat(A.quantity||0),rate:parseFloat(A.rate||0),total_amount:parseFloat(j||0)};return await Wt.create(K)},onImportComplete:async A=>{await U.invalidateQueries({queryKey:["purchases"],refetchType:"active"}),await U.refetchQueries({queryKey:["purchases"]}),A.successfulRows>0&&O({title:"Import Successful",description:`${A.successfulRows} purchases imported successfully.`}),A.failedRows>0&&O({title:"Import Completed with Errors",description:`${A.successfulRows} successful, ${A.failedRows} failed.`,variant:"destructive"})}},variant:"outline"}),P&&e.jsx(Ct,{data:ht.map(A=>{const he={};return P.exportColumns.forEach(ve=>{let je;switch(ve.dataKey){case"purchaseCode":je=A.purchase_code;break;case"date":je=A.date;break;case"vendorName":je=A.vendor_name;break;case"stockName":je=A.stock_name;break;case"quantity":je=A.quantity;break;case"rate":je=A.rate;break;case"totalAmount":je=A.total_amount;break;case"status":je="Completed";break;default:je=A[ve.dataKey]}he[ve.exportHeader]=ve.formatter?ve.formatter(je):je}),he}),headers:P.exportColumns.map(A=>A.exportHeader),filename:"purchases",variant:"outline"})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs(re,{value:N,onValueChange:v,children:[e.jsx(se,{className:"w-[180px]",children:e.jsx(ne,{placeholder:"Filter by Vendor"})}),e.jsxs(ae,{children:[e.jsx(w,{value:"all",children:"All Vendors"}),xt.map(A=>e.jsx(w,{value:A.id,children:A.name},A.id))]})]}),e.jsxs(re,{value:_,onValueChange:C,children:[e.jsx(se,{className:"w-[180px]",children:e.jsx(ne,{placeholder:"Filter by Stock"})}),e.jsxs(ae,{children:[e.jsx(w,{value:"all",children:"All Stocks"}),Nt.map(A=>e.jsx(w,{value:A.id,children:A.name},A.id))]})]}),e.jsx(B,{type:"date",placeholder:"From Date",className:"w-[150px]",value:g.from,onChange:A=>S(he=>({...he,from:A.target.value}))}),e.jsx(B,{type:"date",placeholder:"To Date",className:"w-[150px]",value:g.to,onChange:A=>S(he=>({...he,to:A.target.value}))})]})]})})}),e.jsx(ot,{open:r,onOpenChange:A=>{t(A),A||(u(null),Y({purchase_code:"",date:new Date().toISOString().split("T")[0],vendor_id:"",stock_id:"",quantity:"",rate:"",total_amount:""}))},children:e.jsxs(at,{className:"sm:max-w-[600px]",children:[e.jsxs(rt,{children:[e.jsx(it,{children:c?"Edit Purchase":"Add New Purchase"}),e.jsx(lt,{children:c?"Update the purchase information below.":"Fill in the details to create a new purchase record."})]}),e.jsxs("form",{onSubmit:Lt,children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 py-4",children:[e.jsxs("div",{children:[e.jsx(F,{htmlFor:"purchase_code",children:"Purchase Code"}),e.jsx(B,{id:"purchase_code",value:R.purchase_code,onChange:A=>Y({...R,purchase_code:A.target.value})})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"date",children:"Date"}),e.jsx(B,{id:"date",type:"date",value:R.date,onChange:A=>Y({...R,date:A.target.value})})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"vendor_id",children:"Vendor"}),e.jsxs(re,{value:R.vendor_id,onValueChange:A=>Y({...R,vendor_id:A}),children:[e.jsx(se,{id:"vendor_id",children:e.jsx(ne,{placeholder:"Select a vendor"})}),e.jsx(ae,{children:le?.map(A=>e.jsx(w,{value:A.$id,children:A.vendor_name},A.$id))})]})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"stock_id",children:"Stock"}),e.jsxs(re,{value:R.stock_id,onValueChange:A=>Y({...R,stock_id:A}),children:[e.jsx(se,{id:"stock_id",children:e.jsx(ne,{placeholder:"Select a stock item"})}),e.jsx(ae,{children:H?.map(A=>e.jsx(w,{value:A.$id,children:A.stock_name},A.$id))})]})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"quantity",children:"Quantity"}),e.jsx(B,{id:"quantity",type:"number",value:R.quantity,onChange:A=>Y({...R,quantity:A.target.value})})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"rate",children:"Rate"}),e.jsx(B,{id:"rate",type:"number",value:R.rate,onChange:A=>Y({...R,rate:A.target.value})})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"total_amount",children:"Total Amount"}),e.jsx(B,{id:"total_amount",type:"number",value:R.total_amount,readOnly:!0,className:"bg-gray-100"})]})]}),e.jsx(nt,{children:e.jsx($,{type:"submit",disabled:Pe.isPending,children:Pe.isPending?"Saving...":c?"Update Purchase":"Create Purchase"})})]})]})}),e.jsx(ot,{open:s,onOpenChange:a,children:e.jsxs(at,{children:[e.jsx(rt,{children:e.jsx(it,{children:"Are you sure?"})}),e.jsx("div",{className:"py-4",children:e.jsx("p",{children:"This action cannot be undone. This will permanently delete the purchase."})}),e.jsxs(nt,{children:[e.jsx($,{variant:"outline",onClick:()=>a(!1),children:"Cancel"}),e.jsx($,{variant:"destructive",onClick:Je,children:"Delete"})]})]})}),e.jsx(G,{children:e.jsxs(Z,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",W+1," to ",Math.min(f,wt)," of ",wt," records"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Records per page:"}),e.jsxs(re,{value:E.toString(),onValueChange:A=>q(Number(A)),children:[e.jsx(se,{className:"w-[100px]",children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(w,{value:"50",children:"50"}),e.jsx(w,{value:"100",children:"100"}),e.jsx(w,{value:"500",children:"500"})]})]})]})]}),m.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 p-3 bg-muted rounded-md",children:[e.jsxs("span",{className:"text-sm font-medium",children:[m.length," selected"]}),e.jsx($,{variant:"destructive",size:"sm",onClick:xe,disabled:ue.isPending,children:"Delete Selected"}),e.jsx($,{variant:"outline",size:"sm",onClick:qe,children:"Export Selected"})]}),e.jsx("div",{className:"border rounded-md",children:e.jsx("div",{className:"overflow-auto",style:{maxHeight:"600px"},children:e.jsx(ds,{data:b(z.map(A=>((!A.date||A.date==="Invalid Date")&&console.warn("Invalid purchase date found:",{id:A.$id,date:A.date,purchase_code:A.purchase_code}),{...A,formattedDate:xa(A.date),status:"Completed"}))),columns:[{key:"purchase_code",label:"Purchase Code",sortable:!0,dataType:"string"},{key:"formattedDate",label:"Date",sortable:!0,dataType:"date"},{key:"vendor_name",label:"Vendor Name",sortable:!0,dataType:"string"},{key:"stock_name",label:"Stock Name",sortable:!0,dataType:"string"},{key:"quantity",label:"Quantity",sortable:!0,dataType:"number",align:"right",headerClassName:"bg-purple-50",cellClassName:"bg-purple-50 font-medium"},{key:"rate",label:"Rate",sortable:!0,dataType:"number",align:"right"},{key:"total_amount",label:"Total Amount",sortable:!0,dataType:"number",align:"right"},{key:"status",label:"Status",sortable:!0,dataType:"string",formatter:A=>e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${A==="Completed"?"bg-green-100 text-green-800":A==="In Progress"?"bg-yellow-100 text-yellow-800":A==="Pending"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:A})}],onSort:T,currentSort:x,loading:$e,maxHeight:"none",stickyHeader:!0,bordered:!1,searchable:!1,rowKey:"$id",selectable:!0,selectedRows:m,onSelectionChange:y,actions:[{label:"Edit",onClick:bt,variant:"default"},{label:"Delete",onClick:A=>Ke(A.id),variant:"destructive"}],emptyMessage:"No purchases found"})})}),l>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx($,{variant:"outline",size:"sm",onClick:()=>I(A=>Math.max(1,A-1)),disabled:D===1,children:"Previous"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",D," of ",l]})}),e.jsx($,{variant:"outline",size:"sm",onClick:()=>I(A=>Math.min(l,A+1)),disabled:D===l,children:"Next"})]})]})})]})]})})},Rn=()=>{const{data:r=[],...t}=fe({queryKey:["preProductionTasks"],queryFn:async()=>ls.getPreProductionTasksWithRelations()});return{tasks:r,...t}},qn=()=>{const{data:r=[],isLoading:t,error:s,refetch:a}=fe({queryKey:["production_tasks"],queryFn:async()=>await zt.getProductionTasksWithRelations(),staleTime:12e4,gcTime:6e5,refetchOnWindowFocus:!1,retry:3,retryDelay:n=>Math.min(1e3*2**n,3e4)});return{tasks:r,isLoading:t,error:s,refetch:a}},$l=()=>{const r=ut(),t=De({mutationFn:async({taskData:n,stockItems:i})=>{const c=await zt.create(n);return i.length>0&&await Promise.all(i.map(u=>Os.create({production_task_id:c.$id,stock_id:u.stock_id,quantity:u.quantity,action:u.action}))),c},onSuccess:()=>{r.invalidateQueries({queryKey:["production_tasks"]})},onError:n=>{console.error("Error creating production task:",n)}}),s=De({mutationFn:async({id:n,taskData:i,stockItems:c})=>{const u=await zt.update(n,i);return c&&(await Os.deleteByProductionTaskId(n),c.length>0&&await Promise.all(c.map(d=>Os.create({production_task_id:n,stock_id:d.stock_id,quantity:d.quantity,action:d.action})))),u},onSuccess:()=>{r.invalidateQueries({queryKey:["production_tasks"]})},onError:n=>{console.error("Error updating production task:",n)}}),a=De({mutationFn:async n=>(await Os.deleteByProductionTaskId(n),await zt.delete(n)),onSuccess:()=>{r.invalidateQueries({queryKey:["production_tasks"]})},onError:n=>{console.error("Error deleting production task:",n)}});return{createTask:t,updateTask:s,deleteTask:a}},An=()=>{const{data:r=[],isLoading:t,error:s,refetch:a}=fe({queryKey:["post_production_tasks"],queryFn:async()=>await Xt.getPostProductionTasksWithRelations(),staleTime:12e4,gcTime:6e5,refetchOnWindowFocus:!1,retry:3,retryDelay:n=>Math.min(1e3*2**n,3e4)});return{tasks:r,isLoading:t,error:s,refetch:a}},Ll=()=>{const r=ut(),t=De({mutationFn:n=>Xt.create(n),onSuccess:()=>{r.invalidateQueries({queryKey:["post_production_tasks"]})},onError:n=>{console.error("Error creating post-production task:",n)}}),s=De({mutationFn:({id:n,data:i})=>Xt.update(n,i),onSuccess:()=>{r.invalidateQueries({queryKey:["post_production_tasks"]})},onError:n=>{console.error("Error updating post-production task:",n)}}),a=De({mutationFn:n=>Xt.delete(n),onSuccess:()=>{r.invalidateQueries({queryKey:["post_production_tasks"]})},onError:n=>{console.error("Error deleting post-production task:",n)}});return{createTask:t,updateTask:s,deleteTask:a}},Ml=()=>{const{tasks:r}=Rn(),{tasks:t}=qn(),{tasks:s}=An(),a=u=>({total:u.length,pending:u.filter(d=>d.status==="pending").length,inProgress:u.filter(d=>d.status==="in_progress").length,completed:u.filter(d=>d.status==="completed").length}),n=a(r),i=a(t),c=a(s);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Tasks Module"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage production tasks across all stages"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs(G,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(me,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fa,{className:"h-5 w-5 text-primary"}),e.jsx(pe,{children:"Pre-Production Tasks"})]}),e.jsx(ke,{children:"Manage pre-production planning and preparation tasks"})]}),e.jsxs(Z,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Track material requisitions, planning approvals, and preparation progress"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-orange-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-orange-700",children:n.pending}),e.jsx("div",{className:"text-orange-600",children:"Pending"})]}),e.jsxs("div",{className:"bg-blue-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-blue-700",children:n.inProgress}),e.jsx("div",{className:"text-blue-600",children:"In Progress"})]}),e.jsxs("div",{className:"bg-green-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-green-700",children:n.completed}),e.jsx("div",{className:"text-green-600",children:"Completed"})]}),e.jsxs("div",{className:"bg-gray-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-gray-700",children:n.total}),e.jsx("div",{className:"text-gray-600",children:"Total"})]})]})]}),e.jsx(Ut,{className:"border-t pt-4",children:e.jsx($,{asChild:!0,className:"w-full",children:e.jsxs(At,{to:"/tasks/pre-production",children:["View Pre-Production Tasks",e.jsx(Ot,{className:"ml-2 h-4 w-4"})]})})})]}),e.jsxs(G,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(me,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Wr,{className:"h-5 w-5 text-primary"}),e.jsx(pe,{children:"Production Tasks"})]}),e.jsx(ke,{children:"Track manufacturing and production progress"})]}),e.jsxs(Z,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Monitor work-in-progress, production timelines, and quality checks"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-orange-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-orange-700",children:i.pending}),e.jsx("div",{className:"text-orange-600",children:"Pending"})]}),e.jsxs("div",{className:"bg-blue-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-blue-700",children:i.inProgress}),e.jsx("div",{className:"text-blue-600",children:"In Progress"})]}),e.jsxs("div",{className:"bg-green-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-green-700",children:i.completed}),e.jsx("div",{className:"text-green-600",children:"Completed"})]}),e.jsxs("div",{className:"bg-gray-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-gray-700",children:i.total}),e.jsx("div",{className:"text-gray-600",children:"Total"})]})]})]}),e.jsx(Ut,{className:"border-t pt-4",children:e.jsx($,{asChild:!0,className:"w-full",children:e.jsxs(At,{to:"/tasks/production",children:["View Production Tasks",e.jsx(Ot,{className:"ml-2 h-4 w-4"})]})})})]}),e.jsxs(G,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(me,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Es,{className:"h-5 w-5 text-primary"}),e.jsx(pe,{children:"Post-Production Tasks"})]}),e.jsx(ke,{children:"Track finishing, packaging, and shipping"})]}),e.jsxs(Z,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Monitor finishing processes, packaging, and logistics"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-orange-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-orange-700",children:c.pending}),e.jsx("div",{className:"text-orange-600",children:"Pending"})]}),e.jsxs("div",{className:"bg-blue-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-blue-700",children:c.inProgress}),e.jsx("div",{className:"text-blue-600",children:"In Progress"})]}),e.jsxs("div",{className:"bg-green-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-green-700",children:c.completed}),e.jsx("div",{className:"text-green-600",children:"Completed"})]}),e.jsxs("div",{className:"bg-gray-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-gray-700",children:c.total}),e.jsx("div",{className:"text-gray-600",children:"Total"})]})]})]}),e.jsx(Ut,{className:"border-t pt-4",children:e.jsx($,{asChild:!0,className:"w-full",children:e.jsxs(At,{to:"/tasks/post-production",children:["View Post-Production Tasks",e.jsx(Ot,{className:"ml-2 h-4 w-4"})]})})})]})]}),e.jsxs(G,{children:[e.jsx(me,{children:e.jsx(pe,{className:"flex items-center gap-2",children:"Task Management System"})}),e.jsx(Z,{children:e.jsx("div",{className:"text-center py-6 text-muted-foreground",children:e.jsx("p",{className:"text-sm",children:"Comprehensive task management across all production stages with real-time tracking and reporting"})})})]})]})},Ol=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Status Module"}),e.jsx("p",{className:"text-muted-foreground",children:"Track real-time status across all production stages"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs(G,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(me,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ni,{className:"h-5 w-5 text-primary"}),e.jsx(pe,{children:"Stock Status"})]}),e.jsx(ke,{children:"Track raw material and component inventory"})]}),e.jsx(Z,{children:e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Monitor stock levels, movements, and availability of raw materials and components"})}),e.jsx(Ut,{className:"border-t pt-4",children:e.jsx($,{asChild:!0,className:"w-full",children:e.jsxs(At,{to:"/status/stock-status",children:["View Stock Status",e.jsx(Ot,{className:"ml-2 h-4 w-4"})]})})})]}),e.jsxs(G,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(me,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fa,{className:"h-5 w-5 text-primary"}),e.jsx(pe,{children:"Pre-production Status"})]}),e.jsx(ke,{children:"Track pre-production planning and preparation"})]}),e.jsx(Z,{children:e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Monitor material requisitions, planning approvals, and preparation progress"})}),e.jsx(Ut,{className:"border-t pt-4",children:e.jsx($,{asChild:!0,className:"w-full",children:e.jsxs(At,{to:"/status/pre-production-status",children:["View Pre-production Status",e.jsx(Ot,{className:"ml-2 h-4 w-4"})]})})})]}),e.jsxs(G,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(me,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Wr,{className:"h-5 w-5 text-primary"}),e.jsx(pe,{children:"Production Status"})]}),e.jsx(ke,{children:"Track manufacturing and production progress"})]}),e.jsx(Z,{children:e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Monitor work-in-progress, production timelines, and quality checks"})}),e.jsx(Ut,{className:"border-t pt-4",children:e.jsx($,{asChild:!0,className:"w-full",children:e.jsxs(At,{to:"/status/production-status",children:["View Production Status",e.jsx(Ot,{className:"ml-2 h-4 w-4"})]})})})]}),e.jsxs(G,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(me,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Es,{className:"h-5 w-5 text-primary"}),e.jsx(pe,{children:"Post-Production Status"})]}),e.jsx(ke,{children:"Track finishing, packaging, and shipping"})]}),e.jsx(Z,{children:e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Monitor finishing processes, packaging, and logistics"})}),e.jsx(Ut,{className:"border-t pt-4",children:e.jsx($,{asChild:!0,className:"w-full",children:e.jsxs(At,{to:"/status/post-production-status",children:["View Post-Production Status",e.jsx(Ot,{className:"ml-2 h-4 w-4"})]})})})]}),e.jsxs(G,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(me,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Hs,{className:"h-5 w-5 text-primary"}),e.jsx(pe,{children:"Inventory Status"})]}),e.jsx(ke,{children:"Track overall inventory movements and valuation"})]}),e.jsx(Z,{children:e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Monitor opening/closing balances, receiving, issue, and inventory value"})}),e.jsx(Ut,{className:"border-t pt-4",children:e.jsx($,{asChild:!0,className:"w-full",children:e.jsxs(At,{to:"/status/inventory-status",children:["View Inventory Status",e.jsx(Ot,{className:"ml-2 h-4 w-4"})]})})})]})]}),e.jsxs(G,{children:[e.jsx(me,{children:e.jsx(pe,{className:"flex items-center gap-2",children:"Database Connection"})}),e.jsx(Z,{children:e.jsx("div",{className:"text-center py-6 text-muted-foreground",children:e.jsx("p",{className:"text-sm",children:"For real-time data tracking and management, ensure your application is connected to Appwrite database"})})})]})]}),Ra={products:["products"],stocks:["stocks"],vendors:["vendors"],staff:["staff"],processes:["processes"],rawProducts:["raw-products"],salesChannels:["sales-channels"],salesUnits:r=>["sales-units",r?.from,r?.to].filter(Boolean),salesRecords:r=>["sales-records",r?.from,r?.to].filter(Boolean),stockStatus:["stock-status"],preProductionStatus:["pre-production-status"],productionStatus:["production-status"],postProductionStatus:["post-production-status"],inventoryStatus:r=>["inventory-status",r?.from,r?.to].filter(Boolean),preProductionTasks:["pre-production-tasks"],productionTasks:["production-tasks"],postProductionTasks:["post-production-tasks"],purchases:["purchases"]},Ul=()=>{const{data:r=[]}=fe({queryKey:Ra.salesUnits(),queryFn:()=>Gt.getAll(),staleTime:3e5}),{data:t=[]}=fe({queryKey:Ra.salesRecords(),queryFn:()=>os.getAll(),staleTime:300*1e3}),s={total:r.length,totalUnits:r.reduce((n,i)=>n+(i.units||0),0),recentEntries:r.filter(n=>{const i=new Date(n.date),c=new Date;return c.setDate(c.getDate()-7),i>=c}).length,uniqueProducts:new Set(r.map(n=>n.product_id)).size},a={total:t.length,totalRevenue:t.reduce((n,i)=>n+(i.sold_units||0)*(i.unit_price||0),0),recentSales:t.filter(n=>{const i=new Date(n.date),c=new Date;return c.setDate(c.getDate()-7),i>=c}).length,totalUnitsSold:t.reduce((n,i)=>n+(i.sold_units||0),0)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Sales Module"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage sales units, records, and finished goods inventory"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(G,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(me,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Es,{className:"h-5 w-5 text-primary"}),e.jsx(pe,{children:"Sales Units"})]}),e.jsx(ke,{children:"Track batch coding utilization and inventory movement"})]}),e.jsxs(Z,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:'Sales units added by user using "Add Form" from "Batch Coding" process in Post Production tasks'}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-purple-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-purple-700",children:s.total}),e.jsx("div",{className:"text-purple-600",children:"Total Entries"})]}),e.jsxs("div",{className:"bg-blue-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-blue-700",children:s.totalUnits.toLocaleString()}),e.jsx("div",{className:"text-blue-600",children:"Total Units"})]}),e.jsxs("div",{className:"bg-green-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-green-700",children:s.recentEntries}),e.jsx("div",{className:"text-green-600",children:"This Week"})]}),e.jsxs("div",{className:"bg-orange-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-orange-700",children:s.uniqueProducts}),e.jsx("div",{className:"text-orange-600",children:"Products"})]})]})]}),e.jsx(Ut,{className:"border-t pt-4",children:e.jsx($,{asChild:!0,className:"w-full",children:e.jsxs(At,{to:"/sales/units",children:["View Sales Units",e.jsx(Ot,{className:"ml-2 h-4 w-4"})]})})})]}),e.jsxs(G,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(me,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(br,{className:"h-5 w-5 text-primary"}),e.jsx(pe,{children:"Sales Records"})]}),e.jsx(ke,{children:"Track sold units with pricing and revenue"})]}),e.jsxs(Z,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:'Total sum of all the "sold units" for the respective SKU in date range in "Sales Record Page"'}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-green-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-green-700",children:a.total}),e.jsx("div",{className:"text-green-600",children:"Total Records"})]}),e.jsxs("div",{className:"bg-blue-50 p-2 rounded text-center",children:[e.jsxs("div",{className:"font-semibold text-blue-700",children:["â‚¹",a.totalRevenue.toLocaleString()]}),e.jsx("div",{className:"text-blue-600",children:"Total Revenue"})]}),e.jsxs("div",{className:"bg-purple-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-purple-700",children:a.recentSales}),e.jsx("div",{className:"text-purple-600",children:"Recent Sales"})]}),e.jsxs("div",{className:"bg-orange-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-orange-700",children:a.totalUnitsSold.toLocaleString()}),e.jsx("div",{className:"text-orange-600",children:"Units Sold"})]})]})]}),e.jsx(Ut,{className:"border-t pt-4",children:e.jsx($,{asChild:!0,className:"w-full",children:e.jsxs(At,{to:"/sales/records",children:["View Sales Records",e.jsx(Ot,{className:"ml-2 h-4 w-4"})]})})})]})]}),e.jsxs(G,{children:[e.jsx(me,{children:e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(Hs,{className:"h-5 w-5 text-primary"}),"Sales Management System"]})}),e.jsx(Z,{children:e.jsx("div",{className:"text-center py-6 text-muted-foreground",children:e.jsx("p",{className:"text-sm",children:"Comprehensive sales tracking from batch coding utilization to final revenue with real-time inventory management"})})})]})]})};function Fn({className:r,classNames:t,showOutsideDays:s=!0,presets:a,...n}){return e.jsxs("div",{className:"flex",children:[a&&e.jsx("div",{className:"flex flex-col items-start pr-4 border-r border-gray-200",children:a.map(i=>e.jsx($,{variant:"ghost",className:"w-full justify-start mb-1",onClick:()=>{n.onSelect&&typeof n.onSelect=="function"&&n.onSelect(i.range)},children:i.name},i.name))}),e.jsx(wi,{showOutsideDays:s,className:ie("p-3",r),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:ie(Da({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:ie(Da({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...t},components:{IconLeft:({...i})=>e.jsx(Si,{className:"h-4 w-4"}),IconRight:({...i})=>e.jsx(wr,{className:"h-4 w-4"})},...n})]})}Fn.displayName="Calendar";const Kl=ki,Vl=Ci,In=p.forwardRef(({className:r,align:t="center",sideOffset:s=4,...a},n)=>e.jsx(_i,{children:e.jsx(Gr,{ref:n,align:t,sideOffset:s,className:ie("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...a})}));In.displayName=Gr.displayName;function qs({value:r,onChange:t,className:s}){const[a,n]=p.useState("this-month"),[i,c]=p.useState(!1),u=[{id:"this-month",name:"This month",range:{from:es(new Date),to:Zt(new Date)}},{id:"previous-month",name:"Previous month",range:{from:es(ja(new Date,1)),to:Zt(ja(new Date,1))}},{id:"last-6-months",name:"Last 6 months",range:{from:ja(new Date,6),to:new Date}},{id:"custom",name:"Custom",range:void 0}],d=m=>{n(m);const y=u.find(N=>N.id===m);y&&y.id!=="custom"?(t(y.range),c(!1)):c(!0)},o=()=>r?.from?r.to?`${ct(r.from,"dd MMM")} - ${ct(r.to,"dd MMM yyyy")}`:ct(r.from,"dd MMM yyyy"):"Select date range";return p.useEffect(()=>{if(!r&&a==="this-month"&&typeof t=="function"){const m=u.find(y=>y.id==="this-month");m&&t(m.range)}},[r,t,a,u]),e.jsxs("div",{className:ie("flex items-center gap-2",s),children:[e.jsxs(re,{value:a,onValueChange:d,children:[e.jsx(se,{className:"w-[150px]",children:e.jsx(ne,{})}),e.jsx(ae,{children:u.map(m=>e.jsx(w,{value:m.id,children:m.name},m.id))})]}),e.jsxs(Kl,{open:i,onOpenChange:c,children:[e.jsx(Vl,{asChild:!0,children:e.jsxs($,{id:"date",variant:"outline",className:ie("min-w-[200px] justify-between text-left font-normal",!r&&"text-muted-foreground"),onClick:()=>{a==="custom"&&c(!i)},children:[o(),a==="custom"&&e.jsx($a,{className:"h-4 w-4 opacity-50"})]})}),a==="custom"&&e.jsx(In,{className:"w-auto p-0",align:"start",children:e.jsx(Fn,{initialFocus:!0,mode:"range",defaultMonth:r?.from,selected:r,onSelect:m=>{t(m),m?.from&&m?.to&&c(!1)},numberOfMonths:2})})]})]})}const sr=r=>r.toISOString();function Bl(){const{user:r,loading:t}=ft(),s=cs(),{toast:a}=Fe(),n=ut(),[i,c]=p.useState(void 0),[u,d]=p.useState(!1),[o,m]=p.useState(null),[y,N]=p.useState([]),[v,_]=p.useState("all"),[C,g]=p.useState("all"),[S,D]=p.useState(""),[I,E]=p.useState({from:"",to:""}),[q,U]=p.useState(1),[O,ee]=p.useState(50),{config:L}=Rt("sales-units"),{validationRules:P,canImport:h}=qt("sales-units"),{currentSort:k,handleSort:x,getSortedData:T}=as();if(et.useEffect(()=>{o&&u&&(console.log("ðŸ”„ Populating form for edit:",o),z({date:o.date,product_id:o.product_id,sku:o.sku,units:o.units,notes:o.notes||"",dateString:new Date(o.date).toISOString().split("T")[0]}))},[o,u]),t)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ve,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Validating authentication..."})]})});if(!r)return console.error("SalesUnits: User not authenticated, redirecting to login",{location:s.pathname,timestamp:new Date().toISOString(),userAgent:navigator.userAgent}),e.jsx(Rs,{to:"/login",state:{from:s},replace:!0});et.useEffect(()=>()=>{},[r,s]);const{data:b=[],error:R}=fe({queryKey:["products"],queryFn:async()=>{try{const j=await Ht.getAll();return console.log("ðŸ“¦ Products loaded for sales:",j.map(K=>({id:K.$id,name:K.product||K.product_name,sku:K.sku}))),j}catch(j){throw console.error("SalesUnits: Failed to fetch products",{error:j.message,code:j.code,type:j.type,userId:r?.$id,stack:j.stack}),j}},retry:(j,K)=>K.code===401||K.code===403?!1:j<3}),{data:Y=[]}=fe({queryKey:["post-production-tasks"],queryFn:async()=>{try{return await Xt.getAll()}catch(j){throw console.error("SalesUnits: Failed to fetch post-production tasks",j),j}},retry:(j,K)=>K.code===401||K.code===403?!1:j<3}),{data:M=[]}=fe({queryKey:["processes"],queryFn:async()=>{try{const j=await fs.getAll();return console.log("ðŸ”§ Processes loaded for sales validation:",j.map(K=>({id:K.$id,name:K.process_name,department:K.department}))),j}catch(j){throw console.error("SalesUnits: Failed to fetch processes",j),j}},staleTime:300*1e3}),{data:J=[],isLoading:V,error:le}=fe({queryKey:["post-production-status"],queryFn:async()=>{console.log("ðŸš€ Starting post-production status query...");try{const j=await Cl.getAll();return console.log("âœ… Post-production status query successful:",j.length,"records"),console.log("ðŸ“‹ All PostProductionStatus records:",j.map(K=>({product_id:K.product_id,closing_balance:K.closing_balance,status_date:K.status_date}))),j}catch(j){throw console.error("âŒ SalesUnits: Failed to fetch post-production status",{message:j.message,code:j.code,type:j.type,stack:j.stack}),j}},retry:(j,K)=>(console.log(`ðŸ”„ Retrying post-production status query (attempt ${j+1})`),K.code===401||K.code===403?(console.log("ðŸš« Authentication error, not retrying"),!1):j<3),enabled:!!r});et.useEffect(()=>{console.log("ðŸ“Š Post-production status query status:",{isLoading:V,hasError:!!le,dataLength:J.length,error:le?.message})},[V,le,J.length]);const ge=p.useMemo(()=>{const j=[];return i?.from&&j.push(Ze.greaterThanEqual("date",sr(i.from))),i?.to&&j.push(Ze.lessThanEqual("date",sr(i.to))),j},[i]),{data:we=[],isLoading:H,error:de}=fe({queryKey:["sales-units",i?.from?.toISOString(),i?.to?.toISOString()],queryFn:async()=>{try{return await Gt.getAll(ge)}catch(j){throw console.error("SalesUnits: Failed to fetch sales units",{error:j.message,code:j.code,type:j.type,queries:ge,userId:r?.$id,stack:j.stack}),j}},retry:(j,K)=>K.code===401||K.code===403?!1:j<3});et.useEffect(()=>{de&&(console.error("SalesUnits: Sales units query error detected",de),a({title:"Data Loading Error",description:"Failed to load sales units. Please refresh the page.",variant:"destructive"}))},[de,a]),et.useEffect(()=>{R&&(console.error("SalesUnits: Products query error detected",R),a({title:"Products Loading Error",description:"Failed to load products. Some features may not work properly.",variant:"destructive"}))},[R,a]);const Ne=De({mutationFn:async j=>await je(async()=>await Gt.create(j)),onMutate:()=>{if(qe==="offline")throw a({title:"Offline",description:"You are currently offline. Please check your connection.",variant:"destructive"}),new Error("Network offline")},onError:(j,K)=>{try{throw console.error("SalesUnits: Failed to create sales unit",{error:j.message,code:j.code,type:j.type,payload:K,userId:r?.$id}),j.code===401?(a({title:"Authentication Error",description:"Your session has expired. Please log in again.",variant:"destructive"}),window.location.href="/login",j):j.code===403?(a({title:"Permission Denied",description:"You don't have permission to create sales units.",variant:"destructive"}),j):j.code>=500?(a({title:"Server Error",description:"A server error occurred. Please try again later.",variant:"destructive"}),j):ve(j)?(a({title:"Network Error",description:qe==="offline"?"You appear to be offline. Please check your internet connection.":"Network error occurred. Retrying...",variant:"destructive"}),j):(a({title:"Error",description:j.message||"Failed to create sales unit. Please try again.",variant:"destructive"}),j)}catch(te){throw console.error("SalesUnits: Error in mutation error handler",te),te}},onSuccess:j=>{n.invalidateQueries({queryKey:["sales-units"]}),a({title:"Success",description:"Sales unit created successfully.",duration:3e3}),d(!1);const K={date:new Date().toISOString(),product_id:"",sku:"",units:0,notes:""};z(K),xe({}),N([]),m(null)}}),Le=De({mutationFn:async({id:j,data:K})=>await je(async()=>await Gt.update(j,K)),onSuccess:j=>{n.invalidateQueries({queryKey:["sales-units"]}),a({title:"Success",description:"Sales unit updated successfully.",duration:3e3}),d(!1),m(null);const K={date:new Date().toISOString(),product_id:"",sku:"",units:0,notes:""};z(K),xe({})},onError:j=>{console.error("Failed to update sales unit:",j),a({title:"Error",description:j.message||"Failed to update sales unit. Please try again.",variant:"destructive"})}}),mt=De({mutationFn:j=>Gt.delete(j),onSuccess:()=>{n.invalidateQueries({queryKey:["sales-units"]}),a({title:"Success",description:"Sales unit deleted successfully."})},onError:()=>{a({title:"Error",description:"Failed to delete sales unit.",variant:"destructive"})}}),ye=De({mutationFn:async j=>{await Promise.all(j.map(K=>Gt.delete(K)))},onSuccess:()=>{n.invalidateQueries({queryKey:["sales-units"]}),N([]),a({title:"Success",description:"Selected units deleted successfully."})},onError:()=>{a({title:"Error",description:"Failed to delete selected units.",variant:"destructive"})}}),Pe=j=>{console.log("ðŸ” Editing sales unit:",j),m(j),d(!0)},Be=j=>{confirm("Are you sure you want to delete this sales unit?")&&mt.mutate(j)},Ke=()=>{if(y.length===0){a({title:"No Selection",description:"Please select units to delete.",variant:"destructive"});return}confirm(`Are you sure you want to delete ${y.length} selected unit(s)?`)&&ye.mutate(y.map(j=>j.$id))},Je=we.filter(j=>{const K=!S||j.sku.toLowerCase().includes(S.toLowerCase())||j.notes&&j.notes.toLowerCase().includes(S.toLowerCase()),te=v==="all"||j.product_id===v,ce=C==="all"||j.sku===C,Se=new Date(j.date),Ce=(!I.from||Se>=new Date(I.from))&&(!I.to||Se<=new Date(I.to));return K&&te&&ce&&Ce}),bt=et.useMemo(()=>{const j=new Map;return we.forEach(K=>{j.has(K.product_id)||j.set(K.product_id,{id:K.product_id,name:b.find(te=>te.$id===K.product_id)?.product||K.product_id})}),Array.from(j.values()).sort((K,te)=>K.name.localeCompare(te.name))},[we,b]),Lt=et.useMemo(()=>Array.from(new Set(we.map(j=>j.sku))).sort(),[we]),ht=Je.length,xt=Math.ceil(ht/O),Nt=(q-1)*O,wt=Nt+O,l=Je.slice(Nt,wt);et.useEffect(()=>{U(1)},[S,v,C,I,O]);const W=()=>{if(y.length===0){a({title:"No Selection",description:"Please select units to export.",variant:"destructive"});return}a({title:"Export",description:`Exporting ${y.length} selected unit(s)...`})},[f,z]=p.useState({date:new Date().toISOString(),product_id:"",sku:"",units:0,notes:""}),[ue,xe]=p.useState({}),[qe,$e]=p.useState("online"),[Me,A]=p.useState(0),he=et.useMemo(()=>{const j={date:new Date().toISOString(),product_id:"",sku:"",units:0,notes:""};return f.product_id!==j.product_id||f.sku!==j.sku||f.units!==j.units||(f.notes||"")!==j.notes||f.dateString&&f.dateString!==new Date().toISOString().split("T")[0]},[f]);et.useEffect(()=>{const j=()=>{$e("online"),a({title:"Connection Restored",description:"Your internet connection has been restored."})},K=()=>{$e("offline"),a({title:"Connection Lost",description:"Please check your internet connection.",variant:"destructive"})};return window.addEventListener("online",j),window.addEventListener("offline",K),$e(navigator.onLine?"online":"offline"),()=>{window.removeEventListener("online",j),window.removeEventListener("offline",K)}},[a]);const ve=j=>j.message?.toLowerCase().includes("network")||j.message?.toLowerCase().includes("fetch")||j.message?.toLowerCase().includes("connection")||j.code==="NETWORK_ERROR"||!navigator.onLine,je=async(j,K=3)=>{let te;for(let ce=1;ce<=K;ce++)try{if(A(ce-1),ce>1){const Ce=Math.min(1e3*Math.pow(2,ce-2),1e4);await new Promise(Re=>setTimeout(Re,Ce))}const Se=await j();return A(0),Se}catch(Se){if(te=Se,console.error(`SalesUnits: Retry attempt ${ce} failed`,{error:Se.message,isNetworkError:ve(Se),attempt:ce,maxRetries:K}),Se.code===401||Se.code===403||!ve(Se)&&ce===K)break}throw A(0),te},gt=(j,K)=>{const te={...ue};switch(j){case"product_id":K?delete te.product_id:te.product_id="Product is required";break;case"sku":K?delete te.sku:te.sku="SKU is required";break;case"units":!K||K<=0?te.units="Units must be greater than 0":delete te.units;break;case"dateString":K?delete te.dateString:te.dateString="Date is required";break}return xe(te),Object.keys(te).length===0},Te=j=>{const K={...f,...j};z(K),Object.keys(j).forEach(te=>{gt(te,j[te])})},_e=async()=>{try{return r?!0:(a({title:"Session Expired",description:"Please log in again to continue.",variant:"destructive"}),!1)}catch{return a({title:"Session Error",description:"Unable to validate your session. Please log in again.",variant:"destructive"}),!1}},Oe=j=>{console.log("ðŸ” Checking if product has available batch coding units:",j);const K=J.find(te=>te.product_id===j);if(console.log("ðŸ“‹ Post-production status for product:",K),K&&(K.closing_balance||0)>0){const ce=b.find(Se=>Se.$id===j)?.sku;if(ce){const Se=we.filter(Re=>Re.sku===ce).reduce((Re,Ye)=>Re+(Ye.units||0),0),Ce=(K.closing_balance||0)-Se;return console.log(`ðŸ“Š Availability using stored balance for ${ce}:`,{storedBalance:K.closing_balance,soldUnits:Se,available:Ce}),Ce>0}}else{console.log("âš ï¸ No stored balance, checking completed batch coding tasks...");const te=Y.filter(ce=>{const Ce=M.find(Re=>Re.$id===ce.process_id)?.process_name?.toLowerCase()==="batch coding";return ce.product_id===j&&ce.status==="completed"&&Ce});return console.log(`ðŸ“Š Found ${te.length} completed batch coding tasks for product`),te.length>0}return!1},Ue=(j,K,te)=>{console.log("ðŸ” Getting available batch coding units:",{productId:j,sku:K,excludeRecordId:te});const ce=b.find(Ye=>Ye.$id===j),Se=ce?.sku;if(!ce||!Se)return console.log("âš ï¸ Product not found or has no SKU:",{productId:j,productSku:Se}),0;if(Se!==K)return console.log("âš ï¸ SKU mismatch - requested SKU does not belong to this product:",{productId:j,requestedSku:K,productSku:Se}),0;const Ce=J.find(Ye=>Ye.product_id===j);console.log("ðŸŽ¯ PostProductionStatus record found for product:",Ce);let Re=0;if(Ce&&Ce.closing_balance!==void 0&&Ce.closing_balance!==null){const Ye=Ce.closing_balance||0;console.log("âœ… Using stored closing balance:",Ye);const ns=te?we.filter(dt=>dt.sku===K&&dt.$id===te).reduce((dt,Xe)=>dt+(Xe.units||0),0):0;Re=Math.max(0,Ye+ns)}else{console.log("âš ï¸ No stored closing balance found, calculating from completed tasks...");const Ye=Y.filter(Xe=>{const Mt=M.find(Un=>Un.$id===Xe.process_id),ys=Mt?.process_name?.toLowerCase()==="batch coding",Fs=Xe.product_id===j&&Xe.status==="completed"&&ys;return Xe.product_id===j&&console.log(`ðŸ” Task ${Xe.task_id}:`,{processId:Xe.process_id,processName:Mt?.process_name,isBatchCoding:ys,status:Xe.status,matches:Fs}),Fs});if(console.log("ðŸ“Š Completed batch coding tasks found:",Ye.length),Ye.length===0)return console.log("âš ï¸ No completed batch coding tasks found for this product"),0;const ns=Ye.reduce((Xe,Mt)=>{const ys=Mt.completed_quantity!==void 0&&Mt.completed_quantity!==null?Number(Mt.completed_quantity):Number(Mt.units)||0;return Xe+ys},0),dt=we.filter(Xe=>Xe.sku===K&&Xe.$id!==te).reduce((Xe,Mt)=>Xe+(Mt.units||0),0);Re=Math.max(0,ns-dt),console.log("ðŸ“Š Calculated availability:",{totalCompletedUnits:ns,soldUnits:dt,availableUnits:Re})}return console.log("ðŸ“ˆ Final availability calculation:",{productId:j,sku:K,availableUnits:Re,excludedRecordId:te,method:Ce?.closing_balance!==void 0?"stored_balance":"calculated_from_tasks"}),Re},Ie=async j=>{if(j.preventDefault(),!await _e()){console.error("SalesUnits: Session validation failed, aborting form submission");return}if(!f.product_id||!f.sku||!f.units||!f.dateString||f.product_id==="no-products"||f.sku==="no-skus"){a({title:"Validation Error",description:"Please fill all required fields: Product, SKU, Units, and Date.",variant:"destructive"});return}if(f.units<=0){a({title:"Validation Error",description:"Units must be greater than 0.",variant:"destructive"});return}const te=Ue(f.product_id,f.sku,o?.$id);if(console.log("ðŸ”„ Edit Mode Validation Check:",{isEditing:!!o,editingRecordId:o?.$id,requestedUnits:f.units,availableUnits:te,sku:f.sku,shouldTriggerValidation:f.units>te}),f.units>te){console.log("ðŸš¨ SALES UNITS VALIDATION TRIGGERED:",{requestedUnits:f.units,availableUnits:te,productId:f.product_id,sku:f.sku}),console.log("ðŸ”„ Showing custom Sales Units validation dialog");const ce={isValid:!1,currentProcess:"sales_units",sourceProcess:"batch_coding",availableQuantity:te,requiredQuantity:f.units,warningMessage:`Insufficient batch coding units. Available: ${te} units, Requested: ${f.units} units`,suggestions:[`Reduce quantity to ${te} units or less`,"Complete more batch coding tasks to increase availability","Check batch coding status for current availability"]};console.log("ðŸ“‹ Custom Validation Data Created:",ce),console.log("ðŸ§¹ Clearing regular validation state before showing custom dialog")}try{const ce={date:f.dateString?new Date(f.dateString).toISOString():f.date,product_id:f.product_id,sku:f.sku,units:f.units,notes:f.notes||void 0};o?Le.mutate({id:o.$id,data:ce}):Ne.mutate(ce)}catch(ce){console.error("SalesUnits: Form submission error",ce),a({title:"Error",description:"Failed to submit form. Please try again.",variant:"destructive"})}};return e.jsx("div",{className:"p-4",children:e.jsxs(G,{children:[e.jsx(me,{children:e.jsxs(pe,{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Sales Units"}),e.jsxs("div",{className:"flex gap-2",children:[h&&L&&e.jsx(Pt,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:L.exportColumns.filter(j=>j.required).map(j=>j.exportHeader),optionalColumns:L.exportColumns.filter(j=>!j.required).map(j=>j.exportHeader),validationRules:P,maxFileSize:50,existingData:we||[],validationHeaderMapper:j=>{const K=L.exportColumns.find(te=>te.dataKey===j);return K?K.exportHeader:j},columnMapper:j=>{const K=L.exportColumns.find(te=>te.exportHeader===j);return K?K.dataKey==="productName"?"product_name":K.dataKey==="sku"?"sku":{date:"date",units:"units",status:"status",remarks:"remarks"}[K.dataKey]||K.dataKey:j},dataProcessor:async j=>{let K=j.Product||j.product_name||j.product_name,te=j.SKU||j.sku||j.sku;if(!K||K==="")throw new Error("Product is required");const ce=String(K).trim(),Se=b?.find(dt=>dt.product&&dt.product.toLowerCase()===ce.toLowerCase()||dt.sku&&dt.sku.toLowerCase()===(te||"").toLowerCase());if(!Se){const dt=b?.map(Xe=>Xe.product||Xe.sku).slice(0,5).join(", ")||"None";throw new Error(`Product "${ce}" not found. Available: ${dt}`)}const Ce=Se.$id,Re=te||Se.sku||"";let Ye=j.Date||j.date||j.date||new Date().toISOString().split("T")[0];if(Ye&&typeof Ye=="string"){const dt=Ye.match(/^(\d{2})-(\d{2})-(\d{4})$/);if(dt){const[,Xe,Mt,ys]=dt,Fs=new Date(parseInt(ys),parseInt(Mt)-1,parseInt(Xe));isNaN(Fs.getTime())||(Ye=Fs.toISOString().split("T")[0])}else{const Xe=new Date(Ye);isNaN(Xe.getTime())||(Ye=Xe.toISOString().split("T")[0])}}else Ye instanceof Date&&(Ye=Ye.toISOString().split("T")[0]);const ns={date:Ye,product_id:Ce,sku:Re,units:parseFloat(j.Units||j.units||j.units||0),notes:j.Remarks||j.remarks||j.remarks||""};return await Gt.create(ns)},onImportComplete:async j=>{await n.invalidateQueries({queryKey:["sales-units"],refetchType:"active"}),await n.refetchQueries({queryKey:["sales-units"]}),j.successfulRows>0&&a({title:"Import Successful",description:`${j.successfulRows} sales units imported successfully.`}),j.failedRows>0&&a({title:"Import Completed with Errors",description:`${j.successfulRows} successful, ${j.failedRows} failed.`,variant:"destructive"})}},variant:"outline"}),L&&e.jsx(Ct,{data:we.map(j=>{const K={};return L.exportColumns.forEach(te=>{let ce;switch(te.dataKey){case"date":ce=j.date;break;case"productName":ce=b.find(Se=>Se.$id===j.product_id)?.product||j.product_id;break;case"sku":ce=j.sku;break;case"units":ce=j.units;break;case"status":ce="Completed";break;case"remarks":ce=j.notes||"";break;default:ce=j[te.dataKey]}K[te.exportHeader]=te.formatter?te.formatter(ce):ce}),K}),headers:L.exportColumns.map(j=>j.exportHeader),filename:"sales-units",variant:"outline"}),e.jsxs($,{onClick:()=>d(!0),children:[e.jsx(Tt,{className:"mr-2 h-4 w-4"})," Add New Units"]})]})]})}),e.jsxs(Z,{children:[e.jsx(G,{className:"mb-6",children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(pt,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(B,{placeholder:"Search units...",className:"pl-10",value:S,onChange:j=>D(j.target.value)})]}),h&&L&&e.jsx(Pt,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:L.exportColumns.filter(j=>j.required).map(j=>j.exportHeader),optionalColumns:L.exportColumns.filter(j=>!j.required).map(j=>j.exportHeader),validationRules:P,onImportComplete:j=>{j.successfulRows>0&&(n.invalidateQueries({queryKey:["sales-units"]}),a({title:"Import Successful",description:`${j.successfulRows} sales units imported successfully.`}))}},variant:"outline"}),L&&e.jsx(Ct,{data:Je.map(j=>{const K={};return L.exportColumns.forEach(te=>{let ce;switch(te.dataKey){case"date":ce=j.date;break;case"productName":ce=b.find(Se=>Se.$id===j.product_id)?.product||j.product_id;break;case"sku":ce=j.sku;break;case"units":ce=j.units;break;case"status":ce="Completed";break;case"remarks":ce=j.notes||"";break;default:ce=j[te.dataKey]}K[te.exportHeader]=te.formatter?te.formatter(ce):ce}),K}),headers:L.exportColumns.map(j=>j.exportHeader),filename:"sales-units",variant:"outline"})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs(re,{value:v,onValueChange:_,children:[e.jsx(se,{className:"w-[180px]",children:e.jsx(ne,{placeholder:"Filter by Product"})}),e.jsxs(ae,{children:[e.jsx(w,{value:"all",children:"All Products"}),bt.map(j=>e.jsx(w,{value:j.id,children:j.name},j.id))]})]}),e.jsxs(re,{value:C,onValueChange:g,children:[e.jsx(se,{className:"w-[180px]",children:e.jsx(ne,{placeholder:"Filter by SKU"})}),e.jsxs(ae,{children:[e.jsx(w,{value:"all",children:"All SKUs"}),Lt.map(j=>e.jsx(w,{value:j,children:j},j))]})]}),e.jsx(B,{type:"date",placeholder:"From Date",className:"w-[150px]",value:I.from,onChange:j=>E(K=>({...K,from:j.target.value}))}),e.jsx(B,{type:"date",placeholder:"To Date",className:"w-[150px]",value:I.to,onChange:j=>E(K=>({...K,to:j.target.value}))})]})]})})}),e.jsx(ot,{open:u,onOpenChange:j=>{if(!j&&(Ne.isPending||Le.isPending)){a({title:"Please wait",description:"Form is being submitted. Please wait for completion.",variant:"destructive"});return}if(!(!j&&he&&!(Ne.isPending||Le.isPending)&&!window.confirm("You have unsaved changes. Are you sure you want to close without saving?"))&&(d(j),!j)){const K={date:new Date().toISOString(),product_id:"",sku:"",units:0,notes:""};z(K),xe({}),m(null)}},children:e.jsxs(at,{className:"sm:max-w-[600px] max-w-[95vw] max-h-[90vh] overflow-y-auto",children:[e.jsxs(rt,{children:[e.jsxs(it,{className:"flex items-center gap-2",children:[o?"Edit Sales Unit":"Add New Sales Unit",he&&e.jsx("span",{className:"text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded",children:"Unsaved changes"})]}),e.jsx(lt,{children:"Enter sales unit details below."}),b.filter(j=>Oe(j.$id)).length===0&&e.jsxs("div",{className:"mt-2 p-3 bg-yellow-50 border border-yellow-200 rounded text-sm text-yellow-800",children:[e.jsx("strong",{children:"âš ï¸ No products available:"})," All products either have no completed batch coding units or all units have been sold."]})]}),e.jsxs("form",{onSubmit:Ie,children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 py-4",children:[e.jsxs("div",{children:[e.jsx(F,{htmlFor:"date",children:"Date *"}),e.jsx(B,{id:"date",type:"date",value:f.dateString||"",onChange:j=>Te({dateString:j.target.value}),className:ue.dateString?"border-red-500":""}),ue.dateString&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:ue.dateString})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"product",children:"Product *"}),e.jsxs(re,{value:f.product_id,onValueChange:j=>Te({product_id:j,sku:b.find(K=>K.$id===j)?.sku||f.sku}),children:[e.jsx(se,{id:"product",className:ue.product_id?"border-red-500":"",children:e.jsx(ne,{placeholder:"Select Product"})}),e.jsxs(ae,{children:[b.filter(j=>{const K=J.find(ce=>ce.product_id===j.$id);let te=!1;return K&&(K.closing_balance||0)>0?te=!0:j.sku&&(te=Y.filter(Ce=>Ce.product_id===j.$id&&Ce.status==="completed").length>0),console.log("ðŸ” Product filtering for sales:",{productId:j.$id,productName:j.product||j.product_name,sku:j.sku,postProdStatusFound:!!K,storedClosingBalance:K?.closing_balance,hasCompletedTasks:Y.filter(ce=>ce.product_id===j.$id&&ce.status==="completed").length>0,finalDecision:te}),te}).map(j=>e.jsx(w,{value:j.$id,children:j.product||j.$id},j.$id)),b.filter(j=>{const K=J.find(ce=>ce.product_id===j.$id);return K&&(K.closing_balance||0)>0?!0:j.sku?Y.filter(Se=>Se.product_id===j.$id&&Se.status==="completed").length>0:!1}).length===0&&e.jsx(w,{value:"no-products",disabled:!0,children:"No products with available batch coding units"})]})]}),ue.product_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:ue.product_id})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"sku",children:"SKU *"}),e.jsxs(re,{value:f.sku,onValueChange:j=>Te({sku:j}),children:[e.jsx(se,{id:"sku",className:ue.sku?"border-red-500":"",children:e.jsx(ne,{placeholder:"Select SKU"})}),e.jsxs(ae,{children:[(()=>{if(!f.product_id)return[];const j=b.find(Se=>Se.$id===f.product_id);if(!j||!j.sku)return[];const K=j.sku,te=Ue(f.product_id,K,o?.$id),ce=o&&K===o.sku;return te>0||ce?[j]:[]})().map(j=>{const K=j.sku,te=Ue(f.product_id,K,o?.$id),ce=o&&K===o.sku;return e.jsxs(w,{value:K,children:[K,j.product?` â€” ${j.product}`:"",e.jsxs("span",{className:`text-xs ml-2 ${te>0?"text-gray-500":"text-red-500"}`,children:["(",te," available",ce&&te===0?" - Current":"",")"]})]},j.$id)}),f.product_id&&(()=>{const j=b.find(Se=>Se.$id===f.product_id);if(!j||!j.sku)return!0;const K=j.sku,te=Ue(f.product_id,K,o?.$id),ce=o&&K===o.sku;return te===0&&!ce})()&&e.jsx(w,{value:"no-skus",disabled:!0,children:"No SKUs with available batch coding units for this product"})]})]}),ue.sku&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:ue.sku}),f.product_id&&f.sku&&e.jsxs("div",{className:"mt-2 p-2 bg-blue-50 border border-blue-200 rounded text-sm",children:[e.jsx("span",{className:"text-blue-700 font-medium",children:"Available Batch Coding Units:"}),e.jsxs("span",{className:"text-blue-800 font-bold",children:[Ue(f.product_id,f.sku,o?.$id)," units"]})]})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"units",children:"Units *"}),e.jsx(B,{id:"units",type:"number",min:"1",value:f.units,onChange:j=>Te({units:Number(j.target.value)}),className:ue.units?"border-red-500":""}),ue.units&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:ue.units})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(F,{htmlFor:"notes",children:"Remarks"}),e.jsx(B,{id:"notes",type:"text",value:f.notes||"",onChange:j=>Te({notes:j.target.value})})]})]}),e.jsxs(nt,{className:"flex-col sm:flex-row gap-2 pt-4",children:[e.jsx($,{type:"button",variant:"outline",onClick:()=>d(!1),className:"w-full sm:w-auto",children:"Cancel"}),e.jsx($,{type:"submit",disabled:Ne.isPending||Le.isPending||Object.keys(ue).length>0,className:"w-full sm:w-auto",children:Ne.isPending||Le.isPending?e.jsxs(e.Fragment,{children:[e.jsx(Ve,{className:"mr-2 h-4 w-4 animate-spin"}),"Savingâ€¦"]}):o?"Update Sales Unit":"Add Sales Unit"})]})]})]})}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{placeholder:"Search units...",value:S,onChange:j=>D(j.target.value),className:"max-w-sm"}),e.jsxs(re,{value:v,onValueChange:_,children:[e.jsx(se,{className:"w-[180px]",children:e.jsx(ne,{placeholder:"Filter by Product"})}),e.jsxs(ae,{children:[e.jsx(w,{value:"all",children:"All Products"}),b.map(j=>e.jsx(w,{value:j.$id,children:j.product||j.$id},j.$id))]})]}),e.jsx(qs,{value:i,onChange:c})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[qe==="offline"&&e.jsxs("div",{className:"flex items-center gap-1 text-red-600 text-sm",children:[e.jsx("div",{className:"w-2 h-2 bg-red-600 rounded-full"}),"Offline"]}),Me>0&&e.jsxs("div",{className:"flex items-center gap-1 text-yellow-600 text-sm",children:[e.jsx(Ve,{className:"h-3 w-3 animate-spin"}),"Retrying... (",Me,")"]})]})]}),e.jsx(G,{children:e.jsxs(Z,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",Nt+1," to ",Math.min(wt,ht)," of ",ht," records"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Records per page:"}),e.jsxs(re,{value:O.toString(),onValueChange:j=>ee(Number(j)),children:[e.jsx(se,{className:"w-[100px]",children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(w,{value:"50",children:"50"}),e.jsx(w,{value:"100",children:"100"}),e.jsx(w,{value:"500",children:"500"})]})]})]})]}),y.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 p-3 bg-muted rounded-md",children:[e.jsxs("span",{className:"text-sm font-medium",children:[y.length," selected"]}),e.jsx($,{variant:"destructive",size:"sm",onClick:Ke,disabled:ye.isPending,children:"Delete Selected"}),e.jsx($,{variant:"outline",size:"sm",onClick:W,children:"Export Selected"})]}),e.jsx("div",{className:"border rounded-md",children:e.jsx("div",{className:"overflow-auto",style:{maxHeight:"600px"},children:e.jsx(ds,{data:T(l.map(j=>((!j.date||j.date==="Invalid Date")&&console.warn("Invalid sales unit date found:",{id:j.$id,date:j.date}),{...j,productName:b.find(K=>K.$id===j.product_id)?.product||j.product_id,formattedDate:xa(j.date),status:"Completed"}))),columns:[{key:"formattedDate",label:"Date",sortable:!0,dataType:"date"},{key:"productName",label:"Product",sortable:!0,dataType:"string"},{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"units",label:"Units",sortable:!0,dataType:"number",align:"right",headerClassName:"bg-purple-50",cellClassName:"bg-purple-50 font-medium"},{key:"status",label:"Status",sortable:!0,dataType:"string",formatter:j=>e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${j==="Completed"?"bg-green-100 text-green-800":j==="In Progress"?"bg-yellow-100 text-yellow-800":j==="Pending"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:j})},{key:"notes",label:"Remarks",sortable:!0,dataType:"string"}],onSort:x,currentSort:k,loading:H,maxHeight:"none",stickyHeader:!0,bordered:!1,searchable:!1,rowKey:"$id",selectable:!0,selectedRows:y,onSelectionChange:N,actions:[{label:"Edit",onClick:Pe,variant:"default"},{label:"Delete",onClick:j=>Be(j.$id),variant:"destructive"}],emptyMessage:"No sales units found"})})}),xt>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx($,{variant:"outline",size:"sm",onClick:()=>U(j=>Math.max(1,j-1)),disabled:q===1,children:"Previous"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",q," of ",xt]})}),e.jsx($,{variant:"outline",size:"sm",onClick:()=>U(j=>Math.min(xt,j+1)),disabled:q===xt,children:"Next"})]})]})})]})]})})}const ar=r=>r.toISOString();function Hl(){const{user:r,loading:t}=ft(),s=cs(),{toast:a}=Fe(),n=ut(),[i,c]=p.useState(void 0),[u,d]=p.useState(!1),[o,m]=p.useState(null),[y,N]=p.useState([]),[v,_]=p.useState("all"),[C,g]=p.useState("all"),[S,D]=p.useState("all"),[I,E]=p.useState(""),[q,U]=p.useState({from:"",to:""}),[O,ee]=p.useState(1),[L,P]=p.useState(50),{config:h}=Rt("sales-record"),{validationRules:k,canImport:x}=qt("sales-record"),{currentSort:T,handleSort:b,getSortedData:R}=as();if(et.useEffect(()=>{o&&u&&(console.log("ðŸ”„ Populating form for edit:",o),de({date:o.date,sales_channel_id:o.sales_channel_id,product_id:o.product_id,sku:o.sku,sold_units:o.sold_units,unit_price:o.unit_price,total_price:o.total_price,notes:o.notes||"",dateString:new Date(o.date).toISOString().split("T")[0]}))},[o,u]),t)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ve,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Validating authentication..."})]})});if(!r)return console.error("SalesRecord: User not authenticated, redirecting to login"),e.jsx(Rs,{to:"/login",state:{from:s},replace:!0});const{data:Y=[]}=fe({queryKey:["products"],queryFn:()=>Ht.getAll()}),{data:M=[]}=fe({queryKey:["sales-channels"],queryFn:()=>Ms.getAll()}),J=p.useMemo(()=>{const f=[];return i?.from&&f.push(Ze.greaterThanEqual("date",ar(i.from))),i?.to&&f.push(Ze.lessThanEqual("date",ar(i.to))),f},[i]),{data:V=[],isLoading:le}=fe({queryKey:["sales-records",i?.from?.toISOString(),i?.to?.toISOString()],queryFn:()=>os.getAll(J)}),ge=De({mutationFn:async f=>{try{return await os.create(f)}catch(z){throw console.error("SalesRecord: Failed to create sales record",{error:z.message,code:z.code,type:z.type,payload:f,userId:r?.$id}),z.code===401?(a({title:"Authentication Error",description:"Your session has expired. Please log in again.",variant:"destructive"}),window.location.href="/login",z):z.code===403?(a({title:"Permission Denied",description:"You don't have permission to create sales records.",variant:"destructive"}),z):(a({title:"Error",description:z.message||"Failed to create sales record. Please try again.",variant:"destructive"}),z)}},onSuccess:f=>{n.invalidateQueries({queryKey:["sales-records"]}),a({title:"Success",description:"Sales record created successfully.",duration:3e3}),d(!1),N([]),de({date:new Date().toISOString(),sales_channel_id:"",product_id:"",sku:"",sold_units:0,unit_price:0,total_price:0,notes:""}),m(null)}}),we=De({mutationFn:async({id:f,data:z})=>await os.update(f,z),onSuccess:f=>{n.invalidateQueries({queryKey:["sales-records"]}),a({title:"Success",description:"Sales record updated successfully.",duration:3e3}),d(!1),m(null),de({date:new Date().toISOString(),sales_channel_id:"",product_id:"",sku:"",sold_units:0,unit_price:0,total_price:0,notes:""})},onError:f=>{console.error("Failed to update sales record:",f),a({title:"Error",description:f.message||"Failed to update sales record. Please try again.",variant:"destructive"})}}),[H,de]=p.useState({date:new Date().toISOString(),sales_channel_id:"",product_id:"",sku:"",sold_units:0,unit_price:0,total_price:0,notes:""}),Ne=De({mutationFn:f=>os.delete(f),onSuccess:()=>{n.invalidateQueries({queryKey:["sales-records"]}),a({title:"Success",description:"Sales record deleted successfully."})},onError:()=>{a({title:"Error",description:"Failed to delete sales record.",variant:"destructive"})}}),Le=De({mutationFn:async f=>{await Promise.all(f.map(z=>os.delete(z)))},onSuccess:()=>{n.invalidateQueries({queryKey:["sales-records"]}),N([]),a({title:"Success",description:"Selected records deleted successfully."})},onError:()=>{a({title:"Error",description:"Failed to delete selected records.",variant:"destructive"})}}),mt=f=>{console.log("ðŸ” Editing sales record:",f),m(f),d(!0)},ye=f=>{confirm("Are you sure you want to delete this sales record?")&&Ne.mutate(f)},Pe=()=>{if(y.length===0){a({title:"No Selection",description:"Please select records to delete.",variant:"destructive"});return}confirm(`Are you sure you want to delete ${y.length} selected record(s)?`)&&Le.mutate(y.map(f=>f.$id))},Be=()=>{if(y.length===0){a({title:"No Selection",description:"Please select records to export.",variant:"destructive"});return}a({title:"Export",description:`Exporting ${y.length} selected record(s)...`})},Ke=V.filter(f=>{const z=!I||f.sku.toLowerCase().includes(I.toLowerCase())||f.notes&&f.notes.toLowerCase().includes(I.toLowerCase()),ue=v==="all"||f.sales_channel_id===v,xe=C==="all"||f.product_id===C,qe=S==="all"||f.sku===S,$e=new Date(f.date),Me=(!q.from||$e>=new Date(q.from))&&(!q.to||$e<=new Date(q.to));return z&&ue&&xe&&qe&&Me}),Je=et.useMemo(()=>{const f=new Map;return V.forEach(z=>{f.has(z.sales_channel_id)||f.set(z.sales_channel_id,{id:z.sales_channel_id,name:M.find(ue=>ue.$id===z.sales_channel_id)?.channel_name||z.sales_channel_id})}),Array.from(f.values()).sort((z,ue)=>z.name.localeCompare(ue.name))},[V,M]),bt=et.useMemo(()=>{const f=new Map;return V.forEach(z=>{f.has(z.product_id)||f.set(z.product_id,{id:z.product_id,name:Y.find(ue=>ue.$id===z.product_id)?.product||z.product_id})}),Array.from(f.values()).sort((z,ue)=>z.name.localeCompare(ue.name))},[V,Y]),Lt=et.useMemo(()=>Array.from(new Set(V.map(f=>f.sku))).sort(),[V]),ht=Ke.length,xt=Math.ceil(ht/L),Nt=(O-1)*L,wt=Nt+L,l=Ke.slice(Nt,wt);p.useEffect(()=>{ee(1)},[I,v,C,S,q,L]);const W=f=>{if(f.preventDefault(),!H.sales_channel_id||!H.product_id||!H.sku||!H.sold_units||!H.unit_price||!H.dateString){a({title:"Validation Error",description:"Please fill all required fields: Date, Sales Channel, Product, SKU, Quantity, and Rate.",variant:"destructive"});return}if(H.sold_units<=0){a({title:"Validation Error",description:"Quantity must be greater than 0.",variant:"destructive"});return}if(H.unit_price<=0){a({title:"Validation Error",description:"Rate must be greater than 0.",variant:"destructive"});return}const z={date:H.dateString?new Date(H.dateString).toISOString():H.date,sales_channel_id:H.sales_channel_id,product_id:H.product_id,sku:H.sku,sold_units:H.sold_units,unit_price:H.unit_price,total_price:Number((H.sold_units*H.unit_price).toFixed(2)),notes:H.notes||void 0};o?we.mutate({id:o.$id,data:z}):ge.mutate(z)};return e.jsx("div",{className:"p-4",children:e.jsxs(G,{children:[e.jsx(me,{children:e.jsxs(pe,{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Sales Records"}),e.jsxs("div",{className:"flex gap-2",children:[x&&h&&e.jsx(Pt,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:h.exportColumns.filter(f=>f.required).map(f=>f.exportHeader),optionalColumns:h.exportColumns.filter(f=>!f.required).map(f=>f.exportHeader),validationRules:k,maxFileSize:50,existingData:V||[],validationHeaderMapper:f=>{const z=h.exportColumns.find(ue=>ue.dataKey===f);return z?z.exportHeader:f},columnMapper:f=>{const z=h.exportColumns.find(ue=>ue.exportHeader===f);return z?z.dataKey==="channelName"?"channel_name":z.dataKey==="productName"?"product_name":z.dataKey==="sku"?"sku":{date:"date",qty:"sold_units",rate:"unit_price",totalAmount:"total_amount",status:"status",remarks:"remarks"}[z.dataKey]||z.dataKey:f},dataProcessor:async(f,z)=>{console.log("ðŸ“ [SalesRecord] dataProcessor CALLED"),console.log("ðŸ“ [SalesRecord] Row data:",JSON.stringify(f,null,2));let ue=f["Sales Channel"]||f.channel_name||f.channel_name||f["Sales Channel Name"];if(console.log("ðŸ“ [SalesRecord] Channel name from row:",ue),!ue||ue==="")throw new Error("Sales Channel is required");const xe=String(ue).trim(),qe=M?.find(Ce=>Ce.channel_name.toLowerCase()===xe.toLowerCase());if(!qe){const Ce=M?.map(Re=>Re.channel_name).slice(0,5).join(", ")||"None";throw new Error(`Sales Channel "${xe}" not found. Available channels: ${Ce}${M&&M.length>5?"...":""}. Please check the channel name matches exactly.`)}const $e=qe.$id;let Me=f.Product||f.product_name||f.product_name,A=f.SKU||f.sku||f.sku;if(!Me||Me==="")throw new Error("Product is required");let he="";if(A&&typeof A=="string"){const Ce=A.trim(),Re=Ce.match(/^([^â€”\-]+?)(\s*[â€”\-]\s*|$)/);Re?he=Re[1].trim():he=Ce}else he=String(A||"").trim();const ve=String(Me).trim();let je=Y?.find(Ce=>Ce.product&&Ce.product.toLowerCase()===ve.toLowerCase());if(!je&&he&&(je=Y?.find(Ce=>Ce.sku&&Ce.sku.toLowerCase()===he.toLowerCase())),!je){const Ce=Y?.map(Re=>`${Re.product||Re.$id} (SKU: ${Re.sku||"N/A"})`).slice(0,5).join(", ")||"None";throw new Error(`Product "${ve}" or SKU "${he||A}" not found. Available products: ${Ce}${Y&&Y.length>5?"...":""}. Please check the product name or SKU matches exactly.`)}const gt=je.$id,Te=je.sku||he||"";let _e=f.Date||f.date||f.date,Oe;if(_e&&typeof _e=="string"){const Ce=_e.match(/^(\d{2})-(\d{2})-(\d{4})$/);if(Ce){const[,Re,Ye,ns]=Ce,dt=new Date(parseInt(ns),parseInt(Ye)-1,parseInt(Re));if(isNaN(dt.getTime()))throw new Error(`Invalid date format: ${_e}. Use DD-MM-YYYY format (e.g., 15-01-2024).`);Oe=dt.toISOString()}else{const Re=new Date(_e);if(isNaN(Re.getTime()))throw new Error(`Invalid date format: ${_e}. Use DD-MM-YYYY format (e.g., 15-01-2024).`);Oe=Re.toISOString()}}else if(_e instanceof Date){if(isNaN(_e.getTime()))throw new Error("Invalid date. Use DD-MM-YYYY format (e.g., 15-01-2024).");Oe=_e.toISOString()}else Oe=new Date().toISOString();const Ue=parseFloat(f.Qty||f.qty||f.sold_units||"0"),Ie=parseFloat(f.Rate||f.rate||f.unit_price||"0");if(!Ue||Ue<=0||isNaN(Ue))throw new Error(`Invalid Quantity: ${Ue}. Must be greater than 0.`);if(!Ie||Ie<=0||isNaN(Ie))throw new Error(`Invalid Rate: ${Ie}. Must be greater than 0.`);const j=Number((Ue*Ie).toFixed(2)),te=(f.Remarks||f.remarks||f.notes||"").trim()||void 0,ce={date:Oe,sales_channel_id:$e,product_id:gt,sku:Te||"",sold_units:Ue,unit_price:Ie,total_price:j,notes:te};console.log("ðŸ”„ [SalesRecord] About to create record with:",JSON.stringify(ce,null,2));const Se=await os.create(ce);return console.log("âœ… [SalesRecord] Record created successfully! ID:",Se.$id),console.log("âœ… [SalesRecord] Full created object:",JSON.stringify(Se,null,2)),Se},onImportComplete:async f=>{if(console.log("ðŸ“Š Import Result:",f),console.log("âœ… Successful Rows:",f.successfulRows),console.log("âŒ Failed Rows:",f.failedRows),console.log("âš ï¸ Errors:",f.errors),await n.invalidateQueries({queryKey:["sales-records"],refetchType:"active"}),await n.refetchQueries({queryKey:["sales-records"]}),f.failedRows>0&&f.errors.length>0){const z=f.errors.slice(0,5).map(ue=>`Row ${ue.row}: ${ue.message}`).join(`
`);a({title:"Import Completed with Errors",description:`${f.successfulRows} successful, ${f.failedRows} failed.

First errors:
${z}`,variant:"destructive",duration:1e4})}else f.successfulRows>0?a({title:"Import Successful",description:`${f.successfulRows} sales records imported successfully.`}):a({title:"Import Failed",description:`No records were imported. ${f.errors.length>0?`Errors: ${f.errors[0]?.message}`:"Unknown error"}`,variant:"destructive"})}},variant:"outline"}),h&&e.jsx(Ct,{data:V.map(f=>{const z={};return h.exportColumns.forEach(ue=>{let xe;switch(ue.dataKey){case"date":xe=f.date;break;case"channelName":xe=M.find(qe=>qe.$id===f.sales_channel_id)?.channel_name||f.sales_channel_id;break;case"productName":xe=Y.find(qe=>qe.$id===f.product_id)?.product||f.product_id;break;case"sku":xe=f.sku;break;case"qty":xe=f.sold_units;break;case"rate":xe=f.unit_price;break;case"totalAmount":xe=Number((f.sold_units*f.unit_price).toFixed(2));break;case"status":xe="Completed";break;case"remarks":xe=f.notes||"";break;default:xe=f[ue.dataKey]}z[ue.exportHeader]=ue.formatter?ue.formatter(xe):xe}),z}),headers:h.exportColumns.map(f=>f.exportHeader),filename:"sales-record",variant:"outline"}),e.jsxs($,{onClick:()=>d(!0),children:[e.jsx(Tt,{className:"mr-2 h-4 w-4"})," Add Sales Record"]})]})]})}),e.jsxs(Z,{children:[e.jsx(G,{className:"mb-6",children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(pt,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(B,{placeholder:"Search records...",className:"pl-10",value:I,onChange:f=>E(f.target.value)})]}),x&&h&&e.jsx(Pt,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:h.exportColumns.filter(f=>f.required).map(f=>f.exportHeader),optionalColumns:h.exportColumns.filter(f=>!f.required).map(f=>f.exportHeader),validationRules:k,onImportComplete:f=>{f.successfulRows>0&&(n.invalidateQueries({queryKey:["sales-records"]}),a({title:"Import Successful",description:`${f.successfulRows} sales records imported successfully.`}))}},variant:"outline"}),h&&e.jsx(Ct,{data:Ke.map(f=>{const z={};return h.exportColumns.forEach(ue=>{let xe;switch(ue.dataKey){case"date":xe=f.date;break;case"channelName":xe=M.find(qe=>qe.$id===f.sales_channel_id)?.channel_name||f.sales_channel_id;break;case"productName":xe=Y.find(qe=>qe.$id===f.product_id)?.product||f.product_id;break;case"sku":xe=f.sku;break;case"qty":xe=f.sold_units;break;case"rate":xe=f.unit_price;break;case"totalAmount":xe=Number((f.sold_units*f.unit_price).toFixed(2));break;case"status":xe="Completed";break;case"remarks":xe=f.notes||"";break;default:xe=f[ue.dataKey]}z[ue.exportHeader]=ue.formatter?ue.formatter(xe):xe}),z}),headers:h.exportColumns.map(f=>f.exportHeader),filename:"sales-record",variant:"outline"})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs(re,{value:v,onValueChange:_,children:[e.jsx(se,{className:"w-[180px]",children:e.jsx(ne,{placeholder:"Filter by Channel"})}),e.jsxs(ae,{children:[e.jsx(w,{value:"all",children:"All Channels"}),Je.map(f=>e.jsx(w,{value:f.id,children:f.name},f.id))]})]}),e.jsxs(re,{value:C,onValueChange:g,children:[e.jsx(se,{className:"w-[180px]",children:e.jsx(ne,{placeholder:"Filter by Product"})}),e.jsxs(ae,{children:[e.jsx(w,{value:"all",children:"All Products"}),bt.map(f=>e.jsx(w,{value:f.id,children:f.name},f.id))]})]}),e.jsxs(re,{value:S,onValueChange:D,children:[e.jsx(se,{className:"w-[180px]",children:e.jsx(ne,{placeholder:"Filter by SKU"})}),e.jsxs(ae,{children:[e.jsx(w,{value:"all",children:"All SKUs"}),Lt.map(f=>e.jsx(w,{value:f,children:f},f))]})]}),e.jsx(B,{type:"date",placeholder:"From Date",className:"w-[150px]",value:q.from,onChange:f=>U(z=>({...z,from:f.target.value}))}),e.jsx(B,{type:"date",placeholder:"To Date",className:"w-[150px]",value:q.to,onChange:f=>U(z=>({...z,to:f.target.value}))})]})]})})}),e.jsx(ot,{open:u,onOpenChange:f=>{d(f),f||(de({date:new Date().toISOString(),sales_channel_id:"",product_id:"",sku:"",sold_units:0,unit_price:0,total_price:0,notes:""}),m(null))},children:e.jsxs(at,{className:"sm:max-w-[720px]",children:[e.jsxs(rt,{children:[e.jsx(it,{children:o?"Edit Sales Record":"Add New Sales Record"}),e.jsx(lt,{children:"Enter sales record details below."})]}),e.jsxs("form",{onSubmit:W,children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 py-4",children:[e.jsxs("div",{children:[e.jsx(F,{htmlFor:"date",children:"Date *"}),e.jsx(B,{id:"date",type:"date",value:H.dateString||"",onChange:f=>de(z=>({...z,dateString:f.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"channel",children:"Sales Channel *"}),e.jsxs(re,{value:H.sales_channel_id,onValueChange:f=>de(z=>({...z,sales_channel_id:f})),children:[e.jsx(se,{id:"channel",children:e.jsx(ne,{placeholder:"Select Sales Channel"})}),e.jsx(ae,{children:M.map(f=>e.jsx(w,{value:f.$id,children:f.channel_name||f.$id},f.$id))})]})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"product",children:"Product *"}),e.jsxs(re,{value:H.product_id,onValueChange:f=>de(z=>({...z,product_id:f,sku:Y.find(ue=>ue.$id===f)?.sku||z.sku})),children:[e.jsx(se,{id:"product",children:e.jsx(ne,{placeholder:"Select Product"})}),e.jsx(ae,{children:Y.map(f=>e.jsx(w,{value:f.$id,children:f.product||f.$id},f.$id))})]})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"sku",children:"SKU *"}),e.jsxs(re,{value:H.sku,onValueChange:f=>de(z=>({...z,sku:f})),children:[e.jsx(se,{id:"sku",children:e.jsx(ne,{placeholder:"Select SKU"})}),e.jsx(ae,{children:Y.filter(f=>f.sku).map(f=>e.jsx(w,{value:f.sku,children:f.sku},f.$id))})]})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"qty",children:"Quantity *"}),e.jsx(B,{id:"qty",type:"number",min:"1",value:H.sold_units,onChange:f=>de(z=>({...z,sold_units:Number(f.target.value),total_price:Number((Number(f.target.value)*z.unit_price).toFixed(2))})),required:!0})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"rate",children:"Rate *"}),e.jsx(B,{id:"rate",type:"number",step:"0.01",min:"0.01",value:H.unit_price,onChange:f=>de(z=>({...z,unit_price:Number(f.target.value),total_price:Number((z.sold_units*Number(f.target.value)).toFixed(2))})),required:!0})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"total",children:"Total Amount"}),e.jsx(B,{id:"total",type:"number",step:"0.01",value:Number((H.sold_units*H.unit_price).toFixed(2)),readOnly:!0,className:"bg-gray-100"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(F,{htmlFor:"notes",children:"Remarks"}),e.jsx(B,{id:"notes",type:"text",value:H.notes||"",onChange:f=>de(z=>({...z,notes:f.target.value}))})]})]}),e.jsx(nt,{children:e.jsx($,{type:"submit",disabled:ge.isPending||we.isPending,children:ge.isPending||we.isPending?e.jsxs(e.Fragment,{children:[e.jsx(Ve,{className:"mr-2 h-4 w-4 animate-spin"}),"Savingâ€¦"]}):o?"Update Sales Record":"Add Sales Record"})})]})]})}),e.jsx(G,{children:e.jsxs(Z,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",Nt+1," to ",Math.min(wt,ht)," of ",ht," records"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Records per page:"}),e.jsxs(re,{value:L.toString(),onValueChange:f=>P(Number(f)),children:[e.jsx(se,{className:"w-[100px]",children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(w,{value:"50",children:"50"}),e.jsx(w,{value:"100",children:"100"}),e.jsx(w,{value:"500",children:"500"})]})]})]})]}),y.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 p-3 bg-muted rounded-md",children:[e.jsxs("span",{className:"text-sm font-medium",children:[y.length," selected"]}),e.jsx($,{variant:"destructive",size:"sm",onClick:Pe,disabled:Le.isPending,children:"Delete Selected"}),e.jsx($,{variant:"outline",size:"sm",onClick:Be,children:"Export Selected"})]}),e.jsx("div",{className:"border rounded-md",children:e.jsx("div",{className:"overflow-auto",style:{maxHeight:"600px"},children:e.jsx(ds,{data:R(l.map(f=>((!f.date||f.date==="Invalid Date")&&console.warn("Invalid sales record date found:",{id:f.$id,date:f.date}),{...f,formattedDate:xa(f.date),channelName:M.find(z=>z.$id===f.sales_channel_id)?.channel_name||f.sales_channel_id,productName:Y.find(z=>z.$id===f.product_id)?.product||f.product_id,totalAmount:Number((f.sold_units*f.unit_price).toFixed(2)),status:"Completed"}))),columns:[{key:"formattedDate",label:"Date",sortable:!0,dataType:"date"},{key:"channelName",label:"Sales Channel",sortable:!0,dataType:"string"},{key:"productName",label:"Product",sortable:!0,dataType:"string"},{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"sold_units",label:"Qty",sortable:!0,dataType:"number",align:"right",headerClassName:"bg-purple-50",cellClassName:"bg-purple-50 font-medium"},{key:"unit_price",label:"Rate",sortable:!0,dataType:"number",align:"right"},{key:"totalAmount",label:"Total Amount",sortable:!0,dataType:"number",align:"right",headerClassName:"bg-green-50",cellClassName:"bg-green-50 font-medium"},{key:"status",label:"Status",sortable:!0,dataType:"string",formatter:f=>e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${f==="Completed"?"bg-green-100 text-green-800":f==="In Progress"?"bg-yellow-100 text-yellow-800":f==="Pending"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:f})},{key:"notes",label:"Remarks",sortable:!0,dataType:"string"}],onSort:b,currentSort:T,loading:le,maxHeight:"none",stickyHeader:!0,bordered:!1,searchable:!1,rowKey:"$id",selectable:!0,selectedRows:y,onSelectionChange:N,actions:[{label:"Edit",onClick:mt,variant:"default"},{label:"Delete",onClick:f=>ye(f.$id),variant:"destructive"}],emptyMessage:"No sales records found"})})}),xt>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx($,{variant:"outline",size:"sm",onClick:()=>ee(f=>Math.max(1,f-1)),disabled:O===1,children:"Previous"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",O," of ",xt]})}),e.jsx($,{variant:"outline",size:"sm",onClick:()=>ee(f=>Math.min(xt,f+1)),disabled:O===xt,children:"Next"})]})]})})]})]})})}const zl=()=>{const r=Oa(),t=[{title:"Stocks",description:"Manage inventory and stock levels",icon:Es,path:"/master/stocks",color:"text-blue-600"},{title:"Vendors",description:"Manage supplier information",icon:Jr,path:"/master/vendors",color:"text-green-600"},{title:"Staff",description:"Manage employee records",icon:Xr,path:"/master/staff",color:"text-purple-600"},{title:"Processes",description:"Manage business processes",icon:Ia,path:"/master/processes",color:"text-orange-600"},{title:"Raw Products",description:"Manage raw materials",icon:Aa,path:"/master/raw-products",color:"text-red-600"},{title:"Products",description:"Manage finished products",icon:Pi,path:"/master/products",color:"text-indigo-600"},{title:"Sales Channels",description:"Manage sales channels",icon:Ti,path:"/master/sales-channels",color:"text-teal-600"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Master Data"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your core business data and configurations"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map(s=>{const a=s.icon;return e.jsxs(G,{className:"hover:shadow-lg transition-shadow cursor-pointer",children:[e.jsxs(me,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(a,{className:`h-6 w-6 ${s.color}`}),e.jsx(pe,{className:"text-lg",children:s.title})]}),e.jsx(ke,{children:s.description})]}),e.jsx(Z,{children:e.jsxs($,{onClick:()=>r(s.path),className:"w-full",variant:"outline",children:["Manage ",s.title]})})]},s.title)})})]})},Ql=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Analytics"}),e.jsx("p",{className:"text-muted-foreground",children:"Business intelligence and performance analytics"})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(G,{children:[e.jsx(me,{children:e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(Sa,{className:"h-5 w-5 text-primary"}),"Production Analytics"]})}),e.jsx(Z,{children:e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"Production performance charts"}),e.jsx("p",{className:"text-sm",children:"Database connection required"})]})})]}),e.jsxs(G,{children:[e.jsx(me,{children:e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(Hs,{className:"h-5 w-5 text-primary"}),"Sales Trends"]})}),e.jsx(Z,{children:e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"Sales performance analysis"}),e.jsx("p",{className:"text-sm",children:"Database connection required"})]})})]}),e.jsxs(G,{children:[e.jsx(me,{children:e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(Di,{className:"h-5 w-5 text-primary"}),"Inventory Distribution"]})}),e.jsx(Z,{children:e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"Stock distribution charts"}),e.jsx("p",{className:"text-sm",children:"Database connection required"})]})})]}),e.jsxs(G,{children:[e.jsx(me,{children:e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(Ei,{className:"h-5 w-5 text-primary"}),"Efficiency Metrics"]})}),e.jsx(Z,{children:e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"Process efficiency analysis"}),e.jsx("p",{className:"text-sm",children:"Database connection required"})]})})]})]})]}),Yl=()=>{const r=cs();return p.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",r.pathname)},[r.pathname]),e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-gray-100",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"mb-4 text-4xl font-bold",children:"404"}),e.jsx("p",{className:"mb-4 text-xl text-gray-600",children:"Oops! Page not found"}),e.jsx("a",{href:"/",className:"text-blue-500 underline hover:text-blue-700",children:"Return to Home"})]})})},Wl=()=>{const[r,t]=p.useState(!1),[s,a]=p.useState(null),[n,i]=p.useState(""),{toast:c}=Fe(),u=ut(),{user:d}=ft(),{config:o}=Rt("stocks"),{validationRules:m,canImport:y}=qt("stocks"),{currentSort:N,handleSort:v,getSortedData:_}=as(),[C,g]=p.useState({stock_code:"",stock_name:"",category:"",uom:"",min_level:"",status:"Active"}),{data:S=[],isLoading:D,error:I}=fe({queryKey:["stocks"],queryFn:async()=>await Bt.getAll(),enabled:!!d}),E=De({mutationFn:async T=>{const{stock_code:b,stock_name:R,category:Y,uom:M,min_level:J}=T,V={stock_code:b,stock_name:R,category:Y,uom:M,min_level:J},le=await Bt.create(V);if(le&&le.$id)try{const ge=new Date().toISOString().split("T")[0];await kn.create({stock_id:le.$id,opening_balance:0,purchases:0,used_in_production:0,status_date:ge})}catch(ge){console.error("Error creating stock status entry:",ge)}return le},onSuccess:()=>{u.invalidateQueries({queryKey:["stocks"]}),u.invalidateQueries({queryKey:["stock_status"]}),c({title:"Success",description:"Stock created successfully"}),t(!1),a(null),P()},onError:T=>{c({title:"Error",description:"Failed to create stock",variant:"destructive"}),console.error("Error creating stock:",T)}}),q=De({mutationFn:async({id:T,data:b})=>{const{stock_code:R,name:Y,category:M,uom:J,min_level:V}=b,le={stock_code:R,stock_name:Y,category:M,uom:J,min_level:V};return await Bt.update(T,le)},onSuccess:()=>{u.invalidateQueries({queryKey:["stocks"]}),u.invalidateQueries({queryKey:["stock_status"]}),c({title:"Success",description:"Stock updated successfully"}),t(!1),a(null),P()},onError:T=>{c({title:"Error",description:"Failed to update stock",variant:"destructive"}),console.error("Error updating stock:",T)}}),U=De({mutationFn:T=>Bt.delete(T),onSuccess:()=>{u.invalidateQueries({queryKey:["stocks"]}),c({title:"Success",description:"Stock deleted successfully"})},onError:T=>{c({title:"Error",description:"Failed to delete stock",variant:"destructive"}),console.error("Error deleting stock:",T)}}),O=async T=>{if(T.preventDefault(),!C.stock_code.trim()){c({title:"Error",description:"Stock Code is required",variant:"destructive"});return}if(!C.stock_name?.trim()){c({title:"Error",description:"Stock Name is required",variant:"destructive"});return}if(!C.category.trim()){c({title:"Error",description:"Category is required",variant:"destructive"});return}if(!C.uom.trim()){c({title:"Error",description:"UoM is required",variant:"destructive"});return}if(!C.min_level.trim()){c({title:"Error",description:"Min Level is required",variant:"destructive"});return}const b={...C,min_level:C.min_level?parseFloat(C.min_level):void 0};s?q.mutate({id:s.$id,data:b}):E.mutate(b)},ee=T=>{a(T),g({stock_code:T.stock_code,stock_name:T.stock_name||"",category:T.category||"",uom:T.uom||"",min_level:T.min_level?.toString()||"",status:T.status}),t(!0)},L=async T=>{await requestDeletion("stock",T.$id,T.stock_name,()=>U.mutate(T.$id))},P=()=>{g({stock_code:"",stock_name:"",category:"",uom:"",min_level:"",status:"Active"})},h=()=>{a(null),P(),t(!0)},k=S.filter(T=>T.stock_name.toLowerCase().includes(n.toLowerCase())||T.stock_code.toLowerCase().includes(n.toLowerCase())||T.category.toLowerCase().includes(n.toLowerCase())),x=_(k);return I?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("p",{className:"text-red-500",children:["Error loading stocks: ",I.message]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Stocks"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage raw materials and stock items"})]}),e.jsxs(ot,{open:r,onOpenChange:t,children:[e.jsx(js,{asChild:!0,children:e.jsxs($,{onClick:h,className:"bg-primary hover:bg-primary/90",children:[e.jsx(Tt,{className:"h-4 w-4 mr-2"}),"Add New Stock"]})}),e.jsxs(at,{className:"sm:max-w-[425px]",children:[e.jsxs(rt,{children:[e.jsx(it,{children:s?"Edit Stock":"Add New Stock"}),e.jsxs(lt,{children:[s?"Update stock information":"Enter stock details to add a new stock",e.jsxs("span",{className:"mt-2 text-sm text-muted-foreground",children:["Fields marked with ",e.jsx("span",{className:"text-red-500",children:"*"})," are required."]})]})]}),e.jsxs("form",{onSubmit:O,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(F,{htmlFor:"stock_code",className:"text-right",children:["Stock Code ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(B,{id:"stock_code",value:C.stock_code,onChange:T=>g({...C,stock_code:T.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(F,{htmlFor:"stock_name",className:"text-right",children:["Stock Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(B,{id:"stock_name",value:C.stock_name,onChange:T=>g({...C,stock_name:T.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(F,{htmlFor:"category",className:"text-right",children:["Category ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(B,{id:"category",value:C.category,onChange:T=>g({...C,category:T.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(F,{htmlFor:"uom",className:"text-right",children:["UoM ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(re,{value:C.uom,onValueChange:T=>g({...C,uom:T}),children:[e.jsx(se,{className:"col-span-3",children:e.jsx(ne,{placeholder:"Select unit of measure"})}),e.jsxs(ae,{children:[e.jsx(w,{value:"kg",children:"kg"}),e.jsx(w,{value:"g",children:"g"}),e.jsx(w,{value:"ltr",children:"ltr"}),e.jsx(w,{value:"ml",children:"ml"}),e.jsx(w,{value:"pcs",children:"pcs"}),e.jsx(w,{value:"bags",children:"bags"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(F,{htmlFor:"min_level",className:"text-right",children:["Min Level ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(B,{id:"min_level",type:"number",step:"0.01",value:C.min_level,onChange:T=>g({...C,min_level:T.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(F,{htmlFor:"status",className:"text-right",children:"Status"}),e.jsxs(re,{value:C.status,onValueChange:T=>g({...C,status:T}),children:[e.jsx(se,{className:"col-span-3",children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(w,{value:"Active",children:"Active"}),e.jsx(w,{value:"Inactive",children:"Inactive"})]})]})]})]}),e.jsx(nt,{children:e.jsx($,{type:"submit",disabled:E.isPending||q.isPending,children:E.isPending||q.isPending?"Saving...":s?"Update":"Create"})})]})]})]})]}),e.jsx(G,{children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(pt,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(B,{placeholder:"Search stocks...",className:"pl-10",value:n,onChange:T=>i(T.target.value)})]}),e.jsxs($,{variant:"outline",children:[e.jsx(ts,{className:"h-4 w-4 mr-2"}),"Filter"]}),y&&e.jsx(Pt,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:["Stock Name","SKU","Unit"],optionalColumns:["Category","Opening Balance"],validationRules:m,onImportComplete:T=>{T.successfulRows>0&&(u.invalidateQueries({queryKey:["stocks"]}),c({title:"Import Successful",description:`${T.successfulRows} stocks imported successfully.`}))}},variant:"outline"}),o&&e.jsx(Ct,{data:k.map(T=>({name:T.stock_name,sku:T.stock_code,category:T.category,unit:T.uom,openingBalance:T.min_level||0,createdAt:T.$createdAt})),headers:o.exportColumns.map(T=>T.exportHeader),filename:"stocks",variant:"outline"})]})})}),e.jsxs(G,{children:[e.jsx(me,{children:e.jsxs(pe,{children:["Stock Items (",k.length,")"]})}),e.jsx(Z,{children:e.jsx(ds,{data:x.map(T=>({...T,stock_code:T.stock_code||"",stock_name:T.stock_name||"",category:T.category||"-",uom:T.uom||"-",min_level:T.min_level||0,status:T.status||"Active"})),columns:[{key:"stock_code",label:"Stock Code",sortable:!0,dataType:"string"},{key:"stock_name",label:"Stock Name",sortable:!0,dataType:"string"},{key:"category",label:"Category",sortable:!0,dataType:"string"},{key:"uom",label:"UoM",sortable:!0,dataType:"string"},{key:"min_level",label:"Min Level",sortable:!0,dataType:"number",align:"right"},{key:"status",label:"Status",sortable:!0,dataType:"string"}],onSort:v,currentSort:N,loading:D,emptyMessage:"No stocks found",actions:[{label:"Edit",icon:e.jsx(ss,{className:"h-4 w-4"}),onClick:ee},{label:"Delete",icon:e.jsx($t,{className:"h-4 w-4"}),onClick:T=>L(T),variant:"destructive"}]})})]})]})},rs=p.forwardRef(({className:r,...t},s)=>e.jsx("textarea",{className:ie("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:s,...t}));rs.displayName="Textarea";const Gl=()=>{const[r,t]=p.useState(""),[s,a]=p.useState("all"),[n,i]=p.useState(!1),[c,u]=p.useState(null),[d,o]=p.useState({vendor_name:"",contact_person:"",phone:"",email:"",address:"",gstin:"",status:"Active"}),{toast:m}=Fe(),y=ut(),{config:N}=Rt("vendors"),{validationRules:v,canImport:_}=qt("vendors"),{data:C=[],isLoading:g,error:S}=fe({queryKey:["vendors"],queryFn:async()=>await Ls.getAll()}),D=De({mutationFn:h=>{const{vendor_name:k,contact_person:x,phone:T,email:b,address:R,gstin:Y}=h,M={vendor_name:k,contact_person:x||"",phone:T||"",address:R||"",gstin:Y||""};return b&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(b)&&(M.email=b),Ls.create(M)},onSuccess:()=>{y.invalidateQueries({queryKey:["vendors"]}),m({title:"Success",description:"Vendor created successfully"}),i(!1),q()},onError:h=>{m({title:"Error",description:"Failed to create vendor",variant:"destructive"}),console.error("Error creating vendor:",h)}}),I=De({mutationFn:({id:h,data:k})=>{const{vendor_name:x,contact_person:T,phone:b,email:R,address:Y,gstin:M}=k,J={vendor_name:x,contact_person:T||"",phone:b||"",address:Y||"",gstin:M||""};return R&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(R)&&(J.email=R),Ls.update(h,J)},onSuccess:()=>{y.invalidateQueries({queryKey:["vendors"]}),m({title:"Success",description:"Vendor updated successfully"}),i(!1),q()},onError:h=>{m({title:"Error",description:"Failed to update vendor",variant:"destructive"}),console.error("Error updating vendor:",h)}}),E=De({mutationFn:h=>Ls.delete(h),onSuccess:()=>{y.invalidateQueries({queryKey:["vendors"]}),m({title:"Success",description:"Vendor deleted successfully"})},onError:h=>{m({title:"Error",description:"Failed to delete vendor",variant:"destructive"}),console.error("Error deleting vendor:",h)}}),q=()=>{o({vendor_name:"",contact_person:"",phone:"",email:"",address:"",gstin:"",status:"Active"}),u(null)},U=h=>{if(h.preventDefault(),!d.vendor_name.trim()){m({title:"Error",description:"Vendor Name is required",variant:"destructive"});return}if(!d.contact_person.trim()){m({title:"Error",description:"Contact Person is required",variant:"destructive"});return}if(d.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(d.email)){m({title:"Error",description:"Please enter a valid email address",variant:"destructive"});return}c?I.mutate({id:c.$id,data:d}):D.mutate(d)},O=h=>{u(h),o({vendor_name:h.vendor_name,contact_person:h.contact_person||"",phone:h.phone||"",email:h.email||"",address:h.address||"",gstin:h.gstin||"",status:h.status}),i(!0)},ee=h=>{confirm("Are you sure you want to delete this vendor?")&&E.mutate(h)},L=()=>{u(null),q(),i(!0)},P=C.filter(h=>{const k=h.vendor_name.toLowerCase().includes(r.toLowerCase())||h.contact_person?.toLowerCase().includes(r.toLowerCase())||h.email?.toLowerCase().includes(r.toLowerCase()),x=s==="all"||h.status===s;return k&&x});return S?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("p",{className:"text-red-500",children:["Error loading vendors: ",S.message]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Vendors"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage vendor information and relationships"})]}),e.jsxs(ot,{open:n,onOpenChange:i,children:[e.jsx(js,{asChild:!0,children:e.jsxs($,{onClick:L,className:"bg-primary hover:bg-primary/90",children:[e.jsx(Tt,{className:"h-4 w-4 mr-2"}),"Add New Vendor"]})}),e.jsxs(at,{className:"sm:max-w-[500px]",children:[e.jsxs(rt,{children:[e.jsx(it,{children:c?"Edit Vendor":"Add New Vendor"}),e.jsxs(lt,{children:[c?"Update vendor information":"Enter vendor details to add a new vendor",e.jsxs("p",{className:"mt-2 text-sm text-muted-foreground",children:["Fields marked with ",e.jsx("span",{className:"text-red-500",children:"*"})," are required."]})]})]}),e.jsxs("form",{onSubmit:U,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(F,{htmlFor:"vendor_name",className:"text-right",children:["Vendor Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(B,{id:"vendor_name",value:d.vendor_name,onChange:h=>o({...d,vendor_name:h.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(F,{htmlFor:"contact_person",className:"text-right",children:["Contact Person ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(B,{id:"contact_person",value:d.contact_person,onChange:h=>o({...d,contact_person:h.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(F,{htmlFor:"phone",className:"text-right",children:"Phone"}),e.jsx(B,{id:"phone",value:d.phone,onChange:h=>o({...d,phone:h.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(F,{htmlFor:"email",className:"text-right",children:"Email"}),e.jsx(B,{id:"email",type:"email",value:d.email,onChange:h=>o({...d,email:h.target.value}),className:"col-span-3",placeholder:"Optional"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(F,{htmlFor:"address",className:"text-right",children:"Address"}),e.jsx(rs,{id:"address",value:d.address,onChange:h=>o({...d,address:h.target.value}),className:"col-span-3",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(F,{htmlFor:"gstin",className:"text-right",children:"GSTIN"}),e.jsx(B,{id:"gstin",value:d.gstin,onChange:h=>o({...d,gstin:h.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(F,{htmlFor:"status",className:"text-right",children:"Status"}),e.jsxs(re,{value:d.status,onValueChange:h=>o({...d,status:h}),children:[e.jsx(se,{className:"col-span-3",children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(w,{value:"Active",children:"Active"}),e.jsx(w,{value:"Inactive",children:"Inactive"})]})]})]})]}),e.jsx(nt,{children:e.jsx($,{type:"submit",children:c?"Update":"Create"})})]})]})]})]}),e.jsx(G,{children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(pt,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(B,{placeholder:"Search vendors...",className:"pl-10",value:r,onChange:h=>t(h.target.value)})]}),e.jsxs($,{variant:"outline",children:[e.jsx(ts,{className:"h-4 w-4 mr-2"}),"Filter"]}),_&&e.jsx(Pt,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:["Vendor Name"],optionalColumns:["Email","Phone","Contact Person","Address"],validationRules:v,onImportComplete:h=>{h.successfulRows>0&&(y.invalidateQueries({queryKey:["vendors"]}),m({title:"Import Successful",description:`${h.successfulRows} vendors imported successfully.`}))}},variant:"outline"}),N&&e.jsx(Ct,{data:P.map(h=>({name:h.vendor_name,email:h.email||"",phone:h.phone||"",contactPerson:h.contact_person||"",address:h.address||"",isActive:h.status==="Active",createdAt:h.$createdAt})),headers:N.exportColumns.map(h=>h.exportHeader),filename:"vendors",variant:"outline"})]})})}),e.jsxs(G,{children:[e.jsx(me,{children:e.jsxs(pe,{children:["Vendors (",P.length,")"]})}),e.jsx(Z,{children:g?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:e.jsx("span",{children:"Loading vendors..."})}):P.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("p",{className:"text-lg mb-2",children:"No vendors found"}),e.jsx("p",{className:"text-sm",children:"Add your first vendor to get started"})]}):e.jsxs(jt,{children:[e.jsx(yt,{children:e.jsxs(Ee,{children:[e.jsx(X,{children:"Vendor Name"}),e.jsx(X,{children:"Contact Person"}),e.jsx(X,{children:"Phone"}),e.jsx(X,{children:"Email"}),e.jsx(X,{children:"Address"}),e.jsx(X,{children:"GSTIN"}),e.jsx(X,{children:"Status"}),e.jsx(X,{children:"Actions"})]})}),e.jsx(vt,{children:P.map(h=>e.jsxs(Ee,{children:[e.jsx(Q,{className:"font-medium",children:h.vendor_name}),e.jsx(Q,{children:h.contact_person||"-"}),e.jsx(Q,{children:h.phone||"-"}),e.jsx(Q,{children:h.email||"-"}),e.jsx(Q,{className:"max-w-xs truncate",children:h.address||"-"}),e.jsx(Q,{children:h.gstin||"-"}),e.jsx(Q,{children:e.jsx(Qe,{variant:h.status==="Active"?"default":"secondary",children:h.status})}),e.jsx(Q,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx($,{variant:"outline",size:"sm",onClick:()=>O(h),children:e.jsx(ss,{className:"h-4 w-4"})}),e.jsx($,{variant:"outline",size:"sm",onClick:()=>ee(h.$id),children:e.jsx($t,{className:"h-4 w-4"})})]})})]},h.$id))})]})})]})]})},Jl=()=>{const[r,t]=p.useState(""),[s,a]=p.useState("all"),[n,i]=p.useState(!1),[c,u]=p.useState(null),[d,o]=p.useState({staff_code:"",staff_name:"",role:"",department:"",email:"",phone:"",joining_date:"",status:"Active"}),{toast:m}=Fe(),y=ut(),{config:N}=Rt("staff"),{validationRules:v,canImport:_}=qt("staff"),{getSortedData:C}=as(),g={async getAll(){return(await tt.listDocuments(st,be.STAFF)).documents},async create(x){return await tt.createDocument(st,be.STAFF,ps.unique(),x)},async update(x,T){return await tt.updateDocument(st,be.STAFF,x,T)},async delete(x){return await tt.deleteDocument(st,be.STAFF,x)}},{data:S=[],isLoading:D,error:I}=fe({queryKey:["staff"],queryFn:async()=>await g.getAll()}),E=De({mutationFn:x=>{const{staff_code:T,staff_name:b,role:R,department:Y,phone:M,email:J}=x,V={staff_code:T,staff_name:b,role:R,department:Y,phone:M||"",email:J||""};return g.create(V)},onSuccess:()=>{y.invalidateQueries({queryKey:["staff"]}),m({title:"Success",description:"Staff member created successfully"}),i(!1),O()},onError:x=>{m({title:"Error",description:"Failed to create staff member",variant:"destructive"}),console.error("Error creating staff:",x)}}),q=De({mutationFn:({id:x,data:T})=>{const{staff_code:b,staff_name:R,role:Y,department:M,phone:J,email:V}=T,le={staff_code:b,staff_name:R,role:Y,department:M,phone:J||"",email:V||""};return g.update(x,le)},onSuccess:()=>{y.invalidateQueries({queryKey:["staff"]}),m({title:"Success",description:"Staff member updated successfully"}),i(!1),O()},onError:x=>{m({title:"Error",description:"Failed to update staff member",variant:"destructive"}),console.error("Error updating staff:",x)}}),U=De({mutationFn:x=>g.delete(x),onSuccess:()=>{y.invalidateQueries({queryKey:["staff"]}),m({title:"Success",description:"Staff member deleted successfully"})},onError:x=>{m({title:"Error",description:"Failed to delete staff member",variant:"destructive"}),console.error("Error deleting staff:",x)}}),O=()=>{o({staff_code:"",staff_name:"",role:"",department:"",email:"",phone:"",joining_date:"",status:"Active"}),u(null)},ee=x=>{if(x.preventDefault(),!d.staff_code.trim()){m({title:"Error",description:"Staff Code is required",variant:"destructive"});return}if(!d.staff_name.trim()){m({title:"Error",description:"Staff Name is required",variant:"destructive"});return}if(!d.role.trim()){m({title:"Error",description:"Role is required",variant:"destructive"});return}if(!d.department.trim()){m({title:"Error",description:"Department is required",variant:"destructive"});return}if(d.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(d.email)){m({title:"Error",description:"Please enter a valid email address",variant:"destructive"});return}c?q.mutate({id:c.$id,data:d}):E.mutate(d)},L=x=>{u(x),o({staff_code:x.staff_code,staff_name:x.staff_name,role:x.role,department:x.department||"",email:x.email||"",phone:x.phone||"",joining_date:x.joining_date||"",status:x.status}),i(!0)},P=x=>{confirm("Are you sure you want to delete this staff member?")&&U.mutate(x)},h=()=>{u(null),O(),i(!0)},k=S.filter(x=>{const T=x.staff_name.toLowerCase().includes(r.toLowerCase())||x.staff_code.toLowerCase().includes(r.toLowerCase())||x.role.toLowerCase().includes(r.toLowerCase())||x.department?.toLowerCase().includes(r.toLowerCase()),b=s==="all"||x.status===s;return T&&b});return C(k),I?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("p",{className:"text-red-500",children:["Error loading staff: ",I.message]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Staff"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage employee data and roles"})]}),e.jsxs(ot,{open:n,onOpenChange:i,children:[e.jsx(js,{asChild:!0,children:e.jsxs($,{onClick:h,className:"bg-primary hover:bg-primary/90",children:[e.jsx(Tt,{className:"h-4 w-4 mr-2"}),"Add New Staff"]})}),e.jsxs(at,{className:"sm:max-w-[500px]",children:[e.jsxs(rt,{children:[e.jsx(it,{children:c?"Edit Staff":"Add New Staff"}),e.jsxs(lt,{children:[c?"Update staff information":"Enter staff details to add a new employee",e.jsxs("p",{className:"mt-2 text-sm text-muted-foreground",children:["Fields marked with ",e.jsx("span",{className:"text-red-500",children:"*"})," are required."]})]})]}),e.jsxs("form",{onSubmit:ee,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(F,{htmlFor:"staff_code",className:"text-right",children:["Staff Code ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(B,{id:"staff_code",value:d.staff_code,onChange:x=>o({...d,staff_code:x.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(F,{htmlFor:"staff_name",className:"text-right",children:["Staff Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(B,{id:"staff_name",value:d.staff_name,onChange:x=>o({...d,staff_name:x.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(F,{htmlFor:"role",className:"text-right",children:["Role ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(re,{value:d.role,onValueChange:x=>o({...d,role:x}),children:[e.jsx(se,{className:"col-span-3",children:e.jsx(ne,{placeholder:"Select role"})}),e.jsxs(ae,{children:[e.jsx(w,{value:"Manager",children:"Manager"}),e.jsx(w,{value:"Supervisor",children:"Supervisor"}),e.jsx(w,{value:"Operator",children:"Operator"}),e.jsx(w,{value:"Quality Controller",children:"Quality Controller"}),e.jsx(w,{value:"Warehouse Staff",children:"Warehouse Staff"}),e.jsx(w,{value:"Admin",children:"Admin"}),e.jsx(w,{value:"Accountant",children:"Accountant"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(F,{htmlFor:"department",className:"text-right",children:["Department ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(re,{value:d.department,onValueChange:x=>o({...d,department:x}),children:[e.jsx(se,{className:"col-span-3",children:e.jsx(ne,{placeholder:"Select department"})}),e.jsxs(ae,{children:[e.jsx(w,{value:"Production",children:"Production"}),e.jsx(w,{value:"Quality Control",children:"Quality Control"}),e.jsx(w,{value:"Warehouse",children:"Warehouse"}),e.jsx(w,{value:"Administration",children:"Administration"}),e.jsx(w,{value:"Accounts",children:"Accounts"}),e.jsx(w,{value:"Sales",children:"Sales"}),e.jsx(w,{value:"Purchase",children:"Purchase"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(F,{htmlFor:"email",className:"text-right",children:"Email"}),e.jsx(B,{id:"email",type:"email",value:d.email,onChange:x=>o({...d,email:x.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(F,{htmlFor:"phone",className:"text-right",children:"Phone"}),e.jsx(B,{id:"phone",value:d.phone,onChange:x=>o({...d,phone:x.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(F,{htmlFor:"joining_date",className:"text-right",children:"Joining Date"}),e.jsx(B,{id:"joining_date",type:"date",value:d.joining_date,onChange:x=>o({...d,joining_date:x.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(F,{htmlFor:"status",className:"text-right",children:"Status"}),e.jsxs(re,{value:d.status,onValueChange:x=>o({...d,status:x}),children:[e.jsx(se,{className:"col-span-3",children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(w,{value:"Active",children:"Active"}),e.jsx(w,{value:"Inactive",children:"Inactive"})]})]})]})]}),e.jsx(nt,{children:e.jsx($,{type:"submit",children:c?"Update":"Create"})})]})]})]})]}),e.jsx(G,{children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(pt,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(B,{placeholder:"Search staff...",className:"pl-10",value:r,onChange:x=>t(x.target.value)})]}),e.jsxs($,{variant:"outline",children:[e.jsx(ts,{className:"h-4 w-4 mr-2"}),"Filter"]}),_&&e.jsx(Pt,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:["Staff Name","Email","Role"],optionalColumns:["Phone","Department"],validationRules:v,onImportComplete:x=>{x.successfulRows>0&&(y.invalidateQueries({queryKey:["staff"]}),m({title:"Import Successful",description:`${x.successfulRows} staff members imported successfully.`}))}},variant:"outline"}),N&&e.jsx(Ct,{data:k.map(x=>({name:x.staff_name,email:x.email||"",phone:x.phone||"",role:x.role,department:x.department||"",isActive:x.status==="Active",createdAt:x.$createdAt})),headers:N.exportColumns.map(x=>x.exportHeader),filename:"staff",variant:"outline"})]})})}),e.jsxs(G,{children:[e.jsx(me,{children:e.jsxs(pe,{children:["Staff Members (",k.length,")"]})}),e.jsx(Z,{children:D?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:e.jsx("span",{children:"Loading staff..."})}):k.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("p",{className:"text-lg mb-2",children:"No staff found"}),e.jsx("p",{className:"text-sm",children:"Add your first staff member to get started"})]}):e.jsxs(jt,{children:[e.jsx(yt,{children:e.jsxs(Ee,{children:[e.jsx(X,{children:"Staff Code"}),e.jsx(X,{children:"Staff Name"}),e.jsx(X,{children:"Role"}),e.jsx(X,{children:"Department"}),e.jsx(X,{children:"Email"}),e.jsx(X,{children:"Phone"}),e.jsx(X,{children:"Joining Date"}),e.jsx(X,{children:"Status"}),e.jsx(X,{children:"Actions"})]})}),e.jsx(vt,{children:k.map(x=>e.jsxs(Ee,{children:[e.jsx(Q,{className:"font-medium",children:x.staff_code}),e.jsx(Q,{children:x.staff_name}),e.jsx(Q,{children:x.role}),e.jsx(Q,{children:x.department||"-"}),e.jsx(Q,{children:x.email||"-"}),e.jsx(Q,{children:x.phone||"-"}),e.jsx(Q,{children:x.joining_date?new Date(x.joining_date).toLocaleDateString("en-GB"):"-"}),e.jsx(Q,{children:e.jsx(Qe,{variant:x.status==="Active"?"default":"secondary",children:x.status})}),e.jsx(Q,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx($,{variant:"outline",size:"sm",onClick:()=>L(x),children:e.jsx(ss,{className:"h-4 w-4"})}),e.jsx($,{variant:"outline",size:"sm",onClick:()=>P(x.$id),children:e.jsx($t,{className:"h-4 w-4"})})]})})]},x.$id))})]})})]})]})},Xl=()=>{const[r,t]=p.useState(""),[s,a]=p.useState("all"),[n,i]=p.useState(!1),[c,u]=p.useState(null),[d,o]=p.useState({name:"",department:"",description:"",status:"Active"}),{toast:m}=Fe(),y=ut(),{config:N}=Rt("processes"),{validationRules:v,canImport:_}=qt("processes"),C={async getAll(){return(await tt.listDocuments(st,be.PROCESSES)).documents},async create(k){return await tt.createDocument(st,be.PROCESSES,ps.unique(),k)},async update(k,x){return await tt.updateDocument(st,be.PROCESSES,k,x)},async delete(k){return await tt.deleteDocument(st,be.PROCESSES,k)}},{data:g=[],isLoading:S,error:D}=fe({queryKey:["processes"],queryFn:async()=>await C.getAll()}),I=De({mutationFn:k=>{const{name:x,department:T}=k,b={process_name:x,department:T};return C.create(b)},onSuccess:()=>{y.invalidateQueries({queryKey:["processes"]}),m({title:"Success",description:"Process created successfully"}),i(!1),U()},onError:k=>{m({title:"Error",description:"Failed to create process",variant:"destructive"}),console.error("Error creating process:",k)}}),E=De({mutationFn:({id:k,data:x})=>{const{name:T,department:b}=x,R={process_name:T,department:b};return C.update(k,R)},onSuccess:()=>{y.invalidateQueries({queryKey:["processes"]}),m({title:"Success",description:"Process updated successfully"}),i(!1),U()},onError:k=>{m({title:"Error",description:"Failed to update process",variant:"destructive"}),console.error("Error updating process:",k)}}),q=De({mutationFn:k=>C.delete(k),onSuccess:()=>{y.invalidateQueries({queryKey:["processes"]}),m({title:"Success",description:"Process deleted successfully"})},onError:k=>{m({title:"Error",description:"Failed to delete process",variant:"destructive"}),console.error("Error deleting process:",k)}}),U=()=>{o({name:"",department:"",description:"",status:"Active"}),u(null)},O=k=>{if(k.preventDefault(),!d.name?.trim()){m({title:"Error",description:"Process Name is required",variant:"destructive"});return}if(!d.department.trim()){m({title:"Error",description:"Department is required",variant:"destructive"});return}c?E.mutate({id:c.$id,data:d}):I.mutate(d)},ee=k=>{u(k),o({name:k.process_name,department:k.department||"",description:k.description||"",status:k.status}),i(!0)},L=k=>{confirm("Are you sure you want to delete this process?")&&q.mutate(k)},P=()=>{u(null),U(),i(!0)},h=g.filter(k=>(k.process_name.toLowerCase().includes(r.toLowerCase())||k.department?.toLowerCase().includes(r.toLowerCase())||k.description?.toLowerCase().includes(r.toLowerCase()))&&(s==="all"||k.status===s));return D?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("p",{className:"text-red-500",children:["Error loading processes: ",D.message]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Processes"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage manufacturing and operational processes"})]}),e.jsxs(ot,{open:n,onOpenChange:i,children:[e.jsx(js,{asChild:!0,children:e.jsxs($,{onClick:P,className:"bg-primary hover:bg-primary/90",children:[e.jsx(Tt,{className:"h-4 w-4 mr-2"}),"Add New Process"]})}),e.jsxs(at,{className:"sm:max-w-[500px]",children:[e.jsxs(rt,{children:[e.jsx(it,{children:c?"Edit Process":"Add New Process"}),e.jsxs(lt,{children:[c?"Update process information":"Enter process details to add a new process",e.jsxs("span",{className:"mt-2 text-sm text-muted-foreground",children:["Fields marked with ",e.jsx("span",{className:"text-red-500",children:"*"})," are required."]})]})]}),e.jsxs("form",{onSubmit:O,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(F,{htmlFor:"name",className:"text-right",children:["Process Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(B,{id:"name",value:d.name,onChange:k=>o({...d,name:k.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(F,{htmlFor:"department",className:"text-right",children:["Department ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(re,{value:d.department||"",onValueChange:k=>o({...d,department:k}),children:[e.jsx(se,{className:"col-span-3",children:e.jsx(ne,{placeholder:"Select department"})}),e.jsxs(ae,{children:[e.jsx(w,{value:"Pre-Production",children:"Pre-Production"}),e.jsx(w,{value:"Production",children:"Production"}),e.jsx(w,{value:"Post Production",children:"Post Production"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-start gap-4",children:[e.jsx(F,{htmlFor:"description",className:"text-right mt-2",children:"Description"}),e.jsx(rs,{id:"description",value:d.description,onChange:k=>o({...d,description:k.target.value}),className:"col-span-3",rows:3,placeholder:"Enter process description..."})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(F,{htmlFor:"status",className:"text-right",children:"Status"}),e.jsxs(re,{value:d.status,onValueChange:k=>o({...d,status:k}),children:[e.jsx(se,{className:"col-span-3",children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(w,{value:"Active",children:"Active"}),e.jsx(w,{value:"Inactive",children:"Inactive"}),e.jsx(w,{value:"Under Review",children:"Under Review"})]})]})]})]}),e.jsx(nt,{children:e.jsx($,{type:"submit",children:c?"Update":"Create"})})]})]})]})]}),e.jsx(G,{children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(pt,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(B,{placeholder:"Search processes...",className:"pl-10",value:r,onChange:k=>t(k.target.value)})]}),e.jsxs($,{variant:"outline",children:[e.jsx(ts,{className:"h-4 w-4 mr-2"}),"Filter"]}),_&&e.jsx(Pt,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:["Process Name"],optionalColumns:["Description","Estimated Time (minutes)"],validationRules:v,onImportComplete:k=>{k.successfulRows>0&&(y.invalidateQueries({queryKey:["processes"]}),m({title:"Import Successful",description:`${k.successfulRows} processes imported successfully.`}))}},variant:"outline"}),N&&e.jsx(Ct,{data:h.map(k=>({name:k.process_name,description:k.description||"",estimatedTime:0,isActive:k.status==="Active",createdAt:k.$createdAt})),headers:N.exportColumns.map(k=>k.exportHeader),filename:"processes",variant:"outline"})]})})}),e.jsxs(G,{children:[e.jsx(me,{children:e.jsxs(pe,{children:["Manufacturing Processes (",h.length,")"]})}),e.jsx(Z,{children:S?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:e.jsx("span",{children:"Loading processes..."})}):h.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("p",{className:"text-lg mb-2",children:"No processes found"}),e.jsx("p",{className:"text-sm",children:"Add your first process to get started"})]}):e.jsxs(jt,{children:[e.jsx(yt,{children:e.jsxs(Ee,{children:[e.jsx(X,{children:"Process Name"}),e.jsx(X,{children:"Department"}),e.jsx(X,{children:"Description"}),e.jsx(X,{children:"Status"}),e.jsx(X,{children:"Actions"})]})}),e.jsx(vt,{children:h.map(k=>e.jsxs(Ee,{children:[e.jsx(Q,{className:"font-medium",children:k.process_name}),e.jsx(Q,{children:k.department||"-"}),e.jsx(Q,{className:"max-w-xs truncate",children:k.description||"-"}),e.jsx(Q,{children:e.jsx(Qe,{variant:k.status==="Active"?"default":k.status==="Under Review"?"secondary":"outline",children:k.status})}),e.jsx(Q,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx($,{variant:"outline",size:"sm",onClick:()=>ee(k),children:e.jsx(ss,{className:"h-4 w-4"})}),e.jsx($,{variant:"outline",size:"sm",onClick:()=>L(k.$id),children:e.jsx($t,{className:"h-4 w-4"})})]})})]},k.$id))})]})})]})]})},Zl=()=>{const[r,t]=p.useState(""),[s,a]=p.useState("all"),[n,i]=p.useState(!1),[c,u]=p.useState(null),[d,o]=p.useState({code:"",raw_product:"",uom:"",source:"Manufactured",status:"Active"}),{toast:m}=Fe(),y=ut(),{config:N}=Rt("raw-products"),{validationRules:v,canImport:_}=qt("raw-products"),{data:C=[],isLoading:g,error:S}=fe({queryKey:["rawProducts"],queryFn:async()=>await ws.getAll()}),D=De({mutationFn:h=>{const{code:k,raw_product:x,uom:T,source:b}=h,R={code:k,raw_product:x,uom:T,source:b};return ws.create(R)},onSuccess:()=>{y.invalidateQueries({queryKey:["rawProducts"]}),m({title:"Success",description:"Raw product created successfully"}),i(!1),q()},onError:h=>{m({title:"Error",description:"Failed to create raw product",variant:"destructive"}),console.error("Error creating raw product:",h)}}),I=De({mutationFn:({id:h,data:k})=>{const{code:x,raw_product:T,uom:b,source:R}=k,Y={code:x,raw_product:T,uom:b,source:R};return ws.update(h,Y)},onSuccess:()=>{y.invalidateQueries({queryKey:["rawProducts"]}),m({title:"Success",description:"Raw product updated successfully"}),i(!1),q()},onError:h=>{m({title:"Error",description:"Failed to update raw product",variant:"destructive"}),console.error("Error updating raw product:",h)}}),E=De({mutationFn:h=>ws.delete(h),onSuccess:()=>{y.invalidateQueries({queryKey:["rawProducts"]}),m({title:"Success",description:"Raw product deleted successfully"})},onError:h=>{m({title:"Error",description:"Failed to delete raw product",variant:"destructive"}),console.error("Error deleting raw product:",h)}}),q=()=>{o({code:"",raw_product:"",uom:"",source:"Manufactured",status:"Active"}),u(null)},U=h=>{if(h.preventDefault(),!d.code.trim()){m({title:"Error",description:"Code is required",variant:"destructive"});return}if(!d.raw_product.trim()){m({title:"Error",description:"Raw Product is required",variant:"destructive"});return}if(!d.uom.trim()){m({title:"Error",description:"UoM is required",variant:"destructive"});return}if(!d.source.trim()){m({title:"Error",description:"Source is required",variant:"destructive"});return}c?I.mutate({id:c.$id,data:d}):D.mutate(d)},O=h=>{u(h),o({code:h.code,raw_product:h.raw_product,uom:h.uom||"",source:h.source||"Manufactured",status:h.status}),i(!0)},ee=h=>{window.confirm("Are you sure you want to delete this raw product?")&&E.mutate(h)},L=()=>{u(null),q(),i(!0)},P=C.filter(h=>{const k=h.raw_product.toLowerCase().includes(r.toLowerCase())||h.code.toLowerCase().includes(r.toLowerCase())||h.source?.toLowerCase().includes(r.toLowerCase()),x=s==="all"||h.status===s;return k&&x});return S?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("p",{className:"text-red-500",children:["Error loading raw products: ",S.message]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Raw Products"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage raw materials and ingredients"})]}),e.jsxs(ot,{open:n,onOpenChange:i,children:[e.jsx(js,{asChild:!0,children:e.jsxs($,{onClick:L,className:"bg-primary hover:bg-primary/90",children:[e.jsx(Tt,{className:"h-4 w-4 mr-2"}),"Add New Raw Product"]})}),e.jsxs(at,{className:"sm:max-w-[500px]",children:[e.jsxs(rt,{children:[e.jsx(it,{children:c?"Edit Raw Product":"Add New Raw Product"}),e.jsxs(lt,{children:[c?"Update raw product information":"Enter raw product details to add a new material",e.jsxs("p",{className:"mt-2 text-sm text-muted-foreground",children:["Fields marked with ",e.jsx("span",{className:"text-red-500",children:"*"})," are required."]})]})]}),e.jsxs("form",{onSubmit:U,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(F,{htmlFor:"code",className:"text-right",children:["Code ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(B,{id:"code",value:d.code,onChange:h=>o({...d,code:h.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(F,{htmlFor:"raw_product",className:"text-right",children:["Raw Product ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(B,{id:"raw_product",value:d.raw_product,onChange:h=>o({...d,raw_product:h.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(F,{htmlFor:"uom",className:"text-right",children:["UoM ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(re,{value:d.uom,onValueChange:h=>o({...d,uom:h}),children:[e.jsx(se,{className:"col-span-3",children:e.jsx(ne,{placeholder:"Select unit of measure"})}),e.jsxs(ae,{children:[e.jsx(w,{value:"kg",children:"Kilogram (kg)"}),e.jsx(w,{value:"g",children:"Gram (g)"}),e.jsx(w,{value:"l",children:"Liter (l)"}),e.jsx(w,{value:"ml",children:"Milliliter (ml)"}),e.jsx(w,{value:"pcs",children:"Pieces (pcs)"}),e.jsx(w,{value:"box",children:"Box"}),e.jsx(w,{value:"bag",children:"Bag"}),e.jsx(w,{value:"ton",children:"Ton"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(F,{htmlFor:"source",className:"text-right",children:["Source ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(re,{value:d.source,onValueChange:h=>o({...d,source:h}),children:[e.jsx(se,{className:"col-span-3",children:e.jsx(ne,{placeholder:"Select source type"})}),e.jsxs(ae,{children:[e.jsx(w,{value:"Manufactured",children:"Manufactured"}),e.jsx(w,{value:"Purchased",children:"Purchased"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(F,{htmlFor:"status",className:"text-right",children:"Status"}),e.jsxs(re,{value:d.status,onValueChange:h=>o({...d,status:h}),children:[e.jsx(se,{className:"col-span-3",children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(w,{value:"Active",children:"Active"}),e.jsx(w,{value:"Inactive",children:"Inactive"}),e.jsx(w,{value:"Discontinued",children:"Discontinued"})]})]})]})]}),e.jsx(nt,{children:e.jsx($,{type:"submit",children:c?"Update":"Create"})})]})]})]})]}),e.jsx(G,{children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(pt,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(B,{placeholder:"Search raw products...",className:"pl-10",value:r,onChange:h=>t(h.target.value)})]}),e.jsxs($,{variant:"outline",children:[e.jsx(ts,{className:"h-4 w-4 mr-2"}),"Filter"]}),_&&e.jsx(Pt,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:["Raw Product Name","SKU","Unit"],optionalColumns:["Cost Per Unit","Description"],validationRules:v,onImportComplete:h=>{h.successfulRows>0&&(y.invalidateQueries({queryKey:["rawProducts"]}),m({title:"Import Successful",description:`${h.successfulRows} raw products imported successfully.`}))}},variant:"outline"}),N&&e.jsx(Ct,{data:P.map(h=>({name:h.raw_product,sku:h.code,unit:h.uom||"",costPerUnit:0,description:"",createdAt:h.$createdAt})),headers:N.exportColumns.map(h=>h.exportHeader),filename:"raw-products",variant:"outline"})]})})}),e.jsxs(G,{children:[e.jsx(me,{children:e.jsxs(pe,{children:["Raw Materials (",P.length,")"]})}),e.jsx(Z,{children:g?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:e.jsx("span",{children:"Loading raw products..."})}):P.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("p",{className:"text-lg mb-2",children:"No raw products found"}),e.jsx("p",{className:"text-sm",children:"Add your first raw product to get started"})]}):e.jsxs(jt,{children:[e.jsx(yt,{children:e.jsxs(Ee,{children:[e.jsx(X,{children:"Code"}),e.jsx(X,{children:"Raw Product"}),e.jsx(X,{children:"UoM"}),e.jsx(X,{children:"Source"}),e.jsx(X,{children:"Status"}),e.jsx(X,{children:"Actions"})]})}),e.jsx(vt,{children:P.map(h=>e.jsxs(Ee,{children:[e.jsx(Q,{className:"font-medium",children:h.code}),e.jsx(Q,{children:h.raw_product}),e.jsx(Q,{children:h.uom||"-"}),e.jsx(Q,{children:h.source&&e.jsx(Qe,{variant:h.source==="Manufactured"?"default":"secondary",children:h.source})}),e.jsx(Q,{children:e.jsx(Qe,{variant:h.status==="Active"?"default":h.status==="Discontinued"?"destructive":"secondary",children:h.status})}),e.jsx(Q,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx($,{variant:"outline",size:"sm",onClick:()=>O(h),children:e.jsx(ss,{className:"h-4 w-4"})}),e.jsx($,{variant:"outline",size:"sm",onClick:()=>ee(h.$id),children:e.jsx($t,{className:"h-4 w-4"})})]})})]},h.$id))})]})})]})]})},ec=()=>{const[r,t]=p.useState(""),[s,a]=p.useState("all"),[n,i]=p.useState(!1),[c,u]=p.useState(null),[d,o]=p.useState({sku:"",name:"",uom:"",min_level:"",status:"Active"}),{toast:m}=Fe(),y=ut(),{user:N}=ft(),{config:v}=Rt("products"),{validationRules:_,canImport:C}=qt("products"),{currentSort:g,handleSort:S,getSortedData:D}=as(),{data:I=[],isLoading:E,error:q}=fe({queryKey:["products"],queryFn:async()=>await Ht.getAll(),enabled:!!N}),U=De({mutationFn:R=>{const{sku:Y,name:M,uom:J,min_level:V}=R,le={sku:Y,product:M,uom:J,min_level:V};return Ht.create(le)},onSuccess:()=>{y.invalidateQueries({queryKey:["products"]}),m({title:"Success",description:"Product created successfully"}),i(!1),L()},onError:R=>{m({title:"Error",description:"Failed to create product",variant:"destructive"}),console.error("Error creating product:",R)}}),O=De({mutationFn:({id:R,data:Y})=>{const{sku:M,name:J,uom:V,min_level:le}=Y,ge={sku:M,product:J,uom:V,min_level:le};return Ht.update(R,ge)},onSuccess:()=>{y.invalidateQueries({queryKey:["products"]}),m({title:"Success",description:"Product updated successfully"}),i(!1),L()},onError:R=>{m({title:"Error",description:"Failed to update product",variant:"destructive"}),console.error("Error updating product:",R)}}),ee=De({mutationFn:R=>Ht.delete(R),onSuccess:()=>{y.invalidateQueries({queryKey:["products"]}),m({title:"Success",description:"Product deleted successfully"})},onError:R=>{m({title:"Error",description:"Failed to delete product",variant:"destructive"}),console.error("Error deleting product:",R)}}),L=()=>{o({sku:"",name:"",uom:"",min_level:"",status:"Active"}),u(null)},P=R=>{if(R.preventDefault(),!d.sku?.trim()){m({title:"Error",description:"SKU is required",variant:"destructive"});return}if(!d.name?.trim()){m({title:"Error",description:"Product Name is required",variant:"destructive"});return}if(!d.uom?.trim()){m({title:"Error",description:"Unit of Measure is required",variant:"destructive"});return}if(!d.min_level?.trim()){m({title:"Error",description:"Minimum Level is required",variant:"destructive"});return}const Y={...d,min_level:d.min_level?parseInt(d.min_level):void 0};c?O.mutate({id:c.$id,data:Y}):U.mutate(Y)},h=R=>{u(R),o({sku:R.sku,name:R.product,uom:R.uom||"",min_level:R.min_level?.toString()||"",status:R.status}),i(!0)},k=R=>{confirm("Are you sure you want to delete this product?")&&ee.mutate(R)},x=()=>{u(null),L(),i(!0)},T=I.filter(R=>{const Y=R.product.toLowerCase().includes(r.toLowerCase())||R.sku.toLowerCase().includes(r.toLowerCase()),M=s==="all"||R.status===s;return Y&&M}),b=D(T);return q?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("p",{className:"text-red-500",children:["Error loading products: ",q.message]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Products"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage finished products and inventory"})]}),e.jsxs(ot,{open:n,onOpenChange:i,children:[e.jsx(js,{asChild:!0,children:e.jsxs($,{onClick:x,className:"bg-primary hover:bg-primary/90",children:[e.jsx(Tt,{className:"h-4 w-4 mr-2"}),"Add New Product"]})}),e.jsxs(at,{className:"sm:max-w-[500px]",children:[e.jsxs(rt,{children:[e.jsx(it,{children:c?"Edit Product":"Add New Product"}),e.jsxs(lt,{children:[c?"Update product information":"Enter product details to add a new finished product",e.jsxs("span",{className:"mt-2 text-sm text-muted-foreground",children:["Fields marked with ",e.jsx("span",{className:"text-red-500",children:"*"})," are required."]})]})]}),e.jsxs("form",{onSubmit:P,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(F,{htmlFor:"sku",className:"text-right",children:["SKU ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(B,{id:"sku",value:d.sku,onChange:R=>o({...d,sku:R.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(F,{htmlFor:"product",className:"text-right",children:["Product ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(B,{id:"product",value:d.name,onChange:R=>o({...d,name:R.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(F,{htmlFor:"uom",className:"text-right",children:["UoM ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(re,{value:d.uom,onValueChange:R=>o({...d,uom:R}),children:[e.jsx(se,{className:"col-span-3",children:e.jsx(ne,{placeholder:"Select unit of measure"})}),e.jsxs(ae,{children:[e.jsx(w,{value:"kg",children:"Kilogram (kg)"}),e.jsx(w,{value:"g",children:"Gram (g)"}),e.jsx(w,{value:"l",children:"Liter (l)"}),e.jsx(w,{value:"ml",children:"Milliliter (ml)"}),e.jsx(w,{value:"pcs",children:"Pieces (pcs)"}),e.jsx(w,{value:"box",children:"Box"}),e.jsx(w,{value:"pack",children:"Pack"}),e.jsx(w,{value:"bottle",children:"Bottle"}),e.jsx(w,{value:"can",children:"Can"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(F,{htmlFor:"min_level",className:"text-right",children:["Min Level ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(B,{id:"min_level",type:"number",value:d.min_level,onChange:R=>o({...d,min_level:R.target.value}),className:"col-span-3",min:"0",placeholder:"Minimum stock level"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(F,{htmlFor:"status",className:"text-right",children:"Status"}),e.jsxs(re,{value:d.status,onValueChange:R=>o({...d,status:R}),children:[e.jsx(se,{className:"col-span-3",children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(w,{value:"Active",children:"Active"}),e.jsx(w,{value:"Inactive",children:"Inactive"}),e.jsx(w,{value:"Discontinued",children:"Discontinued"})]})]})]})]}),e.jsx(nt,{children:e.jsx($,{type:"submit",children:c?"Update":"Create"})})]})]})]})]}),e.jsx(G,{children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(pt,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(B,{placeholder:"Search products...",className:"pl-10",value:r,onChange:R=>t(R.target.value)})]}),e.jsxs($,{variant:"outline",children:[e.jsx(ts,{className:"h-4 w-4 mr-2"}),"Filter"]}),C&&e.jsx(Pt,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:["Product Name","SKU"],optionalColumns:["Category","Price","Description"],validationRules:_,onImportComplete:R=>{R.successfulRows>0&&(y.invalidateQueries({queryKey:["products"]}),m({title:"Import Successful",description:`${R.successfulRows} products imported successfully.`}))}},variant:"outline"}),v&&e.jsx(Ct,{data:T.map(R=>({name:R.product,sku:R.sku,category:"",price:0,description:"",isActive:R.status==="Active",createdAt:R.$createdAt})),headers:v.exportColumns.map(R=>R.exportHeader),filename:"products",variant:"outline"})]})})}),e.jsxs(G,{children:[e.jsx(me,{children:e.jsxs(pe,{children:["Finished Products (",T.length,")"]})}),e.jsx(Z,{children:e.jsx(ds,{data:b.map(R=>({...R,sku:R.sku||"",product:R.product||"",uom:R.uom||"-",min_level:R.min_level||0,status:R.status||"Active"})),columns:[{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"product",label:"Product Name",sortable:!0,dataType:"string"},{key:"uom",label:"UoM",sortable:!0,dataType:"string"},{key:"min_level",label:"Min Level",sortable:!0,dataType:"number",align:"right"},{key:"status",label:"Status",sortable:!0,dataType:"string"}],onSort:S,currentSort:g,loading:E,emptyMessage:"No products found",actions:[{label:"Edit",icon:e.jsx(ss,{className:"h-4 w-4"}),onClick:h},{label:"Delete",icon:e.jsx($t,{className:"h-4 w-4"}),onClick:R=>k(R.$id),variant:"destructive"}]})})]})]})},tc=()=>{const[r,t]=p.useState(""),[s,a]=p.useState("all"),[n,i]=p.useState(!1),[c,u]=p.useState(null),[d,o]=p.useState({channel_name:"",description:"",type:"Online",contact_person:"",phone:"",email:"",status:"Active"}),{toast:m}=Fe(),y=ut(),{config:N}=Rt("sales-channels"),{validationRules:v,canImport:_}=qt("sales-channels"),{data:C=[],isLoading:g,error:S}=fe({queryKey:["salesChannels"],queryFn:async()=>await Ms.getAll()}),D=De({mutationFn:h=>{const{channel_name:k,type:x,email:T}=h,b={channel_name:k,type:x};return T&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(T)&&(b.email=T),Ms.create(b)},onSuccess:()=>{y.invalidateQueries({queryKey:["salesChannels"]}),m({title:"Success",description:"Sales channel created successfully"}),i(!1),q()},onError:h=>{m({title:"Error",description:"Failed to create sales channel",variant:"destructive"}),console.error("Error creating sales channel:",h)}}),I=De({mutationFn:({id:h,data:k})=>{const{channel_name:x,type:T,email:b}=k,R={channel_name:x,type:T};return b&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(b)&&(R.email=b),Ms.update(h,R)},onSuccess:()=>{y.invalidateQueries({queryKey:["salesChannels"]}),m({title:"Success",description:"Sales channel updated successfully"}),i(!1),q()},onError:h=>{m({title:"Error",description:"Failed to update sales channel",variant:"destructive"}),console.error("Error updating sales channel:",h)}}),E=De({mutationFn:h=>Ms.delete(h),onSuccess:()=>{y.invalidateQueries({queryKey:["salesChannels"]}),m({title:"Success",description:"Sales channel deleted successfully"})},onError:h=>{m({title:"Error",description:"Failed to delete sales channel",variant:"destructive"}),console.error("Error deleting sales channel:",h)}}),q=()=>{o({channel_name:"",description:"",type:"Online",contact_person:"",phone:"",email:"",status:"Active"}),u(null)},U=h=>{if(h.preventDefault(),!d.channel_name.trim()){m({title:"Error",description:"Channel Name is required",variant:"destructive"});return}if(!d.type.trim()){m({title:"Error",description:"Type is required",variant:"destructive"});return}if(d.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(d.email)){m({title:"Error",description:"Please enter a valid email address",variant:"destructive"});return}c?I.mutate({id:c.$id,data:d}):D.mutate(d)},O=h=>{u(h),o({channel_name:h.channel_name,description:h.description||"",type:h.type||"Online",contact_person:h.contact_person||"",phone:h.phone||"",email:h.email||"",status:h.status}),i(!0)},ee=h=>{confirm("Are you sure you want to delete this sales channel?")&&E.mutate(h)},L=()=>{u(null),q(),i(!0)},P=C.filter(h=>{const k=h.channel_name.toLowerCase().includes(r.toLowerCase())||h.type?.toLowerCase().includes(r.toLowerCase())||h.contact_person?.toLowerCase().includes(r.toLowerCase()),x=s==="all"||h.status===s;return k&&x});return S?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("p",{className:"text-red-500",children:["Error loading sales channels: ",S.message]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Sales Channels"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage sales distribution channels and partners"})]}),e.jsxs(ot,{open:n,onOpenChange:i,children:[e.jsx(js,{asChild:!0,children:e.jsxs($,{onClick:L,className:"bg-primary hover:bg-primary/90",children:[e.jsx(Tt,{className:"h-4 w-4 mr-2"}),"Add New Channel"]})}),e.jsxs(at,{className:"sm:max-w-[500px]",children:[e.jsxs(rt,{children:[e.jsx(it,{children:c?"Edit Sales Channel":"Add New Sales Channel"}),e.jsxs(lt,{children:[c?"Update sales channel information":"Enter sales channel details to add a new distribution partner",e.jsxs("p",{className:"mt-2 text-sm text-muted-foreground",children:["Fields marked with ",e.jsx("span",{className:"text-red-500",children:"*"})," are required."]})]})]}),e.jsxs("form",{onSubmit:U,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(F,{htmlFor:"channel_name",className:"text-right",children:["Channel Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(B,{id:"channel_name",value:d.channel_name,onChange:h=>o({...d,channel_name:h.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-start gap-4",children:[e.jsx(F,{htmlFor:"description",className:"text-right mt-2",children:"Description"}),e.jsx(rs,{id:"description",value:d.description,onChange:h=>o({...d,description:h.target.value}),className:"col-span-3",rows:3,placeholder:"Enter channel description..."})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(F,{htmlFor:"type",className:"text-right",children:["Type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(re,{value:d.type,onValueChange:h=>o({...d,type:h}),children:[e.jsx(se,{className:"col-span-3",children:e.jsx(ne,{placeholder:"Select channel type"})}),e.jsxs(ae,{children:[e.jsx(w,{value:"Online",children:"Online"}),e.jsx(w,{value:"Retail",children:"Retail"}),e.jsx(w,{value:"Wholesale",children:"Wholesale"}),e.jsx(w,{value:"Direct Sales",children:"Direct Sales"}),e.jsx(w,{value:"Distributor",children:"Distributor"}),e.jsx(w,{value:"E-commerce",children:"E-commerce"}),e.jsx(w,{value:"Export",children:"Export"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(F,{htmlFor:"contact_person",className:"text-right",children:"Contact Person"}),e.jsx(B,{id:"contact_person",value:d.contact_person,onChange:h=>o({...d,contact_person:h.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(F,{htmlFor:"phone",className:"text-right",children:"Phone"}),e.jsx(B,{id:"phone",value:d.phone,onChange:h=>o({...d,phone:h.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(F,{htmlFor:"email",className:"text-right",children:"Email"}),e.jsx(B,{id:"email",type:"email",value:d.email,onChange:h=>o({...d,email:h.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(F,{htmlFor:"status",className:"text-right",children:"Status"}),e.jsxs(re,{value:d.status,onValueChange:h=>o({...d,status:h}),children:[e.jsx(se,{className:"col-span-3",children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(w,{value:"Active",children:"Active"}),e.jsx(w,{value:"Inactive",children:"Inactive"}),e.jsx(w,{value:"Pending",children:"Pending"})]})]})]})]}),e.jsx(nt,{children:e.jsx($,{type:"submit",children:c?"Update":"Create"})})]})]})]})]}),e.jsx(G,{children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(pt,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(B,{placeholder:"Search sales channels...",className:"pl-10",value:r,onChange:h=>t(h.target.value)})]}),e.jsxs($,{variant:"outline",children:[e.jsx(ts,{className:"h-4 w-4 mr-2"}),"Filter"]}),_&&e.jsx(Pt,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:["Channel Name","Type"],optionalColumns:["Commission (%)","Description"],validationRules:v,onImportComplete:h=>{h.successfulRows>0&&(y.invalidateQueries({queryKey:["salesChannels"]}),m({title:"Import Successful",description:`${h.successfulRows} sales channels imported successfully.`}))}},variant:"outline"}),N&&e.jsx(Ct,{data:P.map(h=>({name:h.channel_name,type:h.type||"",commission:0,description:h.description||"",isActive:h.status==="Active",createdAt:h.$createdAt})),headers:N.exportColumns.map(h=>h.exportHeader),filename:"sales-channels",variant:"outline"})]})})}),e.jsxs(G,{children:[e.jsx(me,{children:e.jsxs(pe,{children:["Distribution Channels (",P.length,")"]})}),e.jsx(Z,{children:g?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:e.jsx("span",{children:"Loading sales channels..."})}):P.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("p",{className:"text-lg mb-2",children:"No sales channels found"}),e.jsx("p",{className:"text-sm",children:"Add your first sales channel to get started"})]}):e.jsxs(jt,{children:[e.jsx(yt,{children:e.jsxs(Ee,{children:[e.jsx(X,{children:"Channel Name"}),e.jsx(X,{children:"Description"}),e.jsx(X,{children:"Type"}),e.jsx(X,{children:"Contact Person"}),e.jsx(X,{children:"Phone"}),e.jsx(X,{children:"Email"}),e.jsx(X,{children:"Status"}),e.jsx(X,{children:"Actions"})]})}),e.jsx(vt,{children:P.map(h=>e.jsxs(Ee,{children:[e.jsx(Q,{className:"font-medium",children:h.channel_name}),e.jsx(Q,{className:"max-w-xs truncate",children:h.description||"-"}),e.jsx(Q,{children:h.type&&e.jsx(Qe,{variant:"outline",children:h.type})}),e.jsx(Q,{children:h.contact_person||"-"}),e.jsx(Q,{children:h.phone||"-"}),e.jsx(Q,{children:h.email||"-"}),e.jsx(Q,{children:e.jsx(Qe,{variant:h.status==="Active"?"default":h.status==="Pending"?"secondary":"outline",children:h.status})}),e.jsx(Q,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx($,{variant:"outline",size:"sm",onClick:()=>O(h),children:e.jsx(ss,{className:"h-4 w-4"})}),e.jsx($,{variant:"outline",size:"sm",onClick:()=>ee(h.$id),children:e.jsx($t,{className:"h-4 w-4"})})]})})]},h.$id))})]})})]})]})},$n=(r,t,s={})=>{const{category:a,searchTerm:n}=s,i=r?Vs(r,1):void 0,c=r?ct(r,"yyyy-MM-dd"):void 0,u=t?ct(t,"yyyy-MM-dd"):void 0,d=i?ct(i,"yyyy-MM-dd"):void 0,{data:o=[],isLoading:m}=fe({queryKey:["stocks"],queryFn:()=>Bt.getAll(),staleTime:600*1e3}),{data:y=[],isLoading:N}=fe({queryKey:["processes"],queryFn:()=>fs.getAll(),staleTime:600*1e3}),{data:v=[],isLoading:_}=fe({queryKey:["purchases",c,u],queryFn:()=>Wt.getByDateRange(r,t),enabled:!!r&&!!t,staleTime:300*1e3}),{data:C=[]}=fe({queryKey:["purchasesBefore",d],queryFn:()=>Wt.getByDateRange(void 0,i),enabled:!!i,staleTime:300*1e3}),{data:g=[],isLoading:S}=fe({queryKey:["cleaning-tasks",c,u],queryFn:async()=>(await ls.getByDateRange(r,t)).filter(U=>(U.process_name?.toLowerCase()||"").includes("cleaning")),enabled:!!r&&!!t,staleTime:300*1e3}),{data:D=[]}=fe({queryKey:["cleaning-tasksBefore",d],queryFn:async()=>(await ls.getByDateRange(void 0,i)).filter(U=>(U.process_name?.toLowerCase()||"").includes("cleaning")),enabled:!!i,staleTime:300*1e3});return{stockStatus:p.useMemo(()=>o.length?o.filter(q=>{if(a&&a!=="all"&&(q.category||q.Category)!==a)return!1;if(n){const U=n.toLowerCase();if(!(q.stock_name?.toLowerCase()||"").includes(U))return!1}return!0}).map(q=>{const U=C.filter(T=>T.stock_id===q.$id).reduce((T,b)=>T+(Number(b.quantity)||0),0),O=D.filter(T=>T.stock_id===q.$id&&T.status==="completed").reduce((T,b)=>T+(Number(b.assigned_quantity)||0),0),ee=U-O,L=v.filter(T=>T.stock_id===q.$id).reduce((T,b)=>T+(Number(b.quantity)||0),0),P=g.filter(T=>T.stock_id===q.$id&&T.status==="completed").reduce((T,b)=>T+(Number(b.assigned_quantity)||0),0),h=ee+L-P,k=q.min_level||0;let x="In Stock";return h<=0?x="Out of Stock":h<k&&(x="Low Stock"),{stock_id:q.$id,stock_name:q.stock_name,category:q.category||q.Category,opening_balance:ee,purchases:L,utilised:P,closing_balance:h,min_level:k,status:x}}):[],[o,v,C,g,D,a,n]),isLoading:m||N||_||S,error:null}},sc=()=>{const{data:r,isLoading:t,error:s}=fe({queryKey:["stock-categories"],queryFn:()=>Bt.getCategories()});return{categories:r,isLoading:t,error:s}},ac=()=>{const[r,t]=p.useState({from:es(new Date),to:Zt(new Date)}),[s,a]=p.useState(void 0),[n,i]=p.useState(""),{toast:c}=Fe(),u=ut(),{stockStatus:d,isLoading:o}=$n(r?.from,r?.to,{category:s,searchTerm:n}),{categories:m}=sc(),y=async()=>{try{await u.invalidateQueries({queryKey:["stocks"]}),await u.invalidateQueries({queryKey:["purchases"]}),await u.invalidateQueries({queryKey:["tasks"]}),c({title:"Stock Data Refreshed",description:"Data updated successfully"})}catch{c({title:"Refresh Failed",description:"Please try again",variant:"destructive"})}};return e.jsxs(G,{children:[e.jsxs(me,{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(pe,{children:"Stock Status"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs($,{variant:"outline",onClick:y,disabled:o,children:[e.jsx(qa,{className:`h-4 w-4 mr-1 ${o?"animate-spin":""}`}),"Refresh Data"]}),e.jsx($,{variant:"outline",children:"Export"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-4",children:[e.jsx(qs,{value:r,onChange:t,className:"w-[300px]"}),e.jsxs(re,{onValueChange:a,value:s,children:[e.jsx(se,{className:"w-[180px]",children:e.jsx(ne,{placeholder:"All Categories"})}),e.jsxs(ae,{children:[e.jsx(w,{value:"all",children:"All Categories"}),m?.map(N=>e.jsx(w,{value:N,children:N},N))]})]}),e.jsx(B,{placeholder:"Search...",className:"w-[200px]",value:n,onChange:N=>i(N.target.value)})]})]}),e.jsx(Z,{children:e.jsxs(jt,{children:[e.jsx(yt,{children:e.jsxs(Ee,{children:[e.jsx(X,{children:"Stock Name"}),e.jsx(X,{children:"Category"}),e.jsx(X,{className:"text-right",children:"Opening Balance"}),e.jsx(X,{className:"text-right bg-purple-50",children:"Purchases"}),e.jsx(X,{className:"text-right bg-green-50",children:"Utilised"}),e.jsx(X,{className:"text-right",children:"Closing Balance"}),e.jsx(X,{className:"text-right",children:"Min Level"}),e.jsx(X,{children:"Status"})]})}),e.jsx(vt,{children:o?e.jsx(Ee,{children:e.jsxs(Q,{colSpan:8,className:"text-center py-12",children:[e.jsx(Ve,{className:"h-8 w-8 animate-spin mx-auto mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading stock status..."})]})}):d.length===0?e.jsx(Ee,{children:e.jsx(Q,{colSpan:8,className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"No stock data found for the selected criteria"})})}):d.map((N,v)=>e.jsxs(Ee,{children:[e.jsx(Q,{children:N.stock_name}),e.jsx(Q,{children:N.category||"N/A"}),e.jsx(Q,{className:"text-right",children:(N.opening_balance||0).toLocaleString()}),e.jsx(Q,{className:"text-right bg-purple-50 font-medium",children:(N.purchases||0).toLocaleString()}),e.jsx(Q,{className:"text-right bg-green-50 font-medium",children:(N.utilised||0).toLocaleString()}),e.jsx(Q,{className:"text-right font-semibold",children:e.jsx("span",{className:(N.closing_balance||0)<0?"text-red-600":"text-green-600",children:(N.closing_balance||0).toLocaleString()})}),e.jsx(Q,{className:"text-right text-muted-foreground",children:(N.min_level||0).toLocaleString()}),e.jsx(Q,{children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${N.status==="Out of Stock"?"bg-red-100 text-red-800":N.status==="Low Stock"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:N.status||"In Stock"})})]},N.stock_id||`stock-${v}`))})]})})]})},Ka=(r,t,s={})=>{const{processId:a}=s,n=r?Kt(r):void 0,i=t?Kt(t):void 0,c=n?Vs(n,1):void 0,u=n?ct(n,"yyyy-MM-dd"):void 0,d=i?ct(i,"yyyy-MM-dd"):void 0,o=c?ct(c,"yyyy-MM-dd"):void 0,{data:m=[],isLoading:y}=fe({queryKey:["stocks"],queryFn:()=>Bt.getAll(),staleTime:600*1e3}),{data:N=[],isLoading:v}=fe({queryKey:["processes"],queryFn:()=>fs.getAll(),staleTime:600*1e3}),{data:_=[],isLoading:C}=fe({queryKey:["preProductionTasks",u,d],queryFn:()=>ls.getByDateRange(n,i),enabled:!!n&&!!i,staleTime:300*1e3}),{data:g=[]}=fe({queryKey:["preProductionTasksBefore",o],queryFn:()=>ls.getByDateRange(void 0,c),enabled:!!c,staleTime:300*1e3}),{data:S=[]}=fe({queryKey:["productionTasksForPreStatus",u,d],queryFn:()=>zt.getProductionTasksWithRelations(u,d),enabled:!!n&&!!i,staleTime:300*1e3}),{data:D=[]}=fe({queryKey:["productionTasksBeforeForPreStatus",o],queryFn:()=>zt.getProductionTasksWithRelations(void 0,o),enabled:!!c,staleTime:300*1e3});return{statusRecords:p.useMemo(()=>{if(!m.length||!N.length)return[];new Map(N.map(P=>[P.$id,P.process_name]));const q=["cleaning","c & d","roasting","rfp"],U=a?N.filter(P=>{const h=P.process_name?.toLowerCase();return P.$id===a&&q.includes(h)}):N.filter(P=>{const h=P.process_name?.toLowerCase();return q.includes(h)}),O=P=>{if(!P)return!n&&!i;if(!n&&!i)return!0;const h=Kt(P),k=n?h>=n:!0,x=i?h<=i:!0;return k&&x},ee=P=>!P||!c?!1:Kt(P)<=c;return m.flatMap(P=>U.map(h=>{const k=P.stock_name,x=h.process_name;if(!k||!x)return null;const b=g.filter(ye=>ye.stock_id===P.$id&&ye.process_id===h.$id&&ye.status==="completed"&&ee(ye.date_completed||ye.date_assigned)).reduce((ye,Pe)=>{const Be=Pe.completed_quantity!==void 0&&Pe.completed_quantity!==null?Number(Pe.completed_quantity):Number(Pe.assigned_quantity)||0,Ke=Number(Pe.wastage_quantity)||0;return ye+(Be-Ke)},0),R=g.filter(ye=>ye.stock_id===P.$id&&ye.stock_source===x&&ee(ye.date_assigned)).reduce((ye,Pe)=>ye+(Number(Pe.assigned_quantity)||0),0),Y=D.filter(ye=>ye.source_process_id===h.$id).reduce((ye,Pe)=>{const Ke=(Pe.stock_items||[]).filter(Je=>Je.stock_id===P.$id).reduce((Je,bt)=>Je+(Number(bt.quantity)||0),0);return ye+Ke},0),M=R+Y,J=b-M,V=_.filter(ye=>ye.stock_id===P.$id&&ye.process_id===h.$id&&O(ye.date_assigned)),le=V.filter(ye=>ye.status==="completed").reduce((ye,Pe)=>{const Be=Pe.completed_quantity!==void 0&&Pe.completed_quantity!==null?Number(Pe.completed_quantity):Number(Pe.assigned_quantity)||0,Ke=Number(Pe.wastage_quantity)||0;return ye+(Be-Ke)},0),ge=V.reduce((ye,Pe)=>ye+(Number(Pe.wastage_quantity)||0),0),we=_.filter(ye=>ye.stock_id===P.$id&&ye.stock_source===x&&O(ye.date_assigned)).reduce((ye,Pe)=>ye+(Number(Pe.assigned_quantity)||0),0),H=S.filter(ye=>ye.source_process_id===h.$id).reduce((ye,Pe)=>{const Ke=(Pe.stock_items||[]).filter(Je=>Je.stock_id===P.$id).reduce((Je,bt)=>Je+(Number(bt.quantity)||0),0);return ye+Ke},0),de=we+H,Ne=J+le-de,Le=P.min_level||0;let mt="In Stock";return Ne<=0?mt="Out of Stock":Ne<Le&&(mt="Low Stock"),{stock_name:k,process:x,opening_balance:J,effective_completed:le,wastage_qty:ge,utilised:de,closing_balance:Ne,min_level:Le,status:mt}}).filter(h=>h!==null)).filter(Boolean)},[m,N,_,g,S,D,a,n,i,c]),isLoading:y||v||C,error:null}},Va=()=>{const{data:r=[],isLoading:t,error:s}=fe({queryKey:["stocks"],queryFn:async()=>await Bt.getAll()});return{data:r,isLoading:t,error:s}},As=()=>{const{data:r=[],isLoading:t,error:s}=fe({queryKey:["staff"],queryFn:async()=>await Pl.getAll(),staleTime:3e5,gcTime:9e5,refetchOnWindowFocus:!1});return{data:r,isLoading:t,error:s}},us=()=>{const{data:r=[],isLoading:t,error:s}=fe({queryKey:["processes"],queryFn:async()=>await fs.getAll(),staleTime:3e5,gcTime:9e5,refetchOnWindowFocus:!1});return{data:r,isLoading:t,error:s}},Ln=()=>{const{data:r=[],isLoading:t,error:s}=fe({queryKey:["products"],queryFn:async()=>await Ht.getAll(),staleTime:3e5,gcTime:9e5,refetchOnWindowFocus:!1});return{data:r,isLoading:t,error:s}},Ba=()=>{const{data:r=[],isLoading:t,error:s}=fe({queryKey:["rawProducts"],queryFn:async()=>await ws.getAll(),staleTime:3e5,gcTime:9e5,refetchOnWindowFocus:!1});return{data:r,isLoading:t,error:s}},rc=()=>{const r=ut(),[t,s]=p.useState(""),[a,n]=p.useState({from:es(new Date),to:Zt(new Date)}),[i,c]=p.useState(""),{data:u}=us(),d=a.from?ct(a.from,"yyyy-MM-dd"):void 0,o=a.to?ct(a.to,"yyyy-MM-dd"):void 0,{toast:m}=Fe(),{statusRecords:y,isLoading:N}=Ka(d,o,{processId:i||void 0}),v=p.useMemo(()=>y?y.filter(g=>(g.stock_name||"").toLowerCase().includes(t.toLowerCase())||(g.process||"").toLowerCase().includes(t.toLowerCase())):[],[y,t]),_=async()=>{try{await r.invalidateQueries({queryKey:["stocks"]}),await r.invalidateQueries({queryKey:["processes"]}),await r.invalidateQueries({queryKey:["preProductionTasks"]}),await r.invalidateQueries({queryKey:["productionTasksForPreStatus"]}),m({title:"Pre-Production Data Refreshed",description:"Data updated successfully"})}catch{m({title:"Refresh Failed",description:"Please try again",variant:"destructive"})}},C=()=>{const S=[["Stock Name","Process","Opening Balance","Effective Completed","Wastage Qty","Utilised","Closing Balance","Min Level","Status"].join(","),...v.map(U=>[`"${U.stock_name}"`,`"${U.process}"`,U.opening_balance.toFixed(2),U.effective_completed.toFixed(2),U.wastage_qty.toFixed(2),U.utilised.toFixed(2),U.closing_balance.toFixed(2),(U.min_level||0).toFixed(2),`"${U.status||"In Stock"}"`].join(","))].join(`
`),D=new Blob([S],{type:"text/csv;charset=utf-8;"}),I=URL.createObjectURL(D),E=document.createElement("a");E.setAttribute("href",I);const q=d&&o?`_${d}_to_${o}`:"";E.setAttribute("download",`pre-production-status${q}_${new Date().toISOString().split("T")[0]}.csv`),E.style.visibility="hidden",document.body.appendChild(E),E.click(),document.body.removeChild(E)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Pre-Production Status"}),e.jsx("p",{className:"text-muted-foreground",children:"Track material flow through pre-production stages"})]}),e.jsx(G,{children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("div",{className:"relative w-full md:w-auto",children:[e.jsx(pt,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(B,{placeholder:"Search stock or process...",className:"w-full pl-8 md:w-[200px] lg:w-[300px]",value:t,onChange:g=>s(g.target.value)})]}),e.jsx(qs,{value:a,onChange:g=>{g?.from&&g?.to&&n({from:g.from,to:g.to})}}),e.jsxs(re,{value:i||"all",onValueChange:g=>c(g==="all"?"":g),children:[e.jsx(se,{className:"w-[180px]",children:e.jsx(ne,{placeholder:"All Processes"})}),e.jsxs(ae,{children:[e.jsx(w,{value:"all",children:"All Processes"}),u?.filter(g=>{const S=g.process_name?.toLowerCase();return["cleaning","c & d","roasting","rfp"].includes(S)}).map(g=>e.jsx(w,{value:g.$id,children:g.process_name},g.$id))]})]}),e.jsx($,{onClick:_,variant:"outline",size:"icon",disabled:N,children:e.jsx(La,{className:`h-4 w-4 ${N?"animate-spin":""}`})}),e.jsx($,{onClick:C,variant:"outline",size:"icon",disabled:!v||v.length===0,children:e.jsx(hs,{className:"h-4 w-4"})})]})})}),N?e.jsx(G,{children:e.jsxs(Z,{className:"py-12 text-center",children:[e.jsx(Ve,{className:"h-8 w-8 animate-spin mx-auto mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading pre-production status..."})]})}):e.jsxs(G,{children:[e.jsx(me,{children:e.jsx(pe,{children:"Status Details"})}),e.jsx(Z,{children:e.jsxs(jt,{children:[e.jsx(yt,{children:e.jsxs(Ee,{children:[e.jsx(X,{children:"Stock Name"}),e.jsx(X,{children:"Process"}),e.jsx(X,{className:"text-right",children:"Opening Balance"}),e.jsx(X,{className:"text-right bg-purple-50",children:"Effective Completed"}),e.jsx(X,{className:"text-right",children:"Wastage Qty"}),e.jsx(X,{className:"text-right bg-green-50",children:"Utilised"}),e.jsx(X,{className:"text-right",children:"Closing Balance"}),e.jsx(X,{className:"text-right",children:"Min Level"}),e.jsx(X,{children:"Status"})]})}),e.jsx(vt,{children:v&&v.length>0?v.map((g,S)=>e.jsxs(Ee,{children:[e.jsx(Q,{children:g.stock_name}),e.jsx(Q,{children:g.process}),e.jsx(Q,{className:"text-right",children:g.opening_balance.toFixed(2)}),e.jsx(Q,{className:"text-right bg-purple-50 font-medium",children:g.effective_completed.toFixed(2)}),e.jsx(Q,{className:"text-right",children:g.wastage_qty.toFixed(2)}),e.jsx(Q,{className:"text-right bg-green-50 font-medium",children:g.utilised.toFixed(2)}),e.jsx(Q,{className:"text-right font-semibold",children:e.jsx("span",{className:g.closing_balance<0?"text-red-600":"text-green-600",children:g.closing_balance.toFixed(2)})}),e.jsx(Q,{className:"text-right text-muted-foreground",children:(g.min_level||0).toFixed(2)}),e.jsx(Q,{children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${g.status==="Out of Stock"?"bg-red-100 text-red-800":g.status==="Low Stock"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:g.status||"In Stock"})})]},`${g.stock_name}-${g.process}-${S}`)):e.jsx(Ee,{children:e.jsx(Q,{colSpan:9,className:"text-center",children:"No pre-production status found for the selected criteria."})})})]})})]})]})},Ha=(r,t,s={})=>{const{processId:a}=s,n=r?Kt(r):void 0,i=t?Kt(t):void 0,c=n?Vs(n,1):void 0,u=n?ct(n,"yyyy-MM-dd"):void 0,d=i?ct(i,"yyyy-MM-dd"):void 0,o=c?ct(c,"yyyy-MM-dd"):void 0,{data:m=[],isLoading:y}=fe({queryKey:["stocks"],queryFn:()=>Bt.getAll(),staleTime:600*1e3}),{data:N=[],isLoading:v}=fe({queryKey:["processes"],queryFn:()=>fs.getAll(),staleTime:600*1e3}),{data:_=[],isLoading:C}=fe({queryKey:["rawProducts"],queryFn:()=>ws.getAll(),staleTime:600*1e3}),{data:g=[],isLoading:S}=fe({queryKey:["products"],queryFn:()=>Ht.getAll(),staleTime:600*1e3}),{data:D=[],isLoading:I}=fe({queryKey:["productionTasks",u,d,a],queryFn:()=>zt.getProductionTasksWithRelations(u,d,a),enabled:!!n&&!!i,staleTime:300*1e3}),{data:E=[]}=fe({queryKey:["productionTasksBefore",o,a],queryFn:()=>zt.getProductionTasksWithRelations(void 0,o,a),enabled:!!c,staleTime:300*1e3}),{data:q=[]}=fe({queryKey:["postProductionTasks",u,d],queryFn:()=>Xt.getPostProductionTasksWithRelations(),enabled:!!n&&!!i,staleTime:300*1e3});return{statusRecords:p.useMemo(()=>{if(!N.length||!_.length||!g.length)return[];const ee=a?N.filter(b=>b.$id===a):N.filter(b=>{const R=b.process_name?.toLowerCase();return R==="grinding"||R==="blending"}),L=new Map(ee.map(b=>[b.$id,b.process_name])),P=new Map(_.map(b=>[b.$id,b])),h=b=>{const R=g.find(J=>J.$id===b);if(!R)return null;const Y=R.product||R.product_name||R.Product_Name||R.name;if(!Y)return null;let M=_.find(J=>J.raw_product?.toLowerCase()===Y.toLowerCase());return M||(M=_.find(J=>{const V=J.raw_product?.toLowerCase()||"",le=Y.toLowerCase();return V.includes(le)||le.includes(V)})),M},k=new Map,x=b=>{if(!b)return!n&&!i;if(!n&&!i)return!0;const R=Kt(b),Y=n?R>=n:!0,M=i?R<=i:!0;return Y&&M},T=new Set(ee.map(b=>b.$id));return E.filter(b=>T.has(b.process_id)).forEach(b=>{const R=`${b.raw_product_id}-${b.process_id}`,Y=Array.isArray(b.stock_items)?b.stock_items.reduce((le,ge)=>le+(Number(ge.quantity)||0),0):0,M=b.assigned_quantity!==void 0&&b.assigned_quantity!==null?Number(b.assigned_quantity):Y,J=Number(b.wastage_quantity)||0,V=M-J;k.has(R)?k.get(R).opening_balance+=V:k.set(R,{stock_name:b.raw_product_name||"Unknown",process:L.get(b.process_id)||"Unknown",opening_balance:V,assigned:0,effective_completed:0,wastage_qty:0,utilised:0,closing_balance:0})}),D.filter(b=>T.has(b.process_id)).forEach(b=>{const R=`${b.raw_product_id}-${b.process_id}`,Y=Array.isArray(b.stock_items)?b.stock_items.reduce((le,ge)=>le+(Number(ge.quantity)||0),0):0,M=b.assigned_quantity!==void 0&&b.assigned_quantity!==null?Number(b.assigned_quantity):Y,J=Number(b.wastage_quantity)||0,V=M-J;if(k.has(R)){const le=k.get(R);le.assigned+=M,le.wastage_qty+=J,le.effective_completed+=V}else k.set(R,{stock_name:b.raw_product_name||"Unknown",process:L.get(b.process_id)||"Unknown",opening_balance:0,assigned:M,wastage_qty:J,effective_completed:V,utilised:0,closing_balance:0})}),k.forEach((b,R)=>{const[Y,M]=R.split("-");P.get(Y);const J=(q||[]).filter(V=>{const le=V.source_process_id===M,ge=h(V.product_id),we=ge&&ge.$id===Y,H=x(V.date_assigned)||x(V.date_completed);return le&&we&&H}).reduce((V,le)=>{const ge=Number(le.source_quantity)||0;return V+ge},0);b.utilised=J}),k.forEach(b=>{b.closing_balance=b.opening_balance+b.effective_completed-b.utilised,b.closing_balance<=0?b.status="Out of Stock":b.closing_balance<0?b.status="Low Stock":b.status="In Stock"}),Array.from(k.values())},[m,N,D,E,q,_,g,n,i,c,a]),isLoading:y||v||C||S||I,error:null}},nc=()=>{const{user:r,loading:t}=ft(),s=cs(),{toast:a}=Fe(),n=ut(),[i,c]=p.useState(""),[u,d]=p.useState({from:es(new Date),to:Zt(new Date)}),[o,m]=p.useState(""),{data:y,isLoading:N}=us(),v=u.from?ct(u.from,"yyyy-MM-dd"):void 0,_=u.to?ct(u.to,"yyyy-MM-dd"):void 0,{statusRecords:C,isLoading:g}=Ha(v,_,{processId:o||void 0}),S=p.useMemo(()=>C?C.filter(q=>(q.stock_name||"").toLowerCase().includes(i.toLowerCase())||(q.process||"").toLowerCase().includes(i.toLowerCase())):[],[C,i]),D=async()=>{try{await n.invalidateQueries({queryKey:["stocks"]}),await n.invalidateQueries({queryKey:["processes"]}),await n.invalidateQueries({queryKey:["productionTasks"]}),await n.invalidateQueries({queryKey:["postProductionTasks"]}),await n.invalidateQueries({queryKey:["rawProducts"]}),await n.invalidateQueries({queryKey:["products"]}),a({title:"Production Data Refreshed",description:"Data updated successfully"})}catch{a({title:"Refresh Failed",description:"Please try again",variant:"destructive"})}},I=()=>{const U=[["Raw Product","Process","Opening Balance","Assigned","Effective Completed","Wastage Qty","Utilised","Closing Bal","Min Level","Status"].join(","),...S.map(h=>[`"${h.stock_name}"`,`"${h.process}"`,h.opening_balance.toFixed(2),h.assigned.toFixed(2),h.effective_completed.toFixed(2),h.wastage_qty.toFixed(2),h.utilised.toFixed(2),h.closing_balance.toFixed(2),(h.min_level||0).toFixed(2),`"${h.status||"In Stock"}"`].join(","))].join(`
`),O=new Blob([U],{type:"text/csv;charset=utf-8;"}),ee=URL.createObjectURL(O),L=document.createElement("a");L.setAttribute("href",ee);const P=v&&_?`_${v}_to_${_}`:"";L.setAttribute("download",`production-status${P}_${new Date().toISOString().split("T")[0]}.csv`),L.style.visibility="hidden",document.body.appendChild(L),L.click(),document.body.removeChild(L)},E=g||N;return t?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ve,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading..."})]})}):r?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Production Status"}),e.jsx("p",{className:"text-muted-foreground",children:"Track material flow through production stages"})]}),e.jsx(G,{children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("div",{className:"relative w-full md:w-auto",children:[e.jsx(pt,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(B,{placeholder:"Search stock or process...",className:"w-full pl-8 md:w-[200px] lg:w-[300px]",value:i,onChange:q=>c(q.target.value)})]}),e.jsx(qs,{value:u,onChange:q=>{q?.from&&q?.to&&d(q)}}),e.jsxs(re,{value:o,onValueChange:m,children:[e.jsx(se,{className:"w-[180px]",children:e.jsx(ne,{placeholder:"All Processes"})}),e.jsx(ae,{children:y?.filter(q=>{const U=q.process_name?.toLowerCase();return U==="grinding"||U==="blending"}).map(q=>e.jsx(w,{value:q.$id,children:q.process_name},q.$id))})]}),e.jsx($,{onClick:D,variant:"outline",size:"icon",disabled:E,children:e.jsx(La,{className:`h-4 w-4 ${E?"animate-spin":""}`})}),e.jsx($,{onClick:I,variant:"outline",size:"icon",disabled:!S||S.length===0,children:e.jsx(hs,{className:"h-4 w-4"})})]})})}),E?e.jsx(G,{children:e.jsxs(Z,{className:"py-12 text-center",children:[e.jsx(Ve,{className:"h-8 w-8 animate-spin mx-auto mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading production status..."})]})}):e.jsxs(G,{children:[e.jsxs(me,{className:"flex flex-row items-center justify-between",children:[e.jsxs(pe,{children:["Production Status Records (",S.length,")"]}),e.jsx("div",{className:"flex items-center gap-2"})]}),e.jsx(Z,{children:e.jsxs(jt,{children:[e.jsx(yt,{children:e.jsxs(Ee,{children:[e.jsx(X,{children:"Raw Product"}),e.jsx(X,{children:"Process"}),e.jsx(X,{className:"text-right",children:"Opening Balance"}),e.jsx(X,{className:"text-right",children:"Assigned"}),e.jsx(X,{className:"text-right bg-purple-50",children:"Effective Completed"}),e.jsx(X,{className:"text-right",children:"Wastage Qty"}),e.jsx(X,{className:"text-right bg-green-50",children:"Utilised"}),e.jsx(X,{className:"text-right",children:"Closing Bal"}),e.jsx(X,{className:"text-right",children:"Min Level"}),e.jsx(X,{children:"Status"})]})}),e.jsx(vt,{children:S&&S.length>0?S.map((q,U)=>e.jsxs(Ee,{children:[e.jsx(Q,{children:q.stock_name}),e.jsx(Q,{children:q.process}),e.jsx(Q,{className:"text-right",children:q.opening_balance.toFixed(2)}),e.jsx(Q,{className:"text-right",children:q.assigned.toFixed(2)}),e.jsx(Q,{className:"text-right bg-purple-50 font-medium",children:q.effective_completed.toFixed(2)}),e.jsx(Q,{className:"text-right",children:q.wastage_qty.toFixed(2)}),e.jsx(Q,{className:"text-right bg-green-50 font-medium",children:q.utilised.toFixed(2)}),e.jsx(Q,{className:"text-right font-semibold",children:e.jsx("span",{className:q.closing_balance<0?"text-red-600":"text-green-600",children:q.closing_balance.toFixed(2)})}),e.jsx(Q,{className:"text-right text-muted-foreground",children:(q.min_level||0).toFixed(2)}),e.jsx(Q,{children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${q.status==="Out of Stock"?"bg-red-100 text-red-800":q.status==="Low Stock"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:q.status||"In Stock"})})]},`${q.stock_name}-${q.process}-${U}`)):e.jsx(Ee,{children:e.jsx(Q,{colSpan:10,className:"text-center",children:"No production status found for the selected criteria."})})})]})})]})]}):e.jsx(Rs,{to:"/login",state:{from:s},replace:!0})},ic=(r,t)=>r.filter(s=>{const a=s.$id;return a&&a.trim()!==""}),Ys={ALL:"all"},Mn=(r,t,s={})=>{const{processId:a}=s,n=r?Kt(r):void 0,i=t?Kt(t):void 0;n&&Vs(n,1);const c=n?ct(n,"yyyy-MM-dd"):void 0,u=i?ct(i,"yyyy-MM-dd"):void 0,{data:d=[],isLoading:o}=fe({queryKey:["products"],queryFn:()=>Ht.getAll(),staleTime:600*1e3}),{data:m=[],isLoading:y}=fe({queryKey:["processes"],queryFn:()=>fs.getAll(),staleTime:600*1e3}),{data:N=[],isLoading:v}=fe({queryKey:["postProductionTasks",c,u],queryFn:()=>Xt.getPostProductionTasksWithRelations(),enabled:!!n&&!!i,staleTime:300*1e3}),{data:_=[]}=fe({queryKey:["salesUnits",c,u],queryFn:()=>Gt.getAll(),staleTime:60*1e3});return{statusRecords:p.useMemo(()=>{if(!d.length||!m.length)return[];const S=n?Vs(n,1):void 0,D=a?m.filter(U=>U.$id===a):m.filter(U=>{const O=U.process_name?.toLowerCase();return O==="packing"||O==="batch coding"}),I=U=>{if(!U)return!n&&!i;if(!n&&!i)return!0;const O=Kt(U),ee=n?O>=n:!0,L=i?O<=i:!0;return ee&&L},E=U=>!U||!S?!1:Kt(U)<=S,q=[];return d.forEach(U=>{D.forEach(O=>{const ee=U.sku||U.SKU||"",L=U.product||"",P=O.process_name,h=U.min_level||U.minLevel||0;if(!ee||!L||!P)return;const x=N.filter(H=>H.product_id===U.$id&&H.process_id===O.$id&&H.status==="completed"&&E(H.date_completed||H.date_assigned)).reduce((H,de)=>H+(Number(de.units)||0),0),T=N.filter(H=>H.source_process_id===O.$id&&H.product_id===U.$id&&E(H.date_assigned||H.date_completed)).reduce((H,de)=>H+(Number(de.units)||0),0);let b=0;P.toLowerCase()==="batch coding"&&(b=_.filter(H=>H.product_id===U.$id&&E(H.date||H.$createdAt)).reduce((H,de)=>H+(Number(de.units)||0),0));const R=x-T-b,M=N.filter(H=>H.product_id===U.$id&&H.process_id===O.$id&&H.status==="completed"&&I(H.date_completed||H.date_assigned)).reduce((H,de)=>H+(Number(de.units)||0),0),J=N.filter(H=>H.source_process_id===O.$id&&H.product_id===U.$id&&I(H.date_assigned||H.date_completed)).reduce((H,de)=>{const Ne=Number(de.units)||0;return H+Ne},0);let V=0;P.toLowerCase()==="batch coding"&&(V=_.filter(H=>H.product_id===U.$id&&I(H.date||H.$createdAt)).reduce((H,de)=>{const Ne=Number(de.units)||0;return H+Ne},0));const le=J+V,ge=R+M-le;let we="In Stock";ge<=0?we="Out of Stock":ge<h&&(we="Low Stock"),q.push({sku:ee,product_name:L,process_name:P,opening_balance:R,completed_units:M,utilised:le,closing_balance:ge,status:we,min_level:h})})}),q},[d,m,N,_,a,n,i]),isLoading:o||y||v,error:null}},oc=()=>{const{user:r,loading:t}=ft(),s=cs(),{toast:a}=Fe(),n=ut(),[i,c]=p.useState(""),[u,d]=p.useState({from:es(new Date),to:Zt(new Date)}),[o,m]=p.useState(Ys.ALL);if(t)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ve,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Validating authentication..."})]})});if(!r)return console.error("PostProductionStatus: User not authenticated, redirecting to login"),e.jsx(Rs,{to:"/login",state:{from:s},replace:!0});const{data:y=[],isLoading:N}=fe({queryKey:Ra.processes,queryFn:async()=>await fs.getAll()}),{statusRecords:v=[],isLoading:_}=Mn(u?.from?ct(u.from,"yyyy-MM-dd"):void 0,u?.to?ct(u.to,"yyyy-MM-dd"):void 0,{processId:o!==Ys.ALL?o:void 0}),C=p.useMemo(()=>{if(!v)return[];let I=[...v];if(i&&(I=I.filter(E=>E.product_name?.toLowerCase().includes(i.toLowerCase())||E.process_name?.toLowerCase().includes(i.toLowerCase())||E.sku?.toLowerCase().includes(i.toLowerCase()))),o!==Ys.ALL){const E=y.find(q=>q.$id===o)?.process_name;E&&(I=I.filter(q=>q.process_name===E))}return I},[v,i,o,y]),g=N||_,S=async()=>{try{await n.invalidateQueries({queryKey:["products"]}),await n.invalidateQueries({queryKey:["processes"]}),await n.invalidateQueries({queryKey:["postProductionTasks"]}),await n.invalidateQueries({queryKey:["salesUnits"]}),a({title:"Post-Production Data Refreshed",description:"Data updated successfully"})}catch{a({title:"Refresh Failed",description:"Please try again",variant:"destructive"})}},D=()=>{try{const I=[["SKU","Product","Process","Source Qty (kg)","Opening Balance","Completed Units","Utilised","Closing Balance","Min Level","Status"],...C.map(O=>[O.sku||"",O.product_name||"",O.process_name||"",O.source_qty??"N/A",O.opening_balance||0,O.completed_units||0,O.utilised||0,O.closing_balance||0,O.min_level||0,`"${O.status||"In Stock"}"`])].map(O=>O.join(",")).join(`
`),E=new Blob([I],{type:"text/csv"}),q=window.URL.createObjectURL(E),U=document.createElement("a");U.href=q,U.download=`post-production-status-${ct(new Date,"yyyy-MM-dd")}.csv`,U.click(),window.URL.revokeObjectURL(q),a({title:"Export Successful",description:"Post-production status data exported successfully."})}catch(I){console.error("PostProductionStatus: Export failed",I),a({title:"Export Failed",description:"Failed to export data. Please try again.",variant:"destructive"})}};return e.jsxs("div",{className:"space-y-6 p-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Post-Production Status"}),e.jsx("p",{className:"text-muted-foreground",children:"Track quality checks and post-production status"})]}),e.jsx(G,{children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("div",{className:"relative w-full md:w-auto",children:[e.jsx(pt,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(B,{placeholder:"Search product, process or SKU...",className:"w-full pl-8 md:w-[200px] lg:w-[300px]",value:i,onChange:I=>c(I.target.value)})]}),e.jsx(qs,{value:u,onChange:I=>{I?.from&&I?.to&&d(I)}}),e.jsxs(re,{value:o,onValueChange:m,children:[e.jsx(se,{className:"w-[180px]",children:e.jsx(ne,{placeholder:"Select Process"})}),e.jsxs(ae,{children:[e.jsx(w,{value:Ys.ALL,children:"All Processes"}),ic(y).filter(I=>{const E=I.process_name?.toLowerCase();return E==="packing"||E==="batch coding"}).map(I=>e.jsx(w,{value:I.$id,children:I.process_name},I.$id))]})]}),e.jsx($,{onClick:S,variant:"outline",size:"icon",disabled:g,children:e.jsx(La,{className:`h-4 w-4 ${g?"animate-spin":""}`})}),e.jsx($,{onClick:D,variant:"outline",size:"icon",disabled:!C||C.length===0,title:"Export to CSV",children:e.jsx(hs,{className:"h-4 w-4"})})]})})}),e.jsxs(G,{children:[e.jsx(me,{className:"flex flex-row items-center justify-between",children:e.jsxs(pe,{children:["Post-Production Status Records (",C.length,")"]})}),e.jsx(Z,{children:g?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(Ve,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("span",{children:"Loading post-production status..."})]}):C.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("p",{className:"text-lg mb-2",children:"No post-production status found"}),e.jsx("p",{className:"text-sm",children:i?"No matching records found":"Post-production status data will be populated from packing tasks and sales"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(jt,{children:[e.jsx(yt,{children:e.jsxs(Ee,{children:[e.jsx(X,{children:"SKU"}),e.jsx(X,{children:"Product"}),e.jsx(X,{children:"Process"}),e.jsx(X,{className:"text-right",children:"Source Qty (kg)"}),e.jsx(X,{className:"text-right",children:"Opening Balance"}),e.jsx(X,{className:"text-right bg-purple-50",children:"Completed Units"}),e.jsx(X,{className:"text-right bg-green-50",children:"Utilised"}),e.jsx(X,{className:"text-right",children:"Closing Balance"}),e.jsx(X,{className:"text-right",children:"Min Level"}),e.jsx(X,{children:"Status"})]})}),e.jsx(vt,{children:C.map((I,E)=>e.jsxs(Ee,{children:[e.jsx(Q,{className:"font-medium",children:I.sku}),e.jsx(Q,{children:I.product_name}),e.jsx(Q,{children:I.process_name}),e.jsx(Q,{className:"text-right",children:I.source_qty??"N/A"}),e.jsx(Q,{className:"text-right",children:I.opening_balance||0}),e.jsx(Q,{className:"text-right bg-purple-50 font-medium",children:I.completed_units||0}),e.jsx(Q,{className:"text-right bg-green-50 font-medium",children:I.utilised||0}),e.jsx(Q,{className:"text-right font-semibold",children:e.jsx("span",{className:(I.closing_balance||0)<0?"text-red-600":"text-green-600",children:I.closing_balance||0})}),e.jsx(Q,{className:"text-right text-muted-foreground",children:I.min_level||0}),e.jsx(Q,{children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${I.status==="Out of Stock"?"bg-red-100 text-red-800":I.status==="Low Stock"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:I.status||"In Stock"})})]},`${I.sku}-${I.process_name}-${E}`))})]})})})]})]})};function lc(){const{user:r,loading:t}=ft(),s=cs(),[a,n]=p.useState(""),[i,c]=p.useState(void 0);if(t)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ve,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Validating authentication..."})]})});if(!r)return console.error("InventoryStatus: User not authenticated, redirecting to login"),e.jsx(Rs,{to:"/login",state:{from:s},replace:!0});const{data:u=[],isLoading:d}=fe({queryKey:["products"],queryFn:async()=>await Ht.getAll()}),o=p.useMemo(()=>{const S=[];return i?.from&&S.push(Ze.greaterThanEqual("date",i.from.toISOString())),i?.to&&S.push(Ze.lessThanEqual("date",i.to.toISOString())),S},[i]),{data:m=[],isLoading:y}=fe({queryKey:["sales-units-inventory",i?.from?.toISOString(),i?.to?.toISOString()],queryFn:async()=>await Gt.getAll(o)}),{data:N=[],isLoading:v}=fe({queryKey:["sales-records-inventory",i?.from?.toISOString(),i?.to?.toISOString()],queryFn:async()=>await os.getAll(o)}),_=p.useMemo(()=>u.length?u.map(S=>{const D=S.sku||"",I=S.product||S.name||"",E=S.min_level||S.minLevel||0,q=m.filter(P=>P.sku===D).reduce((P,h)=>P+(h.units||0),0),U=N.filter(P=>P.sku===D).reduce((P,h)=>P+(h.sold_units||0),0),O=0,ee=O+q-U;let L="In Stock";return ee<=0?L="Out of Stock":ee<=E&&(L="Low Stock"),{sku:D,product:I,opening_balance:O,sales_units:q,sold:U,closing_balance:ee,min_level:E,status:L}}):[],[u,m,N]),C=p.useMemo(()=>a?_.filter(S=>S.sku.toLowerCase().includes(a.toLowerCase())||S.product.toLowerCase().includes(a.toLowerCase())):_,[_,a]),g=d||y||v;return e.jsxs("div",{className:"space-y-6 p-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Inventory Status"}),e.jsx("p",{className:"text-muted-foreground",children:"Track current inventory levels based on sales units and sold units"})]}),e.jsx(G,{children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4 items-center flex-wrap",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(pt,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(B,{placeholder:"Search by SKU or Product...",className:"pl-10",value:a,onChange:S=>n(S.target.value)})]}),e.jsx("div",{className:"min-w-[250px]",children:e.jsx(qs,{value:i,onChange:c,placeholder:"Select date range for calculations"})}),e.jsxs($,{variant:"outline",children:[e.jsx(ts,{className:"h-4 w-4 mr-2"}),"Filter"]}),e.jsxs($,{variant:"outline",children:[e.jsx(hs,{className:"h-4 w-4 mr-2"}),"Export"]})]})})}),e.jsxs(G,{children:[e.jsx(me,{children:e.jsxs(pe,{children:["Inventory Status (",C.length,")",i?.from&&i?.to&&e.jsxs("span",{className:"text-sm font-normal text-muted-foreground ml-2",children:["(",i.from.toLocaleDateString("en-GB")," - ",i.to.toLocaleDateString("en-GB"),")"]})]})}),e.jsx(Z,{children:g?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(Ve,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("span",{children:"Loading inventory status..."})]}):C.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("p",{className:"text-lg mb-2",children:"No inventory data found"}),e.jsx("p",{className:"text-sm",children:a?"Try adjusting your search criteria":"Add products and sales data to see inventory status"})]}):e.jsxs(jt,{children:[e.jsx(yt,{children:e.jsxs(Ee,{children:[e.jsx(X,{children:"SKU"}),e.jsx(X,{children:"Product"}),e.jsx(X,{className:"text-right",children:"Opening Bal"}),e.jsx(X,{className:"text-right bg-purple-50",children:"Sales Units"}),e.jsx(X,{className:"text-right bg-green-50",children:"Sold"}),e.jsx(X,{className:"text-right",children:"Closing Bal"}),e.jsx(X,{className:"text-right",children:"Min Level"}),e.jsx(X,{children:"Status"})]})}),e.jsx(vt,{children:C.map((S,D)=>e.jsxs(Ee,{children:[e.jsx(Q,{className:"font-medium",children:S.sku}),e.jsx(Q,{children:S.product}),e.jsx(Q,{className:"text-right",children:S.opening_balance.toLocaleString()}),e.jsx(Q,{className:"text-right bg-purple-50 font-medium",children:S.sales_units.toLocaleString()}),e.jsx(Q,{className:"text-right bg-green-50 font-medium",children:S.sold.toLocaleString()}),e.jsx(Q,{className:"text-right font-semibold",children:e.jsx("span",{className:S.closing_balance<0?"text-red-600":"text-green-600",children:S.closing_balance.toLocaleString()})}),e.jsx(Q,{className:"text-right text-muted-foreground",children:S.min_level.toLocaleString()}),e.jsx(Q,{children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${S.status==="Out of Stock"?"bg-red-100 text-red-800":S.status==="Low Stock"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:S.status})})]},`${S.sku}-${D}`))})]})})]}),e.jsxs(G,{children:[e.jsx(me,{children:e.jsx(pe,{children:"Summary"})}),e.jsx(Z,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:C.length}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Products"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:C.reduce((S,D)=>S+D.sales_units,0).toLocaleString()}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Sales Units"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:C.reduce((S,D)=>S+D.sold,0).toLocaleString()}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Sold"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:C.reduce((S,D)=>S+D.closing_balance,0).toLocaleString()}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Net Closing Balance"})]})]})})]})]})}const cc=[{value:"pending",label:"Pending"},{value:"in_progress",label:"In Progress"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"}],dc=({isOpen:r,onClose:t,onSubmit:s,editingTask:a,isLoading:n=!1})=>{const{data:i}=Va(),{data:c}=As(),{data:u}=us(),d=new Date,o=es(d),m=Zt(d),{statusRecords:y}=Ka(o.toISOString().split("T")[0],m.toISOString().split("T")[0],{processId:void 0}),{stockStatus:N,isLoading:v}=$n(o,m,{category:void 0,searchTerm:void 0});p.useEffect(()=>{console.log("ðŸ” RTQV DATA SOURCE DEBUG:",{dateRange:`${o.toISOString().split("T")[0]} to ${m.toISOString().split("T")[0]}`,isLoading:v,dataLength:N?.length,sampleData:N?.slice(0,2),timestamp:new Date().toISOString()})},[N,v]);const _=["Stock","Cleaning","C & D","Roasting","RFP"],C=u.filter(P=>{const h=P.process_name?.toLowerCase();return["cleaning","c & d","roasting","rfp"].includes(h)}),[g,S]=p.useState({task_id:"",stock_id:"",stock_source:"",date_assigned:new Date().toISOString().split("T")[0],process_id:"",assigned_quantity:"",completed_quantity:"",staff_id:"",date_completed:"",wastage_quantity:"",remarks:"",status:"pending"}),[D,I]=p.useState({}),[E,q]=p.useState(null),U=()=>{if(!g.stock_id||!g.stock_source||!g.assigned_quantity){q(null);return}const P=i?.find(M=>M.$id===g.stock_id);if(!P){q({isValid:!1,availableQty:0,requiredQty:0,stockName:"Unknown Stock",stockSource:g.stock_source,error:"Stock not found",validationClass:"bg-red-50 text-red-700 border-red-200",validationMessage:"Selected stock not found"});return}const h=parseFloat(g.assigned_quantity);if(h<=0){q({isValid:!1,availableQty:0,requiredQty:h,stockName:P.stock_name,stockSource:g.stock_source,error:"Invalid quantity",validationClass:"bg-yellow-50 text-yellow-700 border-yellow-200",validationMessage:"Quantity must be greater than 0"});return}let k=0,x="",T=!1;if(g.stock_source==="Stock"){if(x="Stock Status",T=v,T){q({isValid:!1,availableQty:0,requiredQty:h,stockName:P.stock_name,stockSource:g.stock_source,dataSource:x,isLoading:!0,validationClass:"bg-blue-50 text-blue-700 border-blue-200",validationMessage:"Loading stock data..."});return}const M=N?.find(J=>J.stock_name?.toLowerCase()===P.stock_name?.toLowerCase());k=M?.closing_balance??0,console.log("ðŸ” RTQV Stock Status Check:",{stock_name:P.stock_name,stockRecord_found:!!M,closing_balance:M?.closing_balance,availableQty:k,dataSource:x,forced_fresh:!0})}else{x="Pre-Production Status";const M=y?.find(J=>J.stock_name===P.stock_name&&J.process===g.stock_source);k=M?.closing_balance??0,console.log("ðŸ” RTQV Pre-Production Status Check:",{stock_name:P.stock_name,stock_source:g.stock_source,statusRecord_found:!!M,closing_balance:M?.closing_balance,availableQty:k,dataSource:x,forced_fresh:!0})}const b=k>=h;let R="",Y="";b?(R="bg-green-50 text-green-700 border-green-200",Y=`âœ“ Available: ${k}kg (Required: ${h}kg)`):k===0?(R="bg-red-50 text-red-700 border-red-200",Y=`âœ— Out of stock (Required: ${h}kg)`):(R="bg-orange-50 text-orange-700 border-orange-200",Y=`âš  Insufficient stock: ${k}kg available (Required: ${h}kg)`),q({isValid:b,availableQty:k,requiredQty:h,stockName:P.stock_name,stockSource:g.stock_source,dataSource:x,isLoading:!1,validationClass:R,validationMessage:Y})};p.useEffect(()=>{U()},[g.stock_id,g.stock_source,g.assigned_quantity,i,y,N]),p.useEffect(()=>{if(r)if(a)S({task_id:a.task_id,stock_id:a.stock_id,stock_source:a.stock_source,date_assigned:a.date_assigned,process_id:a.process_id,assigned_quantity:a.assigned_quantity.toString(),completed_quantity:a.completed_quantity?.toString()||"",staff_id:a.staff_id,date_completed:a.date_completed||"",wastage_quantity:a.wastage_quantity?.toString()||"",remarks:a.remarks||"",status:a.status});else{const P=`TASK${Date.now().toString().slice(-6)}`;S({task_id:P,stock_id:"",stock_source:"",date_assigned:new Date().toISOString().split("T")[0],process_id:"",assigned_quantity:"",completed_quantity:"",staff_id:"",date_completed:"",wastage_quantity:"",remarks:"",status:"pending"})}},[a,r]);const O=()=>{const P={};return g.task_id.trim()||(P.task_id="Task ID is required"),g.stock_id||(P.stock_id="Stock is required"),g.stock_source||(P.stock_source="Stock source is required"),g.date_assigned||(P.date_assigned="Date assigned is required"),g.process_id||(P.process_id="Process is required"),(!g.assigned_quantity||parseFloat(g.assigned_quantity)<=0)&&(P.assigned_quantity="Assigned quantity must be greater than 0"),g.staff_id||(P.staff_id="Staff is required"),g.wastage_quantity&&parseFloat(g.wastage_quantity)<0&&(P.wastage_quantity="Wastage quantity cannot be negative"),I(P),Object.keys(P).length===0},ee=P=>{if(P.preventDefault(),!O())return;const h={task_id:g.task_id,stock_id:g.stock_id,stock_source:g.stock_source,date_assigned:g.date_assigned,process_id:g.process_id,assigned_quantity:parseFloat(g.assigned_quantity),completed_quantity:g.completed_quantity?parseFloat(g.completed_quantity):void 0,staff_id:g.staff_id,date_completed:g.date_completed||void 0,wastage_quantity:g.wastage_quantity?parseFloat(g.wastage_quantity):void 0,remarks:g.remarks||void 0,status:g.status};s(h)},L=()=>{S({task_id:"",stock_id:"",stock_source:"",date_assigned:new Date().toISOString().split("T")[0],process_id:"",assigned_quantity:"",completed_quantity:"",staff_id:"",date_completed:"",wastage_quantity:"",remarks:"",status:"pending"}),I({}),q(null),t()};return e.jsx(ot,{open:r,onOpenChange:L,children:e.jsxs(at,{className:"sm:max-w-[600px] max-w-[95vw] max-h-[90vh] overflow-y-auto",children:[e.jsxs(rt,{children:[e.jsx(it,{children:a?"Edit Pre-Production Task":"Add New Pre-Production Task"}),e.jsx(lt,{children:a?"Update the details of the pre-production task below.":"Fill in the details to create a new pre-production task."})]}),e.jsxs("form",{onSubmit:ee,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(F,{htmlFor:"task_id",children:"Task ID *"}),e.jsx(B,{id:"task_id",value:g.task_id,onChange:P=>S({...g,task_id:P.target.value}),className:D.task_id?"border-red-500":""}),D.task_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:D.task_id})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"date_assigned",children:"Date Assigned *"}),e.jsx(B,{id:"date_assigned",type:"date",value:g.date_assigned,onChange:P=>S({...g,date_assigned:P.target.value}),className:D.date_assigned?"border-red-500":""}),D.date_assigned&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:D.date_assigned})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(F,{htmlFor:"stock_id",children:"Stock Name *"}),e.jsxs(re,{value:g.stock_id,onValueChange:P=>S({...g,stock_id:P}),children:[e.jsx(se,{className:D.stock_id?"border-red-500":"",children:e.jsx(ne,{placeholder:"Select Stock"})}),e.jsx(ae,{children:i.map(P=>e.jsx(w,{value:P.$id||"",children:P.stock_name},P.$id))})]}),D.stock_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:D.stock_id})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"stock_source",children:"Stock Source *"}),e.jsxs(re,{value:g.stock_source,onValueChange:P=>S({...g,stock_source:P}),children:[e.jsx(se,{className:D.stock_source?"border-red-500":"",children:e.jsx(ne,{placeholder:"Select Source"})}),e.jsx(ae,{children:_.map(P=>e.jsx(w,{value:P,children:P},P))})]}),D.stock_source&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:D.stock_source})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(F,{htmlFor:"process_id",children:"Process *"}),e.jsxs(re,{value:g.process_id,onValueChange:P=>S({...g,process_id:P}),children:[e.jsx(se,{className:D.process_id?"border-red-500":"",children:e.jsx(ne,{placeholder:"Select Process"})}),e.jsx(ae,{children:C.map(P=>e.jsx(w,{value:P.$id||"",children:P.process_name},P.$id))})]}),D.process_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:D.process_id})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"assigned_quantity",children:"Assigned Quantity *"}),e.jsx(B,{id:"assigned_quantity",type:"number",step:"0.01",min:"0",value:g.assigned_quantity,onChange:P=>S({...g,assigned_quantity:P.target.value}),className:D.assigned_quantity?"border-red-500":"",placeholder:"Enter quantity in kg"}),D.assigned_quantity&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:D.assigned_quantity}),E&&e.jsxs("div",{className:`mt-2 p-3 rounded-md border text-sm ${E.validationClass}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("div",{className:"font-medium",children:E.stockName}),e.jsxs("div",{className:"text-xs opacity-75",children:["Source: ",E.dataSource]})]}),e.jsx("div",{className:"mb-1",children:E.validationMessage}),E.error&&e.jsxs("div",{className:"text-xs mt-1 opacity-75",children:["Error: ",E.error]}),E.isLoading&&e.jsxs("div",{className:"flex items-center gap-2 text-xs mt-1",children:[e.jsx("div",{className:"animate-spin h-3 w-3 border border-current border-t-transparent rounded-full"}),"Loading fresh data from ",E.dataSource,"..."]})]})]})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"staff_id",children:"Assigned To *"}),e.jsxs(re,{value:g.staff_id,onValueChange:P=>S({...g,staff_id:P}),children:[e.jsx(se,{className:D.staff_id?"border-red-500":"",children:e.jsx(ne,{placeholder:"Select Staff"})}),e.jsx(ae,{children:c.map(P=>e.jsx(w,{value:P.$id||"",children:P.staff_name},P.$id))})]}),D.staff_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:D.staff_id})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(F,{htmlFor:"completed_quantity",children:"Completed Quantity"}),e.jsx(B,{id:"completed_quantity",type:"number",value:g.completed_quantity,onChange:P=>S({...g,completed_quantity:P.target.value})})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"date_completed",children:"Date Completed"}),e.jsx(B,{id:"date_completed",type:"date",value:g.date_completed,onChange:P=>S({...g,date_completed:P.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(F,{htmlFor:"wastage_quantity",children:"Wastage Quantity"}),e.jsx(B,{id:"wastage_quantity",type:"number",step:"0.01",min:"0",value:g.wastage_quantity,onChange:P=>S({...g,wastage_quantity:P.target.value}),className:D.wastage_quantity?"border-red-500":""}),D.wastage_quantity&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:D.wastage_quantity})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"status",children:"Status"}),e.jsxs(re,{value:g.status,onValueChange:P=>S({...g,status:P}),children:[e.jsx(se,{children:e.jsx(ne,{placeholder:"Select Status"})}),e.jsx(ae,{children:cc.map(P=>e.jsx(w,{value:P.value,children:P.label},P.value))})]})]})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"remarks",children:"Remarks"}),e.jsx(rs,{id:"remarks",value:g.remarks,onChange:P=>S({...g,remarks:P.target.value}),placeholder:"Enter any remarks",rows:3})]})]}),e.jsxs(nt,{className:"flex-col sm:flex-row gap-2 pt-4",children:[e.jsx($,{type:"button",variant:"outline",onClick:L,className:"w-full sm:w-auto",children:"Cancel"}),e.jsx($,{type:"submit",disabled:n,className:"w-full sm:w-auto",children:n?"Saving...":a?"Update":"Save"})]})]})]})})},uc=()=>{const r=ut(),t=De({mutationFn:n=>tt.createDocument(st,be.PRE_PRODUCTION_TASKS,ps.unique(),n),onSuccess:()=>{r.invalidateQueries({queryKey:["preProductionTasks"]})}}),s=De({mutationFn:({id:n,data:i})=>tt.updateDocument(st,be.PRE_PRODUCTION_TASKS,n,i),onSuccess:()=>{r.invalidateQueries({queryKey:["preProductionTasks"]})}}),a=De({mutationFn:n=>tt.deleteDocument(st,be.PRE_PRODUCTION_TASKS,n),onSuccess:()=>{r.invalidateQueries({queryKey:["preProductionTasks"]})}});return{createTask:t,updateTask:s,deleteTask:a}},mc=()=>{const r=ut(),[t,s]=p.useState(""),[a,n]=p.useState(!1),[i,c]=p.useState(null),[u,d]=p.useState([]),[o,m]=p.useState({show:!1,message:"",type:"success"}),[y,N]=p.useState("all"),[v,_]=p.useState("all"),[C,g]=p.useState("all"),[S,D]=p.useState({from:"",to:""}),[I,E]=p.useState(1),[q,U]=p.useState(50),{tasks:O,isLoading:ee,error:L,refetch:P}=Rn(),{createTask:h,updateTask:k,deleteTask:x}=uc(),{config:T}=Rt("pre-production-tasks"),{validationRules:b,canImport:R}=qt("pre-production-tasks");Ao("pre-production-tasks");const{currentSort:Y,handleSort:M,getSortedData:J}=as(),{data:V}=us(),{data:le}=Va(),{data:ge}=As(),{toast:we}=Fe(),{data:H}=fe({queryKey:["pre-production-tasks","all","with-relations"],queryFn:()=>ls.getPreProductionTasksWithRelations()}),de=(l,W)=>{m({show:!0,message:l,type:W}),setTimeout(()=>m({show:!1,message:"",type:"success"}),3e3)},Ne=O.filter(l=>{const W=l.task_id.toLowerCase().includes(t.toLowerCase())||l.stock_name.toLowerCase().includes(t.toLowerCase())||l.staff_name.toLowerCase().includes(t.toLowerCase())||l.process_name.toLowerCase().includes(t.toLowerCase()),f=y==="all"||l.stock_name.toLowerCase().includes(y.toLowerCase()),z=v==="all"||l.process_name.toLowerCase().includes(v.toLowerCase()),ue=C==="all"||l.staff_name.toLowerCase().includes(C.toLowerCase()),xe=(!S.from||l.date_assigned>=S.from)&&(!S.to||l.date_assigned<=S.to);return W&&f&&z&&ue&&xe}),Le=Array.from(new Set(O.map(l=>l.stock_name))).sort(),mt=Array.from(new Set(O.map(l=>l.process_name))).sort(),ye=Array.from(new Set(O.map(l=>l.staff_name))).sort(),Pe=Ne.length,Be=Math.ceil(Pe/q),Ke=(I-1)*q,Je=Ke+q,bt=Ne.slice(Ke,Je);p.useEffect(()=>{E(1)},[t,y,v,C,S,q]);const Lt=async l=>{try{i?(await k.mutateAsync({id:i.$id,data:l}),de("Pre-production task updated successfully","success")):(await h.mutateAsync(l),de("Pre-production task created successfully","success")),n(!1),c(null)}catch(W){console.error("Error saving task:",W),de("Failed to save task","error")}},ht=l=>{c(l),n(!0)},xt=async l=>{if(window.confirm("Are you sure you want to delete this task?"))try{await x.mutateAsync(l.$id),de("Pre-production task deleted successfully","success")}catch(W){console.error("Error deleting task:",W),de("Failed to delete task","error")}},Nt=async()=>{if(u.length===0){de("Please select tasks to delete","error");return}if(window.confirm(`Are you sure you want to delete ${u.length} selected task(s)?`))try{await Promise.all(u.map(l=>x.mutateAsync(l.$id))),d([]),de(`${u.length} tasks deleted successfully`,"success")}catch(l){console.error("Error deleting tasks:",l),de("Failed to delete selected tasks","error")}},wt=()=>{if(u.length===0){de("Please select tasks to export","error");return}de(`Exporting ${u.length} selected task(s)...`,"success")};return L?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Pre-Production Tasks"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage pre-production processing tasks"})]}),e.jsx(G,{children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"text-center py-12 text-red-600",children:[e.jsx("p",{className:"text-lg mb-2",children:"Error loading tasks"}),e.jsx("p",{className:"text-sm mb-4",children:L.message}),e.jsx($,{onClick:()=>P(),variant:"outline",children:"Retry"})]})})})]}):e.jsxs("div",{className:"space-y-6",children:[o.show&&e.jsx("div",{className:`fixed top-4 right-4 px-4 py-2 rounded-md shadow-lg z-50 ${o.type==="success"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300"}`,children:o.message}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Pre-Production Tasks"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage pre-production processing tasks"})]}),e.jsxs($,{className:"bg-primary hover:bg-primary/90",onClick:()=>{c(null),n(!0)},children:[e.jsx(Tt,{className:"h-4 w-4 mr-2"}),"Add New"]})]}),e.jsx(G,{children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(pt,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(B,{placeholder:"Search tasks...",className:"pl-10",value:t,onChange:l=>s(l.target.value)})]}),R&&T&&e.jsx(Pt,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:T.exportColumns.filter(l=>l.required).map(l=>l.exportHeader),optionalColumns:T.exportColumns.filter(l=>!l.required).map(l=>l.exportHeader),validationRules:b,maxFileSize:50,existingData:H||[],duplicateChecker:(l,W)=>{const f=(l["Task ID"]||l.task_id||l.task_id||"").toLowerCase().trim(),z=(l["Stock Name"]||l.stock_name||l.stock_name||"").toLowerCase().trim(),ue=(l["Stock Source"]||l.stock_source||l.stock_source||"").toLowerCase().trim(),xe=l["Date Assigned"]||l.date_assigned||l.date_assigned||"",qe=(l.Process||l.process_name||l.process_name||"").toLowerCase().trim();let $e="";if(xe)if(typeof xe=="string"){const Me=xe.match(/^(\d{2})-(\d{2})-(\d{4})$/);if(Me){const[,A,he,ve]=Me,je=new Date(parseInt(ve),parseInt(he)-1,parseInt(A));isNaN(je.getTime())||($e=je.toISOString().split("T")[0])}else{const A=new Date(xe);isNaN(A.getTime())||($e=A.toISOString().split("T")[0])}}else xe instanceof Date&&($e=xe.toISOString().split("T")[0]);return W.some(Me=>{const A=(Me.task_id||"").toLowerCase().trim(),he=(Me.stock_name||"").toLowerCase().trim(),ve=(Me.stock_source||"").toLowerCase().trim(),je=Me.date_assigned||"",gt=(Me.process_name||"").toLowerCase().trim();let Te="";return je&&(typeof je=="string"?Te=je:je instanceof Date&&(Te=je.toISOString().split("T")[0])),f===A&&z===he&&ue===ve&&$e===Te&&qe===gt})},validationHeaderMapper:l=>{const W=T.exportColumns.find(f=>f.dataKey===l);return W?W.exportHeader:l},columnMapper:l=>{const W=T.exportColumns.find(f=>f.exportHeader===l);if(W){if(W.dataKey==="stock_name")return"stock_name";if(W.dataKey==="process_name")return"process_name";if(W.dataKey==="staff_name")return"staff_name";const f={task_id:"task_id",stock_source:"stock_source",date_assigned:"date_assigned",assigned_quantity:"assigned_quantity",date_completed:"date_completed",completed_quantity:"completed_quantity",wastage_quantity:"wastage_quantity",remarks:"remarks",status:"status"};return W.dataKey==="date_completed"?"date_completed":W.dataKey==="completed_quantity"?"completed_quantity":f[W.dataKey]||W.dataKey}return l},dataProcessor:async l=>{let W=l["Stock Name"]||l.stock_name||l.stock_name;if(!W||W==="")throw new Error("Stock Name is required");const f=String(W).trim(),z=le?.find(_e=>_e.stock_name.toLowerCase()===f.toLowerCase());if(!z){const _e=le?.map(Oe=>Oe.stock_name).slice(0,5).join(", ")||"None";throw new Error(`Stock "${f}" not found. Available: ${_e}`)}const ue=z.$id;let xe=l.Process||l.process_name||l.process_name;if(!xe||xe==="")throw new Error("Process is required");const qe=String(xe).trim(),$e=V?.find(_e=>_e.process_name.toLowerCase()===qe.toLowerCase());if(!$e){const _e=V?.map(Oe=>Oe.process_name).slice(0,5).join(", ")||"None";throw new Error(`Process "${qe}" not found. Available: ${_e}`)}const Me=$e.$id;let A="",he=l["Staff Name"]||l.staff_name||l.staff_name;if(he&&he!==""){const _e=String(he).trim(),Oe=ge?.find(Ue=>Ue.staff_name.toLowerCase()===_e.toLowerCase());Oe&&(A=Oe.$id)}const ve=(_e,Oe)=>{if(!_e)return Oe||"";let Ue=_e;if(typeof Ue=="string"){const Ie=Ue.match(/^(\d{2})-(\d{2})-(\d{4})$/);if(Ie){const[,j,K,te]=Ie,ce=new Date(parseInt(te),parseInt(K)-1,parseInt(j));if(!isNaN(ce.getTime()))return ce.toISOString().split("T")[0]}else{const j=new Date(Ue);if(!isNaN(j.getTime()))return j.toISOString().split("T")[0]}}else if(Ue instanceof Date)return Ue.toISOString().split("T")[0];return Oe||""},je=ve(l["Date Assigned"]||l.date_assigned||l.date_assigned,new Date().toISOString().split("T")[0]),gt=ve(l["Date Completed"]||l.date_completed||l.date_completed,""),Te={task_id:l["Task ID"]||l.task_id||l.task_id,stock_id:ue,stock_source:l["Stock Source"]||l.stock_source||l.stock_source||"",date_assigned:je,date_completed:gt||void 0,process_id:Me,staff_id:A||"",assigned_quantity:parseFloat(l["Assigned Qty"]||l.assigned_quantity||l.assigned_quantity||0),completed_quantity:parseFloat(l["Completed Qty"]||l.completed_quantity||l.completed_quantity||0),wastage_quantity:parseFloat(l["Wastage Qty"]||l.wastage_quantity||l.wastage_quantity||0),status:"completed",remarks:l.Remarks||l.remarks||l.remarks||""};return await ls.create(Te)},onImportComplete:async l=>{await r.invalidateQueries({queryKey:["pre-production-tasks"],refetchType:"active"}),await r.refetchQueries({queryKey:["pre-production-tasks"]}),P(),l.successfulRows>0&&we({title:"Import Successful",description:`${l.successfulRows} pre-production tasks imported successfully.`}),l.failedRows>0&&we({title:"Import Completed with Errors",description:`${l.successfulRows} successful, ${l.failedRows} failed.`,variant:"destructive"})}},variant:"outline"}),T&&e.jsx(Ct,{data:Ne.map(l=>{const W={};return T.exportColumns.forEach(f=>{const z=l[f.dataKey];W[f.exportHeader]=f.formatter?f.formatter(z):z}),W}),headers:T.exportColumns.map(l=>l.exportHeader),filename:"pre-production-tasks",variant:"outline"})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs(re,{value:y,onValueChange:N,children:[e.jsx(se,{className:"w-[180px]",children:e.jsx(ne,{placeholder:"Stock Name"})}),e.jsxs(ae,{children:[e.jsx(w,{value:"all",children:"All Stocks"}),Le.map(l=>e.jsx(w,{value:l,children:l},l))]})]}),e.jsxs(re,{value:v,onValueChange:_,children:[e.jsx(se,{className:"w-[180px]",children:e.jsx(ne,{placeholder:"Process"})}),e.jsxs(ae,{children:[e.jsx(w,{value:"all",children:"All Processes"}),mt.map(l=>e.jsx(w,{value:l,children:l},l))]})]}),e.jsxs(re,{value:C,onValueChange:g,children:[e.jsx(se,{className:"w-[180px]",children:e.jsx(ne,{placeholder:"Staff Name"})}),e.jsxs(ae,{children:[e.jsx(w,{value:"all",children:"All Staff"}),ye.map(l=>e.jsx(w,{value:l,children:l},l))]})]}),e.jsx(B,{type:"date",placeholder:"From Date",className:"w-[150px]",value:S.from,onChange:l=>D(W=>({...W,from:l.target.value}))}),e.jsx(B,{type:"date",placeholder:"To Date",className:"w-[150px]",value:S.to,onChange:l=>D(W=>({...W,to:l.target.value}))})]})]})})}),e.jsx(G,{children:e.jsxs(Z,{className:"pt-6",children:[u.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 p-3 bg-muted rounded-md",children:[e.jsxs("span",{className:"text-sm font-medium",children:[u.length," selected"]}),e.jsx($,{variant:"destructive",size:"sm",onClick:Nt,children:"Delete Selected"}),e.jsx($,{variant:"outline",size:"sm",onClick:wt,children:"Export Selected"})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",Ke+1," to ",Math.min(Je,Pe)," of ",Pe," records"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Records per page:"}),e.jsxs(re,{value:q.toString(),onValueChange:l=>U(Number(l)),children:[e.jsx(se,{className:"w-[100px]",children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(w,{value:"50",children:"50"}),e.jsx(w,{value:"100",children:"100"}),e.jsx(w,{value:"500",children:"500"})]})]})]})]}),e.jsx("div",{className:"border rounded-md",children:e.jsx("div",{className:"overflow-auto",style:{maxHeight:"600px"},children:e.jsx(ds,{data:J(bt.map(l=>({...l,formattedDateAssigned:new Date(l.date_assigned).toLocaleDateString("en-GB"),formattedDateCompleted:l.date_completed?new Date(l.date_completed).toLocaleDateString("en-GB"):"-"}))),columns:[{key:"task_id",label:"Task ID",sortable:!0,dataType:"string"},{key:"stock_name",label:"Stock Name",sortable:!0,dataType:"string"},{key:"stock_source",label:"Stock Source",sortable:!0,dataType:"string"},{key:"formattedDateAssigned",label:"Date Assigned",sortable:!0,dataType:"date"},{key:"process_name",label:"Process",sortable:!0,dataType:"string"},{key:"assigned_quantity",label:"Assigned Qty",sortable:!0,dataType:"number",align:"right",headerClassName:"bg-purple-50",cellClassName:"bg-purple-50 font-medium"},{key:"staff_name",label:"Staff Name",sortable:!0,dataType:"string"},{key:"formattedDateCompleted",label:"Date Completed",sortable:!0,dataType:"date"},{key:"completed_quantity",label:"Completed Qty",sortable:!0,dataType:"number",align:"right",headerClassName:"bg-green-50",cellClassName:"bg-green-50 font-medium"},{key:"wastage_quantity",label:"Wastage Qty",sortable:!0,dataType:"number",align:"right"},{key:"remarks",label:"Remarks",sortable:!0,dataType:"string"},{key:"status",label:"Status",sortable:!0,dataType:"string",formatter:l=>e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${l==="completed"?"bg-green-100 text-green-800":l==="in_progress"?"bg-yellow-100 text-yellow-800":l==="pending"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:l==="in_progress"?"In Progress":l.charAt(0).toUpperCase()+l.slice(1)})}],onSort:M,currentSort:Y,loading:ee,maxHeight:"none",stickyHeader:!0,bordered:!1,searchable:!1,selectable:!0,selectedRows:u,onSelectionChange:d,rowKey:"$id",actions:[Ts.edit(l=>ht(l)),Ts.delete(l=>xt(l))],emptyMessage:"No pre-production tasks found"})})}),Be>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx($,{variant:"outline",size:"sm",onClick:()=>E(l=>Math.max(1,l-1)),disabled:I===1,children:"Previous"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",I," of ",Be]})}),e.jsx($,{variant:"outline",size:"sm",onClick:()=>E(l=>Math.min(Be,l+1)),disabled:I===Be,children:"Next"})]})]})}),e.jsx(dc,{isOpen:a,onClose:()=>{n(!1),c(null)},onSubmit:Lt,editingTask:i,isLoading:h.isPending||k.isPending})]})},pc=({items:r,onItemsChange:t,availableStocks:s,isLoading:a=!1})=>{const n=()=>{const d={stock_id:"",stock_name:"",quantity:0,action:""};t([...r,d])},i=d=>{const o=r.filter((m,y)=>y!==d);t(o)},c=(d,o,m)=>{const y=[...r];if(y[d]={...y[d],[o]:m},o==="stock_id"){const N=s.find(v=>v.$id===m);y[d].stock_name=N?.stock_name||""}t(y)},u=()=>r.reduce((d,o)=>d+(o.quantity||0),0);return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(F,{className:"text-xs font-medium",children:"Stock Items"}),e.jsxs($,{type:"button",variant:"outline",size:"sm",onClick:n,disabled:a,className:"h-7 px-2 text-xs",children:[e.jsx(Tt,{className:"h-3 w-3 mr-1"}),"Add Row"]})]}),r.length===0?e.jsxs("div",{className:"text-center py-4 text-muted-foreground border-2 border-dashed rounded-lg",children:[e.jsx("p",{className:"text-xs",children:"No stock items added"}),e.jsx("p",{className:"text-xs",children:'Click "Add Row" to add stock items'})]}):e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsx("div",{className:"max-h-64 overflow-y-auto",children:e.jsxs(jt,{children:[e.jsx(yt,{className:"sticky top-0 bg-white z-10",children:e.jsxs(Ee,{children:[e.jsx(X,{className:"text-xs py-2",children:"Stock Name"}),e.jsx(X,{className:"text-xs py-2 w-24",children:"Qty (kg)"}),e.jsx(X,{className:"text-xs py-2 w-20",children:"Action"}),e.jsx(X,{className:"text-xs py-2 w-12",children:"Remove"})]})}),e.jsx(vt,{children:r.map((d,o)=>e.jsxs(Ee,{className:"h-10",children:[e.jsx(Q,{className:"py-1",children:e.jsxs(re,{value:d.stock_id,onValueChange:m=>c(o,"stock_id",m),disabled:a,children:[e.jsx(se,{className:"h-7 text-xs",children:e.jsx(ne,{placeholder:"Select Stock"})}),e.jsx(ae,{children:s.map(m=>e.jsxs(w,{value:m.$id||"",children:[m.stock_name," (",m.stock_code,")"]},m.$id))})]})}),e.jsx(Q,{className:"py-1",children:e.jsx(B,{type:"number",step:"0.01",min:"0",value:d.quantity||"",onChange:m=>c(o,"quantity",parseFloat(m.target.value)||0),placeholder:"0",disabled:a,className:"h-7 text-xs",maxLength:10})}),e.jsx(Q,{className:"py-1",children:e.jsx(B,{value:d.action||"",onChange:m=>c(o,"action",m.target.value),placeholder:"Action",disabled:a,className:"h-7 text-xs"})}),e.jsx(Q,{className:"py-1",children:e.jsx($,{type:"button",variant:"ghost",size:"sm",className:"h-6 w-6 p-0 text-red-500 hover:text-red-700 hover:bg-red-50",onClick:()=>i(o),disabled:a,children:e.jsx($t,{className:"h-3 w-3"})})})]},o))})]})})}),r.length>0&&e.jsx("div",{className:"flex justify-end bg-gray-50 px-3 py-1 rounded",children:e.jsxs("div",{className:"text-xs font-medium",children:["Total Quantity: ",u().toFixed(2)," kg"]})})]})},hc=[{value:"pending",label:"Pending"},{value:"in_progress",label:"In Progress"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"}],xc=({isOpen:r,onClose:t,onSubmit:s,editingTask:a,isLoading:n=!1})=>{const{data:i}=Va(),{data:c}=As(),{data:u}=us(),{data:d}=Ba(),o=u.filter(x=>{const T=x.department?.toLowerCase();return T&&T==="production"?!0:x.process_name?.toLowerCase()==="grinding"}),[m,y]=p.useState({task_id:"",date_assigned:new Date().toISOString().split("T")[0],raw_product_id:"",process_id:"",staff_id:"",source_process_id:"",completed_quantity:"",date_completed:"",wastage_quantity:"",remarks:"",status:"pending"}),[N,v]=p.useState([]),[_,C]=p.useState({}),[g,S]=p.useState(null),D=new Date,I=es(D),E=Zt(D),{statusRecords:q}=Ha(I.toISOString().split("T")[0],E.toISOString().split("T")[0],{processId:void 0}),{statusRecords:U}=Ka(I.toISOString().split("T")[0],E.toISOString().split("T")[0],{processId:void 0}),O=()=>{if(!m.source_process_id||!N.length||!m.raw_product_id){S(null);return}const x=N.reduce((H,de)=>H+(de.quantity||0),0);if(x<=0){S({isValid:!1,availableQty:0,requiredQty:x,stockName:"Stock Items",stockSource:"Unknown",error:"Invalid quantity",validationClass:"bg-yellow-50 text-yellow-700 border-yellow-200",validationMessage:"Total quantity must be greater than 0"});return}const T=u?.find(H=>H.$id===m.source_process_id),b=d?.find(H=>H.$id===m.raw_product_id);if(!T||!b){S({isValid:!1,availableQty:0,requiredQty:x,stockName:b?.raw_product||"Unknown Product",stockSource:T?.process_name||"Unknown Process",error:"Missing reference data",validationClass:"bg-red-50 text-red-700 border-red-200",validationMessage:"Source process or raw product not found"});return}const R="Pre-Production Status",M=N[0]?.stock_name||b.raw_product;let J=U?.find(H=>H.stock_name===M&&H.process===T.process_name);if(!J&&M&&(J=U?.find(H=>H.stock_name?.toLowerCase().includes(M.toLowerCase().split("(")[0].trim())&&H.process===T.process_name)),!J){const H=M?.toLowerCase().split("(")[0].trim()||b.raw_product?.toLowerCase();J=U?.find(de=>de.process===T.process_name&&de.stock_name?.toLowerCase().includes(H))}const V=J?.closing_balance??0,le=V>=x;console.log("ðŸ” RTQV Production Status Check (Enhanced):",{raw_product:b.raw_product,stock_name_from_items:M,source_process:T.process_name,statusRecord_found:!!J,statusRecord_stock_name:J?.stock_name,statusRecord_process:J?.process,closing_balance:J?.closing_balance,availableQty:V,totalRequiredQty:x,dataSource:R,forced_fresh:!0,stock_items:N.map(H=>({stock_name:H.stock_name,quantity:H.quantity})),all_preproduction_records:U?.map(H=>({stock_name:H.stock_name,process:H.process,closing_balance:H.closing_balance}))});let ge="",we="";le?(ge="bg-green-50 text-green-700 border-green-200",we=`âœ“ Available: ${V}kg (Required: ${x}kg)`):V===0?(ge="bg-red-50 text-red-700 border-red-200",we=`âœ— Out of stock (Required: ${x}kg)`):(ge="bg-orange-50 text-orange-700 border-orange-200",we=`âš  Insufficient stock: ${V}kg available (Required: ${x}kg)`),S({isValid:le,availableQty:V,requiredQty:x,stockName:M||b.raw_product,stockSource:T.process_name,dataSource:R,isLoading:!1,validationClass:ge,validationMessage:we})};p.useEffect(()=>{O()},[m.source_process_id,m.raw_product_id,N,u,d,q,U]);const ee=u.filter(x=>x.process_name==="RFP");p.useEffect(()=>{if(r)if(a)y({task_id:a.task_id||"",date_assigned:a.date||"",raw_product_id:a.raw_product_id||"",process_id:a.process_id||"",staff_id:a.staff_id||"",source_process_id:a.source_process_id||"",completed_quantity:a.completed_quantity?.toString()||"",date_completed:a.date_completed||"",wastage_quantity:a.wastage_quantity?.toString()||"",remarks:a.remarks||"",status:a.status||"pending"}),a.stock_items&&v(a.stock_items.map(x=>({stock_id:x.stock_id,stock_name:x.stock_name,quantity:x.quantity,action:x.action||""})));else{const x=`PROD${Date.now().toString().slice(-6)}`;y({task_id:x,date_assigned:new Date().toISOString().split("T")[0],raw_product_id:"",process_id:"",staff_id:"",source_process_id:"",completed_quantity:"",date_completed:"",wastage_quantity:"",remarks:"",status:"pending"}),v([])}},[a,r]);const L=()=>N.reduce((x,T)=>x+(T.quantity||0),0),P=()=>{const x={};return m.task_id.trim()||(x.task_id="Task ID is required"),m.date_assigned||(x.date_assigned="Date is required"),m.raw_product_id||(x.raw_product_id="Raw product is required"),m.process_id||(x.process_id="Process is required"),m.staff_id||(x.staff_id="Staff is required"),m.source_process_id||(x.source_process_id="Source process is required"),(!m.completed_quantity||parseFloat(m.completed_quantity)<=0)&&(x.completed_quantity="Completed quantity is required and must be greater than 0"),N.length===0&&(x.stock_items="At least one stock item is required"),m.wastage_quantity&&parseFloat(m.wastage_quantity)<0&&(x.wastage_quantity="Wastage quantity cannot be negative"),N.forEach((T,b)=>{T.stock_id||(x[`stock_item_${b}_stock`]=`Stock is required for item ${b+1}`),(!T.quantity||T.quantity<=0)&&(x[`stock_item_${b}_quantity`]=`Quantity must be greater than 0 for item ${b+1}`)}),C(x),Object.keys(x).length===0},h=x=>{if(x.preventDefault(),!P())return;const T={task_id:m.task_id,date:m.date_assigned,raw_product_id:m.raw_product_id,process_id:m.process_id,staff_id:m.staff_id,source_process_id:m.source_process_id,assigned_quantity:L(),completed_quantity:parseFloat(m.completed_quantity),wastage_quantity:m.wastage_quantity?parseFloat(m.wastage_quantity):void 0,remarks:m.remarks||void 0,status:m.status};m.date_completed&&m.date_completed.trim()!==""&&(T.date_completed=m.date_completed),s({taskData:T,stockItems:N})},k=()=>{y({task_id:"",date_assigned:new Date().toISOString().split("T")[0],raw_product_id:"",process_id:"",staff_id:"",source_process_id:"",completed_quantity:"",date_completed:"",wastage_quantity:"",remarks:"",status:"pending"}),v([]),C({}),t()};return e.jsx(ot,{open:r,onOpenChange:k,children:e.jsxs(at,{className:"sm:max-w-[800px] max-w-[95vw] max-h-[90vh] overflow-y-auto",children:[e.jsxs(rt,{className:"pb-2",children:[e.jsx(it,{className:"text-lg",children:a?"Edit Production Task":"Add New Production Task"}),e.jsx(lt,{className:"text-sm",children:a?"Update the production task details below.":"Fill in the details to create a new production task."})]}),e.jsxs("form",{onSubmit:h,children:[e.jsxs("div",{className:"grid gap-3 py-3",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[e.jsxs("div",{children:[e.jsx(F,{htmlFor:"task_id",className:"text-xs font-medium",children:"Task ID *"}),e.jsx(B,{id:"task_id",value:m.task_id,onChange:x=>y({...m,task_id:x.target.value}),className:`h-8 text-sm ${_.task_id?"border-red-500":""}`,maxLength:15}),_.task_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:_.task_id})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"date_assigned",className:"text-xs font-medium",children:"Date *"}),e.jsx(B,{id:"date_assigned",type:"date",value:m.date_assigned,onChange:x=>y({...m,date_assigned:x.target.value}),className:`h-8 text-sm ${_.date_assigned?"border-red-500":""}`}),_.date_assigned&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:_.date_assigned})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"process_id",className:"text-xs font-medium",children:"Process *"}),e.jsxs(re,{value:m.process_id,onValueChange:x=>y({...m,process_id:x}),children:[e.jsx(se,{className:`h-8 text-sm ${_.process_id?"border-red-500":""}`,children:e.jsx(ne,{placeholder:"Select Process"})}),e.jsx(ae,{children:o.map(x=>e.jsx(w,{value:x.$id||"",children:x.process_name},x.$id))})]}),_.process_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:_.process_id})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"source_process_id",className:"text-xs font-medium",children:"Source Process *"}),e.jsxs(re,{value:m.source_process_id,onValueChange:x=>y({...m,source_process_id:x}),children:[e.jsx(se,{className:`h-8 text-sm ${_.source_process_id?"border-red-500":""}`,children:e.jsx(ne,{placeholder:"Select Source"})}),e.jsx(ae,{children:ee.map(x=>e.jsx(w,{value:x.$id||"",children:x.process_name},x.$id))})]}),_.source_process_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:_.source_process_id})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(F,{htmlFor:"raw_product_id",className:"text-xs font-medium",children:"Raw Product *"}),e.jsxs(re,{value:m.raw_product_id,onValueChange:x=>y({...m,raw_product_id:x}),children:[e.jsx(se,{className:`h-8 text-sm ${_.raw_product_id?"border-red-500":""}`,children:e.jsx(ne,{placeholder:"Select Raw Product"})}),e.jsx(ae,{children:d.map(x=>e.jsx(w,{value:x.$id||"",children:x.raw_product},x.$id))})]}),_.raw_product_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:_.raw_product_id})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"staff_id",className:"text-xs font-medium",children:"Staff Name *"}),e.jsxs(re,{value:m.staff_id,onValueChange:x=>y({...m,staff_id:x}),children:[e.jsx(se,{className:`h-8 text-sm ${_.staff_id?"border-red-500":""}`,children:e.jsx(ne,{placeholder:"Select Staff"})}),e.jsx(ae,{children:c.map(x=>e.jsx(w,{value:x.$id||"",children:x.staff_name},x.$id))})]}),_.staff_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:_.staff_id})]})]}),e.jsxs("div",{children:[e.jsx(F,{className:"text-base font-semibold",children:"Stock Items"}),e.jsx(pc,{items:N,onItemsChange:v,availableStocks:i,isLoading:n}),_.stock_items&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:_.stock_items}),g&&e.jsxs("div",{className:`mt-2 p-3 rounded-md border text-sm ${g.validationClass}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("div",{className:"font-medium",children:g.stockName}),e.jsxs("div",{className:"text-xs opacity-75",children:["Source: ",g.dataSource]})]}),e.jsx("div",{className:"mb-1",children:g.validationMessage}),g.error&&e.jsxs("div",{className:"text-xs mt-1 opacity-75",children:["Error: ",g.error]}),g.isLoading&&e.jsxs("div",{className:"flex items-center gap-2 text-xs mt-1",children:[e.jsx("div",{className:"animate-spin h-3 w-3 border border-current border-t-transparent rounded-full"}),"Loading fresh data from ",g.dataSource,"..."]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(F,{htmlFor:"assigned_quantity",className:"text-xs font-medium",children:"Assigned Qty (Auto-calculated)"}),e.jsxs("div",{className:"relative",children:[e.jsx(B,{id:"assigned_quantity",type:"number",value:L().toFixed(2),disabled:!0,className:"bg-gray-50 h-8 text-sm pr-8",maxLength:10}),e.jsx("span",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-xs text-gray-500",children:"kg"})]})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"completed_quantity",className:"text-xs font-medium",children:"Completed Qty *"}),e.jsxs("div",{className:"relative",children:[e.jsx(B,{id:"completed_quantity",type:"number",step:"0.01",min:"0",value:m.completed_quantity,onChange:x=>y({...m,completed_quantity:x.target.value}),className:`h-8 text-sm pr-8 ${_.completed_quantity?"border-red-500":""}`,maxLength:10}),e.jsx("span",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-xs text-gray-500",children:"kg"})]}),_.completed_quantity&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:_.completed_quantity})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"wastage_quantity",className:"text-xs font-medium",children:"Wastage Qty"}),e.jsxs("div",{className:"relative",children:[e.jsx(B,{id:"wastage_quantity",type:"number",step:"0.01",min:"0",value:m.wastage_quantity,onChange:x=>y({...m,wastage_quantity:x.target.value}),className:`h-8 text-sm pr-8 ${_.wastage_quantity?"border-red-500":""}`,maxLength:10}),e.jsx("span",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-xs text-gray-500",children:"kg"})]}),_.wastage_quantity&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:_.wastage_quantity})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(F,{htmlFor:"date_completed",className:"text-xs font-medium",children:"Date Completed"}),e.jsx(B,{id:"date_completed",type:"date",value:m.date_completed,onChange:x=>y({...m,date_completed:x.target.value}),className:"h-8 text-sm"})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"status",className:"text-xs font-medium",children:"Status"}),e.jsxs(re,{value:m.status,onValueChange:x=>y({...m,status:x}),children:[e.jsx(se,{className:"h-8 text-sm",children:e.jsx(ne,{})}),e.jsx(ae,{children:hc.map(x=>e.jsx(w,{value:x.value,children:x.label},x.value))})]})]})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"remarks",className:"text-xs font-medium",children:"Remarks"}),e.jsx(rs,{id:"remarks",value:m.remarks,onChange:x=>y({...m,remarks:x.target.value}),placeholder:"Enter any remarks",rows:2,className:"text-sm resize-none"})]})]}),e.jsxs(nt,{className:"pt-3 flex-col sm:flex-row gap-2",children:[e.jsx($,{type:"button",variant:"outline",onClick:k,className:"h-8 px-4 text-sm w-full sm:w-auto",children:"Cancel"}),e.jsx($,{type:"submit",disabled:n,className:"h-8 px-4 text-sm w-full sm:w-auto",children:n?"Saving...":a?"Update":"Save"})]})]})]})})},gc=()=>{const r=ut(),[t,s]=p.useState(""),[a,n]=p.useState(!1),[i,c]=p.useState(null),[u,d]=p.useState([]),[o,m]=p.useState({show:!1,message:"",type:"success"}),[y,N]=p.useState("all"),[v,_]=p.useState("all"),[C,g]=p.useState("all"),[S,D]=p.useState({from:"",to:""}),[I,E]=p.useState(1),[q,U]=p.useState(50),{tasks:O,isLoading:ee,error:L,refetch:P}=qn(),{createTask:h,updateTask:k,deleteTask:x}=$l(),{config:T}=Rt("production-tasks"),{validationRules:b,canImport:R}=qt("production-tasks"),{currentSort:Y,handleSort:M,getSortedData:J}=as(),{data:V}=us(),{data:le}=Ba(),{data:ge}=As(),{toast:we}=Fe(),{data:H}=fe({queryKey:["production-tasks","all"],queryFn:()=>zt.getAll()}),de=(l,W)=>{m({show:!0,message:l,type:W}),setTimeout(()=>m({show:!1,message:"",type:"success"}),3e3)},Ne=O.filter(l=>{const W=l.task_id.toLowerCase().includes(t.toLowerCase())||l.raw_product_name.toLowerCase().includes(t.toLowerCase())||l.staff_name.toLowerCase().includes(t.toLowerCase())||l.process_name.toLowerCase().includes(t.toLowerCase()),f=y==="all"||l.raw_product_name.toLowerCase().includes(y.toLowerCase()),z=v==="all"||l.process_name.toLowerCase().includes(v.toLowerCase()),ue=C==="all"||l.staff_name.toLowerCase().includes(C.toLowerCase()),xe=(!S.from||l.date>=S.from)&&(!S.to||l.date<=S.to);return W&&f&&z&&ue&&xe}),Le=Array.from(new Set(O.map(l=>l.raw_product_name))).sort(),mt=Array.from(new Set(O.map(l=>l.process_name))).sort(),ye=Array.from(new Set(O.map(l=>l.staff_name))).sort(),Pe=Ne.length,Be=Math.ceil(Pe/q),Ke=(I-1)*q,Je=Ke+q,bt=Ne.slice(Ke,Je);p.useEffect(()=>{E(1)},[t,y,v,C,S,q]);const Lt=async l=>{try{i?(await k.mutateAsync({id:i.$id,taskData:l.taskData,stockItems:l.stockItems}),de("Production task updated successfully","success")):(await h.mutateAsync(l),de("Production task created successfully","success")),n(!1),c(null)}catch(W){console.error("Error saving task:",W),de("Failed to save task","error")}},ht=l=>{c(l),n(!0)},xt=async l=>{if(window.confirm("Are you sure you want to delete this task?"))try{await x.mutateAsync(l.$id),de("Production task deleted successfully","success")}catch(W){console.error("Error deleting task:",W),de("Failed to delete task","error")}},Nt=async()=>{if(u.length===0){de("Please select tasks to delete","error");return}if(window.confirm(`Are you sure you want to delete ${u.length} selected task(s)?`))try{await Promise.all(u.map(l=>x.mutateAsync(l.$id))),d([]),de(`${u.length} tasks deleted successfully`,"success")}catch(l){console.error("Error deleting tasks:",l),de("Failed to delete selected tasks","error")}},wt=()=>{if(u.length===0){de("Please select tasks to export","error");return}de(`Exporting ${u.length} selected task(s)...`,"success")};return L?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Production Tasks"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage production processing tasks"})]}),e.jsx(G,{children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"text-center py-12 text-red-600",children:[e.jsx("p",{className:"text-lg mb-2",children:"Error loading tasks"}),e.jsx("p",{className:"text-sm mb-4",children:L.message}),e.jsx($,{onClick:()=>P(),variant:"outline",children:"Retry"})]})})})]}):e.jsxs("div",{className:"space-y-6",children:[o.show&&e.jsx("div",{className:`fixed top-4 right-4 px-4 py-2 rounded-md shadow-lg z-50 ${o.type==="success"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300"}`,children:o.message}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Production Tasks"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage production processing tasks"})]}),e.jsxs($,{className:"bg-primary hover:bg-primary/90 w-full sm:w-auto",onClick:()=>{c(null),n(!0)},children:[e.jsx(Tt,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"sm:inline",children:"Add New"})]})]}),e.jsx(G,{children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4 items-stretch sm:items-center",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(pt,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(B,{placeholder:"Search tasks...",className:"pl-10",value:t,onChange:l=>s(l.target.value)})]}),R&&T&&e.jsx(Pt,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:T.exportColumns.filter(l=>l.required).map(l=>l.exportHeader),optionalColumns:T.exportColumns.filter(l=>!l.required).map(l=>l.exportHeader),validationRules:b,maxFileSize:50,existingData:H||[],validationHeaderMapper:l=>{const W=T.exportColumns.find(f=>f.dataKey===l);return W?W.exportHeader:l},columnMapper:l=>{const W=T.exportColumns.find(f=>f.exportHeader===l);return W?W.dataKey==="raw_product_name"?"raw_product_name":W.dataKey==="process_name"?"process_name":W.dataKey==="source_process_name"?"source_process_name":W.dataKey==="staff_name"?"staff_name":W.dataKey==="date_completed"?"date_completed":W.dataKey==="completed_quantity"?"completed_quantity":{task_id:"task_id",date:"date",assigned_quantity:"assigned_quantity",wastage_quantity:"wastage_quantity",status:"status"}[W.dataKey]||W.dataKey:l},dataProcessor:async l=>{let W=l["Raw Product"]||l.raw_product_name||l.raw_product_name;if(!W||W==="")throw new Error("Raw Product is required");const f=String(W).trim(),z=le?.find(j=>j.product_name.toLowerCase()===f.toLowerCase());if(!z){const j=le?.map(K=>K.product_name).slice(0,5).join(", ")||"None";throw new Error(`Raw Product "${f}" not found. Available: ${j}`)}const ue=z.$id;let xe=l.Process||l.process_name||l.process_name;if(!xe||xe==="")throw new Error("Process is required");const qe=String(xe).trim(),$e=V?.find(j=>j.process_name.toLowerCase()===qe.toLowerCase());if(!$e){const j=V?.map(K=>K.process_name).slice(0,5).join(", ")||"None";throw new Error(`Process "${qe}" not found. Available: ${j}`)}const Me=$e.$id;let A="",he=l["Staff Name"]||l.staff_name||l.staff_name;if(he&&he!==""){const j=String(he).trim(),K=ge?.find(te=>te.staff_name.toLowerCase()===j.toLowerCase());K&&(A=K.$id)}if(!A&&ge&&ge.length>0&&(A=ge[0].$id),!A)throw new Error("Staff is required. Please ensure staff data is available.");let ve="",je=l["Source Process"]||l.source_process_name||l.source_process_name;if(je&&je!==""){const j=String(je).trim(),K=V?.find(te=>te.process_name.toLowerCase()===j.toLowerCase());K&&(ve=K.$id)}if(!ve){const j=V?.find(K=>K.process_name.toLowerCase()==="rfp");j?ve=j.$id:V&&V.length>0&&(ve=V[0].$id)}if(!ve)throw new Error("Source Process is required. Please ensure process data is available.");const gt=j=>{if(!j||j==="")return"";let K=j;if(typeof j=="string"){const te=j.match(/^(\d{2})-(\d{2})-(\d{4})$/);if(te){const[,ce,Se,Ce]=te,Re=new Date(parseInt(Ce),parseInt(Se)-1,parseInt(ce));isNaN(Re.getTime())||(K=Re.toISOString().split("T")[0])}else{const ce=new Date(j);isNaN(ce.getTime())||(K=ce.toISOString().split("T")[0])}}else j instanceof Date&&(K=j.toISOString().split("T")[0]);return K};let Te=l.Date||l.date||l.date||new Date().toISOString().split("T")[0];Te=gt(Te)||new Date().toISOString().split("T")[0];let _e=l["Date Completed"]||l.date_completed||l.date_completed||Te;_e=gt(_e)||Te;const Oe=l["Completed Qty"]||l.completed_quantity||l.completed_quantity,Ue=Oe!=null&&Oe!==""?parseFloat(String(Oe)):void 0,Ie={task_id:l["Task ID"]||l.task_id||l.task_id,date:Te,raw_product_id:ue,process_id:Me,staff_id:A,source_process_id:ve,assigned_quantity:parseFloat(l["Assigned Qty"]||l.assigned_quantity||l.assigned_quantity||0),wastage_quantity:parseFloat(l["Wastage Qty"]||l.wastage_quantity||l.wastage_quantity||0),status:"completed"};return Ue!==void 0&&!isNaN(Ue)&&(Ie.completed_quantity=Ue),_e&&(Ie.date_completed=_e),await zt.create(Ie)},onImportComplete:async l=>{await r.invalidateQueries({queryKey:["production-tasks"],refetchType:"active"}),await r.refetchQueries({queryKey:["production-tasks"]}),P(),l.successfulRows>0&&we({title:"Import Successful",description:`${l.successfulRows} production tasks imported successfully.`}),l.failedRows>0&&we({title:"Import Completed with Errors",description:`${l.successfulRows} successful, ${l.failedRows} failed.`,variant:"destructive"})}},variant:"outline"}),T&&e.jsx(Ct,{data:Ne.map(l=>{const W={};return T.exportColumns.forEach(f=>{const z=l[f.dataKey];W[f.exportHeader]=f.formatter?f.formatter(z):z}),W}),headers:T.exportColumns.map(l=>l.exportHeader),filename:"production-tasks",variant:"outline"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-3 sm:gap-4",children:[e.jsxs(re,{value:y,onValueChange:N,children:[e.jsx(se,{className:"w-full",children:e.jsx(ne,{placeholder:"Raw Product"})}),e.jsxs(ae,{children:[e.jsx(w,{value:"all",children:"All Raw Products"}),Le.map(l=>e.jsx(w,{value:l,children:l},l))]})]}),e.jsxs(re,{value:v,onValueChange:_,children:[e.jsx(se,{className:"w-full",children:e.jsx(ne,{placeholder:"Process"})}),e.jsxs(ae,{children:[e.jsx(w,{value:"all",children:"All Processes"}),mt.map(l=>e.jsx(w,{value:l,children:l},l))]})]}),e.jsxs(re,{value:C,onValueChange:g,children:[e.jsx(se,{className:"w-full",children:e.jsx(ne,{placeholder:"Staff Name"})}),e.jsxs(ae,{children:[e.jsx(w,{value:"all",children:"All Staff"}),ye.map(l=>e.jsx(w,{value:l,children:l},l))]})]}),e.jsx(B,{type:"date",placeholder:"From Date",className:"w-full",value:S.from,onChange:l=>D(W=>({...W,from:l.target.value}))}),e.jsx(B,{type:"date",placeholder:"To Date",className:"w-full",value:S.to,onChange:l=>D(W=>({...W,to:l.target.value}))})]})]})})}),e.jsx(G,{children:e.jsxs(Z,{className:"pt-6",children:[u.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 p-3 bg-muted rounded-md",children:[e.jsxs("span",{className:"text-sm font-medium",children:[u.length," selected"]}),e.jsx($,{variant:"destructive",size:"sm",onClick:Nt,children:"Delete Selected"}),e.jsx($,{variant:"outline",size:"sm",onClick:wt,children:"Export Selected"})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",Ke+1," to ",Math.min(Je,Pe)," of ",Pe," records"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Records per page:"}),e.jsxs(re,{value:q.toString(),onValueChange:l=>U(Number(l)),children:[e.jsx(se,{className:"w-[100px]",children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(w,{value:"50",children:"50"}),e.jsx(w,{value:"100",children:"100"}),e.jsx(w,{value:"500",children:"500"})]})]})]})]}),e.jsx("div",{className:"border rounded-md",children:e.jsx("div",{className:"overflow-auto",style:{maxHeight:"600px"},children:e.jsx(ds,{data:J(bt.map(l=>({...l,formattedDate:new Date(l.date).toLocaleDateString("en-GB")}))),columns:[{key:"task_id",label:"Task ID",sortable:!0,dataType:"string"},{key:"formattedDate",label:"Date",sortable:!0,dataType:"date"},{key:"raw_product_name",label:"Raw Product",sortable:!0,dataType:"string"},{key:"process_name",label:"Process",sortable:!0,dataType:"string"},{key:"staff_name",label:"Staff Name",sortable:!0,dataType:"string"},{key:"assigned_quantity",label:"Assigned Qty",sortable:!0,dataType:"number",align:"right",headerClassName:"bg-purple-50",cellClassName:"bg-purple-50 font-medium"},{key:"completed_quantity",label:"Completed Qty",sortable:!0,dataType:"number",align:"right",headerClassName:"bg-green-50",cellClassName:"bg-green-50 font-medium"},{key:"wastage_quantity",label:"Wastage Qty",sortable:!0,dataType:"number",align:"right"},{key:"status",label:"Status",sortable:!0,dataType:"string",formatter:l=>e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${l==="completed"?"bg-green-100 text-green-800":l==="in_progress"?"bg-yellow-100 text-yellow-800":l==="pending"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:l==="in_progress"?"In Progress":l.charAt(0).toUpperCase()+l.slice(1)})}],onSort:M,currentSort:Y,loading:ee,maxHeight:"none",stickyHeader:!0,bordered:!1,searchable:!1,selectable:!0,selectedRows:u,onSelectionChange:d,rowKey:"$id",actions:[Ts.edit(l=>ht(l)),Ts.delete(l=>xt(l))],emptyMessage:"No production tasks found"})})}),Be>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx($,{variant:"outline",size:"sm",onClick:()=>E(l=>Math.max(1,l-1)),disabled:I===1,children:"Previous"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",I," of ",Be]})}),e.jsx($,{variant:"outline",size:"sm",onClick:()=>E(l=>Math.min(Be,l+1)),disabled:I===Be,children:"Next"})]})]})}),e.jsx(xc,{isOpen:a,onClose:()=>{n(!1),c(null)},onSubmit:Lt,editingTask:i,isLoading:h.isPending||k.isPending})]})},fc=[{value:"pending",label:"Pending"},{value:"in_progress",label:"In Progress"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"}],jc=({isOpen:r,onClose:t,onSubmit:s,editingTask:a,isLoading:n=!1})=>{const{data:i}=As(),{data:c}=us(),{data:u}=Ln(),{data:d}=Ba(),[o,m]=p.useState({task_id:"",date_assigned:new Date().toISOString().split("T")[0],date_completed:"",raw_product_id:"",source_process_id:"",source_quantity:"",sku:"",product_id:"",process_id:"",staff_id:"",completed_quantity:"",wastage_quantity:"",remarks:"",status:"pending"}),[y,N]=p.useState({}),[v,_]=p.useState(null),C=new Date,g=es(C),S=Zt(C),{statusRecords:D}=Mn(g.toISOString().split("T")[0],S.toISOString().split("T")[0]),{statusRecords:I}=Ha(g.toISOString().split("T")[0],S.toISOString().split("T")[0]),E=()=>{if(!o.source_process_id||!o.source_quantity||!o.product_id){_(null);return}const b=parseFloat(o.source_quantity);if(b<=0){_({isValid:!1,availableQty:0,requiredQty:b,stockName:"Source Material",stockSource:"Unknown",error:"Invalid quantity",validationClass:"bg-yellow-50 text-yellow-700 border-yellow-200",validationMessage:"Source quantity must be greater than 0"});return}const R=c?.find(Ne=>Ne.$id===o.source_process_id),Y=u?.find(Ne=>Ne.$id===o.product_id);if(!R||!Y){_({isValid:!1,availableQty:0,requiredQty:b,stockName:Y?.product_name||"Unknown Product",stockSource:R?.process_name||"Unknown Process",error:"Missing reference data",validationClass:"bg-red-50 text-red-700 border-red-200",validationMessage:"Source process or product not found"});return}let M="",J=null,V=0;const le=R.process_name?.toLowerCase();if(le==="grinding"){M="Production Status";const Ne=Y.product_name;if(J=I?.find(Le=>Le.stock_name===Ne&&Le.process===R.process_name),!J&&Ne){const Le=Ne.toLowerCase().split(" ")[0];J=I?.find(mt=>mt.stock_name?.toLowerCase().includes(Le)&&mt.process===R.process_name)}J||(J=I?.find(Le=>Le.process===R.process_name&&(Le.stock_name?.toLowerCase().includes("chilli")||Le.stock_name?.toLowerCase().includes("powder"))))}else le==="packing"&&(M="Post-Production Status",J=D?.find(Ne=>Ne.product_name===Y.product_name&&Ne.process_name===R.process_name));V=J?.closing_balance??0;const ge=V>=b;console.log("ðŸ” RTQV Post-Production Status Check (Enhanced):",{product_name:Y.product_name,source_process:R.process_name,source_process_type:le,statusRecord_found:!!J,statusRecord_stock_name:J?.stock_name,statusRecord_process:J?.process,closing_balance:J?.closing_balance,availableQty:V,requiredQty:b,dataSource:M,forced_fresh:!0,all_production_records:le==="grinding"?I?.map(Ne=>({stock_name:Ne.stock_name,process:Ne.process,closing_balance:Ne.closing_balance})):[],all_postproduction_records:le==="packing"?D?.map(Ne=>({product_name:Ne.product_name,process_name:Ne.process_name,closing_balance:Ne.closing_balance})):[]});let we="",H="";const de=le==="grinding"?"kg":"units";ge?(we="bg-green-50 text-green-700 border-green-200",H=`âœ“ Available: ${V}${de} (Required: ${b}${de})`):V===0?(we="bg-red-50 text-red-700 border-red-200",H=`âœ— Out of stock (Required: ${b}${de})`):(we="bg-orange-50 text-orange-700 border-orange-200",H=`âš  Insufficient stock: ${V}${de} available (Required: ${b}${de})`),_({isValid:ge,availableQty:V,requiredQty:b,stockName:Y.product_name,stockSource:R.process_name,dataSource:M,isLoading:!1,validationClass:we,validationMessage:H})};p.useEffect(()=>{E()},[o.source_process_id,o.product_id,o.source_quantity,c,u,D,I]);const q=c.filter(b=>{const R=b.department?.toLowerCase();if(R&&R==="post-production")return!0;const Y=b.process_name?.toLowerCase();return["packing","batch coding"].includes(Y)});console.log("All Processes:",c.map(b=>b.process_name)),console.log("Post Production Processes:",q.map(b=>b.process_name));const U=c.find(b=>b.$id===o.process_id),O=U?.process_name==="Batch Coding",ee=U?.process_name==="Packing",L=()=>O,h=(()=>{if(!o.process_id)return[];const b=c.find(Y=>Y.$id===o.process_id);if(!b)return[];const R=b.process_name?.toLowerCase();return R==="packing"?c.filter(Y=>Y.process_name?.toLowerCase()==="grinding"):R==="batch coding"?c.filter(Y=>Y.process_name?.toLowerCase()==="packing"):[]})();p.useEffect(()=>{o.process_id&&(m(b=>({...b,source_process_id:"",source_quantity:O?"":b.source_quantity,raw_product_id:O?"":b.raw_product_id})),console.log("Selected Process:",U?.process_name),console.log("Is Batch Coding:",O))},[o.process_id,c,O,U]),p.useEffect(()=>{if(r)if(a){const b=R=>{if(!R)return"";try{const Y=new Date(R);return isNaN(Y.getTime())?"":Y.toISOString().split("T")[0]}catch{return""}};m({task_id:a.task_id,date_assigned:b(a.date),date_completed:b(a.date_completed||""),raw_product_id:a.raw_product_id||"",source_process_id:a.source_process_id,source_quantity:a.source_quantity.toString(),sku:a.sku,product_id:a.product_id,process_id:a.process_id,staff_id:a.staff_id,completed_quantity:a.units?.toString()||"",wastage_quantity:a.wastage_quantity?.toString()||"",remarks:a.remarks||"",status:a.status})}else{const b=`POST${Date.now().toString().slice(-6)}`;m({task_id:b,date_assigned:new Date().toISOString().split("T")[0],date_completed:"",raw_product_id:"",source_process_id:"",source_quantity:"",sku:"",product_id:"",process_id:"",staff_id:"",completed_quantity:"",wastage_quantity:"",remarks:"",status:"pending"})}},[a,r]);const k=()=>{const b={},Y=c.find(M=>M.$id===o.process_id)?.process_name==="Batch Coding";return o.task_id.trim()||(b.task_id="Task ID is required"),o.date_assigned||(b.date_assigned="Date is required"),!Y&&!o.raw_product_id&&(b.raw_product_id="Raw Product is required"),o.process_id||(b.process_id="Process is required"),o.source_process_id||(b.source_process_id="Source process is required"),!Y&&(!o.source_quantity||parseFloat(o.source_quantity)<=0)&&(b.source_quantity="Source quantity must be greater than 0"),o.sku.trim()||(b.sku="SKU is required"),o.product_id||(b.product_id="Product is required"),o.staff_id||(b.staff_id="Staff is required"),o.status==="completed"&&((!o.completed_quantity||parseFloat(o.completed_quantity)<=0)&&(b.completed_quantity="Completed units must be greater than 0"),o.wastage_quantity&&parseFloat(o.wastage_quantity)<0&&(b.wastage_quantity="Wastage quantity cannot be negative")),N(b),Object.keys(b).length===0},x=b=>{if(b.preventDefault(),!k())return;const Y=c.find(J=>J.$id===o.process_id)?.process_name==="Batch Coding",M={task_id:o.task_id,date:o.date_assigned,date_completed:o.status==="completed"?o.date_completed:void 0,source_process_id:o.source_process_id,source_quantity:Y?0:parseFloat(o.source_quantity)||0,sku:o.sku,product_id:o.product_id,process_id:o.process_id,staff_id:o.staff_id,units:o.completed_quantity?parseFloat(o.completed_quantity):0,wastage_quantity:o.status==="completed"&&o.wastage_quantity?parseFloat(o.wastage_quantity):void 0,remarks:o.remarks||void 0,status:o.status};console.log("ðŸš€ SUBMITTING POST-PRODUCTION TASK DATA:",M),s(M)},T=()=>{m({task_id:"",date_assigned:new Date().toISOString().split("T")[0],date_completed:"",raw_product_id:"",source_process_id:"",source_quantity:"",sku:"",product_id:"",process_id:"",staff_id:"",completed_quantity:"",wastage_quantity:"",remarks:"",status:"pending"}),N({}),t()};return e.jsx(ot,{open:r,onOpenChange:T,children:e.jsxs(at,{className:"sm:max-w-[600px] max-w-[95vw] max-h-[90vh] overflow-y-auto",children:[e.jsxs(rt,{children:[e.jsx(it,{children:a?"Edit Post-Production Task":"Add New Post-Production Task"}),e.jsx(lt,{children:a?"Update the post-production task details below.":"Fill in the details to create a new post-production task."})]}),e.jsxs("form",{onSubmit:x,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(F,{htmlFor:"task_id",children:"Task ID *"}),e.jsx(B,{id:"task_id",value:o.task_id,onChange:b=>m({...o,task_id:b.target.value}),className:y.task_id?"border-red-500":""}),y.task_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:y.task_id})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"date_assigned",children:"Date Assigned *"}),e.jsx(B,{id:"date_assigned",type:"date",value:o.date_assigned,onChange:b=>m({...o,date_assigned:b.target.value}),className:y.date_assigned?"border-red-500":""}),y.date_assigned&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:y.date_assigned})]})]}),e.jsxs("div",{children:[e.jsxs(F,{htmlFor:"raw_product_id",children:["Raw Product ",!O&&"*",O&&e.jsx("span",{className:"text-muted-foreground",children:"(N/A for Batch Coding)"})]}),O?e.jsx(B,{value:"N/A",disabled:!0,className:"bg-gray-100 text-muted-foreground"}):e.jsxs(re,{value:o.raw_product_id,onValueChange:b=>m({...o,raw_product_id:b}),children:[e.jsx(se,{className:y.raw_product_id?"border-red-500":"",children:e.jsx(ne,{placeholder:"Select Raw Product"})}),e.jsx(ae,{children:d?.map(b=>e.jsx(w,{value:b.$id||"",children:b.raw_product},b.$id))})]}),y.raw_product_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:y.raw_product_id}),e.jsx("p",{className:"text-muted-foreground text-xs mt-1",children:O?"Batch Coding works with finished products (units), not raw products":"Select the raw product powder (kg) from Grinding process to be packed into units"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(F,{htmlFor:"process_id",children:"Process *"}),e.jsxs(re,{value:o.process_id,onValueChange:b=>m({...o,process_id:b,source_process_id:""}),children:[e.jsx(se,{className:y.process_id?"border-red-500":"",children:e.jsx(ne,{placeholder:"Select Process"})}),e.jsx(ae,{children:q.map(b=>e.jsx(w,{value:b.$id||"",children:b.process_name},b.$id))})]}),y.process_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:y.process_id})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"source_process_id",children:"Source Process *"}),e.jsxs(re,{value:o.source_process_id,onValueChange:b=>m({...o,source_process_id:b}),children:[e.jsx(se,{className:y.source_process_id?"border-red-500":"",disabled:!o.process_id,children:e.jsx(ne,{placeholder:o.process_id?"Select Source Process":"First select a Process"})}),e.jsx(ae,{children:h.map(b=>e.jsx(w,{value:b.$id||"",children:b.process_name},b.$id))})]}),y.source_process_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:y.source_process_id})]})]}),e.jsxs("div",{children:[e.jsxs(F,{htmlFor:"source_quantity",children:[ee?"Source Qty (kg) *":"Source Qty"," ",!L()&&!ee&&"*"]}),e.jsx(B,{id:"source_quantity",type:"number",step:"0.01",min:"0",value:L()?"N/A":o.source_quantity,onChange:b=>!L()&&m({...o,source_quantity:b.target.value}),className:y.source_quantity?"border-red-500":"",disabled:L(),placeholder:L()?"N/A":ee?"Raw product quantity in kg":"Enter source quantity"}),y.source_quantity&&!L()&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:y.source_quantity}),L()&&e.jsx("p",{className:"text-muted-foreground text-xs mt-1",children:"Source quantity is not required for Batch Coding"}),ee&&e.jsx("p",{className:"text-muted-foreground text-xs mt-1",children:"Raw product powder quantity from Grinding process"}),v&&!L()&&e.jsxs("div",{className:`mt-2 p-3 rounded-md border text-sm ${v.validationClass}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("div",{className:"font-medium",children:v.stockName}),e.jsxs("div",{className:"text-xs opacity-75",children:["Source: ",v.dataSource]})]}),e.jsx("div",{className:"mb-1",children:v.validationMessage}),v.error&&e.jsxs("div",{className:"text-xs mt-1 opacity-75",children:["Error: ",v.error]}),v.isLoading&&e.jsxs("div",{className:"flex items-center gap-2 text-xs mt-1",children:[e.jsx("div",{className:"animate-spin h-3 w-3 border border-current border-t-transparent rounded-full"}),"Loading fresh data from ",v.dataSource,"..."]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(F,{htmlFor:"sku",children:"SKU *"}),e.jsx(B,{id:"sku",value:o.sku,onChange:b=>m({...o,sku:b.target.value}),className:y.sku?"border-red-500":"",placeholder:"Enter SKU"}),y.sku&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:y.sku})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"product_id",children:"Product *"}),e.jsxs(re,{value:o.product_id,onValueChange:b=>m({...o,product_id:b}),children:[e.jsx(se,{className:y.product_id?"border-red-500":"",children:e.jsx(ne,{placeholder:"Select Product"})}),e.jsx(ae,{children:u.map(b=>e.jsx(w,{value:b.$id||"",children:b.product},b.$id))})]}),y.product_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:y.product_id})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(F,{htmlFor:"staff_id",children:"Staff Name *"}),e.jsxs(re,{value:o.staff_id,onValueChange:b=>m({...o,staff_id:b}),children:[e.jsx(se,{className:y.staff_id?"border-red-500":"",children:e.jsx(ne,{placeholder:"Select Staff"})}),e.jsx(ae,{children:i.map(b=>e.jsx(w,{value:b.$id||"",children:b.staff_name},b.$id))})]}),y.staff_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:y.staff_id})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"status",children:"Status"}),e.jsxs(re,{value:o.status,onValueChange:b=>m({...o,status:b}),children:[e.jsx(se,{children:e.jsx(ne,{})}),e.jsx(ae,{children:fc.map(b=>e.jsx(w,{value:b.value,children:b.label},b.value))})]})]})]}),o.status==="completed"&&e.jsxs("div",{className:"grid grid-cols-3 gap-4 p-4 border rounded-md bg-muted/50",children:[e.jsxs("div",{children:[e.jsx(F,{htmlFor:"date_completed",children:"Date Completed *"}),e.jsx(B,{id:"date_completed",type:"date",value:o.date_completed,onChange:b=>m({...o,date_completed:b.target.value}),className:y.date_completed?"border-red-500":""}),y.date_completed&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:y.date_completed})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"completed_quantity",children:"Completed Units *"}),e.jsx(B,{id:"completed_quantity",type:"number",step:"0.01",min:"0",value:o.completed_quantity,onChange:b=>m({...o,completed_quantity:b.target.value}),className:y.completed_quantity?"border-red-500":"",placeholder:"Enter completed units"}),y.completed_quantity&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:y.completed_quantity})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"wastage_quantity",children:"Wastage Qty"}),e.jsx(B,{id:"wastage_quantity",type:"number",step:"0.01",min:"0",value:o.wastage_quantity,onChange:b=>m({...o,wastage_quantity:b.target.value}),className:y.wastage_quantity?"border-red-500":"",placeholder:"Enter wastage qty (optional)"}),y.wastage_quantity&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:y.wastage_quantity})]})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"remarks",children:"Remarks"}),e.jsx(rs,{id:"remarks",value:o.remarks,onChange:b=>m({...o,remarks:b.target.value}),placeholder:"Enter any remarks",rows:3})]})]}),e.jsxs(nt,{className:"flex-col sm:flex-row gap-2 pt-4",children:[e.jsx($,{type:"button",variant:"outline",onClick:T,className:"w-full sm:w-auto",children:"Cancel"}),e.jsx($,{type:"submit",disabled:n,className:"w-full sm:w-auto",children:n?"Saving...":a?"Update":"Save"})]})]})]})})},yc=()=>{const r=ut(),[t,s]=p.useState(""),[a,n]=p.useState(!1),[i,c]=p.useState(null),[u,d]=p.useState([]),[o,m]=p.useState({show:!1,message:"",type:"success"}),[y,N]=p.useState("all"),[v,_]=p.useState("all"),[C,g]=p.useState("all"),[S,D]=p.useState({from:"",to:""}),[I,E]=p.useState(1),[q,U]=p.useState(50),{tasks:O,isLoading:ee,error:L,refetch:P}=An(),{createTask:h,updateTask:k,deleteTask:x}=Ll(),{config:T}=Rt("post-production-tasks"),{validationRules:b,canImport:R}=qt("post-production-tasks"),{currentSort:Y,handleSort:M,getSortedData:J}=as(),{data:V}=us(),{data:le}=Ln(),{data:ge}=As(),{toast:we}=Fe(),{data:H}=fe({queryKey:["post-production-tasks","all"],queryFn:()=>Xt.getAll()}),de=(l,W)=>{m({show:!0,message:l,type:W}),setTimeout(()=>m({show:!1,message:"",type:"success"}),3e3)},Ne=O.filter(l=>{const W=l.task_id.toLowerCase().includes(t.toLowerCase())||l.product_name.toLowerCase().includes(t.toLowerCase())||l.staff_name.toLowerCase().includes(t.toLowerCase())||l.process_name.toLowerCase().includes(t.toLowerCase())||l.stock_name&&l.stock_name.toLowerCase().includes(t.toLowerCase())||l.sku&&l.sku.toLowerCase().includes(t.toLowerCase()),f=y==="all"||l.product_name.toLowerCase().includes(y.toLowerCase()),z=v==="all"||l.process_name.toLowerCase().includes(v.toLowerCase()),ue=C==="all"||l.staff_name.toLowerCase().includes(C.toLowerCase()),xe=(!S.from||l.date_assigned>=S.from)&&(!S.to||l.date_assigned<=S.to);return W&&f&&z&&ue&&xe}),Le=Array.from(new Set(O.map(l=>l.product_name))).sort(),mt=Array.from(new Set(O.map(l=>l.process_name))).sort(),ye=Array.from(new Set(O.map(l=>l.staff_name))).sort(),Pe=Ne.length,Be=Math.ceil(Pe/q),Ke=(I-1)*q,Je=Ke+q,bt=Ne.slice(Ke,Je);p.useEffect(()=>{E(1)},[t,y,v,C,S,q]);const Lt=async l=>{try{const W=V.find(z=>z.$id===l.process_id),f=W?.process_name?.toLowerCase()||"packing";if(console.log("ðŸ” Post-production task validation data:",{isEdit:!!i,processId:l.process_id,selectedProcess:W,processName:f,rawProductId:l.product_id,sourceProcessId:l.source_process_id,sourceQuantity:l.source_quantity,productId:l.product_id,allData:l}),i){const z=i.source_quantity||0,ue=parseFloat(l.source_quantity)||0,xe=ue-z;if(console.log("ðŸ”„ Post-production task edit validation:",{originalQuantity:z,newQuantity:ue,quantityDifference:xe,needsValidation:xe>0}),xe<=0)await k.mutateAsync({id:i.$id,data:l}),de("Post-production task updated successfully","success"),n(!1),c(null);else{const $e=V.find(ve=>ve.$id===l.source_process_id)?.process_name||"Grinding",Me=f==="batch_coding"||f==="batch coding",A=parseFloat(l.source_quantity)||0;console.log("ðŸš¨ POST-PRODUCTION EDIT VALIDATION TRIGGERED:",{processName:f,sourceProcess:$e,rawProductId:l.product_id,sourceQuantity:l.source_quantity,quantityToValidate:A,newQuantity:ue,productId:l.product_id});const he=await validateTaskCreation(f,$e,A,void 0,l.product_id,async ve=>{const je=ve?{...l,source_quantity:ve}:l;console.log("ðŸ”„ UPDATING POST-PRODUCTION TASK WITH ADJUSTED QUANTITY:",je),await k.mutateAsync({id:i.$id,data:je}),de("Post-production task updated successfully","success"),n(!1),c(null)});console.log("ðŸ” POST-PRODUCTION EDIT VALIDATION RESULT:",he)}}else{const ue=V.find(Me=>Me.$id===l.source_process_id)?.process_name||"Grinding",xe=f==="batch_coding"||f==="batch coding",qe=parseFloat(l.source_quantity)||0;console.log("ðŸ” PROCESS TYPE DEBUG:",{processName:f,isBatchCoding:xe,sourceQuantity:l.source_quantity,quantityToValidate:qe}),console.log("ðŸš¨ POST-PRODUCTION NEW TASK VALIDATION:",{processName:f,sourceProcess:ue,rawProductId:l.product_id,sourceQuantity:l.source_quantity,quantityToValidate:qe,productId:l.product_id});const $e=l;await h.mutateAsync($e),de("Post-production task created successfully","success"),n(!1),c(null)}}catch(W){console.error("Error saving task:",W),de("Failed to save task","error")}},ht=l=>{c(l),n(!0)},xt=async l=>{if(window.confirm("Are you sure you want to delete this task?"))try{await x.mutateAsync(l.$id),de("Post-production task deleted successfully","success")}catch(W){console.error("Error deleting task:",W),de("Failed to delete task","error")}},Nt=async()=>{if(u.length===0){de("Please select tasks to delete","error");return}if(window.confirm(`Are you sure you want to delete ${u.length} selected task(s)?`))try{await Promise.all(u.map(l=>x.mutateAsync(l.$id))),d([]),de(`${u.length} tasks deleted successfully`,"success")}catch(l){console.error("Error deleting tasks:",l),de("Failed to delete selected tasks","error")}},wt=()=>{if(u.length===0){de("Please select tasks to export","error");return}de(`Exporting ${u.length} selected task(s)...`,"success")};return L?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Post-Production Tasks"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage post-production processing tasks"})]}),e.jsx(G,{children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"text-center py-12 text-red-600",children:[e.jsx("p",{className:"text-lg mb-2",children:"Error loading tasks"}),e.jsx("p",{className:"text-sm mb-4",children:L.message}),e.jsx($,{onClick:()=>P(),variant:"outline",children:"Retry"})]})})})]}):e.jsxs("div",{className:"space-y-6",children:[o.show&&e.jsx("div",{className:`fixed top-4 right-4 px-4 py-2 rounded-md shadow-lg z-50 ${o.type==="success"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300"}`,children:o.message}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Post-Production Tasks"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage post-production processing tasks"})]}),e.jsxs($,{className:"bg-primary hover:bg-primary/90",onClick:()=>{c(null),n(!0)},children:[e.jsx(Tt,{className:"h-4 w-4 mr-2"}),"Add New"]})]}),e.jsx(G,{children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(pt,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(B,{placeholder:"Search tasks...",className:"pl-10",value:t,onChange:l=>s(l.target.value)})]}),R&&T&&e.jsx(Pt,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:T.exportColumns.filter(l=>l.required).map(l=>l.exportHeader),optionalColumns:T.exportColumns.filter(l=>!l.required).map(l=>l.exportHeader),validationRules:b,maxFileSize:50,existingData:H||[],validationHeaderMapper:l=>{const W=T.exportColumns.find(f=>f.dataKey===l);return W?W.exportHeader:l},columnMapper:l=>{const W=T.exportColumns.find(f=>f.exportHeader===l);return W?W.dataKey==="product_name"?"product_name":W.dataKey==="sku"?"sku":W.dataKey==="process_name"?"process_name":W.dataKey==="staff_name"?"staff_name":{task_id:"task_id",date:"date",date_completed:"date_completed",source_quantity:"source_quantity",assigned_quantity:"assigned_quantity",units:"units",wastage_quantity:"wastage_quantity",remarks:"remarks",status:"status"}[W.dataKey]||W.dataKey:l},dataProcessor:async l=>{let W=l.Product||l.product_name||l.product_name,f=l.SKU||l.sku||l.sku;if(!W||W==="")throw new Error("Product is required");const z=String(W).trim(),ue=le?.find(Te=>Te.product&&Te.product.toLowerCase()===z.toLowerCase()||Te.sku&&Te.sku.toLowerCase()===(f||"").toLowerCase());if(!ue){const Te=le?.map(_e=>_e.product||_e.sku).slice(0,5).join(", ")||"None";throw new Error(`Product "${z}" not found. Available: ${Te}`)}const xe=ue.$id;let qe=l.Process||l.process_name||l.process_name;if(!qe||qe==="")throw new Error("Process is required");const $e=String(qe).trim(),Me=V?.find(Te=>Te.process_name.toLowerCase()===$e.toLowerCase());if(!Me){const Te=V?.map(_e=>_e.process_name).slice(0,5).join(", ")||"None";throw new Error(`Process "${$e}" not found. Available: ${Te}`)}const A=Me.$id;let he="",ve=l["Staff Name"]||l.staff_name||l.staff_name;if(ve&&ve!==""){const Te=String(ve).trim(),_e=ge?.find(Oe=>Oe.staff_name.toLowerCase()===Te.toLowerCase());_e&&(he=_e.$id)}let je=l["Date Assigned"]||l.Date||l.date_assigned||l.date||new Date().toISOString().split("T")[0];if(je&&typeof je=="string"){const Te=je.match(/^(\d{2})-(\d{2})-(\d{4})$/);if(Te){const[,_e,Oe,Ue]=Te,Ie=new Date(parseInt(Ue),parseInt(Oe)-1,parseInt(_e));isNaN(Ie.getTime())||(je=Ie.toISOString().split("T")[0])}else{const _e=new Date(je);isNaN(_e.getTime())||(je=_e.toISOString().split("T")[0])}}else je instanceof Date&&(je=je.toISOString().split("T")[0]);const gt={task_id:l["Task ID"]||l.task_id||l.task_id,date:je,source_process_id:A,source_quantity:parseFloat(l["Source Qty"]||l.source_quantity||l.source_quantity||0),sku:f||ue.sku||"",product_id:xe,process_id:A,staff_id:he||"",assigned_quantity:parseFloat(l["Assigned Units"]||l.assigned_quantity||l.assigned_quantity||0),units:parseFloat(l["Completed Units"]||l.units||l.units||0),wastage_quantity:parseFloat(l["Wastage Qty"]||l.wastage_quantity||l.wastage_quantity||0),remarks:l.Remarks||l.remarks||l.remarks||"",status:"completed"};return await Xt.create(gt)},onImportComplete:async l=>{await r.invalidateQueries({queryKey:["post-production-tasks"],refetchType:"active"}),await r.refetchQueries({queryKey:["post-production-tasks"]}),P(),l.successfulRows>0&&we({title:"Import Successful",description:`${l.successfulRows} post-production tasks imported successfully.`}),l.failedRows>0&&we({title:"Import Completed with Errors",description:`${l.successfulRows} successful, ${l.failedRows} failed.`,variant:"destructive"})}},variant:"outline"}),T&&e.jsx(Ct,{data:Ne.map(l=>{const W={};return T.exportColumns.forEach(f=>{const z=l[f.dataKey];W[f.exportHeader]=f.formatter?f.formatter(z):z}),W}),headers:T.exportColumns.map(l=>l.exportHeader),filename:"post-production-tasks",variant:"outline"})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs(re,{value:y,onValueChange:N,children:[e.jsx(se,{className:"w-[180px]",children:e.jsx(ne,{placeholder:"Product"})}),e.jsxs(ae,{children:[e.jsx(w,{value:"all",children:"All Products"}),Le.map(l=>e.jsx(w,{value:l,children:l},l))]})]}),e.jsxs(re,{value:v,onValueChange:_,children:[e.jsx(se,{className:"w-[180px]",children:e.jsx(ne,{placeholder:"Process"})}),e.jsxs(ae,{children:[e.jsx(w,{value:"all",children:"All Processes"}),mt.map(l=>e.jsx(w,{value:l,children:l},l))]})]}),e.jsxs(re,{value:C,onValueChange:g,children:[e.jsx(se,{className:"w-[180px]",children:e.jsx(ne,{placeholder:"Staff Name"})}),e.jsxs(ae,{children:[e.jsx(w,{value:"all",children:"All Staff"}),ye.map(l=>e.jsx(w,{value:l,children:l},l))]})]}),e.jsx(B,{type:"date",placeholder:"From Date",className:"w-[150px]",value:S.from,onChange:l=>D(W=>({...W,from:l.target.value}))}),e.jsx(B,{type:"date",placeholder:"To Date",className:"w-[150px]",value:S.to,onChange:l=>D(W=>({...W,to:l.target.value}))})]})]})})}),e.jsx(G,{children:e.jsxs(Z,{className:"pt-6",children:[u.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 p-3 bg-muted rounded-md",children:[e.jsxs("span",{className:"text-sm font-medium",children:[u.length," selected"]}),e.jsx($,{variant:"destructive",size:"sm",onClick:Nt,children:"Delete Selected"}),e.jsx($,{variant:"outline",size:"sm",onClick:wt,children:"Export Selected"})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",Ke+1," to ",Math.min(Je,Pe)," of ",Pe," records"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Records per page:"}),e.jsxs(re,{value:q.toString(),onValueChange:l=>U(Number(l)),children:[e.jsx(se,{className:"w-[100px]",children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(w,{value:"50",children:"50"}),e.jsx(w,{value:"100",children:"100"}),e.jsx(w,{value:"500",children:"500"})]})]})]})]}),e.jsx("div",{className:"border rounded-md",children:e.jsx("div",{className:"overflow-auto",style:{maxHeight:"600px"},children:e.jsx(ds,{data:J(bt),columns:[{key:"task_id",label:"Task ID",sortable:!0,dataType:"string"},{key:"date",label:"Date Assigned",sortable:!0,dataType:"date"},{key:"date_completed",label:"Date Completed",sortable:!0,dataType:"date"},{key:"source_quantity",label:"Source Qty",sortable:!0,dataType:"number",align:"right"},{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"product_name",label:"Product",sortable:!0,dataType:"string"},{key:"process_name",label:"Process",sortable:!0,dataType:"string"},{key:"staff_name",label:"Staff Name",sortable:!0,dataType:"string"},{key:"units",label:"Completed Units",sortable:!0,dataType:"number",align:"right",headerClassName:"bg-green-50",cellClassName:"bg-green-50 font-medium"},{key:"wastage_quantity",label:"Wastage Qty",sortable:!0,dataType:"number",align:"right"},{key:"remarks",label:"Remarks",sortable:!0,dataType:"string"},{key:"status",label:"Status",sortable:!0,dataType:"string",formatter:l=>e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${l==="completed"?"bg-green-100 text-green-800":l==="in_progress"?"bg-yellow-100 text-yellow-800":l==="pending"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:l==="in_progress"?"In Progress":l.charAt(0).toUpperCase()+l.slice(1)})}],onSort:M,currentSort:Y,loading:ee,maxHeight:"none",stickyHeader:!0,bordered:!1,searchable:!1,selectable:!0,selectedRows:u,onSelectionChange:d,rowKey:"$id",actions:[Ts.edit(l=>ht(l)),Ts.delete(l=>xt(l))],emptyMessage:"No post-production tasks found"})})}),Be>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx($,{variant:"outline",size:"sm",onClick:()=>E(l=>Math.max(1,l-1)),disabled:I===1,children:"Previous"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",I," of ",Be]})}),e.jsx($,{variant:"outline",size:"sm",onClick:()=>E(l=>Math.min(Be,l+1)),disabled:I===Be,children:"Next"})]})]})}),e.jsx(jc,{isOpen:a,onClose:()=>{n(!1),c(null)},onSubmit:Lt,editingTask:i,isLoading:h.isPending||k.isPending})]})},On=Ri,za=p.forwardRef(({className:r,...t},s)=>e.jsx(Zr,{ref:s,className:ie("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",r),...t}));za.displayName=Zr.displayName;const Ss=p.forwardRef(({className:r,...t},s)=>e.jsx(en,{ref:s,className:ie("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",r),...t}));Ss.displayName=en.displayName;const _t=p.forwardRef(({className:r,...t},s)=>e.jsx(tn,{ref:s,className:ie("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",r),...t}));_t.displayName=tn.displayName;class vc{DEFAULT_OPTIONS={maxWidth:200,maxHeight:90,maxSizeKB:500,allowedTypes:["image/jpeg","image/jpg","image/png","image/svg+xml","image/webp"]};async uploadLogo(t,s={}){const a={...this.DEFAULT_OPTIONS,...s};try{return a.allowedTypes.includes(t.type)?t.size/1024>a.maxSizeKB?{success:!1,error:`File too large. Maximum: ${a.maxSizeKB}KB`}:t.type==="image/svg+xml"?{success:!0,logoBase64:await this.fileToBase64(t)}:{success:!0,logoBase64:await this.scaleImage(t,a.maxWidth,a.maxHeight)}:{success:!1,error:`Invalid file type. Allowed: ${a.allowedTypes.join(", ")}`}}catch(n){return{success:!1,error:n.message||"Failed to process logo"}}}async scaleImage(t,s,a){return new Promise((n,i)=>{const c=new Image,u=document.createElement("canvas"),d=u.getContext("2d");if(!d){i(new Error("Canvas context not available"));return}c.onload=()=>{const{width:m,height:y}=this.calculateDimensions(c.width,c.height,s,a);u.width=m,u.height=y,d.drawImage(c,0,0,m,y);const N=u.toDataURL("image/png",.9);n(N)},c.onerror=()=>i(new Error("Failed to load image"));const o=new FileReader;o.onload=m=>{c.src=m.target?.result},o.onerror=()=>i(new Error("Failed to read file")),o.readAsDataURL(t)})}calculateDimensions(t,s,a,n){let{width:i,height:c}={width:t,height:s};if(i>a||c>n){const u=a/i,d=n/c,o=Math.min(u,d);i=Math.round(i*o),c=Math.round(c*o)}return{width:i,height:c}}fileToBase64(t){return new Promise((s,a)=>{const n=new FileReader;n.onload=()=>s(n.result),n.onerror=()=>a(new Error("Failed to read file")),n.readAsDataURL(t)})}}const bc=new vc;function Nc(){const{toast:r}=Fe(),{settings:t,updateSettings:s}=Nn(),[a,n]=p.useState(!1),[i,c]=p.useState(t.logo||null),u=p.useRef(null),d=(v,_)=>{s({[v]:_})},o=()=>{s({logo:i||void 0}),r({title:"Success",description:"Company profile saved successfully"})},m=async v=>{const _=v.target.files?.[0];if(_){n(!0);try{const C=await bc.uploadLogo(_,{maxWidth:200,maxHeight:90,maxSizeKB:500});C.success&&C.logoBase64?(c(C.logoBase64),r({title:"Logo uploaded successfully",description:"Logo has been scaled to fit 200x90px"})):r({title:"Upload failed",description:C.error||"Unknown error",variant:"destructive"})}catch(C){r({title:"Upload failed",description:C.message||"Failed to process logo",variant:"destructive"})}finally{n(!1),u.current&&(u.current.value="")}}},y=()=>{c(null),r({title:"Logo removed",description:"Logo has been removed"})},N=()=>{u.current?.click()};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(G,{children:[e.jsxs(me,{children:[e.jsx(pe,{children:"Company Information"}),e.jsx(ke,{children:"Basic information about your company"})]}),e.jsxs(Z,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(F,{children:"Company Logo"}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:i?e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"w-48 h-20 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg flex items-center justify-center bg-gray-50 dark:bg-gray-800 overflow-hidden",children:e.jsx("img",{src:i,alt:"Company Logo",className:"max-w-full max-h-full object-contain dark:brightness-90"})}),e.jsx($,{variant:"destructive",size:"sm",className:"absolute -top-2 -right-2 h-6 w-6 rounded-full p-0 opacity-0 group-hover:opacity-100 transition-opacity",onClick:y,children:e.jsx(_s,{className:"h-3 w-3"})})]}):e.jsx("div",{className:"w-48 h-20 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg flex items-center justify-center bg-gray-50 dark:bg-gray-800 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:N,children:e.jsxs("div",{className:"text-center",children:[e.jsx(Wa,{className:"h-8 w-8 mx-auto text-gray-400 dark:text-gray-500 mb-2"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Click to upload"}),e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:"200x90px"})]})})}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs($,{variant:"outline",onClick:N,disabled:a,className:"gap-2",children:[e.jsx(ra,{className:"h-4 w-4"}),a?"Uploading...":"Upload Logo"]}),i&&e.jsxs($,{variant:"ghost",onClick:y,className:"gap-2 text-red-600 hover:text-red-700",children:[e.jsx(_s,{className:"h-4 w-4"}),"Remove"]})]}),e.jsxs(He,{children:[e.jsx(Wa,{className:"h-4 w-4"}),e.jsxs(ze,{children:[e.jsx("strong",{children:"Requirements:"})," Max 500KB â€¢ 200x90px recommended â€¢ PNG, JPG, SVG, WebP â€¢ Auto-scaled to fit"]})]})]})]}),e.jsx("input",{ref:u,type:"file",accept:"image/*",onChange:m,className:"hidden"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(F,{htmlFor:"companyName",children:"Company Name *"}),e.jsx(B,{id:"companyName",value:t.companyName,onChange:v=>d("companyName",v.target.value)})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"legalName",children:"Legal Name"}),e.jsx(B,{id:"legalName",value:t.legalName,onChange:v=>d("legalName",v.target.value)})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"registrationNumber",children:"Registration Number"}),e.jsx(B,{id:"registrationNumber",value:t.registrationNumber,onChange:v=>d("registrationNumber",v.target.value)})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"taxId",children:"Tax ID / GST Number"}),e.jsx(B,{id:"taxId",value:t.taxId,onChange:v=>d("taxId",v.target.value)})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"industryType",children:"Industry Type"}),e.jsxs(re,{value:t.industryType,onValueChange:v=>d("industryType",v),children:[e.jsx(se,{children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(w,{value:"Manufacturing",children:"Manufacturing"}),e.jsx(w,{value:"Trading",children:"Trading"}),e.jsx(w,{value:"Services",children:"Services"}),e.jsx(w,{value:"Retail",children:"Retail"})]})]})]})]})]})]}),e.jsxs(G,{children:[e.jsxs(me,{children:[e.jsx(pe,{children:"Contact Information"}),e.jsx(ke,{children:"How to reach your company"})]}),e.jsxs(Z,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(F,{htmlFor:"address",children:"Address"}),e.jsx(rs,{id:"address",value:t.address,onChange:v=>d("address",v.target.value),rows:2})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(F,{htmlFor:"city",children:"City"}),e.jsx(B,{id:"city",value:t.city,onChange:v=>d("city",v.target.value)})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"state",children:"State"}),e.jsx(B,{id:"state",value:t.state,onChange:v=>d("state",v.target.value)})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"postalCode",children:"Postal Code"}),e.jsx(B,{id:"postalCode",value:t.postalCode,onChange:v=>d("postalCode",v.target.value)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(F,{htmlFor:"phone",children:"Phone"}),e.jsx(B,{id:"phone",value:t.phone,onChange:v=>d("phone",v.target.value)})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"email",children:"Email"}),e.jsx(B,{id:"email",type:"email",value:t.email,onChange:v=>d("email",v.target.value)})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"website",children:"Website"}),e.jsx(B,{id:"website",value:t.website,onChange:v=>d("website",v.target.value)})]})]})]})]}),e.jsxs(G,{children:[e.jsxs(me,{children:[e.jsx(pe,{children:"Business Settings"}),e.jsx(ke,{children:"Configure your business preferences"})]}),e.jsx(Z,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(F,{htmlFor:"fiscalYearStart",children:"Fiscal Year Start Month"}),e.jsxs(re,{value:t.fiscalYearStart,onValueChange:v=>d("fiscalYearStart",v),children:[e.jsx(se,{children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(w,{value:"01",children:"January"}),e.jsx(w,{value:"04",children:"April"}),e.jsx(w,{value:"07",children:"July"}),e.jsx(w,{value:"10",children:"October"})]})]})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"currency",children:"Default Currency"}),e.jsxs(re,{value:t.currency,onValueChange:v=>d("currency",v),children:[e.jsx(se,{children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(w,{value:"INR",children:"INR - Indian Rupee"}),e.jsx(w,{value:"USD",children:"USD - US Dollar"}),e.jsx(w,{value:"EUR",children:"EUR - Euro"}),e.jsx(w,{value:"GBP",children:"GBP - British Pound"})]})]})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"timezone",children:"Time Zone"}),e.jsxs(re,{value:t.timezone,onValueChange:v=>d("timezone",v),children:[e.jsx(se,{children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(w,{value:"Asia/Kolkata",children:"Asia/Kolkata (IST)"}),e.jsx(w,{value:"America/New_York",children:"America/New_York (EST)"}),e.jsx(w,{value:"Europe/London",children:"Europe/London (GMT)"}),e.jsx(w,{value:"Asia/Dubai",children:"Asia/Dubai (GST)"})]})]})]})]})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs($,{onClick:o,className:"gap-2",children:[e.jsx(pa,{className:"h-4 w-4"}),"Save Changes"]})})]})}const rr="molaga_users",nr="molaga_roles",ir=[{id:"super_admin",name:"Super Admin",description:"Full system access",permissions:{masterData:"full",purchases:"full",tasks:"full",sales:"full",status:"full",reports:"full",settings:"full"},isSystemRole:!0},{id:"admin",name:"Admin",description:"All except system configuration",permissions:{masterData:"full",purchases:"full",tasks:"full",sales:"full",status:"full",reports:"full",settings:"edit"},isSystemRole:!0},{id:"manager",name:"Manager",description:"View all, edit assigned",permissions:{masterData:"view",purchases:"edit",tasks:"edit",sales:"edit",status:"view",reports:"view",settings:"none"},isSystemRole:!0},{id:"staff",name:"Staff",description:"Limited access",permissions:{masterData:"view",purchases:"view",tasks:"edit",sales:"view",status:"view",reports:"none",settings:"none"},isSystemRole:!0},{id:"viewer",name:"Viewer",description:"Read-only access",permissions:{masterData:"view",purchases:"view",tasks:"view",sales:"view",status:"view",reports:"view",settings:"none"},isSystemRole:!0}],wc=[{id:"1",name:"Admin User",email:"admin@molaga.com",role:"super_admin",status:"active",lastLogin:new Date().toISOString(),createdAt:new Date().toISOString()}];class Sc{users;roles;constructor(){this.users=this.loadUsers(),this.roles=this.loadRoles()}loadUsers(){try{const t=localStorage.getItem(rr);if(t)return JSON.parse(t)}catch(t){console.error("Error loading users:",t)}return[...wc]}saveUsers(){try{localStorage.setItem(rr,JSON.stringify(this.users))}catch(t){console.error("Error saving users:",t)}}getAllUsers(){return[...this.users]}getUserById(t){return this.users.find(s=>s.id===t)}createUser(t){const s={...t,id:Date.now().toString(),createdAt:new Date().toISOString()};return this.users.push(s),this.saveUsers(),s}updateUser(t,s){const a=this.users.findIndex(n=>n.id===t);return a===-1?null:(this.users[a]={...this.users[a],...s},this.saveUsers(),this.users[a])}deleteUser(t){const s=this.users.findIndex(a=>a.id===t);return s===-1?!1:(this.users.splice(s,1),this.saveUsers(),!0)}loadRoles(){try{const t=localStorage.getItem(nr);if(t){const s=JSON.parse(t),a=[...ir];return s.forEach(n=>{n.isSystemRole||a.push(n)}),a}}catch(t){console.error("Error loading roles:",t)}return[...ir]}saveRoles(){try{const t=this.roles.filter(s=>!s.isSystemRole);localStorage.setItem(nr,JSON.stringify(t))}catch(t){console.error("Error saving roles:",t)}}getAllRoles(){return[...this.roles]}getRoleById(t){return this.roles.find(s=>s.id===t)}createRole(t){const s={...t,id:Date.now().toString(),isSystemRole:!1};return this.roles.push(s),this.saveRoles(),s}updateRole(t,s){const a=this.roles.findIndex(n=>n.id===t);return a===-1||this.roles[a].isSystemRole?null:(this.roles[a]={...this.roles[a],...s},this.saveRoles(),this.roles[a])}deleteRole(t){const s=this.roles.findIndex(a=>a.id===t);return s===-1||this.roles[s].isSystemRole?!1:(this.roles.splice(s,1),this.saveRoles(),!0)}}const Ft=new Sc;function _c(){const[r,t]=p.useState(Ft.getAllUsers()),s=p.useCallback(()=>{t(Ft.getAllUsers())},[]),a=p.useCallback(c=>{const u=Ft.createUser(c);return s(),u},[s]),n=p.useCallback((c,u)=>{const d=Ft.updateUser(c,u);return s(),d},[s]),i=p.useCallback(c=>{const u=Ft.deleteUser(c);return u&&s(),u},[s]);return{users:r,createUser:a,updateUser:n,deleteUser:i,refreshUsers:s}}function kc(){const[r,t]=p.useState(Ft.getAllRoles()),s=p.useCallback(()=>{t(Ft.getAllRoles())},[]),a=p.useCallback(c=>{const u=Ft.createRole(c);return s(),u},[s]),n=p.useCallback((c,u)=>{const d=Ft.updateRole(c,u);return s(),d},[s]),i=p.useCallback(c=>{const u=Ft.deleteRole(c);return u&&s(),u},[s]);return{roles:r,createRole:a,updateRole:n,deleteRole:i,refreshRoles:s}}class Cc{RESET_LOG_KEY="password_reset_log";FORCE_CHANGE_KEY="force_password_change";generateTempPassword(){const s="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*";let a="";a+="ABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(Math.random()*26)],a+="abcdefghijklmnopqrstuvwxyz"[Math.floor(Math.random()*26)],a+="0123456789"[Math.floor(Math.random()*10)],a+="!@#$%^&*"[Math.floor(Math.random()*8)];for(let n=a.length;n<12;n++)a+=s[Math.floor(Math.random()*s.length)];return a.split("").sort(()=>Math.random()-.5).join("")}async resetUserPassword(t,s,a,n,i){try{const c=this.generateTempPassword();return this.logPasswordReset({id:Date.now().toString(),userId:t,userName:s,userEmail:a,resetBy:`${i} (${n})`,resetAt:new Date().toISOString(),tempPassword:c,mustChangePassword:!0}),this.setForcePasswordChange(t,!0),{success:!0,tempPassword:c,message:"Password reset successfully. User must change password on next login."}}catch(c){return console.error("Password reset error:",c),{success:!1,message:c.message||"Failed to reset password"}}}logPasswordReset(t){try{const s=this.getResetLogs();s.unshift(t),s.length>100&&s.splice(100),localStorage.setItem(this.RESET_LOG_KEY,JSON.stringify(s))}catch(s){console.error("Error logging password reset:",s)}}getResetLogs(){try{const t=localStorage.getItem(this.RESET_LOG_KEY);return t?JSON.parse(t):[]}catch(t){return console.error("Error loading reset logs:",t),[]}}setForcePasswordChange(t,s){try{const a=this.getForceChangeFlags();a[t]=s,localStorage.setItem(this.FORCE_CHANGE_KEY,JSON.stringify(a))}catch(a){console.error("Error setting force change flag:",a)}}mustChangePassword(t){try{return this.getForceChangeFlags()[t]===!0}catch(s){return console.error("Error checking force change flag:",s),!1}}clearForcePasswordChange(t){this.setForcePasswordChange(t,!1)}getForceChangeFlags(){try{const t=localStorage.getItem(this.FORCE_CHANGE_KEY);return t?JSON.parse(t):{}}catch(t){return console.error("Error loading force change flags:",t),{}}}getUserResetLogs(t){return this.getResetLogs().filter(a=>a.userId===t)}clearOldLogs(){try{const t=this.getResetLogs(),s=new Date;s.setDate(s.getDate()-90);const a=t.filter(i=>new Date(i.resetAt)>s),n=t.length-a.length;return localStorage.setItem(this.RESET_LOG_KEY,JSON.stringify(a)),n}catch(t){return console.error("Error clearing old logs:",t),0}}}const Pc=new Cc;function Tc(){const{toast:r}=Fe(),{user:t}=ft(),{users:s,createUser:a,updateUser:n,deleteUser:i}=_c(),{roles:c}=kc(),[u,d]=p.useState(""),[o,m]=p.useState(!1),[y,N]=p.useState(null),[v,_]=p.useState(!1),[C,g]=p.useState(null),[S,D]=p.useState(""),[I,E]=p.useState({name:"",email:"",phone:"",role:"",department:"",employeeId:"",status:"active"}),q=s.filter(x=>x.name.toLowerCase().includes(u.toLowerCase())||x.email.toLowerCase().includes(u.toLowerCase())),U=()=>{N(null),E({name:"",email:"",phone:"",role:"",department:"",employeeId:"",status:"active"}),m(!0)},O=x=>{N(x),E({name:x.name,email:x.email,phone:x.phone||"",role:x.role,department:x.department||"",employeeId:x.employeeId||"",status:x.status}),m(!0)},ee=x=>{confirm("Are you sure you want to delete this user?")&&i(x)&&r({title:"User deleted successfully"})},L=x=>{g(x),D(""),_(!0)},P=async()=>{if(!C||!t)return;const x=await Pc.resetUserPassword(C.id,C.name,C.email,t.$id,t.name);x.success&&x.tempPassword?(D(x.tempPassword),r({title:"Password Reset Successfully",description:"Temporary password has been generated. Please share it securely with the user."})):(r({title:"Password Reset Failed",description:x.message,variant:"destructive"}),_(!1),g(null))},h=()=>{navigator.clipboard.writeText(S),r({title:"Copied!",description:"Temporary password copied to clipboard"})},k=()=>{if(!I.name||!I.email||!I.role){r({title:"Please fill in all required fields",variant:"destructive"});return}y?(n(y.id,I),r({title:"User updated successfully"})):(a(I),r({title:"User created successfully"})),m(!1)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(G,{children:[e.jsx(me,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(pe,{children:"User Management"}),e.jsx(ke,{children:"Manage system users and their access"})]}),e.jsxs($,{onClick:U,className:"gap-2",children:[e.jsx(qi,{className:"h-4 w-4"}),"Add User"]})]})}),e.jsxs(Z,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pt,{className:"h-4 w-4 text-muted-foreground"}),e.jsx(B,{placeholder:"Search users...",value:u,onChange:x=>d(x.target.value),className:"max-w-sm"})]}),e.jsxs(jt,{children:[e.jsx(yt,{children:e.jsxs(Ee,{children:[e.jsx(X,{children:"Name"}),e.jsx(X,{children:"Email"}),e.jsx(X,{children:"Role"}),e.jsx(X,{children:"Status"}),e.jsx(X,{children:"Last Login"}),e.jsx(X,{className:"text-right",children:"Actions"})]})}),e.jsx(vt,{children:q.map(x=>e.jsxs(Ee,{children:[e.jsx(Q,{className:"font-medium",children:x.name}),e.jsx(Q,{children:x.email}),e.jsx(Q,{children:x.role}),e.jsx(Q,{children:e.jsx(Qe,{variant:x.status==="active"?"default":"secondary",children:x.status})}),e.jsx(Q,{children:x.lastLogin}),e.jsx(Q,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx($,{variant:"ghost",size:"sm",onClick:()=>L(x),title:"Reset Password",children:e.jsx(Qs,{className:"h-4 w-4"})}),e.jsx($,{variant:"ghost",size:"sm",onClick:()=>O(x),children:e.jsx(ss,{className:"h-4 w-4"})}),e.jsx($,{variant:"ghost",size:"sm",onClick:()=>ee(x.id),children:e.jsx($t,{className:"h-4 w-4"})})]})})]},x.id))})]})]})]}),e.jsxs(G,{children:[e.jsxs(me,{children:[e.jsx(pe,{children:"Roles & Permissions"}),e.jsx(ke,{children:"Configure user roles and their permissions"})]}),e.jsx(Z,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:c.map(x=>e.jsxs(G,{children:[e.jsxs(me,{children:[e.jsx(pe,{className:"text-base",children:x.name}),x.isSystemRole&&e.jsx(Qe,{variant:"secondary",className:"w-fit",children:"System Role"})]}),e.jsxs(Z,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:x.description}),e.jsx("div",{className:"text-xs text-muted-foreground mb-3",children:e.jsx("div",{className:"grid grid-cols-2 gap-1",children:Object.entries(x.permissions).slice(0,4).map(([T,b])=>e.jsxs("div",{children:[T,": ",e.jsx("span",{className:"font-medium",children:b})]},T))})}),e.jsx($,{variant:"outline",size:"sm",className:"w-full",disabled:x.isSystemRole,children:x.isSystemRole?"View Permissions":"Edit Permissions"})]})]},x.id))})})]}),e.jsx(ot,{open:o,onOpenChange:m,children:e.jsxs(at,{children:[e.jsxs(rt,{children:[e.jsx(it,{children:y?"Edit User":"Add New User"}),e.jsx(lt,{children:y?"Update user information":"Create a new user account"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(F,{htmlFor:"name",children:"Full Name *"}),e.jsx(B,{id:"name",placeholder:"John Doe",value:I.name,onChange:x=>E({...I,name:x.target.value})})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"email",children:"Email *"}),e.jsx(B,{id:"email",type:"email",placeholder:"john@example.com",value:I.email,onChange:x=>E({...I,email:x.target.value})})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"phone",children:"Phone"}),e.jsx(B,{id:"phone",placeholder:"+91 9876543210",value:I.phone,onChange:x=>E({...I,phone:x.target.value})})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"role",children:"Role *"}),e.jsxs(re,{value:I.role,onValueChange:x=>E({...I,role:x}),children:[e.jsx(se,{children:e.jsx(ne,{placeholder:"Select role"})}),e.jsx(ae,{children:c.map(x=>e.jsx(w,{value:x.id,children:x.name},x.id))})]})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"department",children:"Department"}),e.jsx(B,{id:"department",placeholder:"Production",value:I.department,onChange:x=>E({...I,department:x.target.value})})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"employeeId",children:"Employee ID"}),e.jsx(B,{id:"employeeId",placeholder:"EMP001",value:I.employeeId,onChange:x=>E({...I,employeeId:x.target.value})})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"status",children:"Status"}),e.jsxs(re,{value:I.status,onValueChange:x=>E({...I,status:x}),children:[e.jsx(se,{children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(w,{value:"active",children:"Active"}),e.jsx(w,{value:"inactive",children:"Inactive"})]})]})]})]}),e.jsxs(nt,{children:[e.jsx($,{variant:"outline",onClick:()=>m(!1),children:"Cancel"}),e.jsx($,{onClick:k,children:y?"Update":"Create"})]})]})}),e.jsx(ot,{open:v,onOpenChange:_,children:e.jsxs(at,{children:[e.jsxs(rt,{children:[e.jsx(it,{children:"Reset Password"}),e.jsxs(lt,{children:["Reset password for ",C?.name]})]}),e.jsx("div",{className:"space-y-4 py-4",children:S?e.jsxs(e.Fragment,{children:[e.jsxs(He,{children:[e.jsx(Qs,{className:"h-4 w-4"}),e.jsx(ze,{children:"Password reset successfully! Please share this temporary password securely with the user."})]}),e.jsxs("div",{children:[e.jsx(F,{children:"Temporary Password"}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(B,{value:S,readOnly:!0,className:"font-mono"}),e.jsx($,{variant:"outline",size:"icon",onClick:h,children:e.jsx(Ks,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"User must change this password on next login"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(He,{children:[e.jsx(Qs,{className:"h-4 w-4"}),e.jsx(ze,{children:"A temporary password will be generated. The user will be required to change it on next login."})]}),e.jsxs("div",{children:[e.jsx(F,{children:"User Email"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:C?.email})]})]})}),e.jsx(nt,{children:S?e.jsx($,{onClick:()=>{_(!1),g(null),D("")},children:"Close"}):e.jsxs(e.Fragment,{children:[e.jsx($,{variant:"outline",onClick:()=>_(!1),children:"Cancel"}),e.jsxs($,{onClick:P,className:"gap-2",children:[e.jsx(Qs,{className:"h-4 w-4"}),"Generate Password"]})]})})]})})]})}class Dc{async registerWithApproval(t,s,a){try{const n=await Vt.create(ps.unique(),t,s,a),i={approvalStatus:"pending",registeredAt:new Date().toISOString(),role:"viewer"};await Vt.updatePrefs(i);try{await Vt.deleteSession("current")}catch{}return{success:!0,message:"Registration successful. Please wait for admin approval.",userId:n.$id}}catch(n){return console.error("Registration error:",n),{success:!1,message:n.message||"Registration failed"}}}async checkApprovalStatus(t){try{const a=(await Vt.get()).prefs;return!a.approvalStatus||a.approvalStatus==="approved"?{approved:!0,status:"approved",message:"User is approved"}:a.approvalStatus==="pending"?{approved:!1,status:"pending",message:"Your account is pending approval. Please wait for admin approval."}:a.approvalStatus==="rejected"?{approved:!1,status:"rejected",message:`Your account was rejected. Reason: ${a.rejectionReason||"Not specified"}`}:{approved:!1,status:"pending",message:"Unknown approval status"}}catch(s){return console.error("Approval check error:",s),{approved:!1,status:"pending",message:"Could not verify approval status"}}}async approveUser(t,s,a="viewer"){try{return{success:!0,message:"User approved successfully"}}catch(n){return console.error("Approval error:",n),{success:!1,message:n.message||"Failed to approve user"}}}async rejectUser(t,s,a){try{return{success:!0,message:"User rejected"}}catch(n){return console.error("Rejection error:",n),{success:!1,message:n.message||"Failed to reject user"}}}getPendingUsers(){try{const t=localStorage.getItem("pending_users");return t?JSON.parse(t):[]}catch(t){return console.error("Error loading pending users:",t),[]}}addPendingUser(t){try{const s=this.getPendingUsers();s.push(t),localStorage.setItem("pending_users",JSON.stringify(s))}catch(s){console.error("Error adding pending user:",s)}}removePendingUser(t){try{const a=this.getPendingUsers().filter(n=>n.$id!==t);localStorage.setItem("pending_users",JSON.stringify(a))}catch(s){console.error("Error removing pending user:",s)}}updatePendingUserStatus(t,s,a){try{const n=this.getPendingUsers(),i=n.find(c=>c.$id===t);i&&(i.approvalStatus=s,a&&(i.rejectionReason=a),localStorage.setItem("pending_users",JSON.stringify(n)))}catch(n){console.error("Error updating pending user:",n)}}}const vs=new Dc;function Ec(){const{toast:r}=Fe(),{user:t}=ft(),[s,a]=p.useState(vs.getPendingUsers()),[n,i]=p.useState(null),[c,u]=p.useState(!1),[d,o]=p.useState(!1),[m,y]=p.useState("viewer"),[N,v]=p.useState(""),_=Ft.getAllRoles(),C=()=>{a(vs.getPendingUsers())},g=E=>{i(E),y("viewer"),u(!0)},S=E=>{i(E),v(""),o(!0)},D=async()=>{if(!(!n||!t))try{Ft.createUser({name:n.name,email:n.email,role:m,status:"active"}),vs.updatePendingUserStatus(n.$id,"approved"),vs.removePendingUser(n.$id),r({title:"User Approved",description:`${n.name} has been approved and can now login.`}),C(),u(!1),i(null)}catch(E){r({title:"Approval Failed",description:E.message||"Failed to approve user",variant:"destructive"})}},I=async()=>{if(!(!n||!t)){if(!N.trim()){r({title:"Reason Required",description:"Please provide a reason for rejection",variant:"destructive"});return}try{vs.updatePendingUserStatus(n.$id,"rejected",N),vs.removePendingUser(n.$id),r({title:"User Rejected",description:`${n.name} has been rejected.`}),C(),o(!1),i(null),v("")}catch(E){r({title:"Rejection Failed",description:E.message||"Failed to reject user",variant:"destructive"})}}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(G,{children:[e.jsxs(me,{children:[e.jsx(pe,{children:"Pending User Approvals"}),e.jsx(ke,{children:"Review and approve new user registrations"})]}),e.jsx(Z,{children:s.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(_a,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No pending user approvals"})]}):e.jsxs(jt,{children:[e.jsx(yt,{children:e.jsxs(Ee,{children:[e.jsx(X,{children:"Name"}),e.jsx(X,{children:"Email"}),e.jsx(X,{children:"Provider"}),e.jsx(X,{children:"Registered"}),e.jsx(X,{children:"Status"}),e.jsx(X,{className:"text-right",children:"Actions"})]})}),e.jsx(vt,{children:s.map(E=>e.jsxs(Ee,{children:[e.jsx(Q,{className:"font-medium",children:E.name}),e.jsx(Q,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ma,{className:"h-4 w-4 text-muted-foreground"}),E.email]})}),e.jsx(Q,{children:e.jsx(Qe,{variant:"outline",children:E.provider})}),e.jsx(Q,{children:new Date(E.registeredAt).toLocaleDateString()}),e.jsx(Q,{children:e.jsxs(Qe,{variant:"secondary",children:[e.jsx(_a,{className:"h-3 w-3 mr-1"}),"Pending"]})}),e.jsx(Q,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx($,{variant:"ghost",size:"sm",onClick:()=>g(E),className:"text-green-600 hover:text-green-700",children:e.jsx(Jt,{className:"h-4 w-4"})}),e.jsx($,{variant:"ghost",size:"sm",onClick:()=>S(E),className:"text-red-600 hover:text-red-700",children:e.jsx(ka,{className:"h-4 w-4"})})]})})]},E.$id))})]})})]}),e.jsx(ot,{open:c,onOpenChange:u,children:e.jsxs(at,{children:[e.jsxs(rt,{children:[e.jsx(it,{children:"Approve User"}),e.jsxs(lt,{children:["Approve ",n?.name," to access the system"]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(F,{children:"Email"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:n?.email})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"role",children:"Assign Role"}),e.jsxs(re,{value:m,onValueChange:y,children:[e.jsx(se,{children:e.jsx(ne,{})}),e.jsx(ae,{children:_.map(E=>e.jsx(w,{value:E.id,children:E.name},E.id))})]})]})]}),e.jsxs(nt,{children:[e.jsx($,{variant:"outline",onClick:()=>u(!1),children:"Cancel"}),e.jsxs($,{onClick:D,className:"gap-2",children:[e.jsx(Jt,{className:"h-4 w-4"}),"Approve User"]})]})]})}),e.jsx(ot,{open:d,onOpenChange:o,children:e.jsxs(at,{children:[e.jsxs(rt,{children:[e.jsx(it,{children:"Reject User"}),e.jsxs(lt,{children:["Reject ",n?.name,"'s registration request"]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(F,{children:"Email"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:n?.email})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"reason",children:"Rejection Reason *"}),e.jsx(rs,{id:"reason",placeholder:"Please provide a reason for rejection...",value:N,onChange:E=>v(E.target.value),rows:4})]})]}),e.jsxs(nt,{children:[e.jsx($,{variant:"outline",onClick:()=>o(!1),children:"Cancel"}),e.jsxs($,{onClick:I,variant:"destructive",className:"gap-2",children:[e.jsx(ka,{className:"h-4 w-4"}),"Reject User"]})]})]})})]})}const It=p.forwardRef(({className:r,...t},s)=>e.jsx(sn,{className:ie("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",r),...t,ref:s,children:e.jsx(Ai,{className:ie("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));It.displayName=sn.displayName;function Rc(){const{toast:r}=Fe(),{settings:t,updateSettings:s}=wn(),a=(i,c)=>{s({[i]:c})},n=()=>{r({title:"System configuration saved successfully"})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(G,{children:[e.jsxs(me,{children:[e.jsx(pe,{children:"General Settings"}),e.jsx(ke,{children:"Configure system-wide preferences"})]}),e.jsx(Z,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(F,{htmlFor:"language",children:"Default Language"}),e.jsxs(re,{value:t.language,onValueChange:i=>a("language",i),children:[e.jsx(se,{children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(w,{value:"en",children:"English"}),e.jsx(w,{value:"hi",children:"Hindi"}),e.jsx(w,{value:"ta",children:"Tamil"}),e.jsx(w,{value:"te",children:"Telugu"})]})]})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"dateFormat",children:"Date Format"}),e.jsxs(re,{value:t.dateFormat,onValueChange:i=>a("dateFormat",i),children:[e.jsx(se,{children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(w,{value:"DD/MM/YYYY",children:"DD/MM/YYYY"}),e.jsx(w,{value:"MM/DD/YYYY",children:"MM/DD/YYYY"}),e.jsx(w,{value:"YYYY-MM-DD",children:"YYYY-MM-DD"})]})]})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"timeFormat",children:"Time Format"}),e.jsxs(re,{value:t.timeFormat,onValueChange:i=>a("timeFormat",i),children:[e.jsx(se,{children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(w,{value:"12",children:"12-hour"}),e.jsx(w,{value:"24",children:"24-hour"})]})]})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"firstDayOfWeek",children:"First Day of Week"}),e.jsxs(re,{value:t.firstDayOfWeek,onValueChange:i=>a("firstDayOfWeek",i),children:[e.jsx(se,{children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(w,{value:"sunday",children:"Sunday"}),e.jsx(w,{value:"monday",children:"Monday"})]})]})]})]})})]}),e.jsxs(G,{children:[e.jsxs(me,{children:[e.jsx(pe,{children:"Number Formatting"}),e.jsx(ke,{children:"Configure how numbers are displayed"})]}),e.jsx(Z,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(F,{htmlFor:"decimalPlaces",children:"Decimal Places"}),e.jsxs(re,{value:t.decimalPlaces,onValueChange:i=>a("decimalPlaces",i),children:[e.jsx(se,{children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(w,{value:"0",children:"0"}),e.jsx(w,{value:"1",children:"1"}),e.jsx(w,{value:"2",children:"2"}),e.jsx(w,{value:"3",children:"3"}),e.jsx(w,{value:"4",children:"4"})]})]})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"thousandSeparator",children:"Thousand Separator"}),e.jsxs(re,{value:t.thousandSeparator,onValueChange:i=>a("thousandSeparator",i),children:[e.jsx(se,{children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(w,{value:",",children:", (Comma)"}),e.jsx(w,{value:".",children:". (Period)"}),e.jsx(w,{value:" ",children:"  (Space)"})]})]})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"decimalSeparator",children:"Decimal Separator"}),e.jsxs(re,{value:t.decimalSeparator,onValueChange:i=>a("decimalSeparator",i),children:[e.jsx(se,{children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(w,{value:".",children:". (Period)"}),e.jsx(w,{value:",",children:", (Comma)"})]})]})]})]})})]}),e.jsxs(G,{children:[e.jsxs(me,{children:[e.jsx(pe,{children:"Display Settings"}),e.jsx(ke,{children:"Customize the user interface"})]}),e.jsxs(Z,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(F,{htmlFor:"recordsPerPage",children:"Records Per Page"}),e.jsxs(re,{value:t.recordsPerPage,onValueChange:i=>a("recordsPerPage",i),children:[e.jsx(se,{children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(w,{value:"25",children:"25"}),e.jsx(w,{value:"50",children:"50"}),e.jsx(w,{value:"100",children:"100"}),e.jsx(w,{value:"200",children:"200"})]})]})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"theme",children:"Theme"}),e.jsxs(re,{value:t.theme,onValueChange:i=>a("theme",i),children:[e.jsx(se,{children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(w,{value:"light",children:"Light"}),e.jsx(w,{value:"dark",children:"Dark"}),e.jsx(w,{value:"auto",children:"Auto"})]})]})]})]}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(F,{htmlFor:"sidebarCollapsed",children:"Sidebar Collapsed by Default"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Start with a collapsed sidebar"})]}),e.jsx(It,{id:"sidebarCollapsed",checked:t.sidebarCollapsed,onCheckedChange:i=>a("sidebarCollapsed",i)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(F,{htmlFor:"showTooltips",children:"Show Tooltips"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Display helpful tooltips"})]}),e.jsx(It,{id:"showTooltips",checked:t.showTooltips,onCheckedChange:i=>a("showTooltips",i)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(F,{htmlFor:"enableAnimations",children:"Enable Animations"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Use smooth transitions"})]}),e.jsx(It,{id:"enableAnimations",checked:t.enableAnimations,onCheckedChange:i=>a("enableAnimations",i)})]})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs($,{onClick:n,className:"gap-2",children:[e.jsx(pa,{className:"h-4 w-4"}),"Save Configuration"]})})]})}class qc{BACKUP_VERSION="1.0";APP_VERSION="1.0.0";getCollectionsList(){return["purchases","vendors","stocks","products","raw_products","processes","staff","sales_channels","pre_production_tasks","production_tasks","post_production_tasks","sales_units","sales_records","stock_status","pre_production_status","production_status","post_production_status"]}async exportCollection(t,s){const a=[];let n=0;const i=100;let c=!0;try{for(;c;){const u=await tt.listDocuments(st,be[t],[Ze.limit(i),Ze.offset(n)]);a.push(...u.documents),s&&s(a.length,u.total),u.documents.length<i?c=!1:n+=i}return console.log(`âœ“ Exported ${a.length} documents from ${t}`),a}catch(u){return console.error(`Error exporting ${t}:`,u),[]}}async createFullBackup(t){const s=this.getCollectionsList(),a={metadata:{version:this.BACKUP_VERSION,timestamp:new Date().toISOString(),appVersion:this.APP_VERSION,totalRecords:0,totalCollections:s.length,collections:s},collections:{}};let n=0;for(const i of s)try{const c=await this.exportCollection(i,(u,d)=>{t&&t({currentCollection:i,processedCollections:n,totalCollections:s.length,currentRecords:u,totalRecords:a.metadata.totalRecords+u,percentage:Math.round((n+u/d)/s.length*100)})});a.collections[i]=c,a.metadata.totalRecords+=c.length,n++,t&&t({currentCollection:i,processedCollections:n,totalCollections:s.length,currentRecords:c.length,totalRecords:a.metadata.totalRecords,percentage:Math.round(n/s.length*100)})}catch(c){console.error(`Failed to backup ${i}:`,c),a.collections[i]=[]}return a}async createPartialBackup(t,s){const a={metadata:{version:this.BACKUP_VERSION,timestamp:new Date().toISOString(),appVersion:this.APP_VERSION,totalRecords:0,totalCollections:t.length,collections:t},collections:{}};let n=0;for(const i of t){const c=await this.exportCollection(i);a.collections[i]=c,a.metadata.totalRecords+=c.length,n++,s&&s({currentCollection:i,processedCollections:n,totalCollections:t.length,currentRecords:c.length,totalRecords:a.metadata.totalRecords,percentage:Math.round(n/t.length*100)})}return a}async downloadBackup(t,s){const a=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),n=`molaga-backup-${new Date().toISOString().split("T")[0]}.json`;$s.saveAs(a,s||n)}getBackupSize(t){const s=JSON.stringify(t),a=new Blob([s]).size;return a<1024?`${a} B`:a<1024*1024?`${(a/1024).toFixed(2)} KB`:`${(a/(1024*1024)).toFixed(2)} MB`}async readBackupFile(t){return new Promise((s,a)=>{const n=new FileReader;n.onload=i=>{try{const c=i.target?.result,u=JSON.parse(c);s(u)}catch{a(new Error("Invalid backup file format"))}},n.onerror=()=>{a(new Error("Failed to read backup file"))},n.readAsText(t)})}}const Ws=new qc;class Ac{RESTORE_ORDER=["vendors","stocks","raw_products","processes","products","staff","sales_channels","purchases","pre_production_tasks","production_tasks","post_production_tasks","sales_units","sales_records","stock_status","pre_production_status","production_status","post_production_status"];async validateBackup(t){const s=[],a=[];if(t.metadata?.version||s.push("Missing backup version"),t.metadata?.timestamp||s.push("Missing backup timestamp"),!t.collections||typeof t.collections!="object")return s.push("Invalid or missing collections data"),{valid:!1,errors:s,warnings:a};const n=["products","stocks","vendors"];for(const c of n)t.collections[c]||a.push(`Missing recommended collection: ${c}`);for(const[c,u]of Object.entries(t.collections))Array.isArray(u)?u.length>0&&(u[0].$id||a.push(`Documents in ${c} may be missing $id field`)):s.push(`Invalid data format for collection: ${c}`);const i=Object.values(t.collections).reduce((c,u)=>c+u.length,0);return t.metadata.totalRecords!==i&&a.push(`Metadata record count (${t.metadata.totalRecords}) doesn't match actual count (${i})`),{valid:s.length===0,errors:s,warnings:a}}cleanDocument(t){const{$id:s,$createdAt:a,$updatedAt:n,$permissions:i,$collectionId:c,$databaseId:u,...d}=t;return d}async documentExists(t,s){try{return await tt.getDocument(st,be[t],s),!0}catch{return!1}}async clearCollection(t){let s=0,a=!0;try{for(;a;){const n=await tt.listDocuments(st,be[t],[]);for(const i of n.documents)try{await tt.deleteDocument(st,be[t],i.$id),s++}catch(c){console.error(`Failed to delete document ${i.$id}:`,c)}a=n.documents.length>0}}catch(n){console.error(`Error clearing collection ${t}:`,n)}return s}async restoreCollection(t,s,a,n){const i={total:s.length,success:0,failed:0,skipped:0,errors:[]};for(let c=0;c<s.length;c++){const u=s[c];try{const d=this.cleanDocument(u),o=u.$id||ps.unique();if(a.handleIdConflicts==="skip"){if(await this.documentExists(t,o)){i.skipped++;continue}}else a.handleIdConflicts==="overwrite"&&await this.documentExists(t,o)&&await tt.deleteDocument(st,be[t],o);await tt.createDocument(st,be[t],a.handleIdConflicts==="new"?ps.unique():o,d),i.success++}catch(d){if(i.failed++,i.errors.push({documentId:u.$id||"unknown",error:d.message||"Unknown error"}),a.stopOnError)throw d}n&&n(c+1,s.length)}return i}async restoreFromBackup(t,s,a){const n={success:!0,collections:{},errors:[],totalProcessed:0,totalSuccess:0,totalFailed:0};try{a&&a({currentCollection:"",processedCollections:0,totalCollections:0,currentRecords:0,totalRecords:0,percentage:0,phase:"validating"});const i=await this.validateBackup(t);if(!i.valid)throw new Error(`Invalid backup: ${i.errors.join(", ")}`);const c=this.RESTORE_ORDER.filter(o=>t.collections[o]&&t.collections[o].length>0),u=c.length;let d=0;if(s.clearExisting){a&&a({currentCollection:"",processedCollections:0,totalCollections:u,currentRecords:0,totalRecords:0,percentage:0,phase:"clearing"});for(const o of c)await this.clearCollection(o)}for(const o of c){a&&a({currentCollection:o,processedCollections:d,totalCollections:u,currentRecords:0,totalRecords:n.totalProcessed,percentage:Math.round(d/u*100),phase:"restoring"});try{const m=t.collections[o],y=await this.restoreCollection(o,m,s,(N,v)=>{a&&a({currentCollection:o,processedCollections:d,totalCollections:u,currentRecords:N,totalRecords:n.totalProcessed+N,percentage:Math.round((d+N/v)/u*100),phase:"restoring"})});n.collections[o]=y,n.totalProcessed+=y.total,n.totalSuccess+=y.success,n.totalFailed+=y.failed,d++}catch(m){if(n.success=!1,n.errors.push({collection:o,error:m.message||"Unknown error"}),s.stopOnError)throw m}}a&&a({currentCollection:"",processedCollections:u,totalCollections:u,currentRecords:n.totalProcessed,totalRecords:n.totalProcessed,percentage:100,phase:"complete"})}catch(i){n.success=!1,n.errors.push({collection:"general",error:i.message||"Unknown error"})}return n}getRestoreSummary(t){const s=[`Total Collections: ${Object.keys(t.collections).length}`,`Total Records Processed: ${t.totalProcessed}`,`Successful: ${t.totalSuccess}`,`Failed: ${t.totalFailed}`];return t.errors.length>0&&(s.push(`
Errors: ${t.errors.length}`),t.errors.forEach(a=>{s.push(`  - ${a.collection}: ${a.error}`)})),s.join(`
`)}}const Fc=new Ac;function Ic(){const{toast:r}=Fe(),t=p.useRef(null),[s,a]=p.useState(!1),[n,i]=p.useState(!1),[c,u]=p.useState(null),[d,o]=p.useState(null),[m,y]=p.useState(!1),[N,v]=p.useState(null),[_,C]=p.useState({autoBackup:!0,frequency:"daily",time:"00:00",retention:"30"}),[g,S]=p.useState({createSafetyBackup:!0,clearExisting:!0,handleIdConflicts:"skip",stopOnError:!1}),D=async()=>{a(!0),u(null);try{r({title:"Creating backup...",description:"This may take a few minutes depending on data size"});const q=await Ws.createFullBackup(O=>{u(O)}),U=Ws.getBackupSize(q);await Ws.downloadBackup(q),r({title:"Backup created successfully!",description:`Downloaded ${U} backup file with ${q.metadata.totalRecords} records`})}catch(q){console.error("Backup error:",q),r({title:"Backup failed",description:q.message||"An error occurred during backup",variant:"destructive"})}finally{a(!1),u(null)}},I=q=>{const U=q.target.files?.[0];if(U){if(!U.name.endsWith(".json")){r({title:"Invalid file type",description:"Please select a JSON backup file",variant:"destructive"});return}v(U),y(!0)}},E=async()=>{if(N){y(!1),i(!0),o(null);try{r({title:"Reading backup file...",description:"Please wait while we validate the backup"});const q=await Ws.readBackupFile(N);r({title:"Restoring data...",description:"This may take several minutes. Do not close this window."});const U=await Fc.restoreFromBackup(q,g,O=>{o(O)});U.success?r({title:"Restore completed successfully!",description:`Restored ${U.totalSuccess} records across ${Object.keys(U.collections).length} collections`}):(r({title:"Restore completed with errors",description:`${U.totalSuccess} succeeded, ${U.totalFailed} failed. Check console for details.`,variant:"destructive"}),console.error("Restore errors:",U.errors))}catch(q){console.error("Restore error:",q),r({title:"Restore failed",description:q.message||"An error occurred during restore",variant:"destructive"})}finally{i(!1),o(null),v(null),t.current&&(t.current.value="")}}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(He,{children:[e.jsx(Et,{className:"h-4 w-4"}),e.jsx(ze,{children:"Always create a backup before making major changes. Store backups securely in multiple locations."})]}),s&&c&&e.jsxs(G,{children:[e.jsx(me,{children:e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(Ve,{className:"h-5 w-5 animate-spin"}),"Creating Backup..."]})}),e.jsx(Z,{className:"space-y-4",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsxs("span",{children:["Processing: ",c.currentCollection]}),e.jsxs("span",{children:[c.percentage,"%"]})]}),e.jsx(Ps,{value:c.percentage}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:[c.processedCollections," / ",c.totalCollections," collections (",c.totalRecords," records)"]})]})})]}),n&&d&&e.jsxs(G,{children:[e.jsx(me,{children:e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(Ve,{className:"h-5 w-5 animate-spin"}),"Restoring Data..."]})}),e.jsx(Z,{className:"space-y-4",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsxs("span",{children:["Phase: ",d.phase]}),e.jsxs("span",{children:[d.percentage,"%"]})]}),e.jsx(Ps,{value:d.percentage}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:[d.currentCollection&&`Processing: ${d.currentCollection}`,e.jsx("br",{}),d.processedCollections," / ",d.totalCollections," collections (",d.totalRecords," records)"]})]})})]}),e.jsxs(G,{children:[e.jsxs(me,{children:[e.jsx(pe,{children:"Create Backup"}),e.jsx(ke,{children:"Export all your data to a JSON file"})]}),e.jsxs(Z,{className:"space-y-4",children:[e.jsxs(He,{children:[e.jsx(na,{className:"h-4 w-4"}),e.jsx(ze,{children:"Full backup includes all master data, transactions, tasks, and status records. The backup file will be downloaded to your computer."})]}),e.jsx($,{onClick:D,disabled:s||n,className:"gap-2",children:s?e.jsxs(e.Fragment,{children:[e.jsx(Ve,{className:"h-4 w-4 animate-spin"}),"Creating Backup..."]}):e.jsxs(e.Fragment,{children:[e.jsx(na,{className:"h-4 w-4"}),"Create Full Backup"]})})]})]}),e.jsxs(G,{children:[e.jsxs(me,{children:[e.jsx(pe,{children:"Restore Data"}),e.jsx(ke,{children:"Import data from a backup file"})]}),e.jsxs(Z,{className:"space-y-4",children:[e.jsxs(He,{children:[e.jsx(Et,{className:"h-4 w-4"}),e.jsx(ze,{children:"Warning: Restoring will replace current data. Make sure you have a recent backup before proceeding."})]}),e.jsx("input",{ref:t,type:"file",accept:".json",onChange:I,className:"hidden"}),e.jsxs($,{variant:"outline",onClick:()=>t.current?.click(),disabled:s||n,className:"gap-2",children:[e.jsx(ra,{className:"h-4 w-4"}),"Select Backup File"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Supported format: JSON backup files created by this system"})]})]}),e.jsx(ot,{open:m,onOpenChange:y,children:e.jsxs(at,{className:"max-w-2xl",children:[e.jsxs(rt,{children:[e.jsx(it,{children:"Confirm Data Restore"}),e.jsxs(lt,{children:["You are about to restore data from: ",N?.name]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs(He,{children:[e.jsx(Et,{className:"h-4 w-4"}),e.jsx(ze,{children:"This operation will modify your database. Please review the options carefully."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(F,{children:"Create Safety Backup First"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Backup current data before restoring"})]}),e.jsx(It,{checked:g.createSafetyBackup,onCheckedChange:q=>S({...g,createSafetyBackup:q})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(F,{children:"Clear Existing Data"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Remove all current data before restore"})]}),e.jsx(It,{checked:g.clearExisting,onCheckedChange:q=>S({...g,clearExisting:q})})]}),e.jsxs("div",{children:[e.jsx(F,{children:"Handle ID Conflicts"}),e.jsxs(re,{value:g.handleIdConflicts,onValueChange:q=>S({...g,handleIdConflicts:q}),children:[e.jsx(se,{children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(w,{value:"skip",children:"Skip existing records"}),e.jsx(w,{value:"overwrite",children:"Overwrite existing records"}),e.jsx(w,{value:"new",children:"Create with new IDs"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(F,{children:"Stop on Error"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Stop restore if any error occurs"})]}),e.jsx(It,{checked:g.stopOnError,onCheckedChange:q=>S({...g,stopOnError:q})})]})]})]}),e.jsxs(nt,{children:[e.jsx($,{variant:"outline",onClick:()=>y(!1),children:"Cancel"}),e.jsxs($,{onClick:E,className:"gap-2",children:[e.jsx(Jt,{className:"h-4 w-4"}),"Start Restore"]})]})]})})]})}function $c(){const{toast:r}=Fe(),[t,s]=p.useState({minPasswordLength:"8",requireUppercase:!0,requireLowercase:!0,requireNumbers:!0,requireSpecialChars:!0,passwordExpiry:"90",sessionTimeout:"30",maxSessions:"3",enable2FA:!1,loginAttempts:"5",lockoutDuration:"30"});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(G,{children:[e.jsxs(me,{children:[e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(Fi,{className:"h-5 w-5"}),"Password Policy"]}),e.jsx(ke,{children:"Configure password requirements"})]}),e.jsxs(Z,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(F,{children:"Minimum Password Length"}),e.jsxs(re,{value:t.minPasswordLength,onValueChange:a=>s({...t,minPasswordLength:a}),children:[e.jsx(se,{children:e.jsx(ne,{})}),e.jsx(ae,{children:[6,8,10,12,16].map(a=>e.jsxs(w,{value:String(a),children:[a," characters"]},a))})]})]}),e.jsxs("div",{children:[e.jsx(F,{children:"Password Expiry"}),e.jsxs(re,{value:t.passwordExpiry,onValueChange:a=>s({...t,passwordExpiry:a}),children:[e.jsx(se,{children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(w,{value:"never",children:"Never"}),e.jsx(w,{value:"30",children:"30 days"}),e.jsx(w,{value:"60",children:"60 days"}),e.jsx(w,{value:"90",children:"90 days"})]})]})]})]}),e.jsx("div",{className:"space-y-3",children:[{key:"requireUppercase",label:"Require Uppercase Letters"},{key:"requireLowercase",label:"Require Lowercase Letters"},{key:"requireNumbers",label:"Require Numbers"},{key:"requireSpecialChars",label:"Require Special Characters"}].map(({key:a,label:n})=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(F,{children:n}),e.jsx(It,{checked:t[a],onCheckedChange:i=>s({...t,[a]:i})})]},a))})]})]}),e.jsxs(G,{children:[e.jsxs(me,{children:[e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(an,{className:"h-5 w-5"}),"Session Management"]}),e.jsx(ke,{children:"Control user sessions and timeouts"})]}),e.jsx(Z,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(F,{children:"Session Timeout (minutes)"}),e.jsxs(re,{value:t.sessionTimeout,onValueChange:a=>s({...t,sessionTimeout:a}),children:[e.jsx(se,{children:e.jsx(ne,{})}),e.jsx(ae,{children:[15,30,60,120].map(a=>e.jsxs(w,{value:String(a),children:[a," minutes"]},a))})]})]}),e.jsxs("div",{children:[e.jsx(F,{children:"Max Concurrent Sessions"}),e.jsxs(re,{value:t.maxSessions,onValueChange:a=>s({...t,maxSessions:a}),children:[e.jsx(se,{children:e.jsx(ne,{})}),e.jsx(ae,{children:[1,2,3,5,10].map(a=>e.jsxs(w,{value:String(a),children:[a," session",a>1?"s":""]},a))})]})]})]})})]}),e.jsxs(G,{children:[e.jsxs(me,{children:[e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(Ur,{className:"h-5 w-5"}),"Access Control"]}),e.jsx(ke,{children:"Configure login security"})]}),e.jsxs(Z,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(F,{children:"Enable Two-Factor Authentication (2FA)"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Require 2FA for all users"})]}),e.jsx(It,{checked:t.enable2FA,onCheckedChange:a=>s({...t,enable2FA:a})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(F,{children:"Login Attempt Limit"}),e.jsxs(re,{value:t.loginAttempts,onValueChange:a=>s({...t,loginAttempts:a}),children:[e.jsx(se,{children:e.jsx(ne,{})}),e.jsx(ae,{children:[3,5,10].map(a=>e.jsxs(w,{value:String(a),children:[a," attempts"]},a))})]})]}),e.jsxs("div",{children:[e.jsx(F,{children:"Account Lockout Duration"}),e.jsxs(re,{value:t.lockoutDuration,onValueChange:a=>s({...t,lockoutDuration:a}),children:[e.jsx(se,{children:e.jsx(ne,{})}),e.jsx(ae,{children:[15,30,60].map(a=>e.jsxs(w,{value:String(a),children:[a," minutes"]},a))})]})]})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs($,{onClick:()=>r({title:"Security settings saved"}),className:"gap-2",children:[e.jsx(pa,{className:"h-4 w-4"}),"Save Security Settings"]})})]})}function Lc(){const{toast:r}=Fe(),[t,s]=p.useState({host:"smtp.gmail.com",port:"587",username:"noreply@molaga.com",password:"",fromEmail:"noreply@molaga.com",fromName:"Molaga ERP",useTLS:!0}),[a,n]=p.useState({lowStockAlerts:!0,taskCompletion:!0,backupStatus:!0,userLogin:!1,dataImportExport:!0});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(G,{children:[e.jsxs(me,{children:[e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(Ma,{className:"h-5 w-5"}),"Email Configuration"]}),e.jsx(ke,{children:"Configure SMTP settings for email notifications"})]}),e.jsxs(Z,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(F,{children:"SMTP Host"}),e.jsx(B,{value:t.host,onChange:i=>s({...t,host:i.target.value})})]}),e.jsxs("div",{children:[e.jsx(F,{children:"SMTP Port"}),e.jsx(B,{value:t.port,onChange:i=>s({...t,port:i.target.value})})]}),e.jsxs("div",{children:[e.jsx(F,{children:"Username"}),e.jsx(B,{value:t.username,onChange:i=>s({...t,username:i.target.value})})]}),e.jsxs("div",{children:[e.jsx(F,{children:"Password"}),e.jsx(B,{type:"password",value:t.password,onChange:i=>s({...t,password:i.target.value})})]}),e.jsxs("div",{children:[e.jsx(F,{children:"From Email"}),e.jsx(B,{type:"email",value:t.fromEmail,onChange:i=>s({...t,fromEmail:i.target.value})})]}),e.jsxs("div",{children:[e.jsx(F,{children:"From Name"}),e.jsx(B,{value:t.fromName,onChange:i=>s({...t,fromName:i.target.value})})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(F,{children:"Use TLS/SSL"}),e.jsx(It,{checked:t.useTLS,onCheckedChange:i=>s({...t,useTLS:i})})]}),e.jsxs($,{variant:"outline",className:"gap-2",children:[e.jsx(Ii,{className:"h-4 w-4"}),"Send Test Email"]})]})]}),e.jsxs(G,{children:[e.jsxs(me,{children:[e.jsx(pe,{children:"Notification Preferences"}),e.jsx(ke,{children:"Choose which notifications to receive"})]}),e.jsx(Z,{className:"space-y-4",children:[{key:"lowStockAlerts",label:"Low Stock Alerts",desc:"Get notified when stock falls below minimum level"},{key:"taskCompletion",label:"Task Completion",desc:"Notifications when tasks are completed"},{key:"backupStatus",label:"Backup Success/Failure",desc:"Get notified about backup operations"},{key:"userLogin",label:"User Login Alerts",desc:"Notifications for user login activity"},{key:"dataImportExport",label:"Data Import/Export Status",desc:"Updates on data operations"}].map(({key:i,label:c,desc:u})=>e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{children:[e.jsx(F,{children:c}),e.jsx("p",{className:"text-sm text-muted-foreground",children:u})]}),e.jsx(It,{checked:a[i],onCheckedChange:d=>n({...a,[i]:d})})]},i))})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs($,{onClick:()=>r({title:"Notification settings saved"}),className:"gap-2",children:[e.jsx(pa,{className:"h-4 w-4"}),"Save Settings"]})})]})}const or="molaga_data_settings",lr={importFormat:"csv",exportFormat:"csv",dateFormat:"DD/MM/YYYY",encoding:"utf8"};class Mc{settings;constructor(){this.settings=this.loadSettings()}loadSettings(){try{const t=localStorage.getItem(or);if(t)return{...lr,...JSON.parse(t)}}catch(t){console.error("Error loading data settings:",t)}return lr}saveSettings(){try{localStorage.setItem(or,JSON.stringify(this.settings))}catch(t){console.error("Error saving data settings:",t)}}getSettings(){return{...this.settings}}updateSettings(t){return this.settings={...this.settings,...t},this.saveSettings(),this.getSettings()}async archiveOldRecords(t){return new Promise(s=>{setTimeout(()=>{s({success:!0,count:0})},1e3)})}async deleteCancelledTasks(t){return new Promise(s=>{setTimeout(()=>{s({success:!0,count:0})},1e3)})}async clearAuditLogs(t){return new Promise(s=>{setTimeout(()=>{s({success:!0,count:0})},1e3)})}async optimizeDatabase(){return new Promise(t=>{setTimeout(()=>{t({success:!0,message:"Database optimized successfully"})},2e3)})}}const bs=new Mc;function Oc(){const[r,t]=p.useState(bs.getSettings()),[s,a]=p.useState(!1),n=p.useCallback(o=>{const m=bs.updateSettings(o);return t(m),m},[]),i=p.useCallback(async o=>{a(!0);try{return await bs.archiveOldRecords(o)}finally{a(!1)}},[]),c=p.useCallback(async o=>{a(!0);try{return await bs.deleteCancelledTasks(o)}finally{a(!1)}},[]),u=p.useCallback(async o=>{a(!0);try{return await bs.clearAuditLogs(o)}finally{a(!1)}},[]),d=p.useCallback(async()=>{a(!0);try{return await bs.optimizeDatabase()}finally{a(!1)}},[]);return{settings:r,updateSettings:n,archiveOldRecords:i,deleteCancelledTasks:c,clearAuditLogs:u,optimizeDatabase:d,isProcessing:s}}function Uc(){const{toast:r}=Fe(),{settings:t,updateSettings:s,archiveOldRecords:a,deleteCancelledTasks:n,clearAuditLogs:i,optimizeDatabase:c,isProcessing:u}=Oc(),d=async()=>{if(!confirm("Are you sure you want to archive old records?"))return;const N=await a(12);N.success&&r({title:`Archived ${N.count} records successfully`})},o=async()=>{if(!confirm("Are you sure you want to delete cancelled tasks?"))return;const N=await n(90);N.success&&r({title:`Deleted ${N.count} tasks successfully`})},m=async()=>{if(!confirm("Are you sure you want to clear audit logs?"))return;const N=await i(6);N.success&&r({title:`Cleared ${N.count} log entries successfully`})},y=async()=>{const N=await c();N.success&&r({title:N.message})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(G,{children:[e.jsxs(me,{children:[e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(ks,{className:"h-5 w-5"}),"Import/Export Settings"]}),e.jsx(ke,{children:"Configure default import and export preferences"})]}),e.jsx(Z,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(F,{children:"Default Import Format"}),e.jsxs(re,{value:t.importFormat,onValueChange:N=>s({importFormat:N}),children:[e.jsx(se,{children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(w,{value:"csv",children:"CSV"}),e.jsx(w,{value:"excel",children:"Excel"}),e.jsx(w,{value:"json",children:"JSON"})]})]})]}),e.jsxs("div",{children:[e.jsx(F,{children:"Default Export Format"}),e.jsxs(re,{value:t.exportFormat,onValueChange:N=>s({exportFormat:N}),children:[e.jsx(se,{children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(w,{value:"csv",children:"CSV"}),e.jsx(w,{value:"excel",children:"Excel"}),e.jsx(w,{value:"pdf",children:"PDF"})]})]})]}),e.jsxs("div",{children:[e.jsx(F,{children:"Date Format for Import/Export"}),e.jsxs(re,{value:t.dateFormat,onValueChange:N=>s({dateFormat:N}),children:[e.jsx(se,{children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(w,{value:"DD/MM/YYYY",children:"DD/MM/YYYY"}),e.jsx(w,{value:"MM/DD/YYYY",children:"MM/DD/YYYY"}),e.jsx(w,{value:"YYYY-MM-DD",children:"YYYY-MM-DD"})]})]})]}),e.jsxs("div",{children:[e.jsx(F,{children:"File Encoding"}),e.jsxs(re,{value:t.encoding,onValueChange:N=>s({encoding:N}),children:[e.jsx(se,{children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(w,{value:"utf8",children:"UTF-8"}),e.jsx(w,{value:"utf16",children:"UTF-16"}),e.jsx(w,{value:"ascii",children:"ASCII"})]})]})]})]})})]}),e.jsxs(G,{children:[e.jsxs(me,{children:[e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx($t,{className:"h-5 w-5"}),"Data Cleanup"]}),e.jsx(ke,{children:"Manage old and unnecessary data"})]}),e.jsxs(Z,{className:"space-y-4",children:[e.jsxs(He,{children:[e.jsx(Et,{className:"h-4 w-4"}),e.jsx(ze,{children:"Data cleanup operations are permanent. Always create a backup before proceeding."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx(F,{children:"Archive Old Records"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Move records older than 12 months to archive"})]}),e.jsx($,{variant:"outline",onClick:d,disabled:u,children:u?e.jsx(Ve,{className:"h-4 w-4 animate-spin"}):"Archive"})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx(F,{children:"Delete Cancelled Tasks"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Remove cancelled tasks older than 90 days"})]}),e.jsx($,{variant:"outline",onClick:o,disabled:u,children:u?e.jsx(Ve,{className:"h-4 w-4 animate-spin"}):"Delete"})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx(F,{children:"Clear Audit Logs"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Remove audit logs older than 6 months"})]}),e.jsx($,{variant:"outline",onClick:m,disabled:u,children:u?e.jsx(Ve,{className:"h-4 w-4 animate-spin"}):"Clear"})]})]})]})]}),e.jsxs(G,{children:[e.jsxs(me,{children:[e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(na,{className:"h-5 w-5"}),"Database Maintenance"]}),e.jsx(ke,{children:"Optimize database performance"})]}),e.jsx(Z,{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx(F,{children:"Optimize Database"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Rebuild indexes and optimize tables"})]}),e.jsx($,{variant:"outline",onClick:y,disabled:u,children:u?e.jsx(Ve,{className:"h-4 w-4 animate-spin"}):"Optimize"})]})})]})]})}const Ns="molaga_api_keys";class Kc{generateKey(t,s,a){const n=this.createSecureKey(),i=new Date,c={id:this.generateId(),name:t,key:n,createdAt:i.toISOString(),expiresAt:a?new Date(i.getTime()+a*24*60*60*1e3).toISOString():void 0,permissions:s,isActive:!0};return this.saveKey(c),c}createSecureKey(){return`mlg_${this.generateRandomString(32)}`}generateRandomString(t){const s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let a="";const n=new Uint8Array(t);crypto.getRandomValues(n);for(let i=0;i<t;i++)a+=s[n[i]%s.length];return a}generateId(){return`key_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}saveKey(t){const s=this.getAllKeys();s.push(t),localStorage.setItem(Ns,JSON.stringify(s))}getAllKeys(){try{const t=localStorage.getItem(Ns);return t?JSON.parse(t):[]}catch(t){return console.error("Error loading API keys:",t),[]}}getKeyById(t){return this.getAllKeys().find(a=>a.id===t)||null}revokeKey(t){const s=this.getAllKeys(),a=s.findIndex(n=>n.id===t);return a!==-1?(s[a].isActive=!1,localStorage.setItem(Ns,JSON.stringify(s)),!0):!1}deleteKey(t){const s=this.getAllKeys(),a=s.filter(n=>n.id!==t);return a.length!==s.length?(localStorage.setItem(Ns,JSON.stringify(a)),!0):!1}validateKey(t){const a=this.getAllKeys().find(n=>n.key===t);return a?a.isActive?a.expiresAt&&new Date(a.expiresAt)<new Date?{valid:!1,error:"API key has expired"}:{valid:!0,apiKey:a}:{valid:!1,error:"API key has been revoked"}:{valid:!1,error:"Invalid API key"}}updateLastUsed(t){const s=this.getAllKeys(),a=s.findIndex(n=>n.id===t);a!==-1&&(s[a].lastUsed=new Date().toISOString(),localStorage.setItem(Ns,JSON.stringify(s)))}regenerateKey(t){const s=this.getAllKeys(),a=s.findIndex(n=>n.id===t);return a!==-1?(s[a],s[a].key=this.createSecureKey(),s[a].createdAt=new Date().toISOString(),s[a].lastUsed=void 0,localStorage.setItem(Ns,JSON.stringify(s)),s[a]):null}}const Qt=new Kc;function Vc(){const{toast:r}=Fe(),{user:t}=ft(),[s,a]=p.useState(Qt.getAllKeys()),[n,i]=p.useState(!1),[c,u]=p.useState(!1),[d,o]=p.useState({name:"",expiresIn:"90",permissions:["read"]}),[m,y]=p.useState(null),N=t?.email==="varda3d@gmail.com",v=()=>{if(!d.name.trim()){r({title:"Validation error",description:"Please enter a key name",variant:"destructive"});return}const E=d.expiresIn==="never"?void 0:parseInt(d.expiresIn),q=Qt.generateKey(d.name,d.permissions,E);y(q),a(Qt.getAllKeys()),i(!1),u(!0),o({name:"",expiresIn:"90",permissions:["read"]}),r({title:"API key created",description:"Copy the key now - it won't be shown again"})},_=E=>{navigator.clipboard.writeText(E),r({title:"Copied",description:"API key copied to clipboard"})},C=E=>{Qt.revokeKey(E),a(Qt.getAllKeys()),r({title:"API key revoked",description:"The key can no longer be used"})},g=E=>{Qt.deleteKey(E),a(Qt.getAllKeys()),r({title:"API key deleted",description:"The key has been permanently removed"})},S=E=>{const q=Qt.regenerateKey(E);q&&(y(q),a(Qt.getAllKeys()),u(!0),r({title:"API key regenerated",description:"Copy the new key now"}))},D=E=>new Date(E).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),I=E=>E&&new Date(E)<new Date;return N?e.jsxs("div",{className:"space-y-6",children:[e.jsxs(G,{children:[e.jsx(me,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(Ca,{className:"h-5 w-5"}),"API Keys"]}),e.jsx(ke,{children:"Generate and manage API keys for external integrations"})]}),e.jsxs($,{onClick:()=>i(!0),className:"gap-2",children:[e.jsx(Tt,{className:"h-4 w-4"}),"Create API Key"]})]})}),e.jsxs(Z,{children:[e.jsxs(He,{className:"mb-6",children:[e.jsx(Et,{className:"h-4 w-4"}),e.jsxs(ze,{children:[e.jsx("strong",{children:"Security Notice:"})," API keys provide access to your system. Keep them secure and never share them publicly."]})]}),s.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(Ca,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No API keys created yet"}),e.jsx("p",{className:"text-sm",children:"Create your first API key to get started"})]}):e.jsx("div",{className:"space-y-4",children:s.map(E=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h4",{className:"font-medium",children:E.name}),E.isActive?I(E.expiresAt)?e.jsx(Qe,{variant:"destructive",children:"Expired"}):e.jsx(Qe,{variant:"default",className:"bg-green-500",children:"Active"}):e.jsx(Qe,{variant:"secondary",children:"Revoked"})]}),e.jsxs("div",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsxs("p",{children:["Key: ",E.key.substring(0,20),"...",E.key.substring(E.key.length-4)]}),e.jsxs("p",{children:["Created: ",D(E.createdAt)]}),E.expiresAt&&e.jsxs("p",{children:["Expires: ",D(E.expiresAt)]}),E.lastUsed&&e.jsxs("p",{children:["Last used: ",D(E.lastUsed)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs($,{variant:"outline",size:"sm",onClick:()=>_(E.key),className:"gap-2",children:[e.jsx(Ks,{className:"h-3 w-3"}),"Copy"]}),E.isActive&&!I(E.expiresAt)&&e.jsxs(e.Fragment,{children:[e.jsxs($,{variant:"outline",size:"sm",onClick:()=>S(E.id),className:"gap-2",children:[e.jsx(qa,{className:"h-3 w-3"}),"Regenerate"]}),e.jsx($,{variant:"outline",size:"sm",onClick:()=>C(E.id),className:"gap-2 text-orange-600 hover:text-orange-700",children:"Revoke"})]}),e.jsxs($,{variant:"outline",size:"sm",onClick:()=>g(E.id),className:"gap-2 text-red-600 hover:text-red-700",children:[e.jsx($t,{className:"h-3 w-3"}),"Delete"]})]})]},E.id))})]})]}),e.jsx(ot,{open:n,onOpenChange:i,children:e.jsxs(at,{children:[e.jsxs(rt,{children:[e.jsx(it,{children:"Create New API Key"}),e.jsx(lt,{children:"Generate a new API key for external integrations"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(F,{htmlFor:"keyName",children:"Key Name *"}),e.jsx(B,{id:"keyName",placeholder:"e.g., Mobile App Integration",value:d.name,onChange:E=>o({...d,name:E.target.value})})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"expiresIn",children:"Expires In"}),e.jsxs(re,{value:d.expiresIn,onValueChange:E=>o({...d,expiresIn:E}),children:[e.jsx(se,{children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(w,{value:"30",children:"30 days"}),e.jsx(w,{value:"90",children:"90 days"}),e.jsx(w,{value:"180",children:"180 days"}),e.jsx(w,{value:"365",children:"1 year"}),e.jsx(w,{value:"never",children:"Never"})]})]})]})]}),e.jsxs(nt,{children:[e.jsx($,{variant:"outline",onClick:()=>i(!1),children:"Cancel"}),e.jsx($,{onClick:v,children:"Create Key"})]})]})}),e.jsx(ot,{open:c,onOpenChange:u,children:e.jsxs(at,{children:[e.jsxs(rt,{children:[e.jsxs(it,{className:"flex items-center gap-2",children:[e.jsx(Jt,{className:"h-5 w-5 text-green-500"}),"API Key Created"]}),e.jsx(lt,{children:"Copy this key now - it won't be shown again"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs(He,{children:[e.jsx(Et,{className:"h-4 w-4"}),e.jsx(ze,{children:"Store this key securely. You won't be able to see it again."})]}),e.jsxs("div",{children:[e.jsx(F,{children:"API Key"}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(B,{value:m?.key||"",readOnly:!0,className:"font-mono text-sm"}),e.jsxs($,{variant:"outline",onClick:()=>_(m?.key||""),className:"gap-2",children:[e.jsx(Ks,{className:"h-4 w-4"}),"Copy"]})]})]})]}),e.jsx(nt,{children:e.jsx($,{onClick:()=>u(!1),children:"Done"})})]})})]}):e.jsxs(He,{children:[e.jsx(Et,{className:"h-4 w-4"}),e.jsx(ze,{children:"Only Super Admins can manage API keys. Contact your administrator for access."})]})}const cr="molaga_custom_domain";class Bc{getConfig(){try{const t=localStorage.getItem(cr);if(t)return JSON.parse(t)}catch(t){console.error("Error loading domain config:",t)}return{customDomain:null,isVerified:!1,verificationToken:this.generateVerificationToken(),verifiedAt:null,createdAt:null}}setDomain(t){const s=this.getConfig();s.customDomain=t,s.isVerified=!1,s.verifiedAt=null,s.createdAt=new Date().toISOString(),s.verificationToken||(s.verificationToken=this.generateVerificationToken()),this.saveConfig(s)}verifyDomain(){const t=this.getConfig();t.isVerified=!0,t.verifiedAt=new Date().toISOString(),this.saveConfig(t)}removeDomain(){const t={customDomain:null,isVerified:!1,verificationToken:this.generateVerificationToken(),verifiedAt:null,createdAt:null};this.saveConfig(t)}generateVerificationToken(){const t=new Uint8Array(16);return crypto.getRandomValues(t),Array.from(t,s=>s.toString(16).padStart(2,"0")).join("")}saveConfig(t){try{localStorage.setItem(cr,JSON.stringify(t))}catch(s){console.error("Error saving domain config:",s)}}isCustomDomainActive(){const t=this.getConfig();return!!(t.customDomain&&t.isVerified)}getActiveDomain(){const t=this.getConfig();return t.isVerified?t.customDomain:null}}const ms=new Bc;function Hc(){const{toast:r}=Fe(),{user:t}=ft(),[s,a]=p.useState(ms.getConfig()),[n,i]=p.useState(s.customDomain||""),[c,u]=p.useState(!1),d=t?.email==="varda3d@gmail.com",o=()=>{if(!n.trim()){r({title:"Validation error",description:"Please enter a domain name",variant:"destructive"});return}if(!/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(n)){r({title:"Invalid domain",description:"Please enter a valid domain name (e.g., erp.yourcompany.com)",variant:"destructive"});return}ms.setDomain(n),a(ms.getConfig()),r({title:"Domain saved",description:"Custom domain configuration updated"})},m=async()=>{u(!0),setTimeout(()=>{Math.random()>.3?(ms.verifyDomain(),a(ms.getConfig()),r({title:"Domain verified",description:"Your custom domain is now active"})):r({title:"Verification failed",description:"Please check your DNS records and try again",variant:"destructive"}),u(!1)},2e3)},y=()=>{ms.removeDomain(),a(ms.getConfig()),i(""),r({title:"Domain removed",description:"Custom domain configuration has been removed"})},N=v=>{navigator.clipboard.writeText(v),r({title:"Copied",description:"Copied to clipboard"})};return d?e.jsx("div",{className:"space-y-6",children:e.jsxs(G,{children:[e.jsxs(me,{children:[e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(Pa,{className:"h-5 w-5"}),"Custom Domain"]}),e.jsx(ke,{children:"Configure a custom domain for your ERP system"})]}),e.jsxs(Z,{className:"space-y-6",children:[e.jsxs(He,{children:[e.jsx(Et,{className:"h-4 w-4"}),e.jsxs(ze,{children:[e.jsx("strong",{children:"Note:"})," Custom domain configuration requires DNS changes. Make sure you have access to your domain's DNS settings."]})]}),s.customDomain&&e.jsxs("div",{className:"p-4 border rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pa,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:s.customDomain})]}),s.isVerified?e.jsxs(Qe,{className:"bg-green-500",children:[e.jsx(Jt,{className:"h-3 w-3 mr-1"}),"Verified"]}):e.jsx(Qe,{variant:"secondary",children:"Pending Verification"})]}),s.verifiedAt&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Verified on ",new Date(s.verifiedAt).toLocaleDateString()]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(F,{htmlFor:"domain",children:"Domain Name"}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(B,{id:"domain",placeholder:"erp.yourcompany.com",value:n,onChange:v=>i(v.target.value),disabled:s.isVerified}),s.isVerified?e.jsx($,{variant:"outline",onClick:y,className:"text-red-600",children:"Remove"}):e.jsx($,{onClick:o,children:"Save"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Enter your custom domain (e.g., erp.yourcompany.com)"})]}),s.customDomain&&!s.isVerified&&e.jsxs(G,{children:[e.jsxs(me,{children:[e.jsx(pe,{className:"text-base",children:"DNS Configuration"}),e.jsx(ke,{children:"Add these DNS records to your domain provider"})]}),e.jsxs(Z,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"p-3 border rounded-lg bg-muted/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Type: CNAME"}),e.jsx($,{variant:"ghost",size:"sm",onClick:()=>N("CNAME"),className:"h-6 px-2",children:e.jsx(Ks,{className:"h-3 w-3"})})]}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," ",s.customDomain]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Value:"})," molaga-erp.app"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"TTL:"})," 3600"]})]})]}),e.jsxs("div",{className:"p-3 border rounded-lg bg-muted/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Type: TXT (Verification)"}),e.jsx($,{variant:"ghost",size:"sm",onClick:()=>N(`molaga-verification=${s.verificationToken}`),className:"h-6 px-2",children:e.jsx(Ks,{className:"h-3 w-3"})})]}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," _molaga-verification.",s.customDomain]}),e.jsxs("p",{className:"break-all",children:[e.jsx("strong",{children:"Value:"})," molaga-verification=",s.verificationToken]}),e.jsxs("p",{children:[e.jsx("strong",{children:"TTL:"})," 3600"]})]})]})]}),e.jsxs(He,{children:[e.jsx(Et,{className:"h-4 w-4"}),e.jsx(ze,{children:'DNS changes can take up to 48 hours to propagate. After adding the records, click "Verify Domain" below.'})]}),e.jsx($,{onClick:m,disabled:c,className:"w-full gap-2",children:c?e.jsx(e.Fragment,{children:"Verifying..."}):e.jsxs(e.Fragment,{children:[e.jsx(Jt,{className:"h-4 w-4"}),"Verify Domain"]})})]})]}),s.isVerified&&e.jsxs(G,{children:[e.jsxs(me,{children:[e.jsx(pe,{className:"text-base",children:"SSL Certificate"}),e.jsx(ke,{children:"Your domain is secured with SSL/TLS"})]}),e.jsxs(Z,{children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-600",children:[e.jsx(Jt,{className:"h-4 w-4"}),e.jsx("span",{children:"SSL certificate is active and valid"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Your custom domain is secured with automatic SSL certificate provisioning."})]})]}),e.jsxs(G,{children:[e.jsx(me,{children:e.jsx(pe,{className:"text-base",children:"Need Help?"})}),e.jsxs(Z,{className:"space-y-2",children:[e.jsxs("a",{href:"#",className:"flex items-center gap-2 text-sm text-primary hover:underline",children:[e.jsx(Gs,{className:"h-3 w-3"}),"How to configure DNS records"]}),e.jsxs("a",{href:"#",className:"flex items-center gap-2 text-sm text-primary hover:underline",children:[e.jsx(Gs,{className:"h-3 w-3"}),"Troubleshooting domain verification"]}),e.jsxs("a",{href:"#",className:"flex items-center gap-2 text-sm text-primary hover:underline",children:[e.jsx(Gs,{className:"h-3 w-3"}),"Contact support"]})]})]})]})]})]})}):e.jsxs(He,{children:[e.jsx(Et,{className:"h-4 w-4"}),e.jsx(ze,{children:"Only Super Admins can configure custom domains. Contact your administrator for access."})]})}function zc(){Fe();const{user:r}=ft(),[t,s]=p.useState("overview"),a=r?.email==="varda3d@gmail.com";return e.jsxs("div",{className:"space-y-6",children:[!a&&e.jsxs(He,{children:[e.jsx(Et,{className:"h-4 w-4"}),e.jsxs(ze,{children:[e.jsx("strong",{children:"Read-Only Mode:"})," Only Super Admin (varda3d@gmail.com) can modify integration settings."]})]}),e.jsxs(On,{value:t,onValueChange:s,children:[e.jsxs(za,{className:"grid w-full grid-cols-4",children:[e.jsx(Ss,{value:"overview",children:"Overview"}),e.jsx(Ss,{value:"api-keys",children:"API Keys"}),e.jsx(Ss,{value:"domain",children:"Custom Domain"}),e.jsx(Ss,{value:"webhooks",children:"Webhooks"})]}),e.jsxs(_t,{value:"overview",className:"space-y-6 mt-6",children:[e.jsxs(G,{children:[e.jsxs(me,{children:[e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(Ca,{className:"h-5 w-5"}),"API Configuration"]}),e.jsx(ke,{children:"Quick overview of API settings"})]}),e.jsx(Z,{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(F,{children:"API Access Status"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage API keys in the API Keys tab"})]}),e.jsx(Qe,{variant:"secondary",children:"View Details â†’"})]})})]}),e.jsxs(G,{children:[e.jsxs(me,{children:[e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(Pa,{className:"h-5 w-5"}),"Custom Domain"]}),e.jsx(ke,{children:"Configure your custom domain"})]}),e.jsx(Z,{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(F,{children:"Domain Status"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Configure custom domain in the Custom Domain tab"})]}),e.jsx(Qe,{variant:"secondary",children:"View Details â†’"})]})})]}),e.jsxs(G,{children:[e.jsxs(me,{children:[e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx($i,{className:"h-5 w-5"}),"Third-Party Integrations"]}),e.jsx(ke,{children:"Connect with external services"})]}),e.jsx(Z,{className:"space-y-4",children:[{name:"Accounting Software",status:"Not Connected",available:!1},{name:"Payment Gateway",status:"Not Connected",available:!1},{name:"SMS Gateway",status:"Not Connected",available:!1},{name:"Cloud Storage",status:"Not Connected",available:!1}].map(n=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx(F,{children:n.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:n.status})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!n.available&&e.jsx(Qe,{variant:"secondary",children:"Coming Soon"}),e.jsx($,{variant:"outline",size:"sm",disabled:!n.available||!a,children:"Configure"})]})]},n.name))})]})]}),e.jsx(_t,{value:"api-keys",className:"mt-6",children:e.jsx(Vc,{})}),e.jsx(_t,{value:"domain",className:"mt-6",children:e.jsx(Hc,{})}),e.jsx(_t,{value:"webhooks",className:"space-y-6 mt-6",children:e.jsxs(G,{children:[e.jsxs(me,{children:[e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(Li,{className:"h-5 w-5"}),"Webhooks"]}),e.jsx(ke,{children:"Configure webhook endpoints for real-time notifications"})]}),e.jsxs(Z,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(F,{children:"Webhook URL"}),e.jsx(B,{placeholder:"https://your-domain.com/webhook",disabled:!a}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Receive POST requests when events occur"})]}),e.jsxs("div",{children:[e.jsx(F,{children:"Events to Subscribe"}),e.jsx("div",{className:"space-y-2 mt-2",children:["Task Created","Task Completed","Low Stock Alert","Backup Completed"].map(n=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:n}),e.jsx(It,{disabled:!a})]},n))})]}),e.jsx($,{variant:"outline",disabled:!a,children:"Test Webhook"})]})]})})]})]})}function Qc(){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(G,{children:[e.jsxs(me,{children:[e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(Ta,{className:"h-5 w-5"}),"System Information"]}),e.jsx(ke,{children:"Details about your Molaga ERP installation"})]}),e.jsx(Z,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Application Name"}),e.jsx("p",{className:"font-medium",children:"Molaga ERP"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Version"}),e.jsxs("p",{className:"font-medium flex items-center gap-2",children:["1.0.0",e.jsxs(Qe,{variant:"default",className:"gap-1",children:[e.jsx(Jt,{className:"h-3 w-3"}),"Latest"]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Build Date"}),e.jsx("p",{className:"font-medium",children:"October 11, 2025"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"License Type"}),e.jsx("p",{className:"font-medium",children:"Enterprise"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Licensed To"}),e.jsx("p",{className:"font-medium",children:"Molaga Spices Pvt Ltd"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"License Expiry"}),e.jsx("p",{className:"font-medium",children:"October 11, 2026"})]})]})})]}),e.jsxs(G,{children:[e.jsxs(me,{children:[e.jsx(pe,{children:"Support & Help"}),e.jsx(ke,{children:"Get assistance with Molaga ERP"})]}),e.jsx(Z,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3 p-4 border rounded-lg",children:[e.jsx(ks,{className:"h-5 w-5 text-primary mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Documentation"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Comprehensive guides and tutorials"}),e.jsxs($,{variant:"link",className:"h-auto p-0 gap-1",children:["View Docs",e.jsx(Gs,{className:"h-3 w-3"})]})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 border rounded-lg",children:[e.jsx(Ma,{className:"h-5 w-5 text-primary mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Email Support"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"support@molagaerp.com"}),e.jsx($,{variant:"link",className:"h-auto p-0",children:"Send Email"})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 border rounded-lg",children:[e.jsx(Mi,{className:"h-5 w-5 text-primary mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Phone Support"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"+91 9876543210"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Mon-Fri, 9 AM - 6 PM IST"})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 border rounded-lg",children:[e.jsx(Ta,{className:"h-5 w-5 text-primary mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Submit Feedback"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Help us improve"}),e.jsx($,{variant:"link",className:"h-auto p-0",children:"Give Feedback"})]})]})]})})]}),e.jsxs(G,{children:[e.jsxs(me,{children:[e.jsx(pe,{children:"Updates"}),e.jsx(ke,{children:"Check for system updates"})]}),e.jsxs(Z,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg bg-muted/50",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"You're running the latest version"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Last checked: October 11, 2025"})]}),e.jsx($,{variant:"outline",children:"Check for Updates"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium mb-2",children:"Recent Updates"}),e.jsx("div",{className:"space-y-2",children:[{version:"1.0.0",date:"Oct 11, 2025",changes:"Initial release with full ERP features"},{version:"0.9.5",date:"Oct 1, 2025",changes:"Beta testing and bug fixes"},{version:"0.9.0",date:"Sep 15, 2025",changes:"Added validation system"}].map(r=>e.jsxs("div",{className:"p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("p",{className:"font-medium text-sm",children:["Version ",r.version]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r.date})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r.changes})]},r.version))})]})]})]}),e.jsxs(G,{children:[e.jsx(me,{children:e.jsx(pe,{children:"About Molaga ERP"})}),e.jsxs(Z,{children:[e.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed",children:"Molaga ERP is a comprehensive enterprise resource planning system designed specifically for spice manufacturing businesses. It streamlines operations from raw material procurement through production processes to final product sales, providing real-time insights and data-driven decision making capabilities."}),e.jsx("p",{className:"text-sm text-muted-foreground mt-4",children:"Â© 2025 Molaga ERP. All rights reserved."})]})]})]})}const Yc=[{value:"company",label:"Company Profile",icon:qr},{value:"users",label:"User Management",icon:Jr},{value:"approvals",label:"User Approvals",icon:Xr},{value:"system",label:"System Config",icon:Oi},{value:"backup",label:"Backup & Restore",icon:na},{value:"security",label:"Security",icon:an},{value:"notifications",label:"Notifications",icon:Ar},{value:"data",label:"Data Management",icon:ks},{value:"integrations",label:"Integrations",icon:hs},{value:"about",label:"About",icon:Ta}];function Wc(){const[r,t]=p.useState("company");return e.jsxs("div",{className:"container mx-auto p-6 max-w-7xl",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Settings"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage your system configuration and preferences"})]}),e.jsx(G,{className:"p-6",children:e.jsxs(On,{value:r,onValueChange:t,className:"space-y-6",children:[e.jsx(za,{className:"grid grid-cols-3 lg:grid-cols-10 gap-2 h-auto p-2",children:Yc.map(s=>e.jsxs(Ss,{value:s.value,className:"flex flex-col items-center gap-1 py-3 data-[state=active]:bg-primary data-[state=active]:text-primary-foreground",children:[e.jsx(s.icon,{className:"h-4 w-4"}),e.jsx("span",{className:"text-xs",children:s.label})]},s.value))}),e.jsx(_t,{value:"company",className:"space-y-4",children:e.jsx(Nc,{})}),e.jsx(_t,{value:"users",className:"space-y-4",children:e.jsx(Tc,{})}),e.jsx(_t,{value:"approvals",className:"space-y-4",children:e.jsx(Ec,{})}),e.jsx(_t,{value:"system",className:"space-y-4",children:e.jsx(Rc,{})}),e.jsx(_t,{value:"backup",className:"space-y-4",children:e.jsx(Ic,{})}),e.jsx(_t,{value:"security",className:"space-y-4",children:e.jsx($c,{})}),e.jsx(_t,{value:"notifications",className:"space-y-4",children:e.jsx(Lc,{})}),e.jsx(_t,{value:"data",className:"space-y-4",children:e.jsx(Uc,{})}),e.jsx(_t,{value:"integrations",className:"space-y-4",children:e.jsx(zc,{})}),e.jsx(_t,{value:"about",className:"space-y-4",children:e.jsx(Qc,{})})]})})]})}const Gc=new Vi({defaultOptions:{queries:{staleTime:300*1e3,gcTime:600*1e3,retry:(r,t)=>t?.code===401||t?.code===403?!1:r<3,refetchOnWindowFocus:!1,refetchOnMount:!0,refetchOnReconnect:!0},mutations:{retry:(r,t)=>t?.code===401||t?.code===403?!1:r<2}}}),Jc=Hi([{path:"/login",element:e.jsx(Nl,{})},{path:"/register",element:e.jsx(wl,{})},{path:"/",element:e.jsx(Ge,{children:e.jsx(We,{children:e.jsx(Dl,{})})})},{path:"/purchases",element:e.jsx(Ge,{children:e.jsx(We,{children:e.jsx(Il,{})})})},{path:"/tasks",element:e.jsx(Ge,{children:e.jsx(We,{children:e.jsx(Ml,{})})})},{path:"/status",element:e.jsx(Ge,{children:e.jsx(We,{children:e.jsx(Ol,{})})})},{path:"/sales",element:e.jsx(Ge,{children:e.jsx(We,{children:e.jsx(Ul,{})})})},{path:"/sales/units",element:e.jsx(Ge,{children:e.jsx(We,{children:e.jsx(Bl,{})})})},{path:"/sales/records",element:e.jsx(Ge,{children:e.jsx(We,{children:e.jsx(Hl,{})})})},{path:"/master",element:e.jsx(Ge,{children:e.jsx(We,{children:e.jsx(zl,{})})})},{path:"/master/stocks",element:e.jsx(Ge,{children:e.jsx(We,{children:e.jsx(Wl,{})})})},{path:"/master/vendors",element:e.jsx(Ge,{children:e.jsx(We,{children:e.jsx(Gl,{})})})},{path:"/master/staff",element:e.jsx(Ge,{children:e.jsx(We,{children:e.jsx(Jl,{})})})},{path:"/master/processes",element:e.jsx(Ge,{children:e.jsx(We,{children:e.jsx(Xl,{})})})},{path:"/master/raw-products",element:e.jsx(Ge,{children:e.jsx(We,{children:e.jsx(Zl,{})})})},{path:"/master/products",element:e.jsx(Ge,{children:e.jsx(We,{children:e.jsx(ec,{})})})},{path:"/master/sales-channels",element:e.jsx(Ge,{children:e.jsx(We,{children:e.jsx(tc,{})})})},{path:"/analytics",element:e.jsx(Ge,{children:e.jsx(We,{children:e.jsx(Ql,{})})})},{path:"/status/stock-status",element:e.jsx(Ge,{children:e.jsx(We,{children:e.jsx(ac,{})})})},{path:"/status/pre-production-status",element:e.jsx(Ge,{children:e.jsx(We,{children:e.jsx(rc,{})})})},{path:"/status/production-status",element:e.jsx(Ge,{children:e.jsx(We,{children:e.jsx(nc,{})})})},{path:"/status/post-production-status",element:e.jsx(Ge,{children:e.jsx(We,{children:e.jsx(oc,{})})})},{path:"/status/inventory-status",element:e.jsx(Ge,{children:e.jsx(We,{children:e.jsx(lc,{})})})},{path:"/tasks/pre-production",element:e.jsx(Ge,{children:e.jsx(We,{children:e.jsx(mc,{})})})},{path:"/tasks/production",element:e.jsx(Ge,{children:e.jsx(We,{children:e.jsx(gc,{})})})},{path:"/tasks/post-production",element:e.jsx(Ge,{children:e.jsx(We,{children:e.jsx(yc,{})})})},{path:"/settings",element:e.jsx(Ge,{children:e.jsx(We,{children:e.jsx(Wc,{})})})},{path:"*",element:e.jsx(Yl,{})}],{future:{v7_startTransition:!0}}),Xc=()=>e.jsx(Bi,{client:Gc,children:e.jsx(po,{children:e.jsx(qo,{children:e.jsxs(dn,{children:[e.jsx(io,{}),e.jsx(oo,{}),e.jsx(Mo,{}),e.jsx(zi,{router:Jc,future:{v7_startTransition:!0}})]})})})});Kn.createRoot(document.getElementById("root")).render(e.jsx(Xc,{}));

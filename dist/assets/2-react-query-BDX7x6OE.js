import{r as n,j as x}from"./0-react-core-CTNHgvAJ.js";import{i as C,n as p,j as f,k as E,Q,M as d}from"./9-vendor-CWobMp5c.js";var g=n.createContext(void 0),R=e=>{const s=n.useContext(g);if(!s)throw new Error("No QueryClient set, use QueryClientProvider to set one");return s},F=({client:e,children:s})=>(n.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),x.jsx(g.Provider,{value:e,children:s})),v=n.createContext(!1),w=()=>n.useContext(v);v.Provider;function O(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var S=n.createContext(O()),q=()=>n.useContext(S),T=(e,s)=>{(e.suspense||e.throwOnError||e.experimental_prefetchInRender)&&(s.isReset()||(e.retryOnMount=!1))},M=e=>{n.useEffect(()=>{e.clearReset()},[e])},P=({result:e,errorResetBoundary:s,throwOnError:o,query:t,suspense:u})=>e.isError&&!s.isReset()&&!e.isFetching&&t&&(u&&e.data===void 0||C(o,[e.error,t])),_=e=>{if(e.suspense){const s=t=>t==="static"?t:Math.max(t??1e3,1e3),o=e.staleTime;e.staleTime=typeof o=="function"?(...t)=>s(o(...t)):s(o),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3))}},k=(e,s)=>e.isLoading&&e.isFetching&&!s,B=(e,s)=>e?.suspense&&s.isPending,m=(e,s,o)=>s.fetchOptimistic(e).catch(()=>{o.clearReset()});function j(e,s,o){const t=w(),u=q(),i=R(),r=i.defaultQueryOptions(e);i.getDefaultOptions().queries?._experimental_beforeQuery?.(r),r._optimisticResults=t?"isRestoring":"optimistic",_(r),T(r,u),M(u);const l=!i.getQueryCache().get(r.queryHash),[a]=n.useState(()=>new s(i,r)),c=a.getOptimisticResult(r),y=!t&&e.subscribed!==!1;if(n.useSyncExternalStore(n.useCallback(h=>{const b=y?a.subscribe(p.batchCalls(h)):f;return a.updateResult(),b},[a,y]),()=>a.getCurrentResult(),()=>a.getCurrentResult()),n.useEffect(()=>{a.setOptions(r)},[r,a]),B(r,c))throw m(r,a,u);if(P({result:c,errorResetBoundary:u,throwOnError:r.throwOnError,query:i.getQueryCache().get(r.queryHash),suspense:r.suspense}))throw c.error;return i.getDefaultOptions().queries?._experimental_afterQuery?.(r,c),r.experimental_prefetchInRender&&!E&&k(c,t)&&(l?m(r,a,u):i.getQueryCache().get(r.queryHash)?.promise)?.catch(f).finally(()=>{a.updateResult()}),r.notifyOnChangeProps?c:a.trackResult(c)}function D(e,s){return j(e,Q)}function N(e,s){const o=R(),[t]=n.useState(()=>new d(o,e));n.useEffect(()=>{t.setOptions(e)},[t,e]);const u=n.useSyncExternalStore(n.useCallback(r=>t.subscribe(p.batchCalls(r)),[t]),()=>t.getCurrentResult(),()=>t.getCurrentResult()),i=n.useCallback((r,l)=>{t.mutate(r,l).catch(f)},[t]);if(u.error&&C(t.options.throwOnError,[u.error]))throw u.error;return{...u,mutate:i,mutateAsync:u.mutate}}export{F as Q,R as a,N as b,D as u};

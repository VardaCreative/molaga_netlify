import{r as m,j as e,X as yt,W as On,k as Ea,D as dt,P as Kn,H as Vn,S as Da,C as Ra,T as It,m as nr,n as Na,p as qa,q as ir,t as or,w as Bn,B as lr,x as cr,U as Qn,L as Hn,y as Oe,Z as dr,A as Is,z as St,E as zn,F as Yn,G as Ss,I as wa,J as Ys,K as Sa,M as vt,N as ur,O as ea,Q as pa,V as Ka,Y as os,_ as Js,$ as Va,a0 as Wn,a1 as Gn,a2 as Jn,a3 as mr,a4 as Xs,a5 as $s,R as ze,a6 as Aa,a7 as Xn,a8 as vs,a9 as hr,aa as Zn,ab as ei,ac as pr,ad as xr,ae as si,af as ti,ag as ai,ah as ri,ai as Fa,aj as Ba,ak as na,al as ni,am as Vt,an as $t,ao as $a,ap as sa,aq as ii,ar as gr,as as oi,at as _a,au as ka,av as Ht,aw as li,ax as ci,ay as Ca,az as di,aA as ui,aB as mi}from"./react-vendor-DQB_ldEL.js";import{V as fr,R as jr,A as yr,C as vr,T as br,D as Nr,P as hi,a as wr,b as pi,c as xi,d as gi,S as _t,e as Sr,O as ia,f as oa,g as _r,h as la,i as ca,j as kr,k as Cr,u as st,N as xa,l as Pr,m as Tr,n as fi,o as Er,I as Dr,p as Rr,q as qr,r as Ar,L as Fr,s as $r,t as ji,v as yi,w as kt,x as Lr,y as La,z as Es,B as de,E as Ir,F as vi,G as bi,H as Mr,J as Ni,K as wi,M as Ur,Q as Si,U as Or,W as _i,X as Kr,Y as Vr,Z as ki,_ as Br,$ as Ci,a0 as Qr,a1 as Hr,a2 as Pi,a3 as Ti,a4 as zr,a5 as Ei,a6 as Di,a7 as ns,a8 as Ee,a9 as Ri,aa as Yr,ab as qi,ac as Ai,ad as Wr,ae as Gr,af as Jr,ag as Fi,ah as Xr,ai as $i,aj as Li,ak as Ii,al as Mi}from"./react-deps-vendor-CQW79OJs.js";import{B as Ui,C as Oi,D as ut,F as Ki,$ as Vi,G as At,H as Bi,I as Qi}from"./vendor-C3wEBjcm.js";import{C as Hi,A as zi,D as Yi,Q as Ke,I as ct}from"./appwrite-vendor-CnyP1EhL.js";import{F as Qa,P as Tt,G as Et,H as Ts,I as Ha,J as Wi,b as Vs,e as Bs,K as ga,C as $e,s as Gs,L as Ge}from"./utils-vendor-BHN7fyS6.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();const Gi=1,Ji=1e6;let fa=0;function Xi(){return fa=(fa+1)%Number.MAX_SAFE_INTEGER,fa.toString()}const ja=new Map,za=r=>{if(ja.has(r))return;const s=setTimeout(()=>{ja.delete(r),Ft({type:"REMOVE_TOAST",toastId:r})},Ji);ja.set(r,s)},Zi=(r,s)=>{switch(s.type){case"ADD_TOAST":return{...r,toasts:[s.toast,...r.toasts].slice(0,Gi)};case"UPDATE_TOAST":return{...r,toasts:r.toasts.map(t=>t.id===s.toast.id?{...t,...s.toast}:t)};case"DISMISS_TOAST":{const{toastId:t}=s;return t?za(t):r.toasts.forEach(a=>{za(a.id)}),{...r,toasts:r.toasts.map(a=>a.id===t||t===void 0?{...a,open:!1}:a)}}case"REMOVE_TOAST":return s.toastId===void 0?{...r,toasts:[]}:{...r,toasts:r.toasts.filter(t=>t.id!==s.toastId)}}},zt=[];let Yt={toasts:[]};function Ft(r){Yt=Zi(Yt,r),zt.forEach(s=>{s(Yt)})}function eo({...r}){const s=Xi(),t=n=>Ft({type:"UPDATE_TOAST",toast:{...n,id:s}}),a=()=>Ft({type:"DISMISS_TOAST",toastId:s});return Ft({type:"ADD_TOAST",toast:{...r,id:s,open:!0,onOpenChange:n=>{n||a()}}}),{id:s,dismiss:a,update:t}}function Ie(){const[r,s]=m.useState(Yt);return m.useEffect(()=>(zt.push(s),()=>{const t=zt.indexOf(s);t>-1&&zt.splice(t,1)}),[r]),{...r,toast:eo,dismiss:t=>Ft({type:"DISMISS_TOAST",toastId:t})}}function ie(...r){return Ui(Oi(r))}const so=hi,Zr=m.forwardRef(({className:r,...s},t)=>e.jsx(fr,{ref:t,className:ie("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",r),...s}));Zr.displayName=fr.displayName;const to=ut("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),en=m.forwardRef(({className:r,variant:s,...t},a)=>e.jsx(jr,{ref:a,className:ie(to({variant:s}),r),...t}));en.displayName=jr.displayName;const ao=m.forwardRef(({className:r,...s},t)=>e.jsx(yr,{ref:t,className:ie("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors group-[.destructive]:border-muted/40 hover:bg-secondary group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 group-[.destructive]:focus:ring-destructive disabled:pointer-events-none disabled:opacity-50",r),...s}));ao.displayName=yr.displayName;const sn=m.forwardRef(({className:r,...s},t)=>e.jsx(vr,{ref:t,className:ie("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity group-hover:opacity-100 group-[.destructive]:text-red-300 hover:text-foreground group-[.destructive]:hover:text-red-50 focus:opacity-100 focus:outline-none focus:ring-2 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",r),"toast-close":"",...s,children:e.jsx(yt,{className:"h-4 w-4"})}));sn.displayName=vr.displayName;const tn=m.forwardRef(({className:r,...s},t)=>e.jsx(br,{ref:t,className:ie("text-sm font-semibold",r),...s}));tn.displayName=br.displayName;const an=m.forwardRef(({className:r,...s},t)=>e.jsx(Nr,{ref:t,className:ie("text-sm opacity-90",r),...s}));an.displayName=Nr.displayName;function ro(){const{toasts:r}=Ie();return e.jsxs(so,{children:[r.map(function({id:s,title:t,description:a,action:n,...i}){return e.jsxs(en,{...i,children:[e.jsxs("div",{className:"grid gap-1",children:[t&&e.jsx(tn,{children:t}),a&&e.jsx(an,{children:a})]}),n,e.jsx(sn,{})]},s)}),e.jsx(Zr,{})]})}const no=({...r})=>{const{theme:s="system"}=Ki();return e.jsx(Vi,{theme:s,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...r})},rn=pi,io=xi,oo=gi,nn=m.forwardRef(({className:r,sideOffset:s=4,...t},a)=>e.jsx(wr,{ref:a,sideOffset:s,className:ie("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...t}));nn.displayName=wr.displayName;const be={PRE_PRODUCTION_STATUS:"pre_production_status",PRODUCTION_STATUS:"production_status",POST_PRODUCTION_STATUS:"post_production_status",INVENTORY_STATUS:"inventory_status",STOCK_STATUS:"stock_status",TASKS:"tasks",PRE_PRODUCTION_TASKS:"pre_production_tasks",PRODUCTION_TASKS:"production_tasks",PRODUCTION_TASK_ITEMS:"production_task_items",POST_PRODUCTION_TASKS:"post_production_tasks",STOCKS:"stocks",RAW_PRODUCTS:"raw_products",VENDORS:"vendors",STAFF:"staff",PROCESSES:"processes",PRODUCTS:"products",SALES_CHANNELS:"sales_channels",PURCHASES:"purchases",SALES_ORDERS:"sales_orders",SALES_ORDER_ITEMS:"sales_order_items",SALES_UNITS:"sales_units",SALES_RECORDS:"sales_records"},lo="https://fra.cloud.appwrite.io/v1",co="68cb76af00043a1c3b77",da=new Hi;da.setEndpoint(lo);da.setProject(co);const Ye=new Yi(da),Os=new zi(da),We="68cb77a000339977dcb0",on=m.createContext(void 0),us=()=>{const r=m.useContext(on);if(r===void 0)throw new Error("useAuth must be used within an AuthProvider");return r},uo=({children:r})=>{const[s,t]=m.useState(null),[a,n]=m.useState(!0);m.useEffect(()=>{i()},[]);const i=async()=>{try{if(window.self!==window.top){console.log("Running in iframe environment (preview mode)");const b=localStorage.getItem("appwrite-auth-user");if(b)try{const T=JSON.parse(b);t(T),console.log("Using stored user data in iframe:",T.email),n(!1);return}catch{console.log("Invalid stored user data, clearing..."),localStorage.removeItem("appwrite-auth-user")}}const y=await Os.get();t(y),localStorage.setItem("appwrite-auth-user",JSON.stringify(y)),console.log("Authenticated user:",y.email)}catch(x){t(null),localStorage.removeItem("appwrite-auth-user"),console.error("Authentication check failed:",{code:x.code,message:x.message,type:x.type,response:x.response,isInIframe:window.self!==window.top}),x.code===401?console.log("Session expired or invalid, user needs to login again"):console.log("Not authenticated:",x.message)}finally{n(!1)}},l=async(x,y)=>{try{await Os.createEmailPasswordSession(x,y);const b=await Os.get();t(b),localStorage.setItem("appwrite-auth-user",JSON.stringify(b)),console.log("Successfully authenticated user:",b.email)}catch(b){throw console.error("Authentication error:",b.message),b}},d={user:s,login:l,register:async(x,y,b)=>{try{await Os.create("unique()",x,y,b),await l(x,y)}catch(T){throw T}},loginWithGoogle:async()=>{try{Os.createOAuth2Session("google",`${window.location.origin}/`,`${window.location.origin}/login`)}catch(x){throw x}},logout:async()=>{try{await Os.deleteSession("current"),t(null),localStorage.removeItem("appwrite-auth-user"),console.log("Successfully logged out")}catch(x){console.error("Logout error:",x.message),t(null),localStorage.removeItem("appwrite-auth-user")}},loading:a};return e.jsx(on.Provider,{value:d,children:r})};class oe{static field(s){return new mo(s)}static PATTERNS={EMAIL:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,PHONE:/^[\+]?[1-9][\d]{0,15}$/,PHONE_INTERNATIONAL:/^\+?[1-9]\d{1,14}$/,PHONE_US:/^(\+1|1)?[-.\s]?\(?[0-9]{3}\)?[-.\s]?[0-9]{3}[-.\s]?[0-9]{4}$/,URL:/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)$/,ALPHANUMERIC:/^[a-zA-Z0-9]+$/,ALPHA:/^[a-zA-Z]+$/,NUMERIC:/^[0-9]+$/,DECIMAL:/^[0-9]+(\.[0-9]+)?$/,DATE_ISO:/^\d{4}-\d{2}-\d{2}$/,DATE_US:/^(0[1-9]|1[0-2])\/(0[1-9]|[12][0-9]|3[01])\/\d{4}$/,TIME_24H:/^([01]?[0-9]|2[0-3]):[0-5][0-9]$/,TIME_12H:/^(0?[1-9]|1[0-2]):[0-5][0-9]\s?(AM|PM|am|pm)$/,SKU:/^[A-Z0-9\-_]+$/,CURRENCY:/^\$?[0-9]+(\.[0-9]{2})?$/};static COMMON_RULES={email:()=>({field:"email",type:"format",options:{pattern:oe.PATTERNS.EMAIL},message:"Invalid email format"}),phone:()=>({field:"phone",type:"format",options:{pattern:oe.PATTERNS.PHONE},message:"Invalid phone number format"}),currency:()=>({field:"amount",type:"format",options:{pattern:oe.PATTERNS.CURRENCY},message:"Invalid currency format (e.g., 123.45 or $123.45)"}),sku:()=>({field:"sku",type:"format",options:{pattern:oe.PATTERNS.SKU},message:"SKU must contain only uppercase letters, numbers, hyphens, and underscores"}),positiveNumber:s=>({field:s,type:"range",options:{min:0},message:"Value must be a positive number"}),percentage:s=>({field:s,type:"range",options:{min:0,max:100},message:"Percentage must be between 0 and 100"})};static isValidEmail(s){return this.PATTERNS.EMAIL.test(s)}static isValidPhone(s){return this.PATTERNS.PHONE.test(s)}static isValidDate(s){if(!s)return!1;const t=new Date(s);return!isNaN(t.getTime())}static isValidNumber(s,t,a){const n=Number(s);return!(isNaN(n)||t!==void 0&&n<t||a!==void 0&&n>a)}static isValidStringLength(s,t,a){return!(typeof s!="string"||t!==void 0&&s.length<t||a!==void 0&&s.length>a)}static isOneOf(s,t){return t.includes(s)}static isUnique(s,t,a,n){return a.filter((l,u)=>n!==void 0&&u===n?!1:l[t]===s).length===0}static sanitizeValue(s){if(typeof s=="string"){if(s=s.trim(),s==="")return null;s=s.replace(/[\u200B-\u200D\uFEFF]/g,""),s=s.replace(/\u00A0/g," ")}return s}static convertType(s,t){if(s==null)return null;switch(t){case"string":return String(s);case"number":const a=Number(s);return isNaN(a)?null:a;case"boolean":if(typeof s=="boolean")return s;if(typeof s=="string"){const i=s.toLowerCase();if(["true","1","yes","y","on"].includes(i))return!0;if(["false","0","no","n","off"].includes(i))return!1}return!!s;case"date":const n=new Date(s);return isNaN(n.getTime())?null:n;default:return s}}static formatErrorMessage(s,t,a){if(t.message)return t.message;switch(t.type){case"required":return`${s} is required`;case"format":return`${s} has invalid format`;case"range":return t.options?.min!==void 0&&t.options?.max!==void 0?`${s} must be between ${t.options.min} and ${t.options.max}`:t.options?.min!==void 0?`${s} must be at least ${t.options.min}`:t.options?.max!==void 0?`${s} must be at most ${t.options.max}`:`${s} is out of range`;case"unique":return`${s} must be unique (duplicate value: ${a})`;default:return`${s} validation failed`}}static createRulesForDataType(s,t,a=!1){const n=[];switch(a&&n.push({field:s,type:"required",message:`${s} is required`}),t.toLowerCase()){case"email":n.push(this.COMMON_RULES.email());break;case"phone":n.push(this.COMMON_RULES.phone());break;case"currency":case"money":n.push(this.COMMON_RULES.currency());break;case"sku":n.push(this.COMMON_RULES.sku());break;case"percentage":n.push(this.COMMON_RULES.percentage(s));break;case"positive_number":n.push(this.COMMON_RULES.positiveNumber(s));break;case"date":n.push({field:s,type:"custom",validator:i=>this.isValidDate(i),message:"Invalid date format"});break;case"url":n.push({field:s,type:"format",options:{pattern:this.PATTERNS.URL},message:"Invalid URL format"});break}return n}static createForeignKeyRule(s,t,a="id",n){return{field:s,type:"custom",validator:i=>i?t.some(l=>l[a]===i):!0,message:n||`${s} must reference a valid ${a}`}}static createConditionalRule(s,t,a){return{...a,field:s,validator:(n,i)=>{if(!t(i))return!0;if(a.validator)return a.validator(n,i);switch(a.type){case"required":return n!=null&&n!=="";case"format":return a.options?.pattern?a.options.pattern.test(String(n)):!0;default:return!0}}}}}class mo{constructor(s){this.field=s,this.rule={field:s}}rule;required(){return this.rule.type="required",this.rule.message=`${this.field} is required`,this}email(){return this.rule.type="format",this.rule.options={pattern:oe.PATTERNS.EMAIL},this.rule.message="Invalid email format",this}phone(){return this.rule.type="format",this.rule.options={pattern:oe.PATTERNS.PHONE},this.rule.message="Invalid phone number format",this}number(s,t){return this.rule.type="range",this.rule.options={min:s,max:t},s!==void 0&&t!==void 0?this.rule.message=`Must be between ${s} and ${t}`:s!==void 0?this.rule.message=`Must be at least ${s}`:t!==void 0&&(this.rule.message=`Must be at most ${t}`),this}string(s,t){return this.rule.type="custom",this.rule.validator=a=>oe.isValidStringLength(String(a),s,t),s!==void 0&&t!==void 0?this.rule.message=`Must be between ${s} and ${t} characters`:s!==void 0?this.rule.message=`Must be at least ${s} characters`:t!==void 0&&(this.rule.message=`Must be at most ${t} characters`),this}date(){return this.rule.type="custom",this.rule.validator=s=>oe.isValidDate(s),this.rule.message="Invalid date format",this}boolean(){return this.rule.type="custom",this.rule.validator=s=>{if(typeof s=="boolean")return!0;if(typeof s=="string"){const t=s.toLowerCase();return["true","false","1","0","yes","no","y","n"].includes(t)}return!1},this.rule.message="Must be a valid boolean value (true/false, yes/no, 1/0)",this}oneOf(s){return this.rule.type="custom",this.rule.validator=t=>oe.isOneOf(t,s),this.rule.message=`Must be one of: ${s.join(", ")}`,this}pattern(s,t){return this.rule.type="format",this.rule.options={pattern:s},this.rule.message=t||"Invalid format",this}unique(){return this.rule.type="unique",this.rule.message=`${this.field} must be unique`,this}custom(s,t){return this.rule.type="custom",this.rule.validator=(a,n,i)=>{const l={row:n||{},rowNumber:n&&n._rowNumber||0,allData:i||[],fieldName:this.field};return s(a,l)},this.rule.message=t||"Custom validation failed",this}build(){return this.rule}}const ho=r=>{try{if(!r)return"No Date";const s=new Date(r);if(isNaN(s.getTime()))return console.warn("Invalid date value:",r),"Invalid Date";const t=String(s.getDate()).padStart(2,"0"),a=String(s.getMonth()+1).padStart(2,"0"),n=s.getFullYear();return`${t}/${a}/${n}`}catch(s){return console.error("Date formatting error:",s,"Input:",r),"Invalid Date"}},ua=r=>{try{if(!r)return console.warn("formatTableDate: Empty date value received"),"No Date";if(r==="Invalid Date"||r==="NaN")return console.warn("formatTableDate: Invalid date string received:",r),"Invalid Date";let s;if(typeof r=="string"&&/^\d{2}\/\d{2}\/\d{4}$/.test(r)){const[l,u,c]=r.split("/");s=new Date(`${c}-${u}-${l}`)}else s=new Date(r);if(isNaN(s.getTime()))return console.warn("formatTableDate: Could not parse date:",r,"Type:",typeof r),"Invalid Date";const t=String(s.getDate()).padStart(2,"0"),a=String(s.getMonth()+1).padStart(2,"0"),n=s.getFullYear(),i=`${t}/${a}/${n}`;return console.log("ðŸ“… formatTableDate:",{input:r,output:i}),i}catch(s){return console.error("formatTableDate: Error formatting date:",s,"Input:",r),"Invalid Date"}},mt=r=>ho(r),po={pageName:"stocks",exportEnabled:!0,importEnabled:!0,sortableColumns:["name","sku","category","unit","openingBalance","createdAt"],exportColumns:[{dataKey:"name",exportHeader:"Stock Name",required:!0},{dataKey:"sku",exportHeader:"SKU",required:!0},{dataKey:"category",exportHeader:"Category"},{dataKey:"unit",exportHeader:"Unit",required:!0},{dataKey:"openingBalance",exportHeader:"Opening Balance",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"description",exportHeader:"Description"},{dataKey:"createdAt",exportHeader:"Created Date",dataType:"date",formatter:r=>mt(r)}],importValidation:[oe.field("name").required().string(1,100).build(),oe.field("sku").required().pattern(oe.PATTERNS.SKU).build(),oe.field("unit").required().oneOf(["kg","g","l","ml","pcs","box","pack"]).build(),oe.field("openingBalance").number(0).build(),oe.field("category").string(0,50).build()],tableColumns:[{key:"name",label:"Stock Name",sortable:!0,dataType:"string"},{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"category",label:"Category",sortable:!0,dataType:"string"},{key:"unit",label:"Unit",sortable:!0,dataType:"string"},{key:"openingBalance",label:"Opening Balance",sortable:!0,dataType:"number",align:"right"},{key:"createdAt",label:"Created",sortable:!0,dataType:"date"}]},xo={pageName:"products",exportEnabled:!0,importEnabled:!0,sortableColumns:["name","sku","category","price","createdAt"],exportColumns:[{dataKey:"name",exportHeader:"Product Name",required:!0},{dataKey:"sku",exportHeader:"SKU",required:!0},{dataKey:"category",exportHeader:"Category"},{dataKey:"price",exportHeader:"Price",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"description",exportHeader:"Description"},{dataKey:"isActive",exportHeader:"Active",dataType:"boolean",formatter:r=>r?"Yes":"No"},{dataKey:"createdAt",exportHeader:"Created Date",dataType:"date",formatter:r=>mt(r)}],importValidation:[oe.field("name").required().string(1,100).build(),oe.field("sku").required().pattern(oe.PATTERNS.SKU).build(),oe.field("price").number(0).build(),oe.field("category").string(0,50).build(),oe.field("isActive").boolean().build()],tableColumns:[{key:"name",label:"Product Name",sortable:!0,dataType:"string"},{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"category",label:"Category",sortable:!0,dataType:"string"},{key:"price",label:"Price",sortable:!0,dataType:"number",align:"right"},{key:"isActive",label:"Active",sortable:!0,dataType:"boolean"},{key:"createdAt",label:"Created",sortable:!0,dataType:"date"}]},go={pageName:"raw-products",exportEnabled:!0,importEnabled:!0,sortableColumns:["name","sku","unit","costPerUnit","createdAt"],exportColumns:[{dataKey:"name",exportHeader:"Raw Product Name",required:!0},{dataKey:"sku",exportHeader:"SKU",required:!0},{dataKey:"unit",exportHeader:"Unit",required:!0},{dataKey:"costPerUnit",exportHeader:"Cost Per Unit",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"description",exportHeader:"Description"},{dataKey:"createdAt",exportHeader:"Created Date",dataType:"date",formatter:r=>mt(r)}],importValidation:[oe.field("name").required().string(1,100).build(),oe.field("sku").required().pattern(oe.PATTERNS.SKU).build(),oe.field("unit").required().oneOf(["kg","g","l","ml","pcs","box","pack"]).build(),oe.field("costPerUnit").number(0).build()],tableColumns:[{key:"name",label:"Raw Product Name",sortable:!0,dataType:"string"},{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"unit",label:"Unit",sortable:!0,dataType:"string"},{key:"costPerUnit",label:"Cost Per Unit",sortable:!0,dataType:"number",align:"right"},{key:"createdAt",label:"Created",sortable:!0,dataType:"date"}]},fo={pageName:"staff",exportEnabled:!0,importEnabled:!0,sortableColumns:["name","email","phone","role","isActive","createdAt"],exportColumns:[{dataKey:"name",exportHeader:"Staff Name",required:!0},{dataKey:"email",exportHeader:"Email",required:!0},{dataKey:"phone",exportHeader:"Phone"},{dataKey:"role",exportHeader:"Role",required:!0},{dataKey:"department",exportHeader:"Department"},{dataKey:"isActive",exportHeader:"Active",dataType:"boolean",formatter:r=>r?"Yes":"No"},{dataKey:"createdAt",exportHeader:"Created Date",dataType:"date",formatter:r=>mt(r)}],importValidation:[oe.field("name").required().string(1,100).build(),oe.field("email").required().email().build(),oe.field("phone").phone().build(),oe.field("role").required().oneOf(["admin","manager","operator","viewer"]).build(),oe.field("department").string(0,50).build(),oe.field("isActive").boolean().build()],tableColumns:[{key:"name",label:"Staff Name",sortable:!0,dataType:"string"},{key:"email",label:"Email",sortable:!0,dataType:"string"},{key:"phone",label:"Phone",sortable:!0,dataType:"string"},{key:"role",label:"Role",sortable:!0,dataType:"string"},{key:"isActive",label:"Active",sortable:!0,dataType:"boolean"},{key:"createdAt",label:"Created",sortable:!0,dataType:"date"}]},jo={pageName:"vendors",exportEnabled:!0,importEnabled:!0,sortableColumns:["name","email","phone","contactPerson","isActive","createdAt"],exportColumns:[{dataKey:"name",exportHeader:"Vendor Name",required:!0},{dataKey:"email",exportHeader:"Email"},{dataKey:"phone",exportHeader:"Phone"},{dataKey:"contactPerson",exportHeader:"Contact Person"},{dataKey:"address",exportHeader:"Address"},{dataKey:"isActive",exportHeader:"Active",dataType:"boolean",formatter:r=>r?"Yes":"No"},{dataKey:"createdAt",exportHeader:"Created Date",dataType:"date",formatter:r=>mt(r)}],importValidation:[oe.field("name").required().string(1,100).build(),oe.field("email").email().build(),oe.field("phone").phone().build(),oe.field("contactPerson").string(0,100).build(),oe.field("address").string(0,200).build(),oe.field("isActive").boolean().build()],tableColumns:[{key:"name",label:"Vendor Name",sortable:!0,dataType:"string"},{key:"email",label:"Email",sortable:!0,dataType:"string"},{key:"phone",label:"Phone",sortable:!0,dataType:"string"},{key:"contactPerson",label:"Contact Person",sortable:!0,dataType:"string"},{key:"isActive",label:"Active",sortable:!0,dataType:"boolean"},{key:"createdAt",label:"Created",sortable:!0,dataType:"date"}]},yo={pageName:"processes",exportEnabled:!0,importEnabled:!0,sortableColumns:["name","description","estimatedTime","isActive","createdAt"],exportColumns:[{dataKey:"name",exportHeader:"Process Name",required:!0},{dataKey:"description",exportHeader:"Description"},{dataKey:"estimatedTime",exportHeader:"Estimated Time (minutes)",dataType:"number"},{dataKey:"isActive",exportHeader:"Active",dataType:"boolean",formatter:r=>r?"Yes":"No"},{dataKey:"createdAt",exportHeader:"Created Date",dataType:"date",formatter:r=>mt(r)}],importValidation:[oe.field("name").required().string(1,100).build(),oe.field("description").string(0,500).build(),oe.field("estimatedTime").number(0).build(),oe.field("isActive").boolean().build()],tableColumns:[{key:"name",label:"Process Name",sortable:!0,dataType:"string"},{key:"description",label:"Description",sortable:!0,dataType:"string"},{key:"estimatedTime",label:"Est. Time (min)",sortable:!0,dataType:"number",align:"right"},{key:"isActive",label:"Active",sortable:!0,dataType:"boolean"},{key:"createdAt",label:"Created",sortable:!0,dataType:"date"}]},vo={pageName:"sales-channels",exportEnabled:!0,importEnabled:!0,sortableColumns:["name","type","commission","isActive","createdAt"],exportColumns:[{dataKey:"name",exportHeader:"Channel Name",required:!0},{dataKey:"type",exportHeader:"Type",required:!0},{dataKey:"commission",exportHeader:"Commission (%)",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"description",exportHeader:"Description"},{dataKey:"isActive",exportHeader:"Active",dataType:"boolean",formatter:r=>r?"Yes":"No"},{dataKey:"createdAt",exportHeader:"Created Date",dataType:"date",formatter:r=>mt(r)}],importValidation:[oe.field("name").required().string(1,100).build(),oe.field("type").required().oneOf(["online","retail","wholesale","distributor"]).build(),oe.field("commission").number(0,100).build(),oe.field("description").string(0,500).build(),oe.field("isActive").boolean().build()],tableColumns:[{key:"name",label:"Channel Name",sortable:!0,dataType:"string"},{key:"type",label:"Type",sortable:!0,dataType:"string"},{key:"commission",label:"Commission (%)",sortable:!0,dataType:"number",align:"right"},{key:"isActive",label:"Active",sortable:!0,dataType:"boolean"},{key:"createdAt",label:"Created",sortable:!0,dataType:"date"}]},bo={pageName:"sales-units",exportEnabled:!0,importEnabled:!0,sortableColumns:["date","productName","sku","units","status","remarks"],exportColumns:[{dataKey:"date",exportHeader:"Date",dataType:"date",formatter:r=>new Date(r).toLocaleDateString("en-GB")},{dataKey:"productName",exportHeader:"Product",required:!0},{dataKey:"sku",exportHeader:"SKU",required:!0},{dataKey:"units",exportHeader:"Units",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"status",exportHeader:"Status"},{dataKey:"remarks",exportHeader:"Remarks"}],importValidation:[oe.field("date").required().date().build(),oe.field("productName").required().string(1,100).build(),oe.field("sku").required().string(1,50).build(),oe.field("units").required().number(.01).build(),oe.field("status").string(0,50).build(),oe.field("remarks").string(0,500).build()],tableColumns:[{key:"date",label:"Date",sortable:!0,dataType:"date"},{key:"productName",label:"Product",sortable:!0,dataType:"string"},{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"units",label:"Units",sortable:!0,dataType:"number",align:"right"},{key:"status",label:"Status",sortable:!0,dataType:"string"},{key:"remarks",label:"Remarks",sortable:!0,dataType:"string"}]},No={pageName:"sales-record",exportEnabled:!0,importEnabled:!0,sortableColumns:["date","channelName","productName","sku","qty","rate","totalAmount","status","remarks"],exportColumns:[{dataKey:"date",exportHeader:"Date",dataType:"date",formatter:r=>new Date(r).toLocaleDateString("en-GB")},{dataKey:"channelName",exportHeader:"Sales Channel",required:!0},{dataKey:"productName",exportHeader:"Product",required:!0},{dataKey:"sku",exportHeader:"SKU",required:!0},{dataKey:"qty",exportHeader:"Qty",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"rate",exportHeader:"Rate",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"totalAmount",exportHeader:"Total Amount",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"status",exportHeader:"Status"},{dataKey:"remarks",exportHeader:"Remarks"}],importValidation:[oe.field("date").required().date().build(),oe.field("channelName").required().string(1,100).build(),oe.field("productName").required().string(1,100).build(),oe.field("sku").required().string(1,50).build(),oe.field("qty").required().number(.01).build(),oe.field("rate").required().number(.01).build(),oe.field("totalAmount").number(.01).build(),oe.field("status").string(0,50).build(),oe.field("remarks").string(0,500).build()],tableColumns:[{key:"date",label:"Date",sortable:!0,dataType:"date"},{key:"channelName",label:"Sales Channel",sortable:!0,dataType:"string"},{key:"productName",label:"Product",sortable:!0,dataType:"string"},{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"qty",label:"Qty",sortable:!0,dataType:"number",align:"right"},{key:"rate",label:"Rate",sortable:!0,dataType:"number",align:"right"},{key:"totalAmount",label:"Total Amount",sortable:!0,dataType:"number",align:"right"},{key:"status",label:"Status",sortable:!0,dataType:"string"},{key:"remarks",label:"Remarks",sortable:!0,dataType:"string"}]},wo={pageName:"purchases",exportEnabled:!0,importEnabled:!0,sortableColumns:["purchaseCode","date","vendorName","stockName","quantity","rate","totalAmount","status"],exportColumns:[{dataKey:"purchaseCode",exportHeader:"Purchase Code",required:!0},{dataKey:"date",exportHeader:"Date",dataType:"date",formatter:r=>new Date(r).toLocaleDateString("en-GB")},{dataKey:"vendorName",exportHeader:"Vendor Name",required:!0},{dataKey:"stockName",exportHeader:"Stock Name",required:!0},{dataKey:"quantity",exportHeader:"Quantity",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"rate",exportHeader:"Rate",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"totalAmount",exportHeader:"Total Amount",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"status",exportHeader:"Status"}],importValidation:[oe.field("purchaseCode").required().string(1,50).build(),oe.field("date").required().date().build(),oe.field("vendorName").required().string(1,100).build(),oe.field("stockName").required().string(1,100).build(),oe.field("quantity").required().number(.01).build(),oe.field("rate").required().number(.01).build(),oe.field("totalAmount").number(.01).build(),oe.field("status").string(0,50).build()],tableColumns:[{key:"purchaseCode",label:"Purchase Code",sortable:!0,dataType:"string"},{key:"date",label:"Date",sortable:!0,dataType:"date"},{key:"vendorName",label:"Vendor Name",sortable:!0,dataType:"string"},{key:"stockName",label:"Stock Name",sortable:!0,dataType:"string"},{key:"quantity",label:"Quantity",sortable:!0,dataType:"number",align:"right"},{key:"unitPrice",label:"Unit Price",sortable:!0,dataType:"number",align:"right"},{key:"totalAmount",label:"Total",sortable:!0,dataType:"number",align:"right"},{key:"purchaseDate",label:"Purchase Date",sortable:!0,dataType:"date"},{key:"vendorName",label:"Vendor",sortable:!0,dataType:"string"},{key:"createdAt",label:"Created",sortable:!0,dataType:"date"}]},So={pageName:"pre-production-tasks",exportEnabled:!0,importEnabled:!0,sortableColumns:["task_id","stock_name","stock_source","date_assigned","process_name","assigned_quantity","staff_name","date_completed","completed_quantity","wastage_quantity","status"],exportColumns:[{dataKey:"task_id",exportHeader:"Task ID",required:!0},{dataKey:"stock_name",exportHeader:"Stock Name",required:!0},{dataKey:"stock_source",exportHeader:"Stock Source"},{dataKey:"date_assigned",exportHeader:"Date Assigned",dataType:"date",formatter:r=>new Date(r).toLocaleDateString("en-GB")},{dataKey:"process_name",exportHeader:"Process",required:!0},{dataKey:"assigned_quantity",exportHeader:"Assigned Qty",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"staff_name",exportHeader:"Staff Name"},{dataKey:"date_completed",exportHeader:"Date Completed",dataType:"date",formatter:r=>r?new Date(r).toLocaleDateString("en-GB"):""},{dataKey:"completed_quantity",exportHeader:"Completed Qty",dataType:"number",formatter:r=>r?Number(r).toFixed(2):"0.00"},{dataKey:"wastage_quantity",exportHeader:"Wastage Qty",dataType:"number",formatter:r=>r?Number(r).toFixed(2):"0.00"},{dataKey:"remarks",exportHeader:"Remarks"},{dataKey:"status",exportHeader:"Status"}],importValidation:[oe.field("task_id").required().string(1,50).build(),oe.field("stock_name").required().string(1,100).build(),oe.field("assigned_quantity").required().number(.01).build(),oe.field("status").required().oneOf(["pending","in_progress","completed","cancelled"]).build(),oe.field("date_assigned").date().build(),oe.field("staff_name").string(0,100).build()],tableColumns:[{key:"task_id",label:"Task ID",sortable:!0,dataType:"string"},{key:"stock_name",label:"Stock Name",sortable:!0,dataType:"string"},{key:"stock_source",label:"Stock Source",sortable:!0,dataType:"string"},{key:"date_assigned",label:"Date Assigned",sortable:!0,dataType:"date"},{key:"process_name",label:"Process",sortable:!0,dataType:"string"},{key:"assigned_quantity",label:"Assigned Qty",sortable:!0,dataType:"number",align:"right"},{key:"staff_name",label:"Staff Name",sortable:!0,dataType:"string"},{key:"date_completed",label:"Date Completed",sortable:!0,dataType:"date"},{key:"completed_quantity",label:"Completed Qty",sortable:!0,dataType:"number",align:"right"},{key:"wastage_quantity",label:"Wastage Qty",sortable:!0,dataType:"number",align:"right"},{key:"status",label:"Status",sortable:!0,dataType:"string"}]},_o={pageName:"production-tasks",exportEnabled:!0,importEnabled:!0,sortableColumns:["task_id","date","raw_product_name","process_name","staff_name","assigned_quantity","wastage_quantity","status"],exportColumns:[{dataKey:"task_id",exportHeader:"Task ID",required:!0},{dataKey:"date",exportHeader:"Date",dataType:"date",formatter:r=>new Date(r).toLocaleDateString("en-GB")},{dataKey:"raw_product_name",exportHeader:"Raw Product",required:!0},{dataKey:"process_name",exportHeader:"Process",required:!0},{dataKey:"staff_name",exportHeader:"Staff Name"},{dataKey:"assigned_quantity",exportHeader:"Assigned Qty",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"wastage_quantity",exportHeader:"Wastage Qty",dataType:"number",formatter:r=>r?Number(r).toFixed(2):"0.00"},{dataKey:"status",exportHeader:"Status"}],importValidation:[oe.field("task_id").required().string(1,50).build(),oe.field("raw_product_name").required().string(1,100).build(),oe.field("process_name").required().string(1,100).build(),oe.field("assigned_quantity").required().number(.01).build(),oe.field("status").required().oneOf(["pending","in_progress","completed","cancelled"]).build(),oe.field("date").date().build(),oe.field("staff_name").string(0,100).build()],tableColumns:[{key:"task_id",label:"Task ID",sortable:!0,dataType:"string"},{key:"date",label:"Date",sortable:!0,dataType:"date"},{key:"raw_product_name",label:"Raw Product",sortable:!0,dataType:"string"},{key:"process_name",label:"Process",sortable:!0,dataType:"string"},{key:"assignedQuantity",label:"Quantity",sortable:!0,dataType:"number",align:"right"},{key:"assignedTo",label:"Assigned To",sortable:!0,dataType:"string"},{key:"status",label:"Status",sortable:!0,dataType:"string"},{key:"dueDate",label:"Due Date",sortable:!0,dataType:"date"},{key:"createdAt",label:"Created",sortable:!0,dataType:"date"}]},ko={pageName:"post-production-tasks",exportEnabled:!0,importEnabled:!0,sortableColumns:["task_id","date","date_completed","source_quantity","sku","product_name","process_name","staff_name","assigned_quantity","units","wastage_quantity","status"],exportColumns:[{dataKey:"task_id",exportHeader:"Task ID",required:!0},{dataKey:"date",exportHeader:"Date Assigned",dataType:"date",formatter:r=>new Date(r).toLocaleDateString("en-GB")},{dataKey:"date_completed",exportHeader:"Date Completed",dataType:"date",formatter:r=>r?new Date(r).toLocaleDateString("en-GB"):""},{dataKey:"source_quantity",exportHeader:"Source Qty",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"sku",exportHeader:"SKU",required:!0},{dataKey:"product_name",exportHeader:"Product",required:!0},{dataKey:"process_name",exportHeader:"Process",required:!0},{dataKey:"staff_name",exportHeader:"Staff Name"},{dataKey:"assigned_quantity",exportHeader:"Assigned Units",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"units",exportHeader:"Completed Units",dataType:"number",formatter:r=>r?Number(r).toFixed(2):"0.00"},{dataKey:"wastage_quantity",exportHeader:"Wastage Qty",dataType:"number",formatter:r=>r?Number(r).toFixed(2):"0.00"},{dataKey:"remarks",exportHeader:"Remarks"},{dataKey:"status",exportHeader:"Status"}],importValidation:[oe.field("task_id").required().string(1,50).build(),oe.field("product_name").required().string(1,100).build(),oe.field("sku").required().string(1,50).build(),oe.field("process_name").required().string(1,100).build(),oe.field("source_quantity").required().number(.01).build(),oe.field("assigned_quantity").required().number(.01).build(),oe.field("status").required().oneOf(["pending","in_progress","completed","cancelled"]).build(),oe.field("date").date().build(),oe.field("staff_name").string(0,100).build()],tableColumns:[{key:"task_id",label:"Task ID",sortable:!0,dataType:"string"},{key:"date",label:"Date Assigned",sortable:!0,dataType:"date"},{key:"date_completed",label:"Date Completed",sortable:!0,dataType:"date"},{key:"source_quantity",label:"Source Qty",sortable:!0,dataType:"number",align:"right"},{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"product_name",label:"Product",sortable:!0,dataType:"string"},{key:"process_name",label:"Process",sortable:!0,dataType:"string"},{key:"staff_name",label:"Staff Name",sortable:!0,dataType:"string"},{key:"assigned_quantity",label:"Assigned Units",sortable:!0,dataType:"number",align:"right"},{key:"units",label:"Completed Units",sortable:!0,dataType:"number",align:"right"},{key:"wastage_quantity",label:"Wastage Qty",sortable:!0,dataType:"number",align:"right"},{key:"status",label:"Status",sortable:!0,dataType:"string"}]},Co={pageName:"stock-status",exportEnabled:!0,importEnabled:!1,sortableColumns:["stockName","openingBalance","purchases","sales","closingBalance"],exportColumns:[{dataKey:"stockName",exportHeader:"Stock Name"},{dataKey:"openingBalance",exportHeader:"Opening Balance",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"purchases",exportHeader:"Purchases",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"sales",exportHeader:"Sales",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"closingBalance",exportHeader:"Closing Balance",dataType:"number",formatter:r=>Number(r).toFixed(2)}],importValidation:[],tableColumns:[{key:"stockName",label:"Stock Name",sortable:!0,dataType:"string"},{key:"openingBalance",label:"Opening Balance",sortable:!0,dataType:"number",align:"right"},{key:"purchases",label:"Purchases",sortable:!0,dataType:"number",align:"right"},{key:"sales",label:"Sales",sortable:!0,dataType:"number",align:"right"},{key:"closingBalance",label:"Closing Balance",sortable:!0,dataType:"number",align:"right"}]},Po={pageName:"inventory-status",exportEnabled:!0,importEnabled:!1,sortableColumns:["stockName","openingBalance","salesUnits","soldUnits","closingBalance"],exportColumns:[{dataKey:"stockName",exportHeader:"Stock Name"},{dataKey:"openingBalance",exportHeader:"Opening Balance",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"salesUnits",exportHeader:"Sales Units",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"soldUnits",exportHeader:"Sold Units",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"closingBalance",exportHeader:"Closing Balance",dataType:"number",formatter:r=>Number(r).toFixed(2)}],importValidation:[],tableColumns:[{key:"stockName",label:"Stock Name",sortable:!0,dataType:"string"},{key:"openingBalance",label:"Opening Balance",sortable:!0,dataType:"number",align:"right"},{key:"salesUnits",label:"Sales Units",sortable:!0,dataType:"number",align:"right"},{key:"soldUnits",label:"Sold Units",sortable:!0,dataType:"number",align:"right"},{key:"closingBalance",label:"Closing Balance",sortable:!0,dataType:"number",align:"right"}]},ln={stocks:po,products:xo,"raw-products":go,staff:fo,vendors:jo,processes:yo,"sales-channels":vo,"sales-units":bo,"sales-record":No,purchases:wo,"pre-production-tasks":So,"production-tasks":_o,"post-production-tasks":ko,"stock-status":Co,"inventory-status":Po},To=r=>ln[r],Eo={defaultExportFormat:"xlsx",maxImportFileSize:50,defaultBatchSize:100,enableProgressTracking:!0,autoRefreshInterval:300,cacheTimeout:30,enableValidationWarnings:!0,defaultSortDirection:"asc",enableMultiSort:!1,maxExportRows:1e5,enableBackgroundExport:!0},cn=m.createContext(void 0),Do=({children:r,initialSettings:s={}})=>{const[t,a]=m.useState({}),[n,i]=m.useState({...Eo,...s}),[l,u]=m.useState(!1),[c,o]=m.useState(null);m.useEffect(()=>{try{const C=localStorage.getItem("dataManagementSettings");if(C){const B=JSON.parse(C);i(A=>({...A,...B}))}}catch(C){console.warn("Failed to load saved settings:",C)}},[]),m.useEffect(()=>{try{localStorage.setItem("dataManagementSettings",JSON.stringify(n))}catch(C){console.warn("Failed to save settings:",C)}},[n]),m.useEffect(()=>{if(n.autoRefreshInterval>0){const C=setInterval(()=>{d()},n.autoRefreshInterval*1e3);return()=>clearInterval(C)}},[n.autoRefreshInterval]);const d=()=>{const C=Date.now(),B=n.cacheTimeout*60*1e3;a(A=>{const S={...A};return Object.keys(S).forEach(h=>{C-S[h].timestamp>B&&delete S[h]}),S})},x=m.useCallback(C=>{try{const B=t[C],A=Date.now(),S=n.cacheTimeout*60*1e3;if(B&&A-B.timestamp<S)return B.config;const h=To(C);return h&&setTimeout(()=>{a(F=>({...F,[C]:{config:h,timestamp:A}}))},0),h}catch(B){o(`Failed to get configuration for ${C}: ${B instanceof Error?B.message:"Unknown error"}`);return}},[t,n.cacheTimeout]),y=(C,B)=>{try{const A=x(C);if(!A)throw new Error(`Configuration not found for page: ${C}`);const S={...A,...B};a(h=>({...h,[C]:{config:S,timestamp:Date.now()}})),ln[C]=S,o(null)}catch(A){o(`Failed to update configuration for ${C}: ${A instanceof Error?A.message:"Unknown error"}`)}},b=C=>{try{a(B=>{const A={...B};return delete A[C],A}),o(null)}catch(B){o(`Failed to reset configuration for ${C}: ${B instanceof Error?B.message:"Unknown error"}`)}},T=C=>x(C)?.exportEnabled||!1,O=C=>x(C)?.importEnabled||!1,g=C=>x(C)?.exportColumns||[],w=C=>x(C)?.tableColumns||[],P=C=>x(C)?.importValidation||[],D=C=>{i(B=>({...B,...C})),o(null)},_=()=>{a({}),o(null)},Q={getConfig:x,updateConfig:y,resetConfig:b,canExport:T,canImport:O,getExportColumns:g,getTableColumns:w,getValidationRules:P,globalSettings:n,updateGlobalSettings:D,clearCache:_,refreshConfig:C=>{C?a(B=>{const A={...B};return delete A[C],A}):_(),o(null)},isLoading:l,error:c};return e.jsx(cn.Provider,{value:Q,children:r})},Ia=()=>{const r=m.useContext(cn);if(r===void 0)throw new Error("useDataManagement must be used within a DataManagementProvider");return r},_s=r=>{const{getConfig:s,updateConfig:t,resetConfig:a,canExport:n,canImport:i}=Ia(),l=s(r);return{config:l,canExport:n(r),canImport:i(r),updateConfig:u=>t(r,u),resetConfig:()=>a(r),isConfigured:!!l}},ks=r=>{const{getValidationRules:s,canImport:t,globalSettings:a}=Ia();return{validationRules:s(r),canImport:t(r),maxFileSize:a.maxImportFileSize,batchSize:a.defaultBatchSize,enableWarnings:a.enableValidationWarnings}},Ro=r=>{const{getTableColumns:s,globalSettings:t}=Ia();return{columns:s(r),defaultSortDirection:t.defaultSortDirection,enableMultiSort:t.enableMultiSort}},Pa=ut("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),L=m.forwardRef(({className:r,variant:s,size:t,asChild:a=!1,...n},i)=>{const l=a?_t:"button";return e.jsx(l,{className:ie(Pa({variant:s,size:t,className:r})),ref:i,...n})});L.displayName="Button";const qo=ut("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),Je=m.forwardRef(({className:r,variant:s,...t},a)=>e.jsx("div",{ref:a,role:"alert",className:ie(qo({variant:s}),r),...t}));Je.displayName="Alert";const Ao=m.forwardRef(({className:r,...s},t)=>e.jsx("h5",{ref:t,className:ie("mb-1 font-medium leading-none tracking-tight",r),...s}));Ao.displayName="AlertTitle";const Xe=m.forwardRef(({className:r,...s},t)=>e.jsx("div",{ref:t,className:ie("text-sm [&_p]:leading-relaxed",r),...s}));Xe.displayName="AlertDescription";class Fo{isDevelopment=!1;isVerbose=!1;log(...s){this.isDevelopment&&console.log(...s)}verbose(...s){this.isDevelopment&&this.isVerbose&&console.log(...s)}warn(...s){this.isDevelopment&&console.warn(...s)}error(...s){console.error(...s),this.isDevelopment}logWithContext(s,t,a){if(this.isDevelopment){const n=this.formatContext(t);console.log(`${n} ${s}`,a||"")}}performance(s,t){if(this.isDevelopment){console.time(s);const a=t();return console.timeEnd(s),a}return t()}async performanceAsync(s,t){if(this.isDevelopment){console.time(s);const a=await t();return console.timeEnd(s),a}return t()}group(s,t){this.isDevelopment&&(console.group(s),t(),console.groupEnd())}table(s){this.isDevelopment&&console.table(s)}json(s,t){this.isDevelopment&&console.log(`${s}:`,JSON.stringify(t,null,2))}assert(s,t){this.isDevelopment&&!s&&console.error(`Assertion failed: ${t}`)}formatContext(s){const t=[];return s.component&&t.push(`[${s.component}]`),s.hook&&t.push(`[${s.hook}]`),s.service&&t.push(`[${s.service}]`),t.join(" ")}}const hs=new Fo;hs.performance.bind(hs);hs.performanceAsync.bind(hs);hs.group.bind(hs);hs.table.bind(hs);hs.json.bind(hs);function $o(){const[r,s]=m.useState(null),[t,a]=m.useState(!1),[n,i]=m.useState(!1),[l,u]=m.useState(navigator.onLine),[c,o]=m.useState(!1);return m.useEffect(()=>{window.matchMedia("(display-mode: standalone)").matches&&i(!0);const y=g=>{g.preventDefault(),s(g),a(!0)},b=()=>{i(!0),a(!1),s(null)},T=()=>u(!0),O=()=>u(!1);return window.addEventListener("beforeinstallprompt",y),window.addEventListener("appinstalled",b),window.addEventListener("online",T),window.addEventListener("offline",O),"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").then(g=>{hs.log("Service Worker registered:",g),g.addEventListener("updatefound",()=>{const w=g.installing;w&&w.addEventListener("statechange",()=>{w.state==="installed"&&navigator.serviceWorker.controller&&o(!0)})})}).catch(g=>{console.error("Service Worker registration failed:",g)}),()=>{window.removeEventListener("beforeinstallprompt",y),window.removeEventListener("appinstalled",b),window.removeEventListener("online",T),window.removeEventListener("offline",O)}},[]),{isInstallable:t,isInstalled:n,isOnline:l,updateAvailable:c,installApp:async()=>{if(!r)return!1;try{await r.prompt();const{outcome:y}=await r.userChoice;return y==="accepted"?(s(null),a(!1),!0):!1}catch(y){return console.error("Error installing app:",y),!1}},updateApp:()=>{"serviceWorker"in navigator&&navigator.serviceWorker.getRegistration().then(y=>{y&&y.waiting&&(y.waiting.postMessage({type:"SKIP_WAITING"}),window.location.reload())})}}}function Lo(){const{isInstallable:r,isInstalled:s,isOnline:t,updateAvailable:a,installApp:n,updateApp:i}=$o(),{toast:l}=Ie(),[u,c]=m.useState(!1),[o,d]=m.useState(!1);m.useEffect(()=>{if(r&&!s&&!localStorage.getItem("pwa-install-dismissed")){const O=setTimeout(()=>{c(!0)},3e4);return()=>clearTimeout(O)}},[r,s]),m.useEffect(()=>{a&&d(!0)},[a]);const x=async()=>{await n()&&(c(!1),l({title:"App installed!",description:"Molaga ERP has been added to your home screen"}))},y=()=>{c(!1),localStorage.setItem("pwa-install-dismissed","true")},b=()=>{i(),d(!1)};return t?o?e.jsx("div",{className:"fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-96 z-50",children:e.jsxs(Je,{className:"bg-blue-50 border-blue-200",children:[e.jsx(Ea,{className:"h-4 w-4 text-blue-600"}),e.jsx(Xe,{className:"text-blue-800",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"New version available!"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(L,{size:"sm",variant:"outline",onClick:()=>d(!1),className:"h-7",children:"Later"}),e.jsx(L,{size:"sm",onClick:b,className:"h-7 bg-blue-600 hover:bg-blue-700",children:"Update"})]})]})})]})}):u&&!s?e.jsx("div",{className:"fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-96 z-50",children:e.jsxs(Je,{className:"bg-primary/5 border-primary/20",children:[e.jsx(dt,{className:"h-4 w-4 text-primary"}),e.jsxs(Xe,{children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-foreground mb-1",children:"Install Molaga ERP"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Add to your home screen for quick access and offline use"})]}),e.jsx(L,{size:"sm",variant:"ghost",onClick:y,className:"h-6 w-6 p-0",children:e.jsx(yt,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx(L,{size:"sm",variant:"outline",onClick:y,className:"flex-1",children:"Not now"}),e.jsx(L,{size:"sm",onClick:x,className:"flex-1 bg-primary hover:bg-primary/90",children:"Install"})]})]})]})}):null:e.jsx("div",{className:"fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-96 z-50",children:e.jsxs(Je,{className:"bg-orange-50 border-orange-200",children:[e.jsx(On,{className:"h-4 w-4 text-orange-600"}),e.jsx(Xe,{className:"text-orange-800",children:"You're offline. Some features may be limited."})]})})}const ya=768;function Io(){const[r,s]=m.useState(void 0);return m.useEffect(()=>{const t=window.matchMedia(`(max-width: ${ya-1}px)`),a=()=>{s(window.innerWidth<ya)};return t.addEventListener("change",a),s(window.innerWidth<ya),()=>t.removeEventListener("change",a)},[]),!!r}const z=m.forwardRef(({className:r,type:s,...t},a)=>e.jsx("input",{type:s,className:ie("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:a,...t}));z.displayName="Input";const ma=m.forwardRef(({className:r,orientation:s="horizontal",decorative:t=!0,...a},n)=>e.jsx(Sr,{ref:n,decorative:t,orientation:s,className:ie("shrink-0 bg-border",s==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",r),...a}));ma.displayName=Sr.displayName;const Mo=kr,Uo=Cr,dn=m.forwardRef(({className:r,...s},t)=>e.jsx(ia,{className:ie("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r),...s,ref:t}));dn.displayName=ia.displayName;const Oo=ut("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),un=m.forwardRef(({side:r="right",className:s,children:t,...a},n)=>e.jsxs(Uo,{children:[e.jsx(dn,{}),e.jsxs(oa,{ref:n,className:ie(Oo({side:r}),s),...a,children:[t,e.jsxs(_r,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-secondary hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[e.jsx(yt,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));un.displayName=oa.displayName;const Ko=m.forwardRef(({className:r,...s},t)=>e.jsx(la,{ref:t,className:ie("text-lg font-semibold text-foreground",r),...s}));Ko.displayName=la.displayName;const Vo=m.forwardRef(({className:r,...s},t)=>e.jsx(ca,{ref:t,className:ie("text-sm text-muted-foreground",r),...s}));Vo.displayName=ca.displayName;function Ya({className:r,...s}){return e.jsx("div",{className:ie("animate-pulse rounded-md bg-muted",r),...s})}const Bo="sidebar:state",Qo=60*60*24*7,Ho="16rem",zo="18rem",Yo="3rem",Wo="b",mn=m.createContext(null);function Mt(){const r=m.useContext(mn);if(!r)throw new Error("useSidebar must be used within a SidebarProvider.");return r}const hn=m.forwardRef(({defaultOpen:r=!0,open:s,onOpenChange:t,className:a,style:n,children:i,...l},u)=>{const c=Io(),[o,d]=m.useState(!1),[x,y]=m.useState(r),b=s??x,T=m.useCallback(P=>{const D=typeof P=="function"?P(b):P;t?t(D):y(D),document.cookie=`${Bo}=${D}; path=/; max-age=${Qo}`},[t,b]),O=m.useCallback(()=>c?d(P=>!P):T(P=>!P),[c,T,d]);m.useEffect(()=>{const P=D=>{D.key===Wo&&(D.metaKey||D.ctrlKey)&&(D.preventDefault(),O())};return window.addEventListener("keydown",P),()=>window.removeEventListener("keydown",P)},[O]);const g=b?"expanded":"collapsed",w=m.useMemo(()=>({state:g,open:b,setOpen:T,isMobile:c,openMobile:o,setOpenMobile:d,toggleSidebar:O}),[g,b,T,c,o,d,O]);return e.jsx(mn.Provider,{value:w,children:e.jsx(rn,{delayDuration:0,children:e.jsx("div",{style:{"--sidebar-width":Ho,"--sidebar-width-icon":Yo,...n},className:ie("group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar",a),ref:u,...l,children:i})})})});hn.displayName="SidebarProvider";const pn=m.forwardRef(({side:r="left",variant:s="sidebar",collapsible:t="offcanvas",className:a,children:n,...i},l)=>{const{isMobile:u,state:c,openMobile:o,setOpenMobile:d}=Mt();return t==="none"?e.jsx("div",{className:ie("flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground",a),ref:l,...i,children:n}):u?e.jsx(Mo,{open:o,onOpenChange:d,...i,children:e.jsx(un,{"data-sidebar":"sidebar","data-mobile":"true",className:"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden",style:{"--sidebar-width":zo},side:r,children:e.jsx("div",{className:"flex h-full w-full flex-col",children:n})})}):e.jsxs("div",{ref:l,className:"group peer hidden text-sidebar-foreground md:block","data-state":c,"data-collapsible":c==="collapsed"?t:"","data-variant":s,"data-side":r,children:[e.jsx("div",{className:ie("relative h-svh w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear","group-data-[collapsible=offcanvas]:w-0","group-data-[side=right]:rotate-180",s==="floating"||s==="inset"?"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon]")}),e.jsx("div",{className:ie("fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex",r==="left"?"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]":"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]",s==="floating"||s==="inset"?"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l",a),...i,children:e.jsx("div",{"data-sidebar":"sidebar",className:"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow",children:n})})]})});pn.displayName="Sidebar";const xn=m.forwardRef(({className:r,onClick:s,...t},a)=>{const{toggleSidebar:n}=Mt();return e.jsxs(L,{ref:a,"data-sidebar":"trigger",variant:"ghost",size:"icon",className:ie("h-7 w-7",r),onClick:i=>{s?.(i),n()},...t,children:[e.jsx(Kn,{}),e.jsx("span",{className:"sr-only",children:"Toggle Sidebar"})]})});xn.displayName="SidebarTrigger";const Go=m.forwardRef(({className:r,...s},t)=>{const{toggleSidebar:a}=Mt();return e.jsx("button",{ref:t,"data-sidebar":"rail","aria-label":"Toggle Sidebar",tabIndex:-1,onClick:a,title:"Toggle Sidebar",className:ie("absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] group-data-[side=left]:-right-4 group-data-[side=right]:left-0 hover:after:bg-sidebar-border sm:flex","[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize","[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize","group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar","[[data-side=left][data-collapsible=offcanvas]_&]:-right-2","[[data-side=right][data-collapsible=offcanvas]_&]:-left-2",r),...s})});Go.displayName="SidebarRail";const Jo=m.forwardRef(({className:r,...s},t)=>e.jsx("main",{ref:t,className:ie("relative flex min-h-svh flex-1 flex-col bg-background","peer-data-[variant=inset]:min-h-[calc(100svh-theme(spacing.4))] md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow",r),...s}));Jo.displayName="SidebarInset";const Xo=m.forwardRef(({className:r,...s},t)=>e.jsx(z,{ref:t,"data-sidebar":"input",className:ie("h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring",r),...s}));Xo.displayName="SidebarInput";const Zo=m.forwardRef(({className:r,...s},t)=>e.jsx("div",{ref:t,"data-sidebar":"header",className:ie("flex flex-col gap-2 p-2",r),...s}));Zo.displayName="SidebarHeader";const el=m.forwardRef(({className:r,...s},t)=>e.jsx("div",{ref:t,"data-sidebar":"footer",className:ie("flex flex-col gap-2 p-2",r),...s}));el.displayName="SidebarFooter";const sl=m.forwardRef(({className:r,...s},t)=>e.jsx(ma,{ref:t,"data-sidebar":"separator",className:ie("mx-2 w-auto bg-sidebar-border",r),...s}));sl.displayName="SidebarSeparator";const gn=m.forwardRef(({className:r,...s},t)=>e.jsx("div",{ref:t,"data-sidebar":"content",className:ie("flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden",r),...s}));gn.displayName="SidebarContent";const Wt=m.forwardRef(({className:r,...s},t)=>e.jsx("div",{ref:t,"data-sidebar":"group",className:ie("relative flex w-full min-w-0 flex-col p-2",r),...s}));Wt.displayName="SidebarGroup";const Ta=m.forwardRef(({className:r,asChild:s=!1,...t},a)=>{const n=s?_t:"div";return e.jsx(n,{ref:a,"data-sidebar":"group-label",className:ie("flex h-8 shrink-0 items-center rounded-md px-2 text-sm font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opa] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0",r),...t})});Ta.displayName="SidebarGroupLabel";const tl=m.forwardRef(({className:r,asChild:s=!1,...t},a)=>{const n=s?_t:"button";return e.jsx(n,{ref:a,"data-sidebar":"group-action",className:ie("absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","group-data-[collapsible=icon]:hidden",r),...t})});tl.displayName="SidebarGroupAction";const Gt=m.forwardRef(({className:r,...s},t)=>e.jsx("div",{ref:t,"data-sidebar":"group-content",className:ie("w-full text-sm",r),...s}));Gt.displayName="SidebarGroupContent";const Jt=m.forwardRef(({className:r,...s},t)=>e.jsx("ul",{ref:t,"data-sidebar":"menu",className:ie("flex w-full min-w-0 flex-col gap-1",r),...s}));Jt.displayName="SidebarMenu";const Xt=m.forwardRef(({className:r,...s},t)=>e.jsx("li",{ref:t,"data-sidebar":"menu-item",className:ie("group/menu-item relative",r),...s}));Xt.displayName="SidebarMenuItem";const al=ut("peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-base outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",{variants:{variant:{default:"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",outline:"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]"},size:{default:"h-8 text-base",sm:"h-7 text-sm",lg:"h-12 text-base group-data-[collapsible=icon]:!p-0"}},defaultVariants:{variant:"default",size:"default"}}),Zt=m.forwardRef(({asChild:r=!1,isActive:s=!1,variant:t="default",size:a="default",tooltip:n,className:i,...l},u)=>{const c=r?_t:"button",{isMobile:o,state:d}=Mt(),x=e.jsx(c,{ref:u,"data-sidebar":"menu-button","data-size":a,"data-active":s,className:ie(al({variant:t,size:a}),i),...l});return n?(typeof n=="string"&&(n={children:n}),e.jsxs(io,{children:[e.jsx(oo,{asChild:!0,children:x}),e.jsx(nn,{side:"right",align:"center",hidden:d!=="collapsed"||o,...n})]})):x});Zt.displayName="SidebarMenuButton";const rl=m.forwardRef(({className:r,asChild:s=!1,showOnHover:t=!1,...a},n)=>{const i=s?_t:"button";return e.jsx(i,{ref:n,"data-sidebar":"menu-action",className:ie("absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform peer-hover/menu-button:text-sidebar-accent-foreground hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",t&&"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0",r),...a})});rl.displayName="SidebarMenuAction";const nl=m.forwardRef(({className:r,...s},t)=>e.jsx("div",{ref:t,"data-sidebar":"menu-badge",className:ie("pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground","peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",r),...s}));nl.displayName="SidebarMenuBadge";const il=m.forwardRef(({className:r,showIcon:s=!1,...t},a)=>{const n=m.useMemo(()=>`${Math.floor(Math.random()*40)+50}%`,[]);return e.jsxs("div",{ref:a,"data-sidebar":"menu-skeleton",className:ie("flex h-8 items-center gap-2 rounded-md px-2",r),...t,children:[s&&e.jsx(Ya,{className:"size-4 rounded-md","data-sidebar":"menu-skeleton-icon"}),e.jsx(Ya,{className:"h-4 max-w-[--skeleton-width] flex-1","data-sidebar":"menu-skeleton-text",style:{"--skeleton-width":n}})]})});il.displayName="SidebarMenuSkeleton";const ol=m.forwardRef(({className:r,...s},t)=>e.jsx("ul",{ref:t,"data-sidebar":"menu-sub",className:ie("mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5","group-data-[collapsible=icon]:hidden",r),...s}));ol.displayName="SidebarMenuSub";const ll=m.forwardRef(({...r},s)=>e.jsx("li",{ref:s,...r}));ll.displayName="SidebarMenuSubItem";const cl=m.forwardRef(({asChild:r=!1,size:s="md",isActive:t,className:a,...n},i)=>{const l=r?_t:"a";return e.jsx(l,{ref:i,"data-sidebar":"menu-sub-button","data-size":s,"data-active":t,className:ie("flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring aria-disabled:pointer-events-none aria-disabled:opacity-50 hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground","data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground",s==="sm"&&"text-xs",s==="md"&&"text-sm","group-data-[collapsible=icon]:hidden",a),...n})});cl.displayName="SidebarMenuSubButton";const dl=[{title:"Dashboard",url:"/",icon:Vn},{title:"Purchases",url:"/purchases",icon:Da},{title:"Tasks",url:"/tasks",icon:Ra},{title:"Status",url:"/status",icon:It},{title:"Sales",url:"/sales",icon:nr}],ul=[{title:"Master Data",url:"/master",icon:Na},{title:"Analytics",url:"/analytics",icon:Na}],ml=[{title:"Settings",url:"/settings",icon:qa}];function hl(){const{state:r}=Mt(),t=st().pathname,a=r==="collapsed",[n,i]=m.useState(!1);m.useEffect(()=>{const o=()=>{const x=document.documentElement.classList.contains("dark");i(x)};o();const d=new MutationObserver(o);return d.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]}),()=>d.disconnect()},[]);const l=n?"/molaga-logo_dark.png":"/molaga-logo.png",u=o=>t===o||o!=="/"&&t.startsWith(o),c=({isActive:o})=>o?"bg-primary/10 text-primary font-medium border-r-2 border-primary":"hover:bg-muted/50 transition-colors";return e.jsx(pn,{className:a?"w-14":"w-64",collapsible:"icon",children:e.jsxs(gn,{className:"bg-sidebar",children:[e.jsx("div",{className:"h-16 border-b border-sidebar-border flex items-center justify-center px-4",children:a?e.jsxs("div",{className:"w-10 h-10 flex items-center justify-center",children:[e.jsx("img",{src:l,alt:"Molaga",className:"w-8 h-8 object-contain transition-opacity duration-200",onError:o=>{const d=o.target;d.style.display="none",d.nextElementSibling?.classList.remove("hidden")}}),e.jsx("div",{className:"w-8 h-8 rounded bg-gradient-to-br from-red-500 to-red-600 flex items-center justify-center text-white font-bold text-sm hidden",children:"M"})]}):e.jsxs("div",{className:"flex items-center justify-center w-full",children:[e.jsx("img",{src:l,alt:"Molaga ERP",className:"h-12 object-contain max-w-full transition-opacity duration-200",onError:o=>{const d=o.target;d.style.display="none",d.nextElementSibling?.classList.remove("hidden")}}),e.jsxs("div",{className:"hidden text-center",children:[e.jsx("h2",{className:"font-bold text-sidebar-foreground text-xl",children:"MOLAGA"}),e.jsx("p",{className:"text-sm text-sidebar-foreground/70",children:"Spice Manufacturing ERP"})]})]})}),e.jsxs(Wt,{children:[e.jsx(Ta,{children:"Main Modules"}),e.jsx(Gt,{children:e.jsx(Jt,{children:dl.map(o=>e.jsx(Xt,{children:e.jsx(Zt,{asChild:!0,isActive:u(o.url),children:e.jsxs(xa,{to:o.url,end:o.url==="/",className:c,children:[e.jsx(o.icon,{className:"h-4 w-4"}),!a&&e.jsx("span",{children:o.title})]})})},o.title))})})]}),e.jsxs(Wt,{children:[e.jsx(Ta,{children:"Management"}),e.jsx(Gt,{children:e.jsx(Jt,{children:ul.map(o=>e.jsx(Xt,{children:e.jsx(Zt,{asChild:!0,children:e.jsxs(xa,{to:o.url,className:c,children:[e.jsx(o.icon,{className:"h-4 w-4"}),!a&&e.jsx("span",{children:o.title})]})})},o.title))})})]}),e.jsx("div",{className:"mt-auto",children:e.jsx(Wt,{children:e.jsx(Gt,{children:e.jsx(Jt,{children:ml.map(o=>e.jsx(Xt,{children:e.jsx(Zt,{asChild:!0,children:e.jsxs(xa,{to:o.url,className:c,children:[e.jsx(o.icon,{className:"h-4 w-4"}),!a&&e.jsx("span",{children:o.title})]})})},o.title))})})})})]})})}const Wa="molaga_settings",bs={company:{companyName:"Molaga Spices Pvt Ltd",legalName:"Molaga Spices Private Limited",registrationNumber:"",taxId:"",industryType:"Manufacturing",address:"",city:"",state:"",postalCode:"",country:"India",phone:"",email:"",website:"",fiscalYearStart:"04",currency:"INR",timezone:"Asia/Kolkata"},system:{language:"en",dateFormat:"DD/MM/YYYY",timeFormat:"24",firstDayOfWeek:"monday",decimalPlaces:"2",thousandSeparator:",",decimalSeparator:".",recordsPerPage:"50",theme:"light",sidebarCollapsed:!1,showTooltips:!0,enableAnimations:!0},security:{minPasswordLength:"8",requireUppercase:!0,requireLowercase:!0,requireNumbers:!0,requireSpecialChars:!0,passwordExpiry:"90",sessionTimeout:"30",maxSessions:"3",enable2FA:!1,loginAttempts:"5",lockoutDuration:"30"},notifications:{smtp:{host:"smtp.gmail.com",port:"587",username:"",password:"",fromEmail:"",fromName:"Molaga ERP",useTLS:!0},notifications:{lowStockAlerts:!0,taskCompletion:!0,backupStatus:!0,userLogin:!1,dataImportExport:!0}},backup:{autoBackup:!0,frequency:"daily",time:"00:00",retention:"30"}};class pl{settings;constructor(){this.settings=this.loadSettings()}loadSettings(){try{const s=localStorage.getItem(Wa);if(s){const t=JSON.parse(s);return{company:{...bs.company,...t.company},system:{...bs.system,...t.system},security:{...bs.security,...t.security},notifications:{smtp:{...bs.notifications.smtp,...t.notifications?.smtp},notifications:{...bs.notifications.notifications,...t.notifications?.notifications}},backup:{...bs.backup,...t.backup}}}}catch(s){console.error("Error loading settings:",s)}return bs}saveSettings(){try{localStorage.setItem(Wa,JSON.stringify(this.settings))}catch(s){console.error("Error saving settings:",s)}}getAll(){return{...this.settings}}getCompany(){return{...this.settings.company}}updateCompany(s){return this.settings.company={...this.settings.company,...s},this.saveSettings(),this.getCompany()}getSystem(){return{...this.settings.system}}updateSystem(s){return this.settings.system={...this.settings.system,...s},this.saveSettings(),this.getSystem()}getSecurity(){return{...this.settings.security}}updateSecurity(s){return this.settings.security={...this.settings.security,...s},this.saveSettings(),this.getSecurity()}getNotifications(){return{...this.settings.notifications}}updateNotifications(s){return this.settings.notifications={smtp:{...this.settings.notifications.smtp,...s.smtp},notifications:{...this.settings.notifications.notifications,...s.notifications}},this.saveSettings(),this.getNotifications()}getBackup(){return{...this.settings.backup}}updateBackup(s){return this.settings.backup={...this.settings.backup,...s},this.saveSettings(),this.getBackup()}resetToDefaults(){return this.settings={...bs},this.saveSettings(),this.getAll()}exportSettings(){return JSON.stringify(this.settings,null,2)}importSettings(s){try{const t=JSON.parse(s);return this.settings={company:{...bs.company,...t.company},system:{...bs.system,...t.system},security:{...bs.security,...t.security},notifications:{smtp:{...bs.notifications.smtp,...t.notifications?.smtp},notifications:{...bs.notifications.notifications,...t.notifications?.notifications}},backup:{...bs.backup,...t.backup}},this.saveSettings(),!0}catch(t){return console.error("Error importing settings:",t),!1}}}const ta=new pl;function fn(){const[r,s]=m.useState(ta.getCompany()),t=m.useCallback(a=>{const n=ta.updateCompany(a);return s(n),n},[]);return{settings:r,updateSettings:t}}function jn(){const[r,s]=m.useState(ta.getSystem()),t=m.useCallback(a=>{const n=ta.updateSystem(a);return s(n),n},[]);return{settings:r,updateSettings:t}}const aa=ji,ra=yi,xl=m.forwardRef(({className:r,inset:s,children:t,...a},n)=>e.jsxs(Pr,{ref:n,className:ie("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[state=open]:bg-accent focus:bg-accent",s&&"pl-8",r),...a,children:[t,e.jsx(ir,{className:"ml-auto h-4 w-4"})]}));xl.displayName=Pr.displayName;const gl=m.forwardRef(({className:r,...s},t)=>e.jsx(Tr,{ref:t,className:ie("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...s}));gl.displayName=Tr.displayName;const Lt=m.forwardRef(({className:r,sideOffset:s=4,...t},a)=>e.jsx(fi,{children:e.jsx(Er,{ref:a,sideOffset:s,className:ie("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...t})}));Lt.displayName=Er.displayName;const bt=m.forwardRef(({className:r,inset:s,...t},a)=>e.jsx(Dr,{ref:a,className:ie("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",s&&"pl-8",r),...t}));bt.displayName=Dr.displayName;const fl=m.forwardRef(({className:r,children:s,checked:t,...a},n)=>e.jsxs(Rr,{ref:n,className:ie("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",r),checked:t,...a,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(qr,{children:e.jsx(or,{className:"h-4 w-4"})})}),s]}));fl.displayName=Rr.displayName;const jl=m.forwardRef(({className:r,children:s,...t},a)=>e.jsxs(Ar,{ref:a,className:ie("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",r),...t,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(qr,{children:e.jsx(Bn,{className:"h-2 w-2 fill-current"})})}),s]}));jl.displayName=Ar.displayName;const yn=m.forwardRef(({className:r,inset:s,...t},a)=>e.jsx(Fr,{ref:a,className:ie("px-2 py-1.5 text-sm font-semibold",s&&"pl-8",r),...t}));yn.displayName=Fr.displayName;const vn=m.forwardRef(({className:r,...s},t)=>e.jsx($r,{ref:t,className:ie("-mx-1 my-1 h-px bg-muted",r),...s}));vn.displayName=$r.displayName;function Be({children:r}){const{user:s,logout:t}=us(),{toast:a}=Ie(),{settings:n}=fn(),{settings:i}=jn();m.useEffect(()=>{const u=window.document.documentElement;if(u.classList.remove("light","dark"),i.theme==="auto"){const c=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";u.classList.add(c)}else u.classList.add(i.theme)},[i.theme]);const l=async()=>{try{await t(),a({title:"Success",description:"Logged out successfully"})}catch{a({title:"Error",description:"Failed to logout",variant:"destructive"})}};return e.jsx(hn,{children:e.jsxs("div",{className:"min-h-screen flex w-full bg-background",children:[e.jsx(hl,{}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("header",{className:"h-16 border-b border-border bg-card/50 backdrop-blur-sm sticky top-0 z-50",children:e.jsxs("div",{className:"flex items-center justify-between px-4 sm:px-6 h-full",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[e.jsx(xn,{className:"hover:bg-primary/10 p-2"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"font-semibold text-foreground text-sm sm:text-base",children:"Molaga ERP"})})]}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[n.companyName&&e.jsxs("div",{className:"hidden sm:flex items-center gap-2 px-3 py-1.5 rounded-md bg-primary/5 border border-primary/10",children:[e.jsx(lr,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:n.companyName})]}),e.jsx(L,{variant:"ghost",size:"icon",className:"hover:bg-primary/10 h-8 w-8 sm:h-10 sm:w-10",children:e.jsx(cr,{className:"h-4 w-4"})}),e.jsxs(aa,{children:[e.jsx(ra,{asChild:!0,children:e.jsx(L,{variant:"ghost",size:"icon",className:"hover:bg-primary/10 h-8 w-8 sm:h-10 sm:w-10",children:e.jsx(Qn,{className:"h-4 w-4"})})}),e.jsxs(Lt,{align:"end",className:"w-56",children:[e.jsx(yn,{children:e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("p",{className:"text-sm font-medium leading-none",children:s?.name}),e.jsx("p",{className:"text-xs leading-none text-muted-foreground",children:s?.email})]})}),e.jsx(vn,{}),e.jsxs(bt,{onClick:l,className:"text-red-600 focus:text-red-600",children:[e.jsx(Hn,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Log out"})]})]})]})]})]})}),e.jsx("main",{className:"flex-1 p-4 sm:p-6 bg-gradient-to-br from-background to-muted/20",children:r})]})]})})}const Qe=({children:r})=>{const{user:s,loading:t}=us(),a=st();return t?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Oe,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading..."})]})}):s?e.jsx(e.Fragment,{children:r}):e.jsx(kt,{to:"/login",state:{from:a},replace:!0})},yl=ut("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),q=m.forwardRef(({className:r,...s},t)=>e.jsx(Lr,{ref:t,className:ie(yl(),r),...s}));q.displayName=Lr.displayName;const X=m.forwardRef(({className:r,...s},t)=>e.jsx("div",{ref:t,className:ie("rounded-lg border bg-card text-card-foreground shadow-sm",r),...s}));X.displayName="Card";const me=m.forwardRef(({className:r,...s},t)=>e.jsx("div",{ref:t,className:ie("flex flex-col space-y-1.5 p-6",r),...s}));me.displayName="CardHeader";const he=m.forwardRef(({className:r,...s},t)=>e.jsx("h3",{ref:t,className:ie("text-2xl font-semibold leading-none tracking-tight",r),...s}));he.displayName="CardTitle";const Ce=m.forwardRef(({className:r,...s},t)=>e.jsx("p",{ref:t,className:ie("text-sm text-muted-foreground",r),...s}));Ce.displayName="CardDescription";const ee=m.forwardRef(({className:r,...s},t)=>e.jsx("div",{ref:t,className:ie("p-6 pt-0",r),...s}));ee.displayName="CardContent";const Ms=m.forwardRef(({className:r,...s},t)=>e.jsx("div",{ref:t,className:ie("flex items-center p-6 pt-0",r),...s}));Ms.displayName="CardFooter";const vl=()=>{const[r,s]=m.useState(""),[t,a]=m.useState(""),[n,i]=m.useState(!1),[l,u]=m.useState(!1),{login:c,loginWithGoogle:o}=us(),d=La(),{toast:x}=Ie(),y=async T=>{T.preventDefault(),i(!0);try{await c(r,t),x({title:"Success",description:"Logged in successfully"}),d("/")}catch(O){x({title:"Error",description:O.message||"Failed to login",variant:"destructive"})}finally{i(!1)}},b=async()=>{u(!0);try{await o()}catch(T){x({title:"Error",description:T.message||"Failed to login with Google",variant:"destructive"}),u(!1)}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs(X,{className:"w-full max-w-md",children:[e.jsxs(me,{className:"space-y-1",children:[e.jsx(he,{className:"text-2xl font-bold text-center",children:"MOLAGA ERP"}),e.jsx(Ce,{className:"text-center",children:"Sign in to your account to continue"})]}),e.jsxs(ee,{children:[e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"email",children:"Email"}),e.jsx(z,{id:"email",type:"email",placeholder:"Enter your email",value:r,onChange:T=>s(T.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"password",children:"Password"}),e.jsx(z,{id:"password",type:"password",placeholder:"Enter your password",value:t,onChange:T=>a(T.target.value),required:!0})]}),e.jsxs(L,{type:"submit",className:"w-full",disabled:n,children:[n&&e.jsx(Oe,{className:"mr-2 h-4 w-4 animate-spin"}),"Sign In"]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx(ma,{className:"w-full"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{className:"bg-background px-2 text-muted-foreground",children:"Or continue with"})})]}),e.jsxs(L,{type:"button",variant:"outline",className:"w-full mt-4",onClick:b,disabled:l,children:[l&&e.jsx(Oe,{className:"mr-2 h-4 w-4 animate-spin"}),e.jsxs("svg",{className:"mr-2 h-4 w-4",viewBox:"0 0 24 24",children:[e.jsx("path",{fill:"currentColor",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),e.jsx("path",{fill:"currentColor",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),e.jsx("path",{fill:"currentColor",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),e.jsx("path",{fill:"currentColor",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Continue with Google"]})]}),e.jsxs("div",{className:"mt-4 text-center text-sm",children:["Don't have an account?"," ",e.jsx(Es,{to:"/register",className:"text-primary hover:underline",children:"Sign up"})]})]})]})})},bl=()=>{const[r,s]=m.useState(""),[t,a]=m.useState(""),[n,i]=m.useState(""),[l,u]=m.useState(""),[c,o]=m.useState(!1),[d,x]=m.useState(!1),{register:y,loginWithGoogle:b}=us(),T=La(),{toast:O}=Ie(),g=async P=>{if(P.preventDefault(),n!==l){O({title:"Error",description:"Passwords do not match",variant:"destructive"});return}if(n.length<8){O({title:"Error",description:"Password must be at least 8 characters long",variant:"destructive"});return}o(!0);try{await y(t,n,r),O({title:"Success",description:"Account created successfully"}),T("/")}catch(D){O({title:"Error",description:D.message||"Failed to create account",variant:"destructive"})}finally{o(!1)}},w=async()=>{x(!0);try{await b()}catch(P){O({title:"Error",description:P.message||"Failed to login with Google",variant:"destructive"}),x(!1)}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs(X,{className:"w-full max-w-md",children:[e.jsxs(me,{className:"space-y-1",children:[e.jsx(he,{className:"text-2xl font-bold text-center",children:"MOLAGA ERP"}),e.jsx(Ce,{className:"text-center",children:"Create your account to get started"})]}),e.jsxs(ee,{children:[e.jsxs("form",{onSubmit:g,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"name",children:"Full Name"}),e.jsx(z,{id:"name",type:"text",placeholder:"Enter your full name",value:r,onChange:P=>s(P.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"email",children:"Email"}),e.jsx(z,{id:"email",type:"email",placeholder:"Enter your email",value:t,onChange:P=>a(P.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"password",children:"Password"}),e.jsx(z,{id:"password",type:"password",placeholder:"Enter your password (min 8 characters)",value:n,onChange:P=>i(P.target.value),required:!0,minLength:8})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"confirmPassword",children:"Confirm Password"}),e.jsx(z,{id:"confirmPassword",type:"password",placeholder:"Confirm your password",value:l,onChange:P=>u(P.target.value),required:!0})]}),e.jsxs(L,{type:"submit",className:"w-full",disabled:c,children:[c&&e.jsx(Oe,{className:"mr-2 h-4 w-4 animate-spin"}),"Create Account"]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx(ma,{className:"w-full"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{className:"bg-background px-2 text-muted-foreground",children:"Or continue with"})})]}),e.jsxs(L,{type:"button",variant:"outline",className:"w-full mt-4",onClick:w,disabled:d,children:[d&&e.jsx(Oe,{className:"mr-2 h-4 w-4 animate-spin"}),e.jsxs("svg",{className:"mr-2 h-4 w-4",viewBox:"0 0 24 24",children:[e.jsx("path",{fill:"currentColor",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),e.jsx("path",{fill:"currentColor",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),e.jsx("path",{fill:"currentColor",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),e.jsx("path",{fill:"currentColor",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Continue with Google"]})]}),e.jsxs("div",{className:"mt-4 text-center text-sm",children:["Already have an account?"," ",e.jsx(Es,{to:"/login",className:"text-primary hover:underline",children:"Sign in"})]})]})]})})},Nl=ut("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function Ve({className:r,variant:s,...t}){return e.jsx("div",{className:ie(Nl({variant:s}),r),...t})}function wl({title:r,value:s,change:t,changeType:a="neutral",icon:n,description:i}){const l={positive:"text-green-600 bg-green-50",negative:"text-red-600 bg-red-50",neutral:"text-muted-foreground bg-muted"}[a];return e.jsxs(X,{className:"hover:shadow-lg transition-all duration-300 border-l-4 border-l-primary",children:[e.jsxs(me,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(he,{className:"text-xs sm:text-sm font-medium text-muted-foreground",children:r}),e.jsx(n,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"})]}),e.jsxs(ee,{children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-foreground",children:s}),t&&e.jsx(Ve,{variant:"secondary",className:`text-xs mt-2 ${l}`,children:t}),i&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:i})]})]})}const Ga=[{id:1,name:"Procurement",icon:St,description:"Raw Materials",status:"active"},{id:2,name:"Pre-Production",icon:qa,description:"Clean/Roast",status:"active"},{id:3,name:"Production",icon:dr,description:"Grinding",status:"active"},{id:4,name:"Post-Production",icon:zn,description:"Packing",status:"pending"},{id:5,name:"Sales",icon:Yn,description:"Customer",status:"pending"}];function Sl(){return e.jsxs(X,{className:"col-span-full",children:[e.jsx(me,{children:e.jsxs(he,{className:"flex items-center gap-2",children:[e.jsx(dr,{className:"h-5 w-5 text-primary"}),"Production Flow Status"]})}),e.jsx(ee,{children:e.jsx("div",{className:"flex items-center justify-between overflow-x-auto pb-4",children:Ga.map((r,s)=>e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"flex flex-col items-center min-w-0 flex-shrink-0",children:[e.jsx("div",{className:`
                  w-16 h-16 rounded-full border-2 flex items-center justify-center mb-2
                  ${r.status==="active"?"bg-primary/10 border-primary text-primary":"bg-muted border-muted-foreground/30 text-muted-foreground"}
                `,children:e.jsx(r.icon,{className:"h-6 w-6"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-medium text-sm",children:r.name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:r.description})]})]}),s<Ga.length-1&&e.jsx(Is,{className:"h-5 w-5 text-muted-foreground mx-6 flex-shrink-0"})]},r.id))})})]})}const qe=r=>({async getAll(s=[]){let t=[],a=0;const n=100;let i=!0;for(;i;)try{const l=await Ye.listDocuments(We,r,[...s,Ke.limit(n),Ke.offset(a)]);if(t.push(...l.documents),a+=n,i=l.documents.length===n,a>1e4){hs.warn(`âš ï¸ Pagination safety limit reached for ${r}, stopping at 10000 records`);break}}catch(l){throw hs.error(`Error fetching documents from ${r}:`,l),l}return hs.log(`ðŸ“¦ Fetched ${t.length} documents from ${r}`),t},async getPaginated(s=[],t={}){const a=t.limit||100,n=t.offset||0;try{const i=await Ye.listDocuments(We,r,[...s,Ke.limit(a),Ke.offset(n)]);return{documents:i.documents,total:i.total,hasMore:n+a<i.total}}catch(i){throw hs.error(`Error fetching paginated documents from ${r}:`,i),i}},async getById(s){return await Ye.getDocument(We,r,s)},async create(s){return await Ye.createDocument(We,r,ct.unique(),s)},async update(s,t){return await Ye.updateDocument(We,r,s,t)},async delete(s){await Ye.deleteDocument(We,r,s)}});({...qe(be.PRODUCTION_STATUS)});const _l={...qe(be.POST_PRODUCTION_STATUS),async getWithRelations(){const r=await this.getAll(),s=qe(be.PRODUCTS),t=qe(be.PROCESSES),a=await s.getAll(),n=await t.getAll(),i=new Map(a.map(u=>[u.$id,u.name])),l=new Map(n.map(u=>[u.$id,u.process_name]));return r.map(u=>({...u,product_name:i.get(u.product_id)||"Unknown",process_name:l.get(u.process_id)||"Unknown"}))}};({...qe(be.INVENTORY_STATUS)});const bn={...qe(be.STOCK_STATUS),async getStockStatusByDateRange(r,s){const t=[];return r&&t.push(Ke.greaterThanEqual("status_date",r)),s&&t.push(Ke.lessThanEqual("status_date",s)),await this.getAll(t)}},qs={...qe(be.PRODUCTION_TASKS),async getByDateRange(r,s){const t=[];return r&&t.push(Ke.greaterThanEqual("date",r.toISOString())),s&&t.push(Ke.lessThanEqual("date",s.toISOString())),this.getAll(t)},async getProductionTasksWithRelations(r,s,t){const a=[];r&&a.push(Ke.greaterThanEqual("date",r)),s&&a.push(Ke.lessThanEqual("date",s)),t&&a.push(Ke.equal("process_id",t));const n=await this.getAll(a),i=qe(be.STAFF),l=qe(be.PROCESSES),u=qe(be.RAW_PRODUCTS),c=qe(be.STOCKS),o=await i.getAll(),d=await l.getAll(),x=await u.getAll(),y=await c.getAll(),b=await qt.getAll(),T=new Map(o.map(P=>[P.$id,P.staff_name])),O=new Map(d.map(P=>[P.$id,P.process_name])),g=new Map(x.map(P=>[P.$id,P.raw_product])),w=new Map(y.map(P=>[P.$id,P.stock_name]));return n.map(P=>{const _=b.filter(U=>U.production_task_id===P.$id).map(U=>({...U,stock_name:w.get(U.stock_id)||"Unknown"}));return{...P,staff_name:T.get(P.staff_id)||"Unknown",process_name:O.get(P.process_id)||"Unknown",source_process_name:O.get(P.source_process_id)||"Unknown",raw_product_name:g.get(P.raw_product_id)||"Unknown",stock_items:_}})}},Ws={...qe(be.POST_PRODUCTION_TASKS),async getPostProductionTasksWithRelations(){const r=await this.getAll(),s=qe(be.STAFF),t=qe(be.PROCESSES),a=qe(be.PRODUCTS),n=qe(be.STOCKS),i=await s.getAll(),l=await t.getAll(),u=await a.getAll(),c=await n.getAll(),o=new Map(i.map(b=>[b.$id,b.staff_name])),d=new Map(l.map(b=>[b.$id,b.process_name])),x=new Map(u.map(b=>[b.$id,b.product])),y=new Map(c.map(b=>[b.$id,b.stock_name]));return r.map(b=>({...b,staff_name:o.get(b.staff_id)||"Unknown",process_name:d.get(b.process_id)||"Unknown",source_process_name:d.get(b.source_process_id)||"Unknown",product_name:x.get(b.product_id)||"Unknown",stock_name:y.get(b.sku)||"Unknown"}))}},ws={...qe(be.STOCKS),async getCategories(){const r=await this.getAll(),s=new Set(r.map(t=>t.category));return Array.from(s)}},lt=qe(be.RAW_PRODUCTS),Dt=qe(be.VENDORS),kl=qe(be.STAFF),Us=qe(be.PROCESSES),Rs=qe(be.PRODUCTS),Rt=qe(be.SALES_CHANNELS),Ks={...qe(be.PURCHASES),async getByDateRange(r,s){const t=[];if(r){const a=new Date(r),n=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`;t.push(Ke.greaterThanEqual("date",n))}if(s){const a=new Date(s),n=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`;t.push(Ke.lessThanEqual("date",n))}return this.getAll(t)}},Cl=qe(be.SALES_ORDERS),zs=qe(be.SALES_UNITS),ot=qe(be.SALES_RECORDS);({...qe(be.PRE_PRODUCTION_STATUS)});const qt={...qe(be.PRODUCTION_TASK_ITEMS),async deleteByProductionTaskId(r){const s=await this.getAll([Ke.equal("production_task_id",r)]);await Promise.all(s.map(t=>this.delete(t.$id)))}},Fs={...qe(be.PRE_PRODUCTION_TASKS),async getByDateRange(r,s){const t=[];if(r){const a=new Date(r),n=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`;t.push(Ke.greaterThanEqual("date_assigned",n))}if(s){const a=new Date(s),n=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`;t.push(Ke.lessThanEqual("date_assigned",n))}return this.getAll(t)},async getPreProductionTasksWithRelations(){const r=await this.getAll(),s=qe(be.STAFF),t=qe(be.PROCESSES),a=qe(be.STOCKS),n=await s.getAll(),i=await t.getAll(),l=await a.getAll(),u=new Map(n.map(d=>[d.$id,d.staff_name])),c=new Map(i.map(d=>[d.$id,d.process_name])),o=new Map(l.map(d=>[d.$id,d.stock_name]));return r.map(d=>({...d,staff_name:u.get(d.staff_id)||"Unknown",process_name:c.get(d.process_id)||"Unknown",stock_name:o.get(d.stock_id)||"Unknown"}))}},Pl=()=>{const{data:r=[],isLoading:s}=de({queryKey:["dashboard","stock-status"],queryFn:()=>bn.getStockStatusByDateRange(),staleTime:6e4}),{data:t=[],isLoading:a}=de({queryKey:["dashboard","sales-orders"],queryFn:async()=>{const{documents:g}=await Cl.list();return g},staleTime:6e4}),{data:n=[],isLoading:i}=de({queryKey:["dashboard","recent-purchases"],queryFn:async()=>{const{documents:g}=await Ks.list();return g.sort((w,P)=>new Date(P.$createdAt||P.date).getTime()-new Date(w.$createdAt||w.date).getTime()).slice(0,5)},staleTime:6e4}),{data:l=[],isLoading:u}=de({queryKey:["dashboard","recent-prepro-tasks"],queryFn:async()=>{const{documents:g}=await Fs.list();return g.sort((w,P)=>new Date(P.$createdAt||P.date_assigned).getTime()-new Date(w.$createdAt||w.date_assigned).getTime()).slice(0,5)},staleTime:6e4}),c=(r||[]).reduce((g,w)=>g+(w.closing_bal||0),0),o=(t||[]).filter(g=>g.status!=="delivered"&&g.status!=="cancelled").length,d=(l||[]).reduce((g,w)=>g+(w.assigned_quantity||0),0),x=(l||[]).reduce((g,w)=>g+((w.assigned_quantity||0)-(w.wastage_quantity||0)),0),y=d>0?x/d*100:0,b=(r||[]).filter(g=>(g.closing_bal||0)<=(g.min_level||0)).map(g=>({name:g.stock_name,current:`${g.closing_bal||0} kg`,minimum:`${g.min_level||0} kg`,severity:(g.closing_bal||0)===0?"critical":"warning"})).slice(0,5),T=[...(n||[]).map(g=>({id:g.$id||`purchase-${g.date}`,action:"New purchase",item:`${g.stock_id} - ${g.quantity} units @ ${g.rate}`,time:Qa(new Date(g.date||g.$createdAt),{addSuffix:!0}),status:"success"})),...(l||[]).map(g=>({id:g.$id||`task-${g.date_assigned}`,action:`${g.status==="completed"?"Task completed":g.status==="in_progress"?"Task in progress":"Task created"}`,item:`${g.process_id} - ${g.assigned_quantity} units (${g.stock_id})`,time:Qa(new Date(g.date_completed||g.date_assigned||g.$createdAt),{addSuffix:!0}),status:g.status==="completed"?"success":"error"}))].sort((g,w)=>g.time>w.time?-1:1).slice(0,5),O=[{title:"Total Raw Stock",value:`${c.toLocaleString()} kg`,changeType:"neutral",icon:St,description:"Sum of closing balances across stocks"},{title:"Active Orders",value:o,changeType:"neutral",icon:Da,description:"Not delivered or cancelled"},{title:"Production Efficiency",value:`${y.toFixed(1)}%`,changeType:y>=90?"positive":"negative",icon:It,description:"Effective completed vs assigned (recent)"},{title:"Low Stock Alerts",value:b.length,changeType:b.length>0?"negative":"neutral",icon:Ss,description:"Closing balance below minimum"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Dashboard"}),e.jsx("p",{className:"text-muted-foreground",children:"Welcome to Molaga ERP - Your complete spice manufacturing solution"})]}),e.jsx("div",{className:"grid gap-3 sm:gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-4",children:O.map((g,w)=>e.jsx(wl,{...g},w))}),e.jsx(Sl,{}),e.jsxs("div",{className:"grid gap-4 sm:gap-6 grid-cols-1 lg:grid-cols-2",children:[e.jsxs(X,{children:[e.jsx(me,{children:e.jsxs(he,{className:"flex items-center gap-2",children:[e.jsx(wa,{className:"h-5 w-5 text-primary"}),"Recent Activities"]})}),e.jsx(ee,{children:e.jsxs("div",{className:"space-y-4",children:[T.map(g=>e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg hover:bg-muted/50 transition-colors",children:[e.jsx("div",{className:`mt-0.5 ${g.status==="success"?"text-green-600":"text-red-600"}`,children:g.status==="success"?e.jsx(Ys,{className:"h-4 w-4"}):e.jsx(Sa,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:g.action}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:g.item}),e.jsx("p",{className:"text-xs text-muted-foreground",children:g.time})]})]},g.id)),(s||a||i||u)&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading real data..."}),!T.length&&!(s||a||i||u)&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"No recent activities found."})]})})]}),e.jsxs(X,{children:[e.jsx(me,{children:e.jsxs(he,{className:"flex items-center gap-2",children:[e.jsx(Ss,{className:"h-5 w-5 text-destructive"}),"Low Stock Alerts"]})}),e.jsx(ee,{children:e.jsxs("div",{className:"space-y-3",children:[b.map((g,w)=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-border",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm text-foreground",children:g.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Current: ",g.current," | Min: ",g.minimum]})]}),e.jsx(Ve,{variant:g.severity==="critical"?"destructive":"secondary",className:g.severity==="critical"?"bg-red-100 text-red-800":g.severity==="warning"?"bg-yellow-100 text-yellow-800":"bg-orange-100 text-orange-800",children:g.severity})]},w)),!b.length&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"No low stock alerts."})]})})]})]})]})},Nt=m.forwardRef(({className:r,value:s,...t},a)=>e.jsx(Ir,{ref:a,className:ie("relative h-4 w-full overflow-hidden rounded-full bg-secondary",r),...t,children:e.jsx(vi,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(s||0)}%)`}})}));Nt.displayName=Ir.displayName;class va{static CHUNK_SIZE=1e3;static MAX_MEMORY_RECORDS=1e4;static async exportToCSV(s,t){try{t?.({current:0,total:s.data.length,percentage:0,status:"preparing",message:"Preparing CSV export..."});const a=this.formatDataForExport(s.data,s.headers);t?.({current:s.data.length*.5,total:s.data.length,percentage:50,status:"processing",message:"Processing data..."});let n=a;s.metadata&&(n=[...this.createMetadataRows(s.metadata),[],s.headers,...a.slice(1)]),t?.({current:s.data.length*.8,total:s.data.length,percentage:80,status:"generating",message:"Generating CSV file..."});const i=Tt.unparse(n,{header:!1,skipEmptyLines:!1});t?.({current:s.data.length,total:s.data.length,percentage:95,status:"downloading",message:"Downloading file..."});const l=new Blob([i],{type:"text/csv;charset=utf-8;"}),u=this.generateFilename(s.filename,"csv");Et.saveAs(l,u),t?.({current:s.data.length,total:s.data.length,percentage:100,status:"complete",message:"Export completed successfully"})}catch(a){throw t?.({current:0,total:s.data.length,percentage:0,status:"error",message:`Export failed: ${a instanceof Error?a.message:"Unknown error"}`}),a}}static async exportToXLSX(s,t){try{t?.({current:0,total:s.data.length,percentage:0,status:"preparing",message:"Preparing Excel export..."});const a=Ts.book_new(),n=this.formatDataForExport(s.data,s.headers);t?.({current:s.data.length*.3,total:s.data.length,percentage:30,status:"processing",message:"Processing data..."});const i=Ts.aoa_to_sheet(n);if(this.applyExcelFormatting(i,s.headers.length,n.length),Ts.book_append_sheet(a,i,"Data"),t?.({current:s.data.length*.6,total:s.data.length,percentage:60,status:"processing",message:"Creating worksheets..."}),s.metadata){const o=this.createMetadataSheet(s.metadata);Ts.book_append_sheet(a,o,"Export Info")}t?.({current:s.data.length*.8,total:s.data.length,percentage:80,status:"generating",message:"Generating Excel file..."});const l=Ha(a,{bookType:"xlsx",type:"array",compression:!0});t?.({current:s.data.length,total:s.data.length,percentage:95,status:"downloading",message:"Downloading file..."});const u=new Blob([l],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),c=this.generateFilename(s.filename,"xlsx");Et.saveAs(u,c),t?.({current:s.data.length,total:s.data.length,percentage:100,status:"complete",message:"Export completed successfully"})}catch(a){throw t?.({current:0,total:s.data.length,percentage:0,status:"error",message:`Export failed: ${a instanceof Error?a.message:"Unknown error"}`}),a}}static async exportLargeDataset(s,t){if(s.data.length<=this.MAX_MEMORY_RECORDS)return s.format==="csv"?this.exportToCSV(s,t):this.exportToXLSX(s,t);try{t?.({current:0,total:s.data.length,percentage:0,status:"preparing",message:"Preparing large dataset export..."});const a=this.chunkArray(s.data,this.CHUNK_SIZE);let n=0;s.format==="csv"?await this.exportLargeCSV(s,a,t):await this.exportLargeXLSX(s,a,t)}catch(a){throw t?.({current:0,total:s.data.length,percentage:0,status:"error",message:`Large export failed: ${a instanceof Error?a.message:"Unknown error"}`}),a}}static formatDataForExport(s,t){if(s.length===0)return[t];const a=[t];return s.forEach(n=>{const i=t.map(l=>{const u=n[l]||n[this.camelToSnake(l)]||"";return this.formatCellValue(u)});a.push(i)}),a}static formatCellValue(s){return s==null?"":typeof s=="boolean"?s?"Yes":"No":s instanceof Date?s.toLocaleDateString("en-GB"):typeof s=="number"?s%1===0?s.toString():s.toFixed(2):typeof s=="object"?JSON.stringify(s):String(s)}static generateFilename(s,t){const a=new Date().toISOString().slice(0,19).replace(/[:.]/g,"-");return`${s}_${a}.${t}`}static createMetadataRows(s){return[["Export Information"],["Exported At:",s.exportedAt.toLocaleString()],["Exported By:",s.exportedBy],["Page Source:",s.pageSource],["Record Count:",s.recordCount.toString()],["Version:",s.version],...s.filters?[["Filters:",JSON.stringify(s.filters)]]:[]]}static createMetadataSheet(s){const t=[["Export Information",""],["Exported At",s.exportedAt.toLocaleString()],["Exported By",s.exportedBy],["Page Source",s.pageSource],["Record Count",s.recordCount],["Version",s.version],...s.filters?[["Filters",JSON.stringify(s.filters)]]:[]];return Ts.aoa_to_sheet(t)}static applyExcelFormatting(s,t,a){const n=Ts.encode_range({s:{c:0,r:0},e:{c:t-1,r:a-1}});s["!ref"]=n;const i=Array(t).fill({wch:15});s["!cols"]=i;for(let l=0;l<t;l++){const u=Ts.encode_cell({r:0,c:l});s[u]&&(s[u].s={font:{bold:!0},fill:{fgColor:{rgb:"E2E8F0"}}})}}static async exportLargeCSV(s,t,a){let n="",i=0;if(n+=Tt.unparse([s.headers],{header:!1})+`
`,s.metadata){const c=this.createMetadataRows(s.metadata);n=Tt.unparse(c,{header:!1})+`

`+n}for(let c=0;c<t.length;c++){const o=t[c],d=this.formatDataForExport(o,s.headers).slice(1);n+=Tt.unparse(d,{header:!1}),c<t.length-1&&(n+=`
`),i+=o.length,a?.({current:i,total:s.data.length,percentage:Math.round(i/s.data.length*80),status:"processing",message:`Processing chunk ${c+1} of ${t.length}...`}),await new Promise(x=>setTimeout(x,10))}const l=new Blob([n],{type:"text/csv;charset=utf-8;"}),u=this.generateFilename(s.filename,"csv");Et.saveAs(l,u)}static async exportLargeXLSX(s,t,a){const n=Ts.book_new();let i=[s.headers],l=0;for(let x=0;x<t.length;x++){const y=t[x],b=this.formatDataForExport(y,s.headers).slice(1);i.push(...b),l+=y.length,a?.({current:l,total:s.data.length,percentage:Math.round(l/s.data.length*70),status:"processing",message:`Processing chunk ${x+1} of ${t.length}...`}),await new Promise(T=>setTimeout(T,10))}const u=Ts.aoa_to_sheet(i);if(this.applyExcelFormatting(u,s.headers.length,i.length),Ts.book_append_sheet(n,u,"Data"),s.metadata){const x=this.createMetadataSheet(s.metadata);Ts.book_append_sheet(n,x,"Export Info")}const c=Ha(n,{bookType:"xlsx",type:"array",compression:!0}),o=new Blob([c],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),d=this.generateFilename(s.filename,"xlsx");Et.saveAs(o,d)}static chunkArray(s,t){const a=[];for(let n=0;n<s.length;n+=t)a.push(s.slice(n,n+t));return a}static camelToSnake(s){return s.replace(/[A-Z]/g,t=>`_${t.toLowerCase()}`)}}const js=({data:r,headers:s,filename:t,className:a,disabled:n=!1,includeMetadata:i=!0,metadata:l,onExportStart:u,onExportComplete:c,variant:o="outline",size:d="default"})=>{const[x,y]=m.useState(!1),[b,T]=m.useState(null),[O,g]=m.useState(null),w=async U=>{if(!(x||n))try{y(!0),g(U),T(null),u?.();const Q=i?{exportedAt:new Date,exportedBy:"Current User",pageSource:t,recordCount:r.length,version:"1.0.0",...l}:void 0,C={filename:t,headers:s,data:r,format:U,metadata:Q};T({current:0,total:r.length,percentage:0,status:"preparing",message:`Preparing ${U.toUpperCase()} export...`}),r.length>1e4?await va.exportLargeDataset(C,T):U==="csv"?await va.exportToCSV(C,T):await va.exportToXLSX(C,T),At.success(`Successfully exported ${r.length} records to ${U.toUpperCase()}`,{description:`File: ${t}_${new Date().toISOString().slice(0,19).replace(/[:.]/g,"-")}.${U}`}),c?.(!0)}catch(Q){console.error("Export failed:",Q),At.error("Export failed",{description:Q instanceof Error?Q.message:"An unexpected error occurred"}),c?.(!1)}finally{y(!1),g(null),T(null)}},P=()=>x&&O?`Exporting ${O.toUpperCase()}...`:"Export",D=()=>x?e.jsx(Oe,{className:"h-4 w-4 animate-spin"}):e.jsx(dt,{className:"h-4 w-4"}),_=!r||r.length===0;return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(aa,{children:[e.jsx(ra,{asChild:!0,children:e.jsxs(L,{variant:o,size:d,className:a,disabled:n||x||_,children:[D(),P()]})}),e.jsxs(Lt,{align:"end",children:[e.jsxs(bt,{onClick:()=>w("csv"),disabled:x||_,className:"cursor-pointer",children:[e.jsx(vt,{className:"h-4 w-4 mr-2"}),"Export as CSV"]}),e.jsxs(bt,{onClick:()=>w("xlsx"),disabled:x||_,className:"cursor-pointer",children:[e.jsx(ur,{className:"h-4 w-4 mr-2"}),"Export as Excel"]})]})]}),x&&b&&e.jsxs("div",{className:"space-y-2 min-w-[200px]",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:b.message||"Processing..."}),e.jsxs("span",{className:"text-muted-foreground",children:[b.percentage,"%"]})]}),e.jsx(Nt,{value:b.percentage,className:"h-2"}),b.currentBatch&&b.totalBatches&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Batch ",b.currentBatch," of ",b.totalBatches]})]}),_&&e.jsx("div",{className:"text-xs text-muted-foreground",children:"No data available to export"})]})},as=kr,ht=bi,Tl=Cr,Nn=m.forwardRef(({className:r,...s},t)=>e.jsx(ia,{ref:t,className:ie("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r),...s}));Nn.displayName=ia.displayName;const Ze=m.forwardRef(({className:r,children:s,...t},a)=>e.jsxs(Tl,{children:[e.jsx(Nn,{}),e.jsxs(oa,{ref:a,className:ie("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",r),...t,children:[s,e.jsxs(_r,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-accent data-[state=open]:text-muted-foreground hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[e.jsx(yt,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Ze.displayName=oa.displayName;const es=({className:r,...s})=>e.jsx("div",{className:ie("flex flex-col space-y-1.5 text-center sm:text-left",r),...s});es.displayName="DialogHeader";const ss=({className:r,...s})=>e.jsx("div",{className:ie("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",r),...s});ss.displayName="DialogFooter";const ts=m.forwardRef(({className:r,...s},t)=>e.jsx(la,{ref:t,className:ie("text-lg font-semibold leading-none tracking-tight",r),...s}));ts.displayName=la.displayName;const rs=m.forwardRef(({className:r,...s},t)=>e.jsx(ca,{ref:t,className:ie("text-sm text-muted-foreground",r),...s}));rs.displayName=ca.displayName;class ba{static DEFAULT_BATCH_SIZE=100;static MAX_FILE_SIZE_MB=50;static SUPPORTED_FORMATS=[".csv",".xlsx",".xls"];static async parseFile(s,t){try{this.validateFile(s),t?.({current:0,total:100,percentage:0,status:"parsing",message:"Starting file parsing..."});const a=this.getFileExtension(s.name);let n=[];if(a===".csv")n=await this.parseCSVFile(s,t);else if(a===".xlsx"||a===".xls")n=await this.parseExcelFile(s,t);else throw new Error(`Unsupported file format: ${a}`);return t?.({current:100,total:100,percentage:100,status:"complete",message:`Successfully parsed ${n.length} rows`}),n}catch(a){throw t?.({current:0,total:100,percentage:0,status:"error",message:`Parsing failed: ${a instanceof Error?a.message:"Unknown error"}`}),a}}static validateData(s,t,a){const n={isValid:!0,errors:[],warnings:[],validData:[],invalidData:[]};if(s.length===0)return n.isValid=!1,n.errors.push({row:0,column:"file",message:"File contains no data rows",value:null,severity:"error"}),n;a?.({current:0,total:s.length,percentage:0,status:"validating",message:"Starting data validation..."});const i=Object.keys(s[0]),l=this.validateHeaders(i,t);return l.isValid||(n.errors.push(...l.errors),n.isValid=!1),s.forEach((u,c)=>{const o=c+1,d=this.validateRow(u,t.validationRules,o,s);d.errors.length>0?(n.errors.push(...d.errors),n.invalidData.push({...u,_rowNumber:o})):n.validData.push({...u,_rowNumber:o}),d.warnings.length>0&&n.warnings.push(...d.warnings),(c%100===0||c===s.length-1)&&a?.({current:c+1,total:s.length,percentage:Math.round((c+1)/s.length*100),status:"validating",message:`Validating row ${c+1} of ${s.length}...`})}),n.isValid=n.errors.length===0,a?.({current:s.length,total:s.length,percentage:100,status:"complete",message:`Validation complete. ${n.validData.length} valid rows, ${n.invalidData.length} invalid rows`}),n}static async processImport(s,t,a){const n=t.batchSize||this.DEFAULT_BATCH_SIZE,i=this.createBatches(s,n),l={totalRows:s.length,successfulRows:0,failedRows:0,errors:[],warnings:[],processedData:[],skippedRows:0};a?.({current:0,total:s.length,percentage:0,status:"processing",message:"Starting import process...",currentBatch:0,totalBatches:i.length});try{for(let u=0;u<i.length;u++){const c=i[u],o=await this.processBatch(c,n,u+1);l.successfulRows+=o.processed,l.errors.push(...o.errors),l.warnings.push(...o.warnings),l.processedData.push(...o.data);const d=(u+1)*n,x=Math.min(d,s.length);a?.({current:x,total:s.length,percentage:Math.round(x/s.length*100),status:"processing",message:`Processing batch ${u+1} of ${i.length}...`,currentBatch:u+1,totalBatches:i.length}),await new Promise(y=>setTimeout(y,10))}return l.failedRows=l.totalRows-l.successfulRows,a?.({current:s.length,total:s.length,percentage:100,status:"complete",message:`Import complete. ${l.successfulRows} successful, ${l.failedRows} failed`}),t.onImportComplete(l),l}catch(u){throw a?.({current:0,total:s.length,percentage:0,status:"error",message:`Import failed: ${u instanceof Error?u.message:"Unknown error"}`}),u}}static async processBatch(s,t,a){const n={processed:0,errors:[],warnings:[],data:[]};try{return await new Promise(i=>setTimeout(i,50)),s.forEach((i,l)=>{try{const u=this.processRow(i);n.data.push(u),n.processed++}catch(u){n.errors.push({row:(a-1)*t+l+1,column:"processing",message:u instanceof Error?u.message:"Processing failed",value:i,severity:"error"})}}),n}catch(i){return s.forEach((l,u)=>{n.errors.push({row:(a-1)*t+u+1,column:"batch",message:`Batch processing failed: ${i instanceof Error?i.message:"Unknown error"}`,value:null,severity:"error"})}),n}}static validateFile(s){const t=this.MAX_FILE_SIZE_MB*1024*1024;if(s.size>t)throw new Error(`File size exceeds maximum allowed size of ${this.MAX_FILE_SIZE_MB}MB`);const a=this.getFileExtension(s.name);if(!this.SUPPORTED_FORMATS.includes(a))throw new Error(`Unsupported file format. Supported formats: ${this.SUPPORTED_FORMATS.join(", ")}`)}static async parseCSVFile(s,t){return new Promise((a,n)=>{Tt.parse(s,{header:!0,skipEmptyLines:!0,transformHeader:i=>i.trim(),transform:i=>i.trim(),step:(i,l)=>{const u=Math.round((s.size-l.streamer._input.length)/s.size*80);t?.({current:u,total:100,percentage:u,status:"parsing",message:"Parsing CSV file..."})},complete:i=>{if(i.errors.length>0){const l=i.errors.map(u=>`Row ${u.row}: ${u.message}`).join("; ");n(new Error(`CSV parsing errors: ${l}`))}else a(i.data)},error:i=>{n(new Error(`CSV parsing failed: ${i.message}`))}})})}static async parseExcelFile(s,t){return new Promise((a,n)=>{const i=new FileReader;i.onload=l=>{try{t?.({current:50,total:100,percentage:50,status:"parsing",message:"Reading Excel file..."});const u=new Uint8Array(l.target?.result),c=Wi(u,{type:"array"}),o=c.SheetNames[0],d=c.Sheets[o];t?.({current:80,total:100,percentage:80,status:"parsing",message:"Converting Excel data..."});const x=Ts.sheet_to_json(d,{header:1,defval:"",blankrows:!1});if(x.length===0){n(new Error("Excel file contains no data"));return}const y=x[0].map(T=>String(T).trim()),b=x.slice(1).map(T=>{const O={};return y.forEach((g,w)=>{O[g]=T[w]!==void 0?String(T[w]).trim():""}),O});a(b)}catch(u){n(new Error(`Excel parsing failed: ${u instanceof Error?u.message:"Unknown error"}`))}},i.onerror=()=>{n(new Error("Failed to read Excel file"))},i.readAsArrayBuffer(s)})}static validateHeaders(s,t){const a=[];t.requiredColumns.forEach(i=>{s.includes(i)||a.push({row:0,column:i,message:`Required column '${i}' is missing`,value:null,severity:"error"})});const n=[...t.requiredColumns,...t.optionalColumns];return s.forEach(i=>{n.includes(i)||a.push({row:0,column:i,message:`Unknown column '${i}' will be ignored`,value:null,severity:"warning"})}),{isValid:a.filter(i=>i.severity==="error").length===0,errors:a}}static validateRow(s,t,a,n){const i=[],l=[];return t.forEach(u=>{const c=s[u.field],o=this.applyValidationRule(c,u,s,n);if(o!==!0){const d=typeof o=="string"?o:u.message||`Validation failed for ${u.field}`;u.type==="required"||u.validator&&o===!1?i.push({row:a,column:u.field,message:d,value:c,severity:"error"}):l.push({row:a,column:u.field,message:d,value:c})}}),{errors:i,warnings:l}}static applyValidationRule(s,t,a,n){switch(t.type){case"required":return s!=null&&s!=="";case"format":return t.options?.pattern?t.options.pattern.test(String(s)):!0;case"range":const i=Number(s);return isNaN(i)?"Value must be a number":t.options?.min!==void 0&&i<t.options.min?`Value must be at least ${t.options.min}`:t.options?.max!==void 0&&i>t.options.max?`Value must be at most ${t.options.max}`:!0;case"unique":return n.filter(u=>u[t.field]===s).length<=1||`Duplicate value found: ${s}`;case"custom":return t.validator?t.validator(s,a,n):!0;default:return!0}}static processRow(s){const t={};return Object.keys(s).forEach(a=>{let n=s[a];if(a.startsWith("_")){t[a]=n;return}if(typeof n=="string"){if(n=n.trim(),n===""&&(n=null),n&&!isNaN(Number(n))&&!isNaN(parseFloat(n))){const i=parseFloat(n);(i.toString()===n||i.toFixed(2)===n)&&(n=i)}n==="true"||n==="True"||n==="TRUE"?n=!0:(n==="false"||n==="False"||n==="FALSE")&&(n=!1)}t[a]=n}),t}static createBatches(s,t){const a=[];for(let n=0;n<s.length;n+=t)a.push(s.slice(n,n+t));return a}static getFileExtension(s){return s.toLowerCase().substring(s.lastIndexOf("."))}}const ys=({config:r,className:s,disabled:t=!1,onImportComplete:a,onImportStart:n,variant:i="outline",size:l="default",acceptedFormats:u=[".csv",".xlsx",".xls"]})=>{const c=m.useRef(null),[o,d]=m.useState({isOpen:!1,step:"upload",file:null,parsedData:[],validationResult:null,importProgress:null,importResult:null,error:null}),x=()=>{d({isOpen:!1,step:"upload",file:null,parsedData:[],validationResult:null,importProgress:null,importResult:null,error:null})},y=()=>{const C=r.requiredColumns.concat(r.optionalColumns||[]),B=C.map(v=>`Sample ${v}`),A=[C.join(","),B.join(",")].join(`
`),S=new Blob([A],{type:"text/csv;charset=utf-8;"}),h=URL.createObjectURL(S),F=document.createElement("a");F.setAttribute("href",h),F.setAttribute("download","sample-import-template.csv"),F.style.visibility="hidden",document.body.appendChild(F),F.click(),document.body.removeChild(F),At.success("Sample CSV downloaded",{description:"Fill in your data and import the file"})},b=async C=>{try{d(S=>({...S,file:C,error:null,step:"preview"}));const B=await ba.parseFile(C,S=>{d(h=>({...h,importProgress:S}))}),A=ba.validateData(B,r,S=>{d(h=>({...h,importProgress:S}))});d(S=>({...S,parsedData:B,validationResult:A,importProgress:null}))}catch(B){d(A=>({...A,error:B instanceof Error?B.message:"Failed to parse file",importProgress:null}))}},T=async()=>{if(o.validationResult?.validData.length)try{d(B=>({...B,step:"processing",error:null})),n?.();const C=await ba.processImport(o.validationResult.validData,r,B=>{d(A=>({...A,importProgress:B}))});d(B=>({...B,step:"complete",importResult:C,importProgress:null})),At.success("Import completed successfully",{description:`${C.successfulRows} rows imported, ${C.failedRows} failed`}),a?.(C)}catch(C){d(B=>({...B,error:C instanceof Error?C.message:"Import failed",importProgress:null})),At.error("Import failed",{description:C instanceof Error?C.message:"An unexpected error occurred"})}},O=C=>{C.preventDefault(),C.stopPropagation()},g=C=>{C.preventDefault(),C.stopPropagation();const A=Array.from(C.dataTransfer.files)[0];A&&b(A)},w=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs(L,{variant:"outline",size:"sm",onClick:C=>{C.stopPropagation(),y()},className:"gap-2",children:[e.jsx(vt,{className:"h-4 w-4"}),"Download Sample CSV"]})}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-gray-400 transition-colors cursor-pointer",onDragOver:O,onDrop:g,onClick:()=>c.current?.click(),children:[e.jsx(ea,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"Drop your file here or click to browse"}),e.jsxs("p",{className:"text-sm text-gray-500 mb-4",children:["Supported formats: ",u.join(", ")]}),e.jsx(L,{variant:"outline",children:"Choose File"})]}),e.jsx("input",{ref:c,type:"file",accept:u.join(","),onChange:C=>{const B=C.target.files?.[0];B&&b(B)},className:"hidden"}),o.importProgress&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:o.importProgress.message}),e.jsxs("span",{children:[o.importProgress.percentage,"%"]})]}),e.jsx(Nt,{value:o.importProgress.percentage})]}),o.error&&e.jsxs(Je,{variant:"destructive",children:[e.jsx(pa,{className:"h-4 w-4"}),e.jsx(Xe,{children:o.error})]})]}),P=()=>{if(!o.validationResult)return null;const{validData:C,invalidData:B,errors:A,warnings:S}=o.validationResult;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Import Preview"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Ve,{variant:"outline",className:"text-green-600",children:[e.jsx(Ka,{className:"h-3 w-3 mr-1"}),C.length," Valid"]}),B.length>0&&e.jsxs(Ve,{variant:"outline",className:"text-red-600",children:[e.jsx(pa,{className:"h-3 w-3 mr-1"}),B.length," Invalid"]}),S.length>0&&e.jsxs(Ve,{variant:"outline",className:"text-yellow-600",children:[e.jsx(pa,{className:"h-3 w-3 mr-1"}),S.length," Warnings"]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[o.file?.name.endsWith(".csv")?e.jsx(vt,{className:"h-4 w-4"}):e.jsx(ur,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:o.file?.name})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[o.parsedData.length," rows found"]})]}),A.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-red-600",children:"Validation Errors"}),e.jsxs("div",{className:"max-h-32 overflow-y-auto space-y-1",children:[A.slice(0,10).map((h,F)=>e.jsx(Je,{variant:"destructive",className:"py-2",children:e.jsxs(Xe,{className:"text-xs",children:["Row ",h.row,', Column "',h.column,'": ',h.message]})},F)),A.length>10&&e.jsxs("p",{className:"text-xs text-gray-500",children:["... and ",A.length-10," more errors"]})]})]}),S.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-yellow-600",children:"Warnings"}),e.jsxs("div",{className:"max-h-24 overflow-y-auto space-y-1",children:[S.slice(0,5).map((h,F)=>e.jsx(Je,{className:"py-2 border-yellow-200",children:e.jsxs(Xe,{className:"text-xs",children:["Row ",h.row,', Column "',h.column,'": ',h.message]})},F)),S.length>5&&e.jsxs("p",{className:"text-xs text-gray-500",children:["... and ",S.length-5," more warnings"]})]})]}),C.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium",children:"Sample Data (First 3 rows)"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-xs border",children:[e.jsx("thead",{children:e.jsx("tr",{className:"bg-gray-50",children:r.requiredColumns.concat(r.optionalColumns).slice(0,6).map(h=>e.jsx("th",{className:"border px-2 py-1 text-left font-medium",children:h},h))})}),e.jsx("tbody",{children:C.slice(0,3).map((h,F)=>e.jsx("tr",{children:r.requiredColumns.concat(r.optionalColumns).slice(0,6).map(v=>e.jsxs("td",{className:"border px-2 py-1",children:[String(h[v]||"").substring(0,20),String(h[v]||"").length>20&&"..."]},v))},F))})]})})]})]})},D=()=>e.jsxs("div",{className:"space-y-4 text-center",children:[e.jsx(Oe,{className:"h-12 w-12 animate-spin mx-auto text-blue-500"}),e.jsx("h3",{className:"text-lg font-medium",children:"Processing Import"}),o.importProgress&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:o.importProgress.message}),e.jsxs("span",{children:[o.importProgress.percentage,"%"]})]}),e.jsx(Nt,{value:o.importProgress.percentage}),o.importProgress.currentBatch&&o.importProgress.totalBatches&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Processing batch ",o.importProgress.currentBatch," of ",o.importProgress.totalBatches]})]})]}),_=()=>{if(!o.importResult)return null;const{successfulRows:C,failedRows:B,totalRows:A,errors:S}=o.importResult;return e.jsxs("div",{className:"space-y-4 text-center",children:[e.jsx(Ka,{className:"h-12 w-12 mx-auto text-green-500"}),e.jsx("h3",{className:"text-lg font-medium",children:"Import Complete"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{className:"bg-green-50 p-3 rounded-lg",children:[e.jsx("div",{className:"font-medium text-green-600",children:C}),e.jsx("div",{className:"text-green-600",children:"Successful"})]}),e.jsxs("div",{className:"bg-red-50 p-3 rounded-lg",children:[e.jsx("div",{className:"font-medium text-red-600",children:B}),e.jsx("div",{className:"text-red-600",children:"Failed"})]}),e.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg",children:[e.jsx("div",{className:"font-medium text-blue-600",children:A}),e.jsx("div",{className:"text-blue-600",children:"Total"})]})]}),S.length>0&&e.jsxs("div",{className:"space-y-2 text-left",children:[e.jsx("h4",{className:"font-medium text-red-600",children:"Import Errors"}),e.jsxs("div",{className:"max-h-32 overflow-y-auto space-y-1",children:[S.slice(0,5).map((h,F)=>e.jsx(Je,{variant:"destructive",className:"py-2",children:e.jsxs(Xe,{className:"text-xs",children:["Row ",h.row,": ",h.message]})},F)),S.length>5&&e.jsxs("p",{className:"text-xs text-gray-500",children:["... and ",S.length-5," more errors"]})]})]})]})},U=()=>{switch(o.step){case"upload":return"Import Data";case"preview":return"Review Import Data";case"processing":return"Processing Import";case"complete":return"Import Complete";default:return"Import Data"}},Q=()=>o.step==="preview"&&o.validationResult?o.validationResult.validData.length>0:!1;return e.jsxs(e.Fragment,{children:[e.jsxs(L,{variant:i,size:l,className:s,disabled:t,onClick:()=>d(C=>({...C,isOpen:!0})),children:[e.jsx(ea,{className:"h-4 w-4 mr-2"}),"Import"]}),e.jsx(as,{open:o.isOpen,onOpenChange:C=>{C||x()},children:e.jsxs(Ze,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(es,{children:[e.jsx(ts,{children:U()}),e.jsxs(rs,{children:[o.step==="upload"&&"Select a file to import data",o.step==="preview"&&"Review the data before importing",o.step==="processing"&&"Please wait while we process your data",o.step==="complete"&&"Import has been completed"]})]}),e.jsxs("div",{className:"py-4",children:[o.step==="upload"&&w(),o.step==="preview"&&P(),o.step==="processing"&&D(),o.step==="complete"&&_()]}),e.jsxs(ss,{children:[o.step==="upload"&&e.jsx(L,{variant:"outline",onClick:x,children:"Cancel"}),o.step==="preview"&&e.jsxs(e.Fragment,{children:[e.jsx(L,{variant:"outline",onClick:()=>d(C=>({...C,step:"upload"})),children:"Back"}),e.jsxs(L,{onClick:T,disabled:!Q(),children:["Import ",o.validationResult?.validData.length||0," Rows"]})]}),o.step==="complete"&&e.jsx(L,{onClick:x,children:"Close"})]})]})})]})},wn=m.forwardRef(({className:r,children:s,...t},a)=>e.jsxs(Mr,{ref:a,className:ie("relative overflow-hidden",r),...t,children:[e.jsx(Ni,{className:"h-full w-full rounded-[inherit]",children:s}),e.jsx(Sn,{}),e.jsx(wi,{})]}));wn.displayName=Mr.displayName;const Sn=m.forwardRef(({className:r,orientation:s="vertical",...t},a)=>e.jsx(Ur,{ref:a,orientation:s,className:ie("flex touch-none select-none transition-colors",s==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",s==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",r),...t,children:e.jsx(Si,{className:"relative flex-1 rounded-full bg-border"})}));Sn.displayName=Ur.displayName;const ps=m.forwardRef(({className:r,...s},t)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:t,className:ie("w-full caption-bottom text-sm",r),...s})}));ps.displayName="Table";const xs=m.forwardRef(({className:r,...s},t)=>e.jsx("thead",{ref:t,className:ie("[&_tr]:border-b",r),...s}));xs.displayName="TableHeader";const gs=m.forwardRef(({className:r,...s},t)=>e.jsx("tbody",{ref:t,className:ie("[&_tr:last-child]:border-0",r),...s}));gs.displayName="TableBody";const El=m.forwardRef(({className:r,...s},t)=>e.jsx("tfoot",{ref:t,className:ie("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",r),...s}));El.displayName="TableFooter";const De=m.forwardRef(({className:r,...s},t)=>e.jsx("tr",{ref:t,className:ie("border-b transition-colors data-[state=selected]:bg-muted hover:bg-muted/50",r),...s}));De.displayName="TableRow";const Z=m.forwardRef(({className:r,...s},t)=>e.jsx("th",{ref:t,className:ie("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",r),...s}));Z.displayName="TableHead";const W=m.forwardRef(({className:r,...s},t)=>e.jsx("td",{ref:t,className:ie("p-4 align-middle [&:has([role=checkbox])]:pr-0",r),...s}));W.displayName="TableCell";const Dl=m.forwardRef(({className:r,...s},t)=>e.jsx("caption",{ref:t,className:ie("mt-4 text-sm text-muted-foreground",r),...s}));Dl.displayName="TableCaption";const tt=({data:r,columns:s,onSort:t,currentSort:a,loading:n=!1,emptyMessage:i="No data available",searchable:l=!0,filterable:u=!1,actions:c=[],onRowClick:o,className:d,maxHeight:x="600px",stickyHeader:y=!0,striped:b=!0,bordered:T=!1,compact:O=!1,selectable:g=!1,selectedRows:w=[],onSelectionChange:P,rowKey:D="id"})=>{const[_,U]=m.useState(""),[Q,C]=m.useState({}),B=m.useMemo(()=>a?[...r].sort((R,M)=>{const K=R[a.column],Y=M[a.column];let G=0;switch(a.dataType){case"number":G=(Number(K)||0)-(Number(Y)||0);break;case"date":const le=new Date(K),se=new Date(Y);G=le.getTime()-se.getTime();break;case"boolean":G=K===Y?0:K?1:-1;break;default:G=String(K||"").localeCompare(String(Y||""))}return a.direction==="desc"?-G:G}):r,[r,a]),A=m.useMemo(()=>{let R=B;if(_&&l){const M=_.toLowerCase();R=R.filter(K=>s.some(Y=>Y.searchable===!1?!1:String(K[Y.key]||"").toLowerCase().includes(M)))}return u&&Object.entries(Q).forEach(([M,K])=>{if(K){const Y=K.toLowerCase();R=R.filter(G=>String(G[M]||"").toLowerCase().includes(Y))}}),R},[B,_,Q,s,l,u]),S=R=>{if(!R.sortable||!t)return;let M="asc";a?.column===R.key&&(M=a.direction==="asc"?"desc":"asc"),t({column:R.key,direction:M,dataType:R.dataType})},h=(R,M)=>{if(!g||!P)return;const K=R[D];let Y=[...w];M?Y.some(G=>G[D]===K)||Y.push(R):Y=Y.filter(G=>G[D]!==K),P(Y)},F=R=>{!g||!P||P(R?A:[])},v=R=>g?w.some(M=>M[D]===R[D]):!1,I=()=>!g||A.length===0?!1:A.every(R=>v(R)),p=R=>R.sortable?a?.column===R.key?a.direction==="asc"?e.jsx(Wn,{className:"h-4 w-4"}):e.jsx(Gn,{className:"h-4 w-4"}):e.jsx(Jn,{className:"h-4 w-4 opacity-50"}):null,E=(R,M,K)=>{if(M.formatter)return M.formatter(R,K);if(R==null)return e.jsx("span",{className:"text-gray-400",children:"â€”"});switch(M.dataType){case"boolean":return e.jsx(Ve,{variant:R?"default":"secondary",children:R?"Yes":"No"});case"date":return ua(R);case"number":return typeof R=="number"?R.toLocaleString():R;default:return String(R)}},H=R=>{switch(R){case"center":return"text-center";case"right":return"text-right";default:return"text-left"}};return e.jsxs("div",{className:`space-y-4 ${d}`,children:[(l||u)&&e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4",children:[l&&e.jsxs("div",{className:"relative flex-1",children:[e.jsx(os,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(z,{placeholder:"Search...",value:_,onChange:R=>U(R.target.value),className:"pl-10 text-sm"})]}),u&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Js,{className:"h-4 w-4 text-gray-400 mt-3"}),s.slice(0,3).map(R=>e.jsx(z,{placeholder:`Filter ${R.label}...`,value:Q[R.key]||"",onChange:M=>C(K=>({...K,[R.key]:M.target.value})),className:"w-40"},R.key))]})]}),_&&e.jsxs("div",{className:"text-sm text-gray-500",children:["Showing ",A.length," of ",r.length," results"]}),e.jsx("div",{className:`rounded-md border ${T?"border-2":""} overflow-hidden`,children:x&&x!=="none"?e.jsx("div",{className:"overflow-x-auto",children:e.jsx(wn,{style:{maxHeight:x},className:"relative",children:e.jsxs(ps,{className:"min-w-full",children:[e.jsx(xs,{className:y?"sticky top-0 bg-gray-100 z-10":"bg-gray-100",style:y?{position:"sticky",top:0,zIndex:10}:void 0,children:e.jsxs(De,{children:[g&&e.jsx(Z,{className:"w-12",children:e.jsx("input",{type:"checkbox",checked:I(),onChange:R=>F(R.target.checked),className:"rounded border-gray-300"})}),s.map(R=>e.jsx(Z,{className:`${H(R.align)} ${R.sortable?"cursor-pointer hover:bg-gray-50":""} ${R.headerClassName||""}`,style:{width:R.width},onClick:()=>S(R),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:R.label}),p(R)]})},R.key)),c.length>0&&e.jsx(Z,{className:"w-12",children:"Actions"})]})}),e.jsx(gs,{children:n?e.jsx(De,{children:e.jsx(W,{colSpan:s.length+(g?1:0)+(c.length>0?1:0),className:"text-center py-8",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-900"}),"Loading..."]})})}):A.length===0?e.jsx(De,{children:e.jsx(W,{colSpan:s.length+(g?1:0)+(c.length>0?1:0),className:"text-center py-8 text-gray-500",children:i})}):A.map((R,M)=>e.jsxs(De,{className:`
                      ${b&&M%2===1?"bg-gray-50":""}
                      ${O?"h-10":""}
                      ${o?"cursor-pointer hover:bg-gray-100":""}
                      ${v(R)?"bg-blue-50 border-blue-200":""}
                    `,onClick:()=>o?.(R),children:[g&&e.jsx(W,{children:e.jsx("input",{type:"checkbox",checked:v(R),onChange:K=>{K.stopPropagation(),h(R,K.target.checked)},className:"rounded border-gray-300"})}),s.map(K=>e.jsx(W,{className:`${H(K.align)} ${K.cellClassName||""}`,children:E(R[K.key],K,R)},K.key)),c.length>0&&e.jsx(W,{children:e.jsxs(aa,{children:[e.jsx(ra,{asChild:!0,children:e.jsx(L,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:K=>K.stopPropagation(),children:e.jsx(Va,{className:"h-4 w-4"})})}),e.jsx(Lt,{align:"end",children:c.map((K,Y)=>e.jsxs(bt,{onClick:G=>{G.stopPropagation(),K.onClick(R)},disabled:K.disabled?.(R),className:K.variant==="destructive"?"text-red-600":"",children:[K.icon&&e.jsx("span",{className:"mr-2",children:K.icon}),K.label]},Y))})]})})]},R[D]||M))})]})})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(ps,{className:"min-w-full",children:[e.jsx(xs,{className:y?"sticky top-0 bg-gray-100 z-10":"bg-gray-100",style:y?{position:"sticky",top:0,zIndex:10}:void 0,children:e.jsxs(De,{children:[g&&e.jsx(Z,{className:"w-12",children:e.jsx("input",{type:"checkbox",checked:I(),onChange:R=>F(R.target.checked),className:"rounded border-gray-300"})}),s.map(R=>e.jsx(Z,{className:`${H(R.align)} ${R.sortable?"cursor-pointer hover:bg-gray-50":""} ${R.headerClassName||""}`,style:{width:R.width},onClick:()=>S(R),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:R.label}),p(R)]})},R.key)),c.length>0&&e.jsx(Z,{className:"w-12",children:"Actions"})]})}),e.jsx(gs,{children:n?e.jsx(De,{children:e.jsx(W,{colSpan:s.length+(g?1:0)+(c.length>0?1:0),className:"text-center py-8",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-900"}),"Loading..."]})})}):A.length===0?e.jsx(De,{children:e.jsx(W,{colSpan:s.length+(g?1:0)+(c.length>0?1:0),className:"text-center py-8 text-gray-500",children:i})}):A.map((R,M)=>e.jsxs(De,{className:`
                      ${b&&M%2===1?"bg-gray-50":""}
                      ${O?"h-10":""}
                      ${o?"cursor-pointer hover:bg-gray-100":""}
                      ${v(R)?"bg-blue-50 border-blue-200":""}
                    `,onClick:()=>o?.(R),children:[g&&e.jsx(W,{children:e.jsx("input",{type:"checkbox",checked:v(R),onChange:K=>{K.stopPropagation(),h(R,K.target.checked)},className:"rounded border-gray-300"})}),s.map(K=>e.jsx(W,{className:`${H(K.align)} ${K.cellClassName||""}`,children:E(R[K.key],K,R)},K.key)),c.length>0&&e.jsx(W,{children:e.jsxs(aa,{children:[e.jsx(ra,{asChild:!0,children:e.jsx(L,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:K=>K.stopPropagation(),children:e.jsx(Va,{className:"h-4 w-4"})})}),e.jsx(Lt,{align:"end",children:c.map((K,Y)=>e.jsxs(bt,{onClick:G=>{G.stopPropagation(),K.onClick(R)},disabled:K.disabled?.(R),className:K.variant==="destructive"?"text-red-600":"",children:[K.icon&&e.jsx("span",{className:"mr-2",children:K.icon}),K.label]},Y))})]})})]},R[D]||M))})]})})}),g&&w.length>0&&e.jsxs("div",{className:"flex items-center justify-between bg-blue-50 p-3 rounded-lg",children:[e.jsxs("span",{className:"text-sm text-blue-700",children:[w.length," row",w.length>1?"s":""," selected"]}),e.jsx(L,{variant:"outline",size:"sm",onClick:()=>P?.([]),children:"Clear Selection"})]})]})},wt={view:r=>({label:"View",icon:e.jsx(mr,{className:"h-4 w-4"}),onClick:r}),edit:r=>({label:"Edit",icon:e.jsx(Xs,{className:"h-4 w-4"}),onClick:r}),delete:r=>({label:"Delete",icon:e.jsx($s,{className:"h-4 w-4"}),onClick:r,variant:"destructive"})},Zs=r=>{const[s,t]=ze.useState(r),a=ze.useCallback(l=>{t(l)},[]),n=ze.useCallback(()=>{t(void 0)},[]),i=ze.useCallback(l=>s?[...l].sort((u,c)=>{const o=u[s.column],d=c[s.column];let x=0;switch(s.dataType){case"number":x=(Number(o)||0)-(Number(d)||0);break;case"date":const y=new Date(o),b=new Date(d);x=y.getTime()-b.getTime();break;case"boolean":x=o===d?0:o?1:-1;break;default:x=String(o||"").localeCompare(String(d||""))}return s.direction==="desc"?-x:x}):l,[s]);return{currentSort:s,handleSort:a,clearSort:n,getSortedData:i}},re=Ei,ne=Di,te=m.forwardRef(({className:r,children:s,...t},a)=>e.jsxs(Or,{ref:a,className:ie("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",r),...t,children:[s,e.jsx(_i,{asChild:!0,children:e.jsx(Aa,{className:"h-4 w-4 opacity-50"})})]}));te.displayName=Or.displayName;const _n=m.forwardRef(({className:r,...s},t)=>e.jsx(Kr,{ref:t,className:ie("flex cursor-default items-center justify-center py-1",r),...s,children:e.jsx(Xn,{className:"h-4 w-4"})}));_n.displayName=Kr.displayName;const kn=m.forwardRef(({className:r,...s},t)=>e.jsx(Vr,{ref:t,className:ie("flex cursor-default items-center justify-center py-1",r),...s,children:e.jsx(Aa,{className:"h-4 w-4"})}));kn.displayName=Vr.displayName;const ae=m.forwardRef(({className:r,children:s,position:t="popper",...a},n)=>e.jsx(ki,{children:e.jsxs(Br,{ref:n,className:ie("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",r),position:t,...a,children:[e.jsx(_n,{}),e.jsx(Ci,{className:ie("p-1",t==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s}),e.jsx(kn,{})]})}));ae.displayName=Br.displayName;const Rl=m.forwardRef(({className:r,...s},t)=>e.jsx(Qr,{ref:t,className:ie("py-1.5 pl-8 pr-2 text-sm font-semibold",r),...s}));Rl.displayName=Qr.displayName;const N=m.forwardRef(({className:r,children:s,...t},a)=>e.jsxs(Hr,{ref:a,className:ie("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",r),...t,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Pi,{children:e.jsx(or,{className:"h-4 w-4"})})}),e.jsx(Ti,{children:s})]}));N.displayName=Hr.displayName;const ql=m.forwardRef(({className:r,...s},t)=>e.jsx(zr,{ref:t,className:ie("-mx-1 my-1 h-px bg-muted",r),...s}));ql.displayName=zr.displayName;const Al=()=>{const[r,s]=m.useState(!1),[t,a]=m.useState(!1),[n,i]=m.useState(null),[l,u]=m.useState(null),[c,o]=m.useState(""),[d,x]=m.useState([]),[y,b]=m.useState("all"),[T,O]=m.useState("all"),[g,w]=m.useState({from:"",to:""}),[P,D]=m.useState(1),[_,U]=m.useState(50),Q=ns(),{toast:C}=Ie(),{user:B,loading:A}=us(),{config:S}=_s("purchases"),{validationRules:h,canImport:F}=ks("purchases"),{currentSort:v,handleSort:I,getSortedData:p}=Zs(),[E,H]=m.useState({purchase_code:"",date:new Date().toISOString().split("T")[0],vendor_id:"",stock_id:"",quantity:"",rate:"",total_amount:""});m.useEffect(()=>{const{quantity:V,rate:Re}=E;if(V&&Re){const is=parseFloat(V)*parseFloat(Re);H(cs=>({...cs,total_amount:String(is)}))}else H(is=>({...is,total_amount:""}))},[E.quantity,E.rate]);const{data:R,isLoading:M,error:K}=de({queryKey:["purchases"],queryFn:()=>Ks.getAll(),enabled:!!B}),{data:Y,isLoading:G,error:le}=de({queryKey:["vendors"],queryFn:()=>Dt.getAll(),enabled:!!B}),{data:se,isLoading:ye,error:ve}=de({queryKey:["stocks"],queryFn:()=>ws.getAll(),enabled:!!B}),ke=ze.useMemo(()=>Y?new Map(Y.map(V=>[V.$id,V.vendor_name])):new Map,[Y]),je=ze.useMemo(()=>se?new Map(se.map(V=>[V.$id,V.stock_name])):new Map,[se]),Se=ze.useMemo(()=>R?R.map(V=>({...V,id:V.$id,vendor_name:ke.get(V.vendor_id)||"Unknown Vendor",stock_name:je.get(V.stock_id)||"Unknown Stock"})):[],[R,ke,je]),Ue=Ee({mutationFn:V=>l?Ks.update(l.id,V):Ks.create(V),onSuccess:()=>{Q.invalidateQueries({queryKey:["purchases"]}),s(!1),u(null),C({title:l?"Purchase Updated":"Purchase Created",description:`The purchase has been successfully ${l?"updated":"saved"}.`})},onError:V=>{C({title:"Error",description:V.message||`Failed to ${l?"update":"create"} purchase.`,variant:"destructive"})}}),Ae=Ee({mutationFn:V=>Ks.delete(V),onSuccess:()=>{Q.invalidateQueries({queryKey:["purchases"]}),C({title:"Purchase Deleted",description:"The purchase has been successfully deleted."})},onError:V=>{C({title:"Error",description:V.message||"Failed to delete purchase.",variant:"destructive"})}}),Me=V=>{i(V),a(!0)},He=()=>{n&&(Ae.mutate(n),i(null),a(!1))},$=V=>{u(V),H({...V,date:new Date(V.date).toISOString().split("T")[0],quantity:String(V.quantity),rate:String(V.rate),total_amount:String(V.total_amount),vendor_id:V.vendor_id,stock_id:V.stock_id}),s(!0)},k=V=>{if(V.preventDefault(),!E.purchase_code||!E.date||!E.vendor_id||!E.stock_id||!E.quantity||!E.rate){C({title:"Missing Fields",description:"Please fill out all required fields.",variant:"destructive"});return}const Re={purchase_code:E.purchase_code,date:E.date,vendor_id:E.vendor_id,stock_id:E.stock_id,quantity:parseFloat(E.quantity),rate:parseFloat(E.rate),total_amount:parseFloat(E.total_amount)};Ue.mutate(Re)},pe=Se.filter(V=>{const Re=V.purchase_code.toLowerCase().includes(c.toLowerCase())||V.vendor_name.toLowerCase().includes(c.toLowerCase())||V.stock_name.toLowerCase().includes(c.toLowerCase()),is=y==="all"||V.vendor_id===y,cs=T==="all"||V.stock_id===T,Ut=new Date(V.date),rt=(!g.from||Ut>=new Date(g.from))&&(!g.to||Ut<=new Date(g.to));return Re&&is&&cs&&rt}),fe=ze.useMemo(()=>{const V=new Map;return Se.forEach(Re=>{V.has(Re.vendor_id)||V.set(Re.vendor_id,{id:Re.vendor_id,name:Re.vendor_name})}),Array.from(V.values()).sort((Re,is)=>Re.name.localeCompare(is.name))},[Se]),we=ze.useMemo(()=>{const V=new Map;return Se.forEach(Re=>{V.has(Re.stock_id)||V.set(Re.stock_id,{id:Re.stock_id,name:Re.stock_name})}),Array.from(V.values()).sort((Re,is)=>Re.name.localeCompare(is.name))},[Se]),Te=pe.length,_e=Math.ceil(Te/_),Le=(P-1)*_,j=Le+_,ce=pe.slice(Le,j);m.useEffect(()=>{D(1)},[c,y,T,g,_]);const Ne=Ee({mutationFn:async V=>{await Promise.all(V.map(Re=>Ks.delete(Re)))},onSuccess:()=>{Q.invalidateQueries({queryKey:["purchases"]}),x([]),C({title:"Success",description:"Selected purchases deleted successfully."})},onError:()=>{C({title:"Error",description:"Failed to delete selected purchases.",variant:"destructive"})}}),ue=()=>{if(d.length===0){C({title:"No Selection",description:"Please select purchases to delete.",variant:"destructive"});return}confirm(`Are you sure you want to delete ${d.length} selected purchase(s)?`)&&Ne.mutate(d.map(V=>V.id))},Pe=()=>{if(d.length===0){C({title:"No Selection",description:"Please select purchases to export.",variant:"destructive"});return}C({title:"Export",description:`Exporting ${d.length} selected purchase(s)...`})},ls=A||M||G||ye,Cs=K||le||ve;return ls?e.jsx("div",{children:"Loading..."}):Cs?(console.error("Data loading error:",{purchasesError:K,vendorsError:le,stocksError:ve}),e.jsx("div",{children:"Error loading data."})):e.jsx("div",{className:"p-4",children:e.jsxs(X,{children:[e.jsx(me,{children:e.jsxs(he,{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Purchases"}),e.jsxs(L,{onClick:()=>s(!0),children:[e.jsx(vs,{className:"mr-2 h-4 w-4"})," Add New Purchase"]})]})}),e.jsxs(ee,{children:[e.jsx(X,{className:"mb-6",children:e.jsx(ee,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(os,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(z,{placeholder:"Search purchases...",className:"pl-10",value:c,onChange:V=>o(V.target.value)})]}),F&&S&&e.jsx(ys,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:S.exportColumns.filter(V=>V.required).map(V=>V.exportHeader),optionalColumns:S.exportColumns.filter(V=>!V.required).map(V=>V.exportHeader),validationRules:h,onImportComplete:V=>{V.successfulRows>0&&(Q.invalidateQueries({queryKey:["purchases"]}),C({title:"Import Successful",description:`${V.successfulRows} purchases imported successfully.`}))}},variant:"outline"}),S&&e.jsx(js,{data:pe.map(V=>{const Re={};return S.exportColumns.forEach(is=>{let cs;switch(is.dataKey){case"purchaseCode":cs=V.purchase_code;break;case"date":cs=V.date;break;case"vendorName":cs=V.vendor_name;break;case"stockName":cs=V.stock_name;break;case"quantity":cs=V.quantity;break;case"rate":cs=V.rate;break;case"totalAmount":cs=V.total_amount;break;case"status":cs="Completed";break;default:cs=V[is.dataKey]}Re[is.exportHeader]=is.formatter?is.formatter(cs):cs}),Re}),headers:S.exportColumns.map(V=>V.exportHeader),filename:"purchases",variant:"outline"})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs(re,{value:y,onValueChange:b,children:[e.jsx(te,{className:"w-[180px]",children:e.jsx(ne,{placeholder:"Filter by Vendor"})}),e.jsxs(ae,{children:[e.jsx(N,{value:"all",children:"All Vendors"}),fe.map(V=>e.jsx(N,{value:V.id,children:V.name},V.id))]})]}),e.jsxs(re,{value:T,onValueChange:O,children:[e.jsx(te,{className:"w-[180px]",children:e.jsx(ne,{placeholder:"Filter by Stock"})}),e.jsxs(ae,{children:[e.jsx(N,{value:"all",children:"All Stocks"}),we.map(V=>e.jsx(N,{value:V.id,children:V.name},V.id))]})]}),e.jsx(z,{type:"date",placeholder:"From Date",className:"w-[150px]",value:g.from,onChange:V=>w(Re=>({...Re,from:V.target.value}))}),e.jsx(z,{type:"date",placeholder:"To Date",className:"w-[150px]",value:g.to,onChange:V=>w(Re=>({...Re,to:V.target.value}))})]})]})})}),e.jsx(as,{open:r,onOpenChange:V=>{s(V),V||(u(null),H({purchase_code:"",date:new Date().toISOString().split("T")[0],vendor_id:"",stock_id:"",quantity:"",rate:"",total_amount:""}))},children:e.jsxs(Ze,{className:"sm:max-w-[600px]",children:[e.jsxs(es,{children:[e.jsx(ts,{children:l?"Edit Purchase":"Add New Purchase"}),e.jsx(rs,{children:l?"Update the purchase information below.":"Fill in the details to create a new purchase record."})]}),e.jsxs("form",{onSubmit:k,children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 py-4",children:[e.jsxs("div",{children:[e.jsx(q,{htmlFor:"purchase_code",children:"Purchase Code"}),e.jsx(z,{id:"purchase_code",value:E.purchase_code,onChange:V=>H({...E,purchase_code:V.target.value})})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"date",children:"Date"}),e.jsx(z,{id:"date",type:"date",value:E.date,onChange:V=>H({...E,date:V.target.value})})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"vendor_id",children:"Vendor"}),e.jsxs(re,{value:E.vendor_id,onValueChange:V=>H({...E,vendor_id:V}),children:[e.jsx(te,{id:"vendor_id",children:e.jsx(ne,{placeholder:"Select a vendor"})}),e.jsx(ae,{children:Y?.map(V=>e.jsx(N,{value:V.$id,children:V.vendor_name},V.$id))})]})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"stock_id",children:"Stock"}),e.jsxs(re,{value:E.stock_id,onValueChange:V=>H({...E,stock_id:V}),children:[e.jsx(te,{id:"stock_id",children:e.jsx(ne,{placeholder:"Select a stock item"})}),e.jsx(ae,{children:se?.map(V=>e.jsx(N,{value:V.$id,children:V.stock_name},V.$id))})]})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"quantity",children:"Quantity"}),e.jsx(z,{id:"quantity",type:"number",value:E.quantity,onChange:V=>H({...E,quantity:V.target.value})})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"rate",children:"Rate"}),e.jsx(z,{id:"rate",type:"number",value:E.rate,onChange:V=>H({...E,rate:V.target.value})})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"total_amount",children:"Total Amount"}),e.jsx(z,{id:"total_amount",type:"number",value:E.total_amount,readOnly:!0,className:"bg-gray-100"})]})]}),e.jsx(ss,{children:e.jsx(L,{type:"submit",disabled:Ue.isPending,children:Ue.isPending?"Saving...":l?"Update Purchase":"Create Purchase"})})]})]})}),e.jsx(as,{open:t,onOpenChange:a,children:e.jsxs(Ze,{children:[e.jsx(es,{children:e.jsx(ts,{children:"Are you sure?"})}),e.jsx("div",{className:"py-4",children:e.jsx("p",{children:"This action cannot be undone. This will permanently delete the purchase."})}),e.jsxs(ss,{children:[e.jsx(L,{variant:"outline",onClick:()=>a(!1),children:"Cancel"}),e.jsx(L,{variant:"destructive",onClick:He,children:"Delete"})]})]})}),e.jsx(X,{children:e.jsxs(ee,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",Le+1," to ",Math.min(j,Te)," of ",Te," records"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Records per page:"}),e.jsxs(re,{value:_.toString(),onValueChange:V=>U(Number(V)),children:[e.jsx(te,{className:"w-[100px]",children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(N,{value:"50",children:"50"}),e.jsx(N,{value:"100",children:"100"}),e.jsx(N,{value:"500",children:"500"})]})]})]})]}),d.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 p-3 bg-muted rounded-md",children:[e.jsxs("span",{className:"text-sm font-medium",children:[d.length," selected"]}),e.jsx(L,{variant:"destructive",size:"sm",onClick:ue,disabled:Ne.isPending,children:"Delete Selected"}),e.jsx(L,{variant:"outline",size:"sm",onClick:Pe,children:"Export Selected"})]}),e.jsx("div",{className:"border rounded-md",children:e.jsx("div",{className:"overflow-auto",style:{maxHeight:"600px"},children:e.jsx(tt,{data:p(ce.map(V=>((!V.date||V.date==="Invalid Date")&&console.warn("Invalid purchase date found:",{id:V.$id,date:V.date,purchase_code:V.purchase_code}),{...V,formattedDate:ua(V.date),status:"Completed"}))),columns:[{key:"purchase_code",label:"Purchase Code",sortable:!0,dataType:"string"},{key:"formattedDate",label:"Date",sortable:!0,dataType:"date"},{key:"vendor_name",label:"Vendor Name",sortable:!0,dataType:"string"},{key:"stock_name",label:"Stock Name",sortable:!0,dataType:"string"},{key:"quantity",label:"Quantity",sortable:!0,dataType:"number",align:"right",headerClassName:"bg-purple-50",cellClassName:"bg-purple-50 font-medium"},{key:"rate",label:"Rate",sortable:!0,dataType:"number",align:"right"},{key:"total_amount",label:"Total Amount",sortable:!0,dataType:"number",align:"right"},{key:"status",label:"Status",sortable:!0,dataType:"string",formatter:V=>e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${V==="Completed"?"bg-green-100 text-green-800":V==="In Progress"?"bg-yellow-100 text-yellow-800":V==="Pending"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:V})}],onSort:I,currentSort:v,loading:ls,maxHeight:"none",stickyHeader:!0,bordered:!1,searchable:!1,rowKey:"$id",selectable:!0,selectedRows:d,onSelectionChange:x,actions:[{label:"Edit",onClick:$,variant:"default"},{label:"Delete",onClick:V=>Me(V.id),variant:"destructive"}],emptyMessage:"No purchases found"})})}),_e>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx(L,{variant:"outline",size:"sm",onClick:()=>D(V=>Math.max(1,V-1)),disabled:P===1,children:"Previous"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",P," of ",_e]})}),e.jsx(L,{variant:"outline",size:"sm",onClick:()=>D(V=>Math.min(_e,V+1)),disabled:P===_e,children:"Next"})]})]})})]})]})})},Cn=()=>{const{data:r=[],...s}=de({queryKey:["preProductionTasks"],queryFn:async()=>Fs.getPreProductionTasksWithRelations()});return{tasks:r,...s}},Pn=()=>{const{data:r=[],isLoading:s,error:t,refetch:a}=de({queryKey:["production_tasks"],queryFn:async()=>await qs.getProductionTasksWithRelations(),staleTime:12e4,gcTime:6e5,refetchOnWindowFocus:!1,retry:3,retryDelay:n=>Math.min(1e3*2**n,3e4)});return{tasks:r,isLoading:s,error:t,refetch:a}},Fl=()=>{const r=ns(),s=Ee({mutationFn:async({taskData:n,stockItems:i})=>{const l=await qs.create(n);return i.length>0&&await Promise.all(i.map(u=>qt.create({production_task_id:l.$id,stock_id:u.stock_id,quantity:u.quantity,action:u.action}))),l},onSuccess:()=>{r.invalidateQueries({queryKey:["production_tasks"]})},onError:n=>{console.error("Error creating production task:",n)}}),t=Ee({mutationFn:async({id:n,taskData:i,stockItems:l})=>{const u=await qs.update(n,i);return l&&(await qt.deleteByProductionTaskId(n),l.length>0&&await Promise.all(l.map(c=>qt.create({production_task_id:n,stock_id:c.stock_id,quantity:c.quantity,action:c.action})))),u},onSuccess:()=>{r.invalidateQueries({queryKey:["production_tasks"]})},onError:n=>{console.error("Error updating production task:",n)}}),a=Ee({mutationFn:async n=>(await qt.deleteByProductionTaskId(n),await qs.delete(n)),onSuccess:()=>{r.invalidateQueries({queryKey:["production_tasks"]})},onError:n=>{console.error("Error deleting production task:",n)}});return{createTask:s,updateTask:t,deleteTask:a}},Tn=()=>{const{data:r=[],isLoading:s,error:t,refetch:a}=de({queryKey:["post_production_tasks"],queryFn:async()=>await Ws.getPostProductionTasksWithRelations(),staleTime:12e4,gcTime:6e5,refetchOnWindowFocus:!1,retry:3,retryDelay:n=>Math.min(1e3*2**n,3e4)});return{tasks:r,isLoading:s,error:t,refetch:a}},$l=()=>{const r=ns(),s=Ee({mutationFn:n=>Ws.create(n),onSuccess:()=>{r.invalidateQueries({queryKey:["post_production_tasks"]})},onError:n=>{console.error("Error creating post-production task:",n)}}),t=Ee({mutationFn:({id:n,data:i})=>Ws.update(n,i),onSuccess:()=>{r.invalidateQueries({queryKey:["post_production_tasks"]})},onError:n=>{console.error("Error updating post-production task:",n)}}),a=Ee({mutationFn:n=>Ws.delete(n),onSuccess:()=>{r.invalidateQueries({queryKey:["post_production_tasks"]})},onError:n=>{console.error("Error deleting post-production task:",n)}});return{createTask:s,updateTask:t,deleteTask:a}},Ll=()=>{const{tasks:r}=Cn(),{tasks:s}=Pn(),{tasks:t}=Tn(),a=u=>({total:u.length,pending:u.filter(c=>c.status==="pending").length,inProgress:u.filter(c=>c.status==="in_progress").length,completed:u.filter(c=>c.status==="completed").length}),n=a(r),i=a(s),l=a(t);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Tasks Module"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage production tasks across all stages"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs(X,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(me,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ra,{className:"h-5 w-5 text-primary"}),e.jsx(he,{children:"Pre-Production Tasks"})]}),e.jsx(Ce,{children:"Manage pre-production planning and preparation tasks"})]}),e.jsxs(ee,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Track material requisitions, planning approvals, and preparation progress"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-orange-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-orange-700",children:n.pending}),e.jsx("div",{className:"text-orange-600",children:"Pending"})]}),e.jsxs("div",{className:"bg-blue-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-blue-700",children:n.inProgress}),e.jsx("div",{className:"text-blue-600",children:"In Progress"})]}),e.jsxs("div",{className:"bg-green-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-green-700",children:n.completed}),e.jsx("div",{className:"text-green-600",children:"Completed"})]}),e.jsxs("div",{className:"bg-gray-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-gray-700",children:n.total}),e.jsx("div",{className:"text-gray-600",children:"Total"})]})]})]}),e.jsx(Ms,{className:"border-t pt-4",children:e.jsx(L,{asChild:!0,className:"w-full",children:e.jsxs(Es,{to:"/tasks/pre-production",children:["View Pre-Production Tasks",e.jsx(Is,{className:"ml-2 h-4 w-4"})]})})})]}),e.jsxs(X,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(me,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(hr,{className:"h-5 w-5 text-primary"}),e.jsx(he,{children:"Production Tasks"})]}),e.jsx(Ce,{children:"Track manufacturing and production progress"})]}),e.jsxs(ee,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Monitor work-in-progress, production timelines, and quality checks"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-orange-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-orange-700",children:i.pending}),e.jsx("div",{className:"text-orange-600",children:"Pending"})]}),e.jsxs("div",{className:"bg-blue-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-blue-700",children:i.inProgress}),e.jsx("div",{className:"text-blue-600",children:"In Progress"})]}),e.jsxs("div",{className:"bg-green-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-green-700",children:i.completed}),e.jsx("div",{className:"text-green-600",children:"Completed"})]}),e.jsxs("div",{className:"bg-gray-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-gray-700",children:i.total}),e.jsx("div",{className:"text-gray-600",children:"Total"})]})]})]}),e.jsx(Ms,{className:"border-t pt-4",children:e.jsx(L,{asChild:!0,className:"w-full",children:e.jsxs(Es,{to:"/tasks/production",children:["View Production Tasks",e.jsx(Is,{className:"ml-2 h-4 w-4"})]})})})]}),e.jsxs(X,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(me,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(St,{className:"h-5 w-5 text-primary"}),e.jsx(he,{children:"Post-Production Tasks"})]}),e.jsx(Ce,{children:"Track finishing, packaging, and shipping"})]}),e.jsxs(ee,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Monitor finishing processes, packaging, and logistics"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-orange-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-orange-700",children:l.pending}),e.jsx("div",{className:"text-orange-600",children:"Pending"})]}),e.jsxs("div",{className:"bg-blue-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-blue-700",children:l.inProgress}),e.jsx("div",{className:"text-blue-600",children:"In Progress"})]}),e.jsxs("div",{className:"bg-green-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-green-700",children:l.completed}),e.jsx("div",{className:"text-green-600",children:"Completed"})]}),e.jsxs("div",{className:"bg-gray-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-gray-700",children:l.total}),e.jsx("div",{className:"text-gray-600",children:"Total"})]})]})]}),e.jsx(Ms,{className:"border-t pt-4",children:e.jsx(L,{asChild:!0,className:"w-full",children:e.jsxs(Es,{to:"/tasks/post-production",children:["View Post-Production Tasks",e.jsx(Is,{className:"ml-2 h-4 w-4"})]})})})]})]}),e.jsxs(X,{children:[e.jsx(me,{children:e.jsx(he,{className:"flex items-center gap-2",children:"Task Management System"})}),e.jsx(ee,{children:e.jsx("div",{className:"text-center py-6 text-muted-foreground",children:e.jsx("p",{className:"text-sm",children:"Comprehensive task management across all production stages with real-time tracking and reporting"})})})]})]})},Il=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Status Module"}),e.jsx("p",{className:"text-muted-foreground",children:"Track real-time status across all production stages"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs(X,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(me,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Zn,{className:"h-5 w-5 text-primary"}),e.jsx(he,{children:"Stock Status"})]}),e.jsx(Ce,{children:"Track raw material and component inventory"})]}),e.jsx(ee,{children:e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Monitor stock levels, movements, and availability of raw materials and components"})}),e.jsx(Ms,{className:"border-t pt-4",children:e.jsx(L,{asChild:!0,className:"w-full",children:e.jsxs(Es,{to:"/status/stock-status",children:["View Stock Status",e.jsx(Is,{className:"ml-2 h-4 w-4"})]})})})]}),e.jsxs(X,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(me,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ra,{className:"h-5 w-5 text-primary"}),e.jsx(he,{children:"Pre-production Status"})]}),e.jsx(Ce,{children:"Track pre-production planning and preparation"})]}),e.jsx(ee,{children:e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Monitor material requisitions, planning approvals, and preparation progress"})}),e.jsx(Ms,{className:"border-t pt-4",children:e.jsx(L,{asChild:!0,className:"w-full",children:e.jsxs(Es,{to:"/status/pre-production-status",children:["View Pre-production Status",e.jsx(Is,{className:"ml-2 h-4 w-4"})]})})})]}),e.jsxs(X,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(me,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(hr,{className:"h-5 w-5 text-primary"}),e.jsx(he,{children:"Production Status"})]}),e.jsx(Ce,{children:"Track manufacturing and production progress"})]}),e.jsx(ee,{children:e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Monitor work-in-progress, production timelines, and quality checks"})}),e.jsx(Ms,{className:"border-t pt-4",children:e.jsx(L,{asChild:!0,className:"w-full",children:e.jsxs(Es,{to:"/status/production-status",children:["View Production Status",e.jsx(Is,{className:"ml-2 h-4 w-4"})]})})})]}),e.jsxs(X,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(me,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(St,{className:"h-5 w-5 text-primary"}),e.jsx(he,{children:"Post-Production Status"})]}),e.jsx(Ce,{children:"Track finishing, packaging, and shipping"})]}),e.jsx(ee,{children:e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Monitor finishing processes, packaging, and logistics"})}),e.jsx(Ms,{className:"border-t pt-4",children:e.jsx(L,{asChild:!0,className:"w-full",children:e.jsxs(Es,{to:"/status/post-production-status",children:["View Post-Production Status",e.jsx(Is,{className:"ml-2 h-4 w-4"})]})})})]}),e.jsxs(X,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(me,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(It,{className:"h-5 w-5 text-primary"}),e.jsx(he,{children:"Inventory Status"})]}),e.jsx(Ce,{children:"Track overall inventory movements and valuation"})]}),e.jsx(ee,{children:e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Monitor opening/closing balances, receiving, issue, and inventory value"})}),e.jsx(Ms,{className:"border-t pt-4",children:e.jsx(L,{asChild:!0,className:"w-full",children:e.jsxs(Es,{to:"/status/inventory-status",children:["View Inventory Status",e.jsx(Is,{className:"ml-2 h-4 w-4"})]})})})]})]}),e.jsxs(X,{children:[e.jsx(me,{children:e.jsx(he,{className:"flex items-center gap-2",children:"Database Connection"})}),e.jsx(ee,{children:e.jsx("div",{className:"text-center py-6 text-muted-foreground",children:e.jsx("p",{className:"text-sm",children:"For real-time data tracking and management, ensure your application is connected to Appwrite database"})})})]})]}),Ls={products:["products"],stocks:["stocks"],vendors:["vendors"],staff:["staff"],processes:["processes"],rawProducts:["raw-products"],salesChannels:["sales-channels"],salesUnits:r=>["sales-units",r?.from,r?.to].filter(Boolean),salesRecords:r=>["sales-records",r?.from,r?.to].filter(Boolean),stockStatus:["stock-status"],preProductionStatus:["pre-production-status"],productionStatus:["production-status"],postProductionStatus:["post-production-status"],inventoryStatus:r=>["inventory-status",r?.from,r?.to].filter(Boolean),preProductionTasks:["pre-production-tasks"],productionTasks:["production-tasks"],postProductionTasks:["post-production-tasks"],purchases:["purchases"]},Ml=()=>{const{data:r=[]}=de({queryKey:Ls.salesUnits(),queryFn:()=>zs.getAll(),staleTime:3e5}),{data:s=[]}=de({queryKey:Ls.salesRecords(),queryFn:()=>ot.getAll(),staleTime:5*60*1e3}),t={total:r.length,totalUnits:r.reduce((n,i)=>n+(i.units||0),0),recentEntries:r.filter(n=>{const i=new Date(n.date),l=new Date;return l.setDate(l.getDate()-7),i>=l}).length,uniqueProducts:new Set(r.map(n=>n.product_id)).size},a={total:s.length,totalRevenue:s.reduce((n,i)=>n+(i.sold_units||0)*(i.unit_price||0),0),recentSales:s.filter(n=>{const i=new Date(n.date),l=new Date;return l.setDate(l.getDate()-7),i>=l}).length,totalUnitsSold:s.reduce((n,i)=>n+(i.sold_units||0),0)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Sales Module"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage sales units, records, and finished goods inventory"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(X,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(me,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(St,{className:"h-5 w-5 text-primary"}),e.jsx(he,{children:"Sales Units"})]}),e.jsx(Ce,{children:"Track batch coding utilization and inventory movement"})]}),e.jsxs(ee,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:'Sales units added by user using "Add Form" from "Batch Coding" process in Post Production tasks'}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-purple-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-purple-700",children:t.total}),e.jsx("div",{className:"text-purple-600",children:"Total Entries"})]}),e.jsxs("div",{className:"bg-blue-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-blue-700",children:t.totalUnits.toLocaleString()}),e.jsx("div",{className:"text-blue-600",children:"Total Units"})]}),e.jsxs("div",{className:"bg-green-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-green-700",children:t.recentEntries}),e.jsx("div",{className:"text-green-600",children:"This Week"})]}),e.jsxs("div",{className:"bg-orange-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-orange-700",children:t.uniqueProducts}),e.jsx("div",{className:"text-orange-600",children:"Products"})]})]})]}),e.jsx(Ms,{className:"border-t pt-4",children:e.jsx(L,{asChild:!0,className:"w-full",children:e.jsxs(Es,{to:"/sales/units",children:["View Sales Units",e.jsx(Is,{className:"ml-2 h-4 w-4"})]})})})]}),e.jsxs(X,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(me,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(nr,{className:"h-5 w-5 text-primary"}),e.jsx(he,{children:"Sales Records"})]}),e.jsx(Ce,{children:"Track sold units with pricing and revenue"})]}),e.jsxs(ee,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:'Total sum of all the "sold units" for the respective SKU in date range in "Sales Record Page"'}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-green-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-green-700",children:a.total}),e.jsx("div",{className:"text-green-600",children:"Total Records"})]}),e.jsxs("div",{className:"bg-blue-50 p-2 rounded text-center",children:[e.jsxs("div",{className:"font-semibold text-blue-700",children:["â‚¹",a.totalRevenue.toLocaleString()]}),e.jsx("div",{className:"text-blue-600",children:"Total Revenue"})]}),e.jsxs("div",{className:"bg-purple-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-purple-700",children:a.recentSales}),e.jsx("div",{className:"text-purple-600",children:"Recent Sales"})]}),e.jsxs("div",{className:"bg-orange-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-orange-700",children:a.totalUnitsSold.toLocaleString()}),e.jsx("div",{className:"text-orange-600",children:"Units Sold"})]})]})]}),e.jsx(Ms,{className:"border-t pt-4",children:e.jsx(L,{asChild:!0,className:"w-full",children:e.jsxs(Es,{to:"/sales/records",children:["View Sales Records",e.jsx(Is,{className:"ml-2 h-4 w-4"})]})})})]})]}),e.jsxs(X,{children:[e.jsx(me,{children:e.jsxs(he,{className:"flex items-center gap-2",children:[e.jsx(It,{className:"h-5 w-5 text-primary"}),"Sales Management System"]})}),e.jsx(ee,{children:e.jsx("div",{className:"text-center py-6 text-muted-foreground",children:e.jsx("p",{className:"text-sm",children:"Comprehensive sales tracking from batch coding utilization to final revenue with real-time inventory management"})})})]})]})};function En({className:r,classNames:s,showOutsideDays:t=!0,presets:a,...n}){return e.jsxs("div",{className:"flex",children:[a&&e.jsx("div",{className:"flex flex-col items-start pr-4 border-r border-gray-200",children:a.map(i=>e.jsx(L,{variant:"ghost",className:"w-full justify-start mb-1",onClick:()=>{n.onSelect&&typeof n.onSelect=="function"&&n.onSelect(i.range)},children:i.name},i.name))}),e.jsx(Bi,{showOutsideDays:t,className:ie("p-3",r),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:ie(Pa({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:ie(Pa({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...s},components:{IconLeft:({...i})=>e.jsx(ei,{className:"h-4 w-4"}),IconRight:({...i})=>e.jsx(ir,{className:"h-4 w-4"})},...n})]})}En.displayName="Calendar";const Ul=qi,Ol=Ai,Dn=m.forwardRef(({className:r,align:s="center",sideOffset:t=4,...a},n)=>e.jsx(Ri,{children:e.jsx(Yr,{ref:n,align:s,sideOffset:t,className:ie("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...a})}));Dn.displayName=Yr.displayName;function Ct({value:r,onChange:s,className:t}){const[a,n]=m.useState("this-month"),[i,l]=m.useState(!1),u=[{id:"this-month",name:"This month",range:{from:Vs(new Date),to:Bs(new Date)}},{id:"previous-month",name:"Previous month",range:{from:Vs(ga(new Date,1)),to:Bs(ga(new Date,1))}},{id:"last-6-months",name:"Last 6 months",range:{from:ga(new Date,6),to:new Date}},{id:"custom",name:"Custom",range:void 0}],c=d=>{n(d);const x=u.find(y=>y.id===d);x&&x.id!=="custom"?(s(x.range),l(!1)):l(!0)},o=()=>r?.from?r.to?`${$e(r.from,"dd MMM")} - ${$e(r.to,"dd MMM yyyy")}`:$e(r.from,"dd MMM yyyy"):"Select date range";return m.useEffect(()=>{if(!r&&a==="this-month"&&typeof s=="function"){const d=u.find(x=>x.id==="this-month");d&&s(d.range)}},[r,s,a,u]),e.jsxs("div",{className:ie("flex items-center gap-2",t),children:[e.jsxs(re,{value:a,onValueChange:c,children:[e.jsx(te,{className:"w-[150px]",children:e.jsx(ne,{})}),e.jsx(ae,{children:u.map(d=>e.jsx(N,{value:d.id,children:d.name},d.id))})]}),e.jsxs(Ul,{open:i,onOpenChange:l,children:[e.jsx(Ol,{asChild:!0,children:e.jsxs(L,{id:"date",variant:"outline",className:ie("min-w-[200px] justify-between text-left font-normal",!r&&"text-muted-foreground"),onClick:()=>{a==="custom"&&l(!i)},children:[o(),a==="custom"&&e.jsx(Aa,{className:"h-4 w-4 opacity-50"})]})}),a==="custom"&&e.jsx(Dn,{className:"w-auto p-0",align:"start",children:e.jsx(En,{initialFocus:!0,mode:"range",defaultMonth:r?.from,selected:r,onSelect:d=>{s(d),d?.from&&d?.to&&l(!1)},numberOfMonths:2})})]})]})}const Ja=r=>r.toISOString();function Kl(){const{user:r,loading:s}=us(),t=st(),{toast:a}=Ie(),n=ns(),[i,l]=m.useState(void 0),[u,c]=m.useState(!1),[o,d]=m.useState(null),[x,y]=m.useState([]),[b,T]=m.useState("all"),[O,g]=m.useState("all"),[w,P]=m.useState(""),[D,_]=m.useState({from:"",to:""}),[U,Q]=m.useState(1),[C,B]=m.useState(50),{config:A}=_s("sales-units"),{validationRules:S,canImport:h}=ks("sales-units"),{currentSort:F,handleSort:v,getSortedData:I}=Zs();if(ze.useEffect(()=>{o&&u&&(console.log("ðŸ”„ Populating form for edit:",o),ce({date:o.date,product_id:o.product_id,sku:o.sku,units:o.units,notes:o.notes||"",dateString:new Date(o.date).toISOString().split("T")[0]}))},[o,u]),s)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Oe,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Validating authentication..."})]})});if(!r)return console.error("SalesUnits: User not authenticated, redirecting to login",{location:t.pathname,timestamp:new Date().toISOString(),userAgent:navigator.userAgent}),e.jsx(kt,{to:"/login",state:{from:t},replace:!0});ze.useEffect(()=>()=>{},[r,t]);const{data:p=[],error:E}=de({queryKey:["products"],queryFn:async()=>{try{const f=await Rs.getAll();return console.log("ðŸ“¦ Products loaded for sales:",f.map(J=>({id:J.$id,name:J.product||J.product_name,sku:J.sku}))),f}catch(f){throw console.error("SalesUnits: Failed to fetch products",{error:f.message,code:f.code,type:f.type,userId:r?.$id,stack:f.stack}),f}},retry:(f,J)=>J.code===401||J.code===403?!1:f<3}),{data:H=[]}=de({queryKey:["post-production-tasks"],queryFn:async()=>{try{return await Ws.getAll()}catch(f){throw console.error("SalesUnits: Failed to fetch post-production tasks",f),f}},retry:(f,J)=>J.code===401||J.code===403?!1:f<3}),{data:R=[]}=de({queryKey:["processes"],queryFn:async()=>{try{const f=await Us.getAll();return console.log("ðŸ”§ Processes loaded for sales validation:",f.map(J=>({id:J.$id,name:J.process_name,department:J.department}))),f}catch(f){throw console.error("SalesUnits: Failed to fetch processes",f),f}},staleTime:5*60*1e3}),{data:M=[],isLoading:K,error:Y}=de({queryKey:["post-production-status"],queryFn:async()=>{console.log("ðŸš€ Starting post-production status query...");try{const f=await _l.getAll();return console.log("âœ… Post-production status query successful:",f.length,"records"),console.log("ðŸ“‹ All PostProductionStatus records:",f.map(J=>({product_id:J.product_id,closing_balance:J.closing_balance,status_date:J.status_date}))),f}catch(f){throw console.error("âŒ SalesUnits: Failed to fetch post-production status",{message:f.message,code:f.code,type:f.type,stack:f.stack}),f}},retry:(f,J)=>(console.log(`ðŸ”„ Retrying post-production status query (attempt ${f+1})`),J.code===401||J.code===403?(console.log("ðŸš« Authentication error, not retrying"),!1):f<3),enabled:!!r});ze.useEffect(()=>{console.log("ðŸ“Š Post-production status query status:",{isLoading:K,hasError:!!Y,dataLength:M.length,error:Y?.message})},[K,Y,M.length]);const G=m.useMemo(()=>{const f=[];return i?.from&&f.push(Ke.greaterThanEqual("date",Ja(i.from))),i?.to&&f.push(Ke.lessThanEqual("date",Ja(i.to))),f},[i]),{data:le=[],isLoading:se,error:ye}=de({queryKey:["sales-units",i?.from?.toISOString(),i?.to?.toISOString()],queryFn:async()=>{try{return await zs.getAll(G)}catch(f){throw console.error("SalesUnits: Failed to fetch sales units",{error:f.message,code:f.code,type:f.type,queries:G,userId:r?.$id,stack:f.stack}),f}},retry:(f,J)=>J.code===401||J.code===403?!1:f<3});ze.useEffect(()=>{ye&&(console.error("SalesUnits: Sales units query error detected",ye),a({title:"Data Loading Error",description:"Failed to load sales units. Please refresh the page.",variant:"destructive"}))},[ye,a]),ze.useEffect(()=>{E&&(console.error("SalesUnits: Products query error detected",E),a({title:"Products Loading Error",description:"Failed to load products. Some features may not work properly.",variant:"destructive"}))},[E,a]);const ve=Ee({mutationFn:async f=>await cs(async()=>await zs.create(f)),onMutate:()=>{if(Pe==="offline")throw a({title:"Offline",description:"You are currently offline. Please check your connection.",variant:"destructive"}),new Error("Network offline")},onError:(f,J)=>{try{throw console.error("SalesUnits: Failed to create sales unit",{error:f.message,code:f.code,type:f.type,payload:J,userId:r?.$id}),f.code===401?(a({title:"Authentication Error",description:"Your session has expired. Please log in again.",variant:"destructive"}),window.location.href="/login",f):f.code===403?(a({title:"Permission Denied",description:"You don't have permission to create sales units.",variant:"destructive"}),f):f.code>=500?(a({title:"Server Error",description:"A server error occurred. Please try again later.",variant:"destructive"}),f):is(f)?(a({title:"Network Error",description:Pe==="offline"?"You appear to be offline. Please check your internet connection.":"Network error occurred. Retrying...",variant:"destructive"}),f):(a({title:"Error",description:f.message||"Failed to create sales unit. Please try again.",variant:"destructive"}),f)}catch(xe){throw console.error("SalesUnits: Error in mutation error handler",xe),xe}},onSuccess:f=>{n.invalidateQueries({queryKey:["sales-units"]}),a({title:"Success",description:"Sales unit created successfully.",duration:3e3}),c(!1);const J={date:new Date().toISOString(),product_id:"",sku:"",units:0,notes:""};ce(J),ue({}),y([]),d(null)}}),ke=Ee({mutationFn:async({id:f,data:J})=>await cs(async()=>await zs.update(f,J)),onSuccess:f=>{n.invalidateQueries({queryKey:["sales-units"]}),a({title:"Success",description:"Sales unit updated successfully.",duration:3e3}),c(!1),d(null);const J={date:new Date().toISOString(),product_id:"",sku:"",units:0,notes:""};ce(J),ue({})},onError:f=>{console.error("Failed to update sales unit:",f),a({title:"Error",description:f.message||"Failed to update sales unit. Please try again.",variant:"destructive"})}}),je=Ee({mutationFn:f=>zs.delete(f),onSuccess:()=>{n.invalidateQueries({queryKey:["sales-units"]}),a({title:"Success",description:"Sales unit deleted successfully."})},onError:()=>{a({title:"Error",description:"Failed to delete sales unit.",variant:"destructive"})}}),Se=Ee({mutationFn:async f=>{await Promise.all(f.map(J=>zs.delete(J)))},onSuccess:()=>{n.invalidateQueries({queryKey:["sales-units"]}),y([]),a({title:"Success",description:"Selected units deleted successfully."})},onError:()=>{a({title:"Error",description:"Failed to delete selected units.",variant:"destructive"})}}),Ue=f=>{console.log("ðŸ” Editing sales unit:",f),d(f),c(!0)},Ae=f=>{confirm("Are you sure you want to delete this sales unit?")&&je.mutate(f)},Me=()=>{if(x.length===0){a({title:"No Selection",description:"Please select units to delete.",variant:"destructive"});return}confirm(`Are you sure you want to delete ${x.length} selected unit(s)?`)&&Se.mutate(x.map(f=>f.$id))},He=le.filter(f=>{const J=!w||f.sku.toLowerCase().includes(w.toLowerCase())||f.notes&&f.notes.toLowerCase().includes(w.toLowerCase()),xe=b==="all"||f.product_id===b,ge=O==="all"||f.sku===O,Fe=new Date(f.date),ds=(!D.from||Fe>=new Date(D.from))&&(!D.to||Fe<=new Date(D.to));return J&&xe&&ge&&ds}),$=ze.useMemo(()=>{const f=new Map;return le.forEach(J=>{f.has(J.product_id)||f.set(J.product_id,{id:J.product_id,name:p.find(xe=>xe.$id===J.product_id)?.product||J.product_id})}),Array.from(f.values()).sort((J,xe)=>J.name.localeCompare(xe.name))},[le,p]),k=ze.useMemo(()=>Array.from(new Set(le.map(f=>f.sku))).sort(),[le]),pe=He.length,fe=Math.ceil(pe/C),we=(U-1)*C,Te=we+C,_e=He.slice(we,Te);ze.useEffect(()=>{Q(1)},[w,b,O,D,C]);const Le=()=>{if(x.length===0){a({title:"No Selection",description:"Please select units to export.",variant:"destructive"});return}a({title:"Export",description:`Exporting ${x.length} selected unit(s)...`})},[j,ce]=m.useState({date:new Date().toISOString(),product_id:"",sku:"",units:0,notes:""}),[Ne,ue]=m.useState({}),[Pe,ls]=m.useState("online"),[Cs,V]=m.useState(0),Re=ze.useMemo(()=>{const f={date:new Date().toISOString(),product_id:"",sku:"",units:0,notes:""};return j.product_id!==f.product_id||j.sku!==f.sku||j.units!==f.units||(j.notes||"")!==f.notes||j.dateString&&j.dateString!==new Date().toISOString().split("T")[0]},[j]);ze.useEffect(()=>{const f=()=>{ls("online"),a({title:"Connection Restored",description:"Your internet connection has been restored."})},J=()=>{ls("offline"),a({title:"Connection Lost",description:"Please check your internet connection.",variant:"destructive"})};return window.addEventListener("online",f),window.addEventListener("offline",J),ls(navigator.onLine?"online":"offline"),()=>{window.removeEventListener("online",f),window.removeEventListener("offline",J)}},[a]);const is=f=>f.message?.toLowerCase().includes("network")||f.message?.toLowerCase().includes("fetch")||f.message?.toLowerCase().includes("connection")||f.code==="NETWORK_ERROR"||!navigator.onLine,cs=async(f,J=3)=>{let xe;for(let ge=1;ge<=J;ge++)try{if(V(ge-1),ge>1){const ds=Math.min(1e3*Math.pow(2,ge-2),1e4);await new Promise(Ns=>setTimeout(Ns,ds))}const Fe=await f();return V(0),Fe}catch(Fe){if(xe=Fe,console.error(`SalesUnits: Retry attempt ${ge} failed`,{error:Fe.message,isNetworkError:is(Fe),attempt:ge,maxRetries:J}),Fe.code===401||Fe.code===403||!is(Fe)&&ge===J)break}throw V(0),xe},Ut=(f,J)=>{const xe={...Ne};switch(f){case"product_id":J?delete xe.product_id:xe.product_id="Product is required";break;case"sku":J?delete xe.sku:xe.sku="SKU is required";break;case"units":!J||J<=0?xe.units="Units must be greater than 0":delete xe.units;break;case"dateString":J?delete xe.dateString:xe.dateString="Date is required";break}return ue(xe),Object.keys(xe).length===0},rt=f=>{const J={...j,...f};ce(J),Object.keys(f).forEach(xe=>{Ut(xe,f[xe])})},Ln=async()=>{try{return r?!0:(a({title:"Session Expired",description:"Please log in again to continue.",variant:"destructive"}),!1)}catch{return a({title:"Session Error",description:"Unable to validate your session. Please log in again.",variant:"destructive"}),!1}},In=f=>{console.log("ðŸ” Checking if product has available batch coding units:",f);const J=M.find(xe=>xe.product_id===f);if(console.log("ðŸ“‹ Post-production status for product:",J),J&&(J.closing_balance||0)>0){const ge=p.find(Fe=>Fe.$id===f)?.sku;if(ge){const Fe=le.filter(Ns=>Ns.sku===ge).reduce((Ns,Ps)=>Ns+(Ps.units||0),0),ds=(J.closing_balance||0)-Fe;return console.log(`ðŸ“Š Availability using stored balance for ${ge}:`,{storedBalance:J.closing_balance,soldUnits:Fe,available:ds}),ds>0}}else{console.log("âš ï¸ No stored balance, checking completed batch coding tasks...");const xe=H.filter(ge=>{const ds=R.find(Ns=>Ns.$id===ge.process_id)?.process_name?.toLowerCase()==="batch coding";return ge.product_id===f&&ge.status==="completed"&&ds});return console.log(`ðŸ“Š Found ${xe.length} completed batch coding tasks for product`),xe.length>0}return!1},Pt=(f,J,xe)=>{console.log("ðŸ” Getting available batch coding units:",{productId:f,sku:J,excludeRecordId:xe});const ge=p.find(Ps=>Ps.$id===f),Fe=ge?.sku;if(!ge||!Fe)return console.log("âš ï¸ Product not found or has no SKU:",{productId:f,productSku:Fe}),0;if(Fe!==J)return console.log("âš ï¸ SKU mismatch - requested SKU does not belong to this product:",{productId:f,requestedSku:J,productSku:Fe}),0;const ds=M.find(Ps=>Ps.product_id===f);console.log("ðŸŽ¯ PostProductionStatus record found for product:",ds);let Ns=0;if(ds&&ds.closing_balance!==void 0&&ds.closing_balance!==null){const Ps=ds.closing_balance||0;console.log("âœ… Using stored closing balance:",Ps);const Ot=xe?le.filter(nt=>nt.sku===J&&nt.$id===xe).reduce((nt,ms)=>nt+(ms.units||0),0):0;Ns=Math.max(0,Ps+Ot)}else{console.log("âš ï¸ No stored closing balance found, calculating from completed tasks...");const Ps=H.filter(ms=>{const Qs=R.find(Un=>Un.$id===ms.process_id),Kt=Qs?.process_name?.toLowerCase()==="batch coding",Oa=ms.product_id===f&&ms.status==="completed"&&Kt;return ms.product_id===f&&console.log(`ðŸ” Task ${ms.task_id}:`,{processId:ms.process_id,processName:Qs?.process_name,isBatchCoding:Kt,status:ms.status,matches:Oa}),Oa});if(console.log("ðŸ“Š Completed batch coding tasks found:",Ps.length),Ps.length===0)return console.log("âš ï¸ No completed batch coding tasks found for this product"),0;const Ot=Ps.reduce((ms,Qs)=>{const Kt=Qs.completed_quantity!==void 0&&Qs.completed_quantity!==null?Number(Qs.completed_quantity):Number(Qs.units)||0;return ms+Kt},0),nt=le.filter(ms=>ms.sku===J&&ms.$id!==xe).reduce((ms,Qs)=>ms+(Qs.units||0),0);Ns=Math.max(0,Ot-nt),console.log("ðŸ“Š Calculated availability:",{totalCompletedUnits:Ot,soldUnits:nt,availableUnits:Ns})}return console.log("ðŸ“ˆ Final availability calculation:",{productId:f,sku:J,availableUnits:Ns,excludedRecordId:xe,method:ds?.closing_balance!==void 0?"stored_balance":"calculated_from_tasks"}),Ns},Mn=async f=>{if(f.preventDefault(),!await Ln()){console.error("SalesUnits: Session validation failed, aborting form submission");return}if(!j.product_id||!j.sku||!j.units||!j.dateString||j.product_id==="no-products"||j.sku==="no-skus"){a({title:"Validation Error",description:"Please fill all required fields: Product, SKU, Units, and Date.",variant:"destructive"});return}if(j.units<=0){a({title:"Validation Error",description:"Units must be greater than 0.",variant:"destructive"});return}const xe=Pt(j.product_id,j.sku,o?.$id);if(console.log("ðŸ”„ Edit Mode Validation Check:",{isEditing:!!o,editingRecordId:o?.$id,requestedUnits:j.units,availableUnits:xe,sku:j.sku,shouldTriggerValidation:j.units>xe}),j.units>xe){console.log("ðŸš¨ SALES UNITS VALIDATION TRIGGERED:",{requestedUnits:j.units,availableUnits:xe,productId:j.product_id,sku:j.sku}),console.log("ðŸ”„ Showing custom Sales Units validation dialog");const ge={isValid:!1,currentProcess:"sales_units",sourceProcess:"batch_coding",availableQuantity:xe,requiredQuantity:j.units,warningMessage:`Insufficient batch coding units. Available: ${xe} units, Requested: ${j.units} units`,suggestions:[`Reduce quantity to ${xe} units or less`,"Complete more batch coding tasks to increase availability","Check batch coding status for current availability"]};console.log("ðŸ“‹ Custom Validation Data Created:",ge),console.log("ðŸ§¹ Clearing regular validation state before showing custom dialog")}try{const ge={date:j.dateString?new Date(j.dateString).toISOString():j.date,product_id:j.product_id,sku:j.sku,units:j.units,notes:j.notes||void 0};o?ke.mutate({id:o.$id,data:ge}):ve.mutate(ge)}catch(ge){console.error("SalesUnits: Form submission error",ge),a({title:"Error",description:"Failed to submit form. Please try again.",variant:"destructive"})}};return e.jsx("div",{className:"p-4",children:e.jsxs(X,{children:[e.jsx(me,{children:e.jsxs(he,{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Sales Units"}),e.jsxs("div",{className:"flex gap-2",children:[h&&e.jsx(ys,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:A?A.exportColumns.filter(f=>f.required).map(f=>f.exportHeader):["Product","SKU"],optionalColumns:A?A.exportColumns.filter(f=>!f.required).map(f=>f.exportHeader):["Date","Units","Status","Remarks"],validationRules:S,onImportComplete:f=>{f.successfulRows>0&&(n.invalidateQueries({queryKey:["sales-units"]}),a({title:"Import Successful",description:`${f.successfulRows} sales units imported successfully.`}))}},variant:"outline"}),A&&e.jsx(js,{data:le.map(f=>{const J={};return A.exportColumns.forEach(xe=>{let ge;switch(xe.dataKey){case"date":ge=f.date;break;case"productName":ge=p.find(Fe=>Fe.$id===f.product_id)?.product||f.product_id;break;case"sku":ge=f.sku;break;case"units":ge=f.units;break;case"status":ge="Completed";break;case"remarks":ge=f.notes||"";break;default:ge=f[xe.dataKey]}J[xe.exportHeader]=xe.formatter?xe.formatter(ge):ge}),J}),headers:A.exportColumns.map(f=>f.exportHeader),filename:"sales-units",variant:"outline"}),e.jsxs(L,{onClick:()=>c(!0),children:[e.jsx(vs,{className:"mr-2 h-4 w-4"})," Add New Units"]})]})]})}),e.jsxs(ee,{children:[e.jsx(X,{className:"mb-6",children:e.jsx(ee,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(os,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(z,{placeholder:"Search units...",className:"pl-10",value:w,onChange:f=>P(f.target.value)})]}),h&&A&&e.jsx(ys,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:A.exportColumns.filter(f=>f.required).map(f=>f.exportHeader),optionalColumns:A.exportColumns.filter(f=>!f.required).map(f=>f.exportHeader),validationRules:S,onImportComplete:f=>{f.successfulRows>0&&(n.invalidateQueries({queryKey:["sales-units"]}),a({title:"Import Successful",description:`${f.successfulRows} sales units imported successfully.`}))}},variant:"outline"}),A&&e.jsx(js,{data:He.map(f=>{const J={};return A.exportColumns.forEach(xe=>{let ge;switch(xe.dataKey){case"date":ge=f.date;break;case"productName":ge=p.find(Fe=>Fe.$id===f.product_id)?.product||f.product_id;break;case"sku":ge=f.sku;break;case"units":ge=f.units;break;case"status":ge="Completed";break;case"remarks":ge=f.notes||"";break;default:ge=f[xe.dataKey]}J[xe.exportHeader]=xe.formatter?xe.formatter(ge):ge}),J}),headers:A.exportColumns.map(f=>f.exportHeader),filename:"sales-units",variant:"outline"})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs(re,{value:b,onValueChange:T,children:[e.jsx(te,{className:"w-[180px]",children:e.jsx(ne,{placeholder:"Filter by Product"})}),e.jsxs(ae,{children:[e.jsx(N,{value:"all",children:"All Products"}),$.map(f=>e.jsx(N,{value:f.id,children:f.name},f.id))]})]}),e.jsxs(re,{value:O,onValueChange:g,children:[e.jsx(te,{className:"w-[180px]",children:e.jsx(ne,{placeholder:"Filter by SKU"})}),e.jsxs(ae,{children:[e.jsx(N,{value:"all",children:"All SKUs"}),k.map(f=>e.jsx(N,{value:f,children:f},f))]})]}),e.jsx(z,{type:"date",placeholder:"From Date",className:"w-[150px]",value:D.from,onChange:f=>_(J=>({...J,from:f.target.value}))}),e.jsx(z,{type:"date",placeholder:"To Date",className:"w-[150px]",value:D.to,onChange:f=>_(J=>({...J,to:f.target.value}))})]})]})})}),e.jsx(as,{open:u,onOpenChange:f=>{if(!f&&(ve.isPending||ke.isPending)){a({title:"Please wait",description:"Form is being submitted. Please wait for completion.",variant:"destructive"});return}if(!(!f&&Re&&!(ve.isPending||ke.isPending)&&!window.confirm("You have unsaved changes. Are you sure you want to close without saving?"))&&(c(f),!f)){const J={date:new Date().toISOString(),product_id:"",sku:"",units:0,notes:""};ce(J),ue({}),d(null)}},children:e.jsxs(Ze,{className:"sm:max-w-[600px] max-w-[95vw] max-h-[90vh] overflow-y-auto",children:[e.jsxs(es,{children:[e.jsxs(ts,{className:"flex items-center gap-2",children:[o?"Edit Sales Unit":"Add New Sales Unit",Re&&e.jsx("span",{className:"text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded",children:"Unsaved changes"})]}),e.jsx(rs,{children:"Enter sales unit details below."}),p.filter(f=>In(f.$id)).length===0&&e.jsxs("div",{className:"mt-2 p-3 bg-yellow-50 border border-yellow-200 rounded text-sm text-yellow-800",children:[e.jsx("strong",{children:"âš ï¸ No products available:"})," All products either have no completed batch coding units or all units have been sold."]})]}),e.jsxs("form",{onSubmit:Mn,children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 py-4",children:[e.jsxs("div",{children:[e.jsx(q,{htmlFor:"date",children:"Date *"}),e.jsx(z,{id:"date",type:"date",value:j.dateString||"",onChange:f=>rt({dateString:f.target.value}),className:Ne.dateString?"border-red-500":""}),Ne.dateString&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:Ne.dateString})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"product",children:"Product *"}),e.jsxs(re,{value:j.product_id,onValueChange:f=>rt({product_id:f,sku:p.find(J=>J.$id===f)?.sku||j.sku}),children:[e.jsx(te,{id:"product",className:Ne.product_id?"border-red-500":"",children:e.jsx(ne,{placeholder:"Select Product"})}),e.jsxs(ae,{children:[p.filter(f=>{const J=M.find(ge=>ge.product_id===f.$id);let xe=!1;return J&&(J.closing_balance||0)>0?xe=!0:f.sku&&(xe=H.filter(ds=>ds.product_id===f.$id&&ds.status==="completed").length>0),console.log("ðŸ” Product filtering for sales:",{productId:f.$id,productName:f.product||f.product_name,sku:f.sku,postProdStatusFound:!!J,storedClosingBalance:J?.closing_balance,hasCompletedTasks:H.filter(ge=>ge.product_id===f.$id&&ge.status==="completed").length>0,finalDecision:xe}),xe}).map(f=>e.jsx(N,{value:f.$id,children:f.product||f.$id},f.$id)),p.filter(f=>{const J=M.find(ge=>ge.product_id===f.$id);return J&&(J.closing_balance||0)>0?!0:f.sku?H.filter(Fe=>Fe.product_id===f.$id&&Fe.status==="completed").length>0:!1}).length===0&&e.jsx(N,{value:"no-products",disabled:!0,children:"No products with available batch coding units"})]})]}),Ne.product_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:Ne.product_id})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"sku",children:"SKU *"}),e.jsxs(re,{value:j.sku,onValueChange:f=>rt({sku:f}),children:[e.jsx(te,{id:"sku",className:Ne.sku?"border-red-500":"",children:e.jsx(ne,{placeholder:"Select SKU"})}),e.jsxs(ae,{children:[(()=>{if(!j.product_id)return[];const f=p.find(Fe=>Fe.$id===j.product_id);if(!f||!f.sku)return[];const J=f.sku,xe=Pt(j.product_id,J,o?.$id),ge=o&&J===o.sku;return xe>0||ge?[f]:[]})().map(f=>{const J=f.sku,xe=Pt(j.product_id,J,o?.$id),ge=o&&J===o.sku;return e.jsxs(N,{value:J,children:[J,f.product?` â€” ${f.product}`:"",e.jsxs("span",{className:`text-xs ml-2 ${xe>0?"text-gray-500":"text-red-500"}`,children:["(",xe," available",ge&&xe===0?" - Current":"",")"]})]},f.$id)}),j.product_id&&(()=>{const f=p.find(Fe=>Fe.$id===j.product_id);if(!f||!f.sku)return!0;const J=f.sku,xe=Pt(j.product_id,J,o?.$id),ge=o&&J===o.sku;return xe===0&&!ge})()&&e.jsx(N,{value:"no-skus",disabled:!0,children:"No SKUs with available batch coding units for this product"})]})]}),Ne.sku&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:Ne.sku}),j.product_id&&j.sku&&e.jsxs("div",{className:"mt-2 p-2 bg-blue-50 border border-blue-200 rounded text-sm",children:[e.jsx("span",{className:"text-blue-700 font-medium",children:"Available Batch Coding Units:"}),e.jsxs("span",{className:"text-blue-800 font-bold",children:[Pt(j.product_id,j.sku,o?.$id)," units"]})]})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"units",children:"Units *"}),e.jsx(z,{id:"units",type:"number",min:"1",value:j.units,onChange:f=>rt({units:Number(f.target.value)}),className:Ne.units?"border-red-500":""}),Ne.units&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:Ne.units})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(q,{htmlFor:"notes",children:"Remarks"}),e.jsx(z,{id:"notes",type:"text",value:j.notes||"",onChange:f=>rt({notes:f.target.value})})]})]}),e.jsxs(ss,{className:"flex-col sm:flex-row gap-2 pt-4",children:[e.jsx(L,{type:"button",variant:"outline",onClick:()=>c(!1),className:"w-full sm:w-auto",children:"Cancel"}),e.jsx(L,{type:"submit",disabled:ve.isPending||ke.isPending||Object.keys(Ne).length>0,className:"w-full sm:w-auto",children:ve.isPending||ke.isPending?e.jsxs(e.Fragment,{children:[e.jsx(Oe,{className:"mr-2 h-4 w-4 animate-spin"}),"Savingâ€¦"]}):o?"Update Sales Unit":"Add Sales Unit"})]})]})]})}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{placeholder:"Search units...",value:w,onChange:f=>P(f.target.value),className:"max-w-sm"}),e.jsxs(re,{value:b,onValueChange:T,children:[e.jsx(te,{className:"w-[180px]",children:e.jsx(ne,{placeholder:"Filter by Product"})}),e.jsxs(ae,{children:[e.jsx(N,{value:"all",children:"All Products"}),p.map(f=>e.jsx(N,{value:f.$id,children:f.product||f.$id},f.$id))]})]}),e.jsx(Ct,{value:i,onChange:l})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[Pe==="offline"&&e.jsxs("div",{className:"flex items-center gap-1 text-red-600 text-sm",children:[e.jsx("div",{className:"w-2 h-2 bg-red-600 rounded-full"}),"Offline"]}),Cs>0&&e.jsxs("div",{className:"flex items-center gap-1 text-yellow-600 text-sm",children:[e.jsx(Oe,{className:"h-3 w-3 animate-spin"}),"Retrying... (",Cs,")"]})]})]}),e.jsx(X,{children:e.jsxs(ee,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",we+1," to ",Math.min(Te,pe)," of ",pe," records"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Records per page:"}),e.jsxs(re,{value:C.toString(),onValueChange:f=>B(Number(f)),children:[e.jsx(te,{className:"w-[100px]",children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(N,{value:"50",children:"50"}),e.jsx(N,{value:"100",children:"100"}),e.jsx(N,{value:"500",children:"500"})]})]})]})]}),x.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 p-3 bg-muted rounded-md",children:[e.jsxs("span",{className:"text-sm font-medium",children:[x.length," selected"]}),e.jsx(L,{variant:"destructive",size:"sm",onClick:Me,disabled:Se.isPending,children:"Delete Selected"}),e.jsx(L,{variant:"outline",size:"sm",onClick:Le,children:"Export Selected"})]}),e.jsx("div",{className:"border rounded-md",children:e.jsx("div",{className:"overflow-auto",style:{maxHeight:"600px"},children:e.jsx(tt,{data:I(_e.map(f=>((!f.date||f.date==="Invalid Date")&&console.warn("Invalid sales unit date found:",{id:f.$id,date:f.date}),{...f,productName:p.find(J=>J.$id===f.product_id)?.product||f.product_id,formattedDate:ua(f.date),status:"Completed"}))),columns:[{key:"formattedDate",label:"Date",sortable:!0,dataType:"date"},{key:"productName",label:"Product",sortable:!0,dataType:"string"},{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"units",label:"Units",sortable:!0,dataType:"number",align:"right",headerClassName:"bg-purple-50",cellClassName:"bg-purple-50 font-medium"},{key:"status",label:"Status",sortable:!0,dataType:"string",formatter:f=>e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${f==="Completed"?"bg-green-100 text-green-800":f==="In Progress"?"bg-yellow-100 text-yellow-800":f==="Pending"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:f})},{key:"notes",label:"Remarks",sortable:!0,dataType:"string"}],onSort:v,currentSort:F,loading:se,maxHeight:"none",stickyHeader:!0,bordered:!1,searchable:!1,rowKey:"$id",selectable:!0,selectedRows:x,onSelectionChange:y,actions:[{label:"Edit",onClick:Ue,variant:"default"},{label:"Delete",onClick:f=>Ae(f.$id),variant:"destructive"}],emptyMessage:"No sales units found"})})}),fe>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx(L,{variant:"outline",size:"sm",onClick:()=>Q(f=>Math.max(1,f-1)),disabled:U===1,children:"Previous"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",U," of ",fe]})}),e.jsx(L,{variant:"outline",size:"sm",onClick:()=>Q(f=>Math.min(fe,f+1)),disabled:U===fe,children:"Next"})]})]})})]})]})})}const Xa=r=>r.toISOString();function Vl(){const{user:r,loading:s}=us(),t=st(),{toast:a}=Ie(),n=ns(),[i,l]=m.useState(void 0),[u,c]=m.useState(!1),[o,d]=m.useState(null),[x,y]=m.useState([]),[b,T]=m.useState("all"),[O,g]=m.useState("all"),[w,P]=m.useState("all"),[D,_]=m.useState(""),[U,Q]=m.useState({from:"",to:""}),[C,B]=m.useState(1),[A,S]=m.useState(50),{config:h}=_s("sales-record"),{validationRules:F,canImport:v}=ks("sales-record"),{currentSort:I,handleSort:p,getSortedData:E}=Zs();if(ze.useEffect(()=>{o&&u&&(console.log("ðŸ”„ Populating form for edit:",o),ye({date:o.date,sales_channel_id:o.sales_channel_id,product_id:o.product_id,sku:o.sku,sold_units:o.sold_units,unit_price:o.unit_price,total_price:o.total_price,notes:o.notes||"",dateString:new Date(o.date).toISOString().split("T")[0]}))},[o,u]),s)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Oe,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Validating authentication..."})]})});if(!r)return console.error("SalesRecord: User not authenticated, redirecting to login"),e.jsx(kt,{to:"/login",state:{from:t},replace:!0});const{data:H=[]}=de({queryKey:["products"],queryFn:()=>Rs.getAll()}),{data:R=[]}=de({queryKey:["sales-channels"],queryFn:()=>Rt.getAll()}),M=m.useMemo(()=>{const j=[];return i?.from&&j.push(Ke.greaterThanEqual("date",Xa(i.from))),i?.to&&j.push(Ke.lessThanEqual("date",Xa(i.to))),j},[i]),{data:K=[],isLoading:Y}=de({queryKey:["sales-records",i?.from?.toISOString(),i?.to?.toISOString()],queryFn:()=>ot.getAll(M)}),G=Ee({mutationFn:async j=>{try{return await ot.create(j)}catch(ce){throw console.error("SalesRecord: Failed to create sales record",{error:ce.message,code:ce.code,type:ce.type,payload:j,userId:r?.$id}),ce.code===401?(a({title:"Authentication Error",description:"Your session has expired. Please log in again.",variant:"destructive"}),window.location.href="/login",ce):ce.code===403?(a({title:"Permission Denied",description:"You don't have permission to create sales records.",variant:"destructive"}),ce):(a({title:"Error",description:ce.message||"Failed to create sales record. Please try again.",variant:"destructive"}),ce)}},onSuccess:j=>{n.invalidateQueries({queryKey:["sales-records"]}),a({title:"Success",description:"Sales record created successfully.",duration:3e3}),c(!1),y([]),ye({date:new Date().toISOString(),sales_channel_id:"",product_id:"",sku:"",sold_units:0,unit_price:0,total_price:0,notes:""}),d(null)}}),le=Ee({mutationFn:async({id:j,data:ce})=>await ot.update(j,ce),onSuccess:j=>{n.invalidateQueries({queryKey:["sales-records"]}),a({title:"Success",description:"Sales record updated successfully.",duration:3e3}),c(!1),d(null),ye({date:new Date().toISOString(),sales_channel_id:"",product_id:"",sku:"",sold_units:0,unit_price:0,total_price:0,notes:""})},onError:j=>{console.error("Failed to update sales record:",j),a({title:"Error",description:j.message||"Failed to update sales record. Please try again.",variant:"destructive"})}}),[se,ye]=m.useState({date:new Date().toISOString(),sales_channel_id:"",product_id:"",sku:"",sold_units:0,unit_price:0,total_price:0,notes:""}),ve=Ee({mutationFn:j=>ot.delete(j),onSuccess:()=>{n.invalidateQueries({queryKey:["sales-records"]}),a({title:"Success",description:"Sales record deleted successfully."})},onError:()=>{a({title:"Error",description:"Failed to delete sales record.",variant:"destructive"})}}),ke=Ee({mutationFn:async j=>{await Promise.all(j.map(ce=>ot.delete(ce)))},onSuccess:()=>{n.invalidateQueries({queryKey:["sales-records"]}),y([]),a({title:"Success",description:"Selected records deleted successfully."})},onError:()=>{a({title:"Error",description:"Failed to delete selected records.",variant:"destructive"})}}),je=j=>{console.log("ðŸ” Editing sales record:",j),d(j),c(!0)},Se=j=>{confirm("Are you sure you want to delete this sales record?")&&ve.mutate(j)},Ue=()=>{if(x.length===0){a({title:"No Selection",description:"Please select records to delete.",variant:"destructive"});return}confirm(`Are you sure you want to delete ${x.length} selected record(s)?`)&&ke.mutate(x.map(j=>j.$id))},Ae=()=>{if(x.length===0){a({title:"No Selection",description:"Please select records to export.",variant:"destructive"});return}a({title:"Export",description:`Exporting ${x.length} selected record(s)...`})},Me=K.filter(j=>{const ce=!D||j.sku.toLowerCase().includes(D.toLowerCase())||j.notes&&j.notes.toLowerCase().includes(D.toLowerCase()),Ne=b==="all"||j.sales_channel_id===b,ue=O==="all"||j.product_id===O,Pe=w==="all"||j.sku===w,ls=new Date(j.date),Cs=(!U.from||ls>=new Date(U.from))&&(!U.to||ls<=new Date(U.to));return ce&&Ne&&ue&&Pe&&Cs}),He=ze.useMemo(()=>{const j=new Map;return K.forEach(ce=>{j.has(ce.sales_channel_id)||j.set(ce.sales_channel_id,{id:ce.sales_channel_id,name:R.find(Ne=>Ne.$id===ce.sales_channel_id)?.channel_name||ce.sales_channel_id})}),Array.from(j.values()).sort((ce,Ne)=>ce.name.localeCompare(Ne.name))},[K,R]),$=ze.useMemo(()=>{const j=new Map;return K.forEach(ce=>{j.has(ce.product_id)||j.set(ce.product_id,{id:ce.product_id,name:H.find(Ne=>Ne.$id===ce.product_id)?.product||ce.product_id})}),Array.from(j.values()).sort((ce,Ne)=>ce.name.localeCompare(Ne.name))},[K,H]),k=ze.useMemo(()=>Array.from(new Set(K.map(j=>j.sku))).sort(),[K]),pe=Me.length,fe=Math.ceil(pe/A),we=(C-1)*A,Te=we+A,_e=Me.slice(we,Te);m.useEffect(()=>{B(1)},[D,b,O,w,U,A]);const Le=j=>{if(j.preventDefault(),!se.sales_channel_id||!se.product_id||!se.sku||!se.sold_units||!se.unit_price||!se.dateString){a({title:"Validation Error",description:"Please fill all required fields: Date, Sales Channel, Product, SKU, Quantity, and Rate.",variant:"destructive"});return}if(se.sold_units<=0){a({title:"Validation Error",description:"Quantity must be greater than 0.",variant:"destructive"});return}if(se.unit_price<=0){a({title:"Validation Error",description:"Rate must be greater than 0.",variant:"destructive"});return}const ce={date:se.dateString?new Date(se.dateString).toISOString():se.date,sales_channel_id:se.sales_channel_id,product_id:se.product_id,sku:se.sku,sold_units:se.sold_units,unit_price:se.unit_price,total_price:Number((se.sold_units*se.unit_price).toFixed(2)),notes:se.notes||void 0};o?le.mutate({id:o.$id,data:ce}):G.mutate(ce)};return e.jsx("div",{className:"p-4",children:e.jsxs(X,{children:[e.jsx(me,{children:e.jsxs(he,{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Sales Records"}),e.jsxs("div",{className:"flex gap-2",children:[v&&e.jsx(ys,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:h?h.exportColumns.filter(j=>j.required).map(j=>j.exportHeader):["Sales Channel","Product","SKU"],optionalColumns:h?h.exportColumns.filter(j=>!j.required).map(j=>j.exportHeader):["Date","Qty","Rate","Total Amount","Status","Remarks"],validationRules:F,onImportComplete:j=>{j.successfulRows>0&&(n.invalidateQueries({queryKey:["sales-records"]}),a({title:"Import Successful",description:`${j.successfulRows} sales records imported successfully.`}))}},variant:"outline"}),h&&e.jsx(js,{data:K.map(j=>{const ce={};return h.exportColumns.forEach(Ne=>{let ue;switch(Ne.dataKey){case"date":ue=j.date;break;case"channelName":ue=R.find(Pe=>Pe.$id===j.sales_channel_id)?.channel_name||j.sales_channel_id;break;case"productName":ue=H.find(Pe=>Pe.$id===j.product_id)?.product||j.product_id;break;case"sku":ue=j.sku;break;case"qty":ue=j.sold_units;break;case"rate":ue=j.unit_price;break;case"totalAmount":ue=Number((j.sold_units*j.unit_price).toFixed(2));break;case"status":ue="Completed";break;case"remarks":ue=j.notes||"";break;default:ue=j[Ne.dataKey]}ce[Ne.exportHeader]=Ne.formatter?Ne.formatter(ue):ue}),ce}),headers:h.exportColumns.map(j=>j.exportHeader),filename:"sales-record",variant:"outline"}),e.jsxs(L,{onClick:()=>c(!0),children:[e.jsx(vs,{className:"mr-2 h-4 w-4"})," Add Sales Record"]})]})]})}),e.jsxs(ee,{children:[e.jsx(X,{className:"mb-6",children:e.jsx(ee,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(os,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(z,{placeholder:"Search records...",className:"pl-10",value:D,onChange:j=>_(j.target.value)})]}),v&&h&&e.jsx(ys,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:h.exportColumns.filter(j=>j.required).map(j=>j.exportHeader),optionalColumns:h.exportColumns.filter(j=>!j.required).map(j=>j.exportHeader),validationRules:F,onImportComplete:j=>{j.successfulRows>0&&(n.invalidateQueries({queryKey:["sales-records"]}),a({title:"Import Successful",description:`${j.successfulRows} sales records imported successfully.`}))}},variant:"outline"}),h&&e.jsx(js,{data:Me.map(j=>{const ce={};return h.exportColumns.forEach(Ne=>{let ue;switch(Ne.dataKey){case"date":ue=j.date;break;case"channelName":ue=R.find(Pe=>Pe.$id===j.sales_channel_id)?.channel_name||j.sales_channel_id;break;case"productName":ue=H.find(Pe=>Pe.$id===j.product_id)?.product||j.product_id;break;case"sku":ue=j.sku;break;case"qty":ue=j.sold_units;break;case"rate":ue=j.unit_price;break;case"totalAmount":ue=Number((j.sold_units*j.unit_price).toFixed(2));break;case"status":ue="Completed";break;case"remarks":ue=j.notes||"";break;default:ue=j[Ne.dataKey]}ce[Ne.exportHeader]=Ne.formatter?Ne.formatter(ue):ue}),ce}),headers:h.exportColumns.map(j=>j.exportHeader),filename:"sales-record",variant:"outline"})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs(re,{value:b,onValueChange:T,children:[e.jsx(te,{className:"w-[180px]",children:e.jsx(ne,{placeholder:"Filter by Channel"})}),e.jsxs(ae,{children:[e.jsx(N,{value:"all",children:"All Channels"}),He.map(j=>e.jsx(N,{value:j.id,children:j.name},j.id))]})]}),e.jsxs(re,{value:O,onValueChange:g,children:[e.jsx(te,{className:"w-[180px]",children:e.jsx(ne,{placeholder:"Filter by Product"})}),e.jsxs(ae,{children:[e.jsx(N,{value:"all",children:"All Products"}),$.map(j=>e.jsx(N,{value:j.id,children:j.name},j.id))]})]}),e.jsxs(re,{value:w,onValueChange:P,children:[e.jsx(te,{className:"w-[180px]",children:e.jsx(ne,{placeholder:"Filter by SKU"})}),e.jsxs(ae,{children:[e.jsx(N,{value:"all",children:"All SKUs"}),k.map(j=>e.jsx(N,{value:j,children:j},j))]})]}),e.jsx(z,{type:"date",placeholder:"From Date",className:"w-[150px]",value:U.from,onChange:j=>Q(ce=>({...ce,from:j.target.value}))}),e.jsx(z,{type:"date",placeholder:"To Date",className:"w-[150px]",value:U.to,onChange:j=>Q(ce=>({...ce,to:j.target.value}))})]})]})})}),e.jsx(as,{open:u,onOpenChange:j=>{c(j),j||(ye({date:new Date().toISOString(),sales_channel_id:"",product_id:"",sku:"",sold_units:0,unit_price:0,total_price:0,notes:""}),d(null))},children:e.jsxs(Ze,{className:"sm:max-w-[720px]",children:[e.jsxs(es,{children:[e.jsx(ts,{children:o?"Edit Sales Record":"Add New Sales Record"}),e.jsx(rs,{children:"Enter sales record details below."})]}),e.jsxs("form",{onSubmit:Le,children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 py-4",children:[e.jsxs("div",{children:[e.jsx(q,{htmlFor:"date",children:"Date *"}),e.jsx(z,{id:"date",type:"date",value:se.dateString||"",onChange:j=>ye(ce=>({...ce,dateString:j.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"channel",children:"Sales Channel *"}),e.jsxs(re,{value:se.sales_channel_id,onValueChange:j=>ye(ce=>({...ce,sales_channel_id:j})),children:[e.jsx(te,{id:"channel",children:e.jsx(ne,{placeholder:"Select Sales Channel"})}),e.jsx(ae,{children:R.map(j=>e.jsx(N,{value:j.$id,children:j.channel_name||j.$id},j.$id))})]})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"product",children:"Product *"}),e.jsxs(re,{value:se.product_id,onValueChange:j=>ye(ce=>({...ce,product_id:j,sku:H.find(Ne=>Ne.$id===j)?.sku||ce.sku})),children:[e.jsx(te,{id:"product",children:e.jsx(ne,{placeholder:"Select Product"})}),e.jsx(ae,{children:H.map(j=>e.jsx(N,{value:j.$id,children:j.product||j.$id},j.$id))})]})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"sku",children:"SKU *"}),e.jsxs(re,{value:se.sku,onValueChange:j=>ye(ce=>({...ce,sku:j})),children:[e.jsx(te,{id:"sku",children:e.jsx(ne,{placeholder:"Select SKU"})}),e.jsx(ae,{children:H.filter(j=>j.sku).map(j=>e.jsxs(N,{value:j.sku,children:[j.sku,j.product?` â€” ${j.product}`:""]},j.$id))})]})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"qty",children:"Quantity *"}),e.jsx(z,{id:"qty",type:"number",min:"1",value:se.sold_units,onChange:j=>ye(ce=>({...ce,sold_units:Number(j.target.value),total_price:Number((Number(j.target.value)*ce.unit_price).toFixed(2))})),required:!0})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"rate",children:"Rate *"}),e.jsx(z,{id:"rate",type:"number",step:"0.01",min:"0.01",value:se.unit_price,onChange:j=>ye(ce=>({...ce,unit_price:Number(j.target.value),total_price:Number((ce.sold_units*Number(j.target.value)).toFixed(2))})),required:!0})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"total",children:"Total Amount"}),e.jsx(z,{id:"total",type:"number",step:"0.01",value:Number((se.sold_units*se.unit_price).toFixed(2)),readOnly:!0,className:"bg-gray-100"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(q,{htmlFor:"notes",children:"Remarks"}),e.jsx(z,{id:"notes",type:"text",value:se.notes||"",onChange:j=>ye(ce=>({...ce,notes:j.target.value}))})]})]}),e.jsx(ss,{children:e.jsx(L,{type:"submit",disabled:G.isPending||le.isPending,children:G.isPending||le.isPending?e.jsxs(e.Fragment,{children:[e.jsx(Oe,{className:"mr-2 h-4 w-4 animate-spin"}),"Savingâ€¦"]}):o?"Update Sales Record":"Add Sales Record"})})]})]})}),e.jsx(X,{children:e.jsxs(ee,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",we+1," to ",Math.min(Te,pe)," of ",pe," records"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Records per page:"}),e.jsxs(re,{value:A.toString(),onValueChange:j=>S(Number(j)),children:[e.jsx(te,{className:"w-[100px]",children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(N,{value:"50",children:"50"}),e.jsx(N,{value:"100",children:"100"}),e.jsx(N,{value:"500",children:"500"})]})]})]})]}),x.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 p-3 bg-muted rounded-md",children:[e.jsxs("span",{className:"text-sm font-medium",children:[x.length," selected"]}),e.jsx(L,{variant:"destructive",size:"sm",onClick:Ue,disabled:ke.isPending,children:"Delete Selected"}),e.jsx(L,{variant:"outline",size:"sm",onClick:Ae,children:"Export Selected"})]}),e.jsx("div",{className:"border rounded-md",children:e.jsx("div",{className:"overflow-auto",style:{maxHeight:"600px"},children:e.jsx(tt,{data:E(_e.map(j=>((!j.date||j.date==="Invalid Date")&&console.warn("Invalid sales record date found:",{id:j.$id,date:j.date}),{...j,formattedDate:ua(j.date),channelName:R.find(ce=>ce.$id===j.sales_channel_id)?.channel_name||j.sales_channel_id,productName:H.find(ce=>ce.$id===j.product_id)?.product||j.product_id,totalAmount:Number((j.sold_units*j.unit_price).toFixed(2)),status:"Completed"}))),columns:[{key:"formattedDate",label:"Date",sortable:!0,dataType:"date"},{key:"channelName",label:"Sales Channel",sortable:!0,dataType:"string"},{key:"productName",label:"Product",sortable:!0,dataType:"string"},{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"sold_units",label:"Qty",sortable:!0,dataType:"number",align:"right",headerClassName:"bg-purple-50",cellClassName:"bg-purple-50 font-medium"},{key:"unit_price",label:"Rate",sortable:!0,dataType:"number",align:"right"},{key:"totalAmount",label:"Total Amount",sortable:!0,dataType:"number",align:"right",headerClassName:"bg-green-50",cellClassName:"bg-green-50 font-medium"},{key:"status",label:"Status",sortable:!0,dataType:"string",formatter:j=>e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${j==="Completed"?"bg-green-100 text-green-800":j==="In Progress"?"bg-yellow-100 text-yellow-800":j==="Pending"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:j})},{key:"notes",label:"Remarks",sortable:!0,dataType:"string"}],onSort:p,currentSort:I,loading:Y,maxHeight:"none",stickyHeader:!0,bordered:!1,searchable:!1,rowKey:"$id",selectable:!0,selectedRows:x,onSelectionChange:y,actions:[{label:"Edit",onClick:je,variant:"default"},{label:"Delete",onClick:j=>Se(j.$id),variant:"destructive"}],emptyMessage:"No sales records found"})})}),fe>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx(L,{variant:"outline",size:"sm",onClick:()=>B(j=>Math.max(1,j-1)),disabled:C===1,children:"Previous"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",C," of ",fe]})}),e.jsx(L,{variant:"outline",size:"sm",onClick:()=>B(j=>Math.min(fe,j+1)),disabled:C===fe,children:"Next"})]})]})})]})]})})}const Bl=()=>{const r=La(),s=[{title:"Stocks",description:"Manage inventory and stock levels",icon:St,path:"/master/stocks",color:"text-blue-600"},{title:"Vendors",description:"Manage supplier information",icon:pr,path:"/master/vendors",color:"text-green-600"},{title:"Staff",description:"Manage employee records",icon:xr,path:"/master/staff",color:"text-purple-600"},{title:"Processes",description:"Manage business processes",icon:qa,path:"/master/processes",color:"text-orange-600"},{title:"Raw Products",description:"Manage raw materials",icon:Da,path:"/master/raw-products",color:"text-red-600"},{title:"Products",description:"Manage finished products",icon:si,path:"/master/products",color:"text-indigo-600"},{title:"Sales Channels",description:"Manage sales channels",icon:ti,path:"/master/sales-channels",color:"text-teal-600"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Master Data"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your core business data and configurations"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:s.map(t=>{const a=t.icon;return e.jsxs(X,{className:"hover:shadow-lg transition-shadow cursor-pointer",children:[e.jsxs(me,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(a,{className:`h-6 w-6 ${t.color}`}),e.jsx(he,{className:"text-lg",children:t.title})]}),e.jsx(Ce,{children:t.description})]}),e.jsx(ee,{children:e.jsxs(L,{onClick:()=>r(t.path),className:"w-full",variant:"outline",children:["Manage ",t.title]})})]},t.title)})})]})},Ql=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Analytics"}),e.jsx("p",{className:"text-muted-foreground",children:"Business intelligence and performance analytics"})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(X,{children:[e.jsx(me,{children:e.jsxs(he,{className:"flex items-center gap-2",children:[e.jsx(Na,{className:"h-5 w-5 text-primary"}),"Production Analytics"]})}),e.jsx(ee,{children:e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"Production performance charts"}),e.jsx("p",{className:"text-sm",children:"Database connection required"})]})})]}),e.jsxs(X,{children:[e.jsx(me,{children:e.jsxs(he,{className:"flex items-center gap-2",children:[e.jsx(It,{className:"h-5 w-5 text-primary"}),"Sales Trends"]})}),e.jsx(ee,{children:e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"Sales performance analysis"}),e.jsx("p",{className:"text-sm",children:"Database connection required"})]})})]}),e.jsxs(X,{children:[e.jsx(me,{children:e.jsxs(he,{className:"flex items-center gap-2",children:[e.jsx(ai,{className:"h-5 w-5 text-primary"}),"Inventory Distribution"]})}),e.jsx(ee,{children:e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"Stock distribution charts"}),e.jsx("p",{className:"text-sm",children:"Database connection required"})]})})]}),e.jsxs(X,{children:[e.jsx(me,{children:e.jsxs(he,{className:"flex items-center gap-2",children:[e.jsx(ri,{className:"h-5 w-5 text-primary"}),"Efficiency Metrics"]})}),e.jsx(ee,{children:e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"Process efficiency analysis"}),e.jsx("p",{className:"text-sm",children:"Database connection required"})]})})]})]})]}),Hl=()=>{const r=st();return m.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",r.pathname)},[r.pathname]),e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-gray-100",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"mb-4 text-4xl font-bold",children:"404"}),e.jsx("p",{className:"mb-4 text-xl text-gray-600",children:"Oops! Page not found"}),e.jsx("a",{href:"/",className:"text-blue-500 underline hover:text-blue-700",children:"Return to Home"})]})})},zl=()=>{const[r,s]=m.useState(!1),[t,a]=m.useState(null),[n,i]=m.useState(""),{toast:l}=Ie(),u=ns(),{user:c}=us(),{config:o}=_s("stocks"),{validationRules:d,canImport:x}=ks("stocks"),{currentSort:y,handleSort:b,getSortedData:T}=Zs(),[O,g]=m.useState({stock_code:"",stock_name:"",category:"",uom:"",min_level:"",status:"Active"}),{data:w=[],isLoading:P,error:D}=de({queryKey:["stocks"],queryFn:async()=>await ws.getAll(),enabled:!!c}),_=Ee({mutationFn:async I=>{const{stock_code:p,stock_name:E,category:H,uom:R,min_level:M}=I,K={stock_code:p,stock_name:E,category:H,uom:R,min_level:M},Y=await ws.create(K);if(Y&&Y.$id)try{const G=new Date().toISOString().split("T")[0];await bn.create({stock_id:Y.$id,opening_balance:0,purchases:0,used_in_production:0,status_date:G})}catch(G){console.error("Error creating stock status entry:",G)}return Y},onSuccess:()=>{u.invalidateQueries({queryKey:["stocks"]}),u.invalidateQueries({queryKey:["stock_status"]}),l({title:"Success",description:"Stock created successfully"}),s(!1),a(null),S()},onError:I=>{l({title:"Error",description:"Failed to create stock",variant:"destructive"}),console.error("Error creating stock:",I)}}),U=Ee({mutationFn:async({id:I,data:p})=>{const{stock_code:E,name:H,category:R,uom:M,min_level:K}=p,Y={stock_code:E,stock_name:H,category:R,uom:M,min_level:K};return await ws.update(I,Y)},onSuccess:()=>{u.invalidateQueries({queryKey:["stocks"]}),u.invalidateQueries({queryKey:["stock_status"]}),l({title:"Success",description:"Stock updated successfully"}),s(!1),a(null),S()},onError:I=>{l({title:"Error",description:"Failed to update stock",variant:"destructive"}),console.error("Error updating stock:",I)}}),Q=Ee({mutationFn:I=>ws.delete(I),onSuccess:()=>{u.invalidateQueries({queryKey:["stocks"]}),l({title:"Success",description:"Stock deleted successfully"})},onError:I=>{l({title:"Error",description:"Failed to delete stock",variant:"destructive"}),console.error("Error deleting stock:",I)}}),C=async I=>{if(I.preventDefault(),!O.stock_code.trim()){l({title:"Error",description:"Stock Code is required",variant:"destructive"});return}if(!O.stock_name?.trim()){l({title:"Error",description:"Stock Name is required",variant:"destructive"});return}if(!O.category.trim()){l({title:"Error",description:"Category is required",variant:"destructive"});return}if(!O.uom.trim()){l({title:"Error",description:"UoM is required",variant:"destructive"});return}if(!O.min_level.trim()){l({title:"Error",description:"Min Level is required",variant:"destructive"});return}const p={...O,min_level:O.min_level?parseFloat(O.min_level):void 0};t?U.mutate({id:t.$id,data:p}):_.mutate(p)},B=I=>{a(I),g({stock_code:I.stock_code,stock_name:I.stock_name||"",category:I.category||"",uom:I.uom||"",min_level:I.min_level?.toString()||"",status:I.status}),s(!0)},A=async I=>{await requestDeletion("stock",I.$id,I.stock_name,()=>Q.mutate(I.$id))},S=()=>{g({stock_code:"",stock_name:"",category:"",uom:"",min_level:"",status:"Active"})},h=()=>{a(null),S(),s(!0)},F=w.filter(I=>I.stock_name.toLowerCase().includes(n.toLowerCase())||I.stock_code.toLowerCase().includes(n.toLowerCase())||I.category.toLowerCase().includes(n.toLowerCase())),v=T(F);return D?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("p",{className:"text-red-500",children:["Error loading stocks: ",D.message]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Stocks"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage raw materials and stock items"})]}),e.jsxs(as,{open:r,onOpenChange:s,children:[e.jsx(ht,{asChild:!0,children:e.jsxs(L,{onClick:h,className:"bg-primary hover:bg-primary/90",children:[e.jsx(vs,{className:"h-4 w-4 mr-2"}),"Add New Stock"]})}),e.jsxs(Ze,{className:"sm:max-w-[425px]",children:[e.jsxs(es,{children:[e.jsx(ts,{children:t?"Edit Stock":"Add New Stock"}),e.jsxs(rs,{children:[t?"Update stock information":"Enter stock details to add a new stock",e.jsxs("span",{className:"mt-2 text-sm text-muted-foreground",children:["Fields marked with ",e.jsx("span",{className:"text-red-500",children:"*"})," are required."]})]})]}),e.jsxs("form",{onSubmit:C,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(q,{htmlFor:"stock_code",className:"text-right",children:["Stock Code ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(z,{id:"stock_code",value:O.stock_code,onChange:I=>g({...O,stock_code:I.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(q,{htmlFor:"stock_name",className:"text-right",children:["Stock Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(z,{id:"stock_name",value:O.stock_name,onChange:I=>g({...O,stock_name:I.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(q,{htmlFor:"category",className:"text-right",children:["Category ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(z,{id:"category",value:O.category,onChange:I=>g({...O,category:I.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(q,{htmlFor:"uom",className:"text-right",children:["UoM ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(re,{value:O.uom,onValueChange:I=>g({...O,uom:I}),children:[e.jsx(te,{className:"col-span-3",children:e.jsx(ne,{placeholder:"Select unit of measure"})}),e.jsxs(ae,{children:[e.jsx(N,{value:"kg",children:"kg"}),e.jsx(N,{value:"g",children:"g"}),e.jsx(N,{value:"ltr",children:"ltr"}),e.jsx(N,{value:"ml",children:"ml"}),e.jsx(N,{value:"pcs",children:"pcs"}),e.jsx(N,{value:"bags",children:"bags"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(q,{htmlFor:"min_level",className:"text-right",children:["Min Level ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(z,{id:"min_level",type:"number",step:"0.01",value:O.min_level,onChange:I=>g({...O,min_level:I.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(q,{htmlFor:"status",className:"text-right",children:"Status"}),e.jsxs(re,{value:O.status,onValueChange:I=>g({...O,status:I}),children:[e.jsx(te,{className:"col-span-3",children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(N,{value:"Active",children:"Active"}),e.jsx(N,{value:"Inactive",children:"Inactive"})]})]})]})]}),e.jsx(ss,{children:e.jsx(L,{type:"submit",disabled:_.isPending||U.isPending,children:_.isPending||U.isPending?"Saving...":t?"Update":"Create"})})]})]})]})]}),e.jsx(X,{children:e.jsx(ee,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(os,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(z,{placeholder:"Search stocks...",className:"pl-10",value:n,onChange:I=>i(I.target.value)})]}),e.jsxs(L,{variant:"outline",children:[e.jsx(Js,{className:"h-4 w-4 mr-2"}),"Filter"]}),x&&e.jsx(ys,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:["Stock Name","SKU","Unit"],optionalColumns:["Category","Opening Balance"],validationRules:d,onImportComplete:I=>{I.successfulRows>0&&(u.invalidateQueries({queryKey:["stocks"]}),l({title:"Import Successful",description:`${I.successfulRows} stocks imported successfully.`}))}},variant:"outline"}),o&&e.jsx(js,{data:F.map(I=>({name:I.stock_name,sku:I.stock_code,category:I.category,unit:I.uom,openingBalance:I.min_level||0,createdAt:I.$createdAt})),headers:o.exportColumns.map(I=>I.exportHeader),filename:"stocks",variant:"outline"})]})})}),e.jsxs(X,{children:[e.jsx(me,{children:e.jsxs(he,{children:["Stock Items (",F.length,")"]})}),e.jsx(ee,{children:e.jsx(tt,{data:v.map(I=>({...I,stock_code:I.stock_code||"",stock_name:I.stock_name||"",category:I.category||"-",uom:I.uom||"-",min_level:I.min_level||0,status:I.status||"Active"})),columns:[{key:"stock_code",label:"Stock Code",sortable:!0,dataType:"string"},{key:"stock_name",label:"Stock Name",sortable:!0,dataType:"string"},{key:"category",label:"Category",sortable:!0,dataType:"string"},{key:"uom",label:"UoM",sortable:!0,dataType:"string"},{key:"min_level",label:"Min Level",sortable:!0,dataType:"number",align:"right"},{key:"status",label:"Status",sortable:!0,dataType:"string"}],onSort:b,currentSort:y,loading:P,emptyMessage:"No stocks found",actions:[{label:"Edit",icon:e.jsx(Xs,{className:"h-4 w-4"}),onClick:B},{label:"Delete",icon:e.jsx($s,{className:"h-4 w-4"}),onClick:I=>A(I),variant:"destructive"}]})})]})]})},et=m.forwardRef(({className:r,...s},t)=>e.jsx("textarea",{className:ie("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:t,...s}));et.displayName="Textarea";const Yl=()=>{const[r,s]=m.useState(""),[t,a]=m.useState("all"),[n,i]=m.useState(!1),[l,u]=m.useState(null),[c,o]=m.useState({vendor_name:"",contact_person:"",phone:"",email:"",address:"",gstin:"",status:"Active"}),{toast:d}=Ie(),x=ns(),{config:y}=_s("vendors"),{validationRules:b,canImport:T}=ks("vendors"),{data:O=[],isLoading:g,error:w}=de({queryKey:["vendors"],queryFn:async()=>await Dt.getAll()}),P=Ee({mutationFn:h=>{const{vendor_name:F,contact_person:v,phone:I,email:p,address:E,gstin:H}=h,R={vendor_name:F,contact_person:v||"",phone:I||"",address:E||"",gstin:H||""};return p&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(p)&&(R.email=p),Dt.create(R)},onSuccess:()=>{x.invalidateQueries({queryKey:["vendors"]}),d({title:"Success",description:"Vendor created successfully"}),i(!1),U()},onError:h=>{d({title:"Error",description:"Failed to create vendor",variant:"destructive"}),console.error("Error creating vendor:",h)}}),D=Ee({mutationFn:({id:h,data:F})=>{const{vendor_name:v,contact_person:I,phone:p,email:E,address:H,gstin:R}=F,M={vendor_name:v,contact_person:I||"",phone:p||"",address:H||"",gstin:R||""};return E&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(E)&&(M.email=E),Dt.update(h,M)},onSuccess:()=>{x.invalidateQueries({queryKey:["vendors"]}),d({title:"Success",description:"Vendor updated successfully"}),i(!1),U()},onError:h=>{d({title:"Error",description:"Failed to update vendor",variant:"destructive"}),console.error("Error updating vendor:",h)}}),_=Ee({mutationFn:h=>Dt.delete(h),onSuccess:()=>{x.invalidateQueries({queryKey:["vendors"]}),d({title:"Success",description:"Vendor deleted successfully"})},onError:h=>{d({title:"Error",description:"Failed to delete vendor",variant:"destructive"}),console.error("Error deleting vendor:",h)}}),U=()=>{o({vendor_name:"",contact_person:"",phone:"",email:"",address:"",gstin:"",status:"Active"}),u(null)},Q=h=>{if(h.preventDefault(),!c.vendor_name.trim()){d({title:"Error",description:"Vendor Name is required",variant:"destructive"});return}if(!c.contact_person.trim()){d({title:"Error",description:"Contact Person is required",variant:"destructive"});return}if(c.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(c.email)){d({title:"Error",description:"Please enter a valid email address",variant:"destructive"});return}l?D.mutate({id:l.$id,data:c}):P.mutate(c)},C=h=>{u(h),o({vendor_name:h.vendor_name,contact_person:h.contact_person||"",phone:h.phone||"",email:h.email||"",address:h.address||"",gstin:h.gstin||"",status:h.status}),i(!0)},B=h=>{confirm("Are you sure you want to delete this vendor?")&&_.mutate(h)},A=()=>{u(null),U(),i(!0)},S=O.filter(h=>{const F=h.vendor_name.toLowerCase().includes(r.toLowerCase())||h.contact_person?.toLowerCase().includes(r.toLowerCase())||h.email?.toLowerCase().includes(r.toLowerCase()),v=t==="all"||h.status===t;return F&&v});return w?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("p",{className:"text-red-500",children:["Error loading vendors: ",w.message]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Vendors"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage vendor information and relationships"})]}),e.jsxs(as,{open:n,onOpenChange:i,children:[e.jsx(ht,{asChild:!0,children:e.jsxs(L,{onClick:A,className:"bg-primary hover:bg-primary/90",children:[e.jsx(vs,{className:"h-4 w-4 mr-2"}),"Add New Vendor"]})}),e.jsxs(Ze,{className:"sm:max-w-[500px]",children:[e.jsxs(es,{children:[e.jsx(ts,{children:l?"Edit Vendor":"Add New Vendor"}),e.jsxs(rs,{children:[l?"Update vendor information":"Enter vendor details to add a new vendor",e.jsxs("p",{className:"mt-2 text-sm text-muted-foreground",children:["Fields marked with ",e.jsx("span",{className:"text-red-500",children:"*"})," are required."]})]})]}),e.jsxs("form",{onSubmit:Q,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(q,{htmlFor:"vendor_name",className:"text-right",children:["Vendor Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(z,{id:"vendor_name",value:c.vendor_name,onChange:h=>o({...c,vendor_name:h.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(q,{htmlFor:"contact_person",className:"text-right",children:["Contact Person ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(z,{id:"contact_person",value:c.contact_person,onChange:h=>o({...c,contact_person:h.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(q,{htmlFor:"phone",className:"text-right",children:"Phone"}),e.jsx(z,{id:"phone",value:c.phone,onChange:h=>o({...c,phone:h.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(q,{htmlFor:"email",className:"text-right",children:"Email"}),e.jsx(z,{id:"email",type:"email",value:c.email,onChange:h=>o({...c,email:h.target.value}),className:"col-span-3",placeholder:"Optional"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(q,{htmlFor:"address",className:"text-right",children:"Address"}),e.jsx(et,{id:"address",value:c.address,onChange:h=>o({...c,address:h.target.value}),className:"col-span-3",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(q,{htmlFor:"gstin",className:"text-right",children:"GSTIN"}),e.jsx(z,{id:"gstin",value:c.gstin,onChange:h=>o({...c,gstin:h.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(q,{htmlFor:"status",className:"text-right",children:"Status"}),e.jsxs(re,{value:c.status,onValueChange:h=>o({...c,status:h}),children:[e.jsx(te,{className:"col-span-3",children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(N,{value:"Active",children:"Active"}),e.jsx(N,{value:"Inactive",children:"Inactive"})]})]})]})]}),e.jsx(ss,{children:e.jsx(L,{type:"submit",children:l?"Update":"Create"})})]})]})]})]}),e.jsx(X,{children:e.jsx(ee,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(os,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(z,{placeholder:"Search vendors...",className:"pl-10",value:r,onChange:h=>s(h.target.value)})]}),e.jsxs(L,{variant:"outline",children:[e.jsx(Js,{className:"h-4 w-4 mr-2"}),"Filter"]}),T&&e.jsx(ys,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:["Vendor Name"],optionalColumns:["Email","Phone","Contact Person","Address"],validationRules:b,onImportComplete:h=>{h.successfulRows>0&&(x.invalidateQueries({queryKey:["vendors"]}),d({title:"Import Successful",description:`${h.successfulRows} vendors imported successfully.`}))}},variant:"outline"}),y&&e.jsx(js,{data:S.map(h=>({name:h.vendor_name,email:h.email||"",phone:h.phone||"",contactPerson:h.contact_person||"",address:h.address||"",isActive:h.status==="Active",createdAt:h.$createdAt})),headers:y.exportColumns.map(h=>h.exportHeader),filename:"vendors",variant:"outline"})]})})}),e.jsxs(X,{children:[e.jsx(me,{children:e.jsxs(he,{children:["Vendors (",S.length,")"]})}),e.jsx(ee,{children:g?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:e.jsx("span",{children:"Loading vendors..."})}):S.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("p",{className:"text-lg mb-2",children:"No vendors found"}),e.jsx("p",{className:"text-sm",children:"Add your first vendor to get started"})]}):e.jsxs(ps,{children:[e.jsx(xs,{children:e.jsxs(De,{children:[e.jsx(Z,{children:"Vendor Name"}),e.jsx(Z,{children:"Contact Person"}),e.jsx(Z,{children:"Phone"}),e.jsx(Z,{children:"Email"}),e.jsx(Z,{children:"Address"}),e.jsx(Z,{children:"GSTIN"}),e.jsx(Z,{children:"Status"}),e.jsx(Z,{children:"Actions"})]})}),e.jsx(gs,{children:S.map(h=>e.jsxs(De,{children:[e.jsx(W,{className:"font-medium",children:h.vendor_name}),e.jsx(W,{children:h.contact_person||"-"}),e.jsx(W,{children:h.phone||"-"}),e.jsx(W,{children:h.email||"-"}),e.jsx(W,{className:"max-w-xs truncate",children:h.address||"-"}),e.jsx(W,{children:h.gstin||"-"}),e.jsx(W,{children:e.jsx(Ve,{variant:h.status==="Active"?"default":"secondary",children:h.status})}),e.jsx(W,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(L,{variant:"outline",size:"sm",onClick:()=>C(h),children:e.jsx(Xs,{className:"h-4 w-4"})}),e.jsx(L,{variant:"outline",size:"sm",onClick:()=>B(h.$id),children:e.jsx($s,{className:"h-4 w-4"})})]})})]},h.$id))})]})})]})]})},Wl=()=>{const[r,s]=m.useState(""),[t,a]=m.useState("all"),[n,i]=m.useState(!1),[l,u]=m.useState(null),[c,o]=m.useState({staff_code:"",staff_name:"",role:"",department:"",email:"",phone:"",joining_date:"",status:"Active"}),{toast:d}=Ie(),x=ns(),{config:y}=_s("staff"),{validationRules:b,canImport:T}=ks("staff"),{currentSort:O,handleSort:g,getSortedData:w}=Zs(),P={async getAll(){return(await Ye.listDocuments(We,be.STAFF)).documents},async create(p){return await Ye.createDocument(We,be.STAFF,ct.unique(),p)},async update(p,E){return await Ye.updateDocument(We,be.STAFF,p,E)},async delete(p){return await Ye.deleteDocument(We,be.STAFF,p)}},{data:D=[],isLoading:_,error:U}=de({queryKey:["staff"],queryFn:async()=>await P.getAll()}),Q=Ee({mutationFn:p=>{const{staff_code:E,staff_name:H,role:R,department:M,phone:K,email:Y}=p,G={staff_code:E,staff_name:H,role:R,department:M,phone:K||"",email:Y||""};return P.create(G)},onSuccess:()=>{x.invalidateQueries({queryKey:["staff"]}),d({title:"Success",description:"Staff member created successfully"}),i(!1),A()},onError:p=>{d({title:"Error",description:"Failed to create staff member",variant:"destructive"}),console.error("Error creating staff:",p)}}),C=Ee({mutationFn:({id:p,data:E})=>{const{staff_code:H,staff_name:R,role:M,department:K,phone:Y,email:G}=E,le={staff_code:H,staff_name:R,role:M,department:K,phone:Y||"",email:G||""};return P.update(p,le)},onSuccess:()=>{x.invalidateQueries({queryKey:["staff"]}),d({title:"Success",description:"Staff member updated successfully"}),i(!1),A()},onError:p=>{d({title:"Error",description:"Failed to update staff member",variant:"destructive"}),console.error("Error updating staff:",p)}}),B=Ee({mutationFn:p=>P.delete(p),onSuccess:()=>{x.invalidateQueries({queryKey:["staff"]}),d({title:"Success",description:"Staff member deleted successfully"})},onError:p=>{d({title:"Error",description:"Failed to delete staff member",variant:"destructive"}),console.error("Error deleting staff:",p)}}),A=()=>{o({staff_code:"",staff_name:"",role:"",department:"",email:"",phone:"",joining_date:"",status:"Active"}),u(null)},S=p=>{if(p.preventDefault(),!c.staff_code.trim()){d({title:"Error",description:"Staff Code is required",variant:"destructive"});return}if(!c.staff_name.trim()){d({title:"Error",description:"Staff Name is required",variant:"destructive"});return}if(!c.role.trim()){d({title:"Error",description:"Role is required",variant:"destructive"});return}if(!c.department.trim()){d({title:"Error",description:"Department is required",variant:"destructive"});return}if(c.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(c.email)){d({title:"Error",description:"Please enter a valid email address",variant:"destructive"});return}l?C.mutate({id:l.$id,data:c}):Q.mutate(c)},h=p=>{u(p),o({staff_code:p.staff_code,staff_name:p.staff_name,role:p.role,department:p.department||"",email:p.email||"",phone:p.phone||"",joining_date:p.joining_date||"",status:p.status}),i(!0)},F=p=>{confirm("Are you sure you want to delete this staff member?")&&B.mutate(p)},v=()=>{u(null),A(),i(!0)},I=D.filter(p=>{const E=p.staff_name.toLowerCase().includes(r.toLowerCase())||p.staff_code.toLowerCase().includes(r.toLowerCase())||p.role.toLowerCase().includes(r.toLowerCase())||p.department?.toLowerCase().includes(r.toLowerCase()),H=t==="all"||p.status===t;return E&&H});return w(I),U?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("p",{className:"text-red-500",children:["Error loading staff: ",U.message]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Staff"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage employee data and roles"})]}),e.jsxs(as,{open:n,onOpenChange:i,children:[e.jsx(ht,{asChild:!0,children:e.jsxs(L,{onClick:v,className:"bg-primary hover:bg-primary/90",children:[e.jsx(vs,{className:"h-4 w-4 mr-2"}),"Add New Staff"]})}),e.jsxs(Ze,{className:"sm:max-w-[500px]",children:[e.jsxs(es,{children:[e.jsx(ts,{children:l?"Edit Staff":"Add New Staff"}),e.jsxs(rs,{children:[l?"Update staff information":"Enter staff details to add a new employee",e.jsxs("p",{className:"mt-2 text-sm text-muted-foreground",children:["Fields marked with ",e.jsx("span",{className:"text-red-500",children:"*"})," are required."]})]})]}),e.jsxs("form",{onSubmit:S,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(q,{htmlFor:"staff_code",className:"text-right",children:["Staff Code ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(z,{id:"staff_code",value:c.staff_code,onChange:p=>o({...c,staff_code:p.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(q,{htmlFor:"staff_name",className:"text-right",children:["Staff Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(z,{id:"staff_name",value:c.staff_name,onChange:p=>o({...c,staff_name:p.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(q,{htmlFor:"role",className:"text-right",children:["Role ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(re,{value:c.role,onValueChange:p=>o({...c,role:p}),children:[e.jsx(te,{className:"col-span-3",children:e.jsx(ne,{placeholder:"Select role"})}),e.jsxs(ae,{children:[e.jsx(N,{value:"Manager",children:"Manager"}),e.jsx(N,{value:"Supervisor",children:"Supervisor"}),e.jsx(N,{value:"Operator",children:"Operator"}),e.jsx(N,{value:"Quality Controller",children:"Quality Controller"}),e.jsx(N,{value:"Warehouse Staff",children:"Warehouse Staff"}),e.jsx(N,{value:"Admin",children:"Admin"}),e.jsx(N,{value:"Accountant",children:"Accountant"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(q,{htmlFor:"department",className:"text-right",children:["Department ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(re,{value:c.department,onValueChange:p=>o({...c,department:p}),children:[e.jsx(te,{className:"col-span-3",children:e.jsx(ne,{placeholder:"Select department"})}),e.jsxs(ae,{children:[e.jsx(N,{value:"Production",children:"Production"}),e.jsx(N,{value:"Quality Control",children:"Quality Control"}),e.jsx(N,{value:"Warehouse",children:"Warehouse"}),e.jsx(N,{value:"Administration",children:"Administration"}),e.jsx(N,{value:"Accounts",children:"Accounts"}),e.jsx(N,{value:"Sales",children:"Sales"}),e.jsx(N,{value:"Purchase",children:"Purchase"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(q,{htmlFor:"email",className:"text-right",children:"Email"}),e.jsx(z,{id:"email",type:"email",value:c.email,onChange:p=>o({...c,email:p.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(q,{htmlFor:"phone",className:"text-right",children:"Phone"}),e.jsx(z,{id:"phone",value:c.phone,onChange:p=>o({...c,phone:p.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(q,{htmlFor:"joining_date",className:"text-right",children:"Joining Date"}),e.jsx(z,{id:"joining_date",type:"date",value:c.joining_date,onChange:p=>o({...c,joining_date:p.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(q,{htmlFor:"status",className:"text-right",children:"Status"}),e.jsxs(re,{value:c.status,onValueChange:p=>o({...c,status:p}),children:[e.jsx(te,{className:"col-span-3",children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(N,{value:"Active",children:"Active"}),e.jsx(N,{value:"Inactive",children:"Inactive"})]})]})]})]}),e.jsx(ss,{children:e.jsx(L,{type:"submit",children:l?"Update":"Create"})})]})]})]})]}),e.jsx(X,{children:e.jsx(ee,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(os,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(z,{placeholder:"Search staff...",className:"pl-10",value:r,onChange:p=>s(p.target.value)})]}),e.jsxs(L,{variant:"outline",children:[e.jsx(Js,{className:"h-4 w-4 mr-2"}),"Filter"]}),T&&e.jsx(ys,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:["Staff Name","Email","Role"],optionalColumns:["Phone","Department"],validationRules:b,onImportComplete:p=>{p.successfulRows>0&&(x.invalidateQueries({queryKey:["staff"]}),d({title:"Import Successful",description:`${p.successfulRows} staff members imported successfully.`}))}},variant:"outline"}),y&&e.jsx(js,{data:I.map(p=>({name:p.staff_name,email:p.email||"",phone:p.phone||"",role:p.role,department:p.department||"",isActive:p.status==="Active",createdAt:p.$createdAt})),headers:y.exportColumns.map(p=>p.exportHeader),filename:"staff",variant:"outline"})]})})}),e.jsxs(X,{children:[e.jsx(me,{children:e.jsxs(he,{children:["Staff Members (",I.length,")"]})}),e.jsx(ee,{children:_?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:e.jsx("span",{children:"Loading staff..."})}):I.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("p",{className:"text-lg mb-2",children:"No staff found"}),e.jsx("p",{className:"text-sm",children:"Add your first staff member to get started"})]}):e.jsxs(ps,{children:[e.jsx(xs,{children:e.jsxs(De,{children:[e.jsx(Z,{children:"Staff Code"}),e.jsx(Z,{children:"Staff Name"}),e.jsx(Z,{children:"Role"}),e.jsx(Z,{children:"Department"}),e.jsx(Z,{children:"Email"}),e.jsx(Z,{children:"Phone"}),e.jsx(Z,{children:"Joining Date"}),e.jsx(Z,{children:"Status"}),e.jsx(Z,{children:"Actions"})]})}),e.jsx(gs,{children:I.map(p=>e.jsxs(De,{children:[e.jsx(W,{className:"font-medium",children:p.staff_code}),e.jsx(W,{children:p.staff_name}),e.jsx(W,{children:p.role}),e.jsx(W,{children:p.department||"-"}),e.jsx(W,{children:p.email||"-"}),e.jsx(W,{children:p.phone||"-"}),e.jsx(W,{children:p.joining_date?new Date(p.joining_date).toLocaleDateString("en-GB"):"-"}),e.jsx(W,{children:e.jsx(Ve,{variant:p.status==="Active"?"default":"secondary",children:p.status})}),e.jsx(W,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(L,{variant:"outline",size:"sm",onClick:()=>h(p),children:e.jsx(Xs,{className:"h-4 w-4"})}),e.jsx(L,{variant:"outline",size:"sm",onClick:()=>F(p.$id),children:e.jsx($s,{className:"h-4 w-4"})})]})})]},p.$id))})]})})]})]})},Gl=()=>{const[r,s]=m.useState(""),[t,a]=m.useState("all"),[n,i]=m.useState(!1),[l,u]=m.useState(null),[c,o]=m.useState({name:"",department:"",description:"",status:"Active"}),{toast:d}=Ie(),x=ns(),{config:y}=_s("processes"),{validationRules:b,canImport:T}=ks("processes"),O={async getAll(){return(await Ye.listDocuments(We,be.PROCESSES)).documents},async create(F){return await Ye.createDocument(We,be.PROCESSES,ct.unique(),F)},async update(F,v){return await Ye.updateDocument(We,be.PROCESSES,F,v)},async delete(F){return await Ye.deleteDocument(We,be.PROCESSES,F)}},{data:g=[],isLoading:w,error:P}=de({queryKey:["processes"],queryFn:async()=>await O.getAll()}),D=Ee({mutationFn:F=>{const{name:v,department:I}=F,p={process_name:v,department:I};return O.create(p)},onSuccess:()=>{x.invalidateQueries({queryKey:["processes"]}),d({title:"Success",description:"Process created successfully"}),i(!1),Q()},onError:F=>{d({title:"Error",description:"Failed to create process",variant:"destructive"}),console.error("Error creating process:",F)}}),_=Ee({mutationFn:({id:F,data:v})=>{const{name:I,department:p}=v,E={process_name:I,department:p};return O.update(F,E)},onSuccess:()=>{x.invalidateQueries({queryKey:["processes"]}),d({title:"Success",description:"Process updated successfully"}),i(!1),Q()},onError:F=>{d({title:"Error",description:"Failed to update process",variant:"destructive"}),console.error("Error updating process:",F)}}),U=Ee({mutationFn:F=>O.delete(F),onSuccess:()=>{x.invalidateQueries({queryKey:["processes"]}),d({title:"Success",description:"Process deleted successfully"})},onError:F=>{d({title:"Error",description:"Failed to delete process",variant:"destructive"}),console.error("Error deleting process:",F)}}),Q=()=>{o({name:"",department:"",description:"",status:"Active"}),u(null)},C=F=>{if(F.preventDefault(),!c.name?.trim()){d({title:"Error",description:"Process Name is required",variant:"destructive"});return}if(!c.department.trim()){d({title:"Error",description:"Department is required",variant:"destructive"});return}l?_.mutate({id:l.$id,data:c}):D.mutate(c)},B=F=>{u(F),o({name:F.process_name,department:F.department||"",description:F.description||"",status:F.status}),i(!0)},A=F=>{confirm("Are you sure you want to delete this process?")&&U.mutate(F)},S=()=>{u(null),Q(),i(!0)},h=g.filter(F=>(F.process_name.toLowerCase().includes(r.toLowerCase())||F.department?.toLowerCase().includes(r.toLowerCase())||F.description?.toLowerCase().includes(r.toLowerCase()))&&(t==="all"||F.status===t));return P?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("p",{className:"text-red-500",children:["Error loading processes: ",P.message]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Processes"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage manufacturing and operational processes"})]}),e.jsxs(as,{open:n,onOpenChange:i,children:[e.jsx(ht,{asChild:!0,children:e.jsxs(L,{onClick:S,className:"bg-primary hover:bg-primary/90",children:[e.jsx(vs,{className:"h-4 w-4 mr-2"}),"Add New Process"]})}),e.jsxs(Ze,{className:"sm:max-w-[500px]",children:[e.jsxs(es,{children:[e.jsx(ts,{children:l?"Edit Process":"Add New Process"}),e.jsxs(rs,{children:[l?"Update process information":"Enter process details to add a new process",e.jsxs("span",{className:"mt-2 text-sm text-muted-foreground",children:["Fields marked with ",e.jsx("span",{className:"text-red-500",children:"*"})," are required."]})]})]}),e.jsxs("form",{onSubmit:C,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(q,{htmlFor:"name",className:"text-right",children:["Process Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(z,{id:"name",value:c.name,onChange:F=>o({...c,name:F.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(q,{htmlFor:"department",className:"text-right",children:["Department ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(re,{value:c.department||"",onValueChange:F=>o({...c,department:F}),children:[e.jsx(te,{className:"col-span-3",children:e.jsx(ne,{placeholder:"Select department"})}),e.jsxs(ae,{children:[e.jsx(N,{value:"Pre-Production",children:"Pre-Production"}),e.jsx(N,{value:"Production",children:"Production"}),e.jsx(N,{value:"Post Production",children:"Post Production"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-start gap-4",children:[e.jsx(q,{htmlFor:"description",className:"text-right mt-2",children:"Description"}),e.jsx(et,{id:"description",value:c.description,onChange:F=>o({...c,description:F.target.value}),className:"col-span-3",rows:3,placeholder:"Enter process description..."})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(q,{htmlFor:"status",className:"text-right",children:"Status"}),e.jsxs(re,{value:c.status,onValueChange:F=>o({...c,status:F}),children:[e.jsx(te,{className:"col-span-3",children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(N,{value:"Active",children:"Active"}),e.jsx(N,{value:"Inactive",children:"Inactive"}),e.jsx(N,{value:"Under Review",children:"Under Review"})]})]})]})]}),e.jsx(ss,{children:e.jsx(L,{type:"submit",children:l?"Update":"Create"})})]})]})]})]}),e.jsx(X,{children:e.jsx(ee,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(os,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(z,{placeholder:"Search processes...",className:"pl-10",value:r,onChange:F=>s(F.target.value)})]}),e.jsxs(L,{variant:"outline",children:[e.jsx(Js,{className:"h-4 w-4 mr-2"}),"Filter"]}),T&&e.jsx(ys,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:["Process Name"],optionalColumns:["Description","Estimated Time (minutes)"],validationRules:b,onImportComplete:F=>{F.successfulRows>0&&(x.invalidateQueries({queryKey:["processes"]}),d({title:"Import Successful",description:`${F.successfulRows} processes imported successfully.`}))}},variant:"outline"}),y&&e.jsx(js,{data:h.map(F=>({name:F.process_name,description:F.description||"",estimatedTime:0,isActive:F.status==="Active",createdAt:F.$createdAt})),headers:y.exportColumns.map(F=>F.exportHeader),filename:"processes",variant:"outline"})]})})}),e.jsxs(X,{children:[e.jsx(me,{children:e.jsxs(he,{children:["Manufacturing Processes (",h.length,")"]})}),e.jsx(ee,{children:w?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:e.jsx("span",{children:"Loading processes..."})}):h.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("p",{className:"text-lg mb-2",children:"No processes found"}),e.jsx("p",{className:"text-sm",children:"Add your first process to get started"})]}):e.jsxs(ps,{children:[e.jsx(xs,{children:e.jsxs(De,{children:[e.jsx(Z,{children:"Process Name"}),e.jsx(Z,{children:"Department"}),e.jsx(Z,{children:"Description"}),e.jsx(Z,{children:"Status"}),e.jsx(Z,{children:"Actions"})]})}),e.jsx(gs,{children:h.map(F=>e.jsxs(De,{children:[e.jsx(W,{className:"font-medium",children:F.process_name}),e.jsx(W,{children:F.department||"-"}),e.jsx(W,{className:"max-w-xs truncate",children:F.description||"-"}),e.jsx(W,{children:e.jsx(Ve,{variant:F.status==="Active"?"default":F.status==="Under Review"?"secondary":"outline",children:F.status})}),e.jsx(W,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(L,{variant:"outline",size:"sm",onClick:()=>B(F),children:e.jsx(Xs,{className:"h-4 w-4"})}),e.jsx(L,{variant:"outline",size:"sm",onClick:()=>A(F.$id),children:e.jsx($s,{className:"h-4 w-4"})})]})})]},F.$id))})]})})]})]})},Jl=()=>{const[r,s]=m.useState(""),[t,a]=m.useState("all"),[n,i]=m.useState(!1),[l,u]=m.useState(null),[c,o]=m.useState({code:"",raw_product:"",uom:"",source:"Manufactured",status:"Active"}),{toast:d}=Ie(),x=ns(),{config:y}=_s("raw-products"),{validationRules:b,canImport:T}=ks("raw-products"),{data:O=[],isLoading:g,error:w}=de({queryKey:["rawProducts"],queryFn:async()=>await lt.getAll()}),P=Ee({mutationFn:h=>{const{code:F,raw_product:v,uom:I,source:p}=h,E={code:F,raw_product:v,uom:I,source:p};return lt.create(E)},onSuccess:()=>{x.invalidateQueries({queryKey:["rawProducts"]}),d({title:"Success",description:"Raw product created successfully"}),i(!1),U()},onError:h=>{d({title:"Error",description:"Failed to create raw product",variant:"destructive"}),console.error("Error creating raw product:",h)}}),D=Ee({mutationFn:({id:h,data:F})=>{const{code:v,raw_product:I,uom:p,source:E}=F,H={code:v,raw_product:I,uom:p,source:E};return lt.update(h,H)},onSuccess:()=>{x.invalidateQueries({queryKey:["rawProducts"]}),d({title:"Success",description:"Raw product updated successfully"}),i(!1),U()},onError:h=>{d({title:"Error",description:"Failed to update raw product",variant:"destructive"}),console.error("Error updating raw product:",h)}}),_=Ee({mutationFn:h=>lt.delete(h),onSuccess:()=>{x.invalidateQueries({queryKey:["rawProducts"]}),d({title:"Success",description:"Raw product deleted successfully"})},onError:h=>{d({title:"Error",description:"Failed to delete raw product",variant:"destructive"}),console.error("Error deleting raw product:",h)}}),U=()=>{o({code:"",raw_product:"",uom:"",source:"Manufactured",status:"Active"}),u(null)},Q=h=>{if(h.preventDefault(),!c.code.trim()){d({title:"Error",description:"Code is required",variant:"destructive"});return}if(!c.raw_product.trim()){d({title:"Error",description:"Raw Product is required",variant:"destructive"});return}if(!c.uom.trim()){d({title:"Error",description:"UoM is required",variant:"destructive"});return}if(!c.source.trim()){d({title:"Error",description:"Source is required",variant:"destructive"});return}l?D.mutate({id:l.$id,data:c}):P.mutate(c)},C=h=>{u(h),o({code:h.code,raw_product:h.raw_product,uom:h.uom||"",source:h.source||"Manufactured",status:h.status}),i(!0)},B=h=>{window.confirm("Are you sure you want to delete this raw product?")&&_.mutate(h)},A=()=>{u(null),U(),i(!0)},S=O.filter(h=>{const F=h.raw_product.toLowerCase().includes(r.toLowerCase())||h.code.toLowerCase().includes(r.toLowerCase())||h.source?.toLowerCase().includes(r.toLowerCase()),v=t==="all"||h.status===t;return F&&v});return w?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("p",{className:"text-red-500",children:["Error loading raw products: ",w.message]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Raw Products"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage raw materials and ingredients"})]}),e.jsxs(as,{open:n,onOpenChange:i,children:[e.jsx(ht,{asChild:!0,children:e.jsxs(L,{onClick:A,className:"bg-primary hover:bg-primary/90",children:[e.jsx(vs,{className:"h-4 w-4 mr-2"}),"Add New Raw Product"]})}),e.jsxs(Ze,{className:"sm:max-w-[500px]",children:[e.jsxs(es,{children:[e.jsx(ts,{children:l?"Edit Raw Product":"Add New Raw Product"}),e.jsxs(rs,{children:[l?"Update raw product information":"Enter raw product details to add a new material",e.jsxs("p",{className:"mt-2 text-sm text-muted-foreground",children:["Fields marked with ",e.jsx("span",{className:"text-red-500",children:"*"})," are required."]})]})]}),e.jsxs("form",{onSubmit:Q,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(q,{htmlFor:"code",className:"text-right",children:["Code ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(z,{id:"code",value:c.code,onChange:h=>o({...c,code:h.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(q,{htmlFor:"raw_product",className:"text-right",children:["Raw Product ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(z,{id:"raw_product",value:c.raw_product,onChange:h=>o({...c,raw_product:h.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(q,{htmlFor:"uom",className:"text-right",children:["UoM ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(re,{value:c.uom,onValueChange:h=>o({...c,uom:h}),children:[e.jsx(te,{className:"col-span-3",children:e.jsx(ne,{placeholder:"Select unit of measure"})}),e.jsxs(ae,{children:[e.jsx(N,{value:"kg",children:"Kilogram (kg)"}),e.jsx(N,{value:"g",children:"Gram (g)"}),e.jsx(N,{value:"l",children:"Liter (l)"}),e.jsx(N,{value:"ml",children:"Milliliter (ml)"}),e.jsx(N,{value:"pcs",children:"Pieces (pcs)"}),e.jsx(N,{value:"box",children:"Box"}),e.jsx(N,{value:"bag",children:"Bag"}),e.jsx(N,{value:"ton",children:"Ton"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(q,{htmlFor:"source",className:"text-right",children:["Source ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(re,{value:c.source,onValueChange:h=>o({...c,source:h}),children:[e.jsx(te,{className:"col-span-3",children:e.jsx(ne,{placeholder:"Select source type"})}),e.jsxs(ae,{children:[e.jsx(N,{value:"Manufactured",children:"Manufactured"}),e.jsx(N,{value:"Purchased",children:"Purchased"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(q,{htmlFor:"status",className:"text-right",children:"Status"}),e.jsxs(re,{value:c.status,onValueChange:h=>o({...c,status:h}),children:[e.jsx(te,{className:"col-span-3",children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(N,{value:"Active",children:"Active"}),e.jsx(N,{value:"Inactive",children:"Inactive"}),e.jsx(N,{value:"Discontinued",children:"Discontinued"})]})]})]})]}),e.jsx(ss,{children:e.jsx(L,{type:"submit",children:l?"Update":"Create"})})]})]})]})]}),e.jsx(X,{children:e.jsx(ee,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(os,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(z,{placeholder:"Search raw products...",className:"pl-10",value:r,onChange:h=>s(h.target.value)})]}),e.jsxs(L,{variant:"outline",children:[e.jsx(Js,{className:"h-4 w-4 mr-2"}),"Filter"]}),T&&e.jsx(ys,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:["Raw Product Name","SKU","Unit"],optionalColumns:["Cost Per Unit","Description"],validationRules:b,onImportComplete:h=>{h.successfulRows>0&&(x.invalidateQueries({queryKey:["rawProducts"]}),d({title:"Import Successful",description:`${h.successfulRows} raw products imported successfully.`}))}},variant:"outline"}),y&&e.jsx(js,{data:S.map(h=>({name:h.raw_product,sku:h.code,unit:h.uom||"",costPerUnit:0,description:"",createdAt:h.$createdAt})),headers:y.exportColumns.map(h=>h.exportHeader),filename:"raw-products",variant:"outline"})]})})}),e.jsxs(X,{children:[e.jsx(me,{children:e.jsxs(he,{children:["Raw Materials (",S.length,")"]})}),e.jsx(ee,{children:g?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:e.jsx("span",{children:"Loading raw products..."})}):S.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("p",{className:"text-lg mb-2",children:"No raw products found"}),e.jsx("p",{className:"text-sm",children:"Add your first raw product to get started"})]}):e.jsxs(ps,{children:[e.jsx(xs,{children:e.jsxs(De,{children:[e.jsx(Z,{children:"Code"}),e.jsx(Z,{children:"Raw Product"}),e.jsx(Z,{children:"UoM"}),e.jsx(Z,{children:"Source"}),e.jsx(Z,{children:"Status"}),e.jsx(Z,{children:"Actions"})]})}),e.jsx(gs,{children:S.map(h=>e.jsxs(De,{children:[e.jsx(W,{className:"font-medium",children:h.code}),e.jsx(W,{children:h.raw_product}),e.jsx(W,{children:h.uom||"-"}),e.jsx(W,{children:h.source&&e.jsx(Ve,{variant:h.source==="Manufactured"?"default":"secondary",children:h.source})}),e.jsx(W,{children:e.jsx(Ve,{variant:h.status==="Active"?"default":h.status==="Discontinued"?"destructive":"secondary",children:h.status})}),e.jsx(W,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(L,{variant:"outline",size:"sm",onClick:()=>C(h),children:e.jsx(Xs,{className:"h-4 w-4"})}),e.jsx(L,{variant:"outline",size:"sm",onClick:()=>B(h.$id),children:e.jsx($s,{className:"h-4 w-4"})})]})})]},h.$id))})]})})]})]})},Xl=()=>{const[r,s]=m.useState(""),[t,a]=m.useState("all"),[n,i]=m.useState(!1),[l,u]=m.useState(null),[c,o]=m.useState({sku:"",name:"",uom:"",min_level:"",status:"Active"}),{toast:d}=Ie(),x=ns(),{user:y}=us(),{config:b}=_s("products"),{validationRules:T,canImport:O}=ks("products"),{currentSort:g,handleSort:w,getSortedData:P}=Zs(),{data:D=[],isLoading:_,error:U}=de({queryKey:["products"],queryFn:async()=>await Rs.getAll(),enabled:!!y}),Q=Ee({mutationFn:E=>{const{sku:H,name:R,uom:M,min_level:K}=E,Y={sku:H,product:R,uom:M,min_level:K};return Rs.create(Y)},onSuccess:()=>{x.invalidateQueries({queryKey:["products"]}),d({title:"Success",description:"Product created successfully"}),i(!1),A()},onError:E=>{d({title:"Error",description:"Failed to create product",variant:"destructive"}),console.error("Error creating product:",E)}}),C=Ee({mutationFn:({id:E,data:H})=>{const{sku:R,name:M,uom:K,min_level:Y}=H,G={sku:R,product:M,uom:K,min_level:Y};return Rs.update(E,G)},onSuccess:()=>{x.invalidateQueries({queryKey:["products"]}),d({title:"Success",description:"Product updated successfully"}),i(!1),A()},onError:E=>{d({title:"Error",description:"Failed to update product",variant:"destructive"}),console.error("Error updating product:",E)}}),B=Ee({mutationFn:E=>Rs.delete(E),onSuccess:()=>{x.invalidateQueries({queryKey:["products"]}),d({title:"Success",description:"Product deleted successfully"})},onError:E=>{d({title:"Error",description:"Failed to delete product",variant:"destructive"}),console.error("Error deleting product:",E)}}),A=()=>{o({sku:"",name:"",uom:"",min_level:"",status:"Active"}),u(null)},S=E=>{if(E.preventDefault(),!c.sku?.trim()){d({title:"Error",description:"SKU is required",variant:"destructive"});return}if(!c.name?.trim()){d({title:"Error",description:"Product Name is required",variant:"destructive"});return}if(!c.uom?.trim()){d({title:"Error",description:"Unit of Measure is required",variant:"destructive"});return}if(!c.min_level?.trim()){d({title:"Error",description:"Minimum Level is required",variant:"destructive"});return}const H={...c,min_level:c.min_level?parseInt(c.min_level):void 0};l?C.mutate({id:l.$id,data:H}):Q.mutate(H)},h=E=>{u(E),o({sku:E.sku,name:E.product,uom:E.uom||"",min_level:E.min_level?.toString()||"",status:E.status}),i(!0)},F=E=>{confirm("Are you sure you want to delete this product?")&&B.mutate(E)},v=()=>{u(null),A(),i(!0)},I=D.filter(E=>{const H=E.product.toLowerCase().includes(r.toLowerCase())||E.sku.toLowerCase().includes(r.toLowerCase()),R=t==="all"||E.status===t;return H&&R}),p=P(I);return U?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("p",{className:"text-red-500",children:["Error loading products: ",U.message]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Products"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage finished products and inventory"})]}),e.jsxs(as,{open:n,onOpenChange:i,children:[e.jsx(ht,{asChild:!0,children:e.jsxs(L,{onClick:v,className:"bg-primary hover:bg-primary/90",children:[e.jsx(vs,{className:"h-4 w-4 mr-2"}),"Add New Product"]})}),e.jsxs(Ze,{className:"sm:max-w-[500px]",children:[e.jsxs(es,{children:[e.jsx(ts,{children:l?"Edit Product":"Add New Product"}),e.jsxs(rs,{children:[l?"Update product information":"Enter product details to add a new finished product",e.jsxs("span",{className:"mt-2 text-sm text-muted-foreground",children:["Fields marked with ",e.jsx("span",{className:"text-red-500",children:"*"})," are required."]})]})]}),e.jsxs("form",{onSubmit:S,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(q,{htmlFor:"sku",className:"text-right",children:["SKU ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(z,{id:"sku",value:c.sku,onChange:E=>o({...c,sku:E.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(q,{htmlFor:"product",className:"text-right",children:["Product ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(z,{id:"product",value:c.name,onChange:E=>o({...c,name:E.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(q,{htmlFor:"uom",className:"text-right",children:["UoM ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(re,{value:c.uom,onValueChange:E=>o({...c,uom:E}),children:[e.jsx(te,{className:"col-span-3",children:e.jsx(ne,{placeholder:"Select unit of measure"})}),e.jsxs(ae,{children:[e.jsx(N,{value:"kg",children:"Kilogram (kg)"}),e.jsx(N,{value:"g",children:"Gram (g)"}),e.jsx(N,{value:"l",children:"Liter (l)"}),e.jsx(N,{value:"ml",children:"Milliliter (ml)"}),e.jsx(N,{value:"pcs",children:"Pieces (pcs)"}),e.jsx(N,{value:"box",children:"Box"}),e.jsx(N,{value:"pack",children:"Pack"}),e.jsx(N,{value:"bottle",children:"Bottle"}),e.jsx(N,{value:"can",children:"Can"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(q,{htmlFor:"min_level",className:"text-right",children:["Min Level ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(z,{id:"min_level",type:"number",value:c.min_level,onChange:E=>o({...c,min_level:E.target.value}),className:"col-span-3",min:"0",placeholder:"Minimum stock level"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(q,{htmlFor:"status",className:"text-right",children:"Status"}),e.jsxs(re,{value:c.status,onValueChange:E=>o({...c,status:E}),children:[e.jsx(te,{className:"col-span-3",children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(N,{value:"Active",children:"Active"}),e.jsx(N,{value:"Inactive",children:"Inactive"}),e.jsx(N,{value:"Discontinued",children:"Discontinued"})]})]})]})]}),e.jsx(ss,{children:e.jsx(L,{type:"submit",children:l?"Update":"Create"})})]})]})]})]}),e.jsx(X,{children:e.jsx(ee,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(os,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(z,{placeholder:"Search products...",className:"pl-10",value:r,onChange:E=>s(E.target.value)})]}),e.jsxs(L,{variant:"outline",children:[e.jsx(Js,{className:"h-4 w-4 mr-2"}),"Filter"]}),O&&e.jsx(ys,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:["Product Name","SKU"],optionalColumns:["Category","Price","Description"],validationRules:T,onImportComplete:E=>{E.successfulRows>0&&(x.invalidateQueries({queryKey:["products"]}),d({title:"Import Successful",description:`${E.successfulRows} products imported successfully.`}))}},variant:"outline"}),b&&e.jsx(js,{data:I.map(E=>({name:E.product,sku:E.sku,category:"",price:0,description:"",isActive:E.status==="Active",createdAt:E.$createdAt})),headers:b.exportColumns.map(E=>E.exportHeader),filename:"products",variant:"outline"})]})})}),e.jsxs(X,{children:[e.jsx(me,{children:e.jsxs(he,{children:["Finished Products (",I.length,")"]})}),e.jsx(ee,{children:e.jsx(tt,{data:p.map(E=>({...E,sku:E.sku||"",product:E.product||"",uom:E.uom||"-",min_level:E.min_level||0,status:E.status||"Active"})),columns:[{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"product",label:"Product Name",sortable:!0,dataType:"string"},{key:"uom",label:"UoM",sortable:!0,dataType:"string"},{key:"min_level",label:"Min Level",sortable:!0,dataType:"number",align:"right"},{key:"status",label:"Status",sortable:!0,dataType:"string"}],onSort:w,currentSort:g,loading:_,emptyMessage:"No products found",actions:[{label:"Edit",icon:e.jsx(Xs,{className:"h-4 w-4"}),onClick:h},{label:"Delete",icon:e.jsx($s,{className:"h-4 w-4"}),onClick:E=>F(E.$id),variant:"destructive"}]})})]})]})},Zl=()=>{const[r,s]=m.useState(""),[t,a]=m.useState("all"),[n,i]=m.useState(!1),[l,u]=m.useState(null),[c,o]=m.useState({channel_name:"",description:"",type:"Online",contact_person:"",phone:"",email:"",status:"Active"}),{toast:d}=Ie(),x=ns(),{config:y}=_s("sales-channels"),{validationRules:b,canImport:T}=ks("sales-channels"),{data:O=[],isLoading:g,error:w}=de({queryKey:["salesChannels"],queryFn:async()=>await Rt.getAll()}),P=Ee({mutationFn:h=>{const{channel_name:F,type:v,email:I}=h,p={channel_name:F,type:v};return I&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(I)&&(p.email=I),Rt.create(p)},onSuccess:()=>{x.invalidateQueries({queryKey:["salesChannels"]}),d({title:"Success",description:"Sales channel created successfully"}),i(!1),U()},onError:h=>{d({title:"Error",description:"Failed to create sales channel",variant:"destructive"}),console.error("Error creating sales channel:",h)}}),D=Ee({mutationFn:({id:h,data:F})=>{const{channel_name:v,type:I,email:p}=F,E={channel_name:v,type:I};return p&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(p)&&(E.email=p),Rt.update(h,E)},onSuccess:()=>{x.invalidateQueries({queryKey:["salesChannels"]}),d({title:"Success",description:"Sales channel updated successfully"}),i(!1),U()},onError:h=>{d({title:"Error",description:"Failed to update sales channel",variant:"destructive"}),console.error("Error updating sales channel:",h)}}),_=Ee({mutationFn:h=>Rt.delete(h),onSuccess:()=>{x.invalidateQueries({queryKey:["salesChannels"]}),d({title:"Success",description:"Sales channel deleted successfully"})},onError:h=>{d({title:"Error",description:"Failed to delete sales channel",variant:"destructive"}),console.error("Error deleting sales channel:",h)}}),U=()=>{o({channel_name:"",description:"",type:"Online",contact_person:"",phone:"",email:"",status:"Active"}),u(null)},Q=h=>{if(h.preventDefault(),!c.channel_name.trim()){d({title:"Error",description:"Channel Name is required",variant:"destructive"});return}if(!c.type.trim()){d({title:"Error",description:"Type is required",variant:"destructive"});return}if(c.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(c.email)){d({title:"Error",description:"Please enter a valid email address",variant:"destructive"});return}l?D.mutate({id:l.$id,data:c}):P.mutate(c)},C=h=>{u(h),o({channel_name:h.channel_name,description:h.description||"",type:h.type||"Online",contact_person:h.contact_person||"",phone:h.phone||"",email:h.email||"",status:h.status}),i(!0)},B=h=>{confirm("Are you sure you want to delete this sales channel?")&&_.mutate(h)},A=()=>{u(null),U(),i(!0)},S=O.filter(h=>{const F=h.channel_name.toLowerCase().includes(r.toLowerCase())||h.type?.toLowerCase().includes(r.toLowerCase())||h.contact_person?.toLowerCase().includes(r.toLowerCase()),v=t==="all"||h.status===t;return F&&v});return w?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("p",{className:"text-red-500",children:["Error loading sales channels: ",w.message]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Sales Channels"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage sales distribution channels and partners"})]}),e.jsxs(as,{open:n,onOpenChange:i,children:[e.jsx(ht,{asChild:!0,children:e.jsxs(L,{onClick:A,className:"bg-primary hover:bg-primary/90",children:[e.jsx(vs,{className:"h-4 w-4 mr-2"}),"Add New Channel"]})}),e.jsxs(Ze,{className:"sm:max-w-[500px]",children:[e.jsxs(es,{children:[e.jsx(ts,{children:l?"Edit Sales Channel":"Add New Sales Channel"}),e.jsxs(rs,{children:[l?"Update sales channel information":"Enter sales channel details to add a new distribution partner",e.jsxs("p",{className:"mt-2 text-sm text-muted-foreground",children:["Fields marked with ",e.jsx("span",{className:"text-red-500",children:"*"})," are required."]})]})]}),e.jsxs("form",{onSubmit:Q,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(q,{htmlFor:"channel_name",className:"text-right",children:["Channel Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(z,{id:"channel_name",value:c.channel_name,onChange:h=>o({...c,channel_name:h.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-start gap-4",children:[e.jsx(q,{htmlFor:"description",className:"text-right mt-2",children:"Description"}),e.jsx(et,{id:"description",value:c.description,onChange:h=>o({...c,description:h.target.value}),className:"col-span-3",rows:3,placeholder:"Enter channel description..."})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(q,{htmlFor:"type",className:"text-right",children:["Type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(re,{value:c.type,onValueChange:h=>o({...c,type:h}),children:[e.jsx(te,{className:"col-span-3",children:e.jsx(ne,{placeholder:"Select channel type"})}),e.jsxs(ae,{children:[e.jsx(N,{value:"Online",children:"Online"}),e.jsx(N,{value:"Retail",children:"Retail"}),e.jsx(N,{value:"Wholesale",children:"Wholesale"}),e.jsx(N,{value:"Direct Sales",children:"Direct Sales"}),e.jsx(N,{value:"Distributor",children:"Distributor"}),e.jsx(N,{value:"E-commerce",children:"E-commerce"}),e.jsx(N,{value:"Export",children:"Export"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(q,{htmlFor:"contact_person",className:"text-right",children:"Contact Person"}),e.jsx(z,{id:"contact_person",value:c.contact_person,onChange:h=>o({...c,contact_person:h.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(q,{htmlFor:"phone",className:"text-right",children:"Phone"}),e.jsx(z,{id:"phone",value:c.phone,onChange:h=>o({...c,phone:h.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(q,{htmlFor:"email",className:"text-right",children:"Email"}),e.jsx(z,{id:"email",type:"email",value:c.email,onChange:h=>o({...c,email:h.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(q,{htmlFor:"status",className:"text-right",children:"Status"}),e.jsxs(re,{value:c.status,onValueChange:h=>o({...c,status:h}),children:[e.jsx(te,{className:"col-span-3",children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(N,{value:"Active",children:"Active"}),e.jsx(N,{value:"Inactive",children:"Inactive"}),e.jsx(N,{value:"Pending",children:"Pending"})]})]})]})]}),e.jsx(ss,{children:e.jsx(L,{type:"submit",children:l?"Update":"Create"})})]})]})]})]}),e.jsx(X,{children:e.jsx(ee,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(os,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(z,{placeholder:"Search sales channels...",className:"pl-10",value:r,onChange:h=>s(h.target.value)})]}),e.jsxs(L,{variant:"outline",children:[e.jsx(Js,{className:"h-4 w-4 mr-2"}),"Filter"]}),T&&e.jsx(ys,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:["Channel Name","Type"],optionalColumns:["Commission (%)","Description"],validationRules:b,onImportComplete:h=>{h.successfulRows>0&&(x.invalidateQueries({queryKey:["salesChannels"]}),d({title:"Import Successful",description:`${h.successfulRows} sales channels imported successfully.`}))}},variant:"outline"}),y&&e.jsx(js,{data:S.map(h=>({name:h.channel_name,type:h.type||"",commission:0,description:h.description||"",isActive:h.status==="Active",createdAt:h.$createdAt})),headers:y.exportColumns.map(h=>h.exportHeader),filename:"sales-channels",variant:"outline"})]})})}),e.jsxs(X,{children:[e.jsx(me,{children:e.jsxs(he,{children:["Distribution Channels (",S.length,")"]})}),e.jsx(ee,{children:g?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:e.jsx("span",{children:"Loading sales channels..."})}):S.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("p",{className:"text-lg mb-2",children:"No sales channels found"}),e.jsx("p",{className:"text-sm",children:"Add your first sales channel to get started"})]}):e.jsxs(ps,{children:[e.jsx(xs,{children:e.jsxs(De,{children:[e.jsx(Z,{children:"Channel Name"}),e.jsx(Z,{children:"Description"}),e.jsx(Z,{children:"Type"}),e.jsx(Z,{children:"Contact Person"}),e.jsx(Z,{children:"Phone"}),e.jsx(Z,{children:"Email"}),e.jsx(Z,{children:"Status"}),e.jsx(Z,{children:"Actions"})]})}),e.jsx(gs,{children:S.map(h=>e.jsxs(De,{children:[e.jsx(W,{className:"font-medium",children:h.channel_name}),e.jsx(W,{className:"max-w-xs truncate",children:h.description||"-"}),e.jsx(W,{children:h.type&&e.jsx(Ve,{variant:"outline",children:h.type})}),e.jsx(W,{children:h.contact_person||"-"}),e.jsx(W,{children:h.phone||"-"}),e.jsx(W,{children:h.email||"-"}),e.jsx(W,{children:e.jsx(Ve,{variant:h.status==="Active"?"default":h.status==="Pending"?"secondary":"outline",children:h.status})}),e.jsx(W,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(L,{variant:"outline",size:"sm",onClick:()=>C(h),children:e.jsx(Xs,{className:"h-4 w-4"})}),e.jsx(L,{variant:"outline",size:"sm",onClick:()=>B(h.$id),children:e.jsx($s,{className:"h-4 w-4"})})]})})]},h.$id))})]})})]})]})},ec=(r,s,t={})=>{const{category:a,searchTerm:n}=t,i=r?Gs(r,1):void 0,l=r?$e(r,"yyyy-MM-dd"):void 0,u=s?$e(s,"yyyy-MM-dd"):void 0,c=i?$e(i,"yyyy-MM-dd"):void 0,{data:o=[],isLoading:d}=de({queryKey:["stocks"],queryFn:()=>ws.getAll(),staleTime:10*60*1e3}),{data:x=[],isLoading:y}=de({queryKey:["processes"],queryFn:()=>Us.getAll(),staleTime:10*60*1e3}),{data:b=[],isLoading:T}=de({queryKey:["purchases",l,u],queryFn:()=>Ks.getByDateRange(r,s),enabled:!!r&&!!s,staleTime:5*60*1e3}),{data:O=[]}=de({queryKey:["purchasesBefore",c],queryFn:()=>Ks.getByDateRange(void 0,i),enabled:!!i,staleTime:5*60*1e3}),{data:g=[],isLoading:w}=de({queryKey:["tasks",l,u],queryFn:()=>Fs.getByDateRange(r,s),enabled:!!r&&!!s,staleTime:5*60*1e3}),{data:P=[]}=de({queryKey:["tasksBefore",c],queryFn:()=>Fs.getByDateRange(void 0,i),enabled:!!i,staleTime:5*60*1e3});return{stockStatus:m.useMemo(()=>o.length?o.filter(U=>{if(a&&a!=="all"&&(U.category||U.Category)!==a)return!1;if(n){const Q=n.toLowerCase();if(!(U.stock_name?.toLowerCase()||"").includes(Q))return!1}return!0}).map(U=>{const Q=O.filter(I=>I.stock_id===U.$id).reduce((I,p)=>I+(Number(p.quantity)||0),0),C=P.filter(I=>I.stock_id===U.$id&&I.status==="completed").reduce((I,p)=>I+(Number(p.assigned_quantity)||0),0),B=Q-C,A=b.filter(I=>I.stock_id===U.$id).reduce((I,p)=>I+(Number(p.quantity)||0),0),S=g.filter(I=>I.stock_id===U.$id&&I.status==="completed").reduce((I,p)=>I+(Number(p.assigned_quantity)||0),0),h=B+A-S,F=U.min_level||0;let v="In Stock";return h<=0?v="Out of Stock":h<F&&(v="Low Stock"),{stock_id:U.$id,stock_name:U.stock_name,category:U.category||U.Category,opening_balance:B,purchases:A,utilised:S,closing_balance:h,min_level:F,status:v}}):[],[o,b,O,g,P,a,n]),isLoading:d||y||T||w,error:null}},sc=()=>{const{data:r,isLoading:s,error:t}=de({queryKey:["stock-categories"],queryFn:()=>ws.getCategories()});return{categories:r,isLoading:s,error:t}},tc=()=>{const[r,s]=m.useState({from:Vs(new Date),to:Bs(new Date)}),[t,a]=m.useState(void 0),[n,i]=m.useState(""),{toast:l}=Ie(),u=ns(),{stockStatus:c,isLoading:o}=ec(r?.from,r?.to,{category:t,searchTerm:n}),{categories:d}=sc(),x=async()=>{try{await u.invalidateQueries({queryKey:["stocks"]}),await u.invalidateQueries({queryKey:["purchases"]}),await u.invalidateQueries({queryKey:["tasks"]}),l({title:"Stock Data Refreshed",description:"Data updated successfully"})}catch{l({title:"Refresh Failed",description:"Please try again",variant:"destructive"})}};return e.jsxs(X,{children:[e.jsxs(me,{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(he,{children:"Stock Status"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(L,{variant:"outline",onClick:x,disabled:o,children:[e.jsx(Ea,{className:`h-4 w-4 mr-1 ${o?"animate-spin":""}`}),"Refresh Data"]}),e.jsx(L,{variant:"outline",children:"Export"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-4",children:[e.jsx(Ct,{value:r,onChange:s,className:"w-[300px]"}),e.jsxs(re,{onValueChange:a,value:t,children:[e.jsx(te,{className:"w-[180px]",children:e.jsx(ne,{placeholder:"All Categories"})}),e.jsxs(ae,{children:[e.jsx(N,{value:"all",children:"All Categories"}),d?.map(y=>e.jsx(N,{value:y,children:y},y))]})]}),e.jsx(z,{placeholder:"Search...",className:"w-[200px]",value:n,onChange:y=>i(y.target.value)})]})]}),e.jsx(ee,{children:e.jsxs(ps,{children:[e.jsx(xs,{children:e.jsxs(De,{children:[e.jsx(Z,{children:"Stock Name"}),e.jsx(Z,{children:"Category"}),e.jsx(Z,{className:"text-right",children:"Opening Balance"}),e.jsx(Z,{className:"text-right bg-purple-50",children:"Purchases"}),e.jsx(Z,{className:"text-right bg-green-50",children:"Utilised"}),e.jsx(Z,{className:"text-right",children:"Closing Balance"}),e.jsx(Z,{className:"text-right",children:"Min Level"}),e.jsx(Z,{children:"Status"})]})}),e.jsx(gs,{children:o?e.jsx(De,{children:e.jsxs(W,{colSpan:8,className:"text-center py-12",children:[e.jsx(Oe,{className:"h-8 w-8 animate-spin mx-auto mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading stock status..."})]})}):c.length===0?e.jsx(De,{children:e.jsx(W,{colSpan:8,className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"No stock data found for the selected criteria"})})}):c.map((y,b)=>e.jsxs(De,{children:[e.jsx(W,{children:y.stock_name}),e.jsx(W,{children:y.category||"N/A"}),e.jsx(W,{className:"text-right",children:(y.opening_balance||0).toLocaleString()}),e.jsx(W,{className:"text-right bg-purple-50 font-medium",children:(y.purchases||0).toLocaleString()}),e.jsx(W,{className:"text-right bg-green-50 font-medium",children:(y.utilised||0).toLocaleString()}),e.jsx(W,{className:"text-right font-semibold",children:e.jsx("span",{className:(y.closing_balance||0)<0?"text-red-600":"text-green-600",children:(y.closing_balance||0).toLocaleString()})}),e.jsx(W,{className:"text-right text-muted-foreground",children:(y.min_level||0).toLocaleString()}),e.jsx(W,{children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${y.status==="Out of Stock"?"bg-red-100 text-red-800":y.status==="Low Stock"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:y.status||"In Stock"})})]},y.stock_id||`stock-${b}`))})]})})]})},ac=(r,s,t={})=>{const{processId:a}=t,n=r?Ge(r):void 0,i=s?Ge(s):void 0,l=n?Gs(n,1):void 0,u=n?$e(n,"yyyy-MM-dd"):void 0,c=i?$e(i,"yyyy-MM-dd"):void 0,o=l?$e(l,"yyyy-MM-dd"):void 0,{data:d=[],isLoading:x}=de({queryKey:["stocks"],queryFn:()=>ws.getAll(),staleTime:10*60*1e3}),{data:y=[],isLoading:b}=de({queryKey:["processes"],queryFn:()=>Us.getAll(),staleTime:10*60*1e3}),{data:T=[],isLoading:O}=de({queryKey:["preProductionTasks",u,c],queryFn:()=>Fs.getByDateRange(n,i),enabled:!!n&&!!i,staleTime:5*60*1e3}),{data:g=[]}=de({queryKey:["preProductionTasksBefore",o],queryFn:()=>Fs.getByDateRange(void 0,l),enabled:!!l,staleTime:5*60*1e3}),{data:w=[]}=de({queryKey:["productionTasksForPreStatus",u,c],queryFn:()=>qs.getProductionTasksWithRelations(u,c),enabled:!!n&&!!i,staleTime:5*60*1e3}),{data:P=[]}=de({queryKey:["productionTasksBeforeForPreStatus",o],queryFn:()=>qs.getProductionTasksWithRelations(void 0,o),enabled:!!l,staleTime:5*60*1e3});return{statusRecords:m.useMemo(()=>{if(!d.length||!y.length)return[];new Map(y.map(A=>[A.$id,A.process_name]));const U=a?y.filter(A=>A.$id===a):y.filter(A=>{const S=A.category||A.process_category;if(S&&S.toLowerCase()==="pre-production")return!0;const h=A.department?.toLowerCase();return h&&(h.includes("pre")||h.includes("preparation")),!0}),Q=A=>{if(!A)return!n&&!i;if(!n&&!i)return!0;const S=Ge(A),h=n?S>=n:!0,F=i?S<=i:!0;return h&&F},C=A=>!A||!l?!1:Ge(A)<=l;return d.flatMap(A=>U.map(S=>{const h=A.stock_name,F=S.process_name;if(!h||!F)return null;const I=g.filter(je=>je.stock_id===A.$id&&je.process_id===S.$id&&je.status==="completed"&&C(je.date_completed||je.date_assigned)).reduce((je,Se)=>{const Ue=Se.completed_quantity!==void 0&&Se.completed_quantity!==null?Number(Se.completed_quantity):Number(Se.assigned_quantity)||0,Ae=Number(Se.wastage_quantity)||0;return je+(Ue-Ae)},0),p=g.filter(je=>je.stock_id===A.$id&&je.stock_source===F&&C(je.date_assigned)).reduce((je,Se)=>je+(Number(Se.assigned_quantity)||0),0),E=P.filter(je=>je.source_process_id===S.$id).reduce((je,Se)=>{const Ae=(Se.stock_items||[]).filter(Me=>Me.stock_id===A.$id).reduce((Me,He)=>Me+(Number(He.quantity)||0),0);return je+Ae},0),H=p+E,R=I-H,M=T.filter(je=>je.stock_id===A.$id&&je.process_id===S.$id&&Q(je.date_assigned)),K=M.filter(je=>je.status==="completed").reduce((je,Se)=>{const Ue=Se.completed_quantity!==void 0&&Se.completed_quantity!==null?Number(Se.completed_quantity):Number(Se.assigned_quantity)||0,Ae=Number(Se.wastage_quantity)||0;return je+(Ue-Ae)},0),Y=M.reduce((je,Se)=>je+(Number(Se.wastage_quantity)||0),0),G=T.filter(je=>je.stock_id===A.$id&&je.stock_source===F&&Q(je.date_assigned)).reduce((je,Se)=>je+(Number(Se.assigned_quantity)||0),0),le=w.filter(je=>je.source_process_id===S.$id).reduce((je,Se)=>{const Ae=(Se.stock_items||[]).filter(Me=>Me.stock_id===A.$id).reduce((Me,He)=>Me+(Number(He.quantity)||0),0);return je+Ae},0),se=G+le,ye=R+K-se,ve=A.min_level||0;let ke="In Stock";return ye<=0?ke="Out of Stock":ye<ve&&(ke="Low Stock"),{stock_name:h,process:F,opening_balance:R,effective_completed:K,wastage_qty:Y,utilised:se,closing_balance:ye,min_level:ve,status:ke}}).filter(S=>S!==null)).filter(Boolean)},[d,y,T,g,w,P,a,n,i,l]),isLoading:x||b||O,error:null}},Rn=()=>{const{data:r=[],isLoading:s,error:t}=de({queryKey:["stocks"],queryFn:async()=>await ws.getAll()});return{data:r,isLoading:s,error:t}},Ma=()=>{const{data:r=[],isLoading:s,error:t}=de({queryKey:["staff"],queryFn:async()=>await kl.getAll(),staleTime:3e5,gcTime:9e5,refetchOnWindowFocus:!1});return{data:r,isLoading:s,error:t}},at=()=>{const{data:r=[],isLoading:s,error:t}=de({queryKey:["processes"],queryFn:async()=>await Us.getAll(),staleTime:3e5,gcTime:9e5,refetchOnWindowFocus:!1});return{data:r,isLoading:s,error:t}},rc=()=>{const{data:r=[],isLoading:s,error:t}=de({queryKey:["products"],queryFn:async()=>await Rs.getAll(),staleTime:3e5,gcTime:9e5,refetchOnWindowFocus:!1});return{data:r,isLoading:s,error:t}},qn=()=>{const{data:r=[],isLoading:s,error:t}=de({queryKey:["rawProducts"],queryFn:async()=>await lt.getAll(),staleTime:3e5,gcTime:9e5,refetchOnWindowFocus:!1});return{data:r,isLoading:s,error:t}},nc=()=>{const r=ns(),[s,t]=m.useState(""),[a,n]=m.useState({from:Vs(new Date),to:Bs(new Date)}),[i,l]=m.useState(""),{data:u,isLoading:c}=at(),o=a.from?$e(a.from,"yyyy-MM-dd"):void 0,d=a.to?$e(a.to,"yyyy-MM-dd"):void 0,{toast:x}=Ie(),{statusRecords:y,isLoading:b}=ac(o,d,{processId:i||void 0}),T=m.useMemo(()=>y?y.filter(w=>(w.stock_name||"").toLowerCase().includes(s.toLowerCase())||(w.process||"").toLowerCase().includes(s.toLowerCase())):[],[y,s]),O=async()=>{try{await r.invalidateQueries({queryKey:["stocks"]}),await r.invalidateQueries({queryKey:["processes"]}),await r.invalidateQueries({queryKey:["preProductionTasks"]}),await r.invalidateQueries({queryKey:["productionTasksForPreStatus"]}),x({title:"Pre-Production Data Refreshed",description:"Data updated successfully"})}catch{x({title:"Refresh Failed",description:"Please try again",variant:"destructive"})}},g=()=>{const P=[["Stock Name","Process","Opening Balance","Effective Completed","Wastage Qty","Utilised","Closing Balance","Min Level","Status"].join(","),...T.map(C=>[`"${C.stock_name}"`,`"${C.process}"`,C.opening_balance.toFixed(2),C.effective_completed.toFixed(2),C.wastage_qty.toFixed(2),C.utilised.toFixed(2),C.closing_balance.toFixed(2),(C.min_level||0).toFixed(2),`"${C.status||"In Stock"}"`].join(","))].join(`
`),D=new Blob([P],{type:"text/csv;charset=utf-8;"}),_=URL.createObjectURL(D),U=document.createElement("a");U.setAttribute("href",_);const Q=o&&d?`_${o}_to_${d}`:"";U.setAttribute("download",`pre-production-status${Q}_${new Date().toISOString().split("T")[0]}.csv`),U.style.visibility="hidden",document.body.appendChild(U),U.click(),document.body.removeChild(U)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Pre-Production Status"}),e.jsx("p",{className:"text-muted-foreground",children:"Track material flow through pre-production stages"})]}),e.jsx(X,{children:e.jsx(ee,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("div",{className:"relative w-full md:w-auto",children:[e.jsx(os,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(z,{placeholder:"Search stock or process...",className:"w-full pl-8 md:w-[200px] lg:w-[300px]",value:s,onChange:w=>t(w.target.value)})]}),e.jsx(Ct,{value:a,onChange:w=>{w?.from&&w?.to&&n({from:w.from,to:w.to})}}),e.jsxs(re,{value:i,onValueChange:l,children:[e.jsx(te,{className:"w-[180px]",children:e.jsx(ne,{placeholder:"Select Process"})}),e.jsx(ae,{children:u?.filter(w=>{const P=w.process_name?.toLowerCase();return["cleaning","c & d","roasting","rfp"].includes(P)}).map(w=>e.jsx(N,{value:w.$id,children:w.process_name},w.$id))})]}),e.jsx(L,{onClick:O,variant:"outline",size:"icon",disabled:b,children:e.jsx(Fa,{className:`h-4 w-4 ${b?"animate-spin":""}`})}),e.jsx(L,{onClick:g,variant:"outline",size:"icon",disabled:!T||T.length===0,children:e.jsx(dt,{className:"h-4 w-4"})})]})})}),b?e.jsx(X,{children:e.jsxs(ee,{className:"py-12 text-center",children:[e.jsx(Oe,{className:"h-8 w-8 animate-spin mx-auto mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading pre-production status..."})]})}):e.jsxs(X,{children:[e.jsx(me,{children:e.jsx(he,{children:"Status Details"})}),e.jsx(ee,{children:e.jsxs(ps,{children:[e.jsx(xs,{children:e.jsxs(De,{children:[e.jsx(Z,{children:"Stock Name"}),e.jsx(Z,{children:"Process"}),e.jsx(Z,{className:"text-right",children:"Opening Balance"}),e.jsx(Z,{className:"text-right bg-purple-50",children:"Effective Completed"}),e.jsx(Z,{className:"text-right",children:"Wastage Qty"}),e.jsx(Z,{className:"text-right bg-green-50",children:"Utilised"}),e.jsx(Z,{className:"text-right",children:"Closing Balance"}),e.jsx(Z,{className:"text-right",children:"Min Level"}),e.jsx(Z,{children:"Status"})]})}),e.jsx(gs,{children:T&&T.length>0?T.map((w,P)=>e.jsxs(De,{children:[e.jsx(W,{children:w.stock_name}),e.jsx(W,{children:w.process}),e.jsx(W,{className:"text-right",children:w.opening_balance.toFixed(2)}),e.jsx(W,{className:"text-right bg-purple-50 font-medium",children:w.effective_completed.toFixed(2)}),e.jsx(W,{className:"text-right",children:w.wastage_qty.toFixed(2)}),e.jsx(W,{className:"text-right bg-green-50 font-medium",children:w.utilised.toFixed(2)}),e.jsx(W,{className:"text-right font-semibold",children:e.jsx("span",{className:w.closing_balance<0?"text-red-600":"text-green-600",children:w.closing_balance.toFixed(2)})}),e.jsx(W,{className:"text-right text-muted-foreground",children:(w.min_level||0).toFixed(2)}),e.jsx(W,{children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${w.status==="Out of Stock"?"bg-red-100 text-red-800":w.status==="Low Stock"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:w.status||"In Stock"})})]},`${w.stock_name}-${w.process}-${P}`)):e.jsx(De,{children:e.jsx(W,{colSpan:9,className:"text-center",children:"No pre-production status found for the selected criteria."})})})]})})]})]})},ic=(r,s,t={})=>{const{processId:a}=t,n=r?Ge(r):void 0,i=s?Ge(s):void 0,l=n?Gs(n,1):void 0,u=n?$e(n,"yyyy-MM-dd"):void 0,c=i?$e(i,"yyyy-MM-dd"):void 0,o=l?$e(l,"yyyy-MM-dd"):void 0,{data:d=[],isLoading:x}=de({queryKey:["stocks"],queryFn:()=>ws.getAll(),staleTime:10*60*1e3}),{data:y=[],isLoading:b}=de({queryKey:["processes"],queryFn:()=>Us.getAll(),staleTime:10*60*1e3}),{data:T=[],isLoading:O}=de({queryKey:["rawProducts"],queryFn:()=>lt.getAll(),staleTime:10*60*1e3}),{data:g=[],isLoading:w}=de({queryKey:["products"],queryFn:()=>Rs.getAll(),staleTime:10*60*1e3}),{data:P=[],isLoading:D}=de({queryKey:["productionTasks",u,c,a],queryFn:()=>qs.getProductionTasksWithRelations(u,c,a),enabled:!!n&&!!i,staleTime:5*60*1e3}),{data:_=[]}=de({queryKey:["productionTasksBefore",o,a],queryFn:()=>qs.getProductionTasksWithRelations(void 0,o,a),enabled:!!l,staleTime:5*60*1e3}),{data:U=[]}=de({queryKey:["postProductionTasks",u,c],queryFn:()=>Ws.getPostProductionTasksWithRelations(),enabled:!!n&&!!i,staleTime:5*60*1e3});return{statusRecords:m.useMemo(()=>{if(!y.length||!T.length||!g.length)return[];const B=a?y.filter(p=>p.$id===a):y.filter(p=>{const E=p.process_name?.toLowerCase();return E==="grinding"||E==="blending"}),A=new Map(B.map(p=>[p.$id,p.process_name])),S=new Map(T.map(p=>[p.$id,p])),h=p=>{const E=g.find(M=>M.$id===p);if(!E)return null;const H=E.product||E.product_name||E.Product_Name||E.name;if(!H)return null;let R=T.find(M=>M.raw_product?.toLowerCase()===H.toLowerCase());return R||(R=T.find(M=>{const K=M.raw_product?.toLowerCase()||"",Y=H.toLowerCase();return K.includes(Y)||Y.includes(K)})),R},F=new Map,v=p=>{if(!p)return!n&&!i;if(!n&&!i)return!0;const E=Ge(p),H=n?E>=n:!0,R=i?E<=i:!0;return H&&R},I=new Set(B.map(p=>p.$id));return _.filter(p=>I.has(p.process_id)).forEach(p=>{const E=`${p.raw_product_id}-${p.process_id}`,H=Array.isArray(p.stock_items)?p.stock_items.reduce((Y,G)=>Y+(Number(G.quantity)||0),0):0,R=p.assigned_quantity!==void 0&&p.assigned_quantity!==null?Number(p.assigned_quantity):H,M=Number(p.wastage_quantity)||0,K=R-M;F.has(E)?F.get(E).opening_balance+=K:F.set(E,{stock_name:p.raw_product_name||"Unknown",process:A.get(p.process_id)||"Unknown",opening_balance:K,assigned:0,effective_completed:0,wastage_qty:0,utilised:0,closing_balance:0})}),P.filter(p=>I.has(p.process_id)).forEach(p=>{const E=`${p.raw_product_id}-${p.process_id}`,H=Array.isArray(p.stock_items)?p.stock_items.reduce((Y,G)=>Y+(Number(G.quantity)||0),0):0,R=p.assigned_quantity!==void 0&&p.assigned_quantity!==null?Number(p.assigned_quantity):H,M=Number(p.wastage_quantity)||0,K=R-M;if(F.has(E)){const Y=F.get(E);Y.assigned+=R,Y.wastage_qty+=M,Y.effective_completed+=K}else F.set(E,{stock_name:p.raw_product_name||"Unknown",process:A.get(p.process_id)||"Unknown",opening_balance:0,assigned:R,wastage_qty:M,effective_completed:K,utilised:0,closing_balance:0})}),F.forEach((p,E)=>{const[H,R]=E.split("-");S.get(H);const M=(U||[]).filter(K=>{const Y=K.source_process_id===R,G=h(K.product_id),le=G&&G.$id===H,se=v(K.date_assigned)||v(K.date_completed);return Y&&le&&se}).reduce((K,Y)=>{const G=Number(Y.source_quantity)||0;return K+G},0);p.utilised=M}),F.forEach(p=>{p.closing_balance=p.opening_balance+p.effective_completed-p.utilised,p.closing_balance<=0?p.status="Out of Stock":p.closing_balance<0?p.status="Low Stock":p.status="In Stock"}),Array.from(F.values())},[d,y,P,_,U,T,g,n,i,l,a]),isLoading:x||b||O||w||D,error:null}},oc=()=>{const{user:r,loading:s}=us(),t=st(),{toast:a}=Ie(),n=ns(),[i,l]=m.useState(""),[u,c]=m.useState({from:Vs(new Date),to:Bs(new Date)}),[o,d]=m.useState(""),{data:x,isLoading:y}=at(),b=u.from?$e(u.from,"yyyy-MM-dd"):void 0,T=u.to?$e(u.to,"yyyy-MM-dd"):void 0,{statusRecords:O,isLoading:g}=ic(b,T,{processId:o||void 0}),w=m.useMemo(()=>O?O.filter(U=>(U.stock_name||"").toLowerCase().includes(i.toLowerCase())||(U.process||"").toLowerCase().includes(i.toLowerCase())):[],[O,i]),P=async()=>{try{await n.invalidateQueries({queryKey:["stocks"]}),await n.invalidateQueries({queryKey:["processes"]}),await n.invalidateQueries({queryKey:["productionTasks"]}),await n.invalidateQueries({queryKey:["postProductionTasks"]}),await n.invalidateQueries({queryKey:["rawProducts"]}),await n.invalidateQueries({queryKey:["products"]}),a({title:"Production Data Refreshed",description:"Data updated successfully"})}catch{a({title:"Refresh Failed",description:"Please try again",variant:"destructive"})}},D=()=>{const Q=[["Raw Product","Process","Opening Balance","Assigned","Effective Completed","Wastage Qty","Utilised","Closing Bal","Min Level","Status"].join(","),...w.map(h=>[`"${h.stock_name}"`,`"${h.process}"`,h.opening_balance.toFixed(2),h.assigned.toFixed(2),h.effective_completed.toFixed(2),h.wastage_qty.toFixed(2),h.utilised.toFixed(2),h.closing_balance.toFixed(2),(h.min_level||0).toFixed(2),`"${h.status||"In Stock"}"`].join(","))].join(`
`),C=new Blob([Q],{type:"text/csv;charset=utf-8;"}),B=URL.createObjectURL(C),A=document.createElement("a");A.setAttribute("href",B);const S=b&&T?`_${b}_to_${T}`:"";A.setAttribute("download",`production-status${S}_${new Date().toISOString().split("T")[0]}.csv`),A.style.visibility="hidden",document.body.appendChild(A),A.click(),document.body.removeChild(A)},_=g||y;return s?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Oe,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading..."})]})}):r?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Production Status"}),e.jsx("p",{className:"text-muted-foreground",children:"Track material flow through production stages"})]}),e.jsx(X,{children:e.jsx(ee,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("div",{className:"relative w-full md:w-auto",children:[e.jsx(os,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(z,{placeholder:"Search stock or process...",className:"w-full pl-8 md:w-[200px] lg:w-[300px]",value:i,onChange:U=>l(U.target.value)})]}),e.jsx(Ct,{value:u,onChange:U=>{U?.from&&U?.to&&c(U)}}),e.jsxs(re,{value:o,onValueChange:d,children:[e.jsx(te,{className:"w-[180px]",children:e.jsx(ne,{placeholder:"All Processes"})}),e.jsx(ae,{children:x?.filter(U=>{const Q=U.process_name?.toLowerCase();return Q==="grinding"||Q==="blending"}).map(U=>e.jsx(N,{value:U.$id,children:U.process_name},U.$id))})]}),e.jsx(L,{onClick:P,variant:"outline",size:"icon",disabled:_,children:e.jsx(Fa,{className:`h-4 w-4 ${_?"animate-spin":""}`})}),e.jsx(L,{onClick:D,variant:"outline",size:"icon",disabled:!w||w.length===0,children:e.jsx(dt,{className:"h-4 w-4"})})]})})}),_?e.jsx(X,{children:e.jsxs(ee,{className:"py-12 text-center",children:[e.jsx(Oe,{className:"h-8 w-8 animate-spin mx-auto mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading production status..."})]})}):e.jsxs(X,{children:[e.jsxs(me,{className:"flex flex-row items-center justify-between",children:[e.jsxs(he,{children:["Production Status Records (",w.length,")"]}),e.jsx("div",{className:"flex items-center gap-2"})]}),e.jsx(ee,{children:e.jsxs(ps,{children:[e.jsx(xs,{children:e.jsxs(De,{children:[e.jsx(Z,{children:"Raw Product"}),e.jsx(Z,{children:"Process"}),e.jsx(Z,{className:"text-right",children:"Opening Balance"}),e.jsx(Z,{className:"text-right",children:"Assigned"}),e.jsx(Z,{className:"text-right bg-purple-50",children:"Effective Completed"}),e.jsx(Z,{className:"text-right",children:"Wastage Qty"}),e.jsx(Z,{className:"text-right bg-green-50",children:"Utilised"}),e.jsx(Z,{className:"text-right",children:"Closing Bal"}),e.jsx(Z,{className:"text-right",children:"Min Level"}),e.jsx(Z,{children:"Status"})]})}),e.jsx(gs,{children:w&&w.length>0?w.map((U,Q)=>e.jsxs(De,{children:[e.jsx(W,{children:U.stock_name}),e.jsx(W,{children:U.process}),e.jsx(W,{className:"text-right",children:U.opening_balance.toFixed(2)}),e.jsx(W,{className:"text-right",children:U.assigned.toFixed(2)}),e.jsx(W,{className:"text-right bg-purple-50 font-medium",children:U.effective_completed.toFixed(2)}),e.jsx(W,{className:"text-right",children:U.wastage_qty.toFixed(2)}),e.jsx(W,{className:"text-right bg-green-50 font-medium",children:U.utilised.toFixed(2)}),e.jsx(W,{className:"text-right font-semibold",children:e.jsx("span",{className:U.closing_balance<0?"text-red-600":"text-green-600",children:U.closing_balance.toFixed(2)})}),e.jsx(W,{className:"text-right text-muted-foreground",children:(U.min_level||0).toFixed(2)}),e.jsx(W,{children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${U.status==="Out of Stock"?"bg-red-100 text-red-800":U.status==="Low Stock"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:U.status||"In Stock"})})]},`${U.stock_name}-${U.process}-${Q}`)):e.jsx(De,{children:e.jsx(W,{colSpan:10,className:"text-center",children:"No production status found for the selected criteria."})})})]})})]})]}):e.jsx(kt,{to:"/login",state:{from:t},replace:!0})},lc=(r,s)=>r.filter(t=>{const a=t.$id;return a&&a.trim()!==""}),Bt={ALL:"all",NONE:"none",EMPTY:"empty",DEFAULT:"default"},cc=(r,s,t={})=>{const{processId:a}=t,n=r?Ge(r):void 0,i=s?Ge(s):void 0;n&&Gs(n,1);const l=n?$e(n,"yyyy-MM-dd"):void 0,u=i?$e(i,"yyyy-MM-dd"):void 0,{data:c=[],isLoading:o}=de({queryKey:["products"],queryFn:()=>Rs.getAll(),staleTime:10*60*1e3}),{data:d=[],isLoading:x}=de({queryKey:["processes"],queryFn:()=>Us.getAll(),staleTime:10*60*1e3}),{data:y=[],isLoading:b}=de({queryKey:["postProductionTasks",l,u],queryFn:()=>Ws.getPostProductionTasksWithRelations(),enabled:!!n&&!!i,staleTime:5*60*1e3}),{data:T=[]}=de({queryKey:["salesUnits"],queryFn:()=>zs.getAll(),staleTime:1*60*1e3});return{statusRecords:m.useMemo(()=>{if(!c.length||!d.length)return[];const w=n?Gs(n,1):void 0,P=a?d.filter(Q=>Q.$id===a):d.filter(Q=>{const C=Q.process_name?.toLowerCase();return C==="packing"||C==="batch coding"}),D=Q=>{if(!Q)return!n&&!i;if(!n&&!i)return!0;const C=Ge(Q),B=n?C>=n:!0,A=i?C<=i:!0;return B&&A},_=Q=>!Q||!w?!1:Ge(Q)<=w,U=[];return c.forEach(Q=>{P.forEach(C=>{const B=Q.sku||Q.SKU||"",A=Q.product||"",S=C.process_name,h=Q.min_level||Q.minLevel||0;if(!B||!A||!S)return;const v=y.filter(Y=>Y.product_id===Q.$id&&Y.process_id===C.$id&&Y.status==="completed"&&_(Y.date_completed||Y.date_assigned)).reduce((Y,G)=>Y+(Number(G.units)||0),0),p=y.filter(Y=>Y.product_id===Q.$id&&Y.process_id===C.$id&&Y.status==="completed"&&D(Y.date_completed||Y.date_assigned)).reduce((Y,G)=>Y+(Number(G.units)||0),0),E=y.filter(Y=>Y.source_process_id===C.$id&&Y.product_id===Q.$id&&D(Y.date_assigned||Y.date_completed)).reduce((Y,G)=>{const le=Number(G.units)||0;return Y+le},0);let H=0;S.toLowerCase()==="batch coding"&&(H=T.filter(Y=>Y.product_id===Q.$id&&D(Y.date_sold||Y.$createdAt)).reduce((Y,G)=>{const le=Number(G.units_sold)||0;return Y+le},0));const R=E+H,M=v+p-R;let K="In Stock";M<=0?K="Out of Stock":M<h&&(K="Low Stock"),U.push({sku:B,product_name:A,process_name:S,opening_balance:v,completed_units:p,utilised:R,closing_balance:M,status:K,min_level:h})})}),U},[c,d,y,T,a,n,i]),isLoading:o||x||b,error:null}},dc=()=>{const{user:r,loading:s}=us(),t=st(),{toast:a}=Ie(),n=ns(),[i,l]=m.useState(""),[u,c]=m.useState({from:Vs(new Date),to:Bs(new Date)}),[o,d]=m.useState(Bt.ALL);if(s)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Oe,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Validating authentication..."})]})});if(!r)return console.error("PostProductionStatus: User not authenticated, redirecting to login"),e.jsx(kt,{to:"/login",state:{from:t},replace:!0});const{data:x=[],isLoading:y}=de({queryKey:Ls.processes,queryFn:async()=>await Us.getAll()}),{statusRecords:b=[],isLoading:T}=cc(u?.from?$e(u.from,"yyyy-MM-dd"):void 0,u?.to?$e(u.to,"yyyy-MM-dd"):void 0,{processId:o!==Bt.ALL?o:void 0}),O=m.useMemo(()=>{if(!b)return[];let D=[...b];if(i&&(D=D.filter(_=>_.product_name?.toLowerCase().includes(i.toLowerCase())||_.process_name?.toLowerCase().includes(i.toLowerCase())||_.sku?.toLowerCase().includes(i.toLowerCase()))),o!==Bt.ALL){const _=x.find(U=>U.$id===o)?.process_name;_&&(D=D.filter(U=>U.process_name===_))}return D},[b,i,o,x]),g=y||T,w=async()=>{try{await n.invalidateQueries({queryKey:["products"]}),await n.invalidateQueries({queryKey:["processes"]}),await n.invalidateQueries({queryKey:["postProductionTasks"]}),await n.invalidateQueries({queryKey:["salesUnits"]}),a({title:"Post-Production Data Refreshed",description:"Data updated successfully"})}catch{a({title:"Refresh Failed",description:"Please try again",variant:"destructive"})}},P=()=>{try{const D=[["SKU","Product","Process","Source Qty (kg)","Opening Balance","Completed Units","Utilised","Closing Balance","Min Level","Status"],...O.map(C=>[C.sku||"",C.product_name||"",C.process_name||"",C.source_qty??"N/A",C.opening_balance||0,C.completed_units||0,C.utilised||0,C.closing_balance||0,C.min_level||0,`"${C.status||"In Stock"}"`])].map(C=>C.join(",")).join(`
`),_=new Blob([D],{type:"text/csv"}),U=window.URL.createObjectURL(_),Q=document.createElement("a");Q.href=U,Q.download=`post-production-status-${$e(new Date,"yyyy-MM-dd")}.csv`,Q.click(),window.URL.revokeObjectURL(U),a({title:"Export Successful",description:"Post-production status data exported successfully."})}catch(D){console.error("PostProductionStatus: Export failed",D),a({title:"Export Failed",description:"Failed to export data. Please try again.",variant:"destructive"})}};return e.jsxs("div",{className:"space-y-6 p-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Post-Production Status"}),e.jsx("p",{className:"text-muted-foreground",children:"Track quality checks and post-production status"})]}),e.jsx(X,{children:e.jsx(ee,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("div",{className:"relative w-full md:w-auto",children:[e.jsx(os,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(z,{placeholder:"Search product, process or SKU...",className:"w-full pl-8 md:w-[200px] lg:w-[300px]",value:i,onChange:D=>l(D.target.value)})]}),e.jsx(Ct,{value:u,onChange:D=>{D?.from&&D?.to&&c(D)}}),e.jsxs(re,{value:o,onValueChange:d,children:[e.jsx(te,{className:"w-[180px]",children:e.jsx(ne,{placeholder:"Select Process"})}),e.jsxs(ae,{children:[e.jsx(N,{value:Bt.ALL,children:"All Processes"}),lc(x).filter(D=>{const _=D.process_name?.toLowerCase();return _==="packing"||_==="batch coding"}).map(D=>e.jsx(N,{value:D.$id,children:D.process_name},D.$id))]})]}),e.jsx(L,{onClick:w,variant:"outline",size:"icon",disabled:g,children:e.jsx(Fa,{className:`h-4 w-4 ${g?"animate-spin":""}`})}),e.jsx(L,{onClick:P,variant:"outline",size:"icon",disabled:!O||O.length===0,title:"Export to CSV",children:e.jsx(dt,{className:"h-4 w-4"})})]})})}),e.jsxs(X,{children:[e.jsx(me,{className:"flex flex-row items-center justify-between",children:e.jsxs(he,{children:["Post-Production Status Records (",O.length,")"]})}),e.jsx(ee,{children:g?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(Oe,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("span",{children:"Loading post-production status..."})]}):O.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("p",{className:"text-lg mb-2",children:"No post-production status found"}),e.jsx("p",{className:"text-sm",children:i?"No matching records found":"Post-production status data will be populated from packing tasks and sales"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(ps,{children:[e.jsx(xs,{children:e.jsxs(De,{children:[e.jsx(Z,{children:"SKU"}),e.jsx(Z,{children:"Product"}),e.jsx(Z,{children:"Process"}),e.jsx(Z,{className:"text-right",children:"Source Qty (kg)"}),e.jsx(Z,{className:"text-right",children:"Opening Balance"}),e.jsx(Z,{className:"text-right bg-purple-50",children:"Completed Units"}),e.jsx(Z,{className:"text-right bg-green-50",children:"Utilised"}),e.jsx(Z,{className:"text-right",children:"Closing Balance"}),e.jsx(Z,{className:"text-right",children:"Min Level"}),e.jsx(Z,{children:"Status"})]})}),e.jsx(gs,{children:O.map((D,_)=>e.jsxs(De,{children:[e.jsx(W,{className:"font-medium",children:D.sku}),e.jsx(W,{children:D.product_name}),e.jsx(W,{children:D.process_name}),e.jsx(W,{className:"text-right",children:D.source_qty??"N/A"}),e.jsx(W,{className:"text-right",children:D.opening_balance||0}),e.jsx(W,{className:"text-right bg-purple-50 font-medium",children:D.completed_units||0}),e.jsx(W,{className:"text-right bg-green-50 font-medium",children:D.utilised||0}),e.jsx(W,{className:"text-right font-semibold",children:e.jsx("span",{className:(D.closing_balance||0)<0?"text-red-600":"text-green-600",children:D.closing_balance||0})}),e.jsx(W,{className:"text-right text-muted-foreground",children:D.min_level||0}),e.jsx(W,{children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${D.status==="Out of Stock"?"bg-red-100 text-red-800":D.status==="Low Stock"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:D.status||"In Stock"})})]},`${D.sku}-${D.process_name}-${_}`))})]})})})]})]})};function uc(){const{user:r,loading:s}=us(),t=st(),[a,n]=m.useState(""),[i,l]=m.useState(void 0);if(s)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Oe,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Validating authentication..."})]})});if(!r)return console.error("InventoryStatus: User not authenticated, redirecting to login"),e.jsx(kt,{to:"/login",state:{from:t},replace:!0});const{data:u=[],isLoading:c}=de({queryKey:["products"],queryFn:async()=>await Rs.getAll()}),o=m.useMemo(()=>{const w=[];return i?.from&&w.push(Ke.greaterThanEqual("date",i.from.toISOString())),i?.to&&w.push(Ke.lessThanEqual("date",i.to.toISOString())),w},[i]),{data:d=[],isLoading:x}=de({queryKey:["sales-units-inventory",i?.from?.toISOString(),i?.to?.toISOString()],queryFn:async()=>await zs.getAll(o)}),{data:y=[],isLoading:b}=de({queryKey:["sales-records-inventory",i?.from?.toISOString(),i?.to?.toISOString()],queryFn:async()=>await ot.getAll(o)}),T=m.useMemo(()=>u.length?u.map(w=>{const P=w.sku||"",D=w.product||w.name||"",_=w.min_level||w.minLevel||0,U=d.filter(S=>S.sku===P).reduce((S,h)=>S+(h.units||0),0),Q=y.filter(S=>S.sku===P).reduce((S,h)=>S+(h.sold_units||0),0),C=0,B=C+U-Q;let A="In Stock";return B<=0?A="Out of Stock":B<=_&&(A="Low Stock"),{sku:P,product:D,opening_balance:C,sales_units:U,sold:Q,closing_balance:B,min_level:_,status:A}}):[],[u,d,y]),O=m.useMemo(()=>a?T.filter(w=>w.sku.toLowerCase().includes(a.toLowerCase())||w.product.toLowerCase().includes(a.toLowerCase())):T,[T,a]),g=c||x||b;return e.jsxs("div",{className:"space-y-6 p-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Inventory Status"}),e.jsx("p",{className:"text-muted-foreground",children:"Track current inventory levels based on sales units and sold units"})]}),e.jsx(X,{children:e.jsx(ee,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4 items-center flex-wrap",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(os,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(z,{placeholder:"Search by SKU or Product...",className:"pl-10",value:a,onChange:w=>n(w.target.value)})]}),e.jsx("div",{className:"min-w-[250px]",children:e.jsx(Ct,{value:i,onChange:l,placeholder:"Select date range for calculations"})}),e.jsxs(L,{variant:"outline",children:[e.jsx(Js,{className:"h-4 w-4 mr-2"}),"Filter"]}),e.jsxs(L,{variant:"outline",children:[e.jsx(dt,{className:"h-4 w-4 mr-2"}),"Export"]})]})})}),e.jsxs(X,{children:[e.jsx(me,{children:e.jsxs(he,{children:["Inventory Status (",O.length,")",i?.from&&i?.to&&e.jsxs("span",{className:"text-sm font-normal text-muted-foreground ml-2",children:["(",i.from.toLocaleDateString("en-GB")," - ",i.to.toLocaleDateString("en-GB"),")"]})]})}),e.jsx(ee,{children:g?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(Oe,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("span",{children:"Loading inventory status..."})]}):O.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("p",{className:"text-lg mb-2",children:"No inventory data found"}),e.jsx("p",{className:"text-sm",children:a?"Try adjusting your search criteria":"Add products and sales data to see inventory status"})]}):e.jsxs(ps,{children:[e.jsx(xs,{children:e.jsxs(De,{children:[e.jsx(Z,{children:"SKU"}),e.jsx(Z,{children:"Product"}),e.jsx(Z,{className:"text-right",children:"Opening Bal"}),e.jsx(Z,{className:"text-right bg-purple-50",children:"Sales Units"}),e.jsx(Z,{className:"text-right bg-green-50",children:"Sold"}),e.jsx(Z,{className:"text-right",children:"Closing Bal"}),e.jsx(Z,{className:"text-right",children:"Min Level"}),e.jsx(Z,{children:"Status"})]})}),e.jsx(gs,{children:O.map((w,P)=>e.jsxs(De,{children:[e.jsx(W,{className:"font-medium",children:w.sku}),e.jsx(W,{children:w.product}),e.jsx(W,{className:"text-right",children:w.opening_balance.toLocaleString()}),e.jsx(W,{className:"text-right bg-purple-50 font-medium",children:w.sales_units.toLocaleString()}),e.jsx(W,{className:"text-right bg-green-50 font-medium",children:w.sold.toLocaleString()}),e.jsx(W,{className:"text-right font-semibold",children:e.jsx("span",{className:w.closing_balance<0?"text-red-600":"text-green-600",children:w.closing_balance.toLocaleString()})}),e.jsx(W,{className:"text-right text-muted-foreground",children:w.min_level.toLocaleString()}),e.jsx(W,{children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${w.status==="Out of Stock"?"bg-red-100 text-red-800":w.status==="Low Stock"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:w.status})})]},`${w.sku}-${P}`))})]})})]}),e.jsxs(X,{children:[e.jsx(me,{children:e.jsx(he,{children:"Summary"})}),e.jsx(ee,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:O.length}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Products"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:O.reduce((w,P)=>w+P.sales_units,0).toLocaleString()}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Sales Units"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:O.reduce((w,P)=>w+P.sold,0).toLocaleString()}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Sold"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:O.reduce((w,P)=>w+P.closing_balance,0).toLocaleString()}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Net Closing Balance"})]})]})})]})]})}class ft{queryClient;static instance;constructor(s){this.queryClient=s}static getInstance(s){return!ft.instance&&s&&(ft.instance=new ft(s)),ft.instance}standardizeParams(s){const t=s.startDate?typeof s.startDate=="string"?s.startDate:$e(s.startDate,"yyyy-MM-dd"):void 0,a=s.endDate?typeof s.endDate=="string"?s.endDate:$e(s.endDate,"yyyy-MM-dd"):void 0,n=this.generateCacheKey({stockId:s.stockId,processId:s.processId,productId:s.productId,startDate:t,endDate:a,department:s.department});return{stockId:s.stockId,processId:s.processId,productId:s.productId,startDate:t,endDate:a,department:s.department,forceRefresh:s.forceRefresh??!0,cacheKey:n}}generateCacheKey(s){return[s.stockId||"all",s.processId||"all",s.productId||"all",s.startDate||"no-start",s.endDate||"no-end",s.department||"all-dept"].join("|")}selectDataSource(s,t){let a="stocks";if(s)switch(t){case"pre-production":a="pre_production_status";break;case"production":a="production_status";break;case"post-production":a="post_production_status";break;default:a="pre_production_status"}else a="stocks";return{collection:a,queryParams:this.standardizeParams({forceRefresh:!0}),cacheStrategy:"force-refresh",syncWithStatusPage:!0}}async fetchFreshData(s,t,a){await this.invalidateRelatedCache(s.queryParams.cacheKey);const n={...a,forceRefresh:!0,staleTime:0,refetchOnMount:"always"};return t(n)}async invalidateRelatedCache(s){const t=["stocks","stockStatus","preProductionStatus","productionStatus","postProductionStatus","preProductionTasks","productionTasks","postProductionTasks","salesUnits","processes","rawProducts","products"];await Promise.all(t.map(a=>this.queryClient.invalidateQueries({queryKey:[a]}))),this.propagateUpdates(s),console.log(`ðŸ”„ Cache invalidated for RTQV synchronization: ${s}`)}propagateUpdates(s){const t=new CustomEvent("rtqv-data-update",{detail:{cacheKey:s,timestamp:new Date().toISOString(),source:"dataSyncService"}});typeof window<"u"&&window.dispatchEvent(t),this.logSyncEvent("Cross-Component Update Propagation",{cacheKey:s,eventDispatched:!0})}setupRealTimeSync(){const s=n=>{n.key==="rtqv-sync-trigger"&&(this.logSyncEvent("Storage Sync Trigger",{newValue:n.newValue,timestamp:new Date().toISOString()}),this.invalidateRelatedCache("storage-sync"))},t=()=>{document.visibilityState==="visible"&&(this.logSyncEvent("Tab Visibility Change",{visible:!0,timestamp:new Date().toISOString()}),setTimeout(()=>{this.invalidateRelatedCache("visibility-sync")},500))},a=n=>{this.logSyncEvent("RTQV Update Event Received",{detail:n.detail,timestamp:new Date().toISOString()}),this.handleCrossComponentUpdate(n.detail)};return typeof window<"u"&&(window.addEventListener("storage",s),document.addEventListener("visibilitychange",t),window.addEventListener("rtqv-data-update",a)),()=>{typeof window<"u"&&(window.removeEventListener("storage",s),document.removeEventListener("visibilitychange",t),window.removeEventListener("rtqv-data-update",a))}}handleCrossComponentUpdate(s){const t=this.getAffectedQueries(s.cacheKey);t.forEach(a=>{this.queryClient.invalidateQueries({queryKey:[a]})}),this.logSyncEvent("Cross-Component Update Handled",{cacheKey:s.cacheKey,affectedQueries:t})}getAffectedQueries(s){const t={stock:["stocks","stockStatus"],"pre-production":["preProductionStatus","preProductionTasks"],production:["productionStatus","productionTasks"],"post-production":["postProductionStatus","postProductionTasks"],"manual-refresh":["stocks","stockStatus","preProductionStatus","productionStatus","postProductionStatus"]};for(const[a,n]of Object.entries(t))if(s.includes(a))return n;return["stocks","stockStatus","preProductionStatus","productionStatus","postProductionStatus"]}triggerCrossTabSync(s){if(typeof window<"u"&&window.localStorage){const t={reason:s,timestamp:new Date().toISOString(),tabId:Math.random().toString(36).substr(2,9)};localStorage.setItem("rtqv-sync-trigger",JSON.stringify(t)),setTimeout(()=>{localStorage.removeItem("rtqv-sync-trigger")},100),this.logSyncEvent("Cross-Tab Sync Triggered",t)}}createCacheInvalidationTriggers(s){return{onDataChange:()=>{this.invalidateRelatedCache(`${s}-data-change`),this.triggerCrossTabSync(`${s} data changed`)},onUserAction:()=>{this.invalidateRelatedCache(`${s}-user-action`),this.triggerCrossTabSync(`${s} user action`)},onError:()=>{this.invalidateRelatedCache(`${s}-error-recovery`),this.triggerCrossTabSync(`${s} error recovery`)}}}validateDataConsistency(s,t,a=.01){const n=[];let i="low";if(!s||!t)return n.push("Missing data from one or both sources"),i="high",this.logSyncEvent("Data Consistency Error",{error:"Missing data sources",rtqvData:!!s,statusData:!!t,severity:i}),{isConsistent:!1,differences:n,severity:i};const l=Number(s.closing_balance||s.Closing_Balance||0),u=Number(t.closing_balance||t.Closing_Balance||0),c=Math.abs(l-u);if(c>a){const b=u>0?c/u*100:100;n.push(`Closing balance mismatch: RTQV=${l}, Status=${u} (${b.toFixed(2)}% difference)`),b>50?i="high":b>10&&(i="medium")}const o=s.stock_name||s.Stock_Name||"",d=t.stock_name||t.Stock_Name||"";o&&d&&o!==d&&(n.push(`Stock name mismatch: RTQV="${o}", Status="${d}"`),i="medium");const x=s.lastUpdated||s.timestamp,y=t.lastUpdated||t.timestamp;if(x&&y){const b=Math.abs(new Date(x).getTime()-new Date(y).getTime()),T=5*60*1e3;b>T&&(n.push(`Data freshness mismatch: time difference ${Math.round(b/1e3)}s`),i==="low"&&(i="medium"))}return this.logSyncEvent("Data Consistency Validation",{rtqvBalance:l,statusBalance:u,balanceDifference:c,isConsistent:n.length===0,differences:n,severity:i,rtqvStock:o,statusStock:d}),{isConsistent:n.length===0,differences:n,severity:i}}async validateAndCorrectData(s,t,a){const n=[];let i={...s};try{(!s||typeof s!="object")&&(n.push(`Invalid primary data for ${a}, using fallback`),i=t||{});const l=this.getCriticalFields(a);for(const c of l)(i[c]===void 0||i[c]===null)&&(t&&t[c]!==void 0?(i[c]=t[c],n.push(`Corrected missing ${c} from fallback data`)):(i[c]=this.getDefaultValue(c),n.push(`Set default value for missing ${c}`)));const u=["closing_balance","opening_balance","utilised","available_quantity"];for(const c of u)if(i[c]!==void 0){const o=Number(i[c]);(isNaN(o)||o<0)&&(i[c]=0,n.push(`Corrected invalid ${c} value to 0`))}this.logSyncEvent("Data Validation and Correction",{dataType:a,corrections:n,hasCorrections:n.length>0})}catch(l){this.logSyncEvent("Data Validation Error",{dataType:a,error:l instanceof Error?l.message:"Unknown error",fallbackUsed:!0}),n.push(`Validation failed, using fallback data: ${l}`),i=t||{}}return{correctedData:i,corrections:n}}getCriticalFields(s){return{stock:["Stock_Name","Closing_Balance","Category"],"pre-production":["stock_name","process","closing_balance"],production:["stock_name","process","closing_balance"],"post-production":["product_name","process_name","closing_balance"]}[s]||[]}getDefaultValue(s){return{closing_balance:0,opening_balance:0,utilised:0,available_quantity:0,stock_name:"Unknown Stock",Stock_Name:"Unknown Stock",process:"Unknown Process",process_name:"Unknown Process",product_name:"Unknown Product",Category:"Unknown"}[s]||null}detectDiscrepancies(s,t,a){const n=[];try{s.length!==t.length&&n.push({type:"count_mismatch",rtqvCount:s.length,statusCount:t.length,severity:"medium"}),s.forEach((l,u)=>{const c=this.findMatchingRecord(l,t,a);if(!c){n.push({type:"missing_status_record",rtqvRecord:l,index:u,severity:"high"});return}const o=this.validateDataConsistency(l,c);o.isConsistent||n.push({type:"data_inconsistency",rtqvRecord:l,statusRecord:c,differences:o.differences,severity:o.severity,index:u})});const i=`Found ${n.length} discrepancies in ${a} data`;return this.logSyncEvent("Discrepancy Detection",{dataType:a,discrepancyCount:n.length,summary:i,highSeverityCount:n.filter(l=>l.severity==="high").length}),{discrepancies:n,summary:i}}catch(i){const l=`Error detecting discrepancies: ${i}`;return this.logSyncEvent("Discrepancy Detection Error",{dataType:a,error:i instanceof Error?i.message:"Unknown error"}),{discrepancies:[],summary:l}}}findMatchingRecord(s,t,a){const n=(l,u)=>{switch(u){case"stock":return l.Stock_Name||l.stock_name;case"pre-production":case"production":return`${l.stock_name}-${l.process}`;case"post-production":return`${l.product_name}-${l.process_name}`;default:return l.id||l.$id}},i=n(s,a);return t.find(l=>n(l,a)===i)||null}getCurrentMonthRange(){const s=new Date,t=$e(Vs(s),"yyyy-MM-dd"),a=$e(Bs(s),"yyyy-MM-dd");return{startDate:t,endDate:a}}createRTQVQueryOptions(s,t){return{queryKey:[...s,"rtqv",t.cacheKey],staleTime:0,refetchOnMount:"always",refetchOnWindowFocus:!0,refetchInterval:!1,retry:2,retryDelay:a=>Math.min(1e3*2**a,3e4)}}logSyncEvent(s,t){console.log(`ðŸ”„ RTQV Sync Event: ${s}`,{timestamp:new Date().toISOString(),...t})}async recoverFromError(s,t,a=0,n){if(this.logSyncEvent("Error Recovery Attempt",{error:s.message,retryCount:a,maxRetries:2,context:n}),a<2){await new Promise(u=>setTimeout(u,1e3*(a+1)));try{return await t()}catch(u){return this.recoverFromError(u,t,a+1,n)}}throw this.createUserFriendlyError(s,n)}createUserFriendlyError(s,t){const a=s.message.toLowerCase();let n="",i=[];a.includes("network")||a.includes("fetch")?(n="Unable to connect to the server. Please check your internet connection.",i=["Check your internet connection","Try refreshing the page","Contact support if the problem persists"]):a.includes("database")||a.includes("query")?(n="There was a problem retrieving data from the database.",i=["Try refreshing the data","Check if the server is running","Contact your system administrator"]):a.includes("cache")||a.includes("stale")?(n="The data cache needs to be refreshed.",i=["Click the refresh button","Clear your browser cache","Try again in a few moments"]):a.includes("consistency")||a.includes("mismatch")?(n="Data inconsistency detected between different sources.",i=["Refresh the page to get latest data","Check if other users are making changes","Contact support if data appears incorrect"]):a.includes("permission")||a.includes("unauthorized")?(n="You do not have permission to access this data.",i=["Check your user permissions","Contact your administrator","Try logging out and back in"]):(n="An unexpected error occurred while processing your request.",i=["Try refreshing the page","Check your internet connection","Contact support if the problem continues"]),t&&(n=`${n} (Context: ${t})`);const l=new Error(n);return l.suggestions=i,l.originalError=s,l.isUserFriendly=!0,l}getLoadingStateMessage(s,t,a){if(t){const n=t.isUserFriendly,i=t.suggestions;return{message:n?t.message:`Error loading ${a||"data"}: ${t.message}`,type:"error",suggestions:i}}return s?{message:{stock:"Loading stock data...","pre-production":"Loading pre-production status...",production:"Loading production status...","post-production":"Loading post-production status..."}[a]||"Loading data...",type:"loading"}:{message:"Data loaded successfully",type:"success"}}createRTQVErrorState(s,t,a){const n=this.createUserFriendlyError(s,`RTQV validation for ${t}`);return{isValid:!1,availableQuantity:0,validationMessage:n.message,validationClass:"bg-red-50 text-red-700 border-red-200",error:n.message,suggestions:n.suggestions}}async manualRefresh(s,t){try{this.logSyncEvent("Manual Refresh Initiated",{component:s,dataType:t,timestamp:new Date().toISOString()}),await this.invalidateRelatedCache("manual-refresh"),await new Promise(n=>setTimeout(n,500));const a=`${s==="rtqv"?"RTQV":"Status page"} data refreshed successfully`;return this.logSyncEvent("Manual Refresh Completed",{component:s,dataType:t,success:!0}),{success:!0,message:a}}catch(a){const n=`Failed to refresh ${s} data: ${a}`;return this.logSyncEvent("Manual Refresh Failed",{component:s,dataType:t,error:a instanceof Error?a.message:"Unknown error"}),{success:!1,message:n}}}}const ha=r=>ft.getInstance(r),An=(r,s,t,a={})=>{const[n,i]=m.useState([]),[l,u]=m.useState(null),c=ns(),o=ha(c),d=r?Ge(r):void 0,x=s?Ge(s):void 0,y=d?Gs(d,1):void 0,b=d?$e(d,"yyyy-MM-dd"):void 0,T=x?$e(x,"yyyy-MM-dd"):void 0,O=y?$e(y,"yyyy-MM-dd"):void 0,g=o.standardizeParams({startDate:r,endDate:s,processId:t,forceRefresh:a.forceRefresh||a.rtqvMode}),w=(H,R,M=!0)=>{const K={queryKey:H,queryFn:R,enabled:M};return a.rtqvMode||a.forceRefresh?{...K,...o.createRTQVQueryOptions(H,g),enabled:M}:K},{data:P,isLoading:D}=de(w(["stocks"],()=>ws.getAll())),{data:_,isLoading:U}=de(w(["processes"],()=>Us.getAll())),{data:Q,isLoading:C}=de(w(["preProductionTasks",g.startDate,g.endDate],()=>Fs.getByDateRange(d,x),!!P&&!!_)),{data:B,isLoading:A}=de(w(["preProductionTasksBefore",O],()=>Fs.getByDateRange(void 0,y),!!P&&!!_&&!!y)),{data:S,isLoading:h}=de(w(["productionTasksForPreStatus",g.startDate,g.endDate],()=>qs.getProductionTasksWithRelations(b,T),!!P&&!!_)),{data:F,isLoading:v}=de(w(["productionTasksBeforeForPreStatus",O],()=>qs.getProductionTasksWithRelations(void 0,O),!!P&&!!_&&!!y));m.useEffect(()=>{if(!isEnabled){i([]);return}if(P&&_&&Q)try{const H=new Map(_.map(le=>[le.$id,le.process_name])),R=new Map(_.map(le=>[le.process_name,le.$id])),M=t?_.filter(le=>le.$id===t):_.filter(le=>{const se=le.category||le.process_category;if(se&&se.toLowerCase()==="pre-production")return!0;const ye=le.department?.toLowerCase();return ye&&(ye.includes("pre")||ye.includes("preparation")),!0}),K=le=>{if(!le)return!d&&!x;if(!d&&!x)return!0;const se=Ge(le),ye=d?se>=d:!0,ve=x?se<=x:!0;return ye&&ve},Y=le=>!le||!y?!1:Ge(le)<=y,G=P.flatMap(le=>M.map(se=>{const ye=le.stock_name,ve=se.process_name;if(!ye||!ve)return null;const je=(B||[]).filter(ue=>ue.stock_id===le.$id&&ue.process_id===se.$id&&ue.status==="completed"&&Y(ue.date_completed||ue.date_assigned)).reduce((ue,Pe)=>{const ls=Pe.completed_quantity!==void 0&&Pe.completed_quantity!==null?Number(Pe.completed_quantity):Number(Pe.assigned_quantity)||0,Cs=Number(Pe.wastage_quantity)||0;return ue+(ls-Cs)},0);let Se=0;const Ue=(B||[]).filter(ue=>ue.stock_id===le.$id&&ue.stock_source===ve&&Y(ue.date_assigned)).reduce((ue,Pe)=>ue+(Number(Pe.assigned_quantity)||0),0),Ae=(F||[]).filter(ue=>ue.source_process_id===se.$id).reduce((ue,Pe)=>{const Cs=(Pe.stock_items||[]).filter(V=>V.stock_id===le.$id).reduce((V,Re)=>V+(Number(Re.quantity)||0),0);return ue+Cs},0);Se=Ue+Ae;const Me=Math.max(0,je-Se),He=Q.filter(ue=>ue.stock_id===le.$id&&ue.process_id===se.$id&&ue.status==="completed"&&K(ue.date_completed||ue.date_assigned)),$=He.reduce((ue,Pe)=>ue+(Number(Pe.assigned_quantity)||0),0),k=He.reduce((ue,Pe)=>ue+(Number(Pe.wastage_quantity)||0),0),fe=He.reduce((ue,Pe)=>ue+(Pe.completed_quantity!==void 0&&Pe.completed_quantity!==null?Number(Pe.completed_quantity):Number(Pe.assigned_quantity)||0),0)-k;let we=0;const Te=Q.filter(ue=>ue.stock_id===le.$id&&ue.stock_source===ve&&K(ue.date_assigned)).reduce((ue,Pe)=>{const ls=Number(Pe.assigned_quantity)||0;return ue+ls},0),_e=(S||[]).filter(ue=>ue.source_process_id===se.$id).reduce((ue,Pe)=>{const Cs=(Pe.stock_items||[]).filter(V=>V.stock_id===le.$id).reduce((V,Re)=>V+(Number(Re.quantity)||0),0);return ue+Cs},0);we=Te+_e+0;const j=Me+fe-we;if(Me===0&&fe===0&&k===0&&we===0)return null;const ce=le.min_level||le.minLevel||0;let Ne="In Stock";return j<=0?Ne="Out of Stock":j<=ce&&(Ne="Low Stock"),{stock_name:ye,process:ve,opening_balance:Me,effective_completed:fe,wastage_qty:k,utilised:we,closing_balance:j,min_level:ce,status:Ne}}).filter(se=>se!==null));i(G),u(null)}catch(H){u(H instanceof Error?H:new Error("An unknown error occurred"))}},[isEnabled,P,_,Q,B,t,d,x]);const I=D||U||C||A||h||v,p=async()=>((a.rtqvMode||a.forceRefresh)&&(await o.invalidateRelatedCache(g.cacheKey),o.logSyncEvent("Manual Refetch",{hook:"usePreProductionStatus",params:g,rtqvMode:a.rtqvMode})),Promise.all([c.refetchQueries({queryKey:["stocks"]}),c.refetchQueries({queryKey:["processes"]}),c.refetchQueries({queryKey:["preProductionTasks"]}),c.refetchQueries({queryKey:["preProductionTasksBefore"]}),c.refetchQueries({queryKey:["productionTasksForPreStatus"]}),c.refetchQueries({queryKey:["productionTasksBeforeForPreStatus"]})])),E=H=>!H||!n.length?{isConsistent:!0,differences:[]}:o.validateDataConsistency(n,H);return{data:n,isLoading:I,error:l,refetch:p,standardParams:g,rtqvMode:a.rtqvMode,validateDataConsistency:E}},mc=(r,s,t,a,n={})=>{const i=ns(),l=ha(i),u=n.enabled??!0,c=l.standardizeParams({startDate:r,endDate:s,forceRefresh:n.forceRefresh||n.rtqvMode}),o=(A,S)=>{const h={queryKey:A,queryFn:S,enabled:u};return n.rtqvMode||n.forceRefresh?{...h,...l.createRTQVQueryOptions(A,c),enabled:u}:h},{data:d,isLoading:x}=de(o(["stocks"],()=>ws.getAll())),y=r?Gs(r,1):void 0,{data:b,isLoading:T}=de(o(["purchases",c.startDate,c.endDate],()=>Ks.getByDateRange(r,s))),{data:O,isLoading:g}=de(o(["processes"],()=>Us.getAll())),{data:w,isLoading:P}=de(o(["tasks",c.startDate,c.endDate],()=>Fs.getByDateRange(r,s))),{data:D,isLoading:_}=de(o(["purchasesBefore",y?$e(y,"yyyy-MM-dd"):null],()=>Ks.getByDateRange(void 0,y))),{data:U,isLoading:Q}=de(o(["tasksBefore",y?$e(y,"yyyy-MM-dd"):null],()=>Fs.getByDateRange(void 0,y)));return{stockStatus:m.useMemo(()=>!u||!d||!b||!w||!O?[]:d.filter(S=>!t).filter(S=>!a).map(S=>{const h=(D||[]).filter(M=>M.stock_id===S.$id).reduce((M,K)=>M+(K.quantity||0),0),F=(U||[]).filter(M=>M.stock_id===S.$id&&M.status==="completed"&&M.stock_source==="Stock").reduce((M,K)=>M+(K.assigned_quantity||0),0),v=h-F,I=(b||[]).filter(M=>M.stock_id===S.$id).reduce((M,K)=>M+(K.quantity||0),0),p=(w||[]).filter(M=>M.stock_id===S.$id&&M.status==="completed"&&M.stock_source==="Stock").reduce((M,K)=>M+(K.assigned_quantity||0),0);hs.log(`ðŸ” STOCK STATUS UTILIZATION for ${S.stock_name}:`,{stockId:S.$id,tasksInRange:w?.length||0,directStockTasks:(w||[]).filter(M=>M.stock_id===S.$id&&M.status==="completed"&&M.stock_source==="Stock").length,totalUtilised:p,allTasksForStock:(w||[]).filter(M=>M.stock_id===S.$id).map(M=>({task_id:M.task_id,stock_source:M.stock_source,assigned_quantity:M.assigned_quantity,status:M.status}))});const E=v+I-p,H=S.min_level||S.minLevel||0;let R="In Stock";return E<=0?R="Out of Stock":E<=H&&(R="Low Stock"),{$id:S.$id,Stock_Name:S.stock_name,Category:S.category||"",Opening_Balance:v,Purchases:I,Utilised:p,Closing_Balance:E,Min_Level:H,Status:R}}),[u,d,b,w,D,U,O,t,a]),isLoading:u?x||T||P||_||Q||g:!1,refetch:async()=>{(n.rtqvMode||n.forceRefresh)&&(await l.invalidateRelatedCache(c.cacheKey),l.logSyncEvent("Manual Refetch",{hook:"useStockStatus",params:c,rtqvMode:n.rtqvMode})),await Promise.all([i.refetchQueries({queryKey:["stocks"]}),i.refetchQueries({queryKey:["purchases"]}),i.refetchQueries({queryKey:["tasks"]}),i.refetchQueries({queryKey:["purchasesBefore"]}),i.refetchQueries({queryKey:["tasksBefore"]}),i.refetchQueries({queryKey:["processes"]})])},standardParams:c,rtqvMode:n.rtqvMode}},hc=[{value:"pending",label:"Pending"},{value:"in_progress",label:"In Progress"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"}],pc=({isOpen:r,onClose:s,onSubmit:t,editingTask:a,isLoading:n=!1})=>{const{data:i}=Rn(),{data:l}=Ma(),{data:u}=at(),c=new Date,o=Vs(c),d=Bs(c),{data:x}=An(o.toISOString().split("T")[0],d.toISOString().split("T")[0],void 0,{rtqvMode:!0,forceRefresh:!0}),{stockStatus:y,isLoading:b}=mc(o,d,void 0,void 0,{rtqvMode:!0,forceRefresh:!0});m.useEffect(()=>{console.log("ðŸ” RTQV DATA SOURCE DEBUG:",{dateRange:`${o.toISOString().split("T")[0]} to ${d.toISOString().split("T")[0]}`,isLoading:b,dataLength:y?.length,sampleData:y?.slice(0,2),timestamp:new Date().toISOString()})},[y,b]);const T=["Stock","Cleaning","C & D","Roasting","RFP"],O=u.filter(S=>{const h=S.process_name?.toLowerCase();return["cleaning","c & d","roasting","rfp"].includes(h)}),[g,w]=m.useState({task_id:"",stock_id:"",stock_source:"",date_assigned:new Date().toISOString().split("T")[0],process_id:"",assigned_quantity:"",completed_quantity:"",staff_id:"",date_completed:"",wastage_quantity:"",remarks:"",status:"pending"}),[P,D]=m.useState({}),[_,U]=m.useState(null),Q=()=>{if(!g.stock_id||!g.stock_source||!g.assigned_quantity){U(null);return}const S=i?.find(R=>R.$id===g.stock_id);if(!S){U({isValid:!1,availableQty:0,requiredQty:0,stockName:"Unknown Stock",stockSource:g.stock_source,error:"Stock not found",validationClass:"bg-red-50 text-red-700 border-red-200",validationMessage:"Selected stock not found"});return}const h=parseFloat(g.assigned_quantity);if(h<=0){U({isValid:!1,availableQty:0,requiredQty:h,stockName:S.stock_name,stockSource:g.stock_source,error:"Invalid quantity",validationClass:"bg-yellow-50 text-yellow-700 border-yellow-200",validationMessage:"Quantity must be greater than 0"});return}let F=0,v="",I=!1;if(g.stock_source==="Stock"){if(v="Stock Status",I=b,I){U({isValid:!1,availableQty:0,requiredQty:h,stockName:S.stock_name,stockSource:g.stock_source,dataSource:v,isLoading:!0,validationClass:"bg-blue-50 text-blue-700 border-blue-200",validationMessage:"Loading stock data..."});return}const R=y?.find(M=>M.Stock_Name?.toLowerCase()===S.stock_name?.toLowerCase());F=R?.Closing_Balance??0,console.log("ðŸ” RTQV Stock Status Check:",{stock_name:S.stock_name,stockRecord_found:!!R,closing_balance:R?.Closing_Balance,availableQty:F,dataSource:v,forced_fresh:!0})}else{v="Pre-Production Status";const R=x?.find(M=>M.stock_name===S.stock_name&&M.process===g.stock_source);F=R?.closing_balance??0,console.log("ðŸ” RTQV Pre-Production Status Check:",{stock_name:S.stock_name,stock_source:g.stock_source,statusRecord_found:!!R,closing_balance:R?.closing_balance,availableQty:F,dataSource:v,forced_fresh:!0})}const p=F>=h;let E="",H="";p?(E="bg-green-50 text-green-700 border-green-200",H=`âœ“ Available: ${F}kg (Required: ${h}kg)`):F===0?(E="bg-red-50 text-red-700 border-red-200",H=`âœ— Out of stock (Required: ${h}kg)`):(E="bg-orange-50 text-orange-700 border-orange-200",H=`âš  Insufficient stock: ${F}kg available (Required: ${h}kg)`),U({isValid:p,availableQty:F,requiredQty:h,stockName:S.stock_name,stockSource:g.stock_source,dataSource:v,isLoading:!1,validationClass:E,validationMessage:H})};m.useEffect(()=>{Q()},[g.stock_id,g.stock_source,g.assigned_quantity,i,x,y]),m.useEffect(()=>{if(r)if(a)w({task_id:a.task_id,stock_id:a.stock_id,stock_source:a.stock_source,date_assigned:a.date_assigned,process_id:a.process_id,assigned_quantity:a.assigned_quantity.toString(),completed_quantity:a.completed_quantity?.toString()||"",staff_id:a.staff_id,date_completed:a.date_completed||"",wastage_quantity:a.wastage_quantity?.toString()||"",remarks:a.remarks||"",status:a.status});else{const S=`TASK${Date.now().toString().slice(-6)}`;w({task_id:S,stock_id:"",stock_source:"",date_assigned:new Date().toISOString().split("T")[0],process_id:"",assigned_quantity:"",completed_quantity:"",staff_id:"",date_completed:"",wastage_quantity:"",remarks:"",status:"pending"})}},[a,r]);const C=()=>{const S={};return g.task_id.trim()||(S.task_id="Task ID is required"),g.stock_id||(S.stock_id="Stock is required"),g.stock_source||(S.stock_source="Stock source is required"),g.date_assigned||(S.date_assigned="Date assigned is required"),g.process_id||(S.process_id="Process is required"),(!g.assigned_quantity||parseFloat(g.assigned_quantity)<=0)&&(S.assigned_quantity="Assigned quantity must be greater than 0"),g.staff_id||(S.staff_id="Staff is required"),g.wastage_quantity&&parseFloat(g.wastage_quantity)<0&&(S.wastage_quantity="Wastage quantity cannot be negative"),D(S),Object.keys(S).length===0},B=S=>{if(S.preventDefault(),!C())return;const h={task_id:g.task_id,stock_id:g.stock_id,stock_source:g.stock_source,date_assigned:g.date_assigned,process_id:g.process_id,assigned_quantity:parseFloat(g.assigned_quantity),completed_quantity:g.completed_quantity?parseFloat(g.completed_quantity):void 0,staff_id:g.staff_id,date_completed:g.date_completed||void 0,wastage_quantity:g.wastage_quantity?parseFloat(g.wastage_quantity):void 0,remarks:g.remarks||void 0,status:g.status};t(h)},A=()=>{w({task_id:"",stock_id:"",stock_source:"",date_assigned:new Date().toISOString().split("T")[0],process_id:"",assigned_quantity:"",completed_quantity:"",staff_id:"",date_completed:"",wastage_quantity:"",remarks:"",status:"pending"}),D({}),U(null),s()};return e.jsx(as,{open:r,onOpenChange:A,children:e.jsxs(Ze,{className:"sm:max-w-[600px] max-w-[95vw] max-h-[90vh] overflow-y-auto",children:[e.jsxs(es,{children:[e.jsx(ts,{children:a?"Edit Pre-Production Task":"Add New Pre-Production Task"}),e.jsx(rs,{children:a?"Update the details of the pre-production task below.":"Fill in the details to create a new pre-production task."})]}),e.jsxs("form",{onSubmit:B,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(q,{htmlFor:"task_id",children:"Task ID *"}),e.jsx(z,{id:"task_id",value:g.task_id,onChange:S=>w({...g,task_id:S.target.value}),className:P.task_id?"border-red-500":""}),P.task_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:P.task_id})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"date_assigned",children:"Date Assigned *"}),e.jsx(z,{id:"date_assigned",type:"date",value:g.date_assigned,onChange:S=>w({...g,date_assigned:S.target.value}),className:P.date_assigned?"border-red-500":""}),P.date_assigned&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:P.date_assigned})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(q,{htmlFor:"stock_id",children:"Stock Name *"}),e.jsxs(re,{value:g.stock_id,onValueChange:S=>w({...g,stock_id:S}),children:[e.jsx(te,{className:P.stock_id?"border-red-500":"",children:e.jsx(ne,{placeholder:"Select Stock"})}),e.jsx(ae,{children:i.map(S=>e.jsx(N,{value:S.$id||"",children:S.stock_name},S.$id))})]}),P.stock_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:P.stock_id})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"stock_source",children:"Stock Source *"}),e.jsxs(re,{value:g.stock_source,onValueChange:S=>w({...g,stock_source:S}),children:[e.jsx(te,{className:P.stock_source?"border-red-500":"",children:e.jsx(ne,{placeholder:"Select Source"})}),e.jsx(ae,{children:T.map(S=>e.jsx(N,{value:S,children:S},S))})]}),P.stock_source&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:P.stock_source})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(q,{htmlFor:"process_id",children:"Process *"}),e.jsxs(re,{value:g.process_id,onValueChange:S=>w({...g,process_id:S}),children:[e.jsx(te,{className:P.process_id?"border-red-500":"",children:e.jsx(ne,{placeholder:"Select Process"})}),e.jsx(ae,{children:O.map(S=>e.jsx(N,{value:S.$id||"",children:S.process_name},S.$id))})]}),P.process_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:P.process_id})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"assigned_quantity",children:"Assigned Quantity *"}),e.jsx(z,{id:"assigned_quantity",type:"number",step:"0.01",min:"0",value:g.assigned_quantity,onChange:S=>w({...g,assigned_quantity:S.target.value}),className:P.assigned_quantity?"border-red-500":"",placeholder:"Enter quantity in kg"}),P.assigned_quantity&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:P.assigned_quantity}),_&&e.jsxs("div",{className:`mt-2 p-3 rounded-md border text-sm ${_.validationClass}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("div",{className:"font-medium",children:_.stockName}),e.jsxs("div",{className:"text-xs opacity-75",children:["Source: ",_.dataSource]})]}),e.jsx("div",{className:"mb-1",children:_.validationMessage}),_.error&&e.jsxs("div",{className:"text-xs mt-1 opacity-75",children:["Error: ",_.error]}),_.isLoading&&e.jsxs("div",{className:"flex items-center gap-2 text-xs mt-1",children:[e.jsx("div",{className:"animate-spin h-3 w-3 border border-current border-t-transparent rounded-full"}),"Loading fresh data from ",_.dataSource,"..."]})]})]})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"staff_id",children:"Assigned To *"}),e.jsxs(re,{value:g.staff_id,onValueChange:S=>w({...g,staff_id:S}),children:[e.jsx(te,{className:P.staff_id?"border-red-500":"",children:e.jsx(ne,{placeholder:"Select Staff"})}),e.jsx(ae,{children:l.map(S=>e.jsx(N,{value:S.$id||"",children:S.staff_name},S.$id))})]}),P.staff_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:P.staff_id})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(q,{htmlFor:"completed_quantity",children:"Completed Quantity"}),e.jsx(z,{id:"completed_quantity",type:"number",value:g.completed_quantity,onChange:S=>w({...g,completed_quantity:S.target.value})})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"date_completed",children:"Date Completed"}),e.jsx(z,{id:"date_completed",type:"date",value:g.date_completed,onChange:S=>w({...g,date_completed:S.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(q,{htmlFor:"wastage_quantity",children:"Wastage Quantity"}),e.jsx(z,{id:"wastage_quantity",type:"number",step:"0.01",min:"0",value:g.wastage_quantity,onChange:S=>w({...g,wastage_quantity:S.target.value}),className:P.wastage_quantity?"border-red-500":""}),P.wastage_quantity&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:P.wastage_quantity})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"status",children:"Status"}),e.jsxs(re,{value:g.status,onValueChange:S=>w({...g,status:S}),children:[e.jsx(te,{children:e.jsx(ne,{placeholder:"Select Status"})}),e.jsx(ae,{children:hc.map(S=>e.jsx(N,{value:S.value,children:S.label},S.value))})]})]})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"remarks",children:"Remarks"}),e.jsx(et,{id:"remarks",value:g.remarks,onChange:S=>w({...g,remarks:S.target.value}),placeholder:"Enter any remarks",rows:3})]})]}),e.jsxs(ss,{className:"flex-col sm:flex-row gap-2 pt-4",children:[e.jsx(L,{type:"button",variant:"outline",onClick:A,className:"w-full sm:w-auto",children:"Cancel"}),e.jsx(L,{type:"submit",disabled:n,className:"w-full sm:w-auto",children:n?"Saving...":a?"Update":"Save"})]})]})]})})},xc=()=>{const r=ns(),s=Ee({mutationFn:n=>Ye.createDocument(We,be.PRE_PRODUCTION_TASKS,ct.unique(),n),onSuccess:()=>{r.invalidateQueries({queryKey:["preProductionTasks"]})}}),t=Ee({mutationFn:({id:n,data:i})=>Ye.updateDocument(We,be.PRE_PRODUCTION_TASKS,n,i),onSuccess:()=>{r.invalidateQueries({queryKey:["preProductionTasks"]})}}),a=Ee({mutationFn:n=>Ye.deleteDocument(We,be.PRE_PRODUCTION_TASKS,n),onSuccess:()=>{r.invalidateQueries({queryKey:["preProductionTasks"]})}});return{createTask:s,updateTask:t,deleteTask:a}},gc=()=>{const[r,s]=m.useState(""),[t,a]=m.useState(!1),[n,i]=m.useState(null),[l,u]=m.useState([]),[c,o]=m.useState({show:!1,message:"",type:"success"}),[d,x]=m.useState("all"),[y,b]=m.useState("all"),[T,O]=m.useState("all"),[g,w]=m.useState({from:"",to:""}),[P,D]=m.useState(1),[_,U]=m.useState(50),{tasks:Q,isLoading:C,error:B,refetch:A}=Cn(),{createTask:S,updateTask:h,deleteTask:F}=xc(),{config:v}=_s("pre-production-tasks"),{validationRules:I,canImport:p}=ks("pre-production-tasks");Ro("pre-production-tasks");const{currentSort:E,handleSort:H,getSortedData:R}=Zs();at();const M=($,k)=>{o({show:!0,message:$,type:k}),setTimeout(()=>o({show:!1,message:"",type:"success"}),3e3)},K=Q.filter($=>{const k=$.task_id.toLowerCase().includes(r.toLowerCase())||$.stock_name.toLowerCase().includes(r.toLowerCase())||$.staff_name.toLowerCase().includes(r.toLowerCase())||$.process_name.toLowerCase().includes(r.toLowerCase()),pe=d==="all"||$.stock_name.toLowerCase().includes(d.toLowerCase()),fe=y==="all"||$.process_name.toLowerCase().includes(y.toLowerCase()),we=T==="all"||$.staff_name.toLowerCase().includes(T.toLowerCase()),Te=(!g.from||$.date_assigned>=g.from)&&(!g.to||$.date_assigned<=g.to);return k&&pe&&fe&&we&&Te}),Y=Array.from(new Set(Q.map($=>$.stock_name))).sort(),G=Array.from(new Set(Q.map($=>$.process_name))).sort(),le=Array.from(new Set(Q.map($=>$.staff_name))).sort(),se=K.length,ye=Math.ceil(se/_),ve=(P-1)*_,ke=ve+_,je=K.slice(ve,ke);m.useEffect(()=>{D(1)},[r,d,y,T,g,_]);const Se=async $=>{try{n?(await h.mutateAsync({id:n.$id,data:$}),M("Pre-production task updated successfully","success")):(await S.mutateAsync($),M("Pre-production task created successfully","success")),a(!1),i(null)}catch(k){console.error("Error saving task:",k),M("Failed to save task","error")}},Ue=$=>{i($),a(!0)},Ae=async $=>{if(window.confirm("Are you sure you want to delete this task?"))try{await F.mutateAsync($.$id),M("Pre-production task deleted successfully","success")}catch(k){console.error("Error deleting task:",k),M("Failed to delete task","error")}},Me=async()=>{if(l.length===0){M("Please select tasks to delete","error");return}if(window.confirm(`Are you sure you want to delete ${l.length} selected task(s)?`))try{await Promise.all(l.map($=>F.mutateAsync($.$id))),u([]),M(`${l.length} tasks deleted successfully`,"success")}catch($){console.error("Error deleting tasks:",$),M("Failed to delete selected tasks","error")}},He=()=>{if(l.length===0){M("Please select tasks to export","error");return}M(`Exporting ${l.length} selected task(s)...`,"success")};return B?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Pre-Production Tasks"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage pre-production processing tasks"})]}),e.jsx(X,{children:e.jsx(ee,{className:"pt-6",children:e.jsxs("div",{className:"text-center py-12 text-red-600",children:[e.jsx("p",{className:"text-lg mb-2",children:"Error loading tasks"}),e.jsx("p",{className:"text-sm mb-4",children:B.message}),e.jsx(L,{onClick:()=>A(),variant:"outline",children:"Retry"})]})})})]}):e.jsxs("div",{className:"space-y-6",children:[c.show&&e.jsx("div",{className:`fixed top-4 right-4 px-4 py-2 rounded-md shadow-lg z-50 ${c.type==="success"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300"}`,children:c.message}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Pre-Production Tasks"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage pre-production processing tasks"})]}),e.jsxs(L,{className:"bg-primary hover:bg-primary/90",onClick:()=>{i(null),a(!0)},children:[e.jsx(vs,{className:"h-4 w-4 mr-2"}),"Add New"]})]}),e.jsx(X,{children:e.jsx(ee,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(os,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(z,{placeholder:"Search tasks...",className:"pl-10",value:r,onChange:$=>s($.target.value)})]}),p&&v&&e.jsx(ys,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:v.exportColumns.filter($=>$.required).map($=>$.exportHeader),optionalColumns:v.exportColumns.filter($=>!$.required).map($=>$.exportHeader),validationRules:I,onImportComplete:$=>{$.successfulRows>0&&(A(),M(`${$.successfulRows} pre-production tasks imported successfully.`,"success"))}},variant:"outline"}),v&&e.jsx(js,{data:K.map($=>{const k={};return v.exportColumns.forEach(pe=>{const fe=$[pe.dataKey];k[pe.exportHeader]=pe.formatter?pe.formatter(fe):fe}),k}),headers:v.exportColumns.map($=>$.exportHeader),filename:"pre-production-tasks",variant:"outline"})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs(re,{value:d,onValueChange:x,children:[e.jsx(te,{className:"w-[180px]",children:e.jsx(ne,{placeholder:"Stock Name"})}),e.jsxs(ae,{children:[e.jsx(N,{value:"all",children:"All Stocks"}),Y.map($=>e.jsx(N,{value:$,children:$},$))]})]}),e.jsxs(re,{value:y,onValueChange:b,children:[e.jsx(te,{className:"w-[180px]",children:e.jsx(ne,{placeholder:"Process"})}),e.jsxs(ae,{children:[e.jsx(N,{value:"all",children:"All Processes"}),G.map($=>e.jsx(N,{value:$,children:$},$))]})]}),e.jsxs(re,{value:T,onValueChange:O,children:[e.jsx(te,{className:"w-[180px]",children:e.jsx(ne,{placeholder:"Staff Name"})}),e.jsxs(ae,{children:[e.jsx(N,{value:"all",children:"All Staff"}),le.map($=>e.jsx(N,{value:$,children:$},$))]})]}),e.jsx(z,{type:"date",placeholder:"From Date",className:"w-[150px]",value:g.from,onChange:$=>w(k=>({...k,from:$.target.value}))}),e.jsx(z,{type:"date",placeholder:"To Date",className:"w-[150px]",value:g.to,onChange:$=>w(k=>({...k,to:$.target.value}))})]})]})})}),e.jsx(X,{children:e.jsxs(ee,{className:"pt-6",children:[l.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 p-3 bg-muted rounded-md",children:[e.jsxs("span",{className:"text-sm font-medium",children:[l.length," selected"]}),e.jsx(L,{variant:"destructive",size:"sm",onClick:Me,children:"Delete Selected"}),e.jsx(L,{variant:"outline",size:"sm",onClick:He,children:"Export Selected"})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",ve+1," to ",Math.min(ke,se)," of ",se," records"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Records per page:"}),e.jsxs(re,{value:_.toString(),onValueChange:$=>U(Number($)),children:[e.jsx(te,{className:"w-[100px]",children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(N,{value:"50",children:"50"}),e.jsx(N,{value:"100",children:"100"}),e.jsx(N,{value:"500",children:"500"})]})]})]})]}),e.jsx("div",{className:"border rounded-md",children:e.jsx("div",{className:"overflow-auto",style:{maxHeight:"600px"},children:e.jsx(tt,{data:R(je.map($=>({...$,formattedDateAssigned:new Date($.date_assigned).toLocaleDateString("en-GB"),formattedDateCompleted:$.date_completed?new Date($.date_completed).toLocaleDateString("en-GB"):"-"}))),columns:[{key:"task_id",label:"Task ID",sortable:!0,dataType:"string"},{key:"stock_name",label:"Stock Name",sortable:!0,dataType:"string"},{key:"stock_source",label:"Stock Source",sortable:!0,dataType:"string"},{key:"formattedDateAssigned",label:"Date Assigned",sortable:!0,dataType:"date"},{key:"process_name",label:"Process",sortable:!0,dataType:"string"},{key:"assigned_quantity",label:"Assigned Qty",sortable:!0,dataType:"number",align:"right",headerClassName:"bg-purple-50",cellClassName:"bg-purple-50 font-medium"},{key:"staff_name",label:"Staff Name",sortable:!0,dataType:"string"},{key:"formattedDateCompleted",label:"Date Completed",sortable:!0,dataType:"date"},{key:"completed_quantity",label:"Completed Qty",sortable:!0,dataType:"number",align:"right",headerClassName:"bg-green-50",cellClassName:"bg-green-50 font-medium"},{key:"wastage_quantity",label:"Wastage Qty",sortable:!0,dataType:"number",align:"right"},{key:"remarks",label:"Remarks",sortable:!0,dataType:"string"},{key:"status",label:"Status",sortable:!0,dataType:"string",formatter:$=>e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${$==="completed"?"bg-green-100 text-green-800":$==="in_progress"?"bg-yellow-100 text-yellow-800":$==="pending"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:$==="in_progress"?"In Progress":$.charAt(0).toUpperCase()+$.slice(1)})}],onSort:H,currentSort:E,loading:C,maxHeight:"none",stickyHeader:!0,bordered:!1,searchable:!1,selectable:!0,selectedRows:l,onSelectionChange:u,rowKey:"$id",actions:[wt.edit($=>Ue($)),wt.delete($=>Ae($))],emptyMessage:"No pre-production tasks found"})})}),ye>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx(L,{variant:"outline",size:"sm",onClick:()=>D($=>Math.max(1,$-1)),disabled:P===1,children:"Previous"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",P," of ",ye]})}),e.jsx(L,{variant:"outline",size:"sm",onClick:()=>D($=>Math.min(ye,$+1)),disabled:P===ye,children:"Next"})]})]})}),e.jsx(pc,{isOpen:t,onClose:()=>{a(!1),i(null)},onSubmit:Se,editingTask:n,isLoading:S.isPending||h.isPending})]})},fc=({items:r,onItemsChange:s,availableStocks:t,isLoading:a=!1})=>{const n=()=>{const c={stock_id:"",stock_name:"",quantity:0,action:""};s([...r,c])},i=c=>{const o=r.filter((d,x)=>x!==c);s(o)},l=(c,o,d)=>{const x=[...r];if(x[c]={...x[c],[o]:d},o==="stock_id"){const y=t.find(b=>b.$id===d);x[c].stock_name=y?.stock_name||""}s(x)},u=()=>r.reduce((c,o)=>c+(o.quantity||0),0);return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(q,{className:"text-xs font-medium",children:"Stock Items"}),e.jsxs(L,{type:"button",variant:"outline",size:"sm",onClick:n,disabled:a,className:"h-7 px-2 text-xs",children:[e.jsx(vs,{className:"h-3 w-3 mr-1"}),"Add Row"]})]}),r.length===0?e.jsxs("div",{className:"text-center py-4 text-muted-foreground border-2 border-dashed rounded-lg",children:[e.jsx("p",{className:"text-xs",children:"No stock items added"}),e.jsx("p",{className:"text-xs",children:'Click "Add Row" to add stock items'})]}):e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsx("div",{className:"max-h-64 overflow-y-auto",children:e.jsxs(ps,{children:[e.jsx(xs,{className:"sticky top-0 bg-white z-10",children:e.jsxs(De,{children:[e.jsx(Z,{className:"text-xs py-2",children:"Stock Name"}),e.jsx(Z,{className:"text-xs py-2 w-24",children:"Qty (kg)"}),e.jsx(Z,{className:"text-xs py-2 w-20",children:"Action"}),e.jsx(Z,{className:"text-xs py-2 w-12",children:"Remove"})]})}),e.jsx(gs,{children:r.map((c,o)=>e.jsxs(De,{className:"h-10",children:[e.jsx(W,{className:"py-1",children:e.jsxs(re,{value:c.stock_id,onValueChange:d=>l(o,"stock_id",d),disabled:a,children:[e.jsx(te,{className:"h-7 text-xs",children:e.jsx(ne,{placeholder:"Select Stock"})}),e.jsx(ae,{children:t.map(d=>e.jsxs(N,{value:d.$id||"",children:[d.stock_name," (",d.stock_code,")"]},d.$id))})]})}),e.jsx(W,{className:"py-1",children:e.jsx(z,{type:"number",step:"0.01",min:"0",value:c.quantity||"",onChange:d=>l(o,"quantity",parseFloat(d.target.value)||0),placeholder:"0",disabled:a,className:"h-7 text-xs",maxLength:10})}),e.jsx(W,{className:"py-1",children:e.jsx(z,{value:c.action||"",onChange:d=>l(o,"action",d.target.value),placeholder:"Action",disabled:a,className:"h-7 text-xs"})}),e.jsx(W,{className:"py-1",children:e.jsx(L,{type:"button",variant:"ghost",size:"sm",className:"h-6 w-6 p-0 text-red-500 hover:text-red-700 hover:bg-red-50",onClick:()=>i(o),disabled:a,children:e.jsx($s,{className:"h-3 w-3"})})})]},o))})]})})}),r.length>0&&e.jsx("div",{className:"flex justify-end bg-gray-50 px-3 py-1 rounded",children:e.jsxs("div",{className:"text-xs font-medium",children:["Total Quantity: ",u().toFixed(2)," kg"]})})]})},Fn=(r,s,t,a={})=>{const n=ns(),i=ha(n),l=a.enabled??!0,u=r?Ge(r):void 0,c=s?Ge(s):void 0,o=u?Gs(u,1):void 0,d=u?$e(u,"yyyy-MM-dd"):void 0,x=c?$e(c,"yyyy-MM-dd"):void 0,y=o?$e(o,"yyyy-MM-dd"):void 0,b=i.standardizeParams({startDate:r,endDate:s,processId:t,forceRefresh:a.forceRefresh||a.rtqvMode}),T=(ke,je,Se=!0)=>{const Ue=l&&Se,Ae={queryKey:ke,queryFn:je,enabled:Ue};return a.rtqvMode||a.forceRefresh?{...Ae,...i.createRTQVQueryOptions(ke,b),enabled:Ue}:Ae},{data:O,isLoading:g,error:w}=de(T(["stocks"],()=>ws.getAll())),{data:P,isLoading:D,error:_}=de(T(["processes"],()=>Us.getAll())),{data:U,isLoading:Q,error:C}=de(T(["rawProducts"],()=>lt.getAll())),{data:B,isLoading:A,error:S}=de(T(["products"],()=>Rs.getAll())),{data:h,isLoading:F,error:v,refetch:I}=de(T(["productionTasks",b.startDate,b.endDate,b.processId],()=>qs.getProductionTasksWithRelations(d,x,t),!!O&&!!P)),{data:p,isLoading:E,error:H}=de(T(["productionTasksBefore",y,b.processId],()=>qs.getProductionTasksWithRelations(void 0,y,t),!!O&&!!P&&!!o)),{data:R,isLoading:M,error:K,refetch:Y}=de(T(["postProductionTasks",b.startDate,b.endDate],()=>Ws.getPostProductionTasksWithRelations(),!!O&&!!P)),G=m.useMemo(()=>{if(!l)return[];if(!O||!P||!h||!U||!B)return[];const ke=P.filter(k=>{const pe=k.process_name?.toLowerCase(),fe=k.category||k.process_category;return!!(fe&&fe.toLowerCase()==="production"||pe&&["grinding","blending"].includes(pe))}),je=new Map(ke.map(k=>[k.$id,k.process_name])),Se=new Map(U.map(k=>[k.$id,k])),Ue=k=>{const pe=B.find(Te=>Te.$id===k);if(!pe)return null;const fe=pe.product_name||pe.Product_Name||pe.name||pe.product;if(!fe)return null;let we=U.find(Te=>Te.raw_product?.toLowerCase()===fe.toLowerCase());return we||(we=U.find(Te=>{const _e=Te.raw_product?.toLowerCase()||"",Le=fe.toLowerCase();return _e.includes(Le)||Le.includes(_e)})),we},Ae=new Map,Me=k=>{if(!k)return!u&&!c;if(!u&&!c)return!0;const pe=Ge(k),fe=u?pe>=u:!0,we=c?pe<=c:!0;return fe&&we},He=k=>!k||!o?!1:Ge(k)<=o,$=new Set(ke.map(k=>k.$id));return(p||[]).filter(k=>$.has(k.process_id)).forEach(k=>{const pe=`${k.raw_product_id}-${k.process_id}`,fe=Array.isArray(k.stock_items)?k.stock_items.reduce((Le,j)=>Le+(Number(j.quantity)||0),0):0,we=k.assigned_quantity!==void 0&&k.assigned_quantity!==null?Number(k.assigned_quantity):fe,Te=Number(k.wastage_quantity)||0,_e=we-Te;Ae.has(pe)?Ae.get(pe).opening_balance+=_e:Ae.set(pe,{stock_name:k.raw_product_name||"Unknown",process:je.get(k.process_id)||"Unknown",opening_balance:_e,assigned:0,effective_completed:0,wastage_qty:0,utilised:0,closing_balance:0})}),h.filter(k=>$.has(k.process_id)).forEach(k=>{const pe=`${k.raw_product_id}-${k.process_id}`,fe=Array.isArray(k.stock_items)?k.stock_items.reduce((Le,j)=>Le+(Number(j.quantity)||0),0):0,we=k.assigned_quantity!==void 0&&k.assigned_quantity!==null?Number(k.assigned_quantity):fe,Te=Number(k.wastage_quantity)||0,_e=we-Te;if(Ae.has(pe)){const Le=Ae.get(pe);Le.assigned+=we,Le.wastage_qty+=Te,Le.effective_completed+=_e}else Ae.set(pe,{stock_name:k.raw_product_name||"Unknown",process:je.get(k.process_id)||"Unknown",opening_balance:0,assigned:we,effective_completed:_e,wastage_qty:Te,utilised:0,closing_balance:0})}),Ae.forEach((k,pe)=>{const[fe,we]=pe.split("-"),Te=(R||[]).filter(_e=>{const Le=_e.source_process_id===we,j=Ue(_e.product_id),ce=j&&j.$id===fe,Ne=He(_e.date_assigned)||He(_e.date_completed);return Le&&ce&&Ne}).reduce((_e,Le)=>_e+(Number(Le.source_quantity)||0),0);k.opening_balance=Math.max(0,(k.opening_balance||0)-Te)}),Ae.forEach((k,pe)=>{const[fe,we]=pe.split("-");Se.get(fe);const Te=(R||[]).filter(_e=>{const Le=_e.source_process_id===we,j=Ue(_e.product_id),ce=j&&j.$id===fe,Ne=Me(_e.date_assigned)||Me(_e.date_completed);return Le&&ce&&Ne}).reduce((_e,Le)=>{const j=Number(Le.source_quantity)||0;return _e+j},0);k.utilised=Te}),Ae.forEach((k,pe)=>{k.closing_balance=k.opening_balance+k.effective_completed-k.utilised;const[fe]=pe.split("-"),we=Se.get(fe),Te=we&&(we.min_level||we.minLevel)||0;k.min_level=Te;let _e="In Stock";k.closing_balance<=0?_e="Out of Stock":k.closing_balance<=Te&&(_e="Low Stock"),k.status=_e}),Array.from(Ae.values())},[O,P,h,p,R,U,B,u,c,o,l]),le=g||D||F||E||M||Q||A,se=w||_||v||H||K||C||S,ye=async()=>{(a.rtqvMode||a.forceRefresh)&&(await i.invalidateRelatedCache(b.cacheKey),i.logSyncEvent("Manual Refetch",{hook:"useProductionStatus",params:b,rtqvMode:a.rtqvMode})),await Promise.all([n.refetchQueries({queryKey:["stocks"]}),n.refetchQueries({queryKey:["processes"]}),n.refetchQueries({queryKey:["rawProducts"]}),n.refetchQueries({queryKey:["products"]}),n.refetchQueries({queryKey:["productionTasks"]}),n.refetchQueries({queryKey:["productionTasksBefore"]}),n.refetchQueries({queryKey:["postProductionTasks"]})])},ve=ke=>!ke||!G.length?{isConsistent:!0,differences:[]}:i.validateDataConsistency(G,ke);return{data:G,isLoading:le,error:se,refetch:ye,standardParams:b,rtqvMode:a.rtqvMode,validateDataConsistency:ve}},jc=[{value:"pending",label:"Pending"},{value:"in_progress",label:"In Progress"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"}],yc=({isOpen:r,onClose:s,onSubmit:t,editingTask:a,isLoading:n=!1})=>{const{data:i}=Rn(),{data:l}=Ma(),{data:u}=at(),{data:c}=qn(),o=u.filter(v=>{const I=v.department?.toLowerCase();return I&&I==="production"?!0:v.process_name?.toLowerCase()==="grinding"}),[d,x]=m.useState({task_id:"",date_assigned:new Date().toISOString().split("T")[0],raw_product_id:"",process_id:"",staff_id:"",source_process_id:"",completed_quantity:"",date_completed:"",wastage_quantity:"",remarks:"",status:"pending"}),[y,b]=m.useState([]),[T,O]=m.useState({}),[g,w]=m.useState(null),P=new Date,D=Vs(P),_=Bs(P),{data:U}=Fn(D.toISOString().split("T")[0],_.toISOString().split("T")[0],void 0,{rtqvMode:!0,forceRefresh:!0}),{data:Q}=An(D.toISOString().split("T")[0],_.toISOString().split("T")[0],void 0,{rtqvMode:!0,forceRefresh:!0}),C=()=>{if(!d.source_process_id||!y.length||!d.raw_product_id){w(null);return}const v=y.reduce((se,ye)=>se+(ye.quantity||0),0);if(v<=0){w({isValid:!1,availableQty:0,requiredQty:v,stockName:"Stock Items",stockSource:"Unknown",error:"Invalid quantity",validationClass:"bg-yellow-50 text-yellow-700 border-yellow-200",validationMessage:"Total quantity must be greater than 0"});return}const I=u?.find(se=>se.$id===d.source_process_id),p=c?.find(se=>se.$id===d.raw_product_id);if(!I||!p){w({isValid:!1,availableQty:0,requiredQty:v,stockName:p?.raw_product||"Unknown Product",stockSource:I?.process_name||"Unknown Process",error:"Missing reference data",validationClass:"bg-red-50 text-red-700 border-red-200",validationMessage:"Source process or raw product not found"});return}const E="Pre-Production Status",R=y[0]?.stock_name||p.raw_product;let M=Q?.find(se=>se.stock_name===R&&se.process===I.process_name);if(!M&&R&&(M=Q?.find(se=>se.stock_name?.toLowerCase().includes(R.toLowerCase().split("(")[0].trim())&&se.process===I.process_name)),!M){const se=R?.toLowerCase().split("(")[0].trim()||p.raw_product?.toLowerCase();M=Q?.find(ye=>ye.process===I.process_name&&ye.stock_name?.toLowerCase().includes(se))}const K=M?.closing_balance??0,Y=K>=v;console.log("ðŸ” RTQV Production Status Check (Enhanced):",{raw_product:p.raw_product,stock_name_from_items:R,source_process:I.process_name,statusRecord_found:!!M,statusRecord_stock_name:M?.stock_name,statusRecord_process:M?.process,closing_balance:M?.closing_balance,availableQty:K,totalRequiredQty:v,dataSource:E,forced_fresh:!0,stock_items:y.map(se=>({stock_name:se.stock_name,quantity:se.quantity})),all_preproduction_records:Q?.map(se=>({stock_name:se.stock_name,process:se.process,closing_balance:se.closing_balance}))});let G="",le="";Y?(G="bg-green-50 text-green-700 border-green-200",le=`âœ“ Available: ${K}kg (Required: ${v}kg)`):K===0?(G="bg-red-50 text-red-700 border-red-200",le=`âœ— Out of stock (Required: ${v}kg)`):(G="bg-orange-50 text-orange-700 border-orange-200",le=`âš  Insufficient stock: ${K}kg available (Required: ${v}kg)`),w({isValid:Y,availableQty:K,requiredQty:v,stockName:R||p.raw_product,stockSource:I.process_name,dataSource:E,isLoading:!1,validationClass:G,validationMessage:le})};m.useEffect(()=>{C()},[d.source_process_id,d.raw_product_id,y,u,c,U,Q]);const B=u.filter(v=>v.process_name==="RFP");m.useEffect(()=>{if(r)if(a)x({task_id:a.task_id||"",date_assigned:a.date||"",raw_product_id:a.raw_product_id||"",process_id:a.process_id||"",staff_id:a.staff_id||"",source_process_id:a.source_process_id||"",completed_quantity:a.completed_quantity?.toString()||"",date_completed:a.date_completed||"",wastage_quantity:a.wastage_quantity?.toString()||"",remarks:a.remarks||"",status:a.status||"pending"}),a.stock_items&&b(a.stock_items.map(v=>({stock_id:v.stock_id,stock_name:v.stock_name,quantity:v.quantity,action:v.action||""})));else{const v=`PROD${Date.now().toString().slice(-6)}`;x({task_id:v,date_assigned:new Date().toISOString().split("T")[0],raw_product_id:"",process_id:"",staff_id:"",source_process_id:"",completed_quantity:"",date_completed:"",wastage_quantity:"",remarks:"",status:"pending"}),b([])}},[a,r]);const A=()=>y.reduce((v,I)=>v+(I.quantity||0),0),S=()=>{const v={};return d.task_id.trim()||(v.task_id="Task ID is required"),d.date_assigned||(v.date_assigned="Date is required"),d.raw_product_id||(v.raw_product_id="Raw product is required"),d.process_id||(v.process_id="Process is required"),d.staff_id||(v.staff_id="Staff is required"),d.source_process_id||(v.source_process_id="Source process is required"),(!d.completed_quantity||parseFloat(d.completed_quantity)<=0)&&(v.completed_quantity="Completed quantity is required and must be greater than 0"),y.length===0&&(v.stock_items="At least one stock item is required"),d.wastage_quantity&&parseFloat(d.wastage_quantity)<0&&(v.wastage_quantity="Wastage quantity cannot be negative"),y.forEach((I,p)=>{I.stock_id||(v[`stock_item_${p}_stock`]=`Stock is required for item ${p+1}`),(!I.quantity||I.quantity<=0)&&(v[`stock_item_${p}_quantity`]=`Quantity must be greater than 0 for item ${p+1}`)}),O(v),Object.keys(v).length===0},h=v=>{if(v.preventDefault(),!S())return;const I={task_id:d.task_id,date:d.date_assigned,raw_product_id:d.raw_product_id,process_id:d.process_id,staff_id:d.staff_id,source_process_id:d.source_process_id,assigned_quantity:A(),completed_quantity:parseFloat(d.completed_quantity),wastage_quantity:d.wastage_quantity?parseFloat(d.wastage_quantity):void 0,remarks:d.remarks||void 0,status:d.status};d.date_completed&&d.date_completed.trim()!==""&&(I.date_completed=d.date_completed),t({taskData:I,stockItems:y})},F=()=>{x({task_id:"",date_assigned:new Date().toISOString().split("T")[0],raw_product_id:"",process_id:"",staff_id:"",source_process_id:"",completed_quantity:"",date_completed:"",wastage_quantity:"",remarks:"",status:"pending"}),b([]),O({}),s()};return e.jsx(as,{open:r,onOpenChange:F,children:e.jsxs(Ze,{className:"sm:max-w-[800px] max-w-[95vw] max-h-[90vh] overflow-y-auto",children:[e.jsxs(es,{className:"pb-2",children:[e.jsx(ts,{className:"text-lg",children:a?"Edit Production Task":"Add New Production Task"}),e.jsx(rs,{className:"text-sm",children:a?"Update the production task details below.":"Fill in the details to create a new production task."})]}),e.jsxs("form",{onSubmit:h,children:[e.jsxs("div",{className:"grid gap-3 py-3",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[e.jsxs("div",{children:[e.jsx(q,{htmlFor:"task_id",className:"text-xs font-medium",children:"Task ID *"}),e.jsx(z,{id:"task_id",value:d.task_id,onChange:v=>x({...d,task_id:v.target.value}),className:`h-8 text-sm ${T.task_id?"border-red-500":""}`,maxLength:15}),T.task_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:T.task_id})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"date_assigned",className:"text-xs font-medium",children:"Date *"}),e.jsx(z,{id:"date_assigned",type:"date",value:d.date_assigned,onChange:v=>x({...d,date_assigned:v.target.value}),className:`h-8 text-sm ${T.date_assigned?"border-red-500":""}`}),T.date_assigned&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:T.date_assigned})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"process_id",className:"text-xs font-medium",children:"Process *"}),e.jsxs(re,{value:d.process_id,onValueChange:v=>x({...d,process_id:v}),children:[e.jsx(te,{className:`h-8 text-sm ${T.process_id?"border-red-500":""}`,children:e.jsx(ne,{placeholder:"Select Process"})}),e.jsx(ae,{children:o.map(v=>e.jsx(N,{value:v.$id||"",children:v.process_name},v.$id))})]}),T.process_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:T.process_id})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"source_process_id",className:"text-xs font-medium",children:"Source Process *"}),e.jsxs(re,{value:d.source_process_id,onValueChange:v=>x({...d,source_process_id:v}),children:[e.jsx(te,{className:`h-8 text-sm ${T.source_process_id?"border-red-500":""}`,children:e.jsx(ne,{placeholder:"Select Source"})}),e.jsx(ae,{children:B.map(v=>e.jsx(N,{value:v.$id||"",children:v.process_name},v.$id))})]}),T.source_process_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:T.source_process_id})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(q,{htmlFor:"raw_product_id",className:"text-xs font-medium",children:"Raw Product *"}),e.jsxs(re,{value:d.raw_product_id,onValueChange:v=>x({...d,raw_product_id:v}),children:[e.jsx(te,{className:`h-8 text-sm ${T.raw_product_id?"border-red-500":""}`,children:e.jsx(ne,{placeholder:"Select Raw Product"})}),e.jsx(ae,{children:c.map(v=>e.jsx(N,{value:v.$id||"",children:v.raw_product},v.$id))})]}),T.raw_product_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:T.raw_product_id})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"staff_id",className:"text-xs font-medium",children:"Staff Name *"}),e.jsxs(re,{value:d.staff_id,onValueChange:v=>x({...d,staff_id:v}),children:[e.jsx(te,{className:`h-8 text-sm ${T.staff_id?"border-red-500":""}`,children:e.jsx(ne,{placeholder:"Select Staff"})}),e.jsx(ae,{children:l.map(v=>e.jsx(N,{value:v.$id||"",children:v.staff_name},v.$id))})]}),T.staff_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:T.staff_id})]})]}),e.jsxs("div",{children:[e.jsx(q,{className:"text-base font-semibold",children:"Stock Items"}),e.jsx(fc,{items:y,onItemsChange:b,availableStocks:i,isLoading:n}),T.stock_items&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:T.stock_items}),g&&e.jsxs("div",{className:`mt-2 p-3 rounded-md border text-sm ${g.validationClass}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("div",{className:"font-medium",children:g.stockName}),e.jsxs("div",{className:"text-xs opacity-75",children:["Source: ",g.dataSource]})]}),e.jsx("div",{className:"mb-1",children:g.validationMessage}),g.error&&e.jsxs("div",{className:"text-xs mt-1 opacity-75",children:["Error: ",g.error]}),g.isLoading&&e.jsxs("div",{className:"flex items-center gap-2 text-xs mt-1",children:[e.jsx("div",{className:"animate-spin h-3 w-3 border border-current border-t-transparent rounded-full"}),"Loading fresh data from ",g.dataSource,"..."]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(q,{htmlFor:"assigned_quantity",className:"text-xs font-medium",children:"Assigned Qty (Auto-calculated)"}),e.jsxs("div",{className:"relative",children:[e.jsx(z,{id:"assigned_quantity",type:"number",value:A().toFixed(2),disabled:!0,className:"bg-gray-50 h-8 text-sm pr-8",maxLength:10}),e.jsx("span",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-xs text-gray-500",children:"kg"})]})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"completed_quantity",className:"text-xs font-medium",children:"Completed Qty *"}),e.jsxs("div",{className:"relative",children:[e.jsx(z,{id:"completed_quantity",type:"number",step:"0.01",min:"0",value:d.completed_quantity,onChange:v=>x({...d,completed_quantity:v.target.value}),className:`h-8 text-sm pr-8 ${T.completed_quantity?"border-red-500":""}`,maxLength:10}),e.jsx("span",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-xs text-gray-500",children:"kg"})]}),T.completed_quantity&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:T.completed_quantity})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"wastage_quantity",className:"text-xs font-medium",children:"Wastage Qty"}),e.jsxs("div",{className:"relative",children:[e.jsx(z,{id:"wastage_quantity",type:"number",step:"0.01",min:"0",value:d.wastage_quantity,onChange:v=>x({...d,wastage_quantity:v.target.value}),className:`h-8 text-sm pr-8 ${T.wastage_quantity?"border-red-500":""}`,maxLength:10}),e.jsx("span",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-xs text-gray-500",children:"kg"})]}),T.wastage_quantity&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:T.wastage_quantity})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(q,{htmlFor:"date_completed",className:"text-xs font-medium",children:"Date Completed"}),e.jsx(z,{id:"date_completed",type:"date",value:d.date_completed,onChange:v=>x({...d,date_completed:v.target.value}),className:"h-8 text-sm"})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"status",className:"text-xs font-medium",children:"Status"}),e.jsxs(re,{value:d.status,onValueChange:v=>x({...d,status:v}),children:[e.jsx(te,{className:"h-8 text-sm",children:e.jsx(ne,{})}),e.jsx(ae,{children:jc.map(v=>e.jsx(N,{value:v.value,children:v.label},v.value))})]})]})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"remarks",className:"text-xs font-medium",children:"Remarks"}),e.jsx(et,{id:"remarks",value:d.remarks,onChange:v=>x({...d,remarks:v.target.value}),placeholder:"Enter any remarks",rows:2,className:"text-sm resize-none"})]})]}),e.jsxs(ss,{className:"pt-3 flex-col sm:flex-row gap-2",children:[e.jsx(L,{type:"button",variant:"outline",onClick:F,className:"h-8 px-4 text-sm w-full sm:w-auto",children:"Cancel"}),e.jsx(L,{type:"submit",disabled:n,className:"h-8 px-4 text-sm w-full sm:w-auto",children:n?"Saving...":a?"Update":"Save"})]})]})]})})},vc=()=>{const[r,s]=m.useState(""),[t,a]=m.useState(!1),[n,i]=m.useState(null),[l,u]=m.useState([]),[c,o]=m.useState({show:!1,message:"",type:"success"}),[d,x]=m.useState("all"),[y,b]=m.useState("all"),[T,O]=m.useState("all"),[g,w]=m.useState({from:"",to:""}),[P,D]=m.useState(1),[_,U]=m.useState(50),{tasks:Q,isLoading:C,error:B,refetch:A}=Pn(),{createTask:S,updateTask:h,deleteTask:F}=Fl(),{config:v}=_s("production-tasks"),{validationRules:I,canImport:p}=ks("production-tasks"),{currentSort:E,handleSort:H,getSortedData:R}=Zs();at();const M=($,k)=>{o({show:!0,message:$,type:k}),setTimeout(()=>o({show:!1,message:"",type:"success"}),3e3)},K=Q.filter($=>{const k=$.task_id.toLowerCase().includes(r.toLowerCase())||$.raw_product_name.toLowerCase().includes(r.toLowerCase())||$.staff_name.toLowerCase().includes(r.toLowerCase())||$.process_name.toLowerCase().includes(r.toLowerCase()),pe=d==="all"||$.raw_product_name.toLowerCase().includes(d.toLowerCase()),fe=y==="all"||$.process_name.toLowerCase().includes(y.toLowerCase()),we=T==="all"||$.staff_name.toLowerCase().includes(T.toLowerCase()),Te=(!g.from||$.date>=g.from)&&(!g.to||$.date<=g.to);return k&&pe&&fe&&we&&Te}),Y=Array.from(new Set(Q.map($=>$.raw_product_name))).sort(),G=Array.from(new Set(Q.map($=>$.process_name))).sort(),le=Array.from(new Set(Q.map($=>$.staff_name))).sort(),se=K.length,ye=Math.ceil(se/_),ve=(P-1)*_,ke=ve+_,je=K.slice(ve,ke);m.useEffect(()=>{D(1)},[r,d,y,T,g,_]);const Se=async $=>{try{n?(await h.mutateAsync({id:n.$id,taskData:$.taskData,stockItems:$.stockItems}),M("Production task updated successfully","success")):(await S.mutateAsync($),M("Production task created successfully","success")),a(!1),i(null)}catch(k){console.error("Error saving task:",k),M("Failed to save task","error")}},Ue=$=>{i($),a(!0)},Ae=async $=>{if(window.confirm("Are you sure you want to delete this task?"))try{await F.mutateAsync($.$id),M("Production task deleted successfully","success")}catch(k){console.error("Error deleting task:",k),M("Failed to delete task","error")}},Me=async()=>{if(l.length===0){M("Please select tasks to delete","error");return}if(window.confirm(`Are you sure you want to delete ${l.length} selected task(s)?`))try{await Promise.all(l.map($=>F.mutateAsync($.$id))),u([]),M(`${l.length} tasks deleted successfully`,"success")}catch($){console.error("Error deleting tasks:",$),M("Failed to delete selected tasks","error")}},He=()=>{if(l.length===0){M("Please select tasks to export","error");return}M(`Exporting ${l.length} selected task(s)...`,"success")};return B?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Production Tasks"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage production processing tasks"})]}),e.jsx(X,{children:e.jsx(ee,{className:"pt-6",children:e.jsxs("div",{className:"text-center py-12 text-red-600",children:[e.jsx("p",{className:"text-lg mb-2",children:"Error loading tasks"}),e.jsx("p",{className:"text-sm mb-4",children:B.message}),e.jsx(L,{onClick:()=>A(),variant:"outline",children:"Retry"})]})})})]}):e.jsxs("div",{className:"space-y-6",children:[c.show&&e.jsx("div",{className:`fixed top-4 right-4 px-4 py-2 rounded-md shadow-lg z-50 ${c.type==="success"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300"}`,children:c.message}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Production Tasks"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage production processing tasks"})]}),e.jsxs(L,{className:"bg-primary hover:bg-primary/90 w-full sm:w-auto",onClick:()=>{i(null),a(!0)},children:[e.jsx(vs,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"sm:inline",children:"Add New"})]})]}),e.jsx(X,{children:e.jsx(ee,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4 items-stretch sm:items-center",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(os,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(z,{placeholder:"Search tasks...",className:"pl-10",value:r,onChange:$=>s($.target.value)})]}),p&&v&&e.jsx(ys,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:v.exportColumns.filter($=>$.required).map($=>$.exportHeader),optionalColumns:v.exportColumns.filter($=>!$.required).map($=>$.exportHeader),validationRules:I,onImportComplete:$=>{$.successfulRows>0&&(A(),M(`${$.successfulRows} production tasks imported successfully.`,"success"))}},variant:"outline"}),v&&e.jsx(js,{data:K.map($=>{const k={};return v.exportColumns.forEach(pe=>{const fe=$[pe.dataKey];k[pe.exportHeader]=pe.formatter?pe.formatter(fe):fe}),k}),headers:v.exportColumns.map($=>$.exportHeader),filename:"production-tasks",variant:"outline"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-3 sm:gap-4",children:[e.jsxs(re,{value:d,onValueChange:x,children:[e.jsx(te,{className:"w-full",children:e.jsx(ne,{placeholder:"Raw Product"})}),e.jsxs(ae,{children:[e.jsx(N,{value:"all",children:"All Raw Products"}),Y.map($=>e.jsx(N,{value:$,children:$},$))]})]}),e.jsxs(re,{value:y,onValueChange:b,children:[e.jsx(te,{className:"w-full",children:e.jsx(ne,{placeholder:"Process"})}),e.jsxs(ae,{children:[e.jsx(N,{value:"all",children:"All Processes"}),G.map($=>e.jsx(N,{value:$,children:$},$))]})]}),e.jsxs(re,{value:T,onValueChange:O,children:[e.jsx(te,{className:"w-full",children:e.jsx(ne,{placeholder:"Staff Name"})}),e.jsxs(ae,{children:[e.jsx(N,{value:"all",children:"All Staff"}),le.map($=>e.jsx(N,{value:$,children:$},$))]})]}),e.jsx(z,{type:"date",placeholder:"From Date",className:"w-full",value:g.from,onChange:$=>w(k=>({...k,from:$.target.value}))}),e.jsx(z,{type:"date",placeholder:"To Date",className:"w-full",value:g.to,onChange:$=>w(k=>({...k,to:$.target.value}))})]})]})})}),e.jsx(X,{children:e.jsxs(ee,{className:"pt-6",children:[l.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 p-3 bg-muted rounded-md",children:[e.jsxs("span",{className:"text-sm font-medium",children:[l.length," selected"]}),e.jsx(L,{variant:"destructive",size:"sm",onClick:Me,children:"Delete Selected"}),e.jsx(L,{variant:"outline",size:"sm",onClick:He,children:"Export Selected"})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",ve+1," to ",Math.min(ke,se)," of ",se," records"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Records per page:"}),e.jsxs(re,{value:_.toString(),onValueChange:$=>U(Number($)),children:[e.jsx(te,{className:"w-[100px]",children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(N,{value:"50",children:"50"}),e.jsx(N,{value:"100",children:"100"}),e.jsx(N,{value:"500",children:"500"})]})]})]})]}),e.jsx("div",{className:"border rounded-md",children:e.jsx("div",{className:"overflow-auto",style:{maxHeight:"600px"},children:e.jsx(tt,{data:R(je.map($=>({...$,formattedDate:new Date($.date).toLocaleDateString("en-GB")}))),columns:[{key:"task_id",label:"Task ID",sortable:!0,dataType:"string"},{key:"formattedDate",label:"Date",sortable:!0,dataType:"date"},{key:"raw_product_name",label:"Raw Product",sortable:!0,dataType:"string"},{key:"process_name",label:"Process",sortable:!0,dataType:"string"},{key:"staff_name",label:"Staff Name",sortable:!0,dataType:"string"},{key:"assigned_quantity",label:"Assigned Qty",sortable:!0,dataType:"number",align:"right",headerClassName:"bg-purple-50",cellClassName:"bg-purple-50 font-medium"},{key:"completed_quantity",label:"Completed Qty",sortable:!0,dataType:"number",align:"right",headerClassName:"bg-green-50",cellClassName:"bg-green-50 font-medium"},{key:"wastage_quantity",label:"Wastage Qty",sortable:!0,dataType:"number",align:"right"},{key:"status",label:"Status",sortable:!0,dataType:"string",formatter:$=>e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${$==="completed"?"bg-green-100 text-green-800":$==="in_progress"?"bg-yellow-100 text-yellow-800":$==="pending"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:$==="in_progress"?"In Progress":$.charAt(0).toUpperCase()+$.slice(1)})}],onSort:H,currentSort:E,loading:C,maxHeight:"none",stickyHeader:!0,bordered:!1,searchable:!1,selectable:!0,selectedRows:l,onSelectionChange:u,rowKey:"$id",actions:[wt.edit($=>Ue($)),wt.delete($=>Ae($))],emptyMessage:"No production tasks found"})})}),ye>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx(L,{variant:"outline",size:"sm",onClick:()=>D($=>Math.max(1,$-1)),disabled:P===1,children:"Previous"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",P," of ",ye]})}),e.jsx(L,{variant:"outline",size:"sm",onClick:()=>D($=>Math.min(ye,$+1)),disabled:P===ye,children:"Next"})]})]})}),e.jsx(yc,{isOpen:t,onClose:()=>{a(!1),i(null)},onSubmit:Se,editingTask:n,isLoading:S.isPending||h.isPending})]})},bc=(r,s,t,a={})=>{const n=ns(),i=ha(n),l=r?Ge(r):void 0,u=s?Ge(s):void 0,c=a.enabled??!0,o=i.standardizeParams({startDate:r,endDate:s,processId:t,forceRefresh:a.forceRefresh||a.rtqvMode}),d=(C,B,A)=>{const S={queryKey:C,queryFn:B,staleTime:A||3e5};return a.rtqvMode||a.forceRefresh?{...S,...i.createRTQVQueryOptions(C,o)}:S},{data:x=[],isLoading:y}=de(d([...Ls.products],()=>Rs.getAll())),{data:b=[],isLoading:T}=de(d([...Ls.processes],()=>Us.getAll())),{data:O=[],isLoading:g}=de(d([...Ls.postProductionTasks],()=>Ws.getAll(),1*60*1e3)),{data:w=[],isLoading:P}=de(d([...Ls.salesUnits()],()=>zs.getAll(),1*60*1e3)),D=m.useMemo(()=>{if(!c)return[];if(!x.length||!b.length)return[];l&&Gs(l,1);const C=b.filter(A=>{const S=A.process_name?.toLowerCase(),h=A.category||A.process_category;if(h&&h.toLowerCase()==="post-production")return!0;const F=A.department?.toLowerCase();return!!(F&&(F.includes("post")||F.includes("packaging")||F.includes("finishing"))||S&&["packing","batch coding"].includes(S))}),B=[];return x.forEach(A=>{C.forEach(S=>{const h=A.product_name||A.product,F=S.process_name,v=A.sku||A.$id;if(!h||!F)return;const I=O.filter(G=>G.product_id===A.$id),p=G=>{if(!G||!l||!u)return!1;const le=Ge(G);return le>=l&&le<=u},E=G=>!G||!l?!1:Ge(G)<l,H=I.filter(G=>G.process_id===S.$id&&G.status==="completed"&&E(G.date_completed||G.date_assigned)).reduce((G,le)=>G+(le.units??0),0),R=I.filter(G=>G.process_id===S.$id&&G.status==="completed"&&p(G.date_completed||G.date_assigned)).reduce((G,le)=>G+(le.units??0),0);let M=0;const K=O.filter(G=>G.product_id===A.$id&&G.source_process_id===S.$id&&p(G.date_assigned||G.date_completed)).reduce((G,le)=>{const se=Number(le.units)||0;return G+se},0);let Y=0;F.toLowerCase()==="batch coding"&&(Y=w.filter(G=>G.product_id===A.$id&&p(G.date_sold||G.$createdAt)).reduce((G,le)=>{const se=Number(le.units_sold)||0;return G+se},0)),M=K+Y,(H>0||R>0||M>0)&&B.push({sku:v,product_name:h,process_name:F,opening_balance:H,completed_units:R,utilised:M,closing_balance:H+R-M,status:"active"})})}),B},[x,b,O,w,t,l,u,c]),_=y||T||g||P,U=async()=>{(a.rtqvMode||a.forceRefresh)&&(await i.invalidateRelatedCache(o.cacheKey),i.logSyncEvent("Manual Refetch",{hook:"usePostProductionStatus",params:o,rtqvMode:a.rtqvMode})),await Promise.all([n.refetchQueries({queryKey:Ls.products}),n.refetchQueries({queryKey:Ls.processes}),n.refetchQueries({queryKey:Ls.postProductionTasks}),n.refetchQueries({queryKey:Ls.salesUnits()})])},Q=C=>!C||!D.length?{isConsistent:!0,differences:[]}:i.validateDataConsistency(D,C);return{data:D,isLoading:_,error:null,refetch:U,standardParams:o,rtqvMode:a.rtqvMode,validateDataConsistency:Q}},Nc=[{value:"pending",label:"Pending"},{value:"in_progress",label:"In Progress"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"}],wc=({isOpen:r,onClose:s,onSubmit:t,editingTask:a,isLoading:n=!1})=>{const{data:i}=Ma(),{data:l}=at(),{data:u}=rc(),{data:c}=qn(),[o,d]=m.useState({task_id:"",date_assigned:new Date().toISOString().split("T")[0],date_completed:"",raw_product_id:"",source_process_id:"",source_quantity:"",sku:"",product_id:"",process_id:"",staff_id:"",completed_quantity:"",wastage_quantity:"",remarks:"",status:"pending"}),[x,y]=m.useState({}),[b,T]=m.useState(null),O=new Date,g=Vs(O),w=Bs(O),{data:P}=bc(g.toISOString().split("T")[0],w.toISOString().split("T")[0],void 0,{rtqvMode:!0,forceRefresh:!0}),{data:D}=Fn(g.toISOString().split("T")[0],w.toISOString().split("T")[0],void 0,{rtqvMode:!0,forceRefresh:!0}),_=()=>{if(!o.source_process_id||!o.source_quantity||!o.product_id){T(null);return}const p=parseFloat(o.source_quantity);if(p<=0){T({isValid:!1,availableQty:0,requiredQty:p,stockName:"Source Material",stockSource:"Unknown",error:"Invalid quantity",validationClass:"bg-yellow-50 text-yellow-700 border-yellow-200",validationMessage:"Source quantity must be greater than 0"});return}const E=l?.find(ve=>ve.$id===o.source_process_id),H=u?.find(ve=>ve.$id===o.product_id);if(!E||!H){T({isValid:!1,availableQty:0,requiredQty:p,stockName:H?.product_name||"Unknown Product",stockSource:E?.process_name||"Unknown Process",error:"Missing reference data",validationClass:"bg-red-50 text-red-700 border-red-200",validationMessage:"Source process or product not found"});return}let R="",M=null,K=0;const Y=E.process_name?.toLowerCase();if(Y==="grinding"){R="Production Status";const ve=H.product_name;if(M=D?.find(ke=>ke.stock_name===ve&&ke.process===E.process_name),!M&&ve){const ke=ve.toLowerCase().split(" ")[0];M=D?.find(je=>je.stock_name?.toLowerCase().includes(ke)&&je.process===E.process_name)}M||(M=D?.find(ke=>ke.process===E.process_name&&(ke.stock_name?.toLowerCase().includes("chilli")||ke.stock_name?.toLowerCase().includes("powder"))))}else Y==="packing"&&(R="Post-Production Status",M=P?.find(ve=>ve.product_name===H.product_name&&ve.process_name===E.process_name));K=M?.closing_balance??0;const G=K>=p;console.log("ðŸ” RTQV Post-Production Status Check (Enhanced):",{product_name:H.product_name,source_process:E.process_name,source_process_type:Y,statusRecord_found:!!M,statusRecord_stock_name:M?.stock_name,statusRecord_process:M?.process,closing_balance:M?.closing_balance,availableQty:K,requiredQty:p,dataSource:R,forced_fresh:!0,all_production_records:Y==="grinding"?D?.map(ve=>({stock_name:ve.stock_name,process:ve.process,closing_balance:ve.closing_balance})):[],all_postproduction_records:Y==="packing"?P?.map(ve=>({product_name:ve.product_name,process_name:ve.process_name,closing_balance:ve.closing_balance})):[]});let le="",se="";const ye=Y==="grinding"?"kg":"units";G?(le="bg-green-50 text-green-700 border-green-200",se=`âœ“ Available: ${K}${ye} (Required: ${p}${ye})`):K===0?(le="bg-red-50 text-red-700 border-red-200",se=`âœ— Out of stock (Required: ${p}${ye})`):(le="bg-orange-50 text-orange-700 border-orange-200",se=`âš  Insufficient stock: ${K}${ye} available (Required: ${p}${ye})`),T({isValid:G,availableQty:K,requiredQty:p,stockName:H.product_name,stockSource:E.process_name,dataSource:R,isLoading:!1,validationClass:le,validationMessage:se})};m.useEffect(()=>{_()},[o.source_process_id,o.product_id,o.source_quantity,l,u,P,D]);const U=l.filter(p=>{const E=p.department?.toLowerCase();if(E&&E==="post-production")return!0;const H=p.process_name?.toLowerCase();return["packing","batch coding"].includes(H)});console.log("All Processes:",l.map(p=>p.process_name)),console.log("Post Production Processes:",U.map(p=>p.process_name));const Q=l.find(p=>p.$id===o.process_id),C=Q?.process_name==="Batch Coding",B=Q?.process_name==="Packing",A=()=>C,h=(()=>{if(!o.process_id)return[];const p=l.find(H=>H.$id===o.process_id);if(!p)return[];const E=p.process_name?.toLowerCase();return E==="packing"?l.filter(H=>H.process_name?.toLowerCase()==="grinding"):E==="batch coding"?l.filter(H=>H.process_name?.toLowerCase()==="packing"):[]})();m.useEffect(()=>{o.process_id&&(d(p=>({...p,source_process_id:"",source_quantity:C?"":p.source_quantity,raw_product_id:C?"":p.raw_product_id})),console.log("Selected Process:",Q?.process_name),console.log("Is Batch Coding:",C))},[o.process_id,l,C,Q]),m.useEffect(()=>{if(r)if(a){const p=E=>{if(!E)return"";try{const H=new Date(E);return isNaN(H.getTime())?"":H.toISOString().split("T")[0]}catch{return""}};d({task_id:a.task_id,date_assigned:p(a.date),date_completed:p(a.date_completed||""),raw_product_id:a.raw_product_id||"",source_process_id:a.source_process_id,source_quantity:a.source_quantity.toString(),sku:a.sku,product_id:a.product_id,process_id:a.process_id,staff_id:a.staff_id,completed_quantity:a.units?.toString()||"",wastage_quantity:a.wastage_quantity?.toString()||"",remarks:a.remarks||"",status:a.status})}else{const p=`POST${Date.now().toString().slice(-6)}`;d({task_id:p,date_assigned:new Date().toISOString().split("T")[0],date_completed:"",raw_product_id:"",source_process_id:"",source_quantity:"",sku:"",product_id:"",process_id:"",staff_id:"",completed_quantity:"",wastage_quantity:"",remarks:"",status:"pending"})}},[a,r]);const F=()=>{const p={},H=l.find(R=>R.$id===o.process_id)?.process_name==="Batch Coding";return o.task_id.trim()||(p.task_id="Task ID is required"),o.date_assigned||(p.date_assigned="Date is required"),!H&&!o.raw_product_id&&(p.raw_product_id="Raw Product is required"),o.process_id||(p.process_id="Process is required"),o.source_process_id||(p.source_process_id="Source process is required"),!H&&(!o.source_quantity||parseFloat(o.source_quantity)<=0)&&(p.source_quantity="Source quantity must be greater than 0"),o.sku.trim()||(p.sku="SKU is required"),o.product_id||(p.product_id="Product is required"),o.staff_id||(p.staff_id="Staff is required"),o.status==="completed"&&((!o.completed_quantity||parseFloat(o.completed_quantity)<=0)&&(p.completed_quantity="Completed units must be greater than 0"),o.wastage_quantity&&parseFloat(o.wastage_quantity)<0&&(p.wastage_quantity="Wastage quantity cannot be negative")),y(p),Object.keys(p).length===0},v=p=>{if(p.preventDefault(),!F())return;const H=l.find(M=>M.$id===o.process_id)?.process_name==="Batch Coding",R={task_id:o.task_id,date:o.date_assigned,date_completed:o.status==="completed"?o.date_completed:void 0,source_process_id:o.source_process_id,source_quantity:H?0:parseFloat(o.source_quantity)||0,sku:o.sku,product_id:o.product_id,process_id:o.process_id,staff_id:o.staff_id,units:o.completed_quantity?parseFloat(o.completed_quantity):0,wastage_quantity:o.status==="completed"&&o.wastage_quantity?parseFloat(o.wastage_quantity):void 0,remarks:o.remarks||void 0,status:o.status};console.log("ðŸš€ SUBMITTING POST-PRODUCTION TASK DATA:",R),t(R)},I=()=>{d({task_id:"",date_assigned:new Date().toISOString().split("T")[0],date_completed:"",raw_product_id:"",source_process_id:"",source_quantity:"",sku:"",product_id:"",process_id:"",staff_id:"",completed_quantity:"",wastage_quantity:"",remarks:"",status:"pending"}),y({}),s()};return e.jsx(as,{open:r,onOpenChange:I,children:e.jsxs(Ze,{className:"sm:max-w-[600px] max-w-[95vw] max-h-[90vh] overflow-y-auto",children:[e.jsxs(es,{children:[e.jsx(ts,{children:a?"Edit Post-Production Task":"Add New Post-Production Task"}),e.jsx(rs,{children:a?"Update the post-production task details below.":"Fill in the details to create a new post-production task."})]}),e.jsxs("form",{onSubmit:v,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(q,{htmlFor:"task_id",children:"Task ID *"}),e.jsx(z,{id:"task_id",value:o.task_id,onChange:p=>d({...o,task_id:p.target.value}),className:x.task_id?"border-red-500":""}),x.task_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:x.task_id})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"date_assigned",children:"Date Assigned *"}),e.jsx(z,{id:"date_assigned",type:"date",value:o.date_assigned,onChange:p=>d({...o,date_assigned:p.target.value}),className:x.date_assigned?"border-red-500":""}),x.date_assigned&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:x.date_assigned})]})]}),e.jsxs("div",{children:[e.jsxs(q,{htmlFor:"raw_product_id",children:["Raw Product ",!C&&"*",C&&e.jsx("span",{className:"text-muted-foreground",children:"(N/A for Batch Coding)"})]}),C?e.jsx(z,{value:"N/A",disabled:!0,className:"bg-gray-100 text-muted-foreground"}):e.jsxs(re,{value:o.raw_product_id,onValueChange:p=>d({...o,raw_product_id:p}),children:[e.jsx(te,{className:x.raw_product_id?"border-red-500":"",children:e.jsx(ne,{placeholder:"Select Raw Product"})}),e.jsx(ae,{children:c?.map(p=>e.jsx(N,{value:p.$id||"",children:p.raw_product},p.$id))})]}),x.raw_product_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:x.raw_product_id}),e.jsx("p",{className:"text-muted-foreground text-xs mt-1",children:C?"Batch Coding works with finished products (units), not raw products":"Select the raw product powder (kg) from Grinding process to be packed into units"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(q,{htmlFor:"process_id",children:"Process *"}),e.jsxs(re,{value:o.process_id,onValueChange:p=>d({...o,process_id:p,source_process_id:""}),children:[e.jsx(te,{className:x.process_id?"border-red-500":"",children:e.jsx(ne,{placeholder:"Select Process"})}),e.jsx(ae,{children:U.map(p=>e.jsx(N,{value:p.$id||"",children:p.process_name},p.$id))})]}),x.process_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:x.process_id})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"source_process_id",children:"Source Process *"}),e.jsxs(re,{value:o.source_process_id,onValueChange:p=>d({...o,source_process_id:p}),children:[e.jsx(te,{className:x.source_process_id?"border-red-500":"",disabled:!o.process_id,children:e.jsx(ne,{placeholder:o.process_id?"Select Source Process":"First select a Process"})}),e.jsx(ae,{children:h.map(p=>e.jsx(N,{value:p.$id||"",children:p.process_name},p.$id))})]}),x.source_process_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:x.source_process_id})]})]}),e.jsxs("div",{children:[e.jsxs(q,{htmlFor:"source_quantity",children:[B?"Source Qty (kg) *":"Source Qty"," ",!A()&&!B&&"*"]}),e.jsx(z,{id:"source_quantity",type:"number",step:"0.01",min:"0",value:A()?"N/A":o.source_quantity,onChange:p=>!A()&&d({...o,source_quantity:p.target.value}),className:x.source_quantity?"border-red-500":"",disabled:A(),placeholder:A()?"N/A":B?"Raw product quantity in kg":"Enter source quantity"}),x.source_quantity&&!A()&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:x.source_quantity}),A()&&e.jsx("p",{className:"text-muted-foreground text-xs mt-1",children:"Source quantity is not required for Batch Coding"}),B&&e.jsx("p",{className:"text-muted-foreground text-xs mt-1",children:"Raw product powder quantity from Grinding process"}),b&&!A()&&e.jsxs("div",{className:`mt-2 p-3 rounded-md border text-sm ${b.validationClass}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("div",{className:"font-medium",children:b.stockName}),e.jsxs("div",{className:"text-xs opacity-75",children:["Source: ",b.dataSource]})]}),e.jsx("div",{className:"mb-1",children:b.validationMessage}),b.error&&e.jsxs("div",{className:"text-xs mt-1 opacity-75",children:["Error: ",b.error]}),b.isLoading&&e.jsxs("div",{className:"flex items-center gap-2 text-xs mt-1",children:[e.jsx("div",{className:"animate-spin h-3 w-3 border border-current border-t-transparent rounded-full"}),"Loading fresh data from ",b.dataSource,"..."]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(q,{htmlFor:"sku",children:"SKU *"}),e.jsx(z,{id:"sku",value:o.sku,onChange:p=>d({...o,sku:p.target.value}),className:x.sku?"border-red-500":"",placeholder:"Enter SKU"}),x.sku&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:x.sku})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"product_id",children:"Product *"}),e.jsxs(re,{value:o.product_id,onValueChange:p=>d({...o,product_id:p}),children:[e.jsx(te,{className:x.product_id?"border-red-500":"",children:e.jsx(ne,{placeholder:"Select Product"})}),e.jsx(ae,{children:u.map(p=>e.jsx(N,{value:p.$id||"",children:p.product},p.$id))})]}),x.product_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:x.product_id})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(q,{htmlFor:"staff_id",children:"Staff Name *"}),e.jsxs(re,{value:o.staff_id,onValueChange:p=>d({...o,staff_id:p}),children:[e.jsx(te,{className:x.staff_id?"border-red-500":"",children:e.jsx(ne,{placeholder:"Select Staff"})}),e.jsx(ae,{children:i.map(p=>e.jsx(N,{value:p.$id||"",children:p.staff_name},p.$id))})]}),x.staff_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:x.staff_id})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"status",children:"Status"}),e.jsxs(re,{value:o.status,onValueChange:p=>d({...o,status:p}),children:[e.jsx(te,{children:e.jsx(ne,{})}),e.jsx(ae,{children:Nc.map(p=>e.jsx(N,{value:p.value,children:p.label},p.value))})]})]})]}),o.status==="completed"&&e.jsxs("div",{className:"grid grid-cols-3 gap-4 p-4 border rounded-md bg-muted/50",children:[e.jsxs("div",{children:[e.jsx(q,{htmlFor:"date_completed",children:"Date Completed *"}),e.jsx(z,{id:"date_completed",type:"date",value:o.date_completed,onChange:p=>d({...o,date_completed:p.target.value}),className:x.date_completed?"border-red-500":""}),x.date_completed&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:x.date_completed})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"completed_quantity",children:"Completed Units *"}),e.jsx(z,{id:"completed_quantity",type:"number",step:"0.01",min:"0",value:o.completed_quantity,onChange:p=>d({...o,completed_quantity:p.target.value}),className:x.completed_quantity?"border-red-500":"",placeholder:"Enter completed units"}),x.completed_quantity&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:x.completed_quantity})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"wastage_quantity",children:"Wastage Qty"}),e.jsx(z,{id:"wastage_quantity",type:"number",step:"0.01",min:"0",value:o.wastage_quantity,onChange:p=>d({...o,wastage_quantity:p.target.value}),className:x.wastage_quantity?"border-red-500":"",placeholder:"Enter wastage qty (optional)"}),x.wastage_quantity&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:x.wastage_quantity})]})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"remarks",children:"Remarks"}),e.jsx(et,{id:"remarks",value:o.remarks,onChange:p=>d({...o,remarks:p.target.value}),placeholder:"Enter any remarks",rows:3})]})]}),e.jsxs(ss,{className:"flex-col sm:flex-row gap-2 pt-4",children:[e.jsx(L,{type:"button",variant:"outline",onClick:I,className:"w-full sm:w-auto",children:"Cancel"}),e.jsx(L,{type:"submit",disabled:n,className:"w-full sm:w-auto",children:n?"Saving...":a?"Update":"Save"})]})]})]})})},Sc=()=>{const[r,s]=m.useState(""),[t,a]=m.useState(!1),[n,i]=m.useState(null),[l,u]=m.useState([]),[c,o]=m.useState({show:!1,message:"",type:"success"}),[d,x]=m.useState("all"),[y,b]=m.useState("all"),[T,O]=m.useState("all"),[g,w]=m.useState({from:"",to:""}),[P,D]=m.useState(1),[_,U]=m.useState(50),{tasks:Q,isLoading:C,error:B,refetch:A}=Tn(),{createTask:S,updateTask:h,deleteTask:F}=$l(),{config:v}=_s("post-production-tasks"),{validationRules:I,canImport:p}=ks("post-production-tasks"),{currentSort:E,handleSort:H,getSortedData:R}=Zs(),{data:M}=at(),K=(k,pe)=>{o({show:!0,message:k,type:pe}),setTimeout(()=>o({show:!1,message:"",type:"success"}),3e3)},Y=Q.filter(k=>{const pe=k.task_id.toLowerCase().includes(r.toLowerCase())||k.product_name.toLowerCase().includes(r.toLowerCase())||k.staff_name.toLowerCase().includes(r.toLowerCase())||k.process_name.toLowerCase().includes(r.toLowerCase())||k.stock_name&&k.stock_name.toLowerCase().includes(r.toLowerCase())||k.sku&&k.sku.toLowerCase().includes(r.toLowerCase()),fe=d==="all"||k.product_name.toLowerCase().includes(d.toLowerCase()),we=y==="all"||k.process_name.toLowerCase().includes(y.toLowerCase()),Te=T==="all"||k.staff_name.toLowerCase().includes(T.toLowerCase()),_e=(!g.from||k.date_assigned>=g.from)&&(!g.to||k.date_assigned<=g.to);return pe&&fe&&we&&Te&&_e}),G=Array.from(new Set(Q.map(k=>k.product_name))).sort(),le=Array.from(new Set(Q.map(k=>k.process_name))).sort(),se=Array.from(new Set(Q.map(k=>k.staff_name))).sort(),ye=Y.length,ve=Math.ceil(ye/_),ke=(P-1)*_,je=ke+_,Se=Y.slice(ke,je);m.useEffect(()=>{D(1)},[r,d,y,T,g,_]);const Ue=async k=>{try{const pe=M.find(we=>we.$id===k.process_id),fe=pe?.process_name?.toLowerCase()||"packing";if(console.log("ðŸ” Post-production task validation data:",{isEdit:!!n,processId:k.process_id,selectedProcess:pe,processName:fe,rawProductId:k.product_id,sourceProcessId:k.source_process_id,sourceQuantity:k.source_quantity,productId:k.product_id,allData:k}),n){const we=n.source_quantity||0,Te=parseFloat(k.source_quantity)||0,_e=Te-we;if(console.log("ðŸ”„ Post-production task edit validation:",{originalQuantity:we,newQuantity:Te,quantityDifference:_e,needsValidation:_e>0}),_e<=0)await h.mutateAsync({id:n.$id,data:k}),K("Post-production task updated successfully","success"),a(!1),i(null);else{const j=M.find(Pe=>Pe.$id===k.source_process_id)?.process_name||"Grinding",ce=fe==="batch_coding"||fe==="batch coding",Ne=parseFloat(k.source_quantity)||0;console.log("ðŸš¨ POST-PRODUCTION EDIT VALIDATION TRIGGERED:",{processName:fe,sourceProcess:j,rawProductId:k.product_id,sourceQuantity:k.source_quantity,quantityToValidate:Ne,newQuantity:Te,productId:k.product_id});const ue=await validateTaskCreation(fe,j,Ne,void 0,k.product_id,async Pe=>{const ls=Pe?{...k,source_quantity:Pe}:k;console.log("ðŸ”„ UPDATING POST-PRODUCTION TASK WITH ADJUSTED QUANTITY:",ls),await h.mutateAsync({id:n.$id,data:ls}),K("Post-production task updated successfully","success"),a(!1),i(null)});console.log("ðŸ” POST-PRODUCTION EDIT VALIDATION RESULT:",ue)}}else{const Te=M.find(ce=>ce.$id===k.source_process_id)?.process_name||"Grinding",_e=fe==="batch_coding"||fe==="batch coding",Le=parseFloat(k.source_quantity)||0;console.log("ðŸ” PROCESS TYPE DEBUG:",{processName:fe,isBatchCoding:_e,sourceQuantity:k.source_quantity,quantityToValidate:Le}),console.log("ðŸš¨ POST-PRODUCTION NEW TASK VALIDATION:",{processName:fe,sourceProcess:Te,rawProductId:k.product_id,sourceQuantity:k.source_quantity,quantityToValidate:Le,productId:k.product_id});const j=k;await S.mutateAsync(j),K("Post-production task created successfully","success"),a(!1),i(null)}}catch(pe){console.error("Error saving task:",pe),K("Failed to save task","error")}},Ae=k=>{i(k),a(!0)},Me=async k=>{if(window.confirm("Are you sure you want to delete this task?"))try{await F.mutateAsync(k.$id),K("Post-production task deleted successfully","success")}catch(pe){console.error("Error deleting task:",pe),K("Failed to delete task","error")}},He=async()=>{if(l.length===0){K("Please select tasks to delete","error");return}if(window.confirm(`Are you sure you want to delete ${l.length} selected task(s)?`))try{await Promise.all(l.map(k=>F.mutateAsync(k.$id))),u([]),K(`${l.length} tasks deleted successfully`,"success")}catch(k){console.error("Error deleting tasks:",k),K("Failed to delete selected tasks","error")}},$=()=>{if(l.length===0){K("Please select tasks to export","error");return}K(`Exporting ${l.length} selected task(s)...`,"success")};return B?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Post-Production Tasks"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage post-production processing tasks"})]}),e.jsx(X,{children:e.jsx(ee,{className:"pt-6",children:e.jsxs("div",{className:"text-center py-12 text-red-600",children:[e.jsx("p",{className:"text-lg mb-2",children:"Error loading tasks"}),e.jsx("p",{className:"text-sm mb-4",children:B.message}),e.jsx(L,{onClick:()=>A(),variant:"outline",children:"Retry"})]})})})]}):e.jsxs("div",{className:"space-y-6",children:[c.show&&e.jsx("div",{className:`fixed top-4 right-4 px-4 py-2 rounded-md shadow-lg z-50 ${c.type==="success"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300"}`,children:c.message}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Post-Production Tasks"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage post-production processing tasks"})]}),e.jsxs(L,{className:"bg-primary hover:bg-primary/90",onClick:()=>{i(null),a(!0)},children:[e.jsx(vs,{className:"h-4 w-4 mr-2"}),"Add New"]})]}),e.jsx(X,{children:e.jsx(ee,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(os,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(z,{placeholder:"Search tasks...",className:"pl-10",value:r,onChange:k=>s(k.target.value)})]}),p&&v&&e.jsx(ys,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:v.exportColumns.filter(k=>k.required).map(k=>k.exportHeader),optionalColumns:v.exportColumns.filter(k=>!k.required).map(k=>k.exportHeader),validationRules:I,onImportComplete:k=>{k.successfulRows>0&&(A(),K(`${k.successfulRows} post-production tasks imported successfully.`,"success"))}},variant:"outline"}),v&&e.jsx(js,{data:Y.map(k=>{const pe={};return v.exportColumns.forEach(fe=>{const we=k[fe.dataKey];pe[fe.exportHeader]=fe.formatter?fe.formatter(we):we}),pe}),headers:v.exportColumns.map(k=>k.exportHeader),filename:"post-production-tasks",variant:"outline"})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs(re,{value:d,onValueChange:x,children:[e.jsx(te,{className:"w-[180px]",children:e.jsx(ne,{placeholder:"Product"})}),e.jsxs(ae,{children:[e.jsx(N,{value:"all",children:"All Products"}),G.map(k=>e.jsx(N,{value:k,children:k},k))]})]}),e.jsxs(re,{value:y,onValueChange:b,children:[e.jsx(te,{className:"w-[180px]",children:e.jsx(ne,{placeholder:"Process"})}),e.jsxs(ae,{children:[e.jsx(N,{value:"all",children:"All Processes"}),le.map(k=>e.jsx(N,{value:k,children:k},k))]})]}),e.jsxs(re,{value:T,onValueChange:O,children:[e.jsx(te,{className:"w-[180px]",children:e.jsx(ne,{placeholder:"Staff Name"})}),e.jsxs(ae,{children:[e.jsx(N,{value:"all",children:"All Staff"}),se.map(k=>e.jsx(N,{value:k,children:k},k))]})]}),e.jsx(z,{type:"date",placeholder:"From Date",className:"w-[150px]",value:g.from,onChange:k=>w(pe=>({...pe,from:k.target.value}))}),e.jsx(z,{type:"date",placeholder:"To Date",className:"w-[150px]",value:g.to,onChange:k=>w(pe=>({...pe,to:k.target.value}))})]})]})})}),e.jsx(X,{children:e.jsxs(ee,{className:"pt-6",children:[l.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 p-3 bg-muted rounded-md",children:[e.jsxs("span",{className:"text-sm font-medium",children:[l.length," selected"]}),e.jsx(L,{variant:"destructive",size:"sm",onClick:He,children:"Delete Selected"}),e.jsx(L,{variant:"outline",size:"sm",onClick:$,children:"Export Selected"})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",ke+1," to ",Math.min(je,ye)," of ",ye," records"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Records per page:"}),e.jsxs(re,{value:_.toString(),onValueChange:k=>U(Number(k)),children:[e.jsx(te,{className:"w-[100px]",children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(N,{value:"50",children:"50"}),e.jsx(N,{value:"100",children:"100"}),e.jsx(N,{value:"500",children:"500"})]})]})]})]}),e.jsx("div",{className:"border rounded-md",children:e.jsx("div",{className:"overflow-auto",style:{maxHeight:"600px"},children:e.jsx(tt,{data:R(Se),columns:[{key:"task_id",label:"Task ID",sortable:!0,dataType:"string"},{key:"date",label:"Date Assigned",sortable:!0,dataType:"date"},{key:"date_completed",label:"Date Completed",sortable:!0,dataType:"date"},{key:"source_quantity",label:"Source Qty",sortable:!0,dataType:"number",align:"right"},{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"product_name",label:"Product",sortable:!0,dataType:"string"},{key:"process_name",label:"Process",sortable:!0,dataType:"string"},{key:"staff_name",label:"Staff Name",sortable:!0,dataType:"string"},{key:"units",label:"Completed Units",sortable:!0,dataType:"number",align:"right",headerClassName:"bg-green-50",cellClassName:"bg-green-50 font-medium"},{key:"wastage_quantity",label:"Wastage Qty",sortable:!0,dataType:"number",align:"right"},{key:"remarks",label:"Remarks",sortable:!0,dataType:"string"},{key:"status",label:"Status",sortable:!0,dataType:"string",formatter:k=>e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${k==="completed"?"bg-green-100 text-green-800":k==="in_progress"?"bg-yellow-100 text-yellow-800":k==="pending"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:k==="in_progress"?"In Progress":k.charAt(0).toUpperCase()+k.slice(1)})}],onSort:H,currentSort:E,loading:C,maxHeight:"none",stickyHeader:!0,bordered:!1,searchable:!1,selectable:!0,selectedRows:l,onSelectionChange:u,rowKey:"$id",actions:[wt.edit(k=>Ae(k)),wt.delete(k=>Me(k))],emptyMessage:"No post-production tasks found"})})}),ve>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx(L,{variant:"outline",size:"sm",onClick:()=>D(k=>Math.max(1,k-1)),disabled:P===1,children:"Previous"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",P," of ",ve]})}),e.jsx(L,{variant:"outline",size:"sm",onClick:()=>D(k=>Math.min(ve,k+1)),disabled:P===ve,children:"Next"})]})]})}),e.jsx(wc,{isOpen:t,onClose:()=>{a(!1),i(null)},onSubmit:Ue,editingTask:n,isLoading:S.isPending||h.isPending})]})},$n=Fi,Ua=m.forwardRef(({className:r,...s},t)=>e.jsx(Wr,{ref:t,className:ie("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",r),...s}));Ua.displayName=Wr.displayName;const jt=m.forwardRef(({className:r,...s},t)=>e.jsx(Gr,{ref:t,className:ie("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",r),...s}));jt.displayName=Gr.displayName;const fs=m.forwardRef(({className:r,...s},t)=>e.jsx(Jr,{ref:t,className:ie("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",r),...s}));fs.displayName=Jr.displayName;class _c{DEFAULT_OPTIONS={maxWidth:200,maxHeight:90,maxSizeKB:500,allowedTypes:["image/jpeg","image/jpg","image/png","image/svg+xml","image/webp"]};async uploadLogo(s,t={}){const a={...this.DEFAULT_OPTIONS,...t};try{return a.allowedTypes.includes(s.type)?s.size/1024>a.maxSizeKB?{success:!1,error:`File too large. Maximum: ${a.maxSizeKB}KB`}:s.type==="image/svg+xml"?{success:!0,logoBase64:await this.fileToBase64(s)}:{success:!0,logoBase64:await this.scaleImage(s,a.maxWidth,a.maxHeight)}:{success:!1,error:`Invalid file type. Allowed: ${a.allowedTypes.join(", ")}`}}catch(n){return{success:!1,error:n.message||"Failed to process logo"}}}async scaleImage(s,t,a){return new Promise((n,i)=>{const l=new Image,u=document.createElement("canvas"),c=u.getContext("2d");if(!c){i(new Error("Canvas context not available"));return}l.onload=()=>{const{width:d,height:x}=this.calculateDimensions(l.width,l.height,t,a);u.width=d,u.height=x,c.drawImage(l,0,0,d,x);const y=u.toDataURL("image/png",.9);n(y)},l.onerror=()=>i(new Error("Failed to load image"));const o=new FileReader;o.onload=d=>{l.src=d.target?.result},o.onerror=()=>i(new Error("Failed to read file")),o.readAsDataURL(s)})}calculateDimensions(s,t,a,n){let{width:i,height:l}={width:s,height:t};if(i>a||l>n){const u=a/i,c=n/l,o=Math.min(u,c);i=Math.round(i*o),l=Math.round(l*o)}return{width:i,height:l}}fileToBase64(s){return new Promise((t,a)=>{const n=new FileReader;n.onload=()=>t(n.result),n.onerror=()=>a(new Error("Failed to read file")),n.readAsDataURL(s)})}}const kc=new _c;function Cc(){const{toast:r}=Ie(),{settings:s,updateSettings:t}=fn(),[a,n]=m.useState(!1),[i,l]=m.useState(s.logo||null),u=m.useRef(null),c=(b,T)=>{t({[b]:T})},o=()=>{t({logo:i||void 0}),r({title:"Success",description:"Company profile saved successfully"})},d=async b=>{const T=b.target.files?.[0];if(T){n(!0);try{const O=await kc.uploadLogo(T,{maxWidth:200,maxHeight:90,maxSizeKB:500});O.success&&O.logoBase64?(l(O.logoBase64),r({title:"Logo uploaded successfully",description:"Logo has been scaled to fit 200x90px"})):r({title:"Upload failed",description:O.error||"Unknown error",variant:"destructive"})}catch(O){r({title:"Upload failed",description:O.message||"Failed to process logo",variant:"destructive"})}finally{n(!1),u.current&&(u.current.value="")}}},x=()=>{l(null),r({title:"Logo removed",description:"Logo has been removed"})},y=()=>{u.current?.click()};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(X,{children:[e.jsxs(me,{children:[e.jsx(he,{children:"Company Information"}),e.jsx(Ce,{children:"Basic information about your company"})]}),e.jsxs(ee,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(q,{children:"Company Logo"}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:i?e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"w-48 h-20 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg flex items-center justify-center bg-gray-50 dark:bg-gray-800 overflow-hidden",children:e.jsx("img",{src:i,alt:"Company Logo",className:"max-w-full max-h-full object-contain dark:brightness-90"})}),e.jsx(L,{variant:"destructive",size:"sm",className:"absolute -top-2 -right-2 h-6 w-6 rounded-full p-0 opacity-0 group-hover:opacity-100 transition-opacity",onClick:x,children:e.jsx(yt,{className:"h-3 w-3"})})]}):e.jsx("div",{className:"w-48 h-20 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg flex items-center justify-center bg-gray-50 dark:bg-gray-800 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:y,children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ba,{className:"h-8 w-8 mx-auto text-gray-400 dark:text-gray-500 mb-2"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Click to upload"}),e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:"200x90px"})]})})}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(L,{variant:"outline",onClick:y,disabled:a,className:"gap-2",children:[e.jsx(ea,{className:"h-4 w-4"}),a?"Uploading...":"Upload Logo"]}),i&&e.jsxs(L,{variant:"ghost",onClick:x,className:"gap-2 text-red-600 hover:text-red-700",children:[e.jsx(yt,{className:"h-4 w-4"}),"Remove"]})]}),e.jsxs(Je,{children:[e.jsx(Ba,{className:"h-4 w-4"}),e.jsxs(Xe,{children:[e.jsx("strong",{children:"Requirements:"})," Max 500KB â€¢ 200x90px recommended â€¢ PNG, JPG, SVG, WebP â€¢ Auto-scaled to fit"]})]})]})]}),e.jsx("input",{ref:u,type:"file",accept:"image/*",onChange:d,className:"hidden"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(q,{htmlFor:"companyName",children:"Company Name *"}),e.jsx(z,{id:"companyName",value:s.companyName,onChange:b=>c("companyName",b.target.value)})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"legalName",children:"Legal Name"}),e.jsx(z,{id:"legalName",value:s.legalName,onChange:b=>c("legalName",b.target.value)})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"registrationNumber",children:"Registration Number"}),e.jsx(z,{id:"registrationNumber",value:s.registrationNumber,onChange:b=>c("registrationNumber",b.target.value)})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"taxId",children:"Tax ID / GST Number"}),e.jsx(z,{id:"taxId",value:s.taxId,onChange:b=>c("taxId",b.target.value)})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"industryType",children:"Industry Type"}),e.jsxs(re,{value:s.industryType,onValueChange:b=>c("industryType",b),children:[e.jsx(te,{children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(N,{value:"Manufacturing",children:"Manufacturing"}),e.jsx(N,{value:"Trading",children:"Trading"}),e.jsx(N,{value:"Services",children:"Services"}),e.jsx(N,{value:"Retail",children:"Retail"})]})]})]})]})]})]}),e.jsxs(X,{children:[e.jsxs(me,{children:[e.jsx(he,{children:"Contact Information"}),e.jsx(Ce,{children:"How to reach your company"})]}),e.jsxs(ee,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(q,{htmlFor:"address",children:"Address"}),e.jsx(et,{id:"address",value:s.address,onChange:b=>c("address",b.target.value),rows:2})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(q,{htmlFor:"city",children:"City"}),e.jsx(z,{id:"city",value:s.city,onChange:b=>c("city",b.target.value)})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"state",children:"State"}),e.jsx(z,{id:"state",value:s.state,onChange:b=>c("state",b.target.value)})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"postalCode",children:"Postal Code"}),e.jsx(z,{id:"postalCode",value:s.postalCode,onChange:b=>c("postalCode",b.target.value)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(q,{htmlFor:"phone",children:"Phone"}),e.jsx(z,{id:"phone",value:s.phone,onChange:b=>c("phone",b.target.value)})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"email",children:"Email"}),e.jsx(z,{id:"email",type:"email",value:s.email,onChange:b=>c("email",b.target.value)})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"website",children:"Website"}),e.jsx(z,{id:"website",value:s.website,onChange:b=>c("website",b.target.value)})]})]})]})]}),e.jsxs(X,{children:[e.jsxs(me,{children:[e.jsx(he,{children:"Business Settings"}),e.jsx(Ce,{children:"Configure your business preferences"})]}),e.jsx(ee,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(q,{htmlFor:"fiscalYearStart",children:"Fiscal Year Start Month"}),e.jsxs(re,{value:s.fiscalYearStart,onValueChange:b=>c("fiscalYearStart",b),children:[e.jsx(te,{children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(N,{value:"01",children:"January"}),e.jsx(N,{value:"04",children:"April"}),e.jsx(N,{value:"07",children:"July"}),e.jsx(N,{value:"10",children:"October"})]})]})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"currency",children:"Default Currency"}),e.jsxs(re,{value:s.currency,onValueChange:b=>c("currency",b),children:[e.jsx(te,{children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(N,{value:"INR",children:"INR - Indian Rupee"}),e.jsx(N,{value:"USD",children:"USD - US Dollar"}),e.jsx(N,{value:"EUR",children:"EUR - Euro"}),e.jsx(N,{value:"GBP",children:"GBP - British Pound"})]})]})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"timezone",children:"Time Zone"}),e.jsxs(re,{value:s.timezone,onValueChange:b=>c("timezone",b),children:[e.jsx(te,{children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(N,{value:"Asia/Kolkata",children:"Asia/Kolkata (IST)"}),e.jsx(N,{value:"America/New_York",children:"America/New_York (EST)"}),e.jsx(N,{value:"Europe/London",children:"Europe/London (GMT)"}),e.jsx(N,{value:"Asia/Dubai",children:"Asia/Dubai (GST)"})]})]})]})]})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(L,{onClick:o,className:"gap-2",children:[e.jsx(na,{className:"h-4 w-4"}),"Save Changes"]})})]})}const Za="molaga_users",er="molaga_roles",sr=[{id:"super_admin",name:"Super Admin",description:"Full system access",permissions:{masterData:"full",purchases:"full",tasks:"full",sales:"full",status:"full",reports:"full",settings:"full"},isSystemRole:!0},{id:"admin",name:"Admin",description:"All except system configuration",permissions:{masterData:"full",purchases:"full",tasks:"full",sales:"full",status:"full",reports:"full",settings:"edit"},isSystemRole:!0},{id:"manager",name:"Manager",description:"View all, edit assigned",permissions:{masterData:"view",purchases:"edit",tasks:"edit",sales:"edit",status:"view",reports:"view",settings:"none"},isSystemRole:!0},{id:"staff",name:"Staff",description:"Limited access",permissions:{masterData:"view",purchases:"view",tasks:"edit",sales:"view",status:"view",reports:"none",settings:"none"},isSystemRole:!0},{id:"viewer",name:"Viewer",description:"Read-only access",permissions:{masterData:"view",purchases:"view",tasks:"view",sales:"view",status:"view",reports:"view",settings:"none"},isSystemRole:!0}],Pc=[{id:"1",name:"Admin User",email:"admin@molaga.com",role:"super_admin",status:"active",lastLogin:new Date().toISOString(),createdAt:new Date().toISOString()}];class Tc{users;roles;constructor(){this.users=this.loadUsers(),this.roles=this.loadRoles()}loadUsers(){try{const s=localStorage.getItem(Za);if(s)return JSON.parse(s)}catch(s){console.error("Error loading users:",s)}return[...Pc]}saveUsers(){try{localStorage.setItem(Za,JSON.stringify(this.users))}catch(s){console.error("Error saving users:",s)}}getAllUsers(){return[...this.users]}getUserById(s){return this.users.find(t=>t.id===s)}createUser(s){const t={...s,id:Date.now().toString(),createdAt:new Date().toISOString()};return this.users.push(t),this.saveUsers(),t}updateUser(s,t){const a=this.users.findIndex(n=>n.id===s);return a===-1?null:(this.users[a]={...this.users[a],...t},this.saveUsers(),this.users[a])}deleteUser(s){const t=this.users.findIndex(a=>a.id===s);return t===-1?!1:(this.users.splice(t,1),this.saveUsers(),!0)}loadRoles(){try{const s=localStorage.getItem(er);if(s){const t=JSON.parse(s),a=[...sr];return t.forEach(n=>{n.isSystemRole||a.push(n)}),a}}catch(s){console.error("Error loading roles:",s)}return[...sr]}saveRoles(){try{const s=this.roles.filter(t=>!t.isSystemRole);localStorage.setItem(er,JSON.stringify(s))}catch(s){console.error("Error saving roles:",s)}}getAllRoles(){return[...this.roles]}getRoleById(s){return this.roles.find(t=>t.id===s)}createRole(s){const t={...s,id:Date.now().toString(),isSystemRole:!1};return this.roles.push(t),this.saveRoles(),t}updateRole(s,t){const a=this.roles.findIndex(n=>n.id===s);return a===-1||this.roles[a].isSystemRole?null:(this.roles[a]={...this.roles[a],...t},this.saveRoles(),this.roles[a])}deleteRole(s){const t=this.roles.findIndex(a=>a.id===s);return t===-1||this.roles[t].isSystemRole?!1:(this.roles.splice(t,1),this.saveRoles(),!0)}}const Ds=new Tc;function Ec(){const[r,s]=m.useState(Ds.getAllUsers()),t=m.useCallback(()=>{s(Ds.getAllUsers())},[]),a=m.useCallback(l=>{const u=Ds.createUser(l);return t(),u},[t]),n=m.useCallback((l,u)=>{const c=Ds.updateUser(l,u);return t(),c},[t]),i=m.useCallback(l=>{const u=Ds.deleteUser(l);return u&&t(),u},[t]);return{users:r,createUser:a,updateUser:n,deleteUser:i,refreshUsers:t}}function Dc(){const[r,s]=m.useState(Ds.getAllRoles()),t=m.useCallback(()=>{s(Ds.getAllRoles())},[]),a=m.useCallback(l=>{const u=Ds.createRole(l);return t(),u},[t]),n=m.useCallback((l,u)=>{const c=Ds.updateRole(l,u);return t(),c},[t]),i=m.useCallback(l=>{const u=Ds.deleteRole(l);return u&&t(),u},[t]);return{roles:r,createRole:a,updateRole:n,deleteRole:i,refreshRoles:t}}class Rc{RESET_LOG_KEY="password_reset_log";FORCE_CHANGE_KEY="force_password_change";generateTempPassword(){const t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*";let a="";a+="ABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(Math.random()*26)],a+="abcdefghijklmnopqrstuvwxyz"[Math.floor(Math.random()*26)],a+="0123456789"[Math.floor(Math.random()*10)],a+="!@#$%^&*"[Math.floor(Math.random()*8)];for(let n=a.length;n<12;n++)a+=t[Math.floor(Math.random()*t.length)];return a.split("").sort(()=>Math.random()-.5).join("")}async resetUserPassword(s,t,a,n,i){try{const l=this.generateTempPassword();return this.logPasswordReset({id:Date.now().toString(),userId:s,userName:t,userEmail:a,resetBy:`${i} (${n})`,resetAt:new Date().toISOString(),tempPassword:l,mustChangePassword:!0}),this.setForcePasswordChange(s,!0),{success:!0,tempPassword:l,message:"Password reset successfully. User must change password on next login."}}catch(l){return console.error("Password reset error:",l),{success:!1,message:l.message||"Failed to reset password"}}}logPasswordReset(s){try{const t=this.getResetLogs();t.unshift(s),t.length>100&&t.splice(100),localStorage.setItem(this.RESET_LOG_KEY,JSON.stringify(t))}catch(t){console.error("Error logging password reset:",t)}}getResetLogs(){try{const s=localStorage.getItem(this.RESET_LOG_KEY);return s?JSON.parse(s):[]}catch(s){return console.error("Error loading reset logs:",s),[]}}setForcePasswordChange(s,t){try{const a=this.getForceChangeFlags();a[s]=t,localStorage.setItem(this.FORCE_CHANGE_KEY,JSON.stringify(a))}catch(a){console.error("Error setting force change flag:",a)}}mustChangePassword(s){try{return this.getForceChangeFlags()[s]===!0}catch(t){return console.error("Error checking force change flag:",t),!1}}clearForcePasswordChange(s){this.setForcePasswordChange(s,!1)}getForceChangeFlags(){try{const s=localStorage.getItem(this.FORCE_CHANGE_KEY);return s?JSON.parse(s):{}}catch(s){return console.error("Error loading force change flags:",s),{}}}getUserResetLogs(s){return this.getResetLogs().filter(a=>a.userId===s)}clearOldLogs(){try{const s=this.getResetLogs(),t=new Date;t.setDate(t.getDate()-90);const a=s.filter(i=>new Date(i.resetAt)>t),n=s.length-a.length;return localStorage.setItem(this.RESET_LOG_KEY,JSON.stringify(a)),n}catch(s){return console.error("Error clearing old logs:",s),0}}}const qc=new Rc;function Ac(){const{toast:r}=Ie(),{user:s}=us(),{users:t,createUser:a,updateUser:n,deleteUser:i}=Ec(),{roles:l}=Dc(),[u,c]=m.useState(""),[o,d]=m.useState(!1),[x,y]=m.useState(null),[b,T]=m.useState(!1),[O,g]=m.useState(null),[w,P]=m.useState(""),[D,_]=m.useState({name:"",email:"",phone:"",role:"",department:"",employeeId:"",status:"active"}),U=t.filter(v=>v.name.toLowerCase().includes(u.toLowerCase())||v.email.toLowerCase().includes(u.toLowerCase())),Q=()=>{y(null),_({name:"",email:"",phone:"",role:"",department:"",employeeId:"",status:"active"}),d(!0)},C=v=>{y(v),_({name:v.name,email:v.email,phone:v.phone||"",role:v.role,department:v.department||"",employeeId:v.employeeId||"",status:v.status}),d(!0)},B=v=>{confirm("Are you sure you want to delete this user?")&&i(v)&&r({title:"User deleted successfully"})},A=v=>{g(v),P(""),T(!0)},S=async()=>{if(!O||!s)return;const v=await qc.resetUserPassword(O.id,O.name,O.email,s.$id,s.name);v.success&&v.tempPassword?(P(v.tempPassword),r({title:"Password Reset Successfully",description:"Temporary password has been generated. Please share it securely with the user."})):(r({title:"Password Reset Failed",description:v.message,variant:"destructive"}),T(!1),g(null))},h=()=>{navigator.clipboard.writeText(w),r({title:"Copied!",description:"Temporary password copied to clipboard"})},F=()=>{if(!D.name||!D.email||!D.role){r({title:"Please fill in all required fields",variant:"destructive"});return}x?(n(x.id,D),r({title:"User updated successfully"})):(a(D),r({title:"User created successfully"})),d(!1)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(X,{children:[e.jsx(me,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(he,{children:"User Management"}),e.jsx(Ce,{children:"Manage system users and their access"})]}),e.jsxs(L,{onClick:Q,className:"gap-2",children:[e.jsx(ni,{className:"h-4 w-4"}),"Add User"]})]})}),e.jsxs(ee,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(os,{className:"h-4 w-4 text-muted-foreground"}),e.jsx(z,{placeholder:"Search users...",value:u,onChange:v=>c(v.target.value),className:"max-w-sm"})]}),e.jsxs(ps,{children:[e.jsx(xs,{children:e.jsxs(De,{children:[e.jsx(Z,{children:"Name"}),e.jsx(Z,{children:"Email"}),e.jsx(Z,{children:"Role"}),e.jsx(Z,{children:"Status"}),e.jsx(Z,{children:"Last Login"}),e.jsx(Z,{className:"text-right",children:"Actions"})]})}),e.jsx(gs,{children:U.map(v=>e.jsxs(De,{children:[e.jsx(W,{className:"font-medium",children:v.name}),e.jsx(W,{children:v.email}),e.jsx(W,{children:v.role}),e.jsx(W,{children:e.jsx(Ve,{variant:v.status==="active"?"default":"secondary",children:v.status})}),e.jsx(W,{children:v.lastLogin}),e.jsx(W,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(L,{variant:"ghost",size:"sm",onClick:()=>A(v),title:"Reset Password",children:e.jsx(Vt,{className:"h-4 w-4"})}),e.jsx(L,{variant:"ghost",size:"sm",onClick:()=>C(v),children:e.jsx(Xs,{className:"h-4 w-4"})}),e.jsx(L,{variant:"ghost",size:"sm",onClick:()=>B(v.id),children:e.jsx($s,{className:"h-4 w-4"})})]})})]},v.id))})]})]})]}),e.jsxs(X,{children:[e.jsxs(me,{children:[e.jsx(he,{children:"Roles & Permissions"}),e.jsx(Ce,{children:"Configure user roles and their permissions"})]}),e.jsx(ee,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:l.map(v=>e.jsxs(X,{children:[e.jsxs(me,{children:[e.jsx(he,{className:"text-base",children:v.name}),v.isSystemRole&&e.jsx(Ve,{variant:"secondary",className:"w-fit",children:"System Role"})]}),e.jsxs(ee,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:v.description}),e.jsx("div",{className:"text-xs text-muted-foreground mb-3",children:e.jsx("div",{className:"grid grid-cols-2 gap-1",children:Object.entries(v.permissions).slice(0,4).map(([I,p])=>e.jsxs("div",{children:[I,": ",e.jsx("span",{className:"font-medium",children:p})]},I))})}),e.jsx(L,{variant:"outline",size:"sm",className:"w-full",disabled:v.isSystemRole,children:v.isSystemRole?"View Permissions":"Edit Permissions"})]})]},v.id))})})]}),e.jsx(as,{open:o,onOpenChange:d,children:e.jsxs(Ze,{children:[e.jsxs(es,{children:[e.jsx(ts,{children:x?"Edit User":"Add New User"}),e.jsx(rs,{children:x?"Update user information":"Create a new user account"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(q,{htmlFor:"name",children:"Full Name *"}),e.jsx(z,{id:"name",placeholder:"John Doe",value:D.name,onChange:v=>_({...D,name:v.target.value})})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"email",children:"Email *"}),e.jsx(z,{id:"email",type:"email",placeholder:"john@example.com",value:D.email,onChange:v=>_({...D,email:v.target.value})})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"phone",children:"Phone"}),e.jsx(z,{id:"phone",placeholder:"+91 9876543210",value:D.phone,onChange:v=>_({...D,phone:v.target.value})})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"role",children:"Role *"}),e.jsxs(re,{value:D.role,onValueChange:v=>_({...D,role:v}),children:[e.jsx(te,{children:e.jsx(ne,{placeholder:"Select role"})}),e.jsx(ae,{children:l.map(v=>e.jsx(N,{value:v.id,children:v.name},v.id))})]})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"department",children:"Department"}),e.jsx(z,{id:"department",placeholder:"Production",value:D.department,onChange:v=>_({...D,department:v.target.value})})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"employeeId",children:"Employee ID"}),e.jsx(z,{id:"employeeId",placeholder:"EMP001",value:D.employeeId,onChange:v=>_({...D,employeeId:v.target.value})})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"status",children:"Status"}),e.jsxs(re,{value:D.status,onValueChange:v=>_({...D,status:v}),children:[e.jsx(te,{children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(N,{value:"active",children:"Active"}),e.jsx(N,{value:"inactive",children:"Inactive"})]})]})]})]}),e.jsxs(ss,{children:[e.jsx(L,{variant:"outline",onClick:()=>d(!1),children:"Cancel"}),e.jsx(L,{onClick:F,children:x?"Update":"Create"})]})]})}),e.jsx(as,{open:b,onOpenChange:T,children:e.jsxs(Ze,{children:[e.jsxs(es,{children:[e.jsx(ts,{children:"Reset Password"}),e.jsxs(rs,{children:["Reset password for ",O?.name]})]}),e.jsx("div",{className:"space-y-4 py-4",children:w?e.jsxs(e.Fragment,{children:[e.jsxs(Je,{children:[e.jsx(Vt,{className:"h-4 w-4"}),e.jsx(Xe,{children:"Password reset successfully! Please share this temporary password securely with the user."})]}),e.jsxs("div",{children:[e.jsx(q,{children:"Temporary Password"}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(z,{value:w,readOnly:!0,className:"font-mono"}),e.jsx(L,{variant:"outline",size:"icon",onClick:h,children:e.jsx($t,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"User must change this password on next login"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(Je,{children:[e.jsx(Vt,{className:"h-4 w-4"}),e.jsx(Xe,{children:"A temporary password will be generated. The user will be required to change it on next login."})]}),e.jsxs("div",{children:[e.jsx(q,{children:"User Email"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:O?.email})]})]})}),e.jsx(ss,{children:w?e.jsx(L,{onClick:()=>{T(!1),g(null),P("")},children:"Close"}):e.jsxs(e.Fragment,{children:[e.jsx(L,{variant:"outline",onClick:()=>T(!1),children:"Cancel"}),e.jsxs(L,{onClick:S,className:"gap-2",children:[e.jsx(Vt,{className:"h-4 w-4"}),"Generate Password"]})]})})]})})]})}class Fc{async registerWithApproval(s,t,a){try{const n=await Os.create(ct.unique(),s,t,a),i={approvalStatus:"pending",registeredAt:new Date().toISOString(),role:"viewer"};await Os.updatePrefs(i);try{await Os.deleteSession("current")}catch{}return{success:!0,message:"Registration successful. Please wait for admin approval.",userId:n.$id}}catch(n){return console.error("Registration error:",n),{success:!1,message:n.message||"Registration failed"}}}async checkApprovalStatus(s){try{const a=(await Os.get()).prefs;return!a.approvalStatus||a.approvalStatus==="approved"?{approved:!0,status:"approved",message:"User is approved"}:a.approvalStatus==="pending"?{approved:!1,status:"pending",message:"Your account is pending approval. Please wait for admin approval."}:a.approvalStatus==="rejected"?{approved:!1,status:"rejected",message:`Your account was rejected. Reason: ${a.rejectionReason||"Not specified"}`}:{approved:!1,status:"pending",message:"Unknown approval status"}}catch(t){return console.error("Approval check error:",t),{approved:!1,status:"pending",message:"Could not verify approval status"}}}async approveUser(s,t,a="viewer"){try{return{success:!0,message:"User approved successfully"}}catch(n){return console.error("Approval error:",n),{success:!1,message:n.message||"Failed to approve user"}}}async rejectUser(s,t,a){try{return{success:!0,message:"User rejected"}}catch(n){return console.error("Rejection error:",n),{success:!1,message:n.message||"Failed to reject user"}}}getPendingUsers(){try{const s=localStorage.getItem("pending_users");return s?JSON.parse(s):[]}catch(s){return console.error("Error loading pending users:",s),[]}}addPendingUser(s){try{const t=this.getPendingUsers();t.push(s),localStorage.setItem("pending_users",JSON.stringify(t))}catch(t){console.error("Error adding pending user:",t)}}removePendingUser(s){try{const a=this.getPendingUsers().filter(n=>n.$id!==s);localStorage.setItem("pending_users",JSON.stringify(a))}catch(t){console.error("Error removing pending user:",t)}}updatePendingUserStatus(s,t,a){try{const n=this.getPendingUsers(),i=n.find(l=>l.$id===s);i&&(i.approvalStatus=t,a&&(i.rejectionReason=a),localStorage.setItem("pending_users",JSON.stringify(n)))}catch(n){console.error("Error updating pending user:",n)}}}const pt=new Fc;function $c(){const{toast:r}=Ie(),{user:s}=us(),[t,a]=m.useState(pt.getPendingUsers()),[n,i]=m.useState(null),[l,u]=m.useState(!1),[c,o]=m.useState(!1),[d,x]=m.useState("viewer"),[y,b]=m.useState(""),T=Ds.getAllRoles(),O=()=>{a(pt.getPendingUsers())},g=_=>{i(_),x("viewer"),u(!0)},w=_=>{i(_),b(""),o(!0)},P=async()=>{if(!(!n||!s))try{Ds.createUser({name:n.name,email:n.email,role:d,status:"active"}),pt.updatePendingUserStatus(n.$id,"approved"),pt.removePendingUser(n.$id),r({title:"User Approved",description:`${n.name} has been approved and can now login.`}),O(),u(!1),i(null)}catch(_){r({title:"Approval Failed",description:_.message||"Failed to approve user",variant:"destructive"})}},D=async()=>{if(!(!n||!s)){if(!y.trim()){r({title:"Reason Required",description:"Please provide a reason for rejection",variant:"destructive"});return}try{pt.updatePendingUserStatus(n.$id,"rejected",y),pt.removePendingUser(n.$id),r({title:"User Rejected",description:`${n.name} has been rejected.`}),O(),o(!1),i(null),b("")}catch(_){r({title:"Rejection Failed",description:_.message||"Failed to reject user",variant:"destructive"})}}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(X,{children:[e.jsxs(me,{children:[e.jsx(he,{children:"Pending User Approvals"}),e.jsx(Ce,{children:"Review and approve new user registrations"})]}),e.jsx(ee,{children:t.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(wa,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No pending user approvals"})]}):e.jsxs(ps,{children:[e.jsx(xs,{children:e.jsxs(De,{children:[e.jsx(Z,{children:"Name"}),e.jsx(Z,{children:"Email"}),e.jsx(Z,{children:"Provider"}),e.jsx(Z,{children:"Registered"}),e.jsx(Z,{children:"Status"}),e.jsx(Z,{className:"text-right",children:"Actions"})]})}),e.jsx(gs,{children:t.map(_=>e.jsxs(De,{children:[e.jsx(W,{className:"font-medium",children:_.name}),e.jsx(W,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($a,{className:"h-4 w-4 text-muted-foreground"}),_.email]})}),e.jsx(W,{children:e.jsx(Ve,{variant:"outline",children:_.provider})}),e.jsx(W,{children:new Date(_.registeredAt).toLocaleDateString()}),e.jsx(W,{children:e.jsxs(Ve,{variant:"secondary",children:[e.jsx(wa,{className:"h-3 w-3 mr-1"}),"Pending"]})}),e.jsx(W,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(L,{variant:"ghost",size:"sm",onClick:()=>g(_),className:"text-green-600 hover:text-green-700",children:e.jsx(Ys,{className:"h-4 w-4"})}),e.jsx(L,{variant:"ghost",size:"sm",onClick:()=>w(_),className:"text-red-600 hover:text-red-700",children:e.jsx(Sa,{className:"h-4 w-4"})})]})})]},_.$id))})]})})]}),e.jsx(as,{open:l,onOpenChange:u,children:e.jsxs(Ze,{children:[e.jsxs(es,{children:[e.jsx(ts,{children:"Approve User"}),e.jsxs(rs,{children:["Approve ",n?.name," to access the system"]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(q,{children:"Email"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:n?.email})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"role",children:"Assign Role"}),e.jsxs(re,{value:d,onValueChange:x,children:[e.jsx(te,{children:e.jsx(ne,{})}),e.jsx(ae,{children:T.map(_=>e.jsx(N,{value:_.id,children:_.name},_.id))})]})]})]}),e.jsxs(ss,{children:[e.jsx(L,{variant:"outline",onClick:()=>u(!1),children:"Cancel"}),e.jsxs(L,{onClick:P,className:"gap-2",children:[e.jsx(Ys,{className:"h-4 w-4"}),"Approve User"]})]})]})}),e.jsx(as,{open:c,onOpenChange:o,children:e.jsxs(Ze,{children:[e.jsxs(es,{children:[e.jsx(ts,{children:"Reject User"}),e.jsxs(rs,{children:["Reject ",n?.name,"'s registration request"]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(q,{children:"Email"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:n?.email})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"reason",children:"Rejection Reason *"}),e.jsx(et,{id:"reason",placeholder:"Please provide a reason for rejection...",value:y,onChange:_=>b(_.target.value),rows:4})]})]}),e.jsxs(ss,{children:[e.jsx(L,{variant:"outline",onClick:()=>o(!1),children:"Cancel"}),e.jsxs(L,{onClick:D,variant:"destructive",className:"gap-2",children:[e.jsx(Sa,{className:"h-4 w-4"}),"Reject User"]})]})]})})]})}const As=m.forwardRef(({className:r,...s},t)=>e.jsx(Xr,{className:ie("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",r),...s,ref:t,children:e.jsx($i,{className:ie("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));As.displayName=Xr.displayName;function Lc(){const{toast:r}=Ie(),{settings:s,updateSettings:t}=jn(),a=(i,l)=>{t({[i]:l})},n=()=>{r({title:"System configuration saved successfully"})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(X,{children:[e.jsxs(me,{children:[e.jsx(he,{children:"General Settings"}),e.jsx(Ce,{children:"Configure system-wide preferences"})]}),e.jsx(ee,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(q,{htmlFor:"language",children:"Default Language"}),e.jsxs(re,{value:s.language,onValueChange:i=>a("language",i),children:[e.jsx(te,{children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(N,{value:"en",children:"English"}),e.jsx(N,{value:"hi",children:"Hindi"}),e.jsx(N,{value:"ta",children:"Tamil"}),e.jsx(N,{value:"te",children:"Telugu"})]})]})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"dateFormat",children:"Date Format"}),e.jsxs(re,{value:s.dateFormat,onValueChange:i=>a("dateFormat",i),children:[e.jsx(te,{children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(N,{value:"DD/MM/YYYY",children:"DD/MM/YYYY"}),e.jsx(N,{value:"MM/DD/YYYY",children:"MM/DD/YYYY"}),e.jsx(N,{value:"YYYY-MM-DD",children:"YYYY-MM-DD"})]})]})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"timeFormat",children:"Time Format"}),e.jsxs(re,{value:s.timeFormat,onValueChange:i=>a("timeFormat",i),children:[e.jsx(te,{children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(N,{value:"12",children:"12-hour"}),e.jsx(N,{value:"24",children:"24-hour"})]})]})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"firstDayOfWeek",children:"First Day of Week"}),e.jsxs(re,{value:s.firstDayOfWeek,onValueChange:i=>a("firstDayOfWeek",i),children:[e.jsx(te,{children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(N,{value:"sunday",children:"Sunday"}),e.jsx(N,{value:"monday",children:"Monday"})]})]})]})]})})]}),e.jsxs(X,{children:[e.jsxs(me,{children:[e.jsx(he,{children:"Number Formatting"}),e.jsx(Ce,{children:"Configure how numbers are displayed"})]}),e.jsx(ee,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(q,{htmlFor:"decimalPlaces",children:"Decimal Places"}),e.jsxs(re,{value:s.decimalPlaces,onValueChange:i=>a("decimalPlaces",i),children:[e.jsx(te,{children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(N,{value:"0",children:"0"}),e.jsx(N,{value:"1",children:"1"}),e.jsx(N,{value:"2",children:"2"}),e.jsx(N,{value:"3",children:"3"}),e.jsx(N,{value:"4",children:"4"})]})]})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"thousandSeparator",children:"Thousand Separator"}),e.jsxs(re,{value:s.thousandSeparator,onValueChange:i=>a("thousandSeparator",i),children:[e.jsx(te,{children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(N,{value:",",children:", (Comma)"}),e.jsx(N,{value:".",children:". (Period)"}),e.jsx(N,{value:" ",children:"  (Space)"})]})]})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"decimalSeparator",children:"Decimal Separator"}),e.jsxs(re,{value:s.decimalSeparator,onValueChange:i=>a("decimalSeparator",i),children:[e.jsx(te,{children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(N,{value:".",children:". (Period)"}),e.jsx(N,{value:",",children:", (Comma)"})]})]})]})]})})]}),e.jsxs(X,{children:[e.jsxs(me,{children:[e.jsx(he,{children:"Display Settings"}),e.jsx(Ce,{children:"Customize the user interface"})]}),e.jsxs(ee,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(q,{htmlFor:"recordsPerPage",children:"Records Per Page"}),e.jsxs(re,{value:s.recordsPerPage,onValueChange:i=>a("recordsPerPage",i),children:[e.jsx(te,{children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(N,{value:"25",children:"25"}),e.jsx(N,{value:"50",children:"50"}),e.jsx(N,{value:"100",children:"100"}),e.jsx(N,{value:"200",children:"200"})]})]})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"theme",children:"Theme"}),e.jsxs(re,{value:s.theme,onValueChange:i=>a("theme",i),children:[e.jsx(te,{children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(N,{value:"light",children:"Light"}),e.jsx(N,{value:"dark",children:"Dark"}),e.jsx(N,{value:"auto",children:"Auto"})]})]})]})]}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(q,{htmlFor:"sidebarCollapsed",children:"Sidebar Collapsed by Default"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Start with a collapsed sidebar"})]}),e.jsx(As,{id:"sidebarCollapsed",checked:s.sidebarCollapsed,onCheckedChange:i=>a("sidebarCollapsed",i)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(q,{htmlFor:"showTooltips",children:"Show Tooltips"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Display helpful tooltips"})]}),e.jsx(As,{id:"showTooltips",checked:s.showTooltips,onCheckedChange:i=>a("showTooltips",i)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(q,{htmlFor:"enableAnimations",children:"Enable Animations"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Use smooth transitions"})]}),e.jsx(As,{id:"enableAnimations",checked:s.enableAnimations,onCheckedChange:i=>a("enableAnimations",i)})]})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(L,{onClick:n,className:"gap-2",children:[e.jsx(na,{className:"h-4 w-4"}),"Save Configuration"]})})]})}class Ic{BACKUP_VERSION="1.0";APP_VERSION="1.0.0";getCollectionsList(){return["purchases","vendors","stocks","products","raw_products","processes","staff","sales_channels","pre_production_tasks","production_tasks","post_production_tasks","sales_units","sales_records","stock_status","pre_production_status","production_status","post_production_status"]}async exportCollection(s,t){const a=[];let n=0;const i=100;let l=!0;try{for(;l;){const u=await Ye.listDocuments(We,be[s],[Ke.limit(i),Ke.offset(n)]);a.push(...u.documents),t&&t(a.length,u.total),u.documents.length<i?l=!1:n+=i}return console.log(`âœ“ Exported ${a.length} documents from ${s}`),a}catch(u){return console.error(`Error exporting ${s}:`,u),[]}}async createFullBackup(s){const t=this.getCollectionsList(),a={metadata:{version:this.BACKUP_VERSION,timestamp:new Date().toISOString(),appVersion:this.APP_VERSION,totalRecords:0,totalCollections:t.length,collections:t},collections:{}};let n=0;for(const i of t)try{const l=await this.exportCollection(i,(u,c)=>{s&&s({currentCollection:i,processedCollections:n,totalCollections:t.length,currentRecords:u,totalRecords:a.metadata.totalRecords+u,percentage:Math.round((n+u/c)/t.length*100)})});a.collections[i]=l,a.metadata.totalRecords+=l.length,n++,s&&s({currentCollection:i,processedCollections:n,totalCollections:t.length,currentRecords:l.length,totalRecords:a.metadata.totalRecords,percentage:Math.round(n/t.length*100)})}catch(l){console.error(`Failed to backup ${i}:`,l),a.collections[i]=[]}return a}async createPartialBackup(s,t){const a={metadata:{version:this.BACKUP_VERSION,timestamp:new Date().toISOString(),appVersion:this.APP_VERSION,totalRecords:0,totalCollections:s.length,collections:s},collections:{}};let n=0;for(const i of s){const l=await this.exportCollection(i);a.collections[i]=l,a.metadata.totalRecords+=l.length,n++,t&&t({currentCollection:i,processedCollections:n,totalCollections:s.length,currentRecords:l.length,totalRecords:a.metadata.totalRecords,percentage:Math.round(n/s.length*100)})}return a}async downloadBackup(s,t){const a=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),n=`molaga-backup-${new Date().toISOString().split("T")[0]}.json`;Et.saveAs(a,t||n)}getBackupSize(s){const t=JSON.stringify(s),a=new Blob([t]).size;return a<1024?`${a} B`:a<1024*1024?`${(a/1024).toFixed(2)} KB`:`${(a/(1024*1024)).toFixed(2)} MB`}async readBackupFile(s){return new Promise((t,a)=>{const n=new FileReader;n.onload=i=>{try{const l=i.target?.result,u=JSON.parse(l);t(u)}catch{a(new Error("Invalid backup file format"))}},n.onerror=()=>{a(new Error("Failed to read backup file"))},n.readAsText(s)})}}const Qt=new Ic;class Mc{RESTORE_ORDER=["vendors","stocks","raw_products","processes","products","staff","sales_channels","purchases","pre_production_tasks","production_tasks","post_production_tasks","sales_units","sales_records","stock_status","pre_production_status","production_status","post_production_status"];async validateBackup(s){const t=[],a=[];if(s.metadata?.version||t.push("Missing backup version"),s.metadata?.timestamp||t.push("Missing backup timestamp"),!s.collections||typeof s.collections!="object")return t.push("Invalid or missing collections data"),{valid:!1,errors:t,warnings:a};const n=["products","stocks","vendors"];for(const l of n)s.collections[l]||a.push(`Missing recommended collection: ${l}`);for(const[l,u]of Object.entries(s.collections))Array.isArray(u)?u.length>0&&(u[0].$id||a.push(`Documents in ${l} may be missing $id field`)):t.push(`Invalid data format for collection: ${l}`);const i=Object.values(s.collections).reduce((l,u)=>l+u.length,0);return s.metadata.totalRecords!==i&&a.push(`Metadata record count (${s.metadata.totalRecords}) doesn't match actual count (${i})`),{valid:t.length===0,errors:t,warnings:a}}cleanDocument(s){const{$id:t,$createdAt:a,$updatedAt:n,$permissions:i,$collectionId:l,$databaseId:u,...c}=s;return c}async documentExists(s,t){try{return await Ye.getDocument(We,be[s],t),!0}catch{return!1}}async clearCollection(s){let t=0,a=!0;try{for(;a;){const n=await Ye.listDocuments(We,be[s],[]);for(const i of n.documents)try{await Ye.deleteDocument(We,be[s],i.$id),t++}catch(l){console.error(`Failed to delete document ${i.$id}:`,l)}a=n.documents.length>0}}catch(n){console.error(`Error clearing collection ${s}:`,n)}return t}async restoreCollection(s,t,a,n){const i={total:t.length,success:0,failed:0,skipped:0,errors:[]};for(let l=0;l<t.length;l++){const u=t[l];try{const c=this.cleanDocument(u),o=u.$id||ct.unique();if(a.handleIdConflicts==="skip"){if(await this.documentExists(s,o)){i.skipped++;continue}}else a.handleIdConflicts==="overwrite"&&await this.documentExists(s,o)&&await Ye.deleteDocument(We,be[s],o);await Ye.createDocument(We,be[s],a.handleIdConflicts==="new"?ct.unique():o,c),i.success++}catch(c){if(i.failed++,i.errors.push({documentId:u.$id||"unknown",error:c.message||"Unknown error"}),a.stopOnError)throw c}n&&n(l+1,t.length)}return i}async restoreFromBackup(s,t,a){const n={success:!0,collections:{},errors:[],totalProcessed:0,totalSuccess:0,totalFailed:0};try{a&&a({currentCollection:"",processedCollections:0,totalCollections:0,currentRecords:0,totalRecords:0,percentage:0,phase:"validating"});const i=await this.validateBackup(s);if(!i.valid)throw new Error(`Invalid backup: ${i.errors.join(", ")}`);const l=this.RESTORE_ORDER.filter(o=>s.collections[o]&&s.collections[o].length>0),u=l.length;let c=0;if(t.clearExisting){a&&a({currentCollection:"",processedCollections:0,totalCollections:u,currentRecords:0,totalRecords:0,percentage:0,phase:"clearing"});for(const o of l)await this.clearCollection(o)}for(const o of l){a&&a({currentCollection:o,processedCollections:c,totalCollections:u,currentRecords:0,totalRecords:n.totalProcessed,percentage:Math.round(c/u*100),phase:"restoring"});try{const d=s.collections[o],x=await this.restoreCollection(o,d,t,(y,b)=>{a&&a({currentCollection:o,processedCollections:c,totalCollections:u,currentRecords:y,totalRecords:n.totalProcessed+y,percentage:Math.round((c+y/b)/u*100),phase:"restoring"})});n.collections[o]=x,n.totalProcessed+=x.total,n.totalSuccess+=x.success,n.totalFailed+=x.failed,c++}catch(d){if(n.success=!1,n.errors.push({collection:o,error:d.message||"Unknown error"}),t.stopOnError)throw d}}a&&a({currentCollection:"",processedCollections:u,totalCollections:u,currentRecords:n.totalProcessed,totalRecords:n.totalProcessed,percentage:100,phase:"complete"})}catch(i){n.success=!1,n.errors.push({collection:"general",error:i.message||"Unknown error"})}return n}getRestoreSummary(s){const t=[`Total Collections: ${Object.keys(s.collections).length}`,`Total Records Processed: ${s.totalProcessed}`,`Successful: ${s.totalSuccess}`,`Failed: ${s.totalFailed}`];return s.errors.length>0&&(t.push(`
Errors: ${s.errors.length}`),s.errors.forEach(a=>{t.push(`  - ${a.collection}: ${a.error}`)})),t.join(`
`)}}const Uc=new Mc;function Oc(){const{toast:r}=Ie(),s=m.useRef(null),[t,a]=m.useState(!1),[n,i]=m.useState(!1),[l,u]=m.useState(null),[c,o]=m.useState(null),[d,x]=m.useState(!1),[y,b]=m.useState(null);m.useState({autoBackup:!0,frequency:"daily",time:"00:00",retention:"30"});const[T,O]=m.useState({createSafetyBackup:!0,clearExisting:!0,handleIdConflicts:"skip",stopOnError:!1}),g=async()=>{a(!0),u(null);try{r({title:"Creating backup...",description:"This may take a few minutes depending on data size"});const D=await Qt.createFullBackup(U=>{u(U)}),_=Qt.getBackupSize(D);await Qt.downloadBackup(D),r({title:"Backup created successfully!",description:`Downloaded ${_} backup file with ${D.metadata.totalRecords} records`})}catch(D){console.error("Backup error:",D),r({title:"Backup failed",description:D.message||"An error occurred during backup",variant:"destructive"})}finally{a(!1),u(null)}},w=D=>{const _=D.target.files?.[0];if(_){if(!_.name.endsWith(".json")){r({title:"Invalid file type",description:"Please select a JSON backup file",variant:"destructive"});return}b(_),x(!0)}},P=async()=>{if(y){x(!1),i(!0),o(null);try{r({title:"Reading backup file...",description:"Please wait while we validate the backup"});const D=await Qt.readBackupFile(y);r({title:"Restoring data...",description:"This may take several minutes. Do not close this window."});const _=await Uc.restoreFromBackup(D,T,U=>{o(U)});_.success?r({title:"Restore completed successfully!",description:`Restored ${_.totalSuccess} records across ${Object.keys(_.collections).length} collections`}):(r({title:"Restore completed with errors",description:`${_.totalSuccess} succeeded, ${_.totalFailed} failed. Check console for details.`,variant:"destructive"}),console.error("Restore errors:",_.errors))}catch(D){console.error("Restore error:",D),r({title:"Restore failed",description:D.message||"An error occurred during restore",variant:"destructive"})}finally{i(!1),o(null),b(null),s.current&&(s.current.value="")}}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(Je,{children:[e.jsx(Ss,{className:"h-4 w-4"}),e.jsx(Xe,{children:"Always create a backup before making major changes. Store backups securely in multiple locations."})]}),t&&l&&e.jsxs(X,{children:[e.jsx(me,{children:e.jsxs(he,{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"h-5 w-5 animate-spin"}),"Creating Backup..."]})}),e.jsx(ee,{className:"space-y-4",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsxs("span",{children:["Processing: ",l.currentCollection]}),e.jsxs("span",{children:[l.percentage,"%"]})]}),e.jsx(Nt,{value:l.percentage}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:[l.processedCollections," / ",l.totalCollections," collections (",l.totalRecords," records)"]})]})})]}),n&&c&&e.jsxs(X,{children:[e.jsx(me,{children:e.jsxs(he,{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"h-5 w-5 animate-spin"}),"Restoring Data..."]})}),e.jsx(ee,{className:"space-y-4",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsxs("span",{children:["Phase: ",c.phase]}),e.jsxs("span",{children:[c.percentage,"%"]})]}),e.jsx(Nt,{value:c.percentage}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:[c.currentCollection&&`Processing: ${c.currentCollection}`,e.jsx("br",{}),c.processedCollections," / ",c.totalCollections," collections (",c.totalRecords," records)"]})]})})]}),e.jsxs(X,{children:[e.jsxs(me,{children:[e.jsx(he,{children:"Create Backup"}),e.jsx(Ce,{children:"Export all your data to a JSON file"})]}),e.jsxs(ee,{className:"space-y-4",children:[e.jsxs(Je,{children:[e.jsx(sa,{className:"h-4 w-4"}),e.jsx(Xe,{children:"Full backup includes all master data, transactions, tasks, and status records. The backup file will be downloaded to your computer."})]}),e.jsx(L,{onClick:g,disabled:t||n,className:"gap-2",children:t?e.jsxs(e.Fragment,{children:[e.jsx(Oe,{className:"h-4 w-4 animate-spin"}),"Creating Backup..."]}):e.jsxs(e.Fragment,{children:[e.jsx(sa,{className:"h-4 w-4"}),"Create Full Backup"]})})]})]}),e.jsxs(X,{children:[e.jsxs(me,{children:[e.jsx(he,{children:"Restore Data"}),e.jsx(Ce,{children:"Import data from a backup file"})]}),e.jsxs(ee,{className:"space-y-4",children:[e.jsxs(Je,{children:[e.jsx(Ss,{className:"h-4 w-4"}),e.jsx(Xe,{children:"Warning: Restoring will replace current data. Make sure you have a recent backup before proceeding."})]}),e.jsx("input",{ref:s,type:"file",accept:".json",onChange:w,className:"hidden"}),e.jsxs(L,{variant:"outline",onClick:()=>s.current?.click(),disabled:t||n,className:"gap-2",children:[e.jsx(ea,{className:"h-4 w-4"}),"Select Backup File"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Supported format: JSON backup files created by this system"})]})]}),e.jsx(as,{open:d,onOpenChange:x,children:e.jsxs(Ze,{className:"max-w-2xl",children:[e.jsxs(es,{children:[e.jsx(ts,{children:"Confirm Data Restore"}),e.jsxs(rs,{children:["You are about to restore data from: ",y?.name]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs(Je,{children:[e.jsx(Ss,{className:"h-4 w-4"}),e.jsx(Xe,{children:"This operation will modify your database. Please review the options carefully."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(q,{children:"Create Safety Backup First"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Backup current data before restoring"})]}),e.jsx(As,{checked:T.createSafetyBackup,onCheckedChange:D=>O({...T,createSafetyBackup:D})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(q,{children:"Clear Existing Data"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Remove all current data before restore"})]}),e.jsx(As,{checked:T.clearExisting,onCheckedChange:D=>O({...T,clearExisting:D})})]}),e.jsxs("div",{children:[e.jsx(q,{children:"Handle ID Conflicts"}),e.jsxs(re,{value:T.handleIdConflicts,onValueChange:D=>O({...T,handleIdConflicts:D}),children:[e.jsx(te,{children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(N,{value:"skip",children:"Skip existing records"}),e.jsx(N,{value:"overwrite",children:"Overwrite existing records"}),e.jsx(N,{value:"new",children:"Create with new IDs"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(q,{children:"Stop on Error"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Stop restore if any error occurs"})]}),e.jsx(As,{checked:T.stopOnError,onCheckedChange:D=>O({...T,stopOnError:D})})]})]})]}),e.jsxs(ss,{children:[e.jsx(L,{variant:"outline",onClick:()=>x(!1),children:"Cancel"}),e.jsxs(L,{onClick:P,className:"gap-2",children:[e.jsx(Ys,{className:"h-4 w-4"}),"Start Restore"]})]})]})})]})}function Kc(){const{toast:r}=Ie(),[s,t]=m.useState({minPasswordLength:"8",requireUppercase:!0,requireLowercase:!0,requireNumbers:!0,requireSpecialChars:!0,passwordExpiry:"90",sessionTimeout:"30",maxSessions:"3",enable2FA:!1,loginAttempts:"5",lockoutDuration:"30"});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(X,{children:[e.jsxs(me,{children:[e.jsxs(he,{className:"flex items-center gap-2",children:[e.jsx(ii,{className:"h-5 w-5"}),"Password Policy"]}),e.jsx(Ce,{children:"Configure password requirements"})]}),e.jsxs(ee,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(q,{children:"Minimum Password Length"}),e.jsxs(re,{value:s.minPasswordLength,onValueChange:a=>t({...s,minPasswordLength:a}),children:[e.jsx(te,{children:e.jsx(ne,{})}),e.jsx(ae,{children:[6,8,10,12,16].map(a=>e.jsxs(N,{value:String(a),children:[a," characters"]},a))})]})]}),e.jsxs("div",{children:[e.jsx(q,{children:"Password Expiry"}),e.jsxs(re,{value:s.passwordExpiry,onValueChange:a=>t({...s,passwordExpiry:a}),children:[e.jsx(te,{children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(N,{value:"never",children:"Never"}),e.jsx(N,{value:"30",children:"30 days"}),e.jsx(N,{value:"60",children:"60 days"}),e.jsx(N,{value:"90",children:"90 days"})]})]})]})]}),e.jsx("div",{className:"space-y-3",children:[{key:"requireUppercase",label:"Require Uppercase Letters"},{key:"requireLowercase",label:"Require Lowercase Letters"},{key:"requireNumbers",label:"Require Numbers"},{key:"requireSpecialChars",label:"Require Special Characters"}].map(({key:a,label:n})=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(q,{children:n}),e.jsx(As,{checked:s[a],onCheckedChange:i=>t({...s,[a]:i})})]},a))})]})]}),e.jsxs(X,{children:[e.jsxs(me,{children:[e.jsxs(he,{className:"flex items-center gap-2",children:[e.jsx(gr,{className:"h-5 w-5"}),"Session Management"]}),e.jsx(Ce,{children:"Control user sessions and timeouts"})]}),e.jsx(ee,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(q,{children:"Session Timeout (minutes)"}),e.jsxs(re,{value:s.sessionTimeout,onValueChange:a=>t({...s,sessionTimeout:a}),children:[e.jsx(te,{children:e.jsx(ne,{})}),e.jsx(ae,{children:[15,30,60,120].map(a=>e.jsxs(N,{value:String(a),children:[a," minutes"]},a))})]})]}),e.jsxs("div",{children:[e.jsx(q,{children:"Max Concurrent Sessions"}),e.jsxs(re,{value:s.maxSessions,onValueChange:a=>t({...s,maxSessions:a}),children:[e.jsx(te,{children:e.jsx(ne,{})}),e.jsx(ae,{children:[1,2,3,5,10].map(a=>e.jsxs(N,{value:String(a),children:[a," session",a>1?"s":""]},a))})]})]})]})})]}),e.jsxs(X,{children:[e.jsxs(me,{children:[e.jsxs(he,{className:"flex items-center gap-2",children:[e.jsx(mr,{className:"h-5 w-5"}),"Access Control"]}),e.jsx(Ce,{children:"Configure login security"})]}),e.jsxs(ee,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(q,{children:"Enable Two-Factor Authentication (2FA)"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Require 2FA for all users"})]}),e.jsx(As,{checked:s.enable2FA,onCheckedChange:a=>t({...s,enable2FA:a})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(q,{children:"Login Attempt Limit"}),e.jsxs(re,{value:s.loginAttempts,onValueChange:a=>t({...s,loginAttempts:a}),children:[e.jsx(te,{children:e.jsx(ne,{})}),e.jsx(ae,{children:[3,5,10].map(a=>e.jsxs(N,{value:String(a),children:[a," attempts"]},a))})]})]}),e.jsxs("div",{children:[e.jsx(q,{children:"Account Lockout Duration"}),e.jsxs(re,{value:s.lockoutDuration,onValueChange:a=>t({...s,lockoutDuration:a}),children:[e.jsx(te,{children:e.jsx(ne,{})}),e.jsx(ae,{children:[15,30,60].map(a=>e.jsxs(N,{value:String(a),children:[a," minutes"]},a))})]})]})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(L,{onClick:()=>r({title:"Security settings saved"}),className:"gap-2",children:[e.jsx(na,{className:"h-4 w-4"}),"Save Security Settings"]})})]})}function Vc(){const{toast:r}=Ie(),[s,t]=m.useState({host:"smtp.gmail.com",port:"587",username:"noreply@molaga.com",password:"",fromEmail:"noreply@molaga.com",fromName:"Molaga ERP",useTLS:!0}),[a,n]=m.useState({lowStockAlerts:!0,taskCompletion:!0,backupStatus:!0,userLogin:!1,dataImportExport:!0});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(X,{children:[e.jsxs(me,{children:[e.jsxs(he,{className:"flex items-center gap-2",children:[e.jsx($a,{className:"h-5 w-5"}),"Email Configuration"]}),e.jsx(Ce,{children:"Configure SMTP settings for email notifications"})]}),e.jsxs(ee,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(q,{children:"SMTP Host"}),e.jsx(z,{value:s.host,onChange:i=>t({...s,host:i.target.value})})]}),e.jsxs("div",{children:[e.jsx(q,{children:"SMTP Port"}),e.jsx(z,{value:s.port,onChange:i=>t({...s,port:i.target.value})})]}),e.jsxs("div",{children:[e.jsx(q,{children:"Username"}),e.jsx(z,{value:s.username,onChange:i=>t({...s,username:i.target.value})})]}),e.jsxs("div",{children:[e.jsx(q,{children:"Password"}),e.jsx(z,{type:"password",value:s.password,onChange:i=>t({...s,password:i.target.value})})]}),e.jsxs("div",{children:[e.jsx(q,{children:"From Email"}),e.jsx(z,{type:"email",value:s.fromEmail,onChange:i=>t({...s,fromEmail:i.target.value})})]}),e.jsxs("div",{children:[e.jsx(q,{children:"From Name"}),e.jsx(z,{value:s.fromName,onChange:i=>t({...s,fromName:i.target.value})})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(q,{children:"Use TLS/SSL"}),e.jsx(As,{checked:s.useTLS,onCheckedChange:i=>t({...s,useTLS:i})})]}),e.jsxs(L,{variant:"outline",className:"gap-2",children:[e.jsx(oi,{className:"h-4 w-4"}),"Send Test Email"]})]})]}),e.jsxs(X,{children:[e.jsxs(me,{children:[e.jsx(he,{children:"Notification Preferences"}),e.jsx(Ce,{children:"Choose which notifications to receive"})]}),e.jsx(ee,{className:"space-y-4",children:[{key:"lowStockAlerts",label:"Low Stock Alerts",desc:"Get notified when stock falls below minimum level"},{key:"taskCompletion",label:"Task Completion",desc:"Notifications when tasks are completed"},{key:"backupStatus",label:"Backup Success/Failure",desc:"Get notified about backup operations"},{key:"userLogin",label:"User Login Alerts",desc:"Notifications for user login activity"},{key:"dataImportExport",label:"Data Import/Export Status",desc:"Updates on data operations"}].map(({key:i,label:l,desc:u})=>e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{children:[e.jsx(q,{children:l}),e.jsx("p",{className:"text-sm text-muted-foreground",children:u})]}),e.jsx(As,{checked:a[i],onCheckedChange:c=>n({...a,[i]:c})})]},i))})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(L,{onClick:()=>r({title:"Notification settings saved"}),className:"gap-2",children:[e.jsx(na,{className:"h-4 w-4"}),"Save Settings"]})})]})}const tr="molaga_data_settings",ar={importFormat:"csv",exportFormat:"csv",dateFormat:"DD/MM/YYYY",encoding:"utf8"};class Bc{settings;constructor(){this.settings=this.loadSettings()}loadSettings(){try{const s=localStorage.getItem(tr);if(s)return{...ar,...JSON.parse(s)}}catch(s){console.error("Error loading data settings:",s)}return ar}saveSettings(){try{localStorage.setItem(tr,JSON.stringify(this.settings))}catch(s){console.error("Error saving data settings:",s)}}getSettings(){return{...this.settings}}updateSettings(s){return this.settings={...this.settings,...s},this.saveSettings(),this.getSettings()}async archiveOldRecords(s){return new Promise(t=>{setTimeout(()=>{t({success:!0,count:0})},1e3)})}async deleteCancelledTasks(s){return new Promise(t=>{setTimeout(()=>{t({success:!0,count:0})},1e3)})}async clearAuditLogs(s){return new Promise(t=>{setTimeout(()=>{t({success:!0,count:0})},1e3)})}async optimizeDatabase(){return new Promise(s=>{setTimeout(()=>{s({success:!0,message:"Database optimized successfully"})},2e3)})}}const xt=new Bc;function Qc(){const[r,s]=m.useState(xt.getSettings()),[t,a]=m.useState(!1),n=m.useCallback(o=>{const d=xt.updateSettings(o);return s(d),d},[]),i=m.useCallback(async o=>{a(!0);try{return await xt.archiveOldRecords(o)}finally{a(!1)}},[]),l=m.useCallback(async o=>{a(!0);try{return await xt.deleteCancelledTasks(o)}finally{a(!1)}},[]),u=m.useCallback(async o=>{a(!0);try{return await xt.clearAuditLogs(o)}finally{a(!1)}},[]),c=m.useCallback(async()=>{a(!0);try{return await xt.optimizeDatabase()}finally{a(!1)}},[]);return{settings:r,updateSettings:n,archiveOldRecords:i,deleteCancelledTasks:l,clearAuditLogs:u,optimizeDatabase:c,isProcessing:t}}function Hc(){const{toast:r}=Ie(),{settings:s,updateSettings:t,archiveOldRecords:a,deleteCancelledTasks:n,clearAuditLogs:i,optimizeDatabase:l,isProcessing:u}=Qc(),c=async()=>{if(!confirm("Are you sure you want to archive old records?"))return;const y=await a(12);y.success&&r({title:`Archived ${y.count} records successfully`})},o=async()=>{if(!confirm("Are you sure you want to delete cancelled tasks?"))return;const y=await n(90);y.success&&r({title:`Deleted ${y.count} tasks successfully`})},d=async()=>{if(!confirm("Are you sure you want to clear audit logs?"))return;const y=await i(6);y.success&&r({title:`Cleared ${y.count} log entries successfully`})},x=async()=>{const y=await l();y.success&&r({title:y.message})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(X,{children:[e.jsxs(me,{children:[e.jsxs(he,{className:"flex items-center gap-2",children:[e.jsx(vt,{className:"h-5 w-5"}),"Import/Export Settings"]}),e.jsx(Ce,{children:"Configure default import and export preferences"})]}),e.jsx(ee,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(q,{children:"Default Import Format"}),e.jsxs(re,{value:s.importFormat,onValueChange:y=>t({importFormat:y}),children:[e.jsx(te,{children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(N,{value:"csv",children:"CSV"}),e.jsx(N,{value:"excel",children:"Excel"}),e.jsx(N,{value:"json",children:"JSON"})]})]})]}),e.jsxs("div",{children:[e.jsx(q,{children:"Default Export Format"}),e.jsxs(re,{value:s.exportFormat,onValueChange:y=>t({exportFormat:y}),children:[e.jsx(te,{children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(N,{value:"csv",children:"CSV"}),e.jsx(N,{value:"excel",children:"Excel"}),e.jsx(N,{value:"pdf",children:"PDF"})]})]})]}),e.jsxs("div",{children:[e.jsx(q,{children:"Date Format for Import/Export"}),e.jsxs(re,{value:s.dateFormat,onValueChange:y=>t({dateFormat:y}),children:[e.jsx(te,{children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(N,{value:"DD/MM/YYYY",children:"DD/MM/YYYY"}),e.jsx(N,{value:"MM/DD/YYYY",children:"MM/DD/YYYY"}),e.jsx(N,{value:"YYYY-MM-DD",children:"YYYY-MM-DD"})]})]})]}),e.jsxs("div",{children:[e.jsx(q,{children:"File Encoding"}),e.jsxs(re,{value:s.encoding,onValueChange:y=>t({encoding:y}),children:[e.jsx(te,{children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(N,{value:"utf8",children:"UTF-8"}),e.jsx(N,{value:"utf16",children:"UTF-16"}),e.jsx(N,{value:"ascii",children:"ASCII"})]})]})]})]})})]}),e.jsxs(X,{children:[e.jsxs(me,{children:[e.jsxs(he,{className:"flex items-center gap-2",children:[e.jsx($s,{className:"h-5 w-5"}),"Data Cleanup"]}),e.jsx(Ce,{children:"Manage old and unnecessary data"})]}),e.jsxs(ee,{className:"space-y-4",children:[e.jsxs(Je,{children:[e.jsx(Ss,{className:"h-4 w-4"}),e.jsx(Xe,{children:"Data cleanup operations are permanent. Always create a backup before proceeding."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx(q,{children:"Archive Old Records"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Move records older than 12 months to archive"})]}),e.jsx(L,{variant:"outline",onClick:c,disabled:u,children:u?e.jsx(Oe,{className:"h-4 w-4 animate-spin"}):"Archive"})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx(q,{children:"Delete Cancelled Tasks"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Remove cancelled tasks older than 90 days"})]}),e.jsx(L,{variant:"outline",onClick:o,disabled:u,children:u?e.jsx(Oe,{className:"h-4 w-4 animate-spin"}):"Delete"})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx(q,{children:"Clear Audit Logs"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Remove audit logs older than 6 months"})]}),e.jsx(L,{variant:"outline",onClick:d,disabled:u,children:u?e.jsx(Oe,{className:"h-4 w-4 animate-spin"}):"Clear"})]})]})]})]}),e.jsxs(X,{children:[e.jsxs(me,{children:[e.jsxs(he,{className:"flex items-center gap-2",children:[e.jsx(sa,{className:"h-5 w-5"}),"Database Maintenance"]}),e.jsx(Ce,{children:"Optimize database performance"})]}),e.jsx(ee,{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx(q,{children:"Optimize Database"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Rebuild indexes and optimize tables"})]}),e.jsx(L,{variant:"outline",onClick:x,disabled:u,children:u?e.jsx(Oe,{className:"h-4 w-4 animate-spin"}):"Optimize"})]})})]})]})}const gt="molaga_api_keys";class zc{generateKey(s,t,a){const n=this.createSecureKey(),i=new Date,l={id:this.generateId(),name:s,key:n,createdAt:i.toISOString(),expiresAt:a?new Date(i.getTime()+a*24*60*60*1e3).toISOString():void 0,permissions:t,isActive:!0};return this.saveKey(l),l}createSecureKey(){const s="mlg",t=this.generateRandomString(32);return`${s}_${t}`}generateRandomString(s){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let a="";const n=new Uint8Array(s);crypto.getRandomValues(n);for(let i=0;i<s;i++)a+=t[n[i]%t.length];return a}generateId(){return`key_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}saveKey(s){const t=this.getAllKeys();t.push(s),localStorage.setItem(gt,JSON.stringify(t))}getAllKeys(){try{const s=localStorage.getItem(gt);return s?JSON.parse(s):[]}catch(s){return console.error("Error loading API keys:",s),[]}}getKeyById(s){return this.getAllKeys().find(a=>a.id===s)||null}revokeKey(s){const t=this.getAllKeys(),a=t.findIndex(n=>n.id===s);return a!==-1?(t[a].isActive=!1,localStorage.setItem(gt,JSON.stringify(t)),!0):!1}deleteKey(s){const t=this.getAllKeys(),a=t.filter(n=>n.id!==s);return a.length!==t.length?(localStorage.setItem(gt,JSON.stringify(a)),!0):!1}validateKey(s){const a=this.getAllKeys().find(n=>n.key===s);return a?a.isActive?a.expiresAt&&new Date(a.expiresAt)<new Date?{valid:!1,error:"API key has expired"}:{valid:!0,apiKey:a}:{valid:!1,error:"API key has been revoked"}:{valid:!1,error:"Invalid API key"}}updateLastUsed(s){const t=this.getAllKeys(),a=t.findIndex(n=>n.id===s);a!==-1&&(t[a].lastUsed=new Date().toISOString(),localStorage.setItem(gt,JSON.stringify(t)))}regenerateKey(s){const t=this.getAllKeys(),a=t.findIndex(n=>n.id===s);return a!==-1?(t[a],t[a].key=this.createSecureKey(),t[a].createdAt=new Date().toISOString(),t[a].lastUsed=void 0,localStorage.setItem(gt,JSON.stringify(t)),t[a]):null}}const Hs=new zc;function Yc(){const{toast:r}=Ie(),{user:s}=us(),[t,a]=m.useState(Hs.getAllKeys()),[n,i]=m.useState(!1),[l,u]=m.useState(!1),[c,o]=m.useState({name:"",expiresIn:"90",permissions:["read"]}),[d,x]=m.useState(null),y=s?.email==="varda3d@gmail.com",b=()=>{if(!c.name.trim()){r({title:"Validation error",description:"Please enter a key name",variant:"destructive"});return}const _=c.expiresIn==="never"?void 0:parseInt(c.expiresIn),U=Hs.generateKey(c.name,c.permissions,_);x(U),a(Hs.getAllKeys()),i(!1),u(!0),o({name:"",expiresIn:"90",permissions:["read"]}),r({title:"API key created",description:"Copy the key now - it won't be shown again"})},T=_=>{navigator.clipboard.writeText(_),r({title:"Copied",description:"API key copied to clipboard"})},O=_=>{Hs.revokeKey(_),a(Hs.getAllKeys()),r({title:"API key revoked",description:"The key can no longer be used"})},g=_=>{Hs.deleteKey(_),a(Hs.getAllKeys()),r({title:"API key deleted",description:"The key has been permanently removed"})},w=_=>{const U=Hs.regenerateKey(_);U&&(x(U),a(Hs.getAllKeys()),u(!0),r({title:"API key regenerated",description:"Copy the new key now"}))},P=_=>new Date(_).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),D=_=>_&&new Date(_)<new Date;return y?e.jsxs("div",{className:"space-y-6",children:[e.jsxs(X,{children:[e.jsx(me,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(he,{className:"flex items-center gap-2",children:[e.jsx(_a,{className:"h-5 w-5"}),"API Keys"]}),e.jsx(Ce,{children:"Generate and manage API keys for external integrations"})]}),e.jsxs(L,{onClick:()=>i(!0),className:"gap-2",children:[e.jsx(vs,{className:"h-4 w-4"}),"Create API Key"]})]})}),e.jsxs(ee,{children:[e.jsxs(Je,{className:"mb-6",children:[e.jsx(Ss,{className:"h-4 w-4"}),e.jsxs(Xe,{children:[e.jsx("strong",{children:"Security Notice:"})," API keys provide access to your system. Keep them secure and never share them publicly."]})]}),t.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(_a,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No API keys created yet"}),e.jsx("p",{className:"text-sm",children:"Create your first API key to get started"})]}):e.jsx("div",{className:"space-y-4",children:t.map(_=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h4",{className:"font-medium",children:_.name}),_.isActive?D(_.expiresAt)?e.jsx(Ve,{variant:"destructive",children:"Expired"}):e.jsx(Ve,{variant:"default",className:"bg-green-500",children:"Active"}):e.jsx(Ve,{variant:"secondary",children:"Revoked"})]}),e.jsxs("div",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsxs("p",{children:["Key: ",_.key.substring(0,20),"...",_.key.substring(_.key.length-4)]}),e.jsxs("p",{children:["Created: ",P(_.createdAt)]}),_.expiresAt&&e.jsxs("p",{children:["Expires: ",P(_.expiresAt)]}),_.lastUsed&&e.jsxs("p",{children:["Last used: ",P(_.lastUsed)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(L,{variant:"outline",size:"sm",onClick:()=>T(_.key),className:"gap-2",children:[e.jsx($t,{className:"h-3 w-3"}),"Copy"]}),_.isActive&&!D(_.expiresAt)&&e.jsxs(e.Fragment,{children:[e.jsxs(L,{variant:"outline",size:"sm",onClick:()=>w(_.id),className:"gap-2",children:[e.jsx(Ea,{className:"h-3 w-3"}),"Regenerate"]}),e.jsx(L,{variant:"outline",size:"sm",onClick:()=>O(_.id),className:"gap-2 text-orange-600 hover:text-orange-700",children:"Revoke"})]}),e.jsxs(L,{variant:"outline",size:"sm",onClick:()=>g(_.id),className:"gap-2 text-red-600 hover:text-red-700",children:[e.jsx($s,{className:"h-3 w-3"}),"Delete"]})]})]},_.id))})]})]}),e.jsx(as,{open:n,onOpenChange:i,children:e.jsxs(Ze,{children:[e.jsxs(es,{children:[e.jsx(ts,{children:"Create New API Key"}),e.jsx(rs,{children:"Generate a new API key for external integrations"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(q,{htmlFor:"keyName",children:"Key Name *"}),e.jsx(z,{id:"keyName",placeholder:"e.g., Mobile App Integration",value:c.name,onChange:_=>o({...c,name:_.target.value})})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"expiresIn",children:"Expires In"}),e.jsxs(re,{value:c.expiresIn,onValueChange:_=>o({...c,expiresIn:_}),children:[e.jsx(te,{children:e.jsx(ne,{})}),e.jsxs(ae,{children:[e.jsx(N,{value:"30",children:"30 days"}),e.jsx(N,{value:"90",children:"90 days"}),e.jsx(N,{value:"180",children:"180 days"}),e.jsx(N,{value:"365",children:"1 year"}),e.jsx(N,{value:"never",children:"Never"})]})]})]})]}),e.jsxs(ss,{children:[e.jsx(L,{variant:"outline",onClick:()=>i(!1),children:"Cancel"}),e.jsx(L,{onClick:b,children:"Create Key"})]})]})}),e.jsx(as,{open:l,onOpenChange:u,children:e.jsxs(Ze,{children:[e.jsxs(es,{children:[e.jsxs(ts,{className:"flex items-center gap-2",children:[e.jsx(Ys,{className:"h-5 w-5 text-green-500"}),"API Key Created"]}),e.jsx(rs,{children:"Copy this key now - it won't be shown again"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs(Je,{children:[e.jsx(Ss,{className:"h-4 w-4"}),e.jsx(Xe,{children:"Store this key securely. You won't be able to see it again."})]}),e.jsxs("div",{children:[e.jsx(q,{children:"API Key"}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(z,{value:d?.key||"",readOnly:!0,className:"font-mono text-sm"}),e.jsxs(L,{variant:"outline",onClick:()=>T(d?.key||""),className:"gap-2",children:[e.jsx($t,{className:"h-4 w-4"}),"Copy"]})]})]})]}),e.jsx(ss,{children:e.jsx(L,{onClick:()=>u(!1),children:"Done"})})]})})]}):e.jsxs(Je,{children:[e.jsx(Ss,{className:"h-4 w-4"}),e.jsx(Xe,{children:"Only Super Admins can manage API keys. Contact your administrator for access."})]})}const rr="molaga_custom_domain";class Wc{getConfig(){try{const s=localStorage.getItem(rr);if(s)return JSON.parse(s)}catch(s){console.error("Error loading domain config:",s)}return{customDomain:null,isVerified:!1,verificationToken:this.generateVerificationToken(),verifiedAt:null,createdAt:null}}setDomain(s){const t=this.getConfig();t.customDomain=s,t.isVerified=!1,t.verifiedAt=null,t.createdAt=new Date().toISOString(),t.verificationToken||(t.verificationToken=this.generateVerificationToken()),this.saveConfig(t)}verifyDomain(){const s=this.getConfig();s.isVerified=!0,s.verifiedAt=new Date().toISOString(),this.saveConfig(s)}removeDomain(){const s={customDomain:null,isVerified:!1,verificationToken:this.generateVerificationToken(),verifiedAt:null,createdAt:null};this.saveConfig(s)}generateVerificationToken(){const s=new Uint8Array(16);return crypto.getRandomValues(s),Array.from(s,t=>t.toString(16).padStart(2,"0")).join("")}saveConfig(s){try{localStorage.setItem(rr,JSON.stringify(s))}catch(t){console.error("Error saving domain config:",t)}}isCustomDomainActive(){const s=this.getConfig();return!!(s.customDomain&&s.isVerified)}getActiveDomain(){const s=this.getConfig();return s.isVerified?s.customDomain:null}}const it=new Wc;function Gc(){const{toast:r}=Ie(),{user:s}=us(),[t,a]=m.useState(it.getConfig()),[n,i]=m.useState(t.customDomain||""),[l,u]=m.useState(!1),c=s?.email==="varda3d@gmail.com",o=()=>{if(!n.trim()){r({title:"Validation error",description:"Please enter a domain name",variant:"destructive"});return}if(!/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(n)){r({title:"Invalid domain",description:"Please enter a valid domain name (e.g., erp.yourcompany.com)",variant:"destructive"});return}it.setDomain(n),a(it.getConfig()),r({title:"Domain saved",description:"Custom domain configuration updated"})},d=async()=>{u(!0),setTimeout(()=>{Math.random()>.3?(it.verifyDomain(),a(it.getConfig()),r({title:"Domain verified",description:"Your custom domain is now active"})):r({title:"Verification failed",description:"Please check your DNS records and try again",variant:"destructive"}),u(!1)},2e3)},x=()=>{it.removeDomain(),a(it.getConfig()),i(""),r({title:"Domain removed",description:"Custom domain configuration has been removed"})},y=b=>{navigator.clipboard.writeText(b),r({title:"Copied",description:"Copied to clipboard"})};return c?e.jsx("div",{className:"space-y-6",children:e.jsxs(X,{children:[e.jsxs(me,{children:[e.jsxs(he,{className:"flex items-center gap-2",children:[e.jsx(ka,{className:"h-5 w-5"}),"Custom Domain"]}),e.jsx(Ce,{children:"Configure a custom domain for your ERP system"})]}),e.jsxs(ee,{className:"space-y-6",children:[e.jsxs(Je,{children:[e.jsx(Ss,{className:"h-4 w-4"}),e.jsxs(Xe,{children:[e.jsx("strong",{children:"Note:"})," Custom domain configuration requires DNS changes. Make sure you have access to your domain's DNS settings."]})]}),t.customDomain&&e.jsxs("div",{className:"p-4 border rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ka,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:t.customDomain})]}),t.isVerified?e.jsxs(Ve,{className:"bg-green-500",children:[e.jsx(Ys,{className:"h-3 w-3 mr-1"}),"Verified"]}):e.jsx(Ve,{variant:"secondary",children:"Pending Verification"})]}),t.verifiedAt&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Verified on ",new Date(t.verifiedAt).toLocaleDateString()]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(q,{htmlFor:"domain",children:"Domain Name"}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(z,{id:"domain",placeholder:"erp.yourcompany.com",value:n,onChange:b=>i(b.target.value),disabled:t.isVerified}),t.isVerified?e.jsx(L,{variant:"outline",onClick:x,className:"text-red-600",children:"Remove"}):e.jsx(L,{onClick:o,children:"Save"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Enter your custom domain (e.g., erp.yourcompany.com)"})]}),t.customDomain&&!t.isVerified&&e.jsxs(X,{children:[e.jsxs(me,{children:[e.jsx(he,{className:"text-base",children:"DNS Configuration"}),e.jsx(Ce,{children:"Add these DNS records to your domain provider"})]}),e.jsxs(ee,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"p-3 border rounded-lg bg-muted/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Type: CNAME"}),e.jsx(L,{variant:"ghost",size:"sm",onClick:()=>y("CNAME"),className:"h-6 px-2",children:e.jsx($t,{className:"h-3 w-3"})})]}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," ",t.customDomain]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Value:"})," molaga-erp.app"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"TTL:"})," 3600"]})]})]}),e.jsxs("div",{className:"p-3 border rounded-lg bg-muted/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Type: TXT (Verification)"}),e.jsx(L,{variant:"ghost",size:"sm",onClick:()=>y(`molaga-verification=${t.verificationToken}`),className:"h-6 px-2",children:e.jsx($t,{className:"h-3 w-3"})})]}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," _molaga-verification.",t.customDomain]}),e.jsxs("p",{className:"break-all",children:[e.jsx("strong",{children:"Value:"})," molaga-verification=",t.verificationToken]}),e.jsxs("p",{children:[e.jsx("strong",{children:"TTL:"})," 3600"]})]})]})]}),e.jsxs(Je,{children:[e.jsx(Ss,{className:"h-4 w-4"}),e.jsx(Xe,{children:'DNS changes can take up to 48 hours to propagate. After adding the records, click "Verify Domain" below.'})]}),e.jsx(L,{onClick:d,disabled:l,className:"w-full gap-2",children:l?e.jsx(e.Fragment,{children:"Verifying..."}):e.jsxs(e.Fragment,{children:[e.jsx(Ys,{className:"h-4 w-4"}),"Verify Domain"]})})]})]}),t.isVerified&&e.jsxs(X,{children:[e.jsxs(me,{children:[e.jsx(he,{className:"text-base",children:"SSL Certificate"}),e.jsx(Ce,{children:"Your domain is secured with SSL/TLS"})]}),e.jsxs(ee,{children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-600",children:[e.jsx(Ys,{className:"h-4 w-4"}),e.jsx("span",{children:"SSL certificate is active and valid"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Your custom domain is secured with automatic SSL certificate provisioning."})]})]}),e.jsxs(X,{children:[e.jsx(me,{children:e.jsx(he,{className:"text-base",children:"Need Help?"})}),e.jsxs(ee,{className:"space-y-2",children:[e.jsxs("a",{href:"#",className:"flex items-center gap-2 text-sm text-primary hover:underline",children:[e.jsx(Ht,{className:"h-3 w-3"}),"How to configure DNS records"]}),e.jsxs("a",{href:"#",className:"flex items-center gap-2 text-sm text-primary hover:underline",children:[e.jsx(Ht,{className:"h-3 w-3"}),"Troubleshooting domain verification"]}),e.jsxs("a",{href:"#",className:"flex items-center gap-2 text-sm text-primary hover:underline",children:[e.jsx(Ht,{className:"h-3 w-3"}),"Contact support"]})]})]})]})]})]})}):e.jsxs(Je,{children:[e.jsx(Ss,{className:"h-4 w-4"}),e.jsx(Xe,{children:"Only Super Admins can configure custom domains. Contact your administrator for access."})]})}function Jc(){Ie();const{user:r}=us(),[s,t]=m.useState("overview"),a=r?.email==="varda3d@gmail.com";return e.jsxs("div",{className:"space-y-6",children:[!a&&e.jsxs(Je,{children:[e.jsx(Ss,{className:"h-4 w-4"}),e.jsxs(Xe,{children:[e.jsx("strong",{children:"Read-Only Mode:"})," Only Super Admin (varda3d@gmail.com) can modify integration settings."]})]}),e.jsxs($n,{value:s,onValueChange:t,children:[e.jsxs(Ua,{className:"grid w-full grid-cols-4",children:[e.jsx(jt,{value:"overview",children:"Overview"}),e.jsx(jt,{value:"api-keys",children:"API Keys"}),e.jsx(jt,{value:"domain",children:"Custom Domain"}),e.jsx(jt,{value:"webhooks",children:"Webhooks"})]}),e.jsxs(fs,{value:"overview",className:"space-y-6 mt-6",children:[e.jsxs(X,{children:[e.jsxs(me,{children:[e.jsxs(he,{className:"flex items-center gap-2",children:[e.jsx(_a,{className:"h-5 w-5"}),"API Configuration"]}),e.jsx(Ce,{children:"Quick overview of API settings"})]}),e.jsx(ee,{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(q,{children:"API Access Status"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage API keys in the API Keys tab"})]}),e.jsx(Ve,{variant:"secondary",children:"View Details â†’"})]})})]}),e.jsxs(X,{children:[e.jsxs(me,{children:[e.jsxs(he,{className:"flex items-center gap-2",children:[e.jsx(ka,{className:"h-5 w-5"}),"Custom Domain"]}),e.jsx(Ce,{children:"Configure your custom domain"})]}),e.jsx(ee,{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(q,{children:"Domain Status"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Configure custom domain in the Custom Domain tab"})]}),e.jsx(Ve,{variant:"secondary",children:"View Details â†’"})]})})]}),e.jsxs(X,{children:[e.jsxs(me,{children:[e.jsxs(he,{className:"flex items-center gap-2",children:[e.jsx(li,{className:"h-5 w-5"}),"Third-Party Integrations"]}),e.jsx(Ce,{children:"Connect with external services"})]}),e.jsx(ee,{className:"space-y-4",children:[{name:"Accounting Software",status:"Not Connected",available:!1},{name:"Payment Gateway",status:"Not Connected",available:!1},{name:"SMS Gateway",status:"Not Connected",available:!1},{name:"Cloud Storage",status:"Not Connected",available:!1}].map(n=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx(q,{children:n.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:n.status})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!n.available&&e.jsx(Ve,{variant:"secondary",children:"Coming Soon"}),e.jsx(L,{variant:"outline",size:"sm",disabled:!n.available||!a,children:"Configure"})]})]},n.name))})]})]}),e.jsx(fs,{value:"api-keys",className:"mt-6",children:e.jsx(Yc,{})}),e.jsx(fs,{value:"domain",className:"mt-6",children:e.jsx(Gc,{})}),e.jsx(fs,{value:"webhooks",className:"space-y-6 mt-6",children:e.jsxs(X,{children:[e.jsxs(me,{children:[e.jsxs(he,{className:"flex items-center gap-2",children:[e.jsx(ci,{className:"h-5 w-5"}),"Webhooks"]}),e.jsx(Ce,{children:"Configure webhook endpoints for real-time notifications"})]}),e.jsxs(ee,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(q,{children:"Webhook URL"}),e.jsx(z,{placeholder:"https://your-domain.com/webhook",disabled:!a}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Receive POST requests when events occur"})]}),e.jsxs("div",{children:[e.jsx(q,{children:"Events to Subscribe"}),e.jsx("div",{className:"space-y-2 mt-2",children:["Task Created","Task Completed","Low Stock Alert","Backup Completed"].map(n=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:n}),e.jsx(As,{disabled:!a})]},n))})]}),e.jsx(L,{variant:"outline",disabled:!a,children:"Test Webhook"})]})]})})]})]})}function Xc(){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(X,{children:[e.jsxs(me,{children:[e.jsxs(he,{className:"flex items-center gap-2",children:[e.jsx(Ca,{className:"h-5 w-5"}),"System Information"]}),e.jsx(Ce,{children:"Details about your Molaga ERP installation"})]}),e.jsx(ee,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Application Name"}),e.jsx("p",{className:"font-medium",children:"Molaga ERP"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Version"}),e.jsxs("p",{className:"font-medium flex items-center gap-2",children:["1.0.0",e.jsxs(Ve,{variant:"default",className:"gap-1",children:[e.jsx(Ys,{className:"h-3 w-3"}),"Latest"]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Build Date"}),e.jsx("p",{className:"font-medium",children:"October 11, 2025"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"License Type"}),e.jsx("p",{className:"font-medium",children:"Enterprise"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Licensed To"}),e.jsx("p",{className:"font-medium",children:"Molaga Spices Pvt Ltd"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"License Expiry"}),e.jsx("p",{className:"font-medium",children:"October 11, 2026"})]})]})})]}),e.jsxs(X,{children:[e.jsxs(me,{children:[e.jsx(he,{children:"Support & Help"}),e.jsx(Ce,{children:"Get assistance with Molaga ERP"})]}),e.jsx(ee,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3 p-4 border rounded-lg",children:[e.jsx(vt,{className:"h-5 w-5 text-primary mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Documentation"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Comprehensive guides and tutorials"}),e.jsxs(L,{variant:"link",className:"h-auto p-0 gap-1",children:["View Docs",e.jsx(Ht,{className:"h-3 w-3"})]})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 border rounded-lg",children:[e.jsx($a,{className:"h-5 w-5 text-primary mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Email Support"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"support@molagaerp.com"}),e.jsx(L,{variant:"link",className:"h-auto p-0",children:"Send Email"})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 border rounded-lg",children:[e.jsx(di,{className:"h-5 w-5 text-primary mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Phone Support"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"+91 9876543210"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Mon-Fri, 9 AM - 6 PM IST"})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 border rounded-lg",children:[e.jsx(Ca,{className:"h-5 w-5 text-primary mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Submit Feedback"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Help us improve"}),e.jsx(L,{variant:"link",className:"h-auto p-0",children:"Give Feedback"})]})]})]})})]}),e.jsxs(X,{children:[e.jsxs(me,{children:[e.jsx(he,{children:"Updates"}),e.jsx(Ce,{children:"Check for system updates"})]}),e.jsxs(ee,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg bg-muted/50",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"You're running the latest version"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Last checked: October 11, 2025"})]}),e.jsx(L,{variant:"outline",children:"Check for Updates"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium mb-2",children:"Recent Updates"}),e.jsx("div",{className:"space-y-2",children:[{version:"1.0.0",date:"Oct 11, 2025",changes:"Initial release with full ERP features"},{version:"0.9.5",date:"Oct 1, 2025",changes:"Beta testing and bug fixes"},{version:"0.9.0",date:"Sep 15, 2025",changes:"Added validation system"}].map(r=>e.jsxs("div",{className:"p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("p",{className:"font-medium text-sm",children:["Version ",r.version]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r.date})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r.changes})]},r.version))})]})]})]}),e.jsxs(X,{children:[e.jsx(me,{children:e.jsx(he,{children:"About Molaga ERP"})}),e.jsxs(ee,{children:[e.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed",children:"Molaga ERP is a comprehensive enterprise resource planning system designed specifically for spice manufacturing businesses. It streamlines operations from raw material procurement through production processes to final product sales, providing real-time insights and data-driven decision making capabilities."}),e.jsx("p",{className:"text-sm text-muted-foreground mt-4",children:"Â© 2025 Molaga ERP. All rights reserved."})]})]})]})}const Zc=[{value:"company",label:"Company Profile",icon:lr},{value:"users",label:"User Management",icon:pr},{value:"approvals",label:"User Approvals",icon:xr},{value:"system",label:"System Config",icon:ui},{value:"backup",label:"Backup & Restore",icon:sa},{value:"security",label:"Security",icon:gr},{value:"notifications",label:"Notifications",icon:cr},{value:"data",label:"Data Management",icon:vt},{value:"integrations",label:"Integrations",icon:dt},{value:"about",label:"About",icon:Ca}];function ed(){const[r,s]=m.useState("company");return e.jsxs("div",{className:"container mx-auto p-6 max-w-7xl",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Settings"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage your system configuration and preferences"})]}),e.jsx(X,{className:"p-6",children:e.jsxs($n,{value:r,onValueChange:s,className:"space-y-6",children:[e.jsx(Ua,{className:"grid grid-cols-3 lg:grid-cols-10 gap-2 h-auto p-2",children:Zc.map(t=>e.jsxs(jt,{value:t.value,className:"flex flex-col items-center gap-1 py-3 data-[state=active]:bg-primary data-[state=active]:text-primary-foreground",children:[e.jsx(t.icon,{className:"h-4 w-4"}),e.jsx("span",{className:"text-xs",children:t.label})]},t.value))}),e.jsx(fs,{value:"company",className:"space-y-4",children:e.jsx(Cc,{})}),e.jsx(fs,{value:"users",className:"space-y-4",children:e.jsx(Ac,{})}),e.jsx(fs,{value:"approvals",className:"space-y-4",children:e.jsx($c,{})}),e.jsx(fs,{value:"system",className:"space-y-4",children:e.jsx(Lc,{})}),e.jsx(fs,{value:"backup",className:"space-y-4",children:e.jsx(Oc,{})}),e.jsx(fs,{value:"security",className:"space-y-4",children:e.jsx(Kc,{})}),e.jsx(fs,{value:"notifications",className:"space-y-4",children:e.jsx(Vc,{})}),e.jsx(fs,{value:"data",className:"space-y-4",children:e.jsx(Hc,{})}),e.jsx(fs,{value:"integrations",className:"space-y-4",children:e.jsx(Jc,{})}),e.jsx(fs,{value:"about",className:"space-y-4",children:e.jsx(Xc,{})})]})})]})}const sd=new Qi({defaultOptions:{queries:{staleTime:5*60*1e3,gcTime:10*60*1e3,retry:(r,s)=>s?.code===401||s?.code===403?!1:r<3,refetchOnWindowFocus:!1,refetchOnMount:!0,refetchOnReconnect:!0},mutations:{retry:(r,s)=>s?.code===401||s?.code===403?!1:r<2}}}),td=Li([{path:"/login",element:e.jsx(vl,{})},{path:"/register",element:e.jsx(bl,{})},{path:"/",element:e.jsx(Qe,{children:e.jsx(Be,{children:e.jsx(Pl,{})})})},{path:"/purchases",element:e.jsx(Qe,{children:e.jsx(Be,{children:e.jsx(Al,{})})})},{path:"/tasks",element:e.jsx(Qe,{children:e.jsx(Be,{children:e.jsx(Ll,{})})})},{path:"/status",element:e.jsx(Qe,{children:e.jsx(Be,{children:e.jsx(Il,{})})})},{path:"/sales",element:e.jsx(Qe,{children:e.jsx(Be,{children:e.jsx(Ml,{})})})},{path:"/sales/units",element:e.jsx(Qe,{children:e.jsx(Be,{children:e.jsx(Kl,{})})})},{path:"/sales/records",element:e.jsx(Qe,{children:e.jsx(Be,{children:e.jsx(Vl,{})})})},{path:"/master",element:e.jsx(Qe,{children:e.jsx(Be,{children:e.jsx(Bl,{})})})},{path:"/master/stocks",element:e.jsx(Qe,{children:e.jsx(Be,{children:e.jsx(zl,{})})})},{path:"/master/vendors",element:e.jsx(Qe,{children:e.jsx(Be,{children:e.jsx(Yl,{})})})},{path:"/master/staff",element:e.jsx(Qe,{children:e.jsx(Be,{children:e.jsx(Wl,{})})})},{path:"/master/processes",element:e.jsx(Qe,{children:e.jsx(Be,{children:e.jsx(Gl,{})})})},{path:"/master/raw-products",element:e.jsx(Qe,{children:e.jsx(Be,{children:e.jsx(Jl,{})})})},{path:"/master/products",element:e.jsx(Qe,{children:e.jsx(Be,{children:e.jsx(Xl,{})})})},{path:"/master/sales-channels",element:e.jsx(Qe,{children:e.jsx(Be,{children:e.jsx(Zl,{})})})},{path:"/analytics",element:e.jsx(Qe,{children:e.jsx(Be,{children:e.jsx(Ql,{})})})},{path:"/status/stock-status",element:e.jsx(Qe,{children:e.jsx(Be,{children:e.jsx(tc,{})})})},{path:"/status/pre-production-status",element:e.jsx(Qe,{children:e.jsx(Be,{children:e.jsx(nc,{})})})},{path:"/status/production-status",element:e.jsx(Qe,{children:e.jsx(Be,{children:e.jsx(oc,{})})})},{path:"/status/post-production-status",element:e.jsx(Qe,{children:e.jsx(Be,{children:e.jsx(dc,{})})})},{path:"/status/inventory-status",element:e.jsx(Qe,{children:e.jsx(Be,{children:e.jsx(uc,{})})})},{path:"/tasks/pre-production",element:e.jsx(Qe,{children:e.jsx(Be,{children:e.jsx(gc,{})})})},{path:"/tasks/production",element:e.jsx(Qe,{children:e.jsx(Be,{children:e.jsx(vc,{})})})},{path:"/tasks/post-production",element:e.jsx(Qe,{children:e.jsx(Be,{children:e.jsx(Sc,{})})})},{path:"/settings",element:e.jsx(Qe,{children:e.jsx(Be,{children:e.jsx(ed,{})})})},{path:"*",element:e.jsx(Hl,{})}],{future:{v7_startTransition:!0}}),ad=()=>e.jsx(Ii,{client:sd,children:e.jsx(uo,{children:e.jsx(Do,{children:e.jsxs(rn,{children:[e.jsx(ro,{}),e.jsx(no,{}),e.jsx(Lo,{}),e.jsx(Mi,{router:td,future:{v7_startTransition:!0}})]})})})});mi(document.getElementById("root")).render(e.jsx(ad,{}));

import{r as u,j as e,b as tt,k as Kn}from"./0-react-core-CTNHgvAJ.js";import{V as dr,R as ur,A as mr,C as pr,X as ks,T as hr,D as xr,P as Vn,j as Bn,$ as Hn,a as gr,b as zn,c as Qn,d as Yn,S as Es,W as Wn,e as qa,f as xs,g as fr,O as da,h as jr,i as ua,k as yr,l as ma,m as pa,n as vr,o as Gn,H as Jn,p as Aa,q as Fa,r as zs,s as br,t as Sa,u as $a,v as Nr,w as wr,x as Sr,y as Xn,z as _r,I as kr,B as Cr,E as Pr,F as Dr,G as Tr,J as Zn,L as Er,K as Rr,M as ei,N as ti,Q as qr,U as Ar,Y as si,Z as ai,_ as ze,a0 as Fr,a1 as $r,a2 as Rs,a3 as ri,a4 as ni,a5 as Ot,a6 as Dt,a7 as _a,a8 as Xt,a9 as ka,aa as Ir,ab as ii,ac as Cs,ad as Lr,ae as Wt,af as oi,ag as na,ah as os,ai as Qa,aj as Mr,ak as li,al as ci,am as Or,an as di,ao as pt,ap as ss,aq as Ya,ar as ui,as as mi,at as pi,au as It,av as as,aw as Ur,ax as Kr,ay as hi,az as Ia,aA as Vr,aB as xi,aC as Br,aD as gi,aE as Hr,aF as fi,aG as zr,aH as Qr,aI as ji,aJ as yi,aK as Yr,aL as vi,aM as bi,aN as Ct,aO as Wr,aP as Ni,aQ as wi,aR as Si,aS as _i,aT as Gr,aU as ki,aV as Ci,aW as Jr,aX as Xr,aY as Pi,aZ as Di,a_ as Ti,a$ as Ei,b0 as La,b1 as Zr,b2 as en,b3 as tn,b4 as Ri,b5 as Wa,b6 as ha,b7 as qi,b8 as Ys,b9 as Vs,ba as Ma,bb as sn,bc as Ai,bd as ia,be as Fi,bf as an,bg as $i,bh as Ca,bi as Pa,bj as Js,bk as Ii,bl as Li,bm as Da,bn as Mi,bo as Oi}from"./1-ui-libs-BpjiZ-VE.js";import{t as Ui,q as Ki,r as gs,u as Vi}from"./9-vendor-CWobMp5c.js";import{u as Ne,a as mt,b as Re,Q as Bi}from"./2-react-query-BDX7x6OE.js";import{u as ds,N as ja,a as qs,b as Oa,L as At,c as Hi,R as zi}from"./2-react-router-DJ5FTyjX.js";import{C as Qi,A as Yi,D as Wi,I as hs,Q as et}from"./9-appwrite-Di8VTjYU.js";import{F as Ga,P as Is,G as Ls,e as es,s as ts,H as ya,o as dt,j as Bs,I as Kt}from"./9-utils-CXq3ZHxZ.js";import{u as St,w as Ja,r as Gi,a as Ji}from"./9-xlsx-eYdzo_tC.js";import"./2-react-deps-DlpLfDCO.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function s(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(n){if(n.ep)return;n.ep=!0;const i=s(n);fetch(n.href,i)}})();const Xi=1,Zi=1e6;let va=0;function eo(){return va=(va+1)%Number.MAX_SAFE_INTEGER,va.toString()}const ba=new Map,Xa=r=>{if(ba.has(r))return;const t=setTimeout(()=>{ba.delete(r),Ks({type:"REMOVE_TOAST",toastId:r})},Zi);ba.set(r,t)},to=(r,t)=>{switch(t.type){case"ADD_TOAST":return{...r,toasts:[t.toast,...r.toasts].slice(0,Xi)};case"UPDATE_TOAST":return{...r,toasts:r.toasts.map(s=>s.id===t.toast.id?{...s,...t.toast}:s)};case"DISMISS_TOAST":{const{toastId:s}=t;return s?Xa(s):r.toasts.forEach(a=>{Xa(a.id)}),{...r,toasts:r.toasts.map(a=>a.id===s||s===void 0?{...a,open:!1}:a)}}case"REMOVE_TOAST":return t.toastId===void 0?{...r,toasts:[]}:{...r,toasts:r.toasts.filter(s=>s.id!==t.toastId)}}},Xs=[];let Zs={toasts:[]};function Ks(r){Zs=to(Zs,r),Xs.forEach(t=>{t(Zs)})}function so({...r}){const t=eo(),s=n=>Ks({type:"UPDATE_TOAST",toast:{...n,id:t}}),a=()=>Ks({type:"DISMISS_TOAST",toastId:t});return Ks({type:"ADD_TOAST",toast:{...r,id:t,open:!0,onOpenChange:n=>{n||a()}}}),{id:t,dismiss:a,update:s}}function Ie(){const[r,t]=u.useState(Zs);return u.useEffect(()=>(Xs.push(t),()=>{const s=Xs.indexOf(t);s>-1&&Xs.splice(s,1)}),[r]),{...r,toast:so,dismiss:s=>Ks({type:"DISMISS_TOAST",toastId:s})}}function me(...r){return Ui(Ki(r))}const ao=Vn,rn=u.forwardRef(({className:r,...t},s)=>e.jsx(dr,{ref:s,className:me("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",r),...t}));rn.displayName=dr.displayName;const ro=gs("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),nn=u.forwardRef(({className:r,variant:t,...s},a)=>e.jsx(ur,{ref:a,className:me(ro({variant:t}),r),...s}));nn.displayName=ur.displayName;const no=u.forwardRef(({className:r,...t},s)=>e.jsx(mr,{ref:s,className:me("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors group-[.destructive]:border-muted/40 hover:bg-secondary group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 group-[.destructive]:focus:ring-destructive disabled:pointer-events-none disabled:opacity-50",r),...t}));no.displayName=mr.displayName;const on=u.forwardRef(({className:r,...t},s)=>e.jsx(pr,{ref:s,className:me("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity group-hover:opacity-100 group-[.destructive]:text-red-300 hover:text-foreground group-[.destructive]:hover:text-red-50 focus:opacity-100 focus:outline-none focus:ring-2 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",r),"toast-close":"",...t,children:e.jsx(ks,{className:"h-4 w-4"})}));on.displayName=pr.displayName;const ln=u.forwardRef(({className:r,...t},s)=>e.jsx(hr,{ref:s,className:me("text-sm font-semibold",r),...t}));ln.displayName=hr.displayName;const cn=u.forwardRef(({className:r,...t},s)=>e.jsx(xr,{ref:s,className:me("text-sm opacity-90",r),...t}));cn.displayName=xr.displayName;function io(){const{toasts:r}=Ie();return e.jsxs(ao,{children:[r.map(function({id:t,title:s,description:a,action:n,...i}){return e.jsxs(nn,{...i,children:[e.jsxs("div",{className:"grid gap-1",children:[s&&e.jsx(ln,{children:s}),a&&e.jsx(cn,{children:a})]}),n,e.jsx(on,{})]},t)}),e.jsx(rn,{})]})}const oo=({...r})=>{const{theme:t="system"}=Bn();return e.jsx(Hn,{theme:t,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...r})},dn=zn,lo=Qn,co=Yn,un=u.forwardRef(({className:r,sideOffset:t=4,...s},a)=>e.jsx(gr,{ref:a,sideOffset:t,className:me("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...s}));un.displayName=gr.displayName;const ke={PRE_PRODUCTION_STATUS:"pre_production_status",PRODUCTION_STATUS:"production_status",POST_PRODUCTION_STATUS:"post_production_status",INVENTORY_STATUS:"inventory_status",STOCK_STATUS:"stock_status",TASKS:"tasks",PRE_PRODUCTION_TASKS:"pre_production_tasks",PRODUCTION_TASKS:"production_tasks",PRODUCTION_TASK_ITEMS:"production_task_items",POST_PRODUCTION_TASKS:"post_production_tasks",STOCKS:"stocks",RAW_PRODUCTS:"raw_products",VENDORS:"vendors",STAFF:"staff",PROCESSES:"processes",PRODUCTS:"products",SALES_CHANNELS:"sales_channels",PURCHASES:"purchases",SALES_ORDERS:"sales_orders",SALES_ORDER_ITEMS:"sales_order_items",SALES_UNITS:"sales_units",SALES_RECORDS:"sales_records"},uo="https://fra.cloud.appwrite.io/v1",mo="68cb76af00043a1c3b77",xa=new Qi;xa.setEndpoint(uo);xa.setProject(mo);const st=new Wi(xa),Vt=new Yi(xa),at="68cb77a000339977dcb0",mn=u.createContext(void 0),jt=()=>{const r=u.useContext(mn);if(r===void 0)throw new Error("useAuth must be used within an AuthProvider");return r},po=({children:r})=>{const[t,s]=u.useState(null),[a,n]=u.useState(!0);u.useEffect(()=>{i()},[]);const i=async()=>{try{if(window.self!==window.top){console.log("Running in iframe environment (preview mode)");const y=localStorage.getItem("appwrite-auth-user");if(y)try{const j=JSON.parse(y);s(j),console.log("Using stored user data in iframe:",j.email),n(!1);return}catch{console.log("Invalid stored user data, clearing..."),localStorage.removeItem("appwrite-auth-user")}}const g=await Vt.get();s(g),localStorage.setItem("appwrite-auth-user",JSON.stringify(g)),console.log("Authenticated user:",g.email)}catch(N){s(null),localStorage.removeItem("appwrite-auth-user"),console.error("Authentication check failed:",{code:N.code,message:N.message,type:N.type,response:N.response,isInIframe:window.self!==window.top}),N.code===401?console.log("Session expired or invalid, user needs to login again"):console.log("Not authenticated:",N.message)}finally{n(!1)}},c=async(N,g)=>{try{await Vt.createEmailPasswordSession(N,g);const y=await Vt.get();s(y),localStorage.setItem("appwrite-auth-user",JSON.stringify(y)),console.log("Successfully authenticated user:",y.email)}catch(y){throw console.error("Authentication error:",y.message),y}},f={user:t,login:c,register:async(N,g,y)=>{try{await Vt.create("unique()",N,g,y),await c(N,g)}catch(j){throw j}},loginWithGoogle:async()=>{try{Vt.createOAuth2Session("google",`${window.location.origin}/`,`${window.location.origin}/login`)}catch(N){throw N}},logout:async()=>{try{await Vt.deleteSession("current"),s(null),localStorage.removeItem("appwrite-auth-user"),console.log("Successfully logged out")}catch(N){console.error("Logout error:",N.message),s(null),localStorage.removeItem("appwrite-auth-user")}},loading:a};return e.jsx(mn.Provider,{value:f,children:r})};class pe{static field(t){return new ho(t)}static PATTERNS={EMAIL:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,PHONE:/^[\+]?[1-9][\d]{0,15}$/,PHONE_INTERNATIONAL:/^\+?[1-9]\d{1,14}$/,PHONE_US:/^(\+1|1)?[-.\s]?\(?[0-9]{3}\)?[-.\s]?[0-9]{3}[-.\s]?[0-9]{4}$/,URL:/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)$/,ALPHANUMERIC:/^[a-zA-Z0-9]+$/,ALPHA:/^[a-zA-Z]+$/,NUMERIC:/^[0-9]+$/,DECIMAL:/^[0-9]+(\.[0-9]+)?$/,DATE_ISO:/^\d{4}-\d{2}-\d{2}$/,DATE_US:/^(0[1-9]|1[0-2])\/(0[1-9]|[12][0-9]|3[01])\/\d{4}$/,TIME_24H:/^([01]?[0-9]|2[0-3]):[0-5][0-9]$/,TIME_12H:/^(0?[1-9]|1[0-2]):[0-5][0-9]\s?(AM|PM|am|pm)$/,SKU:/^[A-Z0-9\-_]+$/,CURRENCY:/^\$?[0-9]+(\.[0-9]{2})?$/};static COMMON_RULES={email:()=>({field:"email",type:"format",options:{pattern:pe.PATTERNS.EMAIL},message:"Invalid email format"}),phone:()=>({field:"phone",type:"format",options:{pattern:pe.PATTERNS.PHONE},message:"Invalid phone number format"}),currency:()=>({field:"amount",type:"format",options:{pattern:pe.PATTERNS.CURRENCY},message:"Invalid currency format (e.g., 123.45 or $123.45)"}),sku:()=>({field:"sku",type:"format",options:{pattern:pe.PATTERNS.SKU},message:"SKU must contain only uppercase letters, numbers, hyphens, and underscores"}),positiveNumber:t=>({field:t,type:"range",options:{min:0},message:"Value must be a positive number"}),percentage:t=>({field:t,type:"range",options:{min:0,max:100},message:"Percentage must be between 0 and 100"})};static isValidEmail(t){return this.PATTERNS.EMAIL.test(t)}static isValidPhone(t){return this.PATTERNS.PHONE.test(t)}static isValidDate(t){if(!t)return!1;if(t instanceof Date)return!isNaN(t.getTime());if(typeof t=="number"){if(t>1&&t<3e6){const s=new Date(1900,0,1),a=new Date(s.getTime()+(t-2)*864e5);return!isNaN(a.getTime())}return!1}if(typeof t=="string"){if(/^\d{4}-\d{2}-\d{2}$/.test(t.trim())){const a=new Date(t);return!isNaN(a.getTime())}const s=new Date(t);return!isNaN(s.getTime())}return!1}static isValidNumber(t,s,a){const n=Number(t);return!(isNaN(n)||s!==void 0&&n<s||a!==void 0&&n>a)}static isValidStringLength(t,s,a){return!(typeof t!="string"||s!==void 0&&t.length<s||a!==void 0&&t.length>a)}static isOneOf(t,s){return s.includes(t)}static isUnique(t,s,a,n){return a.filter((c,m)=>n!==void 0&&m===n?!1:c[s]===t).length===0}static sanitizeValue(t){if(typeof t=="string"){if(t=t.trim(),t==="")return null;t=t.replace(/[\u200B-\u200D\uFEFF]/g,""),t=t.replace(/\u00A0/g," ")}return t}static convertType(t,s){if(t==null)return null;switch(s){case"string":return String(t);case"number":const a=Number(t);return isNaN(a)?null:a;case"boolean":if(typeof t=="boolean")return t;if(typeof t=="string"){const i=t.toLowerCase();if(["true","1","yes","y","on"].includes(i))return!0;if(["false","0","no","n","off"].includes(i))return!1}return!!t;case"date":const n=new Date(t);return isNaN(n.getTime())?null:n;default:return t}}static formatErrorMessage(t,s,a){if(s.message)return s.message;switch(s.type){case"required":return`${t} is required`;case"format":return`${t} has invalid format`;case"range":return s.options?.min!==void 0&&s.options?.max!==void 0?`${t} must be between ${s.options.min} and ${s.options.max}`:s.options?.min!==void 0?`${t} must be at least ${s.options.min}`:s.options?.max!==void 0?`${t} must be at most ${s.options.max}`:`${t} is out of range`;case"unique":return`${t} must be unique (duplicate value: ${a})`;default:return`${t} validation failed`}}static createRulesForDataType(t,s,a=!1){const n=[];switch(a&&n.push({field:t,type:"required",message:`${t} is required`}),s.toLowerCase()){case"email":n.push(this.COMMON_RULES.email());break;case"phone":n.push(this.COMMON_RULES.phone());break;case"currency":case"money":n.push(this.COMMON_RULES.currency());break;case"sku":n.push(this.COMMON_RULES.sku());break;case"percentage":n.push(this.COMMON_RULES.percentage(t));break;case"positive_number":n.push(this.COMMON_RULES.positiveNumber(t));break;case"date":n.push({field:t,type:"custom",validator:i=>this.isValidDate(i),message:"Invalid date format"});break;case"url":n.push({field:t,type:"format",options:{pattern:this.PATTERNS.URL},message:"Invalid URL format"});break}return n}static createForeignKeyRule(t,s,a="id",n){return{field:t,type:"custom",validator:i=>i?s.some(c=>c[a]===i):!0,message:n||`${t} must reference a valid ${a}`}}static createConditionalRule(t,s,a){return{...a,field:t,validator:(n,i)=>{if(!s(i))return!0;if(a.validator)return a.validator(n,i);switch(a.type){case"required":return n!=null&&n!=="";case"format":return a.options?.pattern?a.options.pattern.test(String(n)):!0;default:return!0}}}}}class ho{constructor(t){this.field=t,this.rule={field:t}}rule;required(){return this.rule.type="required",this.rule.message=`${this.field} is required`,this}email(){return this.rule.type="format",this.rule.options={pattern:pe.PATTERNS.EMAIL},this.rule.message="Invalid email format",this}phone(){return this.rule.type="format",this.rule.options={pattern:pe.PATTERNS.PHONE},this.rule.message="Invalid phone number format",this}number(t,s){return this.rule.type="range",this.rule.options={min:t,max:s},t!==void 0&&s!==void 0?this.rule.message=`Must be between ${t} and ${s}`:t!==void 0?this.rule.message=`Must be at least ${t}`:s!==void 0&&(this.rule.message=`Must be at most ${s}`),this}string(t,s){return this.rule.type="custom",this.rule.validator=a=>pe.isValidStringLength(String(a),t,s),t!==void 0&&s!==void 0?this.rule.message=`Must be between ${t} and ${s} characters`:t!==void 0?this.rule.message=`Must be at least ${t} characters`:s!==void 0&&(this.rule.message=`Must be at most ${s} characters`),this}date(){return this.rule.type="custom",this.rule.validator=t=>pe.isValidDate(t),this.rule.message="Invalid date format",this}boolean(){return this.rule.type="custom",this.rule.validator=t=>{if(typeof t=="boolean")return!0;if(typeof t=="string"){const s=t.toLowerCase();return["true","false","1","0","yes","no","y","n"].includes(s)}return!1},this.rule.message="Must be a valid boolean value (true/false, yes/no, 1/0)",this}oneOf(t){return this.rule.type="custom",this.rule.validator=s=>pe.isOneOf(s,t),this.rule.message=`Must be one of: ${t.join(", ")}`,this}pattern(t,s){return this.rule.type="format",this.rule.options={pattern:t},this.rule.message=s||"Invalid format",this}unique(){return this.rule.type="unique",this.rule.message=`${this.field} must be unique`,this}custom(t,s){return this.rule.type="custom",this.rule.validator=(a,n,i)=>{const c={row:n||{},rowNumber:n&&n._rowNumber||0,allData:i||[],fieldName:this.field};return t(a,c)},this.rule.message=s||"Custom validation failed",this}build(){return this.rule}}const xo=r=>{try{if(!r)return"No Date";const t=new Date(r);if(isNaN(t.getTime()))return console.warn("Invalid date value:",r),"Invalid Date";const s=String(t.getDate()).padStart(2,"0"),a=String(t.getMonth()+1).padStart(2,"0"),n=t.getFullYear();return`${s}/${a}/${n}`}catch(t){return console.error("Date formatting error:",t,"Input:",r),"Invalid Date"}},ga=r=>{try{if(!r)return console.warn("formatTableDate: Empty date value received"),"No Date";if(r==="Invalid Date"||r==="NaN")return console.warn("formatTableDate: Invalid date string received:",r),"Invalid Date";let t;if(typeof r=="string"&&/^\d{2}\/\d{2}\/\d{4}$/.test(r)){const[c,m,d]=r.split("/");t=new Date(`${d}-${m}-${c}`)}else t=new Date(r);if(isNaN(t.getTime()))return console.warn("formatTableDate: Could not parse date:",r,"Type:",typeof r),"Invalid Date";const s=String(t.getDate()).padStart(2,"0"),a=String(t.getMonth()+1).padStart(2,"0"),n=t.getFullYear(),i=`${s}/${a}/${n}`;return console.log("ðŸ“… formatTableDate:",{input:r,output:i}),i}catch(t){return console.error("formatTableDate: Error formatting date:",t,"Input:",r),"Invalid Date"}},fs=r=>xo(r),go={pageName:"stocks",exportEnabled:!0,importEnabled:!0,sortableColumns:["name","sku","category","unit","openingBalance","createdAt"],exportColumns:[{dataKey:"name",exportHeader:"Stock Name",required:!0},{dataKey:"sku",exportHeader:"SKU",required:!0},{dataKey:"category",exportHeader:"Category"},{dataKey:"unit",exportHeader:"Unit",required:!0},{dataKey:"openingBalance",exportHeader:"Opening Balance",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"description",exportHeader:"Description"},{dataKey:"createdAt",exportHeader:"Created Date",dataType:"date",formatter:r=>fs(r)}],importValidation:[pe.field("name").required().string(1,100).build(),pe.field("sku").required().pattern(pe.PATTERNS.SKU).build(),pe.field("unit").required().oneOf(["kg","g","l","ml","pcs","box","pack"]).build(),pe.field("openingBalance").number(0).build(),pe.field("category").string(0,50).build()],tableColumns:[{key:"name",label:"Stock Name",sortable:!0,dataType:"string"},{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"category",label:"Category",sortable:!0,dataType:"string"},{key:"unit",label:"Unit",sortable:!0,dataType:"string"},{key:"openingBalance",label:"Opening Balance",sortable:!0,dataType:"number",align:"right"},{key:"createdAt",label:"Created",sortable:!0,dataType:"date"}]},fo={pageName:"products",exportEnabled:!0,importEnabled:!0,sortableColumns:["name","sku","category","price","createdAt"],exportColumns:[{dataKey:"name",exportHeader:"Product Name",required:!0},{dataKey:"sku",exportHeader:"SKU",required:!0},{dataKey:"category",exportHeader:"Category"},{dataKey:"price",exportHeader:"Price",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"description",exportHeader:"Description"},{dataKey:"isActive",exportHeader:"Active",dataType:"boolean",formatter:r=>r?"Yes":"No"},{dataKey:"createdAt",exportHeader:"Created Date",dataType:"date",formatter:r=>fs(r)}],importValidation:[pe.field("name").required().string(1,100).build(),pe.field("sku").required().pattern(pe.PATTERNS.SKU).build(),pe.field("price").number(0).build(),pe.field("category").string(0,50).build(),pe.field("isActive").boolean().build()],tableColumns:[{key:"name",label:"Product Name",sortable:!0,dataType:"string"},{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"category",label:"Category",sortable:!0,dataType:"string"},{key:"price",label:"Price",sortable:!0,dataType:"number",align:"right"},{key:"isActive",label:"Active",sortable:!0,dataType:"boolean"},{key:"createdAt",label:"Created",sortable:!0,dataType:"date"}]},jo={pageName:"raw-products",exportEnabled:!0,importEnabled:!0,sortableColumns:["name","sku","unit","costPerUnit","createdAt"],exportColumns:[{dataKey:"name",exportHeader:"Raw Product Name",required:!0},{dataKey:"sku",exportHeader:"SKU",required:!0},{dataKey:"unit",exportHeader:"Unit",required:!0},{dataKey:"costPerUnit",exportHeader:"Cost Per Unit",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"description",exportHeader:"Description"},{dataKey:"createdAt",exportHeader:"Created Date",dataType:"date",formatter:r=>fs(r)}],importValidation:[pe.field("name").required().string(1,100).build(),pe.field("sku").required().pattern(pe.PATTERNS.SKU).build(),pe.field("unit").required().oneOf(["kg","g","l","ml","pcs","box","pack"]).build(),pe.field("costPerUnit").number(0).build()],tableColumns:[{key:"name",label:"Raw Product Name",sortable:!0,dataType:"string"},{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"unit",label:"Unit",sortable:!0,dataType:"string"},{key:"costPerUnit",label:"Cost Per Unit",sortable:!0,dataType:"number",align:"right"},{key:"createdAt",label:"Created",sortable:!0,dataType:"date"}]},yo={pageName:"staff",exportEnabled:!0,importEnabled:!0,sortableColumns:["name","email","phone","role","isActive","createdAt"],exportColumns:[{dataKey:"name",exportHeader:"Staff Name",required:!0},{dataKey:"email",exportHeader:"Email",required:!0},{dataKey:"phone",exportHeader:"Phone"},{dataKey:"role",exportHeader:"Role",required:!0},{dataKey:"department",exportHeader:"Department"},{dataKey:"isActive",exportHeader:"Active",dataType:"boolean",formatter:r=>r?"Yes":"No"},{dataKey:"createdAt",exportHeader:"Created Date",dataType:"date",formatter:r=>fs(r)}],importValidation:[pe.field("name").required().string(1,100).build(),pe.field("email").required().email().build(),pe.field("phone").phone().build(),pe.field("role").required().oneOf(["admin","manager","operator","viewer"]).build(),pe.field("department").string(0,50).build(),pe.field("isActive").boolean().build()],tableColumns:[{key:"name",label:"Staff Name",sortable:!0,dataType:"string"},{key:"email",label:"Email",sortable:!0,dataType:"string"},{key:"phone",label:"Phone",sortable:!0,dataType:"string"},{key:"role",label:"Role",sortable:!0,dataType:"string"},{key:"isActive",label:"Active",sortable:!0,dataType:"boolean"},{key:"createdAt",label:"Created",sortable:!0,dataType:"date"}]},vo={pageName:"vendors",exportEnabled:!0,importEnabled:!0,sortableColumns:["name","email","phone","contactPerson","isActive","createdAt"],exportColumns:[{dataKey:"name",exportHeader:"Vendor Name",required:!0},{dataKey:"email",exportHeader:"Email"},{dataKey:"phone",exportHeader:"Phone"},{dataKey:"contactPerson",exportHeader:"Contact Person"},{dataKey:"address",exportHeader:"Address"},{dataKey:"isActive",exportHeader:"Active",dataType:"boolean",formatter:r=>r?"Yes":"No"},{dataKey:"createdAt",exportHeader:"Created Date",dataType:"date",formatter:r=>fs(r)}],importValidation:[pe.field("name").required().string(1,100).build(),pe.field("email").email().build(),pe.field("phone").phone().build(),pe.field("contactPerson").string(0,100).build(),pe.field("address").string(0,200).build(),pe.field("isActive").boolean().build()],tableColumns:[{key:"name",label:"Vendor Name",sortable:!0,dataType:"string"},{key:"email",label:"Email",sortable:!0,dataType:"string"},{key:"phone",label:"Phone",sortable:!0,dataType:"string"},{key:"contactPerson",label:"Contact Person",sortable:!0,dataType:"string"},{key:"isActive",label:"Active",sortable:!0,dataType:"boolean"},{key:"createdAt",label:"Created",sortable:!0,dataType:"date"}]},bo={pageName:"processes",exportEnabled:!0,importEnabled:!0,sortableColumns:["name","description","estimatedTime","isActive","createdAt"],exportColumns:[{dataKey:"name",exportHeader:"Process Name",required:!0},{dataKey:"description",exportHeader:"Description"},{dataKey:"estimatedTime",exportHeader:"Estimated Time (minutes)",dataType:"number"},{dataKey:"isActive",exportHeader:"Active",dataType:"boolean",formatter:r=>r?"Yes":"No"},{dataKey:"createdAt",exportHeader:"Created Date",dataType:"date",formatter:r=>fs(r)}],importValidation:[pe.field("name").required().string(1,100).build(),pe.field("description").string(0,500).build(),pe.field("estimatedTime").number(0).build(),pe.field("isActive").boolean().build()],tableColumns:[{key:"name",label:"Process Name",sortable:!0,dataType:"string"},{key:"description",label:"Description",sortable:!0,dataType:"string"},{key:"estimatedTime",label:"Est. Time (min)",sortable:!0,dataType:"number",align:"right"},{key:"isActive",label:"Active",sortable:!0,dataType:"boolean"},{key:"createdAt",label:"Created",sortable:!0,dataType:"date"}]},No={pageName:"sales-channels",exportEnabled:!0,importEnabled:!0,sortableColumns:["name","type","commission","isActive","createdAt"],exportColumns:[{dataKey:"name",exportHeader:"Channel Name",required:!0},{dataKey:"type",exportHeader:"Type",required:!0},{dataKey:"commission",exportHeader:"Commission (%)",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"description",exportHeader:"Description"},{dataKey:"isActive",exportHeader:"Active",dataType:"boolean",formatter:r=>r?"Yes":"No"},{dataKey:"createdAt",exportHeader:"Created Date",dataType:"date",formatter:r=>fs(r)}],importValidation:[pe.field("name").required().string(1,100).build(),pe.field("type").required().oneOf(["online","retail","wholesale","distributor"]).build(),pe.field("commission").number(0,100).build(),pe.field("description").string(0,500).build(),pe.field("isActive").boolean().build()],tableColumns:[{key:"name",label:"Channel Name",sortable:!0,dataType:"string"},{key:"type",label:"Type",sortable:!0,dataType:"string"},{key:"commission",label:"Commission (%)",sortable:!0,dataType:"number",align:"right"},{key:"isActive",label:"Active",sortable:!0,dataType:"boolean"},{key:"createdAt",label:"Created",sortable:!0,dataType:"date"}]},wo={pageName:"sales-units",exportEnabled:!0,importEnabled:!0,sortableColumns:["date","productName","sku","units","status","remarks"],exportColumns:[{dataKey:"date",exportHeader:"Date",dataType:"date",formatter:r=>new Date(r).toLocaleDateString("en-GB")},{dataKey:"productName",exportHeader:"Product",required:!0},{dataKey:"sku",exportHeader:"SKU",required:!0},{dataKey:"units",exportHeader:"Units",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"status",exportHeader:"Status"},{dataKey:"remarks",exportHeader:"Remarks"}],importValidation:[pe.field("date").required().date().build(),pe.field("productName").required().string(1,100).build(),pe.field("sku").required().string(1,50).build(),pe.field("units").required().number(.01).build(),pe.field("status").string(0,50).build(),pe.field("remarks").string(0,500).build()],tableColumns:[{key:"date",label:"Date",sortable:!0,dataType:"date"},{key:"productName",label:"Product",sortable:!0,dataType:"string"},{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"units",label:"Units",sortable:!0,dataType:"number",align:"right"},{key:"status",label:"Status",sortable:!0,dataType:"string"},{key:"remarks",label:"Remarks",sortable:!0,dataType:"string"}]},So={pageName:"sales-record",exportEnabled:!0,importEnabled:!0,sortableColumns:["date","channelName","productName","sku","qty","rate","totalAmount","status","remarks"],exportColumns:[{dataKey:"date",exportHeader:"Date",dataType:"date",formatter:r=>new Date(r).toLocaleDateString("en-GB")},{dataKey:"channelName",exportHeader:"Sales Channel",required:!0},{dataKey:"productName",exportHeader:"Product",required:!0},{dataKey:"sku",exportHeader:"SKU",required:!0},{dataKey:"qty",exportHeader:"Qty",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"rate",exportHeader:"Rate",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"totalAmount",exportHeader:"Total Amount",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"status",exportHeader:"Status"},{dataKey:"remarks",exportHeader:"Remarks"}],importValidation:[pe.field("date").required().date().build(),pe.field("channelName").required().string(1,100).build(),pe.field("productName").required().string(1,100).build(),pe.field("sku").required().string(1,50).build(),pe.field("qty").required().number(.01).build(),pe.field("rate").required().number(.01).build(),pe.field("remarks").string(0,500).build()],tableColumns:[{key:"date",label:"Date",sortable:!0,dataType:"date"},{key:"channelName",label:"Sales Channel",sortable:!0,dataType:"string"},{key:"productName",label:"Product",sortable:!0,dataType:"string"},{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"qty",label:"Qty",sortable:!0,dataType:"number",align:"right"},{key:"rate",label:"Rate",sortable:!0,dataType:"number",align:"right"},{key:"totalAmount",label:"Total Amount",sortable:!0,dataType:"number",align:"right"},{key:"status",label:"Status",sortable:!0,dataType:"string"},{key:"remarks",label:"Remarks",sortable:!0,dataType:"string"}]},_o={pageName:"purchases",exportEnabled:!0,importEnabled:!0,sortableColumns:["purchaseCode","date","vendorName","stockName","quantity","rate","totalAmount","status"],exportColumns:[{dataKey:"purchaseCode",exportHeader:"Purchase Code",required:!0},{dataKey:"date",exportHeader:"Date",dataType:"date",formatter:r=>new Date(r).toLocaleDateString("en-GB")},{dataKey:"vendorName",exportHeader:"Vendor Name",required:!0},{dataKey:"stockName",exportHeader:"Stock Name",required:!0},{dataKey:"quantity",exportHeader:"Quantity",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"rate",exportHeader:"Rate",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"totalAmount",exportHeader:"Total Amount",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"status",exportHeader:"Status"}],importValidation:[pe.field("purchaseCode").required().string(1,50).build(),pe.field("date").required().date().build(),pe.field("vendorName").required().string(1,100).build(),pe.field("stockName").required().string(1,100).build(),pe.field("quantity").required().number(.01).build(),pe.field("rate").required().number(.01).build(),pe.field("totalAmount").number(.01).build(),pe.field("status").string(0,50).build()],tableColumns:[{key:"purchaseCode",label:"Purchase Code",sortable:!0,dataType:"string"},{key:"date",label:"Date",sortable:!0,dataType:"date"},{key:"vendorName",label:"Vendor Name",sortable:!0,dataType:"string"},{key:"stockName",label:"Stock Name",sortable:!0,dataType:"string"},{key:"quantity",label:"Quantity",sortable:!0,dataType:"number",align:"right"},{key:"unitPrice",label:"Unit Price",sortable:!0,dataType:"number",align:"right"},{key:"totalAmount",label:"Total",sortable:!0,dataType:"number",align:"right"},{key:"purchaseDate",label:"Purchase Date",sortable:!0,dataType:"date"},{key:"vendorName",label:"Vendor",sortable:!0,dataType:"string"},{key:"createdAt",label:"Created",sortable:!0,dataType:"date"}]},ko={pageName:"pre-production-tasks",exportEnabled:!0,importEnabled:!0,sortableColumns:["task_id","stock_name","stock_source","date_assigned","process_name","assigned_quantity","staff_name","date_completed","completed_quantity","wastage_quantity","status"],exportColumns:[{dataKey:"task_id",exportHeader:"Task ID",required:!0},{dataKey:"stock_name",exportHeader:"Stock Name",required:!0},{dataKey:"stock_source",exportHeader:"Stock Source"},{dataKey:"date_assigned",exportHeader:"Date Assigned",dataType:"date",formatter:r=>new Date(r).toLocaleDateString("en-GB")},{dataKey:"process_name",exportHeader:"Process",required:!0},{dataKey:"assigned_quantity",exportHeader:"Assigned Qty",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"staff_name",exportHeader:"Staff Name"},{dataKey:"date_completed",exportHeader:"Date Completed",dataType:"date",formatter:r=>r?new Date(r).toLocaleDateString("en-GB"):""},{dataKey:"completed_quantity",exportHeader:"Completed Qty",dataType:"number",formatter:r=>r?Number(r).toFixed(2):"0.00"},{dataKey:"wastage_quantity",exportHeader:"Wastage Qty",dataType:"number",formatter:r=>r?Number(r).toFixed(2):"0.00"},{dataKey:"remarks",exportHeader:"Remarks"},{dataKey:"status",exportHeader:"Status"}],importValidation:[pe.field("task_id").required().string(1,50).build(),pe.field("stock_name").required().string(1,100).build(),pe.field("assigned_quantity").required().number(.01).build(),pe.field("date_assigned").date().build(),pe.field("staff_name").string(0,100).build()],tableColumns:[{key:"task_id",label:"Task ID",sortable:!0,dataType:"string"},{key:"stock_name",label:"Stock Name",sortable:!0,dataType:"string"},{key:"stock_source",label:"Stock Source",sortable:!0,dataType:"string"},{key:"date_assigned",label:"Date Assigned",sortable:!0,dataType:"date"},{key:"process_name",label:"Process",sortable:!0,dataType:"string"},{key:"assigned_quantity",label:"Assigned Qty",sortable:!0,dataType:"number",align:"right"},{key:"staff_name",label:"Staff Name",sortable:!0,dataType:"string"},{key:"date_completed",label:"Date Completed",sortable:!0,dataType:"date"},{key:"completed_quantity",label:"Completed Qty",sortable:!0,dataType:"number",align:"right"},{key:"wastage_quantity",label:"Wastage Qty",sortable:!0,dataType:"number",align:"right"},{key:"status",label:"Status",sortable:!0,dataType:"string"}]},Co={pageName:"production-tasks",exportEnabled:!0,importEnabled:!0,sortableColumns:["task_id","date","raw_product_name","process_name","source_process_name","staff_name","assigned_quantity","completed_quantity","date_completed","wastage_quantity","status"],exportColumns:[{dataKey:"task_id",exportHeader:"Task ID",required:!0},{dataKey:"date",exportHeader:"Date",dataType:"date",formatter:r=>new Date(r).toLocaleDateString("en-GB")},{dataKey:"raw_product_name",exportHeader:"Raw Product",required:!0},{dataKey:"process_name",exportHeader:"Process",required:!0},{dataKey:"source_process_name",exportHeader:"Source Process"},{dataKey:"staff_name",exportHeader:"Staff Name"},{dataKey:"assigned_quantity",exportHeader:"Assigned Qty",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"completed_quantity",exportHeader:"Completed Qty",dataType:"number",formatter:r=>r?Number(r).toFixed(2):"0.00"},{dataKey:"date_completed",exportHeader:"Date Completed",dataType:"date",formatter:r=>r?new Date(r).toLocaleDateString("en-GB"):""},{dataKey:"wastage_quantity",exportHeader:"Wastage Qty",dataType:"number",formatter:r=>r?Number(r).toFixed(2):"0.00"},{dataKey:"status",exportHeader:"Status"}],importValidation:[pe.field("task_id").required().string(1,50).build(),pe.field("raw_product_name").required().string(1,100).build(),pe.field("process_name").required().string(1,100).build(),pe.field("assigned_quantity").required().number(.01).build(),pe.field("date").date().build(),pe.field("staff_name").string(0,100).build()],tableColumns:[{key:"task_id",label:"Task ID",sortable:!0,dataType:"string"},{key:"date",label:"Date",sortable:!0,dataType:"date"},{key:"raw_product_name",label:"Raw Product",sortable:!0,dataType:"string"},{key:"process_name",label:"Process",sortable:!0,dataType:"string"},{key:"assignedQuantity",label:"Quantity",sortable:!0,dataType:"number",align:"right"},{key:"assignedTo",label:"Assigned To",sortable:!0,dataType:"string"},{key:"status",label:"Status",sortable:!0,dataType:"string"},{key:"dueDate",label:"Due Date",sortable:!0,dataType:"date"},{key:"createdAt",label:"Created",sortable:!0,dataType:"date"}]},Po={pageName:"post-production-tasks",exportEnabled:!0,importEnabled:!0,sortableColumns:["task_id","date","date_completed","source_quantity","sku","product_name","process_name","staff_name","assigned_quantity","units","wastage_quantity","status"],exportColumns:[{dataKey:"task_id",exportHeader:"Task ID",required:!0},{dataKey:"date",exportHeader:"Date Assigned",dataType:"date",formatter:r=>new Date(r).toLocaleDateString("en-GB")},{dataKey:"date_completed",exportHeader:"Date Completed",dataType:"date",formatter:r=>r?new Date(r).toLocaleDateString("en-GB"):""},{dataKey:"source_quantity",exportHeader:"Source Qty",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"sku",exportHeader:"SKU",required:!0},{dataKey:"product_name",exportHeader:"Product",required:!0},{dataKey:"process_name",exportHeader:"Process",required:!0},{dataKey:"staff_name",exportHeader:"Staff Name"},{dataKey:"assigned_quantity",exportHeader:"Assigned Units",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"units",exportHeader:"Completed Units",dataType:"number",formatter:r=>r?Number(r).toFixed(2):"0.00"},{dataKey:"wastage_quantity",exportHeader:"Wastage Qty",dataType:"number",formatter:r=>r?Number(r).toFixed(2):"0.00"},{dataKey:"remarks",exportHeader:"Remarks"},{dataKey:"status",exportHeader:"Status"}],importValidation:[pe.field("task_id").required().string(1,50).build(),pe.field("product_name").required().string(1,100).build(),pe.field("sku").required().string(1,50).build(),pe.field("process_name").required().string(1,100).build(),pe.field("source_quantity").required().number(.01).build(),pe.field("assigned_quantity").required().number(.01).build(),pe.field("date").date().build(),pe.field("staff_name").string(0,100).build()],tableColumns:[{key:"task_id",label:"Task ID",sortable:!0,dataType:"string"},{key:"date",label:"Date Assigned",sortable:!0,dataType:"date"},{key:"date_completed",label:"Date Completed",sortable:!0,dataType:"date"},{key:"source_quantity",label:"Source Qty",sortable:!0,dataType:"number",align:"right"},{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"product_name",label:"Product",sortable:!0,dataType:"string"},{key:"process_name",label:"Process",sortable:!0,dataType:"string"},{key:"staff_name",label:"Staff Name",sortable:!0,dataType:"string"},{key:"assigned_quantity",label:"Assigned Units",sortable:!0,dataType:"number",align:"right"},{key:"units",label:"Completed Units",sortable:!0,dataType:"number",align:"right"},{key:"wastage_quantity",label:"Wastage Qty",sortable:!0,dataType:"number",align:"right"},{key:"status",label:"Status",sortable:!0,dataType:"string"}]},Do={pageName:"stock-status",exportEnabled:!0,importEnabled:!1,sortableColumns:["stockName","openingBalance","purchases","sales","closingBalance"],exportColumns:[{dataKey:"stockName",exportHeader:"Stock Name"},{dataKey:"openingBalance",exportHeader:"Opening Balance",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"purchases",exportHeader:"Purchases",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"sales",exportHeader:"Sales",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"closingBalance",exportHeader:"Closing Balance",dataType:"number",formatter:r=>Number(r).toFixed(2)}],importValidation:[],tableColumns:[{key:"stockName",label:"Stock Name",sortable:!0,dataType:"string"},{key:"openingBalance",label:"Opening Balance",sortable:!0,dataType:"number",align:"right"},{key:"purchases",label:"Purchases",sortable:!0,dataType:"number",align:"right"},{key:"sales",label:"Sales",sortable:!0,dataType:"number",align:"right"},{key:"closingBalance",label:"Closing Balance",sortable:!0,dataType:"number",align:"right"}]},To={pageName:"inventory-status",exportEnabled:!0,importEnabled:!1,sortableColumns:["stockName","openingBalance","salesUnits","soldUnits","closingBalance"],exportColumns:[{dataKey:"stockName",exportHeader:"Stock Name"},{dataKey:"openingBalance",exportHeader:"Opening Balance",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"salesUnits",exportHeader:"Sales Units",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"soldUnits",exportHeader:"Sold Units",dataType:"number",formatter:r=>Number(r).toFixed(2)},{dataKey:"closingBalance",exportHeader:"Closing Balance",dataType:"number",formatter:r=>Number(r).toFixed(2)}],importValidation:[],tableColumns:[{key:"stockName",label:"Stock Name",sortable:!0,dataType:"string"},{key:"openingBalance",label:"Opening Balance",sortable:!0,dataType:"number",align:"right"},{key:"salesUnits",label:"Sales Units",sortable:!0,dataType:"number",align:"right"},{key:"soldUnits",label:"Sold Units",sortable:!0,dataType:"number",align:"right"},{key:"closingBalance",label:"Closing Balance",sortable:!0,dataType:"number",align:"right"}]},pn={stocks:go,products:fo,"raw-products":jo,staff:yo,vendors:vo,processes:bo,"sales-channels":No,"sales-units":wo,"sales-record":So,purchases:_o,"pre-production-tasks":ko,"production-tasks":Co,"post-production-tasks":Po,"stock-status":Do,"inventory-status":To},Eo=r=>pn[r],Ro={defaultExportFormat:"xlsx",maxImportFileSize:50,defaultBatchSize:100,enableProgressTracking:!0,autoRefreshInterval:300,cacheTimeout:30,enableValidationWarnings:!0,defaultSortDirection:"asc",enableMultiSort:!1,maxExportRows:1e5,enableBackgroundExport:!0},hn=u.createContext(void 0),qo=({children:r,initialSettings:t={}})=>{const[s,a]=u.useState({}),[n,i]=u.useState({...Ro,...t}),[c,m]=u.useState(!1),[d,o]=u.useState(null);u.useEffect(()=>{try{const O=localStorage.getItem("dataManagementSettings");if(O){const Z=JSON.parse(O);i(M=>({...M,...Z}))}}catch(O){console.warn("Failed to load saved settings:",O)}},[]),u.useEffect(()=>{try{localStorage.setItem("dataManagementSettings",JSON.stringify(n))}catch(O){console.warn("Failed to save settings:",O)}},[n]),u.useEffect(()=>{if(n.autoRefreshInterval>0){const O=setInterval(()=>{f()},n.autoRefreshInterval*1e3);return()=>clearInterval(O)}},[n.autoRefreshInterval]);const f=()=>{const O=Date.now(),Z=n.cacheTimeout*60*1e3;a(M=>{const z={...M};return Object.keys(z).forEach(Q=>{O-z[Q].timestamp>Z&&delete z[Q]}),z})},N=u.useCallback(O=>{try{const Z=s[O],M=Date.now(),z=n.cacheTimeout*60*1e3;if(Z&&M-Z.timestamp<z)return Z.config;const Q=Eo(O);return Q&&setTimeout(()=>{a(R=>({...R,[O]:{config:Q,timestamp:M}}))},0),Q}catch(Z){o(`Failed to get configuration for ${O}: ${Z instanceof Error?Z.message:"Unknown error"}`);return}},[s,n.cacheTimeout]),g=(O,Z)=>{try{const M=N(O);if(!M)throw new Error(`Configuration not found for page: ${O}`);const z={...M,...Z};a(Q=>({...Q,[O]:{config:z,timestamp:Date.now()}})),pn[O]=z,o(null)}catch(M){o(`Failed to update configuration for ${O}: ${M instanceof Error?M.message:"Unknown error"}`)}},y=O=>{try{a(Z=>{const M={...Z};return delete M[O],M}),o(null)}catch(Z){o(`Failed to reset configuration for ${O}: ${Z instanceof Error?Z.message:"Unknown error"}`)}},j=O=>N(O)?.exportEnabled||!1,P=O=>N(O)?.importEnabled||!1,x=O=>N(O)?.exportColumns||[],C=O=>N(O)?.tableColumns||[],E=O=>N(O)?.importValidation||[],D=O=>{i(Z=>({...Z,...O})),o(null)},T=()=>{a({}),o(null)},K={getConfig:N,updateConfig:g,resetConfig:y,canExport:j,canImport:P,getExportColumns:x,getTableColumns:C,getValidationRules:E,globalSettings:n,updateGlobalSettings:D,clearCache:T,refreshConfig:O=>{O?a(Z=>{const M={...Z};return delete M[O],M}):T(),o(null)},isLoading:c,error:d};return e.jsx(hn.Provider,{value:K,children:r})},Ua=()=>{const r=u.useContext(hn);if(r===void 0)throw new Error("useDataManagement must be used within a DataManagementProvider");return r},Tt=r=>{const{getConfig:t,updateConfig:s,resetConfig:a,canExport:n,canImport:i}=Ua(),c=t(r);return{config:c,canExport:n(r),canImport:i(r),updateConfig:m=>s(r,m),resetConfig:()=>a(r),isConfigured:!!c}},Et=r=>{const{getValidationRules:t,canImport:s,globalSettings:a}=Ua();return{validationRules:t(r),canImport:s(r),maxFileSize:a.maxImportFileSize,batchSize:a.defaultBatchSize,enableWarnings:a.enableValidationWarnings}},Ao=r=>{const{getTableColumns:t,globalSettings:s}=Ua();return{columns:t(r),defaultSortDirection:s.defaultSortDirection,enableMultiSort:s.enableMultiSort}},Ta=gs("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),A=u.forwardRef(({className:r,variant:t,size:s,asChild:a=!1,...n},i)=>{const c=a?Es:"button";return e.jsx(c,{className:me(Ta({variant:t,size:s,className:r})),ref:i,...n})});A.displayName="Button";const Fo=gs("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),Qe=u.forwardRef(({className:r,variant:t,...s},a)=>e.jsx("div",{ref:a,role:"alert",className:me(Fo({variant:t}),r),...s}));Qe.displayName="Alert";const $o=u.forwardRef(({className:r,...t},s)=>e.jsx("h5",{ref:s,className:me("mb-1 font-medium leading-none tracking-tight",r),...t}));$o.displayName="AlertTitle";const Ye=u.forwardRef(({className:r,...t},s)=>e.jsx("div",{ref:s,className:me("text-sm [&_p]:leading-relaxed",r),...t}));Ye.displayName="AlertDescription";class Io{isDevelopment=!1;isVerbose=!1;log(...t){this.isDevelopment&&console.log(...t)}verbose(...t){this.isDevelopment&&this.isVerbose&&console.log(...t)}warn(...t){this.isDevelopment&&console.warn(...t)}error(...t){console.error(...t),this.isDevelopment}logWithContext(t,s,a){if(this.isDevelopment){const n=this.formatContext(s);console.log(`${n} ${t}`,a||"")}}performance(t,s){if(this.isDevelopment){console.time(t);const a=s();return console.timeEnd(t),a}return s()}async performanceAsync(t,s){if(this.isDevelopment){console.time(t);const a=await s();return console.timeEnd(t),a}return s()}group(t,s){this.isDevelopment&&(console.group(t),s(),console.groupEnd())}table(t){this.isDevelopment&&console.table(t)}json(t,s){this.isDevelopment&&console.log(`${t}:`,JSON.stringify(s,null,2))}assert(t,s){this.isDevelopment&&!t&&console.error(`Assertion failed: ${s}`)}formatContext(t){const s=[];return t.component&&s.push(`[${t.component}]`),t.hook&&s.push(`[${t.hook}]`),t.service&&s.push(`[${t.service}]`),s.join(" ")}}const kt=new Io;kt.performance.bind(kt);kt.performanceAsync.bind(kt);kt.group.bind(kt);kt.table.bind(kt);kt.json.bind(kt);function Lo(){const[r,t]=u.useState(null),[s,a]=u.useState(!1),[n,i]=u.useState(!1),[c,m]=u.useState(navigator.onLine),[d,o]=u.useState(!1);return u.useEffect(()=>{window.matchMedia("(display-mode: standalone)").matches&&i(!0);const g=x=>{x.preventDefault(),t(x),a(!0)},y=()=>{i(!0),a(!1),t(null)},j=()=>m(!0),P=()=>m(!1);return window.addEventListener("beforeinstallprompt",g),window.addEventListener("appinstalled",y),window.addEventListener("online",j),window.addEventListener("offline",P),"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").then(x=>{kt.log("Service Worker registered:",x),x.addEventListener("updatefound",()=>{const C=x.installing;C&&C.addEventListener("statechange",()=>{C.state==="installed"&&navigator.serviceWorker.controller&&o(!0)})})}).catch(x=>{console.error("Service Worker registration failed:",x)}),()=>{window.removeEventListener("beforeinstallprompt",g),window.removeEventListener("appinstalled",y),window.removeEventListener("online",j),window.removeEventListener("offline",P)}},[]),{isInstallable:s,isInstalled:n,isOnline:c,updateAvailable:d,installApp:async()=>{if(!r)return!1;try{await r.prompt();const{outcome:g}=await r.userChoice;return g==="accepted"?(t(null),a(!1),!0):!1}catch(g){return console.error("Error installing app:",g),!1}},updateApp:()=>{"serviceWorker"in navigator&&navigator.serviceWorker.getRegistration().then(g=>{g&&g.waiting&&(g.waiting.postMessage({type:"SKIP_WAITING"}),window.location.reload())})}}}function Mo(){const{isInstallable:r,isInstalled:t,isOnline:s,updateAvailable:a,installApp:n,updateApp:i}=Lo(),{toast:c}=Ie(),[m,d]=u.useState(!1),[o,f]=u.useState(!1);u.useEffect(()=>{if(r&&!t&&!localStorage.getItem("pwa-install-dismissed")){const P=setTimeout(()=>{d(!0)},3e4);return()=>clearTimeout(P)}},[r,t]),u.useEffect(()=>{a&&f(!0)},[a]);const N=async()=>{await n()&&(d(!1),c({title:"App installed!",description:"Molaga ERP has been added to your home screen"}))},g=()=>{d(!1),localStorage.setItem("pwa-install-dismissed","true")},y=()=>{i(),f(!1)};return s?o?e.jsx("div",{className:"fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-96 z-50",children:e.jsxs(Qe,{className:"bg-blue-50 border-blue-200",children:[e.jsx(qa,{className:"h-4 w-4 text-blue-600"}),e.jsx(Ye,{className:"text-blue-800",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"New version available!"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(A,{size:"sm",variant:"outline",onClick:()=>f(!1),className:"h-7",children:"Later"}),e.jsx(A,{size:"sm",onClick:y,className:"h-7 bg-blue-600 hover:bg-blue-700",children:"Update"})]})]})})]})}):m&&!t?e.jsx("div",{className:"fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-96 z-50",children:e.jsxs(Qe,{className:"bg-primary/5 border-primary/20",children:[e.jsx(xs,{className:"h-4 w-4 text-primary"}),e.jsxs(Ye,{children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-foreground mb-1",children:"Install Molaga ERP"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Add to your home screen for quick access and offline use"})]}),e.jsx(A,{size:"sm",variant:"ghost",onClick:g,className:"h-6 w-6 p-0",children:e.jsx(ks,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx(A,{size:"sm",variant:"outline",onClick:g,className:"flex-1",children:"Not now"}),e.jsx(A,{size:"sm",onClick:N,className:"flex-1 bg-primary hover:bg-primary/90",children:"Install"})]})]})]})}):null:e.jsx("div",{className:"fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-96 z-50",children:e.jsxs(Qe,{className:"bg-orange-50 border-orange-200",children:[e.jsx(Wn,{className:"h-4 w-4 text-orange-600"}),e.jsx(Ye,{className:"text-orange-800",children:"You're offline. Some features may be limited."})]})})}const Na=768;function Oo(){const[r,t]=u.useState(void 0);return u.useEffect(()=>{const s=window.matchMedia(`(max-width: ${Na-1}px)`),a=()=>{t(window.innerWidth<Na)};return s.addEventListener("change",a),t(window.innerWidth<Na),()=>s.removeEventListener("change",a)},[]),!!r}const G=u.forwardRef(({className:r,type:t,...s},a)=>e.jsx("input",{type:t,className:me("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:a,...s}));G.displayName="Input";const fa=u.forwardRef(({className:r,orientation:t="horizontal",decorative:s=!0,...a},n)=>e.jsx(fr,{ref:n,decorative:s,orientation:t,className:me("shrink-0 bg-border",t==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",r),...a}));fa.displayName=fr.displayName;const Uo=vr,Ko=jr,xn=u.forwardRef(({className:r,...t},s)=>e.jsx(da,{className:me("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r),...t,ref:s}));xn.displayName=da.displayName;const Vo=gs("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),gn=u.forwardRef(({side:r="right",className:t,children:s,...a},n)=>e.jsxs(Ko,{children:[e.jsx(xn,{}),e.jsxs(ua,{ref:n,className:me(Vo({side:r}),t),...a,children:[s,e.jsxs(yr,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-secondary hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[e.jsx(ks,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));gn.displayName=ua.displayName;const Bo=u.forwardRef(({className:r,...t},s)=>e.jsx(ma,{ref:s,className:me("text-lg font-semibold text-foreground",r),...t}));Bo.displayName=ma.displayName;const Ho=u.forwardRef(({className:r,...t},s)=>e.jsx(pa,{ref:s,className:me("text-sm text-muted-foreground",r),...t}));Ho.displayName=pa.displayName;function Za({className:r,...t}){return e.jsx("div",{className:me("animate-pulse rounded-md bg-muted",r),...t})}const zo="sidebar:state",Qo=3600*24*7,Yo="16rem",Wo="18rem",Go="3rem",Jo="b",fn=u.createContext(null);function Qs(){const r=u.useContext(fn);if(!r)throw new Error("useSidebar must be used within a SidebarProvider.");return r}const jn=u.forwardRef(({defaultOpen:r=!0,open:t,onOpenChange:s,className:a,style:n,children:i,...c},m)=>{const d=Oo(),[o,f]=u.useState(!1),[N,g]=u.useState(r),y=t??N,j=u.useCallback(E=>{const D=typeof E=="function"?E(y):E;s?s(D):g(D),document.cookie=`${zo}=${D}; path=/; max-age=${Qo}`},[s,y]),P=u.useCallback(()=>d?f(E=>!E):j(E=>!E),[d,j,f]);u.useEffect(()=>{const E=D=>{D.key===Jo&&(D.metaKey||D.ctrlKey)&&(D.preventDefault(),P())};return window.addEventListener("keydown",E),()=>window.removeEventListener("keydown",E)},[P]);const x=y?"expanded":"collapsed",C=u.useMemo(()=>({state:x,open:y,setOpen:j,isMobile:d,openMobile:o,setOpenMobile:f,toggleSidebar:P}),[x,y,j,d,o,f,P]);return e.jsx(fn.Provider,{value:C,children:e.jsx(dn,{delayDuration:0,children:e.jsx("div",{style:{"--sidebar-width":Yo,"--sidebar-width-icon":Go,...n},className:me("group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar",a),ref:m,...c,children:i})})})});jn.displayName="SidebarProvider";const yn=u.forwardRef(({side:r="left",variant:t="sidebar",collapsible:s="offcanvas",className:a,children:n,...i},c)=>{const{isMobile:m,state:d,openMobile:o,setOpenMobile:f}=Qs();return s==="none"?e.jsx("div",{className:me("flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground",a),ref:c,...i,children:n}):m?e.jsx(Uo,{open:o,onOpenChange:f,...i,children:e.jsx(gn,{"data-sidebar":"sidebar","data-mobile":"true",className:"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden",style:{"--sidebar-width":Wo},side:r,children:e.jsx("div",{className:"flex h-full w-full flex-col",children:n})})}):e.jsxs("div",{ref:c,className:"group peer hidden text-sidebar-foreground md:block","data-state":d,"data-collapsible":d==="collapsed"?s:"","data-variant":t,"data-side":r,children:[e.jsx("div",{className:me("relative h-svh w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear","group-data-[collapsible=offcanvas]:w-0","group-data-[side=right]:rotate-180",t==="floating"||t==="inset"?"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon]")}),e.jsx("div",{className:me("fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex",r==="left"?"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]":"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]",t==="floating"||t==="inset"?"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l",a),...i,children:e.jsx("div",{"data-sidebar":"sidebar",className:"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow",children:n})})]})});yn.displayName="Sidebar";const vn=u.forwardRef(({className:r,onClick:t,...s},a)=>{const{toggleSidebar:n}=Qs();return e.jsxs(A,{ref:a,"data-sidebar":"trigger",variant:"ghost",size:"icon",className:me("h-7 w-7",r),onClick:i=>{t?.(i),n()},...s,children:[e.jsx(Gn,{}),e.jsx("span",{className:"sr-only",children:"Toggle Sidebar"})]})});vn.displayName="SidebarTrigger";const Xo=u.forwardRef(({className:r,...t},s)=>{const{toggleSidebar:a}=Qs();return e.jsx("button",{ref:s,"data-sidebar":"rail","aria-label":"Toggle Sidebar",tabIndex:-1,onClick:a,title:"Toggle Sidebar",className:me("absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] group-data-[side=left]:-right-4 group-data-[side=right]:left-0 hover:after:bg-sidebar-border sm:flex","[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize","[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize","group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar","[[data-side=left][data-collapsible=offcanvas]_&]:-right-2","[[data-side=right][data-collapsible=offcanvas]_&]:-left-2",r),...t})});Xo.displayName="SidebarRail";const Zo=u.forwardRef(({className:r,...t},s)=>e.jsx("main",{ref:s,className:me("relative flex min-h-svh flex-1 flex-col bg-background","peer-data-[variant=inset]:min-h-[calc(100svh-theme(spacing.4))] md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow",r),...t}));Zo.displayName="SidebarInset";const el=u.forwardRef(({className:r,...t},s)=>e.jsx(G,{ref:s,"data-sidebar":"input",className:me("h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring",r),...t}));el.displayName="SidebarInput";const tl=u.forwardRef(({className:r,...t},s)=>e.jsx("div",{ref:s,"data-sidebar":"header",className:me("flex flex-col gap-2 p-2",r),...t}));tl.displayName="SidebarHeader";const sl=u.forwardRef(({className:r,...t},s)=>e.jsx("div",{ref:s,"data-sidebar":"footer",className:me("flex flex-col gap-2 p-2",r),...t}));sl.displayName="SidebarFooter";const al=u.forwardRef(({className:r,...t},s)=>e.jsx(fa,{ref:s,"data-sidebar":"separator",className:me("mx-2 w-auto bg-sidebar-border",r),...t}));al.displayName="SidebarSeparator";const bn=u.forwardRef(({className:r,...t},s)=>e.jsx("div",{ref:s,"data-sidebar":"content",className:me("flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden",r),...t}));bn.displayName="SidebarContent";const ea=u.forwardRef(({className:r,...t},s)=>e.jsx("div",{ref:s,"data-sidebar":"group",className:me("relative flex w-full min-w-0 flex-col p-2",r),...t}));ea.displayName="SidebarGroup";const Ea=u.forwardRef(({className:r,asChild:t=!1,...s},a)=>{const n=t?Es:"div";return e.jsx(n,{ref:a,"data-sidebar":"group-label",className:me("flex h-8 shrink-0 items-center rounded-md px-2 text-sm font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opa] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0",r),...s})});Ea.displayName="SidebarGroupLabel";const rl=u.forwardRef(({className:r,asChild:t=!1,...s},a)=>{const n=t?Es:"button";return e.jsx(n,{ref:a,"data-sidebar":"group-action",className:me("absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","group-data-[collapsible=icon]:hidden",r),...s})});rl.displayName="SidebarGroupAction";const ta=u.forwardRef(({className:r,...t},s)=>e.jsx("div",{ref:s,"data-sidebar":"group-content",className:me("w-full text-sm",r),...t}));ta.displayName="SidebarGroupContent";const sa=u.forwardRef(({className:r,...t},s)=>e.jsx("ul",{ref:s,"data-sidebar":"menu",className:me("flex w-full min-w-0 flex-col gap-1",r),...t}));sa.displayName="SidebarMenu";const aa=u.forwardRef(({className:r,...t},s)=>e.jsx("li",{ref:s,"data-sidebar":"menu-item",className:me("group/menu-item relative",r),...t}));aa.displayName="SidebarMenuItem";const nl=gs("peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-base outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",{variants:{variant:{default:"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",outline:"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]"},size:{default:"h-8 text-base",sm:"h-7 text-sm",lg:"h-12 text-base group-data-[collapsible=icon]:!p-0"}},defaultVariants:{variant:"default",size:"default"}}),ra=u.forwardRef(({asChild:r=!1,isActive:t=!1,variant:s="default",size:a="default",tooltip:n,className:i,...c},m)=>{const d=r?Es:"button",{isMobile:o,state:f}=Qs(),N=e.jsx(d,{ref:m,"data-sidebar":"menu-button","data-size":a,"data-active":t,className:me(nl({variant:s,size:a}),i),...c});return n?(typeof n=="string"&&(n={children:n}),e.jsxs(lo,{children:[e.jsx(co,{asChild:!0,children:N}),e.jsx(un,{side:"right",align:"center",hidden:f!=="collapsed"||o,...n})]})):N});ra.displayName="SidebarMenuButton";const il=u.forwardRef(({className:r,asChild:t=!1,showOnHover:s=!1,...a},n)=>{const i=t?Es:"button";return e.jsx(i,{ref:n,"data-sidebar":"menu-action",className:me("absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform peer-hover/menu-button:text-sidebar-accent-foreground hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",s&&"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0",r),...a})});il.displayName="SidebarMenuAction";const ol=u.forwardRef(({className:r,...t},s)=>e.jsx("div",{ref:s,"data-sidebar":"menu-badge",className:me("pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground","peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",r),...t}));ol.displayName="SidebarMenuBadge";const ll=u.forwardRef(({className:r,showIcon:t=!1,...s},a)=>{const n=u.useMemo(()=>`${Math.floor(Math.random()*40)+50}%`,[]);return e.jsxs("div",{ref:a,"data-sidebar":"menu-skeleton",className:me("flex h-8 items-center gap-2 rounded-md px-2",r),...s,children:[t&&e.jsx(Za,{className:"size-4 rounded-md","data-sidebar":"menu-skeleton-icon"}),e.jsx(Za,{className:"h-4 max-w-[--skeleton-width] flex-1","data-sidebar":"menu-skeleton-text",style:{"--skeleton-width":n}})]})});ll.displayName="SidebarMenuSkeleton";const cl=u.forwardRef(({className:r,...t},s)=>e.jsx("ul",{ref:s,"data-sidebar":"menu-sub",className:me("mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5","group-data-[collapsible=icon]:hidden",r),...t}));cl.displayName="SidebarMenuSub";const dl=u.forwardRef(({...r},t)=>e.jsx("li",{ref:t,...r}));dl.displayName="SidebarMenuSubItem";const ul=u.forwardRef(({asChild:r=!1,size:t="md",isActive:s,className:a,...n},i)=>{const c=r?Es:"a";return e.jsx(c,{ref:i,"data-sidebar":"menu-sub-button","data-size":t,"data-active":s,className:me("flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring aria-disabled:pointer-events-none aria-disabled:opacity-50 hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground","data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground",t==="sm"&&"text-xs",t==="md"&&"text-sm","group-data-[collapsible=icon]:hidden",a),...n})});ul.displayName="SidebarMenuSubButton";const ml=[{title:"Dashboard",url:"/",icon:Jn},{title:"Purchases",url:"/purchases",icon:Aa},{title:"Tasks",url:"/tasks",icon:Fa},{title:"Status",url:"/status",icon:zs},{title:"Sales",url:"/sales",icon:br}],pl=[{title:"Master Data",url:"/master",icon:Sa},{title:"Analytics",url:"/analytics",icon:Sa}],hl=[{title:"Settings",url:"/settings",icon:$a}];function xl(){const{state:r}=Qs(),s=ds().pathname,a=r==="collapsed",[n,i]=u.useState(!1);u.useEffect(()=>{const o=()=>{const N=document.documentElement.classList.contains("dark");i(N)};o();const f=new MutationObserver(o);return f.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]}),()=>f.disconnect()},[]);const c=n?"/molaga-logo_dark.png":"/molaga-logo.png",m=o=>s===o||o!=="/"&&s.startsWith(o),d=({isActive:o})=>o?"bg-primary/10 text-primary font-medium border-r-2 border-primary":"hover:bg-muted/50 transition-colors";return e.jsx(yn,{className:a?"w-14":"w-64",collapsible:"icon",children:e.jsxs(bn,{className:"bg-sidebar",children:[e.jsx("div",{className:"h-16 border-b border-sidebar-border flex items-center justify-center px-4",children:a?e.jsxs("div",{className:"w-10 h-10 flex items-center justify-center",children:[e.jsx("img",{src:c,alt:"Molaga",className:"w-8 h-8 object-contain transition-opacity duration-200",onError:o=>{const f=o.target;f.style.display="none",f.nextElementSibling?.classList.remove("hidden")}}),e.jsx("div",{className:"w-8 h-8 rounded bg-gradient-to-br from-red-500 to-red-600 flex items-center justify-center text-white font-bold text-sm hidden",children:"M"})]}):e.jsxs("div",{className:"flex items-center justify-center w-full",children:[e.jsx("img",{src:c,alt:"Molaga ERP",className:"h-12 object-contain max-w-full transition-opacity duration-200",onError:o=>{const f=o.target;f.style.display="none",f.nextElementSibling?.classList.remove("hidden")}}),e.jsxs("div",{className:"hidden text-center",children:[e.jsx("h2",{className:"font-bold text-sidebar-foreground text-xl",children:"MOLAGA"}),e.jsx("p",{className:"text-sm text-sidebar-foreground/70",children:"Spice Manufacturing ERP"})]})]})}),e.jsxs(ea,{children:[e.jsx(Ea,{children:"Main Modules"}),e.jsx(ta,{children:e.jsx(sa,{children:ml.map(o=>e.jsx(aa,{children:e.jsx(ra,{asChild:!0,isActive:m(o.url),children:e.jsxs(ja,{to:o.url,end:o.url==="/",className:d,children:[e.jsx(o.icon,{className:"h-4 w-4"}),!a&&e.jsx("span",{children:o.title})]})})},o.title))})})]}),e.jsxs(ea,{children:[e.jsx(Ea,{children:"Management"}),e.jsx(ta,{children:e.jsx(sa,{children:pl.map(o=>e.jsx(aa,{children:e.jsx(ra,{asChild:!0,children:e.jsxs(ja,{to:o.url,className:d,children:[e.jsx(o.icon,{className:"h-4 w-4"}),!a&&e.jsx("span",{children:o.title})]})})},o.title))})})]}),e.jsx("div",{className:"mt-auto",children:e.jsx(ea,{children:e.jsx(ta,{children:e.jsx(sa,{children:hl.map(o=>e.jsx(aa,{children:e.jsx(ra,{asChild:!0,children:e.jsxs(ja,{to:o.url,className:d,children:[e.jsx(o.icon,{className:"h-4 w-4"}),!a&&e.jsx("span",{children:o.title})]})})},o.title))})})})})]})})}const er="molaga_settings",Pt={company:{companyName:"Molaga Spices Pvt Ltd",legalName:"Molaga Spices Private Limited",registrationNumber:"",taxId:"",industryType:"Manufacturing",address:"",city:"",state:"",postalCode:"",country:"India",phone:"",email:"",website:"",fiscalYearStart:"04",currency:"INR",timezone:"Asia/Kolkata"},system:{language:"en",dateFormat:"DD/MM/YYYY",timeFormat:"24",firstDayOfWeek:"monday",decimalPlaces:"2",thousandSeparator:",",decimalSeparator:".",recordsPerPage:"50",theme:"light",sidebarCollapsed:!1,showTooltips:!0,enableAnimations:!0},security:{minPasswordLength:"8",requireUppercase:!0,requireLowercase:!0,requireNumbers:!0,requireSpecialChars:!0,passwordExpiry:"90",sessionTimeout:"30",maxSessions:"3",enable2FA:!1,loginAttempts:"5",lockoutDuration:"30"},notifications:{smtp:{host:"smtp.gmail.com",port:"587",username:"",password:"",fromEmail:"",fromName:"Molaga ERP",useTLS:!0},notifications:{lowStockAlerts:!0,taskCompletion:!0,backupStatus:!0,userLogin:!1,dataImportExport:!0}},backup:{autoBackup:!0,frequency:"daily",time:"00:00",retention:"30"}};class gl{settings;constructor(){this.settings=this.loadSettings()}loadSettings(){try{const t=localStorage.getItem(er);if(t){const s=JSON.parse(t);return{company:{...Pt.company,...s.company},system:{...Pt.system,...s.system},security:{...Pt.security,...s.security},notifications:{smtp:{...Pt.notifications.smtp,...s.notifications?.smtp},notifications:{...Pt.notifications.notifications,...s.notifications?.notifications}},backup:{...Pt.backup,...s.backup}}}}catch(t){console.error("Error loading settings:",t)}return Pt}saveSettings(){try{localStorage.setItem(er,JSON.stringify(this.settings))}catch(t){console.error("Error saving settings:",t)}}getAll(){return{...this.settings}}getCompany(){return{...this.settings.company}}updateCompany(t){return this.settings.company={...this.settings.company,...t},this.saveSettings(),this.getCompany()}getSystem(){return{...this.settings.system}}updateSystem(t){return this.settings.system={...this.settings.system,...t},this.saveSettings(),this.getSystem()}getSecurity(){return{...this.settings.security}}updateSecurity(t){return this.settings.security={...this.settings.security,...t},this.saveSettings(),this.getSecurity()}getNotifications(){return{...this.settings.notifications}}updateNotifications(t){return this.settings.notifications={smtp:{...this.settings.notifications.smtp,...t.smtp},notifications:{...this.settings.notifications.notifications,...t.notifications}},this.saveSettings(),this.getNotifications()}getBackup(){return{...this.settings.backup}}updateBackup(t){return this.settings.backup={...this.settings.backup,...t},this.saveSettings(),this.getBackup()}resetToDefaults(){return this.settings={...Pt},this.saveSettings(),this.getAll()}exportSettings(){return JSON.stringify(this.settings,null,2)}importSettings(t){try{const s=JSON.parse(t);return this.settings={company:{...Pt.company,...s.company},system:{...Pt.system,...s.system},security:{...Pt.security,...s.security},notifications:{smtp:{...Pt.notifications.smtp,...s.notifications?.smtp},notifications:{...Pt.notifications.notifications,...s.notifications?.notifications}},backup:{...Pt.backup,...s.backup}},this.saveSettings(),!0}catch(s){return console.error("Error importing settings:",s),!1}}}const oa=new gl;function Nn(){const[r,t]=u.useState(oa.getCompany()),s=u.useCallback(a=>{const n=oa.updateCompany(a);return t(n),n},[]);return{settings:r,updateSettings:s}}function wn(){const[r,t]=u.useState(oa.getSystem()),s=u.useCallback(a=>{const n=oa.updateSystem(a);return t(n),n},[]);return{settings:r,updateSettings:s}}const la=ei,ca=ti,fl=u.forwardRef(({className:r,inset:t,children:s,...a},n)=>e.jsxs(Nr,{ref:n,className:me("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[state=open]:bg-accent focus:bg-accent",t&&"pl-8",r),...a,children:[s,e.jsx(wr,{className:"ml-auto h-4 w-4"})]}));fl.displayName=Nr.displayName;const jl=u.forwardRef(({className:r,...t},s)=>e.jsx(Sr,{ref:s,className:me("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...t}));jl.displayName=Sr.displayName;const Hs=u.forwardRef(({className:r,sideOffset:t=4,...s},a)=>e.jsx(Xn,{children:e.jsx(_r,{ref:a,sideOffset:t,className:me("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...s})}));Hs.displayName=_r.displayName;const Ps=u.forwardRef(({className:r,inset:t,...s},a)=>e.jsx(kr,{ref:a,className:me("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",t&&"pl-8",r),...s}));Ps.displayName=kr.displayName;const yl=u.forwardRef(({className:r,children:t,checked:s,...a},n)=>e.jsxs(Cr,{ref:n,className:me("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",r),checked:s,...a,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Pr,{children:e.jsx(Dr,{className:"h-4 w-4"})})}),t]}));yl.displayName=Cr.displayName;const vl=u.forwardRef(({className:r,children:t,...s},a)=>e.jsxs(Tr,{ref:a,className:me("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",r),...s,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Pr,{children:e.jsx(Zn,{className:"h-2 w-2 fill-current"})})}),t]}));vl.displayName=Tr.displayName;const Sn=u.forwardRef(({className:r,inset:t,...s},a)=>e.jsx(Er,{ref:a,className:me("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",r),...s}));Sn.displayName=Er.displayName;const _n=u.forwardRef(({className:r,...t},s)=>e.jsx(Rr,{ref:s,className:me("-mx-1 my-1 h-px bg-muted",r),...t}));_n.displayName=Rr.displayName;function Je({children:r}){const{user:t,logout:s}=jt(),{toast:a}=Ie(),{settings:n}=Nn(),{settings:i}=wn();u.useEffect(()=>{const m=window.document.documentElement;if(m.classList.remove("light","dark"),i.theme==="auto"){const d=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";m.classList.add(d)}else m.classList.add(i.theme)},[i.theme]);const c=async()=>{try{await s(),a({title:"Success",description:"Logged out successfully"})}catch{a({title:"Error",description:"Failed to logout",variant:"destructive"})}};return e.jsx(jn,{children:e.jsxs("div",{className:"min-h-screen flex w-full bg-background",children:[e.jsx(xl,{}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("header",{className:"h-16 border-b border-border bg-card/50 backdrop-blur-sm sticky top-0 z-50",children:e.jsxs("div",{className:"flex items-center justify-between px-4 sm:px-6 h-full",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[e.jsx(vn,{className:"hover:bg-primary/10 p-2"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"font-semibold text-foreground text-sm sm:text-base",children:"Molaga ERP"})})]}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[n.companyName&&e.jsxs("div",{className:"hidden sm:flex items-center gap-2 px-3 py-1.5 rounded-md bg-primary/5 border border-primary/10",children:[e.jsx(qr,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:n.companyName})]}),e.jsx(A,{variant:"ghost",size:"icon",className:"hover:bg-primary/10 h-8 w-8 sm:h-10 sm:w-10",children:e.jsx(Ar,{className:"h-4 w-4"})}),e.jsxs(la,{children:[e.jsx(ca,{asChild:!0,children:e.jsx(A,{variant:"ghost",size:"icon",className:"hover:bg-primary/10 h-8 w-8 sm:h-10 sm:w-10",children:e.jsx(si,{className:"h-4 w-4"})})}),e.jsxs(Hs,{align:"end",className:"w-56",children:[e.jsx(Sn,{children:e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("p",{className:"text-sm font-medium leading-none",children:t?.name}),e.jsx("p",{className:"text-xs leading-none text-muted-foreground",children:t?.email})]})}),e.jsx(_n,{}),e.jsxs(Ps,{onClick:c,className:"text-red-600 focus:text-red-600",children:[e.jsx(ai,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Log out"})]})]})]})]})]})}),e.jsx("main",{className:"flex-1 p-4 sm:p-6 bg-gradient-to-br from-background to-muted/20",children:r})]})]})})}const Xe=({children:r})=>{const{user:t,loading:s}=jt(),a=ds();return s?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ze,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading..."})]})}):t?e.jsx(e.Fragment,{children:r}):e.jsx(qs,{to:"/login",state:{from:a},replace:!0})},bl=gs("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),$=u.forwardRef(({className:r,...t},s)=>e.jsx(Fr,{ref:s,className:me(bl(),r),...t}));$.displayName=Fr.displayName;const ae=u.forwardRef(({className:r,...t},s)=>e.jsx("div",{ref:s,className:me("rounded-lg border bg-card text-card-foreground shadow-sm",r),...t}));ae.displayName="Card";const fe=u.forwardRef(({className:r,...t},s)=>e.jsx("div",{ref:s,className:me("flex flex-col space-y-1.5 p-6",r),...t}));fe.displayName="CardHeader";const je=u.forwardRef(({className:r,...t},s)=>e.jsx("h3",{ref:s,className:me("text-2xl font-semibold leading-none tracking-tight",r),...t}));je.displayName="CardTitle";const De=u.forwardRef(({className:r,...t},s)=>e.jsx("p",{ref:s,className:me("text-sm text-muted-foreground",r),...t}));De.displayName="CardDescription";const ne=u.forwardRef(({className:r,...t},s)=>e.jsx("div",{ref:s,className:me("p-6 pt-0",r),...t}));ne.displayName="CardContent";const Ut=u.forwardRef(({className:r,...t},s)=>e.jsx("div",{ref:s,className:me("flex items-center p-6 pt-0",r),...t}));Ut.displayName="CardFooter";const Nl=()=>{const[r,t]=u.useState(""),[s,a]=u.useState(""),[n,i]=u.useState(!1),[c,m]=u.useState(!1),{login:d,loginWithGoogle:o}=jt(),f=Oa(),{toast:N}=Ie(),g=async j=>{j.preventDefault(),i(!0);try{await d(r,s),N({title:"Success",description:"Logged in successfully"}),f("/")}catch(P){N({title:"Error",description:P.message||"Failed to login",variant:"destructive"})}finally{i(!1)}},y=async()=>{m(!0);try{await o()}catch(j){N({title:"Error",description:j.message||"Failed to login with Google",variant:"destructive"}),m(!1)}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs(ae,{className:"w-full max-w-md",children:[e.jsxs(fe,{className:"space-y-1",children:[e.jsx(je,{className:"text-2xl font-bold text-center",children:"MOLAGA ERP"}),e.jsx(De,{className:"text-center",children:"Sign in to your account to continue"})]}),e.jsxs(ne,{children:[e.jsxs("form",{onSubmit:g,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{htmlFor:"email",children:"Email"}),e.jsx(G,{id:"email",type:"email",placeholder:"Enter your email",value:r,onChange:j=>t(j.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{htmlFor:"password",children:"Password"}),e.jsx(G,{id:"password",type:"password",placeholder:"Enter your password",value:s,onChange:j=>a(j.target.value),required:!0})]}),e.jsxs(A,{type:"submit",className:"w-full",disabled:n,children:[n&&e.jsx(ze,{className:"mr-2 h-4 w-4 animate-spin"}),"Sign In"]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx(fa,{className:"w-full"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{className:"bg-background px-2 text-muted-foreground",children:"Or continue with"})})]}),e.jsxs(A,{type:"button",variant:"outline",className:"w-full mt-4",onClick:y,disabled:c,children:[c&&e.jsx(ze,{className:"mr-2 h-4 w-4 animate-spin"}),e.jsxs("svg",{className:"mr-2 h-4 w-4",viewBox:"0 0 24 24",children:[e.jsx("path",{fill:"currentColor",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),e.jsx("path",{fill:"currentColor",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),e.jsx("path",{fill:"currentColor",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),e.jsx("path",{fill:"currentColor",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Continue with Google"]})]}),e.jsxs("div",{className:"mt-4 text-center text-sm",children:["Don't have an account?"," ",e.jsx(At,{to:"/register",className:"text-primary hover:underline",children:"Sign up"})]})]})]})})},wl=()=>{const[r,t]=u.useState(""),[s,a]=u.useState(""),[n,i]=u.useState(""),[c,m]=u.useState(""),[d,o]=u.useState(!1),[f,N]=u.useState(!1),{register:g,loginWithGoogle:y}=jt(),j=Oa(),{toast:P}=Ie(),x=async E=>{if(E.preventDefault(),n!==c){P({title:"Error",description:"Passwords do not match",variant:"destructive"});return}if(n.length<8){P({title:"Error",description:"Password must be at least 8 characters long",variant:"destructive"});return}o(!0);try{await g(s,n,r),P({title:"Success",description:"Account created successfully"}),j("/")}catch(D){P({title:"Error",description:D.message||"Failed to create account",variant:"destructive"})}finally{o(!1)}},C=async()=>{N(!0);try{await y()}catch(E){P({title:"Error",description:E.message||"Failed to login with Google",variant:"destructive"}),N(!1)}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs(ae,{className:"w-full max-w-md",children:[e.jsxs(fe,{className:"space-y-1",children:[e.jsx(je,{className:"text-2xl font-bold text-center",children:"MOLAGA ERP"}),e.jsx(De,{className:"text-center",children:"Create your account to get started"})]}),e.jsxs(ne,{children:[e.jsxs("form",{onSubmit:x,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{htmlFor:"name",children:"Full Name"}),e.jsx(G,{id:"name",type:"text",placeholder:"Enter your full name",value:r,onChange:E=>t(E.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{htmlFor:"email",children:"Email"}),e.jsx(G,{id:"email",type:"email",placeholder:"Enter your email",value:s,onChange:E=>a(E.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{htmlFor:"password",children:"Password"}),e.jsx(G,{id:"password",type:"password",placeholder:"Enter your password (min 8 characters)",value:n,onChange:E=>i(E.target.value),required:!0,minLength:8})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{htmlFor:"confirmPassword",children:"Confirm Password"}),e.jsx(G,{id:"confirmPassword",type:"password",placeholder:"Confirm your password",value:c,onChange:E=>m(E.target.value),required:!0})]}),e.jsxs(A,{type:"submit",className:"w-full",disabled:d,children:[d&&e.jsx(ze,{className:"mr-2 h-4 w-4 animate-spin"}),"Create Account"]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx(fa,{className:"w-full"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{className:"bg-background px-2 text-muted-foreground",children:"Or continue with"})})]}),e.jsxs(A,{type:"button",variant:"outline",className:"w-full mt-4",onClick:C,disabled:f,children:[f&&e.jsx(ze,{className:"mr-2 h-4 w-4 animate-spin"}),e.jsxs("svg",{className:"mr-2 h-4 w-4",viewBox:"0 0 24 24",children:[e.jsx("path",{fill:"currentColor",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),e.jsx("path",{fill:"currentColor",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),e.jsx("path",{fill:"currentColor",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),e.jsx("path",{fill:"currentColor",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Continue with Google"]})]}),e.jsxs("div",{className:"mt-4 text-center text-sm",children:["Already have an account?"," ",e.jsx(At,{to:"/login",className:"text-primary hover:underline",children:"Sign in"})]})]})]})})},Sl=gs("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function We({className:r,variant:t,...s}){return e.jsx("div",{className:me(Sl({variant:t}),r),...s})}function _l({title:r,value:t,change:s,changeType:a="neutral",icon:n,description:i}){const c={positive:"text-green-600 bg-green-50",negative:"text-red-600 bg-red-50",neutral:"text-muted-foreground bg-muted"}[a];return e.jsxs(ae,{className:"hover:shadow-lg transition-all duration-300 border-l-4 border-l-primary",children:[e.jsxs(fe,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(je,{className:"text-xs sm:text-sm font-medium text-muted-foreground",children:r}),e.jsx(n,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"})]}),e.jsxs(ne,{children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-foreground",children:t}),s&&e.jsx(We,{variant:"secondary",className:`text-xs mt-2 ${c}`,children:s}),i&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:i})]})]})}const tr=[{id:1,name:"Procurement",icon:Rs,description:"Raw Materials",status:"active"},{id:2,name:"Pre-Production",icon:$a,description:"Clean/Roast",status:"active"},{id:3,name:"Production",icon:$r,description:"Grinding",status:"active"},{id:4,name:"Post-Production",icon:ri,description:"Packing",status:"pending"},{id:5,name:"Sales",icon:ni,description:"Customer",status:"pending"}];function kl(){return e.jsxs(ae,{className:"col-span-full",children:[e.jsx(fe,{children:e.jsxs(je,{className:"flex items-center gap-2",children:[e.jsx($r,{className:"h-5 w-5 text-primary"}),"Production Flow Status"]})}),e.jsx(ne,{children:e.jsx("div",{className:"flex items-center justify-between overflow-x-auto pb-4",children:tr.map((r,t)=>e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"flex flex-col items-center min-w-0 flex-shrink-0",children:[e.jsx("div",{className:`
                  w-16 h-16 rounded-full border-2 flex items-center justify-center mb-2
                  ${r.status==="active"?"bg-primary/10 border-primary text-primary":"bg-muted border-muted-foreground/30 text-muted-foreground"}
                `,children:e.jsx(r.icon,{className:"h-6 w-6"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-medium text-sm",children:r.name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:r.description})]})]}),t<tr.length-1&&e.jsx(Ot,{className:"h-5 w-5 text-muted-foreground mx-6 flex-shrink-0"})]},r.id))})})]})}const $e=r=>({async getAll(t=[]){let s=[],a=0;const n=100;let i=!0;for(;i;)try{const c=await st.listDocuments(at,r,[...t,et.limit(n),et.offset(a)]);if(s.push(...c.documents),a+=n,i=c.documents.length===n,a>1e4){kt.warn(`âš ï¸ Pagination safety limit reached for ${r}, stopping at 10000 records`);break}}catch(c){throw kt.error(`Error fetching documents from ${r}:`,c),c}return kt.log(`ðŸ“¦ Fetched ${s.length} documents from ${r}`),s},async getPaginated(t=[],s={}){const a=s.limit||100,n=s.offset||0;try{const i=await st.listDocuments(at,r,[...t,et.limit(a),et.offset(n)]);return{documents:i.documents,total:i.total,hasMore:n+a<i.total}}catch(i){throw kt.error(`Error fetching paginated documents from ${r}:`,i),i}},async getById(t){return await st.getDocument(at,r,t)},async create(t){return await st.createDocument(at,r,hs.unique(),t)},async update(t,s){return await st.updateDocument(at,r,t,s)},async delete(t){await st.deleteDocument(at,r,t)}});({...$e(ke.PRODUCTION_STATUS)});const Cl={...$e(ke.POST_PRODUCTION_STATUS),async getWithRelations(){const r=await this.getAll(),t=$e(ke.PRODUCTS),s=$e(ke.PROCESSES),a=await t.getAll(),n=await s.getAll(),i=new Map(a.map(m=>[m.$id,m.name])),c=new Map(n.map(m=>[m.$id,m.process_name]));return r.map(m=>({...m,product_name:i.get(m.product_id)||"Unknown",process_name:c.get(m.process_id)||"Unknown"}))}};({...$e(ke.INVENTORY_STATUS)});const kn={...$e(ke.STOCK_STATUS),async getStockStatusByDateRange(r,t){const s=[];return r&&s.push(et.greaterThanEqual("status_date",r)),t&&s.push(et.lessThanEqual("status_date",t)),await this.getAll(s)}},zt={...$e(ke.PRODUCTION_TASKS),async getByDateRange(r,t){const s=[];return r&&s.push(et.greaterThanEqual("date",r.toISOString())),t&&s.push(et.lessThanEqual("date",t.toISOString())),this.getAll(s)},async getProductionTasksWithRelations(r,t,s){const a=[];r&&a.push(et.greaterThanEqual("date",r)),t&&a.push(et.lessThanEqual("date",t)),s&&a.push(et.equal("process_id",s));const n=await this.getAll(a),i=$e(ke.STAFF),c=$e(ke.PROCESSES),m=$e(ke.RAW_PRODUCTS),d=$e(ke.STOCKS),o=await i.getAll(),f=await c.getAll(),N=await m.getAll(),g=await d.getAll(),y=await Us.getAll(),j=new Map(o.map(E=>[E.$id,E.staff_name])),P=new Map(f.map(E=>[E.$id,E.process_name])),x=new Map(N.map(E=>[E.$id,E.raw_product])),C=new Map(g.map(E=>[E.$id,E.stock_name]));return n.map(E=>{const T=y.filter(F=>F.production_task_id===E.$id).map(F=>({...F,stock_name:C.get(F.stock_id)||"Unknown"}));return{...E,staff_name:j.get(E.staff_id)||"Unknown",process_name:P.get(E.process_id)||"Unknown",source_process_name:P.get(E.source_process_id)||"Unknown",raw_product_name:x.get(E.raw_product_id)||"Unknown",stock_items:T}})}},Zt={...$e(ke.POST_PRODUCTION_TASKS),async getPostProductionTasksWithRelations(){const r=await this.getAll(),t=$e(ke.STAFF),s=$e(ke.PROCESSES),a=$e(ke.PRODUCTS),n=$e(ke.STOCKS),i=await t.getAll(),c=await s.getAll(),m=await a.getAll(),d=await n.getAll(),o=new Map(i.map(y=>[y.$id,y.staff_name])),f=new Map(c.map(y=>[y.$id,y.process_name])),N=new Map(m.map(y=>[y.$id,y.product])),g=new Map(d.map(y=>[y.$id,y.stock_name]));return r.map(y=>({...y,staff_name:o.get(y.staff_id)||"Unknown",process_name:f.get(y.process_id)||"Unknown",source_process_name:f.get(y.source_process_id)||"Unknown",product_name:N.get(y.product_id)||"Unknown",stock_name:g.get(y.sku)||"Unknown"}))}},Bt={...$e(ke.STOCKS),async getCategories(){const r=await this.getAll(),t=new Set(r.map(s=>s.category));return Array.from(t)}},Ss=$e(ke.RAW_PRODUCTS),Ms=$e(ke.VENDORS),Pl=$e(ke.STAFF),js=$e(ke.PROCESSES),Ht=$e(ke.PRODUCTS),Os=$e(ke.SALES_CHANNELS),Gt={...$e(ke.PURCHASES),async getByDateRange(r,t){const s=[];if(r){const a=new Date(r),n=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`;s.push(et.greaterThanEqual("date",n))}if(t){const a=new Date(t),n=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`;s.push(et.lessThanEqual("date",n))}return this.getAll(s)}},Dl=$e(ke.SALES_ORDERS),Jt=$e(ke.SALES_UNITS),ls=$e(ke.SALES_RECORDS);({...$e(ke.PRE_PRODUCTION_STATUS)});const Us={...$e(ke.PRODUCTION_TASK_ITEMS),async deleteByProductionTaskId(r){const t=await this.getAll([et.equal("production_task_id",r)]);await Promise.all(t.map(s=>this.delete(s.$id)))}},cs={...$e(ke.PRE_PRODUCTION_TASKS),async getByDateRange(r,t){const s=[];if(r){const a=new Date(r),n=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`;s.push(et.greaterThanEqual("date_assigned",n))}if(t){const a=new Date(t),n=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`;s.push(et.lessThanEqual("date_assigned",n))}return this.getAll(s)},async getPreProductionTasksWithRelations(){const r=await this.getAll(),t=$e(ke.STAFF),s=$e(ke.PROCESSES),a=$e(ke.STOCKS),n=await t.getAll(),i=await s.getAll(),c=await a.getAll(),m=new Map(n.map(f=>[f.$id,f.staff_name])),d=new Map(i.map(f=>[f.$id,f.process_name])),o=new Map(c.map(f=>[f.$id,f.stock_name]));return r.map(f=>({...f,staff_name:m.get(f.staff_id)||"Unknown",process_name:d.get(f.process_id)||"Unknown",stock_name:o.get(f.stock_id)||"Unknown"}))}},Tl=()=>{const{data:r=[],isLoading:t}=Ne({queryKey:["dashboard","stock-status"],queryFn:()=>kn.getStockStatusByDateRange(),staleTime:6e4}),{data:s=[],isLoading:a}=Ne({queryKey:["dashboard","sales-orders"],queryFn:async()=>{const{documents:x}=await Dl.list();return x},staleTime:6e4}),{data:n=[],isLoading:i}=Ne({queryKey:["dashboard","recent-purchases"],queryFn:async()=>{const{documents:x}=await Gt.list();return x.sort((C,E)=>new Date(E.$createdAt||E.date).getTime()-new Date(C.$createdAt||C.date).getTime()).slice(0,5)},staleTime:6e4}),{data:c=[],isLoading:m}=Ne({queryKey:["dashboard","recent-prepro-tasks"],queryFn:async()=>{const{documents:x}=await cs.list();return x.sort((C,E)=>new Date(E.$createdAt||E.date_assigned).getTime()-new Date(C.$createdAt||C.date_assigned).getTime()).slice(0,5)},staleTime:6e4}),d=(r||[]).reduce((x,C)=>x+(C.closing_bal||0),0),o=(s||[]).filter(x=>x.status!=="delivered"&&x.status!=="cancelled").length,f=(c||[]).reduce((x,C)=>x+(C.assigned_quantity||0),0),N=(c||[]).reduce((x,C)=>x+((C.assigned_quantity||0)-(C.wastage_quantity||0)),0),g=f>0?N/f*100:0,y=(r||[]).filter(x=>(x.closing_bal||0)<=(x.min_level||0)).map(x=>({name:x.stock_name,current:`${x.closing_bal||0} kg`,minimum:`${x.min_level||0} kg`,severity:(x.closing_bal||0)===0?"critical":"warning"})).slice(0,5),j=[...(n||[]).map(x=>({id:x.$id||`purchase-${x.date}`,action:"New purchase",item:`${x.stock_id} - ${x.quantity} units @ ${x.rate}`,time:Ga(new Date(x.date||x.$createdAt),{addSuffix:!0}),status:"success"})),...(c||[]).map(x=>({id:x.$id||`task-${x.date_assigned}`,action:`${x.status==="completed"?"Task completed":x.status==="in_progress"?"Task in progress":"Task created"}`,item:`${x.process_id} - ${x.assigned_quantity} units (${x.stock_id})`,time:Ga(new Date(x.date_completed||x.date_assigned||x.$createdAt),{addSuffix:!0}),status:x.status==="completed"?"success":"error"}))].sort((x,C)=>x.time>C.time?-1:1).slice(0,5),P=[{title:"Total Raw Stock",value:`${d.toLocaleString()} kg`,changeType:"neutral",icon:Rs,description:"Sum of closing balances across stocks"},{title:"Active Orders",value:o,changeType:"neutral",icon:Aa,description:"Not delivered or cancelled"},{title:"Production Efficiency",value:`${g.toFixed(1)}%`,changeType:g>=90?"positive":"negative",icon:zs,description:"Effective completed vs assigned (recent)"},{title:"Low Stock Alerts",value:y.length,changeType:y.length>0?"negative":"neutral",icon:Dt,description:"Closing balance below minimum"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Dashboard"}),e.jsx("p",{className:"text-muted-foreground",children:"Welcome to Molaga ERP - Your complete spice manufacturing solution"})]}),e.jsx("div",{className:"grid gap-3 sm:gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-4",children:P.map((x,C)=>e.jsx(_l,{...x},C))}),e.jsx(kl,{}),e.jsxs("div",{className:"grid gap-4 sm:gap-6 grid-cols-1 lg:grid-cols-2",children:[e.jsxs(ae,{children:[e.jsx(fe,{children:e.jsxs(je,{className:"flex items-center gap-2",children:[e.jsx(_a,{className:"h-5 w-5 text-primary"}),"Recent Activities"]})}),e.jsx(ne,{children:e.jsxs("div",{className:"space-y-4",children:[j.map(x=>e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg hover:bg-muted/50 transition-colors",children:[e.jsx("div",{className:`mt-0.5 ${x.status==="success"?"text-green-600":"text-red-600"}`,children:x.status==="success"?e.jsx(Xt,{className:"h-4 w-4"}):e.jsx(ka,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:x.action}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:x.item}),e.jsx("p",{className:"text-xs text-muted-foreground",children:x.time})]})]},x.id)),(t||a||i||m)&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading real data..."}),!j.length&&!(t||a||i||m)&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"No recent activities found."})]})})]}),e.jsxs(ae,{children:[e.jsx(fe,{children:e.jsxs(je,{className:"flex items-center gap-2",children:[e.jsx(Dt,{className:"h-5 w-5 text-destructive"}),"Low Stock Alerts"]})}),e.jsx(ne,{children:e.jsxs("div",{className:"space-y-3",children:[y.map((x,C)=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-border",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm text-foreground",children:x.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Current: ",x.current," | Min: ",x.minimum]})]}),e.jsx(We,{variant:x.severity==="critical"?"destructive":"secondary",className:x.severity==="critical"?"bg-red-100 text-red-800":x.severity==="warning"?"bg-yellow-100 text-yellow-800":"bg-orange-100 text-orange-800",children:x.severity})]},C)),!y.length&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"No low stock alerts."})]})})]})]})]})},Ds=u.forwardRef(({className:r,value:t,...s},a)=>e.jsx(Ir,{ref:a,className:me("relative h-4 w-full overflow-hidden rounded-full bg-secondary",r),...s,children:e.jsx(ii,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(t||0)}%)`}})}));Ds.displayName=Ir.displayName;class Qt{static CHUNK_SIZE=1e3;static MAX_MEMORY_RECORDS=1e4;static async exportToCSV(t,s){try{s?.({current:0,total:t.data.length,percentage:0,status:"preparing",message:"Preparing CSV export..."});const a=this.formatDataForExport(t.data,t.headers);s?.({current:t.data.length*.5,total:t.data.length,percentage:50,status:"processing",message:"Processing data..."});let n=a;t.metadata&&(n=[...this.createMetadataRows(t.metadata),[],t.headers,...a.slice(1)]),s?.({current:t.data.length*.8,total:t.data.length,percentage:80,status:"generating",message:"Generating CSV file..."});const i=Is.unparse(n,{header:!1,skipEmptyLines:!1});s?.({current:t.data.length,total:t.data.length,percentage:95,status:"downloading",message:"Downloading file..."});const c=new Blob([i],{type:"text/csv;charset=utf-8;"}),m=this.generateFilename(t.filename,"csv");Ls.saveAs(c,m),s?.({current:t.data.length,total:t.data.length,percentage:100,status:"complete",message:"Export completed successfully"})}catch(a){throw s?.({current:0,total:t.data.length,percentage:0,status:"error",message:`Export failed: ${a instanceof Error?a.message:"Unknown error"}`}),a}}static async exportToXLSX(t,s){try{s?.({current:0,total:t.data.length,percentage:0,status:"preparing",message:"Preparing Excel export..."});const a=St.book_new(),n=this.formatDataForExport(t.data,t.headers);s?.({current:t.data.length*.3,total:t.data.length,percentage:30,status:"processing",message:"Processing data..."});const i=St.aoa_to_sheet(n);if(this.applyExcelFormatting(i,t.headers.length,n.length),St.book_append_sheet(a,i,"Data"),s?.({current:t.data.length*.6,total:t.data.length,percentage:60,status:"processing",message:"Creating worksheets..."}),t.metadata){const o=this.createMetadataSheet(t.metadata);St.book_append_sheet(a,o,"Export Info")}s?.({current:t.data.length*.8,total:t.data.length,percentage:80,status:"generating",message:"Generating Excel file..."});const c=Ja(a,{bookType:"xlsx",type:"array",compression:!0});s?.({current:t.data.length,total:t.data.length,percentage:95,status:"downloading",message:"Downloading file..."});const m=new Blob([c],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),d=this.generateFilename(t.filename,"xlsx");Ls.saveAs(m,d),s?.({current:t.data.length,total:t.data.length,percentage:100,status:"complete",message:"Export completed successfully"})}catch(a){throw s?.({current:0,total:t.data.length,percentage:0,status:"error",message:`Export failed: ${a instanceof Error?a.message:"Unknown error"}`}),a}}static async exportLargeDataset(t,s){if(t.data.length<=this.MAX_MEMORY_RECORDS)return t.format==="csv"?this.exportToCSV(t,s):this.exportToXLSX(t,s);try{s?.({current:0,total:t.data.length,percentage:0,status:"preparing",message:"Preparing large dataset export..."});const a=this.chunkArray(t.data,this.CHUNK_SIZE);let n=0;t.format==="csv"?await this.exportLargeCSV(t,a,s):await this.exportLargeXLSX(t,a,s)}catch(a){throw s?.({current:0,total:t.data.length,percentage:0,status:"error",message:`Large export failed: ${a instanceof Error?a.message:"Unknown error"}`}),a}}static formatDataForExport(t,s){if(t.length===0)return[s];const a=[s];return t.forEach(n=>{const i=s.map(c=>{const m=n[c]||n[this.camelToSnake(c)]||"";return this.formatCellValue(m)});a.push(i)}),a}static formatCellValue(t){return t==null?"":typeof t=="boolean"?t?"Yes":"No":t instanceof Date?t.toLocaleDateString("en-GB"):typeof t=="number"?t%1===0?t.toString():t.toFixed(2):typeof t=="object"?JSON.stringify(t):String(t)}static generateFilename(t,s){const a=new Date().toISOString().slice(0,19).replace(/[:.]/g,"-");return`${t}_${a}.${s}`}static createMetadataRows(t){return[["Export Information"],["Exported At:",t.exportedAt.toLocaleString()],["Exported By:",t.exportedBy],["Page Source:",t.pageSource],["Record Count:",t.recordCount.toString()],["Version:",t.version],...t.filters?[["Filters:",JSON.stringify(t.filters)]]:[]]}static createMetadataSheet(t){const s=[["Export Information",""],["Exported At",t.exportedAt.toLocaleString()],["Exported By",t.exportedBy],["Page Source",t.pageSource],["Record Count",t.recordCount],["Version",t.version],...t.filters?[["Filters",JSON.stringify(t.filters)]]:[]];return St.aoa_to_sheet(s)}static applyExcelFormatting(t,s,a){const n=St.encode_range({s:{c:0,r:0},e:{c:s-1,r:a-1}});t["!ref"]=n;const i=Array(s).fill({wch:15});t["!cols"]=i;for(let c=0;c<s;c++){const m=St.encode_cell({r:0,c});t[m]&&(t[m].s={font:{bold:!0},fill:{fgColor:{rgb:"E2E8F0"}}})}}static async exportLargeCSV(t,s,a){let n="",i=0;if(n+=Is.unparse([t.headers],{header:!1})+`
`,t.metadata){const d=this.createMetadataRows(t.metadata);n=Is.unparse(d,{header:!1})+`

`+n}for(let d=0;d<s.length;d++){const o=s[d],f=this.formatDataForExport(o,t.headers).slice(1);n+=Is.unparse(f,{header:!1}),d<s.length-1&&(n+=`
`),i+=o.length,a?.({current:i,total:t.data.length,percentage:Math.round(i/t.data.length*80),status:"processing",message:`Processing chunk ${d+1} of ${s.length}...`}),await new Promise(N=>setTimeout(N,10))}const c=new Blob([n],{type:"text/csv;charset=utf-8;"}),m=this.generateFilename(t.filename,"csv");Ls.saveAs(c,m)}static async exportLargeXLSX(t,s,a){const n=St.book_new();let i=[t.headers],c=0;for(let N=0;N<s.length;N++){const g=s[N],y=this.formatDataForExport(g,t.headers).slice(1);i.push(...y),c+=g.length,a?.({current:c,total:t.data.length,percentage:Math.round(c/t.data.length*70),status:"processing",message:`Processing chunk ${N+1} of ${s.length}...`}),await new Promise(j=>setTimeout(j,10))}const m=St.aoa_to_sheet(i);if(this.applyExcelFormatting(m,t.headers.length,i.length),St.book_append_sheet(n,m,"Data"),t.metadata){const N=this.createMetadataSheet(t.metadata);St.book_append_sheet(n,N,"Export Info")}const d=Ja(n,{bookType:"xlsx",type:"array",compression:!0}),o=new Blob([d],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),f=this.generateFilename(t.filename,"xlsx");Ls.saveAs(o,f)}static chunkArray(t,s){const a=[];for(let n=0;n<t.length;n+=s)a.push(t.slice(n,n+s));return a}static camelToSnake(t){return t.replace(/[A-Z]/g,s=>`_${s.toLowerCase()}`)}}const Rt=({data:r,headers:t,filename:s,className:a,disabled:n=!1,includeMetadata:i=!0,metadata:c,onExportStart:m,onExportComplete:d,variant:o="outline",size:f="default"})=>{const[N,g]=u.useState(!1),[y,j]=u.useState(null),[P,x]=u.useState(null),C=async F=>{if(!(N||n))try{g(!0),x(F),j(null),m?.();const K=i?{exportedAt:new Date,exportedBy:"Current User",pageSource:s,recordCount:r.length,version:"1.0.0",...c}:void 0,O={filename:s,headers:t,data:r,format:F,metadata:K};j({current:0,total:r.length,percentage:0,status:"preparing",message:`Preparing ${F.toUpperCase()} export...`}),r.length>1e4?await Qt.exportLargeDataset(O,j):F==="csv"?await Qt.exportToCSV(O,j):await Qt.exportToXLSX(O,j),Wt.success(`Successfully exported ${r.length} records to ${F.toUpperCase()}`,{description:`File: ${s}_${new Date().toISOString().slice(0,19).replace(/[:.]/g,"-")}.${F}`}),d?.(!0)}catch(K){console.error("Export failed:",K),Wt.error("Export failed",{description:K instanceof Error?K.message:"An unexpected error occurred"}),d?.(!1)}finally{g(!1),x(null),j(null)}},E=()=>N&&P?`Exporting ${P.toUpperCase()}...`:"Export",D=()=>N?e.jsx(ze,{className:"h-4 w-4 animate-spin"}):e.jsx(xs,{className:"h-4 w-4"}),T=!r||r.length===0;return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(la,{children:[e.jsx(ca,{asChild:!0,children:e.jsxs(A,{variant:o,size:f,className:a,disabled:n||N||T,children:[D(),E()]})}),e.jsxs(Hs,{align:"end",children:[e.jsxs(Ps,{onClick:()=>C("csv"),disabled:N||T,className:"cursor-pointer",children:[e.jsx(Cs,{className:"h-4 w-4 mr-2"}),"Export as CSV"]}),e.jsxs(Ps,{onClick:()=>C("xlsx"),disabled:N||T,className:"cursor-pointer",children:[e.jsx(Lr,{className:"h-4 w-4 mr-2"}),"Export as Excel"]})]})]}),N&&y&&e.jsxs("div",{className:"space-y-2 min-w-[200px]",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:y.message||"Processing..."}),e.jsxs("span",{className:"text-muted-foreground",children:[y.percentage,"%"]})]}),e.jsx(Ds,{value:y.percentage,className:"h-2"}),y.currentBatch&&y.totalBatches&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Batch ",y.currentBatch," of ",y.totalBatches]})]}),T&&e.jsx("div",{className:"text-xs text-muted-foreground",children:"No data available to export"})]})},lt=vr,ys=oi,El=jr,Cn=u.forwardRef(({className:r,...t},s)=>e.jsx(da,{ref:s,className:me("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r),...t}));Cn.displayName=da.displayName;const rt=u.forwardRef(({className:r,children:t,...s},a)=>e.jsxs(El,{children:[e.jsx(Cn,{}),e.jsxs(ua,{ref:a,className:me("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",r),...s,children:[t,e.jsxs(yr,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-accent data-[state=open]:text-muted-foreground hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[e.jsx(ks,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));rt.displayName=ua.displayName;const nt=({className:r,...t})=>e.jsx("div",{className:me("flex flex-col space-y-1.5 text-center sm:text-left",r),...t});nt.displayName="DialogHeader";const it=({className:r,...t})=>e.jsx("div",{className:me("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",r),...t});it.displayName="DialogFooter";const ot=u.forwardRef(({className:r,...t},s)=>e.jsx(ma,{ref:s,className:me("text-lg font-semibold leading-none tracking-tight",r),...t}));ot.displayName=ma.displayName;const ct=u.forwardRef(({className:r,...t},s)=>e.jsx(pa,{ref:s,className:me("text-sm text-muted-foreground",r),...t}));ct.displayName=pa.displayName;class wa{static DEFAULT_BATCH_SIZE=100;static MAX_FILE_SIZE_MB=50;static SUPPORTED_FORMATS=[".csv",".xlsx",".xls"];static async parseFile(t,s){try{this.validateFile(t),s?.({current:0,total:100,percentage:0,status:"parsing",message:"Starting file parsing..."});const a=this.getFileExtension(t.name);let n=[];if(a===".csv")n=await this.parseCSVFile(t,s);else if(a===".xlsx"||a===".xls")n=await this.parseExcelFile(t,s);else throw new Error(`Unsupported file format: ${a}`);return s?.({current:100,total:100,percentage:100,status:"complete",message:`Successfully parsed ${n.length} rows`}),n}catch(a){throw s?.({current:0,total:100,percentage:0,status:"error",message:`Parsing failed: ${a instanceof Error?a.message:"Unknown error"}`}),a}}static validateData(t,s,a){const n={isValid:!0,errors:[],warnings:[],validData:[],invalidData:[]};if(t.length===0)return n.isValid=!1,n.errors.push({row:0,column:"file",message:"File contains no data rows",value:null,severity:"error"}),n;a?.({current:0,total:t.length,percentage:0,status:"validating",message:"Starting data validation..."});const i=Object.keys(t[0]),c=this.validateHeaders(i,s);c.isValid||(n.errors.push(...c.errors),n.isValid=!1),t.forEach((d,o)=>{const f=o+1,N=this.validateRow(d,s.validationRules,f,t,s);N.errors.length>0?(n.errors.push(...N.errors),n.invalidData.push({...d,_rowNumber:f})):n.validData.push({...d,_rowNumber:f}),N.warnings.length>0&&n.warnings.push(...N.warnings),(o%100===0||o===t.length-1)&&a?.({current:o+1,total:t.length,percentage:Math.round((o+1)/t.length*100),status:"validating",message:`Validating row ${o+1} of ${t.length}...`})});const m=this.detectDuplicates(t,s);return n.warnings.push(...m),n.isValid=n.errors.length===0,a?.({current:t.length,total:t.length,percentage:100,status:"complete",message:`Validation complete. ${n.validData.length} valid rows, ${n.invalidData.length} invalid rows`}),n}static async processImport(t,s,a){const n=s.batchSize||this.DEFAULT_BATCH_SIZE,i=this.createBatches(t,n),c={totalRows:t.length,successfulRows:0,failedRows:0,errors:[],warnings:[],processedData:[],skippedRows:0};a?.({current:0,total:t.length,percentage:0,status:"processing",message:"Starting import process...",currentBatch:0,totalBatches:i.length});try{if(s.dataProcessor)for(let m=0;m<t.length;m++){const d=t[m];try{let o={...d};if(s.columnMapper){const N={};Object.keys(d).forEach(g=>{const y=s.columnMapper(g);N[y]=d[g],N[g]=d[g]}),o={...o,...N}}console.log(`ðŸ”„ [ImportService] Processing row ${m+1}...`),console.log("ðŸ”„ [ImportService] Transformed row:",o);const f=await s.dataProcessor(o,t);console.log(`âœ… [ImportService] Row ${m+1} processed successfully. Saved data:`,f),c.processedData.push(f),c.successfulRows++,console.log(`âœ… [ImportService] Incremented successfulRows to: ${c.successfulRows}`)}catch(o){console.error(`âŒ [ImportService] Error processing row ${m+1}:`,o),console.error("âŒ [ImportService] Error details:",{message:o instanceof Error?o.message:"Unknown error",stack:o instanceof Error?o.stack:void 0,row:d}),c.errors.push({row:m+1,column:"processing",message:o instanceof Error?o.message:"Failed to process row",value:d,severity:"error"}),c.failedRows++}(m%10===0||m===t.length-1)&&a?.({current:m+1,total:t.length,percentage:Math.round((m+1)/t.length*100),status:"processing",message:`Processing row ${m+1} of ${t.length}...`,currentBatch:Math.floor(m/n)+1,totalBatches:i.length}),await new Promise(o=>setTimeout(o,10))}else for(let m=0;m<i.length;m++){const d=i[m],o=await this.processBatch(d,n,m+1);c.successfulRows+=o.processed,c.errors.push(...o.errors),c.warnings.push(...o.warnings),c.processedData.push(...o.data);const f=(m+1)*n,N=Math.min(f,t.length);a?.({current:N,total:t.length,percentage:Math.round(N/t.length*100),status:"processing",message:`Processing batch ${m+1} of ${i.length}...`,currentBatch:m+1,totalBatches:i.length}),await new Promise(g=>setTimeout(g,10))}return c.failedRows=c.totalRows-c.successfulRows,a?.({current:t.length,total:t.length,percentage:100,status:"complete",message:`Import complete. ${c.successfulRows} successful, ${c.failedRows} failed`}),s.onImportComplete(c),c}catch(m){throw a?.({current:0,total:t.length,percentage:0,status:"error",message:`Import failed: ${m instanceof Error?m.message:"Unknown error"}`}),m}}static async processBatch(t,s,a){const n={processed:0,errors:[],warnings:[],data:[]};try{return await new Promise(i=>setTimeout(i,50)),t.forEach((i,c)=>{try{const m=this.processRow(i);n.data.push(m),n.processed++}catch(m){n.errors.push({row:(a-1)*s+c+1,column:"processing",message:m instanceof Error?m.message:"Processing failed",value:i,severity:"error"})}}),n}catch(i){return t.forEach((c,m)=>{n.errors.push({row:(a-1)*s+m+1,column:"batch",message:`Batch processing failed: ${i instanceof Error?i.message:"Unknown error"}`,value:null,severity:"error"})}),n}}static validateFile(t){const s=this.MAX_FILE_SIZE_MB*1024*1024;if(t.size>s)throw new Error(`File size exceeds maximum allowed size of ${this.MAX_FILE_SIZE_MB}MB`);const a=this.getFileExtension(t.name);if(!this.SUPPORTED_FORMATS.includes(a))throw new Error(`Unsupported file format. Supported formats: ${this.SUPPORTED_FORMATS.join(", ")}`)}static async parseCSVFile(t,s){return new Promise((a,n)=>{Is.parse(t,{header:!0,skipEmptyLines:!0,transformHeader:i=>i.trim(),transform:(i,c)=>{const m=i.trim();if(c.toLowerCase().includes("date")){if(m==="")return"";const d=m.match(/^(\d{2})-(\d{2})-(\d{4})$/);if(d){const[,f,N,g]=d,y=new Date(parseInt(g),parseInt(N)-1,parseInt(f));if(!isNaN(y.getTime()))return`${g}-${N}-${f}`}if(/^\d{4}-\d{2}-\d{2}$/.test(m))return m;const o=new Date(m);if(!isNaN(o.getTime())){const f=o.getFullYear(),N=String(o.getMonth()+1).padStart(2,"0"),g=String(o.getDate()).padStart(2,"0");return`${f}-${N}-${g}`}return m}if(c.toLowerCase().includes("quantity")||c.toLowerCase().includes("qty")||c.toLowerCase().includes("units")||c.toLowerCase().includes("rate")||c.toLowerCase().includes("price")||c.toLowerCase().includes("amount")||c.toLowerCase().includes("total")){if(m==="")return"";const d=parseFloat(m);return isNaN(d)?m:d}return m},step:(i,c)=>{const m=Math.round((t.size-c.streamer._input.length)/t.size*80);s?.({current:m,total:100,percentage:m,status:"parsing",message:"Parsing CSV file..."})},complete:i=>{if(i.errors.length>0){const c=i.errors.map(m=>`Row ${m.row}: ${m.message}`).join("; ");n(new Error(`CSV parsing errors: ${c}`))}else a(i.data)},error:i=>{n(new Error(`CSV parsing failed: ${i.message}`))}})})}static async parseExcelFile(t,s){return new Promise((a,n)=>{const i=new FileReader;i.onload=c=>{try{s?.({current:50,total:100,percentage:50,status:"parsing",message:"Reading Excel file..."});const m=new Uint8Array(c.target?.result),d=Gi(m,{type:"array"}),o=d.SheetNames[0],f=d.Sheets[o];s?.({current:80,total:100,percentage:80,status:"parsing",message:"Converting Excel data..."});const N=St.sheet_to_json(f,{header:1,defval:"",blankrows:!1,raw:!0});if(N.length===0){n(new Error("Excel file contains no data"));return}const g=(P,x,C)=>{if(P==null||P==="")return"";if(x.toLowerCase().includes("date")){if(typeof P=="string"){const E=P.trim();if(E==="")return"";const D=E.match(/^(\d{1,2})-(\d{1,2})-(\d{4})$/);if(D){const[,K,O,Z]=D,M=parseInt(K),z=parseInt(O),Q=parseInt(Z);if(M>=1&&M<=31&&z>=1&&z<=12&&Q>=1900&&Q<=2100){const R=new Date(Q,z-1,M);if(!isNaN(R.getTime())&&R.getFullYear()===Q&&R.getMonth()===z-1&&R.getDate()===M){const w=String(Q),Y=String(z).padStart(2,"0"),_=String(M).padStart(2,"0");return`${w}-${Y}-${_}`}}}const T=E.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);if(T){const[,K,O,Z]=T,M=parseInt(K),z=parseInt(O),Q=parseInt(Z);if(M>=1&&M<=31&&z>=1&&z<=12&&Q>=1900&&Q<=2100){const R=new Date(Q,z-1,M);if(!isNaN(R.getTime())&&R.getFullYear()===Q&&R.getMonth()===z-1&&R.getDate()===M){const w=String(Q),Y=String(z).padStart(2,"0"),_=String(M).padStart(2,"0");return`${w}-${Y}-${_}`}}}if(/^\d{4}-\d{2}-\d{2}$/.test(E)){const K=new Date(E);if(!isNaN(K.getTime()))return E}const F=new Date(E);if(!isNaN(F.getTime())){const K=F.getFullYear(),O=String(F.getMonth()+1).padStart(2,"0"),Z=String(F.getDate()).padStart(2,"0");return`${K}-${O}-${Z}`}return E}if(P instanceof Date){if(isNaN(P.getTime()))return"";const E=P.getFullYear(),D=String(P.getMonth()+1).padStart(2,"0"),T=String(P.getDate()).padStart(2,"0");return`${E}-${D}-${T}`}if(typeof P=="number"&&P>=1&&P<3e6){const E=new Date(1899,11,30),D=new Date(E.getTime()+P*864e5);if(!isNaN(D.getTime())){const T=D.getFullYear(),F=String(D.getMonth()+1).padStart(2,"0"),K=String(D.getDate()).padStart(2,"0");return`${T}-${F}-${K}`}}return""}if(x.toLowerCase().includes("quantity")||x.toLowerCase().includes("qty")||x.toLowerCase().includes("units")||x.toLowerCase().includes("rate")||x.toLowerCase().includes("price")||x.toLowerCase().includes("amount")||x.toLowerCase().includes("total")){if(typeof P=="number")return P;if(typeof P=="string"){const E=P.trim();if(E==="")return"";const D=parseFloat(E);if(!isNaN(D))return D}}return typeof P=="string"?P.trim():String(P)},y=N[0].map(P=>String(P).trim()),j=N.slice(1).map(P=>{const x={};return y.forEach((C,E)=>{x[C]=g(P[E],C)}),x});a(j)}catch(m){n(new Error(`Excel parsing failed: ${m instanceof Error?m.message:"Unknown error"}`))}},i.onerror=()=>{n(new Error("Failed to read Excel file"))},i.readAsArrayBuffer(t)})}static validateHeaders(t,s){const a=[];s.requiredColumns.forEach(i=>{t.includes(i)||a.push({row:0,column:i,message:`Required column '${i}' is missing`,value:null,severity:"error"})});const n=[...s.requiredColumns,...s.optionalColumns];return t.forEach(i=>{n.includes(i)||a.push({row:0,column:i,message:`Unknown column '${i}' will be ignored`,value:null,severity:"warning"})}),{isValid:a.filter(i=>i.severity==="error").length===0,errors:a}}static detectDuplicates(t,s){const a=[];if(t.length===0)return a;const n=t[0],i=Object.keys(n),c=y=>{i.map(j=>j.toLowerCase().trim());for(const j of y){const P=j.toLowerCase().trim(),x=i.find(E=>E.toLowerCase().trim()===P);if(x)return x;const C=i.find(E=>E.toLowerCase().includes(P)||P.includes(E.toLowerCase()));if(C)return C}return null},m=c(["Date","date","purchase_date","purchaseDate","Purchase Date","Date Assigned","date_assigned","Date Completed","date_completed"]),d=c(["Purchase Code","Purchase_Code","purchase_code","purchaseCode","Code","Task ID","Task_ID","task_id","taskId","Product","product","product_name","productName","SKU","sku"]);if(!d&&!m)return a;const o=(y,j)=>{if(!j)return null;const P=y[j];return P==null||P===""?null:String(P).trim()},f=y=>{if(!y)return null;if(/^\d{4}-\d{2}-\d{2}$/.test(y))return y;const j=new Date(y);if(!isNaN(j.getTime())){const P=j.getFullYear(),x=String(j.getMonth()+1).padStart(2,"0"),C=String(j.getDate()).padStart(2,"0");return`${P}-${x}-${C}`}return y.toLowerCase()},N=new Map,g=new Map;if(s.duplicateChecker&&t.length>1){const y=new Map;t.forEach((j,P)=>{const x=P+1,C=(j["Task ID"]||j.task_id||j.task_id||"").toLowerCase().trim(),E=(j["Stock Name"]||j.stock_name||j.stock_name||"").toLowerCase().trim(),D=(j["Stock Source"]||j.stock_source||j.stock_source||"").toLowerCase().trim(),T=j["Date Assigned"]||j.date_assigned||j.date_assigned||"",F=(j.Process||j.process_name||j.process_name||"").toLowerCase().trim();let K="";if(T)if(typeof T=="string"){const Z=T.match(/^(\d{2})-(\d{2})-(\d{4})$/);if(Z){const[,M,z,Q]=Z,R=new Date(parseInt(Q),parseInt(z)-1,parseInt(M));isNaN(R.getTime())||(K=R.toISOString().split("T")[0])}else{const M=new Date(T);isNaN(M.getTime())||(K=M.toISOString().split("T")[0])}}else T instanceof Date&&(K=T.toISOString().split("T")[0]);const O=`${C}|${E}|${D}|${K}|${F}`;y.has(O)||y.set(O,[]),y.get(O).push(x)}),y.forEach((j,P)=>{if(j.length>1){const[x,C,E,D,T]=P.split("|");j.forEach(F=>{a.push({row:F,column:"Multiple Fields",message:`âš ï¸ Duplicate detected: The combination of Task ID "${x}", Stock Name "${C}", Stock Source "${E}", Date Assigned "${D}", and Process "${T}" appears in ${j.length} row(s) (Rows: ${j.join(", ")}). This may create duplicate records. You can still import if these are intentional additions.`,value:P})})}})}else t.forEach((y,j)=>{const P=j+1,x=f(o(y,m)),C=o(y,d)?.toLowerCase();if(x&&C){const E=`${x}|${C}`;N.has(E)||N.set(E,[]),N.get(E).push(P)}C&&(g.has(C)||g.set(C,[]),g.get(C).push(P))});if(s.existingData&&s.existingData.length>0)if(s.duplicateChecker)t.forEach((y,j)=>{const P=j+1;s.duplicateChecker(y,s.existingData)&&a.push({row:P,column:"Multiple Fields",message:"âš ï¸ This record already exists in the database. The combination of Task ID, Stock Name, Stock Source, Date Assigned, and Process matches an existing record. This will create a duplicate.",value:"Duplicate Record"})});else{const y=new Set;s.existingData.forEach(j=>{const P=f(j.date||j.purchase_date||j.purchaseDate||j.date_assigned||j.date_completed),x=(j.purchase_code||j.purchaseCode||j.code||j.task_id||j.taskId||j.product_name||j.product||j.sku||"").toLowerCase().trim();P&&x&&y.add(`${P}|${x}`)}),t.forEach((j,P)=>{const x=P+1,C=f(o(j,m)),E=o(j,d)?.toLowerCase();if(C&&E){const D=`${C}|${E}`;y.has(D)&&a.push({row:x,column:d||"Identifier",message:`âš ï¸ This record already exists in the database: Date "${C}" and ${d||"Identifier"} "${E}" combination matches an existing record. This will create a duplicate.`,value:`${C}|${E}`})}})}return N.forEach((y,j)=>{if(y.length>1){const[P,x]=j.split("|");y.forEach(C=>{a.push({row:C,column:d||"Identifier",message:`âš ï¸ Duplicate detected: Date "${P}" and ${d||"Identifier"} "${x}" combination appears in ${y.length} row(s) (Rows: ${y.join(", ")}). This may create duplicate records. You can still import if these are intentional additions.`,value:`${P}|${x}`})})}}),g.forEach((y,j)=>{if(y.length>1){let P=!1;N.forEach((x,C)=>{C.endsWith(`|${j}`)&&x.length>1&&(P=!0)}),P||y.forEach(x=>{a.push({row:x,column:d||"Identifier",message:`âš ï¸ ${d||"Identifier"} "${j}" appears ${y.length} time(s) (Rows: ${y.join(", ")}). Please verify if these are duplicate records or separate additions.`,value:j})})}}),a.length>0&&(console.log("Duplicate detection found:",a.length,"warnings"),console.log("Date field found:",m),console.log("Purchase Code field found:",purchaseCodeFieldName)),a}static validateRow(t,s,a,n,i){const c=[],m=[];return s.forEach(d=>{let o=d.field;i.validationHeaderMapper&&(o=i.validationHeaderMapper(d.field));let f,N=o;if(t[o]!==void 0)f=t[o],N=o;else{const y=o.toLowerCase(),j=Object.keys(t).find(P=>P.toLowerCase()===y);if(j)f=t[j],N=j;else{const P=Object.keys(t).find(x=>x.toLowerCase().includes(y)||y.includes(x.toLowerCase()));P&&(f=t[P],N=P)}}const g=this.applyValidationRule(f,d,t,n);if(g!==!0){const y=typeof g=="string"?g:d.message||`Validation failed for ${d.field}`;d.type==="required"||d.validator&&g===!1?c.push({row:a,column:N,message:y,value:f,severity:"error"}):m.push({row:a,column:N,message:y,value:f})}}),{errors:c,warnings:m}}static applyValidationRule(t,s,a,n){switch(s.type){case"required":return t!=null&&t!=="";case"format":if(s.options?.pattern)return s.options.pattern.test(String(t));if(s.field.toLowerCase().includes("date")){if(!t||t==="")return!0;if(t instanceof Date)return isNaN(t.getTime())?"Invalid date format. Use DD-MM-YYYY format (e.g., 15-01-2024)":!0;if(typeof t=="string"){const m=t.trim();if(/^\d{2}-\d{2}-\d{4}$/.test(m)){const[,o,f,N]=m.match(/^(\d{2})-(\d{2})-(\d{4})$/)||[],g=new Date(parseInt(N),parseInt(f)-1,parseInt(o));return isNaN(g.getTime())?"Invalid date format. Use DD-MM-YYYY format (e.g., 15-01-2024)":!0}if(/^\d{4}-\d{2}-\d{2}$/.test(m)){const o=new Date(m);return isNaN(o.getTime())?"Invalid date format. Use DD-MM-YYYY format (e.g., 15-01-2024)":!0}const d=new Date(m);if(!isNaN(d.getTime()))return!0}return"Invalid date format. Use DD-MM-YYYY format (e.g., 15-01-2024) or YYYY-MM-DD format (e.g., 2024-01-15)"}return!0;case"range":let i;if(typeof t=="number")i=t;else if(typeof t=="string"&&t.trim()!=="")i=parseFloat(t.trim());else return t==null||t===""?!0:"Value must be a number";return isNaN(i)?"Value must be a number":s.options?.min!==void 0&&i<s.options.min?`Value must be at least ${s.options.min}`:s.options?.max!==void 0&&i>s.options.max?`Value must be at most ${s.options.max}`:!0;case"unique":return n.filter(m=>m[s.field]===t).length<=1||`Duplicate value found: ${t}`;case"custom":if(s.validator){if(s.field.toLowerCase().includes("date")&&t instanceof Date)return isNaN(t.getTime())?"Invalid date format":!0;if(typeof t=="number"&&!isNaN(t)){const m=s.validator(t,a,n);return m===!1&&typeof s.validator=="function"?s.validator(String(t),a,n):m}return s.validator(t,a,n)}return!0;default:return!0}}static processRow(t){const s={};return Object.keys(t).forEach(a=>{let n=t[a];if(a.startsWith("_")){s[a]=n;return}if(typeof n=="string"){if(n=n.trim(),n===""&&(n=null),n&&!isNaN(Number(n))&&!isNaN(parseFloat(n))){const i=parseFloat(n);(i.toString()===n||i.toFixed(2)===n)&&(n=i)}n==="true"||n==="True"||n==="TRUE"?n=!0:(n==="false"||n==="False"||n==="FALSE")&&(n=!1)}s[a]=n}),s}static createBatches(t,s){const a=[];for(let n=0;n<t.length;n+=s)a.push(t.slice(n,n+s));return a}static getFileExtension(t){return t.toLowerCase().substring(t.lastIndexOf("."))}}const qt=({config:r,className:t,disabled:s=!1,onImportComplete:a,onImportStart:n,variant:i="outline",size:c="default",acceptedFormats:m=[".csv",".xlsx",".xls","text/csv","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel"]})=>{const d=u.useRef(null),[o,f]=u.useState({isOpen:!1,step:"upload",file:null,parsedData:[],validationResult:null,importProgress:null,importResult:null,error:null}),N=()=>{f({isOpen:!1,step:"upload",file:null,parsedData:[],validationResult:null,importProgress:null,importResult:null,error:null})},g=()=>["ID","Created Date","Updated Date","Status"],y=()=>{const M=g(),z=["Status","Total Amount"];return[...M,...z]},j=()=>{const M=y(),Q=r.requiredColumns.concat(r.optionalColumns||[]).filter(H=>!M.includes(H)),R=Q.map(H=>H.toLowerCase().includes("date")?"15-01-2024":H.toLowerCase().includes("quantity")||H.toLowerCase().includes("qty")||H.toLowerCase().includes("units")||H.toLowerCase().includes("rate")||H.toLowerCase().includes("price")?10:H.toLowerCase().includes("code")||H.toLowerCase().includes("id")?"SAMPLE001":`Sample ${H}`),w=St.book_new(),Y=[Q,R],_=St.aoa_to_sheet(Y);St.book_append_sheet(w,_,"Sample Data"),Ji(w,"sample-import-template.xls"),Wt.success("Sample XLS downloaded",{description:"Fill in your data and import the file"})},P=async M=>{try{f(R=>({...R,file:M,error:null,step:"preview"}));const z=await wa.parseFile(M,R=>{f(w=>({...w,importProgress:R}))}),Q=wa.validateData(z,r,R=>{f(w=>({...w,importProgress:R}))});f(R=>({...R,parsedData:z,validationResult:Q,importProgress:null}))}catch(z){f(Q=>({...Q,error:z instanceof Error?z.message:"Failed to parse file",importProgress:null}))}},x=async()=>{if(!o.validationResult)return;const M=o.validationResult.validData.length>0,z=o.validationResult.errors.filter(R=>R.severity==="error").length===0&&o.validationResult.warnings.length>0;if(!M&&!z){Wt.error("Cannot import",{description:"No valid rows to import. Please fix validation errors first."});return}const Q=M?o.validationResult.validData:o.parsedData;try{f(w=>({...w,step:"processing",error:null})),n?.();const R=await wa.processImport(Q,r,w=>{f(Y=>({...Y,importProgress:w}))});f(w=>({...w,step:"complete",importResult:R,importProgress:null})),R.successfulRows>0&&R.failedRows===0?Wt.success("Import completed successfully",{description:`${R.successfulRows} rows imported successfully`}):R.successfulRows>0&&R.failedRows>0?Wt.warning("Import completed with errors",{description:`${R.successfulRows} successful, ${R.failedRows} failed. Check console for details.`,duration:1e4}):R.failedRows>0?Wt.error("Import failed",{description:`All ${R.failedRows} rows failed. Check console for details.`,duration:1e4}):Wt.error("Import failed",{description:"No rows were imported. Check console for details.",duration:1e4}),console.log("ðŸ“Š Import Complete:",{totalRows:R.totalRows,successfulRows:R.successfulRows,failedRows:R.failedRows,errors:R.errors,warnings:R.warnings}),a?.(R)}catch(R){f(w=>({...w,error:R instanceof Error?R.message:"Import failed",importProgress:null})),Wt.error("Import failed",{description:R instanceof Error?R.message:"An unexpected error occurred"})}},C=M=>{M.preventDefault(),M.stopPropagation()},E=M=>{M.preventDefault(),M.stopPropagation();const Q=Array.from(M.dataTransfer.files)[0];Q&&P(Q)},D=()=>{const M=y();r.requiredColumns.concat(r.optionalColumns||[]).filter(w=>!M.includes(w));const Q=r.requiredColumns.filter(w=>!M.includes(w)),R=(r.optionalColumns||[]).filter(w=>!M.includes(w));return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(Qe,{children:[e.jsx(os,{className:"h-4 w-4"}),e.jsxs(Ye,{className:"space-y-2",children:[e.jsx("div",{className:"font-medium",children:"Import Instructions:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-sm",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Date Format:"})," Use ",e.jsx("code",{className:"bg-gray-100 px-1 rounded",children:"DD-MM-YYYY"})," format (e.g., 15-01-2024) or ",e.jsx("code",{className:"bg-gray-100 px-1 rounded",children:"YYYY-MM-DD"})," format (e.g., 2024-01-15)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Supported Formats:"})," CSV (",e.jsx("code",{className:"bg-gray-100 px-1 rounded",children:".csv"}),"), Excel (",e.jsx("code",{className:"bg-gray-100 px-1 rounded",children:".xlsx"}),", ",e.jsx("code",{className:"bg-gray-100 px-1 rounded",children:".xls"}),")"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Required Fields:"})," Must be filled in for all rows"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Optional Fields:"})," Can be left empty"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Auto-Generated Fields:"})," ",M.join(", ")," will be automatically generated by the system"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"CSV Format:"})," First row must contain column headers matching the sample template"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"File Size:"})," Maximum ",r.maxFileSize||50,"MB"]})]})]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 space-y-2",children:[e.jsx("div",{className:"font-medium text-blue-900",children:"Field Information:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-blue-800 mb-1",children:["Required Fields (",Q.length,"):"]}),e.jsx("div",{className:"text-blue-700",children:Q.length>0?e.jsx("ul",{className:"list-disc list-inside space-y-0.5",children:Q.map((w,Y)=>e.jsx("li",{children:w},Y))}):e.jsx("span",{className:"text-gray-500",children:"None (all excluded)"})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-blue-800 mb-1",children:["Optional Fields (",R.length,"):"]}),e.jsx("div",{className:"text-blue-700",children:R.length>0?e.jsx("ul",{className:"list-disc list-inside space-y-0.5",children:R.map((w,Y)=>e.jsx("li",{children:w},Y))}):e.jsx("span",{className:"text-gray-500",children:"None"})})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(A,{variant:"outline",size:"sm",onClick:w=>{w.stopPropagation(),j()},className:"gap-2",children:[e.jsx(Cs,{className:"h-4 w-4"}),"Download Sample XLS"]})}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-gray-400 transition-colors cursor-pointer",onDragOver:C,onDrop:E,onClick:()=>d.current?.click(),children:[e.jsx(na,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"Drop your file here or click to browse"}),e.jsxs("p",{className:"text-sm text-gray-500 mb-4",children:["Supported formats: ",m.join(", ")]}),e.jsx(A,{variant:"outline",children:"Choose File"})]}),e.jsx("input",{ref:d,type:"file",accept:m.join(","),onChange:w=>{const Y=w.target.files?.[0];Y&&P(Y)},className:"hidden"}),o.importProgress&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:o.importProgress.message}),e.jsxs("span",{children:[o.importProgress.percentage,"%"]})]}),e.jsx(Ds,{value:o.importProgress.percentage})]}),o.error&&e.jsxs(Qe,{variant:"destructive",children:[e.jsx(os,{className:"h-4 w-4"}),e.jsx(Ye,{children:o.error})]})]})},T=()=>{if(!o.validationResult)return null;const{validData:M,invalidData:z,errors:Q,warnings:R}=o.validationResult;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Import Preview"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(We,{variant:"outline",className:"text-green-600",children:[e.jsx(Qa,{className:"h-3 w-3 mr-1"}),M.length," Valid"]}),z.length>0&&e.jsxs(We,{variant:"outline",className:"text-red-600",children:[e.jsx(os,{className:"h-3 w-3 mr-1"}),z.length," Invalid"]}),R.length>0&&e.jsxs(We,{variant:"outline",className:"text-yellow-600",children:[e.jsx(os,{className:"h-3 w-3 mr-1"}),R.length," Warnings"]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[o.file?.name.endsWith(".csv")?e.jsx(Cs,{className:"h-4 w-4"}):e.jsx(Lr,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:o.file?.name})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[o.parsedData.length," rows found"]})]}),Q.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-red-600",children:"Validation Errors"}),e.jsxs("div",{className:"max-h-32 overflow-y-auto space-y-1",children:[Q.slice(0,10).map((w,Y)=>e.jsx(Qe,{variant:"destructive",className:"py-2",children:e.jsxs(Ye,{className:"text-xs",children:["Row ",w.row,', Column "',w.column,'": ',w.message]})},Y)),Q.length>10&&e.jsxs("p",{className:"text-xs text-gray-500",children:["... and ",Q.length-10," more errors"]})]})]}),R.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"font-medium text-yellow-600 flex items-center gap-2",children:[e.jsx(os,{className:"h-4 w-4"}),"Warnings (",R.length,")"]}),e.jsxs("div",{className:"max-h-48 overflow-y-auto space-y-2 border border-yellow-200 rounded-lg p-3 bg-yellow-50",children:[R.slice(0,10).map((w,Y)=>e.jsxs(Qe,{className:"py-2 border-yellow-300 bg-yellow-50",children:[e.jsx(os,{className:"h-4 w-4 text-yellow-600"}),e.jsxs(Ye,{className:"text-sm",children:[e.jsxs("strong",{className:"text-yellow-800",children:["Row ",w.row]})," - ",w.message]})]},Y)),R.length>10&&e.jsxs("p",{className:"text-xs text-yellow-700 font-medium",children:["... and ",R.length-10," more warnings. Please review all warnings before importing."]})]})]}),(M.length>0||o.parsedData.length>0)&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium",children:M.length>0?`Sample Data (First ${Math.min(3,M.length)} rows of ${M.length} valid)`:`Preview Data (First ${Math.min(3,o.parsedData.length)} rows of ${o.parsedData.length} total)`}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-xs border",children:[e.jsx("thead",{children:e.jsx("tr",{className:"bg-gray-50",children:(M.length>0?Object.keys(M[0]||{}):Object.keys(o.parsedData[0]||{})).slice(0,8).filter(w=>!w.startsWith("_")).map(w=>e.jsx("th",{className:"border px-2 py-1 text-left font-medium",children:w},w))})}),e.jsx("tbody",{children:(M.length>0?M:o.parsedData).slice(0,3).map((w,Y)=>e.jsx("tr",{children:Object.keys(w).slice(0,8).filter(_=>!_.startsWith("_")).map(_=>e.jsxs("td",{className:"border px-2 py-1",children:[String(w[_]||"").substring(0,20),String(w[_]||"").length>20&&"..."]},_))},Y))})]})})]}),M.length===0&&R.length>0&&e.jsxs(Qe,{className:"bg-yellow-50 border-yellow-200",children:[e.jsx(os,{className:"h-4 w-4 text-yellow-600"}),e.jsxs(Ye,{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"Note:"})," There are ",R.length,' warning(s) in the import file. Review the warnings above. If the data looks correct despite the warnings, you can still import it by clicking "Import Anyway".']})]}),M.length===0&&R.length===0&&o.parsedData.length>0&&e.jsxs(Qe,{className:"bg-red-50 border-red-200",children:[e.jsx(os,{className:"h-4 w-4 text-red-600"}),e.jsxs(Ye,{className:"text-sm text-red-800",children:[e.jsx("strong",{children:"No valid rows found."})," Please check the validation errors above and fix your data before importing."]})]})]})},F=()=>e.jsxs("div",{className:"space-y-4 text-center",children:[e.jsx(ze,{className:"h-12 w-12 animate-spin mx-auto text-blue-500"}),e.jsx("h3",{className:"text-lg font-medium",children:"Processing Import"}),o.importProgress&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:o.importProgress.message}),e.jsxs("span",{children:[o.importProgress.percentage,"%"]})]}),e.jsx(Ds,{value:o.importProgress.percentage}),o.importProgress.currentBatch&&o.importProgress.totalBatches&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Processing batch ",o.importProgress.currentBatch," of ",o.importProgress.totalBatches]})]})]}),K=()=>{if(!o.importResult)return null;const{successfulRows:M,failedRows:z,totalRows:Q,errors:R}=o.importResult;return e.jsxs("div",{className:"space-y-4 text-center",children:[e.jsx(Qa,{className:"h-12 w-12 mx-auto text-green-500"}),e.jsx("h3",{className:"text-lg font-medium",children:"Import Complete"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{className:"bg-green-50 p-3 rounded-lg",children:[e.jsx("div",{className:"font-medium text-green-600",children:M}),e.jsx("div",{className:"text-green-600",children:"Successful"})]}),e.jsxs("div",{className:"bg-red-50 p-3 rounded-lg",children:[e.jsx("div",{className:"font-medium text-red-600",children:z}),e.jsx("div",{className:"text-red-600",children:"Failed"})]}),e.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg",children:[e.jsx("div",{className:"font-medium text-blue-600",children:Q}),e.jsx("div",{className:"text-blue-600",children:"Total"})]})]}),R.length>0&&e.jsxs("div",{className:"space-y-2 text-left",children:[e.jsx("h4",{className:"font-medium text-red-600",children:"Import Errors"}),e.jsxs("div",{className:"max-h-32 overflow-y-auto space-y-1",children:[R.slice(0,5).map((w,Y)=>e.jsx(Qe,{variant:"destructive",className:"py-2",children:e.jsxs(Ye,{className:"text-xs",children:["Row ",w.row,": ",w.message]})},Y)),R.length>5&&e.jsxs("p",{className:"text-xs text-gray-500",children:["... and ",R.length-5," more errors"]})]})]})]})},O=()=>{switch(o.step){case"upload":return"Import Data";case"preview":return"Review Import Data";case"processing":return"Processing Import";case"complete":return"Import Complete";default:return"Import Data"}},Z=()=>{if(o.step==="preview"&&o.validationResult){const M=o.validationResult.validData.length>0,z=o.validationResult.errors.filter(Q=>Q.severity==="error").length===0&&o.validationResult.warnings.length>0;return M||z}return!1};return e.jsxs(e.Fragment,{children:[e.jsxs(A,{variant:i,size:c,className:t,disabled:s,onClick:()=>f(M=>({...M,isOpen:!0})),children:[e.jsx(na,{className:"h-4 w-4 mr-2"}),"Import"]}),e.jsx(lt,{open:o.isOpen,onOpenChange:M=>{M||N()},children:e.jsxs(rt,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(nt,{children:[e.jsx(ot,{children:O()}),e.jsxs(ct,{children:[o.step==="upload"&&"Select a file to import data",o.step==="preview"&&"Review the data before importing",o.step==="processing"&&"Please wait while we process your data",o.step==="complete"&&"Import has been completed"]})]}),e.jsxs("div",{className:"py-4",children:[o.step==="upload"&&D(),o.step==="preview"&&T(),o.step==="processing"&&F(),o.step==="complete"&&K()]}),e.jsxs(it,{children:[o.step==="upload"&&e.jsx(A,{variant:"outline",onClick:N,children:"Cancel"}),o.step==="preview"&&e.jsxs(e.Fragment,{children:[e.jsx(A,{variant:"outline",onClick:()=>f(M=>({...M,step:"upload"})),children:"Back"}),e.jsx(A,{onClick:x,disabled:!Z(),variant:(o.validationResult?.warnings&&o.validationResult.warnings.length>0,"default"),children:o.validationResult?.warnings&&o.validationResult.warnings.length>0?`Import Anyway (${o.validationResult.validData.length||o.parsedData.length} rows)`:`Import ${o.validationResult?.validData.length||o.parsedData.length||0} Rows`})]}),o.step==="complete"&&e.jsx(A,{onClick:N,children:"Close"})]})]})})]})},Pn=u.forwardRef(({className:r,children:t,...s},a)=>e.jsxs(Mr,{ref:a,className:me("relative overflow-hidden",r),...s,children:[e.jsx(li,{className:"h-full w-full rounded-[inherit]",children:t}),e.jsx(Dn,{}),e.jsx(ci,{})]}));Pn.displayName=Mr.displayName;const Dn=u.forwardRef(({className:r,orientation:t="vertical",...s},a)=>e.jsx(Or,{ref:a,orientation:t,className:me("flex touch-none select-none transition-colors",t==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",t==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",r),...s,children:e.jsx(di,{className:"relative flex-1 rounded-full bg-border"})}));Dn.displayName=Or.displayName;const yt=u.forwardRef(({className:r,...t},s)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:s,className:me("w-full caption-bottom text-sm",r),...t})}));yt.displayName="Table";const vt=u.forwardRef(({className:r,...t},s)=>e.jsx("thead",{ref:s,className:me("[&_tr]:border-b",r),...t}));vt.displayName="TableHeader";const bt=u.forwardRef(({className:r,...t},s)=>e.jsx("tbody",{ref:s,className:me("[&_tr:last-child]:border-0",r),...t}));bt.displayName="TableBody";const Rl=u.forwardRef(({className:r,...t},s)=>e.jsx("tfoot",{ref:s,className:me("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",r),...t}));Rl.displayName="TableFooter";const qe=u.forwardRef(({className:r,...t},s)=>e.jsx("tr",{ref:s,className:me("border-b transition-colors data-[state=selected]:bg-muted hover:bg-muted/50",r),...t}));qe.displayName="TableRow";const te=u.forwardRef(({className:r,...t},s)=>e.jsx("th",{ref:s,className:me("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",r),...t}));te.displayName="TableHead";const J=u.forwardRef(({className:r,...t},s)=>e.jsx("td",{ref:s,className:me("p-4 align-middle [&:has([role=checkbox])]:pr-0",r),...t}));J.displayName="TableCell";const ql=u.forwardRef(({className:r,...t},s)=>e.jsx("caption",{ref:s,className:me("mt-4 text-sm text-muted-foreground",r),...t}));ql.displayName="TableCaption";const us=({data:r,columns:t,onSort:s,currentSort:a,loading:n=!1,emptyMessage:i="No data available",searchable:c=!0,filterable:m=!1,actions:d=[],onRowClick:o,className:f,maxHeight:N="600px",stickyHeader:g=!0,striped:y=!0,bordered:j=!1,compact:P=!1,selectable:x=!1,selectedRows:C=[],onSelectionChange:E,rowKey:D="id"})=>{const[T,F]=u.useState(""),[K,O]=u.useState({}),Z=u.useMemo(()=>a?[...r].sort((I,ee)=>{const V=I[a.column],de=ee[a.column];let U=0;switch(a.dataType){case"number":U=(Number(V)||0)-(Number(de)||0);break;case"date":const h=new Date(V),p=new Date(de);U=h.getTime()-p.getTime();break;case"boolean":U=V===de?0:V?1:-1;break;default:U=String(V||"").localeCompare(String(de||""))}return a.direction==="desc"?-U:U}):r,[r,a]),M=u.useMemo(()=>{let I=Z;if(T&&c){const ee=T.toLowerCase();I=I.filter(V=>t.some(de=>de.searchable===!1?!1:String(V[de.key]||"").toLowerCase().includes(ee)))}return m&&Object.entries(K).forEach(([ee,V])=>{if(V){const de=V.toLowerCase();I=I.filter(U=>String(U[ee]||"").toLowerCase().includes(de))}}),I},[Z,T,K,t,c,m]),z=I=>{if(!I.sortable||!s)return;let ee="asc";a?.column===I.key&&(ee=a.direction==="asc"?"desc":"asc"),s({column:I.key,direction:ee,dataType:I.dataType})},Q=(I,ee)=>{if(!x||!E)return;const V=I[D];let de=[...C];ee?de.some(U=>U[D]===V)||de.push(I):de=de.filter(U=>U[D]!==V),E(de)},R=I=>{!x||!E||E(I?M:[])},w=I=>x?C.some(ee=>ee[D]===I[D]):!1,Y=()=>!x||M.length===0?!1:M.every(I=>w(I)),_=I=>I.sortable?a?.column===I.key?a.direction==="asc"?e.jsx(ui,{className:"h-4 w-4"}):e.jsx(mi,{className:"h-4 w-4"}):e.jsx(pi,{className:"h-4 w-4 opacity-50"}):null,H=(I,ee,V)=>{if(ee.formatter)return ee.formatter(I,V);if(I==null)return e.jsx("span",{className:"text-gray-400",children:"â€”"});switch(ee.dataType){case"boolean":return e.jsx(We,{variant:I?"default":"secondary",children:I?"Yes":"No"});case"date":return ga(I);case"number":return typeof I=="number"?I.toLocaleString():I;default:return String(I)}},re=I=>{switch(I){case"center":return"text-center";case"right":return"text-right";default:return"text-left"}};return e.jsxs("div",{className:`space-y-4 ${f}`,children:[(c||m)&&e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4",children:[c&&e.jsxs("div",{className:"relative flex-1",children:[e.jsx(pt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(G,{placeholder:"Search...",value:T,onChange:I=>F(I.target.value),className:"pl-10 text-sm"})]}),m&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ss,{className:"h-4 w-4 text-gray-400 mt-3"}),t.slice(0,3).map(I=>e.jsx(G,{placeholder:`Filter ${I.label}...`,value:K[I.key]||"",onChange:ee=>O(V=>({...V,[I.key]:ee.target.value})),className:"w-40"},I.key))]})]}),T&&e.jsxs("div",{className:"text-sm text-gray-500",children:["Showing ",M.length," of ",r.length," results"]}),e.jsx("div",{className:`rounded-md border ${j?"border-2":""} overflow-hidden`,children:N&&N!=="none"?e.jsx("div",{className:"overflow-x-auto",children:e.jsx(Pn,{style:{maxHeight:N},className:"relative",children:e.jsxs(yt,{className:"min-w-full",children:[e.jsx(vt,{className:g?"sticky top-0 bg-gray-100 z-10":"bg-gray-100",style:g?{position:"sticky",top:0,zIndex:10}:void 0,children:e.jsxs(qe,{children:[x&&e.jsx(te,{className:"w-12",children:e.jsx("input",{type:"checkbox",checked:Y(),onChange:I=>R(I.target.checked),className:"rounded border-gray-300"})}),t.map(I=>e.jsx(te,{className:`${re(I.align)} ${I.sortable?"cursor-pointer hover:bg-gray-50":""} ${I.headerClassName||""}`,style:{width:I.width},onClick:()=>z(I),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:I.label}),_(I)]})},I.key)),d.length>0&&e.jsx(te,{className:"w-12",children:"Actions"})]})}),e.jsx(bt,{children:n?e.jsx(qe,{children:e.jsx(J,{colSpan:t.length+(x?1:0)+(d.length>0?1:0),className:"text-center py-8",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-900"}),"Loading..."]})})}):M.length===0?e.jsx(qe,{children:e.jsx(J,{colSpan:t.length+(x?1:0)+(d.length>0?1:0),className:"text-center py-8 text-gray-500",children:i})}):M.map((I,ee)=>e.jsxs(qe,{className:`
                      ${y&&ee%2===1?"bg-gray-50":""}
                      ${P?"h-10":""}
                      ${o?"cursor-pointer hover:bg-gray-100":""}
                      ${w(I)?"bg-blue-50 border-blue-200":""}
                    `,onClick:()=>o?.(I),children:[x&&e.jsx(J,{children:e.jsx("input",{type:"checkbox",checked:w(I),onChange:V=>{V.stopPropagation(),Q(I,V.target.checked)},className:"rounded border-gray-300"})}),t.map(V=>e.jsx(J,{className:`${re(V.align)} ${V.cellClassName||""}`,children:H(I[V.key],V,I)},V.key)),d.length>0&&e.jsx(J,{children:e.jsxs(la,{children:[e.jsx(ca,{asChild:!0,children:e.jsx(A,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:V=>V.stopPropagation(),children:e.jsx(Ya,{className:"h-4 w-4"})})}),e.jsx(Hs,{align:"end",children:d.map((V,de)=>e.jsxs(Ps,{onClick:U=>{U.stopPropagation(),V.onClick(I)},disabled:V.disabled?.(I),className:V.variant==="destructive"?"text-red-600":"",children:[V.icon&&e.jsx("span",{className:"mr-2",children:V.icon}),V.label]},de))})]})})]},I[D]||ee))})]})})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(yt,{className:"min-w-full",children:[e.jsx(vt,{className:g?"sticky top-0 bg-gray-100 z-10":"bg-gray-100",style:g?{position:"sticky",top:0,zIndex:10}:void 0,children:e.jsxs(qe,{children:[x&&e.jsx(te,{className:"w-12",children:e.jsx("input",{type:"checkbox",checked:Y(),onChange:I=>R(I.target.checked),className:"rounded border-gray-300"})}),t.map(I=>e.jsx(te,{className:`${re(I.align)} ${I.sortable?"cursor-pointer hover:bg-gray-50":""} ${I.headerClassName||""}`,style:{width:I.width},onClick:()=>z(I),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:I.label}),_(I)]})},I.key)),d.length>0&&e.jsx(te,{className:"w-12",children:"Actions"})]})}),e.jsx(bt,{children:n?e.jsx(qe,{children:e.jsx(J,{colSpan:t.length+(x?1:0)+(d.length>0?1:0),className:"text-center py-8",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-900"}),"Loading..."]})})}):M.length===0?e.jsx(qe,{children:e.jsx(J,{colSpan:t.length+(x?1:0)+(d.length>0?1:0),className:"text-center py-8 text-gray-500",children:i})}):M.map((I,ee)=>e.jsxs(qe,{className:`
                      ${y&&ee%2===1?"bg-gray-50":""}
                      ${P?"h-10":""}
                      ${o?"cursor-pointer hover:bg-gray-100":""}
                      ${w(I)?"bg-blue-50 border-blue-200":""}
                    `,onClick:()=>o?.(I),children:[x&&e.jsx(J,{children:e.jsx("input",{type:"checkbox",checked:w(I),onChange:V=>{V.stopPropagation(),Q(I,V.target.checked)},className:"rounded border-gray-300"})}),t.map(V=>e.jsx(J,{className:`${re(V.align)} ${V.cellClassName||""}`,children:H(I[V.key],V,I)},V.key)),d.length>0&&e.jsx(J,{children:e.jsxs(la,{children:[e.jsx(ca,{asChild:!0,children:e.jsx(A,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:V=>V.stopPropagation(),children:e.jsx(Ya,{className:"h-4 w-4"})})}),e.jsx(Hs,{align:"end",children:d.map((V,de)=>e.jsxs(Ps,{onClick:U=>{U.stopPropagation(),V.onClick(I)},disabled:V.disabled?.(I),className:V.variant==="destructive"?"text-red-600":"",children:[V.icon&&e.jsx("span",{className:"mr-2",children:V.icon}),V.label]},de))})]})})]},I[D]||ee))})]})})}),x&&C.length>0&&e.jsxs("div",{className:"flex items-center justify-between bg-blue-50 p-3 rounded-lg",children:[e.jsxs("span",{className:"text-sm text-blue-700",children:[C.length," row",C.length>1?"s":""," selected"]}),e.jsx(A,{variant:"outline",size:"sm",onClick:()=>E?.([]),children:"Clear Selection"})]})]})},Ts={view:r=>({label:"View",icon:e.jsx(Ur,{className:"h-4 w-4"}),onClick:r}),edit:r=>({label:"Edit",icon:e.jsx(as,{className:"h-4 w-4"}),onClick:r}),delete:r=>({label:"Delete",icon:e.jsx(It,{className:"h-4 w-4"}),onClick:r,variant:"destructive"})},rs=r=>{const[t,s]=tt.useState(r),a=tt.useCallback(c=>{s(c)},[]),n=tt.useCallback(()=>{s(void 0)},[]),i=tt.useCallback(c=>t?[...c].sort((m,d)=>{const o=m[t.column],f=d[t.column];let N=0;switch(t.dataType){case"number":N=(Number(o)||0)-(Number(f)||0);break;case"date":const g=new Date(o),y=new Date(f);N=g.getTime()-y.getTime();break;case"boolean":N=o===f?0:o?1:-1;break;default:N=String(o||"").localeCompare(String(f||""))}return t.direction==="desc"?-N:N}):c,[t]);return{currentSort:t,handleSort:a,clearSort:n,getSortedData:i}},le=vi,ce=bi,ie=u.forwardRef(({className:r,children:t,...s},a)=>e.jsxs(Kr,{ref:a,className:me("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",r),...s,children:[t,e.jsx(hi,{asChild:!0,children:e.jsx(Ia,{className:"h-4 w-4 opacity-50"})})]}));ie.displayName=Kr.displayName;const Tn=u.forwardRef(({className:r,...t},s)=>e.jsx(Vr,{ref:s,className:me("flex cursor-default items-center justify-center py-1",r),...t,children:e.jsx(xi,{className:"h-4 w-4"})}));Tn.displayName=Vr.displayName;const En=u.forwardRef(({className:r,...t},s)=>e.jsx(Br,{ref:s,className:me("flex cursor-default items-center justify-center py-1",r),...t,children:e.jsx(Ia,{className:"h-4 w-4"})}));En.displayName=Br.displayName;const oe=u.forwardRef(({className:r,children:t,position:s="popper",...a},n)=>e.jsx(gi,{children:e.jsxs(Hr,{ref:n,className:me("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",r),position:s,...a,children:[e.jsx(Tn,{}),e.jsx(fi,{className:me("p-1",s==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),e.jsx(En,{})]})}));oe.displayName=Hr.displayName;const Al=u.forwardRef(({className:r,...t},s)=>e.jsx(zr,{ref:s,className:me("py-1.5 pl-8 pr-2 text-sm font-semibold",r),...t}));Al.displayName=zr.displayName;const S=u.forwardRef(({className:r,children:t,...s},a)=>e.jsxs(Qr,{ref:a,className:me("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",r),...s,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(ji,{children:e.jsx(Dr,{className:"h-4 w-4"})})}),e.jsx(yi,{children:t})]}));S.displayName=Qr.displayName;const Fl=u.forwardRef(({className:r,...t},s)=>e.jsx(Yr,{ref:s,className:me("-mx-1 my-1 h-px bg-muted",r),...t}));Fl.displayName=Yr.displayName;const $l=()=>{const[r,t]=u.useState(!1),[s,a]=u.useState(!1),[n,i]=u.useState(null),[c,m]=u.useState(null),[d,o]=u.useState(""),[f,N]=u.useState([]),[g,y]=u.useState("all"),[j,P]=u.useState("all"),[x,C]=u.useState({from:"",to:""}),[E,D]=u.useState(1),[T,F]=u.useState(50),K=mt(),{toast:O}=Ie(),{user:Z,loading:M}=jt(),{config:z}=Tt("purchases"),{validationRules:Q,canImport:R}=Et("purchases"),{currentSort:w,handleSort:Y,getSortedData:_}=rs(),[H,re]=u.useState({purchase_code:"",date:new Date().toISOString().split("T")[0],vendor_id:"",stock_id:"",quantity:"",rate:"",total_amount:""});u.useEffect(()=>{const{quantity:q,rate:ve}=H;if(q&&ve){const _e=parseFloat(q)*parseFloat(ve);re(we=>({...we,total_amount:String(_e)}))}else re(_e=>({..._e,total_amount:""}))},[H.quantity,H.rate]);const{data:I,isLoading:ee,error:V}=Ne({queryKey:["purchases"],queryFn:()=>Gt.getAll(),enabled:!!Z}),{data:de,isLoading:U,error:h}=Ne({queryKey:["vendors"],queryFn:()=>Ms.getAll(),enabled:!!Z}),{data:p,isLoading:L,error:k}=Ne({queryKey:["stocks"],queryFn:()=>Bt.getAll(),enabled:!!Z}),W=tt.useMemo(()=>de?new Map(de.map(q=>[q.$id,q.vendor_name])):new Map,[de]),xe=tt.useMemo(()=>p?new Map(p.map(q=>[q.$id,q.stock_name])):new Map,[p]),he=tt.useMemo(()=>I?I.map(q=>({...q,id:q.$id,vendor_name:W.get(q.vendor_id)||"Unknown Vendor",stock_name:xe.get(q.stock_id)||"Unknown Stock"})):[],[I,W,xe]),be=Re({mutationFn:q=>c?Gt.update(c.id,q):Gt.create(q),onSuccess:()=>{K.invalidateQueries({queryKey:["purchases"]}),t(!1),m(null),O({title:c?"Purchase Updated":"Purchase Created",description:`The purchase has been successfully ${c?"updated":"saved"}.`})},onError:q=>{O({title:"Error",description:q.message||`Failed to ${c?"update":"create"} purchase.`,variant:"destructive"})}}),Fe=Re({mutationFn:q=>Gt.delete(q),onSuccess:()=>{K.invalidateQueries({queryKey:["purchases"]}),O({title:"Purchase Deleted",description:"The purchase has been successfully deleted."})},onError:q=>{O({title:"Error",description:q.message||"Failed to delete purchase.",variant:"destructive"})}}),Me=q=>{i(q),a(!0)},He=()=>{n&&(Fe.mutate(n),i(null),a(!1))},ht=q=>{m(q),re({...q,date:new Date(q.date).toISOString().split("T")[0],quantity:String(q.quantity),rate:String(q.rate),total_amount:String(q.total_amount),vendor_id:q.vendor_id,stock_id:q.stock_id}),t(!0)},Lt=q=>{if(q.preventDefault(),!H.purchase_code||!H.date||!H.vendor_id||!H.stock_id||!H.quantity||!H.rate){O({title:"Missing Fields",description:"Please fill out all required fields.",variant:"destructive"});return}const ve={purchase_code:H.purchase_code,date:H.date,vendor_id:H.vendor_id,stock_id:H.stock_id,quantity:parseFloat(H.quantity),rate:parseFloat(H.rate),total_amount:parseFloat(H.total_amount)};be.mutate(ve)},xt=he.filter(q=>{const ve=q.purchase_code.toLowerCase().includes(d.toLowerCase())||q.vendor_name.toLowerCase().includes(d.toLowerCase())||q.stock_name.toLowerCase().includes(d.toLowerCase()),_e=g==="all"||q.vendor_id===g,we=j==="all"||q.stock_id===j,ft=new Date(q.date),Ee=(!x.from||ft>=new Date(x.from))&&(!x.to||ft<=new Date(x.to));return ve&&_e&&we&&Ee}),gt=tt.useMemo(()=>{const q=new Map;return he.forEach(ve=>{q.has(ve.vendor_id)||q.set(ve.vendor_id,{id:ve.vendor_id,name:ve.vendor_name})}),Array.from(q.values()).sort((ve,_e)=>ve.name.localeCompare(_e.name))},[he]),Nt=tt.useMemo(()=>{const q=new Map;return he.forEach(ve=>{q.has(ve.stock_id)||q.set(ve.stock_id,{id:ve.stock_id,name:ve.stock_name})}),Array.from(q.values()).sort((ve,_e)=>ve.name.localeCompare(_e.name))},[he]),wt=xt.length,l=Math.ceil(wt/T),se=(E-1)*T,b=se+T,X=xt.slice(se,b);u.useEffect(()=>{D(1)},[d,g,j,x,T]);const ye=Re({mutationFn:async q=>{await Promise.all(q.map(ve=>Gt.delete(ve)))},onSuccess:()=>{K.invalidateQueries({queryKey:["purchases"]}),N([]),O({title:"Success",description:"Selected purchases deleted successfully."})},onError:()=>{O({title:"Error",description:"Failed to delete selected purchases.",variant:"destructive"})}}),Se=()=>{if(f.length===0){O({title:"No Selection",description:"Please select purchases to delete.",variant:"destructive"});return}confirm(`Are you sure you want to delete ${f.length} selected purchase(s)?`)&&ye.mutate(f.map(q=>q.id))},Oe=()=>{if(f.length===0){O({title:"No Selection",description:"Please select purchases to export.",variant:"destructive"});return}O({title:"Export",description:`Exporting ${f.length} selected purchase(s)...`})},Ue=M||ee||U||L,Ke=V||h||k;return Ue?e.jsx("div",{children:"Loading..."}):Ke?(console.error("Data loading error:",{purchasesError:V,vendorsError:h,stocksError:k}),e.jsx("div",{children:"Error loading data."})):e.jsx("div",{className:"p-4",children:e.jsxs(ae,{children:[e.jsx(fe,{children:e.jsxs(je,{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Purchases"}),e.jsxs(A,{onClick:()=>t(!0),children:[e.jsx(Ct,{className:"mr-2 h-4 w-4"})," Add New Purchase"]})]})}),e.jsxs(ne,{children:[e.jsx(ae,{className:"mb-6",children:e.jsx(ne,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(pt,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(G,{placeholder:"Search purchases...",className:"pl-10",value:d,onChange:q=>o(q.target.value)})]}),R&&z&&e.jsx(qt,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:z.exportColumns.filter(q=>q.required).map(q=>q.exportHeader),optionalColumns:z.exportColumns.filter(q=>!q.required).map(q=>q.exportHeader),validationRules:Q,maxFileSize:50,existingData:I||[],validationHeaderMapper:q=>{const ve=z.exportColumns.find(_e=>_e.dataKey===q);return ve?ve.exportHeader:q},columnMapper:q=>{const ve=z.exportColumns.find(_e=>_e.exportHeader===q);return ve?ve.dataKey==="vendorName"?"vendor_name":ve.dataKey==="stockName"?"stock_name":{purchaseCode:"purchase_code",date:"date",quantity:"quantity",rate:"rate",totalAmount:"total_amount"}[ve.dataKey]||ve.dataKey:q},dataProcessor:async q=>{let ve=q["Vendor Name"]||q.vendor_name||q.vendor_name||q.vendor_id;if(!ve||ve==="")throw new Error("Vendor Name is required");const _e=String(ve).trim(),we=de?.find(ue=>ue.vendor_name.toLowerCase()===_e.toLowerCase());if(!we){const ue=de?.map(ge=>ge.vendor_name).slice(0,5).join(", ")||"None";throw new Error(`Vendor "${_e}" not found. Available vendors: ${ue}${de&&de.length>5?"...":""}. Please check the vendor name matches exactly.`)}const ft=we.$id;let Ee=q["Stock Name"]||q.stock_name||q.stock_name||q.stock_id;if(!Ee||Ee==="")throw new Error("Stock Name is required");const Ce=String(Ee).trim(),Ve=p?.find(ue=>ue.stock_name.toLowerCase()===Ce.toLowerCase());if(!Ve){const ue=p?.map(ge=>ge.stock_name).slice(0,5).join(", ")||"None";throw new Error(`Stock "${Ce}" not found. Available stocks: ${ue}${p&&p.length>5?"...":""}. Please check the stock name matches exactly.`)}const Be=Ve.$id;let Le=q.date;if(Le&&typeof Le=="string"){const ue=Le.match(/^(\d{2})-(\d{2})-(\d{4})$/);if(ue){const[,ge,Pe,Te]=ue,Ae=new Date(parseInt(Te),parseInt(Pe)-1,parseInt(ge));if(isNaN(Ae.getTime()))throw new Error(`Invalid date format: ${Le}. Use DD-MM-YYYY format (e.g., 15-01-2024).`);Le=Ae.toISOString().split("T")[0]}else{const ge=new Date(Le);if(isNaN(ge.getTime()))throw new Error(`Invalid date format: ${Le}. Use DD-MM-YYYY format (e.g., 15-01-2024).`);Le=ge.toISOString().split("T")[0]}}else if(Le instanceof Date){if(isNaN(Le.getTime()))throw new Error("Invalid date. Use DD-MM-YYYY format (e.g., 15-01-2024).");Le=Le.toISOString().split("T")[0]}let v=q.total_amount;!v&&q.quantity&&q.rate&&(v=parseFloat(q.quantity)*parseFloat(q.rate));const B={purchase_code:q.purchase_code||q.Purchase_Code,date:Le||new Date().toISOString().split("T")[0],vendor_id:ft,stock_id:Be,quantity:parseFloat(q.quantity||0),rate:parseFloat(q.rate||0),total_amount:parseFloat(v||0)};return await Gt.create(B)},onImportComplete:async q=>{await K.invalidateQueries({queryKey:["purchases"],refetchType:"active"}),await K.refetchQueries({queryKey:["purchases"]}),q.successfulRows>0&&O({title:"Import Successful",description:`${q.successfulRows} purchases imported successfully.`}),q.failedRows>0&&O({title:"Import Completed with Errors",description:`${q.successfulRows} successful, ${q.failedRows} failed.`,variant:"destructive"})}},variant:"outline"}),z&&e.jsx(Rt,{data:xt.map(q=>{const ve={};return z.exportColumns.forEach(_e=>{let we;switch(_e.dataKey){case"purchaseCode":we=q.purchase_code;break;case"date":we=q.date;break;case"vendorName":we=q.vendor_name;break;case"stockName":we=q.stock_name;break;case"quantity":we=q.quantity;break;case"rate":we=q.rate;break;case"totalAmount":we=q.total_amount;break;case"status":we="Completed";break;default:we=q[_e.dataKey]}ve[_e.exportHeader]=_e.formatter?_e.formatter(we):we}),ve}),headers:z.exportColumns.map(q=>q.exportHeader),filename:"purchases",variant:"outline"})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs(le,{value:g,onValueChange:y,children:[e.jsx(ie,{className:"w-[180px]",children:e.jsx(ce,{placeholder:"Filter by Vendor"})}),e.jsxs(oe,{children:[e.jsx(S,{value:"all",children:"All Vendors"}),gt.map(q=>e.jsx(S,{value:q.id,children:q.name},q.id))]})]}),e.jsxs(le,{value:j,onValueChange:P,children:[e.jsx(ie,{className:"w-[180px]",children:e.jsx(ce,{placeholder:"Filter by Stock"})}),e.jsxs(oe,{children:[e.jsx(S,{value:"all",children:"All Stocks"}),Nt.map(q=>e.jsx(S,{value:q.id,children:q.name},q.id))]})]}),e.jsx(G,{type:"date",placeholder:"From Date",className:"w-[150px]",value:x.from,onChange:q=>C(ve=>({...ve,from:q.target.value}))}),e.jsx(G,{type:"date",placeholder:"To Date",className:"w-[150px]",value:x.to,onChange:q=>C(ve=>({...ve,to:q.target.value}))})]})]})})}),e.jsx(lt,{open:r,onOpenChange:q=>{t(q),q||(m(null),re({purchase_code:"",date:new Date().toISOString().split("T")[0],vendor_id:"",stock_id:"",quantity:"",rate:"",total_amount:""}))},children:e.jsxs(rt,{className:"sm:max-w-[600px]",children:[e.jsxs(nt,{children:[e.jsx(ot,{children:c?"Edit Purchase":"Add New Purchase"}),e.jsx(ct,{children:c?"Update the purchase information below.":"Fill in the details to create a new purchase record."})]}),e.jsxs("form",{onSubmit:Lt,children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 py-4",children:[e.jsxs("div",{children:[e.jsx($,{htmlFor:"purchase_code",children:"Purchase Code"}),e.jsx(G,{id:"purchase_code",value:H.purchase_code,onChange:q=>re({...H,purchase_code:q.target.value})})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"date",children:"Date"}),e.jsx(G,{id:"date",type:"date",value:H.date,onChange:q=>re({...H,date:q.target.value})})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"vendor_id",children:"Vendor"}),e.jsxs(le,{value:H.vendor_id,onValueChange:q=>re({...H,vendor_id:q}),children:[e.jsx(ie,{id:"vendor_id",children:e.jsx(ce,{placeholder:"Select a vendor"})}),e.jsx(oe,{children:de?.map(q=>e.jsx(S,{value:q.$id,children:q.vendor_name},q.$id))})]})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"stock_id",children:"Stock"}),e.jsxs(le,{value:H.stock_id,onValueChange:q=>re({...H,stock_id:q}),children:[e.jsx(ie,{id:"stock_id",children:e.jsx(ce,{placeholder:"Select a stock item"})}),e.jsx(oe,{children:p?.map(q=>e.jsx(S,{value:q.$id,children:q.stock_name},q.$id))})]})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"quantity",children:"Quantity"}),e.jsx(G,{id:"quantity",type:"number",value:H.quantity,onChange:q=>re({...H,quantity:q.target.value})})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"rate",children:"Rate"}),e.jsx(G,{id:"rate",type:"number",value:H.rate,onChange:q=>re({...H,rate:q.target.value})})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"total_amount",children:"Total Amount"}),e.jsx(G,{id:"total_amount",type:"number",value:H.total_amount,readOnly:!0,className:"bg-gray-100"})]})]}),e.jsx(it,{children:e.jsx(A,{type:"submit",disabled:be.isPending,children:be.isPending?"Saving...":c?"Update Purchase":"Create Purchase"})})]})]})}),e.jsx(lt,{open:s,onOpenChange:a,children:e.jsxs(rt,{children:[e.jsx(nt,{children:e.jsx(ot,{children:"Are you sure?"})}),e.jsx("div",{className:"py-4",children:e.jsx("p",{children:"This action cannot be undone. This will permanently delete the purchase."})}),e.jsxs(it,{children:[e.jsx(A,{variant:"outline",onClick:()=>a(!1),children:"Cancel"}),e.jsx(A,{variant:"destructive",onClick:He,children:"Delete"})]})]})}),e.jsx(ae,{children:e.jsxs(ne,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",se+1," to ",Math.min(b,wt)," of ",wt," records"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Records per page:"}),e.jsxs(le,{value:T.toString(),onValueChange:q=>F(Number(q)),children:[e.jsx(ie,{className:"w-[100px]",children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"50",children:"50"}),e.jsx(S,{value:"100",children:"100"}),e.jsx(S,{value:"500",children:"500"})]})]})]})]}),f.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 p-3 bg-muted rounded-md",children:[e.jsxs("span",{className:"text-sm font-medium",children:[f.length," selected"]}),e.jsx(A,{variant:"destructive",size:"sm",onClick:Se,disabled:ye.isPending,children:"Delete Selected"}),e.jsx(A,{variant:"outline",size:"sm",onClick:Oe,children:"Export Selected"})]}),e.jsx("div",{className:"border rounded-md",children:e.jsx("div",{className:"overflow-auto",style:{maxHeight:"600px"},children:e.jsx(us,{data:_(X.map(q=>((!q.date||q.date==="Invalid Date")&&console.warn("Invalid purchase date found:",{id:q.$id,date:q.date,purchase_code:q.purchase_code}),{...q,formattedDate:ga(q.date),status:"Completed"}))),columns:[{key:"purchase_code",label:"Purchase Code",sortable:!0,dataType:"string"},{key:"formattedDate",label:"Date",sortable:!0,dataType:"date"},{key:"vendor_name",label:"Vendor Name",sortable:!0,dataType:"string"},{key:"stock_name",label:"Stock Name",sortable:!0,dataType:"string"},{key:"quantity",label:"Quantity",sortable:!0,dataType:"number",align:"right",headerClassName:"bg-purple-50",cellClassName:"bg-purple-50 font-medium"},{key:"rate",label:"Rate",sortable:!0,dataType:"number",align:"right"},{key:"total_amount",label:"Total Amount",sortable:!0,dataType:"number",align:"right"},{key:"status",label:"Status",sortable:!0,dataType:"string",formatter:q=>e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${q==="Completed"?"bg-green-100 text-green-800":q==="In Progress"?"bg-yellow-100 text-yellow-800":q==="Pending"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:q})}],onSort:Y,currentSort:w,loading:Ue,maxHeight:"none",stickyHeader:!0,bordered:!1,searchable:!1,rowKey:"$id",selectable:!0,selectedRows:f,onSelectionChange:N,actions:[{label:"Edit",onClick:ht,variant:"default"},{label:"Delete",onClick:q=>Me(q.id),variant:"destructive"}],emptyMessage:"No purchases found"})})}),l>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx(A,{variant:"outline",size:"sm",onClick:()=>D(q=>Math.max(1,q-1)),disabled:E===1,children:"Previous"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",E," of ",l]})}),e.jsx(A,{variant:"outline",size:"sm",onClick:()=>D(q=>Math.min(l,q+1)),disabled:E===l,children:"Next"})]})]})})]})]})})},Rn=()=>{const{data:r=[],...t}=Ne({queryKey:["preProductionTasks"],queryFn:async()=>cs.getPreProductionTasksWithRelations()});return{tasks:r,...t}},qn=()=>{const{data:r=[],isLoading:t,error:s,refetch:a}=Ne({queryKey:["production_tasks"],queryFn:async()=>await zt.getProductionTasksWithRelations(),staleTime:12e4,gcTime:6e5,refetchOnWindowFocus:!1,retry:3,retryDelay:n=>Math.min(1e3*2**n,3e4)});return{tasks:r,isLoading:t,error:s,refetch:a}},Il=()=>{const r=mt(),t=Re({mutationFn:async({taskData:n,stockItems:i})=>{const c=await zt.create(n);return i.length>0&&await Promise.all(i.map(m=>Us.create({production_task_id:c.$id,stock_id:m.stock_id,quantity:m.quantity,action:m.action}))),c},onSuccess:()=>{queueMicrotask(()=>{r.invalidateQueries({queryKey:["production_tasks"]})})},onError:n=>{console.error("Error creating production task:",n)}}),s=Re({mutationFn:async({id:n,taskData:i,stockItems:c})=>{const m=await zt.update(n,i);return c&&(await Us.deleteByProductionTaskId(n),c.length>0&&await Promise.all(c.map(d=>Us.create({production_task_id:n,stock_id:d.stock_id,quantity:d.quantity,action:d.action})))),m},onSuccess:()=>{queueMicrotask(()=>{r.invalidateQueries({queryKey:["production_tasks"]})})},onError:n=>{console.error("Error updating production task:",n)}}),a=Re({mutationFn:async n=>(await Us.deleteByProductionTaskId(n),await zt.delete(n)),onSuccess:()=>{queueMicrotask(()=>{r.invalidateQueries({queryKey:["production_tasks"]})})},onError:n=>{console.error("Error deleting production task:",n)}});return{createTask:t,updateTask:s,deleteTask:a}},An=()=>{const{data:r=[],isLoading:t,error:s,refetch:a}=Ne({queryKey:["post_production_tasks"],queryFn:async()=>await Zt.getPostProductionTasksWithRelations(),staleTime:12e4,gcTime:6e5,refetchOnWindowFocus:!1,retry:3,retryDelay:n=>Math.min(1e3*2**n,3e4)});return{tasks:r,isLoading:t,error:s,refetch:a}},Ll=()=>{const r=mt(),t=Re({mutationFn:n=>Zt.create(n),onSuccess:()=>{queueMicrotask(()=>{r.invalidateQueries({queryKey:["post_production_tasks"]})})},onError:n=>{console.error("Error creating post-production task:",n)}}),s=Re({mutationFn:({id:n,data:i})=>Zt.update(n,i),onSuccess:()=>{queueMicrotask(()=>{r.invalidateQueries({queryKey:["post_production_tasks"]})})},onError:n=>{console.error("Error updating post-production task:",n)}}),a=Re({mutationFn:n=>Zt.delete(n),onSuccess:()=>{queueMicrotask(()=>{r.invalidateQueries({queryKey:["post_production_tasks"]})})},onError:n=>{console.error("Error deleting post-production task:",n)}});return{createTask:t,updateTask:s,deleteTask:a}},Ml=()=>{const{tasks:r}=Rn(),{tasks:t}=qn(),{tasks:s}=An(),a=m=>({total:m.length,pending:m.filter(d=>d.status==="pending").length,inProgress:m.filter(d=>d.status==="in_progress").length,completed:m.filter(d=>d.status==="completed").length}),n=a(r),i=a(t),c=a(s);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Tasks Module"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage production tasks across all stages"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs(ae,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(fe,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fa,{className:"h-5 w-5 text-primary"}),e.jsx(je,{children:"Pre-Production Tasks"})]}),e.jsx(De,{children:"Manage pre-production planning and preparation tasks"})]}),e.jsxs(ne,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Track material requisitions, planning approvals, and preparation progress"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-orange-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-orange-700",children:n.pending}),e.jsx("div",{className:"text-orange-600",children:"Pending"})]}),e.jsxs("div",{className:"bg-blue-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-blue-700",children:n.inProgress}),e.jsx("div",{className:"text-blue-600",children:"In Progress"})]}),e.jsxs("div",{className:"bg-green-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-green-700",children:n.completed}),e.jsx("div",{className:"text-green-600",children:"Completed"})]}),e.jsxs("div",{className:"bg-gray-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-gray-700",children:n.total}),e.jsx("div",{className:"text-gray-600",children:"Total"})]})]})]}),e.jsx(Ut,{className:"border-t pt-4",children:e.jsx(A,{asChild:!0,className:"w-full",children:e.jsxs(At,{to:"/tasks/pre-production",children:["View Pre-Production Tasks",e.jsx(Ot,{className:"ml-2 h-4 w-4"})]})})})]}),e.jsxs(ae,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(fe,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Wr,{className:"h-5 w-5 text-primary"}),e.jsx(je,{children:"Production Tasks"})]}),e.jsx(De,{children:"Track manufacturing and production progress"})]}),e.jsxs(ne,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Monitor work-in-progress, production timelines, and quality checks"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-orange-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-orange-700",children:i.pending}),e.jsx("div",{className:"text-orange-600",children:"Pending"})]}),e.jsxs("div",{className:"bg-blue-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-blue-700",children:i.inProgress}),e.jsx("div",{className:"text-blue-600",children:"In Progress"})]}),e.jsxs("div",{className:"bg-green-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-green-700",children:i.completed}),e.jsx("div",{className:"text-green-600",children:"Completed"})]}),e.jsxs("div",{className:"bg-gray-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-gray-700",children:i.total}),e.jsx("div",{className:"text-gray-600",children:"Total"})]})]})]}),e.jsx(Ut,{className:"border-t pt-4",children:e.jsx(A,{asChild:!0,className:"w-full",children:e.jsxs(At,{to:"/tasks/production",children:["View Production Tasks",e.jsx(Ot,{className:"ml-2 h-4 w-4"})]})})})]}),e.jsxs(ae,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(fe,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Rs,{className:"h-5 w-5 text-primary"}),e.jsx(je,{children:"Post-Production Tasks"})]}),e.jsx(De,{children:"Track finishing, packaging, and shipping"})]}),e.jsxs(ne,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Monitor finishing processes, packaging, and logistics"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-orange-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-orange-700",children:c.pending}),e.jsx("div",{className:"text-orange-600",children:"Pending"})]}),e.jsxs("div",{className:"bg-blue-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-blue-700",children:c.inProgress}),e.jsx("div",{className:"text-blue-600",children:"In Progress"})]}),e.jsxs("div",{className:"bg-green-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-green-700",children:c.completed}),e.jsx("div",{className:"text-green-600",children:"Completed"})]}),e.jsxs("div",{className:"bg-gray-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-gray-700",children:c.total}),e.jsx("div",{className:"text-gray-600",children:"Total"})]})]})]}),e.jsx(Ut,{className:"border-t pt-4",children:e.jsx(A,{asChild:!0,className:"w-full",children:e.jsxs(At,{to:"/tasks/post-production",children:["View Post-Production Tasks",e.jsx(Ot,{className:"ml-2 h-4 w-4"})]})})})]})]}),e.jsxs(ae,{children:[e.jsx(fe,{children:e.jsx(je,{className:"flex items-center gap-2",children:"Task Management System"})}),e.jsx(ne,{children:e.jsx("div",{className:"text-center py-6 text-muted-foreground",children:e.jsx("p",{className:"text-sm",children:"Comprehensive task management across all production stages with real-time tracking and reporting"})})})]})]})},Ol=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Status Module"}),e.jsx("p",{className:"text-muted-foreground",children:"Track real-time status across all production stages"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs(ae,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(fe,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ni,{className:"h-5 w-5 text-primary"}),e.jsx(je,{children:"Stock Status"})]}),e.jsx(De,{children:"Track raw material and component inventory"})]}),e.jsx(ne,{children:e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Monitor stock levels, movements, and availability of raw materials and components"})}),e.jsx(Ut,{className:"border-t pt-4",children:e.jsx(A,{asChild:!0,className:"w-full",children:e.jsxs(At,{to:"/status/stock-status",children:["View Stock Status",e.jsx(Ot,{className:"ml-2 h-4 w-4"})]})})})]}),e.jsxs(ae,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(fe,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fa,{className:"h-5 w-5 text-primary"}),e.jsx(je,{children:"Pre-production Status"})]}),e.jsx(De,{children:"Track pre-production planning and preparation"})]}),e.jsx(ne,{children:e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Monitor material requisitions, planning approvals, and preparation progress"})}),e.jsx(Ut,{className:"border-t pt-4",children:e.jsx(A,{asChild:!0,className:"w-full",children:e.jsxs(At,{to:"/status/pre-production-status",children:["View Pre-production Status",e.jsx(Ot,{className:"ml-2 h-4 w-4"})]})})})]}),e.jsxs(ae,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(fe,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Wr,{className:"h-5 w-5 text-primary"}),e.jsx(je,{children:"Production Status"})]}),e.jsx(De,{children:"Track manufacturing and production progress"})]}),e.jsx(ne,{children:e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Monitor work-in-progress, production timelines, and quality checks"})}),e.jsx(Ut,{className:"border-t pt-4",children:e.jsx(A,{asChild:!0,className:"w-full",children:e.jsxs(At,{to:"/status/production-status",children:["View Production Status",e.jsx(Ot,{className:"ml-2 h-4 w-4"})]})})})]}),e.jsxs(ae,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(fe,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Rs,{className:"h-5 w-5 text-primary"}),e.jsx(je,{children:"Post-Production Status"})]}),e.jsx(De,{children:"Track finishing, packaging, and shipping"})]}),e.jsx(ne,{children:e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Monitor finishing processes, packaging, and logistics"})}),e.jsx(Ut,{className:"border-t pt-4",children:e.jsx(A,{asChild:!0,className:"w-full",children:e.jsxs(At,{to:"/status/post-production-status",children:["View Post-Production Status",e.jsx(Ot,{className:"ml-2 h-4 w-4"})]})})})]}),e.jsxs(ae,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(fe,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(zs,{className:"h-5 w-5 text-primary"}),e.jsx(je,{children:"Inventory Status"})]}),e.jsx(De,{children:"Track overall inventory movements and valuation"})]}),e.jsx(ne,{children:e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Monitor opening/closing balances, receiving, issue, and inventory value"})}),e.jsx(Ut,{className:"border-t pt-4",children:e.jsx(A,{asChild:!0,className:"w-full",children:e.jsxs(At,{to:"/status/inventory-status",children:["View Inventory Status",e.jsx(Ot,{className:"ml-2 h-4 w-4"})]})})})]})]}),e.jsxs(ae,{children:[e.jsx(fe,{children:e.jsx(je,{className:"flex items-center gap-2",children:"Database Connection"})}),e.jsx(ne,{children:e.jsx("div",{className:"text-center py-6 text-muted-foreground",children:e.jsx("p",{className:"text-sm",children:"For real-time data tracking and management, ensure your application is connected to Appwrite database"})})})]})]}),Ra={products:["products"],stocks:["stocks"],vendors:["vendors"],staff:["staff"],processes:["processes"],rawProducts:["raw-products"],salesChannels:["sales-channels"],salesUnits:r=>["sales-units",r?.from,r?.to].filter(Boolean),salesRecords:r=>["sales-records",r?.from,r?.to].filter(Boolean),stockStatus:["stock-status"],preProductionStatus:["pre-production-status"],productionStatus:["production-status"],postProductionStatus:["post-production-status"],inventoryStatus:r=>["inventory-status",r?.from,r?.to].filter(Boolean),preProductionTasks:["pre-production-tasks"],productionTasks:["production-tasks"],postProductionTasks:["post-production-tasks"],purchases:["purchases"]},Ul=()=>{const{data:r=[]}=Ne({queryKey:Ra.salesUnits(),queryFn:()=>Jt.getAll(),staleTime:3e5}),{data:t=[]}=Ne({queryKey:Ra.salesRecords(),queryFn:()=>ls.getAll(),staleTime:300*1e3}),s={total:r.length,totalUnits:r.reduce((n,i)=>n+(i.units||0),0),recentEntries:r.filter(n=>{const i=new Date(n.date),c=new Date;return c.setDate(c.getDate()-7),i>=c}).length,uniqueProducts:new Set(r.map(n=>n.product_id)).size},a={total:t.length,totalRevenue:t.reduce((n,i)=>n+(i.sold_units||0)*(i.unit_price||0),0),recentSales:t.filter(n=>{const i=new Date(n.date),c=new Date;return c.setDate(c.getDate()-7),i>=c}).length,totalUnitsSold:t.reduce((n,i)=>n+(i.sold_units||0),0)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Sales Module"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage sales units, records, and finished goods inventory"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(ae,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(fe,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Rs,{className:"h-5 w-5 text-primary"}),e.jsx(je,{children:"Sales Units"})]}),e.jsx(De,{children:"Track batch coding utilization and inventory movement"})]}),e.jsxs(ne,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:'Sales units added by user using "Add Form" from "Batch Coding" process in Post Production tasks'}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-purple-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-purple-700",children:s.total}),e.jsx("div",{className:"text-purple-600",children:"Total Entries"})]}),e.jsxs("div",{className:"bg-blue-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-blue-700",children:s.totalUnits.toLocaleString()}),e.jsx("div",{className:"text-blue-600",children:"Total Units"})]}),e.jsxs("div",{className:"bg-green-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-green-700",children:s.recentEntries}),e.jsx("div",{className:"text-green-600",children:"This Week"})]}),e.jsxs("div",{className:"bg-orange-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-orange-700",children:s.uniqueProducts}),e.jsx("div",{className:"text-orange-600",children:"Products"})]})]})]}),e.jsx(Ut,{className:"border-t pt-4",children:e.jsx(A,{asChild:!0,className:"w-full",children:e.jsxs(At,{to:"/sales/units",children:["View Sales Units",e.jsx(Ot,{className:"ml-2 h-4 w-4"})]})})})]}),e.jsxs(ae,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsxs(fe,{className:"bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(br,{className:"h-5 w-5 text-primary"}),e.jsx(je,{children:"Sales Records"})]}),e.jsx(De,{children:"Track sold units with pricing and revenue"})]}),e.jsxs(ne,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:'Total sum of all the "sold units" for the respective SKU in date range in "Sales Record Page"'}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-green-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-green-700",children:a.total}),e.jsx("div",{className:"text-green-600",children:"Total Records"})]}),e.jsxs("div",{className:"bg-blue-50 p-2 rounded text-center",children:[e.jsxs("div",{className:"font-semibold text-blue-700",children:["â‚¹",a.totalRevenue.toLocaleString()]}),e.jsx("div",{className:"text-blue-600",children:"Total Revenue"})]}),e.jsxs("div",{className:"bg-purple-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-purple-700",children:a.recentSales}),e.jsx("div",{className:"text-purple-600",children:"Recent Sales"})]}),e.jsxs("div",{className:"bg-orange-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold text-orange-700",children:a.totalUnitsSold.toLocaleString()}),e.jsx("div",{className:"text-orange-600",children:"Units Sold"})]})]})]}),e.jsx(Ut,{className:"border-t pt-4",children:e.jsx(A,{asChild:!0,className:"w-full",children:e.jsxs(At,{to:"/sales/records",children:["View Sales Records",e.jsx(Ot,{className:"ml-2 h-4 w-4"})]})})})]})]}),e.jsxs(ae,{children:[e.jsx(fe,{children:e.jsxs(je,{className:"flex items-center gap-2",children:[e.jsx(zs,{className:"h-5 w-5 text-primary"}),"Sales Management System"]})}),e.jsx(ne,{children:e.jsx("div",{className:"text-center py-6 text-muted-foreground",children:e.jsx("p",{className:"text-sm",children:"Comprehensive sales tracking from batch coding utilization to final revenue with real-time inventory management"})})})]})]})};function Fn({className:r,classNames:t,showOutsideDays:s=!0,presets:a,...n}){return e.jsxs("div",{className:"flex",children:[a&&e.jsx("div",{className:"flex flex-col items-start pr-4 border-r border-gray-200",children:a.map(i=>e.jsx(A,{variant:"ghost",className:"w-full justify-start mb-1",onClick:()=>{n.onSelect&&typeof n.onSelect=="function"&&n.onSelect(i.range)},children:i.name},i.name))}),e.jsx(wi,{showOutsideDays:s,className:me("p-3",r),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:me(Ta({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:me(Ta({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...t},components:{IconLeft:({...i})=>e.jsx(Si,{className:"h-4 w-4"}),IconRight:({...i})=>e.jsx(wr,{className:"h-4 w-4"})},...n})]})}Fn.displayName="Calendar";const Kl=ki,Vl=Ci,$n=u.forwardRef(({className:r,align:t="center",sideOffset:s=4,...a},n)=>e.jsx(_i,{children:e.jsx(Gr,{ref:n,align:t,sideOffset:s,className:me("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...a})}));$n.displayName=Gr.displayName;function As({value:r,onChange:t,className:s}){const[a,n]=u.useState("this-month"),[i,c]=u.useState(!1),m=[{id:"this-month",name:"This month",range:{from:ts(new Date),to:es(new Date)}},{id:"previous-month",name:"Previous month",range:{from:ts(ya(new Date,1)),to:es(ya(new Date,1))}},{id:"last-6-months",name:"Last 6 months",range:{from:ya(new Date,6),to:new Date}},{id:"custom",name:"Custom",range:void 0}],d=f=>{n(f);const N=m.find(g=>g.id===f);N&&N.id!=="custom"?(t(N.range),c(!1)):c(!0)},o=()=>r?.from?r.to?`${dt(r.from,"dd MMM")} - ${dt(r.to,"dd MMM yyyy")}`:dt(r.from,"dd MMM yyyy"):"Select date range";return u.useEffect(()=>{if(!r&&a==="this-month"&&typeof t=="function"){const f=m.find(N=>N.id==="this-month");f&&t(f.range)}},[r,t,a,m]),e.jsxs("div",{className:me("flex items-center gap-2",s),children:[e.jsxs(le,{value:a,onValueChange:d,children:[e.jsx(ie,{className:"w-[150px]",children:e.jsx(ce,{})}),e.jsx(oe,{children:m.map(f=>e.jsx(S,{value:f.id,children:f.name},f.id))})]}),e.jsxs(Kl,{open:i,onOpenChange:c,children:[e.jsx(Vl,{asChild:!0,children:e.jsxs(A,{id:"date",variant:"outline",className:me("min-w-[200px] justify-between text-left font-normal",!r&&"text-muted-foreground"),onClick:()=>{a==="custom"&&c(!i)},children:[o(),a==="custom"&&e.jsx(Ia,{className:"h-4 w-4 opacity-50"})]})}),a==="custom"&&e.jsx($n,{className:"w-auto p-0",align:"start",children:e.jsx(Fn,{initialFocus:!0,mode:"range",defaultMonth:r?.from,selected:r,onSelect:f=>{t(f),f?.from&&f?.to&&c(!1)},numberOfMonths:2})})]})]})}const sr=r=>r.toISOString();function Bl(){const{user:r,loading:t}=jt(),s=ds(),{toast:a}=Ie(),n=mt(),[i,c]=u.useState(void 0),[m,d]=u.useState(!1),[o,f]=u.useState(null),[N,g]=u.useState([]),[y,j]=u.useState("all"),[P,x]=u.useState("all"),[C,E]=u.useState(""),[D,T]=u.useState({from:"",to:""}),[F,K]=u.useState(1),[O,Z]=u.useState(50),{config:M}=Tt("sales-units"),{validationRules:z,canImport:Q}=Et("sales-units"),{currentSort:R,handleSort:w,getSortedData:Y}=rs();if(tt.useEffect(()=>{o&&m&&(console.log("ðŸ”„ Populating form for edit:",o),X({date:o.date,product_id:o.product_id,sku:o.sku,units:o.units,notes:o.notes||"",dateString:new Date(o.date).toISOString().split("T")[0]}))},[o,m]),t)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ze,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Validating authentication..."})]})});if(!r)return console.error("SalesUnits: User not authenticated, redirecting to login",{location:s.pathname,timestamp:new Date().toISOString(),userAgent:navigator.userAgent}),e.jsx(qs,{to:"/login",state:{from:s},replace:!0});tt.useEffect(()=>()=>{},[r,s]);const{data:_=[],error:H}=Ne({queryKey:["products"],queryFn:async()=>{try{const v=await Ht.getAll();return console.log("ðŸ“¦ Products loaded for sales:",v.map(B=>({id:B.$id,name:B.product||B.product_name,sku:B.sku}))),v}catch(v){throw console.error("SalesUnits: Failed to fetch products",{error:v.message,code:v.code,type:v.type,userId:r?.$id,stack:v.stack}),v}},retry:(v,B)=>B.code===401||B.code===403?!1:v<3}),{data:re=[]}=Ne({queryKey:["post-production-tasks"],queryFn:async()=>{try{return await Zt.getAll()}catch(v){throw console.error("SalesUnits: Failed to fetch post-production tasks",v),v}},retry:(v,B)=>B.code===401||B.code===403?!1:v<3}),{data:I=[]}=Ne({queryKey:["processes"],queryFn:async()=>{try{const v=await js.getAll();return console.log("ðŸ”§ Processes loaded for sales validation:",v.map(B=>({id:B.$id,name:B.process_name,department:B.department}))),v}catch(v){throw console.error("SalesUnits: Failed to fetch processes",v),v}},staleTime:300*1e3}),{data:ee=[],isLoading:V,error:de}=Ne({queryKey:["post-production-status"],queryFn:async()=>{console.log("ðŸš€ Starting post-production status query...");try{const v=await Cl.getAll();return console.log("âœ… Post-production status query successful:",v.length,"records"),console.log("ðŸ“‹ All PostProductionStatus records:",v.map(B=>({product_id:B.product_id,closing_balance:B.closing_balance,status_date:B.status_date}))),v}catch(v){throw console.error("âŒ SalesUnits: Failed to fetch post-production status",{message:v.message,code:v.code,type:v.type,stack:v.stack}),v}},retry:(v,B)=>(console.log(`ðŸ”„ Retrying post-production status query (attempt ${v+1})`),B.code===401||B.code===403?(console.log("ðŸš« Authentication error, not retrying"),!1):v<3),enabled:!!r});tt.useEffect(()=>{console.log("ðŸ“Š Post-production status query status:",{isLoading:V,hasError:!!de,dataLength:ee.length,error:de?.message})},[V,de,ee.length]);const U=u.useMemo(()=>{const v=[];return i?.from&&v.push(et.greaterThanEqual("date",sr(i.from))),i?.to&&v.push(et.lessThanEqual("date",sr(i.to))),v},[i]),{data:h=[],isLoading:p,error:L}=Ne({queryKey:["sales-units",i?.from?.toISOString(),i?.to?.toISOString()],queryFn:async()=>{try{return await Jt.getAll(U)}catch(v){throw console.error("SalesUnits: Failed to fetch sales units",{error:v.message,code:v.code,type:v.type,queries:U,userId:r?.$id,stack:v.stack}),v}},retry:(v,B)=>B.code===401||B.code===403?!1:v<3});tt.useEffect(()=>{L&&(console.error("SalesUnits: Sales units query error detected",L),a({title:"Data Loading Error",description:"Failed to load sales units. Please refresh the page.",variant:"destructive"}))},[L,a]),tt.useEffect(()=>{H&&(console.error("SalesUnits: Products query error detected",H),a({title:"Products Loading Error",description:"Failed to load products. Some features may not work properly.",variant:"destructive"}))},[H,a]);const k=Re({mutationFn:async v=>await we(async()=>await Jt.create(v)),onMutate:()=>{if(Oe==="offline")throw a({title:"Offline",description:"You are currently offline. Please check your connection.",variant:"destructive"}),new Error("Network offline")},onError:(v,B)=>{try{throw console.error("SalesUnits: Failed to create sales unit",{error:v.message,code:v.code,type:v.type,payload:B,userId:r?.$id}),v.code===401?(a({title:"Authentication Error",description:"Your session has expired. Please log in again.",variant:"destructive"}),window.location.href="/login",v):v.code===403?(a({title:"Permission Denied",description:"You don't have permission to create sales units.",variant:"destructive"}),v):v.code>=500?(a({title:"Server Error",description:"A server error occurred. Please try again later.",variant:"destructive"}),v):_e(v)?(a({title:"Network Error",description:Oe==="offline"?"You appear to be offline. Please check your internet connection.":"Network error occurred. Retrying...",variant:"destructive"}),v):(a({title:"Error",description:v.message||"Failed to create sales unit. Please try again.",variant:"destructive"}),v)}catch(ue){throw console.error("SalesUnits: Error in mutation error handler",ue),ue}},onSuccess:v=>{n.invalidateQueries({queryKey:["sales-units"]}),a({title:"Success",description:"Sales unit created successfully.",duration:3e3}),d(!1);const B={date:new Date().toISOString(),product_id:"",sku:"",units:0,notes:""};X(B),Se({}),g([]),f(null)}}),W=Re({mutationFn:async({id:v,data:B})=>await we(async()=>await Jt.update(v,B)),onSuccess:v=>{n.invalidateQueries({queryKey:["sales-units"]}),a({title:"Success",description:"Sales unit updated successfully.",duration:3e3}),d(!1),f(null);const B={date:new Date().toISOString(),product_id:"",sku:"",units:0,notes:""};X(B),Se({})},onError:v=>{console.error("Failed to update sales unit:",v),a({title:"Error",description:v.message||"Failed to update sales unit. Please try again.",variant:"destructive"})}}),xe=Re({mutationFn:v=>Jt.delete(v),onSuccess:()=>{n.invalidateQueries({queryKey:["sales-units"]}),a({title:"Success",description:"Sales unit deleted successfully."})},onError:()=>{a({title:"Error",description:"Failed to delete sales unit.",variant:"destructive"})}}),he=Re({mutationFn:async v=>{await Promise.all(v.map(B=>Jt.delete(B)))},onSuccess:()=>{n.invalidateQueries({queryKey:["sales-units"]}),g([]),a({title:"Success",description:"Selected units deleted successfully."})},onError:()=>{a({title:"Error",description:"Failed to delete selected units.",variant:"destructive"})}}),be=v=>{console.log("ðŸ” Editing sales unit:",v),f(v),d(!0)},Fe=v=>{confirm("Are you sure you want to delete this sales unit?")&&xe.mutate(v)},Me=()=>{if(N.length===0){a({title:"No Selection",description:"Please select units to delete.",variant:"destructive"});return}confirm(`Are you sure you want to delete ${N.length} selected unit(s)?`)&&he.mutate(N.map(v=>v.$id))},He=h.filter(v=>{const B=!C||v.sku.toLowerCase().includes(C.toLowerCase())||v.notes&&v.notes.toLowerCase().includes(C.toLowerCase()),ue=y==="all"||v.product_id===y,ge=P==="all"||v.sku===P,Pe=new Date(v.date),Te=(!D.from||Pe>=new Date(D.from))&&(!D.to||Pe<=new Date(D.to));return B&&ue&&ge&&Te}),ht=tt.useMemo(()=>{const v=new Map;return h.forEach(B=>{v.has(B.product_id)||v.set(B.product_id,{id:B.product_id,name:_.find(ue=>ue.$id===B.product_id)?.product||B.product_id})}),Array.from(v.values()).sort((B,ue)=>B.name.localeCompare(ue.name))},[h,_]),Lt=tt.useMemo(()=>Array.from(new Set(h.map(v=>v.sku))).sort(),[h]),xt=He.length,gt=Math.ceil(xt/O),Nt=(F-1)*O,wt=Nt+O,l=He.slice(Nt,wt);tt.useEffect(()=>{K(1)},[C,y,P,D,O]);const se=()=>{if(N.length===0){a({title:"No Selection",description:"Please select units to export.",variant:"destructive"});return}a({title:"Export",description:`Exporting ${N.length} selected unit(s)...`})},[b,X]=u.useState({date:new Date().toISOString(),product_id:"",sku:"",units:0,notes:""}),[ye,Se]=u.useState({}),[Oe,Ue]=u.useState("online"),[Ke,q]=u.useState(0),ve=tt.useMemo(()=>{const v={date:new Date().toISOString(),product_id:"",sku:"",units:0,notes:""};return b.product_id!==v.product_id||b.sku!==v.sku||b.units!==v.units||(b.notes||"")!==v.notes||b.dateString&&b.dateString!==new Date().toISOString().split("T")[0]},[b]);tt.useEffect(()=>{const v=()=>{Ue("online"),a({title:"Connection Restored",description:"Your internet connection has been restored."})},B=()=>{Ue("offline"),a({title:"Connection Lost",description:"Please check your internet connection.",variant:"destructive"})};return window.addEventListener("online",v),window.addEventListener("offline",B),Ue(navigator.onLine?"online":"offline"),()=>{window.removeEventListener("online",v),window.removeEventListener("offline",B)}},[a]);const _e=v=>v.message?.toLowerCase().includes("network")||v.message?.toLowerCase().includes("fetch")||v.message?.toLowerCase().includes("connection")||v.code==="NETWORK_ERROR"||!navigator.onLine,we=async(v,B=3)=>{let ue;for(let ge=1;ge<=B;ge++)try{if(q(ge-1),ge>1){const Te=Math.min(1e3*Math.pow(2,ge-2),1e4);await new Promise(Ae=>setTimeout(Ae,Te))}const Pe=await v();return q(0),Pe}catch(Pe){if(ue=Pe,console.error(`SalesUnits: Retry attempt ${ge} failed`,{error:Pe.message,isNetworkError:_e(Pe),attempt:ge,maxRetries:B}),Pe.code===401||Pe.code===403||!_e(Pe)&&ge===B)break}throw q(0),ue},ft=(v,B)=>{const ue={...ye};switch(v){case"product_id":B?delete ue.product_id:ue.product_id="Product is required";break;case"sku":B?delete ue.sku:ue.sku="SKU is required";break;case"units":!B||B<=0?ue.units="Units must be greater than 0":delete ue.units;break;case"dateString":B?delete ue.dateString:ue.dateString="Date is required";break}return Se(ue),Object.keys(ue).length===0},Ee=v=>{const B={...b,...v};X(B),Object.keys(v).forEach(ue=>{ft(ue,v[ue])})},Ce=async()=>{try{return r?!0:(a({title:"Session Expired",description:"Please log in again to continue.",variant:"destructive"}),!1)}catch{return a({title:"Session Error",description:"Unable to validate your session. Please log in again.",variant:"destructive"}),!1}},Ve=v=>{console.log("ðŸ” Checking if product has available batch coding units:",v);const B=ee.find(ue=>ue.product_id===v);if(console.log("ðŸ“‹ Post-production status for product:",B),B&&(B.closing_balance||0)>0){const ge=_.find(Pe=>Pe.$id===v)?.sku;if(ge){const Pe=h.filter(Ae=>Ae.sku===ge).reduce((Ae,Ge)=>Ae+(Ge.units||0),0),Te=(B.closing_balance||0)-Pe;return console.log(`ðŸ“Š Availability using stored balance for ${ge}:`,{storedBalance:B.closing_balance,soldUnits:Pe,available:Te}),Te>0}}else{console.log("âš ï¸ No stored balance, checking completed batch coding tasks...");const ue=re.filter(ge=>{const Te=I.find(Ae=>Ae.$id===ge.process_id)?.process_name?.toLowerCase()==="batch coding";return ge.product_id===v&&ge.status==="completed"&&Te});return console.log(`ðŸ“Š Found ${ue.length} completed batch coding tasks for product`),ue.length>0}return!1},Be=(v,B,ue)=>{console.log("ðŸ” Getting available batch coding units:",{productId:v,sku:B,excludeRecordId:ue});const ge=_.find(Ge=>Ge.$id===v),Pe=ge?.sku;if(!ge||!Pe)return console.log("âš ï¸ Product not found or has no SKU:",{productId:v,productSku:Pe}),0;if(Pe!==B)return console.log("âš ï¸ SKU mismatch - requested SKU does not belong to this product:",{productId:v,requestedSku:B,productSku:Pe}),0;const Te=ee.find(Ge=>Ge.product_id===v);console.log("ðŸŽ¯ PostProductionStatus record found for product:",Te);let Ae=0;if(Te&&Te.closing_balance!==void 0&&Te.closing_balance!==null){const Ge=Te.closing_balance||0;console.log("âœ… Using stored closing balance:",Ge);const is=ue?h.filter(ut=>ut.sku===B&&ut.$id===ue).reduce((ut,Ze)=>ut+(Ze.units||0),0):0;Ae=Math.max(0,Ge+is)}else{console.log("âš ï¸ No stored closing balance found, calculating from completed tasks...");const Ge=re.filter(Ze=>{const Mt=I.find(Un=>Un.$id===Ze.process_id),vs=Mt?.process_name?.toLowerCase()==="batch coding",$s=Ze.product_id===v&&Ze.status==="completed"&&vs;return Ze.product_id===v&&console.log(`ðŸ” Task ${Ze.task_id}:`,{processId:Ze.process_id,processName:Mt?.process_name,isBatchCoding:vs,status:Ze.status,matches:$s}),$s});if(console.log("ðŸ“Š Completed batch coding tasks found:",Ge.length),Ge.length===0)return console.log("âš ï¸ No completed batch coding tasks found for this product"),0;const is=Ge.reduce((Ze,Mt)=>{const vs=Mt.completed_quantity!==void 0&&Mt.completed_quantity!==null?Number(Mt.completed_quantity):Number(Mt.units)||0;return Ze+vs},0),ut=h.filter(Ze=>Ze.sku===B&&Ze.$id!==ue).reduce((Ze,Mt)=>Ze+(Mt.units||0),0);Ae=Math.max(0,is-ut),console.log("ðŸ“Š Calculated availability:",{totalCompletedUnits:is,soldUnits:ut,availableUnits:Ae})}return console.log("ðŸ“ˆ Final availability calculation:",{productId:v,sku:B,availableUnits:Ae,excludedRecordId:ue,method:Te?.closing_balance!==void 0?"stored_balance":"calculated_from_tasks"}),Ae},Le=async v=>{if(v.preventDefault(),!await Ce()){console.error("SalesUnits: Session validation failed, aborting form submission");return}if(!b.product_id||!b.sku||!b.units||!b.dateString||b.product_id==="no-products"||b.sku==="no-skus"){a({title:"Validation Error",description:"Please fill all required fields: Product, SKU, Units, and Date.",variant:"destructive"});return}if(b.units<=0){a({title:"Validation Error",description:"Units must be greater than 0.",variant:"destructive"});return}const ue=Be(b.product_id,b.sku,o?.$id);if(console.log("ðŸ”„ Edit Mode Validation Check:",{isEditing:!!o,editingRecordId:o?.$id,requestedUnits:b.units,availableUnits:ue,sku:b.sku,shouldTriggerValidation:b.units>ue}),b.units>ue){console.log("ðŸš¨ SALES UNITS VALIDATION TRIGGERED:",{requestedUnits:b.units,availableUnits:ue,productId:b.product_id,sku:b.sku}),console.log("ðŸ”„ Showing custom Sales Units validation dialog");const ge={isValid:!1,currentProcess:"sales_units",sourceProcess:"batch_coding",availableQuantity:ue,requiredQuantity:b.units,warningMessage:`Insufficient batch coding units. Available: ${ue} units, Requested: ${b.units} units`,suggestions:[`Reduce quantity to ${ue} units or less`,"Complete more batch coding tasks to increase availability","Check batch coding status for current availability"]};console.log("ðŸ“‹ Custom Validation Data Created:",ge),console.log("ðŸ§¹ Clearing regular validation state before showing custom dialog")}try{const ge={date:b.dateString?new Date(b.dateString).toISOString():b.date,product_id:b.product_id,sku:b.sku,units:b.units,notes:b.notes||void 0};o?W.mutate({id:o.$id,data:ge}):k.mutate(ge)}catch(ge){console.error("SalesUnits: Form submission error",ge),a({title:"Error",description:"Failed to submit form. Please try again.",variant:"destructive"})}};return e.jsx("div",{className:"p-4",children:e.jsxs(ae,{children:[e.jsx(fe,{children:e.jsxs(je,{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Sales Units"}),e.jsxs("div",{className:"flex gap-2",children:[Q&&M&&e.jsx(qt,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:M.exportColumns.filter(v=>v.required).map(v=>v.exportHeader),optionalColumns:M.exportColumns.filter(v=>!v.required).map(v=>v.exportHeader),validationRules:z,maxFileSize:50,existingData:h||[],validationHeaderMapper:v=>{const B=M.exportColumns.find(ue=>ue.dataKey===v);return B?B.exportHeader:v},columnMapper:v=>{const B=M.exportColumns.find(ue=>ue.exportHeader===v);return B?B.dataKey==="productName"?"product_name":B.dataKey==="sku"?"sku":{date:"date",units:"units",status:"status",remarks:"remarks"}[B.dataKey]||B.dataKey:v},dataProcessor:async v=>{let B=v.Product||v.product_name||v.product_name,ue=v.SKU||v.sku||v.sku;if(!B||B==="")throw new Error("Product is required");const ge=String(B).trim(),Pe=_?.find(ut=>ut.product&&ut.product.toLowerCase()===ge.toLowerCase()||ut.sku&&ut.sku.toLowerCase()===(ue||"").toLowerCase());if(!Pe){const ut=_?.map(Ze=>Ze.product||Ze.sku).slice(0,5).join(", ")||"None";throw new Error(`Product "${ge}" not found. Available: ${ut}`)}const Te=Pe.$id,Ae=ue||Pe.sku||"";let Ge=v.Date||v.date||v.date||new Date().toISOString().split("T")[0];if(Ge&&typeof Ge=="string"){const ut=Ge.match(/^(\d{2})-(\d{2})-(\d{4})$/);if(ut){const[,Ze,Mt,vs]=ut,$s=new Date(parseInt(vs),parseInt(Mt)-1,parseInt(Ze));isNaN($s.getTime())||(Ge=$s.toISOString().split("T")[0])}else{const Ze=new Date(Ge);isNaN(Ze.getTime())||(Ge=Ze.toISOString().split("T")[0])}}else Ge instanceof Date&&(Ge=Ge.toISOString().split("T")[0]);const is={date:Ge,product_id:Te,sku:Ae,units:parseFloat(v.Units||v.units||v.units||0),notes:v.Remarks||v.remarks||v.remarks||""};return await Jt.create(is)},onImportComplete:async v=>{await n.invalidateQueries({queryKey:["sales-units"],refetchType:"active"}),await n.refetchQueries({queryKey:["sales-units"]}),v.successfulRows>0&&a({title:"Import Successful",description:`${v.successfulRows} sales units imported successfully.`}),v.failedRows>0&&a({title:"Import Completed with Errors",description:`${v.successfulRows} successful, ${v.failedRows} failed.`,variant:"destructive"})}},variant:"outline"}),M&&e.jsx(Rt,{data:h.map(v=>{const B={};return M.exportColumns.forEach(ue=>{let ge;switch(ue.dataKey){case"date":ge=v.date;break;case"productName":ge=_.find(Pe=>Pe.$id===v.product_id)?.product||v.product_id;break;case"sku":ge=v.sku;break;case"units":ge=v.units;break;case"status":ge="Completed";break;case"remarks":ge=v.notes||"";break;default:ge=v[ue.dataKey]}B[ue.exportHeader]=ue.formatter?ue.formatter(ge):ge}),B}),headers:M.exportColumns.map(v=>v.exportHeader),filename:"sales-units",variant:"outline"}),e.jsxs(A,{onClick:()=>d(!0),children:[e.jsx(Ct,{className:"mr-2 h-4 w-4"})," Add New Units"]})]})]})}),e.jsxs(ne,{children:[e.jsx(ae,{className:"mb-6",children:e.jsx(ne,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex flex-wrap gap-4 items-center",children:e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(pt,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(G,{placeholder:"Search units...",className:"pl-10",value:C,onChange:v=>E(v.target.value)})]})}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs(le,{value:y,onValueChange:j,children:[e.jsx(ie,{className:"w-[180px]",children:e.jsx(ce,{placeholder:"Filter by Product"})}),e.jsxs(oe,{children:[e.jsx(S,{value:"all",children:"All Products"}),ht.map(v=>e.jsx(S,{value:v.id,children:v.name},v.id))]})]}),e.jsxs(le,{value:P,onValueChange:x,children:[e.jsx(ie,{className:"w-[180px]",children:e.jsx(ce,{placeholder:"Filter by SKU"})}),e.jsxs(oe,{children:[e.jsx(S,{value:"all",children:"All SKUs"}),Lt.map(v=>e.jsx(S,{value:v,children:v},v))]})]}),e.jsx(G,{type:"date",placeholder:"From Date",className:"w-[150px]",value:D.from,onChange:v=>T(B=>({...B,from:v.target.value}))}),e.jsx(G,{type:"date",placeholder:"To Date",className:"w-[150px]",value:D.to,onChange:v=>T(B=>({...B,to:v.target.value}))})]})]})})}),e.jsx(lt,{open:m,onOpenChange:v=>{if(!v&&(k.isPending||W.isPending)){a({title:"Please wait",description:"Form is being submitted. Please wait for completion.",variant:"destructive"});return}if(!(!v&&ve&&!(k.isPending||W.isPending)&&!window.confirm("You have unsaved changes. Are you sure you want to close without saving?"))&&(d(v),!v)){const B={date:new Date().toISOString(),product_id:"",sku:"",units:0,notes:""};X(B),Se({}),f(null)}},children:e.jsxs(rt,{className:"sm:max-w-[600px] max-w-[95vw] max-h-[90vh] overflow-y-auto",children:[e.jsxs(nt,{children:[e.jsxs(ot,{className:"flex items-center gap-2",children:[o?"Edit Sales Unit":"Add New Sales Unit",ve&&e.jsx("span",{className:"text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded",children:"Unsaved changes"})]}),e.jsx(ct,{children:"Enter sales unit details below."}),_.filter(v=>Ve(v.$id)).length===0&&e.jsxs("div",{className:"mt-2 p-3 bg-yellow-50 border border-yellow-200 rounded text-sm text-yellow-800",children:[e.jsx("strong",{children:"âš ï¸ No products available:"})," All products either have no completed batch coding units or all units have been sold."]})]}),e.jsxs("form",{onSubmit:Le,children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 py-4",children:[e.jsxs("div",{children:[e.jsx($,{htmlFor:"date",children:"Date *"}),e.jsx(G,{id:"date",type:"date",value:b.dateString||"",onChange:v=>Ee({dateString:v.target.value}),className:ye.dateString?"border-red-500":""}),ye.dateString&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:ye.dateString})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"product",children:"Product *"}),e.jsxs(le,{value:b.product_id,onValueChange:v=>Ee({product_id:v,sku:_.find(B=>B.$id===v)?.sku||b.sku}),children:[e.jsx(ie,{id:"product",className:ye.product_id?"border-red-500":"",children:e.jsx(ce,{placeholder:"Select Product"})}),e.jsxs(oe,{children:[_.filter(v=>{const B=ee.find(ge=>ge.product_id===v.$id);let ue=!1;return B&&(B.closing_balance||0)>0?ue=!0:v.sku&&(ue=re.filter(Te=>Te.product_id===v.$id&&Te.status==="completed").length>0),console.log("ðŸ” Product filtering for sales:",{productId:v.$id,productName:v.product||v.product_name,sku:v.sku,postProdStatusFound:!!B,storedClosingBalance:B?.closing_balance,hasCompletedTasks:re.filter(ge=>ge.product_id===v.$id&&ge.status==="completed").length>0,finalDecision:ue}),ue}).map(v=>e.jsx(S,{value:v.$id,children:v.product||v.$id},v.$id)),_.filter(v=>{const B=ee.find(ge=>ge.product_id===v.$id);return B&&(B.closing_balance||0)>0?!0:v.sku?re.filter(Pe=>Pe.product_id===v.$id&&Pe.status==="completed").length>0:!1}).length===0&&e.jsx(S,{value:"no-products",disabled:!0,children:"No products with available batch coding units"})]})]}),ye.product_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:ye.product_id})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"sku",children:"SKU *"}),e.jsxs(le,{value:b.sku,onValueChange:v=>Ee({sku:v}),children:[e.jsx(ie,{id:"sku",className:ye.sku?"border-red-500":"",children:e.jsx(ce,{placeholder:"Select SKU"})}),e.jsxs(oe,{children:[(()=>{if(!b.product_id)return[];const v=_.find(Pe=>Pe.$id===b.product_id);if(!v||!v.sku)return[];const B=v.sku,ue=Be(b.product_id,B,o?.$id),ge=o&&B===o.sku;return ue>0||ge?[v]:[]})().map(v=>{const B=v.sku,ue=Be(b.product_id,B,o?.$id),ge=o&&B===o.sku;return e.jsxs(S,{value:B,children:[B,v.product?` â€” ${v.product}`:"",e.jsxs("span",{className:`text-xs ml-2 ${ue>0?"text-gray-500":"text-red-500"}`,children:["(",ue," available",ge&&ue===0?" - Current":"",")"]})]},v.$id)}),b.product_id&&(()=>{const v=_.find(Pe=>Pe.$id===b.product_id);if(!v||!v.sku)return!0;const B=v.sku,ue=Be(b.product_id,B,o?.$id),ge=o&&B===o.sku;return ue===0&&!ge})()&&e.jsx(S,{value:"no-skus",disabled:!0,children:"No SKUs with available batch coding units for this product"})]})]}),ye.sku&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:ye.sku}),b.product_id&&b.sku&&e.jsxs("div",{className:"mt-2 p-2 bg-blue-50 border border-blue-200 rounded text-sm",children:[e.jsx("span",{className:"text-blue-700 font-medium",children:"Available Batch Coding Units:"}),e.jsxs("span",{className:"text-blue-800 font-bold",children:[Be(b.product_id,b.sku,o?.$id)," units"]})]})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"units",children:"Units *"}),e.jsx(G,{id:"units",type:"number",min:"1",value:b.units,onChange:v=>Ee({units:Number(v.target.value)}),className:ye.units?"border-red-500":""}),ye.units&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:ye.units})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx($,{htmlFor:"notes",children:"Remarks"}),e.jsx(G,{id:"notes",type:"text",value:b.notes||"",onChange:v=>Ee({notes:v.target.value})})]})]}),e.jsxs(it,{className:"flex-col sm:flex-row gap-2 pt-4",children:[e.jsx(A,{type:"button",variant:"outline",onClick:()=>d(!1),className:"w-full sm:w-auto",children:"Cancel"}),e.jsx(A,{type:"submit",disabled:k.isPending||W.isPending||Object.keys(ye).length>0,className:"w-full sm:w-auto",children:k.isPending||W.isPending?e.jsxs(e.Fragment,{children:[e.jsx(ze,{className:"mr-2 h-4 w-4 animate-spin"}),"Savingâ€¦"]}):o?"Update Sales Unit":"Add Sales Unit"})]})]})]})}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{placeholder:"Search units...",value:C,onChange:v=>E(v.target.value),className:"max-w-sm"}),e.jsxs(le,{value:y,onValueChange:j,children:[e.jsx(ie,{className:"w-[180px]",children:e.jsx(ce,{placeholder:"Filter by Product"})}),e.jsxs(oe,{children:[e.jsx(S,{value:"all",children:"All Products"}),_.map(v=>e.jsx(S,{value:v.$id,children:v.product||v.$id},v.$id))]})]}),e.jsx(As,{value:i,onChange:c})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[Oe==="offline"&&e.jsxs("div",{className:"flex items-center gap-1 text-red-600 text-sm",children:[e.jsx("div",{className:"w-2 h-2 bg-red-600 rounded-full"}),"Offline"]}),Ke>0&&e.jsxs("div",{className:"flex items-center gap-1 text-yellow-600 text-sm",children:[e.jsx(ze,{className:"h-3 w-3 animate-spin"}),"Retrying... (",Ke,")"]})]})]}),e.jsx(ae,{children:e.jsxs(ne,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",Nt+1," to ",Math.min(wt,xt)," of ",xt," records"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Records per page:"}),e.jsxs(le,{value:O.toString(),onValueChange:v=>Z(Number(v)),children:[e.jsx(ie,{className:"w-[100px]",children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"50",children:"50"}),e.jsx(S,{value:"100",children:"100"}),e.jsx(S,{value:"500",children:"500"})]})]})]})]}),N.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 p-3 bg-muted rounded-md",children:[e.jsxs("span",{className:"text-sm font-medium",children:[N.length," selected"]}),e.jsx(A,{variant:"destructive",size:"sm",onClick:Me,disabled:he.isPending,children:"Delete Selected"}),e.jsx(A,{variant:"outline",size:"sm",onClick:se,children:"Export Selected"})]}),e.jsx("div",{className:"border rounded-md",children:e.jsx("div",{className:"overflow-auto",style:{maxHeight:"600px"},children:e.jsx(us,{data:Y(l.map(v=>((!v.date||v.date==="Invalid Date")&&console.warn("Invalid sales unit date found:",{id:v.$id,date:v.date}),{...v,productName:_.find(B=>B.$id===v.product_id)?.product||v.product_id,formattedDate:ga(v.date),status:"Completed"}))),columns:[{key:"formattedDate",label:"Date",sortable:!0,dataType:"date"},{key:"productName",label:"Product",sortable:!0,dataType:"string"},{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"units",label:"Units",sortable:!0,dataType:"number",align:"right",headerClassName:"bg-purple-50",cellClassName:"bg-purple-50 font-medium"},{key:"status",label:"Status",sortable:!0,dataType:"string",formatter:v=>e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${v==="Completed"?"bg-green-100 text-green-800":v==="In Progress"?"bg-yellow-100 text-yellow-800":v==="Pending"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:v})},{key:"notes",label:"Remarks",sortable:!0,dataType:"string"}],onSort:w,currentSort:R,loading:p,maxHeight:"none",stickyHeader:!0,bordered:!1,searchable:!1,rowKey:"$id",selectable:!0,selectedRows:N,onSelectionChange:g,actions:[{label:"Edit",onClick:be,variant:"default"},{label:"Delete",onClick:v=>Fe(v.$id),variant:"destructive"}],emptyMessage:"No sales units found"})})}),gt>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx(A,{variant:"outline",size:"sm",onClick:()=>K(v=>Math.max(1,v-1)),disabled:F===1,children:"Previous"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",F," of ",gt]})}),e.jsx(A,{variant:"outline",size:"sm",onClick:()=>K(v=>Math.min(gt,v+1)),disabled:F===gt,children:"Next"})]})]})})]})]})})}const ar=r=>r.toISOString();function Hl(){const{user:r,loading:t}=jt(),s=ds(),{toast:a}=Ie(),n=mt(),[i,c]=u.useState(void 0),[m,d]=u.useState(!1),[o,f]=u.useState(null),[N,g]=u.useState([]),[y,j]=u.useState("all"),[P,x]=u.useState("all"),[C,E]=u.useState("all"),[D,T]=u.useState(""),[F,K]=u.useState({from:"",to:""}),[O,Z]=u.useState(1),[M,z]=u.useState(50),{config:Q}=Tt("sales-record"),{validationRules:R,canImport:w}=Et("sales-record"),{currentSort:Y,handleSort:_,getSortedData:H}=rs();if(tt.useEffect(()=>{o&&m&&(console.log("ðŸ”„ Populating form for edit:",o),L({date:o.date,sales_channel_id:o.sales_channel_id,product_id:o.product_id,sku:o.sku,sold_units:o.sold_units,unit_price:o.unit_price,total_price:o.total_price,notes:o.notes||"",dateString:new Date(o.date).toISOString().split("T")[0]}))},[o,m]),t)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ze,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Validating authentication..."})]})});if(!r)return console.error("SalesRecord: User not authenticated, redirecting to login"),e.jsx(qs,{to:"/login",state:{from:s},replace:!0});const{data:re=[]}=Ne({queryKey:["products"],queryFn:()=>Ht.getAll()}),{data:I=[]}=Ne({queryKey:["sales-channels"],queryFn:()=>Os.getAll()}),ee=u.useMemo(()=>{const b=[];return i?.from&&b.push(et.greaterThanEqual("date",ar(i.from))),i?.to&&b.push(et.lessThanEqual("date",ar(i.to))),b},[i]),{data:V=[],isLoading:de}=Ne({queryKey:["sales-records",i?.from?.toISOString(),i?.to?.toISOString()],queryFn:()=>ls.getAll(ee)}),U=Re({mutationFn:async b=>{try{return await ls.create(b)}catch(X){throw console.error("SalesRecord: Failed to create sales record",{error:X.message,code:X.code,type:X.type,payload:b,userId:r?.$id}),X.code===401?(a({title:"Authentication Error",description:"Your session has expired. Please log in again.",variant:"destructive"}),window.location.href="/login",X):X.code===403?(a({title:"Permission Denied",description:"You don't have permission to create sales records.",variant:"destructive"}),X):(a({title:"Error",description:X.message||"Failed to create sales record. Please try again.",variant:"destructive"}),X)}},onSuccess:b=>{n.invalidateQueries({queryKey:["sales-records"]}),a({title:"Success",description:"Sales record created successfully.",duration:3e3}),d(!1),g([]),L({date:new Date().toISOString(),sales_channel_id:"",product_id:"",sku:"",sold_units:0,unit_price:0,total_price:0,notes:""}),f(null)}}),h=Re({mutationFn:async({id:b,data:X})=>await ls.update(b,X),onSuccess:b=>{n.invalidateQueries({queryKey:["sales-records"]}),a({title:"Success",description:"Sales record updated successfully.",duration:3e3}),d(!1),f(null),L({date:new Date().toISOString(),sales_channel_id:"",product_id:"",sku:"",sold_units:0,unit_price:0,total_price:0,notes:""})},onError:b=>{console.error("Failed to update sales record:",b),a({title:"Error",description:b.message||"Failed to update sales record. Please try again.",variant:"destructive"})}}),[p,L]=u.useState({date:new Date().toISOString(),sales_channel_id:"",product_id:"",sku:"",sold_units:0,unit_price:0,total_price:0,notes:""}),k=Re({mutationFn:b=>ls.delete(b),onSuccess:()=>{n.invalidateQueries({queryKey:["sales-records"]}),a({title:"Success",description:"Sales record deleted successfully."})},onError:()=>{a({title:"Error",description:"Failed to delete sales record.",variant:"destructive"})}}),W=Re({mutationFn:async b=>{await Promise.all(b.map(X=>ls.delete(X)))},onSuccess:()=>{n.invalidateQueries({queryKey:["sales-records"]}),g([]),a({title:"Success",description:"Selected records deleted successfully."})},onError:()=>{a({title:"Error",description:"Failed to delete selected records.",variant:"destructive"})}}),xe=b=>{console.log("ðŸ” Editing sales record:",b),f(b),d(!0)},he=b=>{confirm("Are you sure you want to delete this sales record?")&&k.mutate(b)},be=()=>{if(N.length===0){a({title:"No Selection",description:"Please select records to delete.",variant:"destructive"});return}confirm(`Are you sure you want to delete ${N.length} selected record(s)?`)&&W.mutate(N.map(b=>b.$id))},Fe=()=>{if(N.length===0){a({title:"No Selection",description:"Please select records to export.",variant:"destructive"});return}a({title:"Export",description:`Exporting ${N.length} selected record(s)...`})},Me=V.filter(b=>{const X=!D||b.sku.toLowerCase().includes(D.toLowerCase())||b.notes&&b.notes.toLowerCase().includes(D.toLowerCase()),ye=y==="all"||b.sales_channel_id===y,Se=P==="all"||b.product_id===P,Oe=C==="all"||b.sku===C,Ue=new Date(b.date),Ke=(!F.from||Ue>=new Date(F.from))&&(!F.to||Ue<=new Date(F.to));return X&&ye&&Se&&Oe&&Ke}),He=tt.useMemo(()=>{const b=new Map;return V.forEach(X=>{b.has(X.sales_channel_id)||b.set(X.sales_channel_id,{id:X.sales_channel_id,name:I.find(ye=>ye.$id===X.sales_channel_id)?.channel_name||X.sales_channel_id})}),Array.from(b.values()).sort((X,ye)=>X.name.localeCompare(ye.name))},[V,I]),ht=tt.useMemo(()=>{const b=new Map;return V.forEach(X=>{b.has(X.product_id)||b.set(X.product_id,{id:X.product_id,name:re.find(ye=>ye.$id===X.product_id)?.product||X.product_id})}),Array.from(b.values()).sort((X,ye)=>X.name.localeCompare(ye.name))},[V,re]),Lt=tt.useMemo(()=>Array.from(new Set(V.map(b=>b.sku))).sort(),[V]),xt=Me.length,gt=Math.ceil(xt/M),Nt=(O-1)*M,wt=Nt+M,l=Me.slice(Nt,wt);u.useEffect(()=>{Z(1)},[D,y,P,C,F,M]);const se=b=>{if(b.preventDefault(),!p.sales_channel_id||!p.product_id||!p.sku||!p.sold_units||!p.unit_price||!p.dateString){a({title:"Validation Error",description:"Please fill all required fields: Date, Sales Channel, Product, SKU, Quantity, and Rate.",variant:"destructive"});return}if(p.sold_units<=0){a({title:"Validation Error",description:"Quantity must be greater than 0.",variant:"destructive"});return}if(p.unit_price<=0){a({title:"Validation Error",description:"Rate must be greater than 0.",variant:"destructive"});return}const X={date:p.dateString?new Date(p.dateString).toISOString():p.date,sales_channel_id:p.sales_channel_id,product_id:p.product_id,sku:p.sku,sold_units:p.sold_units,unit_price:p.unit_price,total_price:Number((p.sold_units*p.unit_price).toFixed(2)),notes:p.notes||void 0};o?h.mutate({id:o.$id,data:X}):U.mutate(X)};return e.jsx("div",{className:"p-4",children:e.jsxs(ae,{children:[e.jsx(fe,{children:e.jsxs(je,{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Sales Records"}),e.jsxs("div",{className:"flex gap-2",children:[w&&Q&&e.jsx(qt,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:Q.exportColumns.filter(b=>b.required).map(b=>b.exportHeader),optionalColumns:Q.exportColumns.filter(b=>!b.required).map(b=>b.exportHeader),validationRules:R,maxFileSize:50,existingData:V||[],validationHeaderMapper:b=>{const X=Q.exportColumns.find(ye=>ye.dataKey===b);return X?X.exportHeader:b},columnMapper:b=>{const X=Q.exportColumns.find(ye=>ye.exportHeader===b);return X?X.dataKey==="channelName"?"channel_name":X.dataKey==="productName"?"product_name":X.dataKey==="sku"?"sku":{date:"date",qty:"sold_units",rate:"unit_price",totalAmount:"total_amount",status:"status",remarks:"remarks"}[X.dataKey]||X.dataKey:b},dataProcessor:async(b,X)=>{console.log("ðŸ“ [SalesRecord] dataProcessor CALLED"),console.log("ðŸ“ [SalesRecord] Row data:",JSON.stringify(b,null,2));let ye=b["Sales Channel"]||b.channel_name||b.channel_name||b["Sales Channel Name"];if(console.log("ðŸ“ [SalesRecord] Channel name from row:",ye),!ye||ye==="")throw new Error("Sales Channel is required");const Se=String(ye).trim(),Oe=I?.find(Te=>Te.channel_name.toLowerCase()===Se.toLowerCase());if(!Oe){const Te=I?.map(Ae=>Ae.channel_name).slice(0,5).join(", ")||"None";throw new Error(`Sales Channel "${Se}" not found. Available channels: ${Te}${I&&I.length>5?"...":""}. Please check the channel name matches exactly.`)}const Ue=Oe.$id;let Ke=b.Product||b.product_name||b.product_name,q=b.SKU||b.sku||b.sku;if(!Ke||Ke==="")throw new Error("Product is required");let ve="";if(q&&typeof q=="string"){const Te=q.trim(),Ae=Te.match(/^([^â€”\-]+?)(\s*[â€”\-]\s*|$)/);Ae?ve=Ae[1].trim():ve=Te}else ve=String(q||"").trim();const _e=String(Ke).trim();let we=re?.find(Te=>Te.product&&Te.product.toLowerCase()===_e.toLowerCase());if(!we&&ve&&(we=re?.find(Te=>Te.sku&&Te.sku.toLowerCase()===ve.toLowerCase())),!we){const Te=re?.map(Ae=>`${Ae.product||Ae.$id} (SKU: ${Ae.sku||"N/A"})`).slice(0,5).join(", ")||"None";throw new Error(`Product "${_e}" or SKU "${ve||q}" not found. Available products: ${Te}${re&&re.length>5?"...":""}. Please check the product name or SKU matches exactly.`)}const ft=we.$id,Ee=we.sku||ve||"";let Ce=b.Date||b.date||b.date,Ve;if(Ce&&typeof Ce=="string"){const Te=Ce.match(/^(\d{2})-(\d{2})-(\d{4})$/);if(Te){const[,Ae,Ge,is]=Te,ut=new Date(parseInt(is),parseInt(Ge)-1,parseInt(Ae));if(isNaN(ut.getTime()))throw new Error(`Invalid date format: ${Ce}. Use DD-MM-YYYY format (e.g., 15-01-2024).`);Ve=ut.toISOString()}else{const Ae=new Date(Ce);if(isNaN(Ae.getTime()))throw new Error(`Invalid date format: ${Ce}. Use DD-MM-YYYY format (e.g., 15-01-2024).`);Ve=Ae.toISOString()}}else if(Ce instanceof Date){if(isNaN(Ce.getTime()))throw new Error("Invalid date. Use DD-MM-YYYY format (e.g., 15-01-2024).");Ve=Ce.toISOString()}else Ve=new Date().toISOString();const Be=parseFloat(b.Qty||b.qty||b.sold_units||"0"),Le=parseFloat(b.Rate||b.rate||b.unit_price||"0");if(!Be||Be<=0||isNaN(Be))throw new Error(`Invalid Quantity: ${Be}. Must be greater than 0.`);if(!Le||Le<=0||isNaN(Le))throw new Error(`Invalid Rate: ${Le}. Must be greater than 0.`);const v=Number((Be*Le).toFixed(2)),ue=(b.Remarks||b.remarks||b.notes||"").trim()||void 0,ge={date:Ve,sales_channel_id:Ue,product_id:ft,sku:Ee||"",sold_units:Be,unit_price:Le,total_price:v,notes:ue};console.log("ðŸ”„ [SalesRecord] About to create record with:",JSON.stringify(ge,null,2));const Pe=await ls.create(ge);return console.log("âœ… [SalesRecord] Record created successfully! ID:",Pe.$id),console.log("âœ… [SalesRecord] Full created object:",JSON.stringify(Pe,null,2)),Pe},onImportComplete:async b=>{if(console.log("ðŸ“Š Import Result:",b),console.log("âœ… Successful Rows:",b.successfulRows),console.log("âŒ Failed Rows:",b.failedRows),console.log("âš ï¸ Errors:",b.errors),await n.invalidateQueries({queryKey:["sales-records"],refetchType:"active"}),await n.refetchQueries({queryKey:["sales-records"]}),b.failedRows>0&&b.errors.length>0){const X=b.errors.slice(0,5).map(ye=>`Row ${ye.row}: ${ye.message}`).join(`
`);a({title:"Import Completed with Errors",description:`${b.successfulRows} successful, ${b.failedRows} failed.

First errors:
${X}`,variant:"destructive",duration:1e4})}else b.successfulRows>0?a({title:"Import Successful",description:`${b.successfulRows} sales records imported successfully.`}):a({title:"Import Failed",description:`No records were imported. ${b.errors.length>0?`Errors: ${b.errors[0]?.message}`:"Unknown error"}`,variant:"destructive"})}},variant:"outline"}),Q&&e.jsx(Rt,{data:V.map(b=>{const X={};return Q.exportColumns.forEach(ye=>{let Se;switch(ye.dataKey){case"date":Se=b.date;break;case"channelName":Se=I.find(Oe=>Oe.$id===b.sales_channel_id)?.channel_name||b.sales_channel_id;break;case"productName":Se=re.find(Oe=>Oe.$id===b.product_id)?.product||b.product_id;break;case"sku":Se=b.sku;break;case"qty":Se=b.sold_units;break;case"rate":Se=b.unit_price;break;case"totalAmount":Se=Number((b.sold_units*b.unit_price).toFixed(2));break;case"status":Se="Completed";break;case"remarks":Se=b.notes||"";break;default:Se=b[ye.dataKey]}X[ye.exportHeader]=ye.formatter?ye.formatter(Se):Se}),X}),headers:Q.exportColumns.map(b=>b.exportHeader),filename:"sales-record",variant:"outline"}),e.jsxs(A,{onClick:()=>d(!0),children:[e.jsx(Ct,{className:"mr-2 h-4 w-4"})," Add Sales Record"]})]})]})}),e.jsxs(ne,{children:[e.jsx(ae,{className:"mb-6",children:e.jsx(ne,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex flex-wrap gap-4 items-center",children:e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(pt,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(G,{placeholder:"Search records...",className:"pl-10",value:D,onChange:b=>T(b.target.value)})]})}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs(le,{value:y,onValueChange:j,children:[e.jsx(ie,{className:"w-[180px]",children:e.jsx(ce,{placeholder:"Filter by Channel"})}),e.jsxs(oe,{children:[e.jsx(S,{value:"all",children:"All Channels"}),He.map(b=>e.jsx(S,{value:b.id,children:b.name},b.id))]})]}),e.jsxs(le,{value:P,onValueChange:x,children:[e.jsx(ie,{className:"w-[180px]",children:e.jsx(ce,{placeholder:"Filter by Product"})}),e.jsxs(oe,{children:[e.jsx(S,{value:"all",children:"All Products"}),ht.map(b=>e.jsx(S,{value:b.id,children:b.name},b.id))]})]}),e.jsxs(le,{value:C,onValueChange:E,children:[e.jsx(ie,{className:"w-[180px]",children:e.jsx(ce,{placeholder:"Filter by SKU"})}),e.jsxs(oe,{children:[e.jsx(S,{value:"all",children:"All SKUs"}),Lt.map(b=>e.jsx(S,{value:b,children:b},b))]})]}),e.jsx(G,{type:"date",placeholder:"From Date",className:"w-[150px]",value:F.from,onChange:b=>K(X=>({...X,from:b.target.value}))}),e.jsx(G,{type:"date",placeholder:"To Date",className:"w-[150px]",value:F.to,onChange:b=>K(X=>({...X,to:b.target.value}))})]})]})})}),e.jsx(lt,{open:m,onOpenChange:b=>{d(b),b||(L({date:new Date().toISOString(),sales_channel_id:"",product_id:"",sku:"",sold_units:0,unit_price:0,total_price:0,notes:""}),f(null))},children:e.jsxs(rt,{className:"sm:max-w-[720px]",children:[e.jsxs(nt,{children:[e.jsx(ot,{children:o?"Edit Sales Record":"Add New Sales Record"}),e.jsx(ct,{children:"Enter sales record details below."})]}),e.jsxs("form",{onSubmit:se,children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 py-4",children:[e.jsxs("div",{children:[e.jsx($,{htmlFor:"date",children:"Date *"}),e.jsx(G,{id:"date",type:"date",value:p.dateString||"",onChange:b=>L(X=>({...X,dateString:b.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"channel",children:"Sales Channel *"}),e.jsxs(le,{value:p.sales_channel_id,onValueChange:b=>L(X=>({...X,sales_channel_id:b})),children:[e.jsx(ie,{id:"channel",children:e.jsx(ce,{placeholder:"Select Sales Channel"})}),e.jsx(oe,{children:I.map(b=>e.jsx(S,{value:b.$id,children:b.channel_name||b.$id},b.$id))})]})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"product",children:"Product *"}),e.jsxs(le,{value:p.product_id,onValueChange:b=>L(X=>({...X,product_id:b,sku:re.find(ye=>ye.$id===b)?.sku||X.sku})),children:[e.jsx(ie,{id:"product",children:e.jsx(ce,{placeholder:"Select Product"})}),e.jsx(oe,{children:re.map(b=>e.jsx(S,{value:b.$id,children:b.product||b.$id},b.$id))})]})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"sku",children:"SKU *"}),e.jsxs(le,{value:p.sku,onValueChange:b=>L(X=>({...X,sku:b})),children:[e.jsx(ie,{id:"sku",children:e.jsx(ce,{placeholder:"Select SKU"})}),e.jsx(oe,{children:re.filter(b=>b.sku).map(b=>e.jsx(S,{value:b.sku,children:b.sku},b.$id))})]})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"qty",children:"Quantity *"}),e.jsx(G,{id:"qty",type:"number",min:"1",value:p.sold_units,onChange:b=>L(X=>({...X,sold_units:Number(b.target.value),total_price:Number((Number(b.target.value)*X.unit_price).toFixed(2))})),required:!0})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"rate",children:"Rate *"}),e.jsx(G,{id:"rate",type:"number",step:"0.01",min:"0.01",value:p.unit_price,onChange:b=>L(X=>({...X,unit_price:Number(b.target.value),total_price:Number((X.sold_units*Number(b.target.value)).toFixed(2))})),required:!0})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"total",children:"Total Amount"}),e.jsx(G,{id:"total",type:"number",step:"0.01",value:Number((p.sold_units*p.unit_price).toFixed(2)),readOnly:!0,className:"bg-gray-100"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx($,{htmlFor:"notes",children:"Remarks"}),e.jsx(G,{id:"notes",type:"text",value:p.notes||"",onChange:b=>L(X=>({...X,notes:b.target.value}))})]})]}),e.jsx(it,{children:e.jsx(A,{type:"submit",disabled:U.isPending||h.isPending,children:U.isPending||h.isPending?e.jsxs(e.Fragment,{children:[e.jsx(ze,{className:"mr-2 h-4 w-4 animate-spin"}),"Savingâ€¦"]}):o?"Update Sales Record":"Add Sales Record"})})]})]})}),e.jsx(ae,{children:e.jsxs(ne,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",Nt+1," to ",Math.min(wt,xt)," of ",xt," records"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Records per page:"}),e.jsxs(le,{value:M.toString(),onValueChange:b=>z(Number(b)),children:[e.jsx(ie,{className:"w-[100px]",children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"50",children:"50"}),e.jsx(S,{value:"100",children:"100"}),e.jsx(S,{value:"500",children:"500"})]})]})]})]}),N.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 p-3 bg-muted rounded-md",children:[e.jsxs("span",{className:"text-sm font-medium",children:[N.length," selected"]}),e.jsx(A,{variant:"destructive",size:"sm",onClick:be,disabled:W.isPending,children:"Delete Selected"}),e.jsx(A,{variant:"outline",size:"sm",onClick:Fe,children:"Export Selected"})]}),e.jsx("div",{className:"border rounded-md",children:e.jsx("div",{className:"overflow-auto",style:{maxHeight:"600px"},children:e.jsx(us,{data:H(l.map(b=>((!b.date||b.date==="Invalid Date")&&console.warn("Invalid sales record date found:",{id:b.$id,date:b.date}),{...b,formattedDate:ga(b.date),channelName:I.find(X=>X.$id===b.sales_channel_id)?.channel_name||b.sales_channel_id,productName:re.find(X=>X.$id===b.product_id)?.product||b.product_id,totalAmount:Number((b.sold_units*b.unit_price).toFixed(2)),status:"Completed"}))),columns:[{key:"formattedDate",label:"Date",sortable:!0,dataType:"date"},{key:"channelName",label:"Sales Channel",sortable:!0,dataType:"string"},{key:"productName",label:"Product",sortable:!0,dataType:"string"},{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"sold_units",label:"Qty",sortable:!0,dataType:"number",align:"right",headerClassName:"bg-purple-50",cellClassName:"bg-purple-50 font-medium"},{key:"unit_price",label:"Rate",sortable:!0,dataType:"number",align:"right"},{key:"totalAmount",label:"Total Amount",sortable:!0,dataType:"number",align:"right",headerClassName:"bg-green-50",cellClassName:"bg-green-50 font-medium"},{key:"status",label:"Status",sortable:!0,dataType:"string",formatter:b=>e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${b==="Completed"?"bg-green-100 text-green-800":b==="In Progress"?"bg-yellow-100 text-yellow-800":b==="Pending"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:b})},{key:"notes",label:"Remarks",sortable:!0,dataType:"string"}],onSort:_,currentSort:Y,loading:de,maxHeight:"none",stickyHeader:!0,bordered:!1,searchable:!1,rowKey:"$id",selectable:!0,selectedRows:N,onSelectionChange:g,actions:[{label:"Edit",onClick:xe,variant:"default"},{label:"Delete",onClick:b=>he(b.$id),variant:"destructive"}],emptyMessage:"No sales records found"})})}),gt>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx(A,{variant:"outline",size:"sm",onClick:()=>Z(b=>Math.max(1,b-1)),disabled:O===1,children:"Previous"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",O," of ",gt]})}),e.jsx(A,{variant:"outline",size:"sm",onClick:()=>Z(b=>Math.min(gt,b+1)),disabled:O===gt,children:"Next"})]})]})})]})]})})}const zl=()=>{const r=Oa(),t=[{title:"Stocks",description:"Manage inventory and stock levels",icon:Rs,path:"/master/stocks",color:"text-blue-600"},{title:"Vendors",description:"Manage supplier information",icon:Jr,path:"/master/vendors",color:"text-green-600"},{title:"Staff",description:"Manage employee records",icon:Xr,path:"/master/staff",color:"text-purple-600"},{title:"Processes",description:"Manage business processes",icon:$a,path:"/master/processes",color:"text-orange-600"},{title:"Raw Products",description:"Manage raw materials",icon:Aa,path:"/master/raw-products",color:"text-red-600"},{title:"Products",description:"Manage finished products",icon:Pi,path:"/master/products",color:"text-indigo-600"},{title:"Sales Channels",description:"Manage sales channels",icon:Di,path:"/master/sales-channels",color:"text-teal-600"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Master Data"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your core business data and configurations"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map(s=>{const a=s.icon;return e.jsxs(ae,{className:"hover:shadow-lg transition-shadow cursor-pointer",children:[e.jsxs(fe,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(a,{className:`h-6 w-6 ${s.color}`}),e.jsx(je,{className:"text-lg",children:s.title})]}),e.jsx(De,{children:s.description})]}),e.jsx(ne,{children:e.jsxs(A,{onClick:()=>r(s.path),className:"w-full",variant:"outline",children:["Manage ",s.title]})})]},s.title)})})]})},Ql=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Analytics"}),e.jsx("p",{className:"text-muted-foreground",children:"Business intelligence and performance analytics"})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(ae,{children:[e.jsx(fe,{children:e.jsxs(je,{className:"flex items-center gap-2",children:[e.jsx(Sa,{className:"h-5 w-5 text-primary"}),"Production Analytics"]})}),e.jsx(ne,{children:e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"Production performance charts"}),e.jsx("p",{className:"text-sm",children:"Database connection required"})]})})]}),e.jsxs(ae,{children:[e.jsx(fe,{children:e.jsxs(je,{className:"flex items-center gap-2",children:[e.jsx(zs,{className:"h-5 w-5 text-primary"}),"Sales Trends"]})}),e.jsx(ne,{children:e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"Sales performance analysis"}),e.jsx("p",{className:"text-sm",children:"Database connection required"})]})})]}),e.jsxs(ae,{children:[e.jsx(fe,{children:e.jsxs(je,{className:"flex items-center gap-2",children:[e.jsx(Ti,{className:"h-5 w-5 text-primary"}),"Inventory Distribution"]})}),e.jsx(ne,{children:e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"Stock distribution charts"}),e.jsx("p",{className:"text-sm",children:"Database connection required"})]})})]}),e.jsxs(ae,{children:[e.jsx(fe,{children:e.jsxs(je,{className:"flex items-center gap-2",children:[e.jsx(Ei,{className:"h-5 w-5 text-primary"}),"Efficiency Metrics"]})}),e.jsx(ne,{children:e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"Process efficiency analysis"}),e.jsx("p",{className:"text-sm",children:"Database connection required"})]})})]})]})]}),Yl=()=>{const r=ds();return u.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",r.pathname)},[r.pathname]),e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-gray-100",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"mb-4 text-4xl font-bold",children:"404"}),e.jsx("p",{className:"mb-4 text-xl text-gray-600",children:"Oops! Page not found"}),e.jsx("a",{href:"/",className:"text-blue-500 underline hover:text-blue-700",children:"Return to Home"})]})})},Wl=()=>{const[r,t]=u.useState(!1),[s,a]=u.useState(null),[n,i]=u.useState(""),[c,m]=u.useState([]),{toast:d}=Ie(),[o,f]=u.useState(50),N=mt(),{user:g}=jt(),{config:y}=Tt("stocks"),{validationRules:j,canImport:P}=Et("stocks"),{currentSort:x,handleSort:C,getSortedData:E}=rs(),[D,T]=u.useState({stock_code:"",stock_name:"",category:"",uom:"",min_level:"",status:"Active"}),{data:F=[],isLoading:K,error:O}=Ne({queryKey:["stocks"],queryFn:async()=>await Bt.getAll(),enabled:!!g}),Z=Re({mutationFn:async U=>{const{stock_code:h,stock_name:p,category:L,uom:k,min_level:W}=U,xe={stock_code:h,stock_name:p,category:L,uom:k,min_level:W},he=await Bt.create(xe);if(he&&he.$id)try{const be=new Date().toISOString().split("T")[0];await kn.create({stock_id:he.$id,opening_balance:0,purchases:0,used_in_production:0,status_date:be})}catch(be){console.error("Error creating stock status entry:",be)}return he},onSuccess:()=>{N.invalidateQueries({queryKey:["stocks"]}),N.invalidateQueries({queryKey:["stock_status"]}),d({title:"Success",description:"Stock created successfully"}),t(!1),a(null),H()},onError:U=>{d({title:"Error",description:"Failed to create stock",variant:"destructive"}),console.error("Error creating stock:",U)}}),M=Re({mutationFn:async({id:U,data:h})=>{const{stock_code:p,name:L,category:k,uom:W,min_level:xe}=h,he={stock_code:p,stock_name:L,category:k,uom:W,min_level:xe};return await Bt.update(U,he)},onSuccess:()=>{N.invalidateQueries({queryKey:["stocks"]}),N.invalidateQueries({queryKey:["stock_status"]}),d({title:"Success",description:"Stock updated successfully"}),t(!1),a(null),H()},onError:U=>{d({title:"Error",description:"Failed to update stock",variant:"destructive"}),console.error("Error updating stock:",U)}}),z=Re({mutationFn:U=>Bt.delete(U),onSuccess:()=>{N.invalidateQueries({queryKey:["stocks"]}),d({title:"Success",description:"Stock deleted successfully"})},onError:U=>{d({title:"Error",description:"Failed to delete stock",variant:"destructive"}),console.error("Error deleting stock:",U)}}),Q=async U=>{if(U.preventDefault(),!D.stock_code.trim()){d({title:"Error",description:"Stock Code is required",variant:"destructive"});return}if(!D.stock_name?.trim()){d({title:"Error",description:"Stock Name is required",variant:"destructive"});return}if(!D.category.trim()){d({title:"Error",description:"Category is required",variant:"destructive"});return}if(!D.uom.trim()){d({title:"Error",description:"UoM is required",variant:"destructive"});return}if(!D.min_level.trim()){d({title:"Error",description:"Min Level is required",variant:"destructive"});return}const h={...D,min_level:D.min_level?parseFloat(D.min_level):void 0};s?M.mutate({id:s.$id,data:h}):Z.mutate(h)},R=U=>{a(U),T({stock_code:U.stock_code,stock_name:U.stock_name||"",category:U.category||"",uom:U.uom||"",min_level:U.min_level?.toString()||"",status:U.status}),t(!0)},w=async U=>{await requestDeletion("stock",U.$id,U.stock_name,()=>z.mutate(U.$id))},Y=async()=>{if(c.length===0){d({title:"Error",description:"Please select stocks to delete",variant:"destructive"});return}if(window.confirm(`Are you sure you want to delete ${c.length} selected stock(s)?`))try{const U=c.length;await Promise.all(c.map(h=>new Promise((p,L)=>{z.mutate(h.$id,{onSuccess:p,onError:L})}))),m([]),d({title:"Success",description:`${U} stocks deleted successfully`})}catch(U){console.error("Error deleting stocks:",U),d({title:"Error",description:"Failed to delete selected stocks",variant:"destructive"})}},_=async()=>{if(c.length===0){d({title:"Error",description:"Please select stocks to export",variant:"destructive"});return}if(y)try{const U=c.map(h=>{const p={};return y.exportColumns.forEach(L=>{let k;switch(L.dataKey){case"name":case"stock_name":k=h.stock_name;break;case"sku":case"stock_code":k=h.stock_code;break;case"category":k=h.category||"";break;case"unit":case"uom":k=h.uom||"";break;case"openingBalance":case"min_level":k=h.min_level||0;break;default:k=h[L.dataKey]}p[L.exportHeader]=L.formatter?L.formatter(k):k}),p});await Qt.exportToXLSX({filename:"stocks-selected",headers:y.exportColumns.map(h=>h.exportHeader),data:U,format:"xlsx"}),d({title:"Success",description:`Exported ${c.length} selected stock(s) successfully`})}catch(U){console.error("Export error:",U),d({title:"Error",description:"Failed to export selected stocks",variant:"destructive"})}},H=()=>{T({stock_code:"",stock_name:"",category:"",uom:"",min_level:"",status:"Active"})},re=()=>{a(null),H(),t(!0)},I=F.filter(U=>U.stock_name.toLowerCase().includes(n.toLowerCase())||U.stock_code.toLowerCase().includes(n.toLowerCase())||U.category.toLowerCase().includes(n.toLowerCase())),ee=E(I),V=ee.length,de=ee.slice(0,o);return O?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("p",{className:"text-red-500",children:["Error loading stocks: ",O.message]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Stocks"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage raw materials and stock items"})]}),e.jsxs(lt,{open:r,onOpenChange:t,children:[e.jsx(ys,{asChild:!0,children:e.jsxs(A,{onClick:re,className:"bg-primary hover:bg-primary/90",children:[e.jsx(Ct,{className:"h-4 w-4 mr-2"}),"Add New Stock"]})}),e.jsxs(rt,{className:"sm:max-w-[425px]",children:[e.jsxs(nt,{children:[e.jsx(ot,{children:s?"Edit Stock":"Add New Stock"}),e.jsxs(ct,{children:[s?"Update stock information":"Enter stock details to add a new stock",e.jsxs("span",{className:"mt-2 text-sm text-muted-foreground",children:["Fields marked with ",e.jsx("span",{className:"text-red-500",children:"*"})," are required."]})]})]}),e.jsxs("form",{onSubmit:Q,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs($,{htmlFor:"stock_code",className:"text-right",children:["Stock Code ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(G,{id:"stock_code",value:D.stock_code,onChange:U=>T({...D,stock_code:U.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs($,{htmlFor:"stock_name",className:"text-right",children:["Stock Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(G,{id:"stock_name",value:D.stock_name,onChange:U=>T({...D,stock_name:U.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs($,{htmlFor:"category",className:"text-right",children:["Category ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(G,{id:"category",value:D.category,onChange:U=>T({...D,category:U.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs($,{htmlFor:"uom",className:"text-right",children:["UoM ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(le,{value:D.uom,onValueChange:U=>T({...D,uom:U}),children:[e.jsx(ie,{className:"col-span-3",children:e.jsx(ce,{placeholder:"Select unit of measure"})}),e.jsxs(oe,{children:[e.jsx(S,{value:"kg",children:"kg"}),e.jsx(S,{value:"g",children:"g"}),e.jsx(S,{value:"ltr",children:"ltr"}),e.jsx(S,{value:"ml",children:"ml"}),e.jsx(S,{value:"pcs",children:"pcs"}),e.jsx(S,{value:"bags",children:"bags"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs($,{htmlFor:"min_level",className:"text-right",children:["Min Level ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(G,{id:"min_level",type:"number",step:"0.01",value:D.min_level,onChange:U=>T({...D,min_level:U.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx($,{htmlFor:"status",className:"text-right",children:"Status"}),e.jsxs(le,{value:D.status,onValueChange:U=>T({...D,status:U}),children:[e.jsx(ie,{className:"col-span-3",children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"Active",children:"Active"}),e.jsx(S,{value:"Inactive",children:"Inactive"})]})]})]})]}),e.jsx(it,{children:e.jsx(A,{type:"submit",disabled:Z.isPending||M.isPending,children:Z.isPending||M.isPending?"Saving...":s?"Update":"Create"})})]})]})]})]}),e.jsx(ae,{children:e.jsx(ne,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(pt,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(G,{placeholder:"Search stocks...",className:"pl-10",value:n,onChange:U=>i(U.target.value)})]}),e.jsxs(A,{variant:"outline",children:[e.jsx(ss,{className:"h-4 w-4 mr-2"}),"Filter"]}),P&&e.jsx(qt,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:["Stock Name","SKU","Unit"],optionalColumns:["Category","Opening Balance"],validationRules:j,onImportComplete:U=>{U.successfulRows>0&&(N.invalidateQueries({queryKey:["stocks"]}),d({title:"Import Successful",description:`${U.successfulRows} stocks imported successfully.`}))}},variant:"outline"}),y&&e.jsx(Rt,{data:I.map(U=>({name:U.stock_name,sku:U.stock_code,category:U.category,unit:U.uom,openingBalance:U.min_level||0,createdAt:U.$createdAt})),headers:y.exportColumns.map(U=>U.exportHeader),filename:"stocks",variant:"outline"})]})})}),e.jsxs(ae,{children:[e.jsx(fe,{children:e.jsxs(je,{children:["Stock Items (",I.length,")"]})}),e.jsxs(ne,{children:[c.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 p-3 bg-muted rounded-md",children:[e.jsxs("span",{className:"text-sm font-medium",children:[c.length," selected"]}),e.jsx(A,{variant:"destructive",size:"sm",onClick:Y,disabled:z.isPending,children:"Delete Selected"}),e.jsx(A,{variant:"outline",size:"sm",onClick:_,children:"Export Selected"})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",Math.min(de.length,V)," of ",V," records"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Records per page:"}),e.jsxs(le,{value:o.toString(),onValueChange:U=>f(Number(U)),children:[e.jsx(ie,{className:"w-[100px]",children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"50",children:"50"}),e.jsx(S,{value:"100",children:"100"}),e.jsx(S,{value:"500",children:"500"})]})]})]})]}),e.jsx("div",{className:"border rounded-md overflow-auto",style:{maxHeight:"70vh"},children:e.jsx(us,{maxHeight:"none",selectable:!0,selectedRows:c,onSelectionChange:m,rowKey:"$id",data:de.map(U=>({...U,stock_code:U.stock_code||"",stock_name:U.stock_name||"",category:U.category||"-",uom:U.uom||"-",min_level:U.min_level||0,status:U.status||"Active"})),columns:[{key:"stock_code",label:"Stock Code",sortable:!0,dataType:"string"},{key:"stock_name",label:"Stock Name",sortable:!0,dataType:"string"},{key:"category",label:"Category",sortable:!0,dataType:"string"},{key:"uom",label:"UoM",sortable:!0,dataType:"string"},{key:"min_level",label:"Min Level",sortable:!0,dataType:"number",align:"right"},{key:"status",label:"Status",sortable:!0,dataType:"string"}],onSort:C,currentSort:x,loading:K,emptyMessage:"No stocks found",actions:[{label:"Edit",icon:e.jsx(as,{className:"h-4 w-4"}),onClick:R},{label:"Delete",icon:e.jsx(It,{className:"h-4 w-4"}),onClick:U=>w(U),variant:"destructive"}]})})]})]})]})},ns=u.forwardRef(({className:r,...t},s)=>e.jsx("textarea",{className:me("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:s,...t}));ns.displayName="Textarea";const Gl=()=>{const[r,t]=u.useState(""),[s,a]=u.useState("all"),[n,i]=u.useState(!1),[c,m]=u.useState(null),[d,o]=u.useState([]),[f,N]=u.useState(50),[g,y]=u.useState({vendor_name:"",contact_person:"",phone:"",email:"",address:"",gstin:"",status:"Active"}),{toast:j}=Ie(),P=mt(),{config:x}=Tt("vendors"),{validationRules:C,canImport:E}=Et("vendors"),{data:D=[],isLoading:T,error:F}=Ne({queryKey:["vendors"],queryFn:async()=>await Ms.getAll()}),K=Re({mutationFn:h=>{const{vendor_name:p,contact_person:L,phone:k,email:W,address:xe,gstin:he}=h,be={vendor_name:p,contact_person:L||"",phone:k||"",address:xe||"",gstin:he||""};return W&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(W)&&(be.email=W),Ms.create(be)},onSuccess:()=>{P.invalidateQueries({queryKey:["vendors"]}),j({title:"Success",description:"Vendor created successfully"}),i(!1),M()},onError:h=>{j({title:"Error",description:"Failed to create vendor",variant:"destructive"}),console.error("Error creating vendor:",h)}}),O=Re({mutationFn:({id:h,data:p})=>{const{vendor_name:L,contact_person:k,phone:W,email:xe,address:he,gstin:be}=p,Fe={vendor_name:L,contact_person:k||"",phone:W||"",address:he||"",gstin:be||""};return xe&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(xe)&&(Fe.email=xe),Ms.update(h,Fe)},onSuccess:()=>{P.invalidateQueries({queryKey:["vendors"]}),j({title:"Success",description:"Vendor updated successfully"}),i(!1),M()},onError:h=>{j({title:"Error",description:"Failed to update vendor",variant:"destructive"}),console.error("Error updating vendor:",h)}}),Z=Re({mutationFn:h=>Ms.delete(h),onSuccess:()=>{P.invalidateQueries({queryKey:["vendors"]}),j({title:"Success",description:"Vendor deleted successfully"})},onError:h=>{j({title:"Error",description:"Failed to delete vendor",variant:"destructive"}),console.error("Error deleting vendor:",h)}}),M=()=>{y({vendor_name:"",contact_person:"",phone:"",email:"",address:"",gstin:"",status:"Active"}),m(null)},z=h=>{if(h.preventDefault(),!g.vendor_name.trim()){j({title:"Error",description:"Vendor Name is required",variant:"destructive"});return}if(!g.contact_person.trim()){j({title:"Error",description:"Contact Person is required",variant:"destructive"});return}if(g.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(g.email)){j({title:"Error",description:"Please enter a valid email address",variant:"destructive"});return}c?O.mutate({id:c.$id,data:g}):K.mutate(g)},Q=h=>{m(h),y({vendor_name:h.vendor_name,contact_person:h.contact_person||"",phone:h.phone||"",email:h.email||"",address:h.address||"",gstin:h.gstin||"",status:h.status}),i(!0)},R=h=>{confirm("Are you sure you want to delete this vendor?")&&Z.mutate(h)},w=async()=>{if(d.length===0){j({title:"Error",description:"Please select vendors to delete",variant:"destructive"});return}if(window.confirm(`Are you sure you want to delete ${d.length} selected vendor(s)?`))try{const h=d.length;await Promise.all(d.map(p=>new Promise((L,k)=>{Z.mutate(p.$id,{onSuccess:L,onError:k})}))),o([]),j({title:"Success",description:`${h} vendors deleted successfully`})}catch(h){console.error("Error deleting vendors:",h),j({title:"Error",description:"Failed to delete selected vendors",variant:"destructive"})}},Y=async()=>{if(d.length===0){j({title:"Error",description:"Please select vendors to export",variant:"destructive"});return}if(x)try{const h=d.map(p=>{const L={};return x.exportColumns.forEach(k=>{let W;switch(k.dataKey){case"name":case"vendor_name":W=p.vendor_name;break;case"contact_person":W=p.contact_person||"";break;case"phone":W=p.phone||"";break;case"email":W=p.email||"";break;case"address":W=p.address||"";break;case"gstin":W=p.gstin||"";break;case"status":W=p.status;break;default:W=p[k.dataKey]}L[k.exportHeader]=k.formatter?k.formatter(W):W}),L});await Qt.exportToXLSX({filename:"vendors-selected",headers:x.exportColumns.map(p=>p.exportHeader),data:h,format:"xlsx"}),j({title:"Success",description:`Exported ${d.length} selected vendor(s) successfully`})}catch(h){console.error("Export error:",h),j({title:"Error",description:"Failed to export selected vendors",variant:"destructive"})}},_=()=>{m(null),M(),i(!0)},H=D.filter(h=>{const p=h.vendor_name.toLowerCase().includes(r.toLowerCase())||h.contact_person?.toLowerCase().includes(r.toLowerCase())||h.email?.toLowerCase().includes(r.toLowerCase()),L=s==="all"||h.status===s;return p&&L}),re=H.length,I=H.slice(0,f),ee=(h,p)=>{o(p?[...d,h]:d.filter(L=>L.$id!==h.$id))},V=h=>{o(h?[...I]:[])},de=I.length>0&&I.every(h=>d.some(p=>p.$id===h.$id)),U=d.length>0&&!de;return F?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("p",{className:"text-red-500",children:["Error loading vendors: ",F.message]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Vendors"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage vendor information and relationships"})]}),e.jsxs(lt,{open:n,onOpenChange:i,children:[e.jsx(ys,{asChild:!0,children:e.jsxs(A,{onClick:_,className:"bg-primary hover:bg-primary/90",children:[e.jsx(Ct,{className:"h-4 w-4 mr-2"}),"Add New Vendor"]})}),e.jsxs(rt,{className:"sm:max-w-[500px]",children:[e.jsxs(nt,{children:[e.jsx(ot,{children:c?"Edit Vendor":"Add New Vendor"}),e.jsxs(ct,{children:[c?"Update vendor information":"Enter vendor details to add a new vendor",e.jsxs("p",{className:"mt-2 text-sm text-muted-foreground",children:["Fields marked with ",e.jsx("span",{className:"text-red-500",children:"*"})," are required."]})]})]}),e.jsxs("form",{onSubmit:z,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs($,{htmlFor:"vendor_name",className:"text-right",children:["Vendor Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(G,{id:"vendor_name",value:g.vendor_name,onChange:h=>y({...g,vendor_name:h.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs($,{htmlFor:"contact_person",className:"text-right",children:["Contact Person ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(G,{id:"contact_person",value:g.contact_person,onChange:h=>y({...g,contact_person:h.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx($,{htmlFor:"phone",className:"text-right",children:"Phone"}),e.jsx(G,{id:"phone",value:g.phone,onChange:h=>y({...g,phone:h.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx($,{htmlFor:"email",className:"text-right",children:"Email"}),e.jsx(G,{id:"email",type:"email",value:g.email,onChange:h=>y({...g,email:h.target.value}),className:"col-span-3",placeholder:"Optional"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx($,{htmlFor:"address",className:"text-right",children:"Address"}),e.jsx(ns,{id:"address",value:g.address,onChange:h=>y({...g,address:h.target.value}),className:"col-span-3",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx($,{htmlFor:"gstin",className:"text-right",children:"GSTIN"}),e.jsx(G,{id:"gstin",value:g.gstin,onChange:h=>y({...g,gstin:h.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx($,{htmlFor:"status",className:"text-right",children:"Status"}),e.jsxs(le,{value:g.status,onValueChange:h=>y({...g,status:h}),children:[e.jsx(ie,{className:"col-span-3",children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"Active",children:"Active"}),e.jsx(S,{value:"Inactive",children:"Inactive"})]})]})]})]}),e.jsx(it,{children:e.jsx(A,{type:"submit",children:c?"Update":"Create"})})]})]})]})]}),e.jsx(ae,{children:e.jsx(ne,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(pt,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(G,{placeholder:"Search vendors...",className:"pl-10",value:r,onChange:h=>t(h.target.value)})]}),e.jsxs(A,{variant:"outline",children:[e.jsx(ss,{className:"h-4 w-4 mr-2"}),"Filter"]}),E&&e.jsx(qt,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:["Vendor Name"],optionalColumns:["Email","Phone","Contact Person","Address"],validationRules:C,onImportComplete:h=>{h.successfulRows>0&&(P.invalidateQueries({queryKey:["vendors"]}),j({title:"Import Successful",description:`${h.successfulRows} vendors imported successfully.`}))}},variant:"outline"}),x&&e.jsx(Rt,{data:H.map(h=>({name:h.vendor_name,email:h.email||"",phone:h.phone||"",contactPerson:h.contact_person||"",address:h.address||"",isActive:h.status==="Active",createdAt:h.$createdAt})),headers:x.exportColumns.map(h=>h.exportHeader),filename:"vendors",variant:"outline"})]})})}),e.jsxs(ae,{children:[e.jsx(fe,{children:e.jsxs(je,{children:["Vendors (",H.length,")"]})}),e.jsxs(ne,{children:[d.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 p-3 bg-muted rounded-md",children:[e.jsxs("span",{className:"text-sm font-medium",children:[d.length," selected"]}),e.jsx(A,{variant:"destructive",size:"sm",onClick:w,disabled:Z.isPending,children:"Delete Selected"}),e.jsx(A,{variant:"outline",size:"sm",onClick:Y,children:"Export Selected"})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",Math.min(I.length,re)," of ",re," records"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Records per page:"}),e.jsxs(le,{value:f.toString(),onValueChange:h=>N(Number(h)),children:[e.jsx(ie,{className:"w-[100px]",children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"50",children:"50"}),e.jsx(S,{value:"100",children:"100"}),e.jsx(S,{value:"500",children:"500"})]})]})]})]}),T?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:e.jsx("span",{children:"Loading vendors..."})}):H.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("p",{className:"text-lg mb-2",children:"No vendors found"}),e.jsx("p",{className:"text-sm",children:"Add your first vendor to get started"})]}):e.jsx("div",{className:"border rounded-md overflow-auto",style:{maxHeight:"70vh"},children:e.jsxs(yt,{children:[e.jsx(vt,{children:e.jsxs(qe,{children:[e.jsx(te,{className:"w-12",children:e.jsx("input",{type:"checkbox",checked:de,ref:h=>{h&&(h.indeterminate=U)},onChange:h=>V(h.target.checked),className:"rounded border-gray-300"})}),e.jsx(te,{children:"Vendor Name"}),e.jsx(te,{children:"Contact Person"}),e.jsx(te,{children:"Phone"}),e.jsx(te,{children:"Email"}),e.jsx(te,{children:"Address"}),e.jsx(te,{children:"GSTIN"}),e.jsx(te,{children:"Status"}),e.jsx(te,{children:"Actions"})]})}),e.jsx(bt,{children:I.map(h=>{const p=d.some(L=>L.$id===h.$id);return e.jsxs(qe,{children:[e.jsx(J,{children:e.jsx("input",{type:"checkbox",checked:p,onChange:L=>ee(h,L.target.checked),className:"rounded border-gray-300"})}),e.jsx(J,{className:"font-medium",children:h.vendor_name}),e.jsx(J,{children:h.contact_person||"-"}),e.jsx(J,{children:h.phone||"-"}),e.jsx(J,{children:h.email||"-"}),e.jsx(J,{className:"max-w-xs truncate",children:h.address||"-"}),e.jsx(J,{children:h.gstin||"-"}),e.jsx(J,{children:e.jsx(We,{variant:h.status==="Active"?"default":"secondary",children:h.status})}),e.jsx(J,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(A,{variant:"outline",size:"sm",onClick:()=>Q(h),children:e.jsx(as,{className:"h-4 w-4"})}),e.jsx(A,{variant:"outline",size:"sm",onClick:()=>R(h.$id),children:e.jsx(It,{className:"h-4 w-4"})})]})})]},h.$id)})})]})})]})]})]})},Jl=()=>{const[r,t]=u.useState(""),[s,a]=u.useState("all"),[n,i]=u.useState(!1),[c,m]=u.useState(null),[d,o]=u.useState([]),[f,N]=u.useState(50),[g,y]=u.useState({staff_code:"",staff_name:"",role:"",department:"",email:"",phone:"",joining_date:"",status:"Active"}),{toast:j}=Ie(),P=mt(),{config:x}=Tt("staff"),{validationRules:C,canImport:E}=Et("staff"),{getSortedData:D}=rs(),T={async getAll(){return(await st.listDocuments(at,ke.STAFF)).documents},async create(k){return await st.createDocument(at,ke.STAFF,hs.unique(),k)},async update(k,W){return await st.updateDocument(at,ke.STAFF,k,W)},async delete(k){return await st.deleteDocument(at,ke.STAFF,k)}},{data:F=[],isLoading:K,error:O}=Ne({queryKey:["staff"],queryFn:async()=>await T.getAll()}),Z=Re({mutationFn:k=>{const{staff_code:W,staff_name:xe,role:he,department:be,phone:Fe,email:Me}=k,He={staff_code:W,staff_name:xe,role:he,department:be,phone:Fe||"",email:Me||""};return T.create(He)},onSuccess:()=>{P.invalidateQueries({queryKey:["staff"]}),j({title:"Success",description:"Staff member created successfully"}),i(!1),Q()},onError:k=>{j({title:"Error",description:"Failed to create staff member",variant:"destructive"}),console.error("Error creating staff:",k)}}),M=Re({mutationFn:({id:k,data:W})=>{const{staff_code:xe,staff_name:he,role:be,department:Fe,phone:Me,email:He}=W,ht={staff_code:xe,staff_name:he,role:be,department:Fe,phone:Me||"",email:He||""};return T.update(k,ht)},onSuccess:()=>{P.invalidateQueries({queryKey:["staff"]}),j({title:"Success",description:"Staff member updated successfully"}),i(!1),Q()},onError:k=>{j({title:"Error",description:"Failed to update staff member",variant:"destructive"}),console.error("Error updating staff:",k)}}),z=Re({mutationFn:k=>T.delete(k),onSuccess:()=>{P.invalidateQueries({queryKey:["staff"]}),j({title:"Success",description:"Staff member deleted successfully"})},onError:k=>{j({title:"Error",description:"Failed to delete staff member",variant:"destructive"}),console.error("Error deleting staff:",k)}}),Q=()=>{y({staff_code:"",staff_name:"",role:"",department:"",email:"",phone:"",joining_date:"",status:"Active"}),m(null)},R=k=>{if(k.preventDefault(),!g.staff_code.trim()){j({title:"Error",description:"Staff Code is required",variant:"destructive"});return}if(!g.staff_name.trim()){j({title:"Error",description:"Staff Name is required",variant:"destructive"});return}if(!g.role.trim()){j({title:"Error",description:"Role is required",variant:"destructive"});return}if(!g.department.trim()){j({title:"Error",description:"Department is required",variant:"destructive"});return}if(g.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(g.email)){j({title:"Error",description:"Please enter a valid email address",variant:"destructive"});return}c?M.mutate({id:c.$id,data:g}):Z.mutate(g)},w=k=>{m(k),y({staff_code:k.staff_code,staff_name:k.staff_name,role:k.role,department:k.department||"",email:k.email||"",phone:k.phone||"",joining_date:k.joining_date||"",status:k.status}),i(!0)},Y=k=>{confirm("Are you sure you want to delete this staff member?")&&z.mutate(k)},_=async()=>{if(d.length===0){j({title:"Error",description:"Please select staff to delete",variant:"destructive"});return}if(window.confirm(`Are you sure you want to delete ${d.length} selected staff member(s)?`))try{const k=d.length;await Promise.all(d.map(W=>new Promise((xe,he)=>{z.mutate(W.$id,{onSuccess:xe,onError:he})}))),o([]),j({title:"Success",description:`${k} staff members deleted successfully`})}catch(k){console.error("Error deleting staff:",k),j({title:"Error",description:"Failed to delete selected staff",variant:"destructive"})}},H=async()=>{if(d.length===0){j({title:"Error",description:"Please select staff to export",variant:"destructive"});return}if(x)try{const k=d.map(W=>{const xe={};return x.exportColumns.forEach(he=>{let be;switch(he.dataKey){case"name":case"staff_name":be=W.staff_name;break;case"email":be=W.email||"";break;case"phone":be=W.phone||"";break;case"role":be=W.role;break;case"department":be=W.department||"";break;case"isActive":be=W.status==="Active";break;default:be=W[he.dataKey]}xe[he.exportHeader]=he.formatter?he.formatter(be):be}),xe});await Qt.exportToXLSX({filename:"staff-selected",headers:x.exportColumns.map(W=>W.exportHeader),data:k,format:"xlsx"}),j({title:"Success",description:`Exported ${d.length} selected staff member(s) successfully`})}catch(k){console.error("Export error:",k),j({title:"Error",description:"Failed to export selected staff",variant:"destructive"})}},re=()=>{m(null),Q(),i(!0)},I=F.filter(k=>{const W=k.staff_name.toLowerCase().includes(r.toLowerCase())||k.staff_code.toLowerCase().includes(r.toLowerCase())||k.role.toLowerCase().includes(r.toLowerCase())||k.department?.toLowerCase().includes(r.toLowerCase()),xe=s==="all"||k.status===s;return W&&xe}),ee=D(I),V=ee.length,de=ee.slice(0,f),U=(k,W)=>{o(W?[...d,k]:d.filter(xe=>xe.$id!==k.$id))},h=k=>{o(k?[...de]:[])},p=de.length>0&&de.every(k=>d.some(W=>W.$id===k.$id)),L=d.length>0&&!p;return O?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("p",{className:"text-red-500",children:["Error loading staff: ",O.message]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Staff"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage employee data and roles"})]}),e.jsxs(lt,{open:n,onOpenChange:i,children:[e.jsx(ys,{asChild:!0,children:e.jsxs(A,{onClick:re,className:"bg-primary hover:bg-primary/90",children:[e.jsx(Ct,{className:"h-4 w-4 mr-2"}),"Add New Staff"]})}),e.jsxs(rt,{className:"sm:max-w-[500px]",children:[e.jsxs(nt,{children:[e.jsx(ot,{children:c?"Edit Staff":"Add New Staff"}),e.jsxs(ct,{children:[c?"Update staff information":"Enter staff details to add a new employee",e.jsxs("p",{className:"mt-2 text-sm text-muted-foreground",children:["Fields marked with ",e.jsx("span",{className:"text-red-500",children:"*"})," are required."]})]})]}),e.jsxs("form",{onSubmit:R,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs($,{htmlFor:"staff_code",className:"text-right",children:["Staff Code ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(G,{id:"staff_code",value:g.staff_code,onChange:k=>y({...g,staff_code:k.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs($,{htmlFor:"staff_name",className:"text-right",children:["Staff Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(G,{id:"staff_name",value:g.staff_name,onChange:k=>y({...g,staff_name:k.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs($,{htmlFor:"role",className:"text-right",children:["Role ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(le,{value:g.role,onValueChange:k=>y({...g,role:k}),children:[e.jsx(ie,{className:"col-span-3",children:e.jsx(ce,{placeholder:"Select role"})}),e.jsxs(oe,{children:[e.jsx(S,{value:"Manager",children:"Manager"}),e.jsx(S,{value:"Supervisor",children:"Supervisor"}),e.jsx(S,{value:"Operator",children:"Operator"}),e.jsx(S,{value:"Quality Controller",children:"Quality Controller"}),e.jsx(S,{value:"Warehouse Staff",children:"Warehouse Staff"}),e.jsx(S,{value:"Admin",children:"Admin"}),e.jsx(S,{value:"Accountant",children:"Accountant"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs($,{htmlFor:"department",className:"text-right",children:["Department ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(le,{value:g.department,onValueChange:k=>y({...g,department:k}),children:[e.jsx(ie,{className:"col-span-3",children:e.jsx(ce,{placeholder:"Select department"})}),e.jsxs(oe,{children:[e.jsx(S,{value:"Production",children:"Production"}),e.jsx(S,{value:"Quality Control",children:"Quality Control"}),e.jsx(S,{value:"Warehouse",children:"Warehouse"}),e.jsx(S,{value:"Administration",children:"Administration"}),e.jsx(S,{value:"Accounts",children:"Accounts"}),e.jsx(S,{value:"Sales",children:"Sales"}),e.jsx(S,{value:"Purchase",children:"Purchase"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx($,{htmlFor:"email",className:"text-right",children:"Email"}),e.jsx(G,{id:"email",type:"email",value:g.email,onChange:k=>y({...g,email:k.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx($,{htmlFor:"phone",className:"text-right",children:"Phone"}),e.jsx(G,{id:"phone",value:g.phone,onChange:k=>y({...g,phone:k.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx($,{htmlFor:"joining_date",className:"text-right",children:"Joining Date"}),e.jsx(G,{id:"joining_date",type:"date",value:g.joining_date,onChange:k=>y({...g,joining_date:k.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx($,{htmlFor:"status",className:"text-right",children:"Status"}),e.jsxs(le,{value:g.status,onValueChange:k=>y({...g,status:k}),children:[e.jsx(ie,{className:"col-span-3",children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"Active",children:"Active"}),e.jsx(S,{value:"Inactive",children:"Inactive"})]})]})]})]}),e.jsx(it,{children:e.jsx(A,{type:"submit",children:c?"Update":"Create"})})]})]})]})]}),e.jsx(ae,{children:e.jsx(ne,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(pt,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(G,{placeholder:"Search staff...",className:"pl-10",value:r,onChange:k=>t(k.target.value)})]}),e.jsxs(A,{variant:"outline",children:[e.jsx(ss,{className:"h-4 w-4 mr-2"}),"Filter"]}),E&&e.jsx(qt,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:["Staff Name","Email","Role"],optionalColumns:["Phone","Department"],validationRules:C,onImportComplete:k=>{k.successfulRows>0&&(P.invalidateQueries({queryKey:["staff"]}),j({title:"Import Successful",description:`${k.successfulRows} staff members imported successfully.`}))}},variant:"outline"}),x&&e.jsx(Rt,{data:I.map(k=>({name:k.staff_name,email:k.email||"",phone:k.phone||"",role:k.role,department:k.department||"",isActive:k.status==="Active",createdAt:k.$createdAt})),headers:x.exportColumns.map(k=>k.exportHeader),filename:"staff",variant:"outline"})]})})}),e.jsxs(ae,{children:[e.jsx(fe,{children:e.jsxs(je,{children:["Staff Members (",I.length,")"]})}),e.jsxs(ne,{children:[d.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 p-3 bg-muted rounded-md",children:[e.jsxs("span",{className:"text-sm font-medium",children:[d.length," selected"]}),e.jsx(A,{variant:"destructive",size:"sm",onClick:_,disabled:z.isPending,children:"Delete Selected"}),e.jsx(A,{variant:"outline",size:"sm",onClick:H,children:"Export Selected"})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",Math.min(de.length,V)," of ",V," records"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Records per page:"}),e.jsxs(le,{value:f.toString(),onValueChange:k=>N(Number(k)),children:[e.jsx(ie,{className:"w-[100px]",children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"50",children:"50"}),e.jsx(S,{value:"100",children:"100"}),e.jsx(S,{value:"500",children:"500"})]})]})]})]}),K?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:e.jsx("span",{children:"Loading staff..."})}):I.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("p",{className:"text-lg mb-2",children:"No staff found"}),e.jsx("p",{className:"text-sm",children:"Add your first staff member to get started"})]}):e.jsx("div",{className:"border rounded-md overflow-auto",style:{maxHeight:"70vh"},children:e.jsxs(yt,{children:[e.jsx(vt,{children:e.jsxs(qe,{children:[e.jsx(te,{className:"w-12",children:e.jsx("input",{type:"checkbox",checked:p,ref:k=>{k&&(k.indeterminate=L)},onChange:k=>h(k.target.checked),className:"rounded border-gray-300"})}),e.jsx(te,{children:"Staff Code"}),e.jsx(te,{children:"Staff Name"}),e.jsx(te,{children:"Role"}),e.jsx(te,{children:"Department"}),e.jsx(te,{children:"Email"}),e.jsx(te,{children:"Phone"}),e.jsx(te,{children:"Joining Date"}),e.jsx(te,{children:"Status"}),e.jsx(te,{children:"Actions"})]})}),e.jsx(bt,{children:de.map(k=>{const W=d.some(xe=>xe.$id===k.$id);return e.jsxs(qe,{children:[e.jsx(J,{children:e.jsx("input",{type:"checkbox",checked:W,onChange:xe=>U(k,xe.target.checked),className:"rounded border-gray-300"})}),e.jsx(J,{className:"font-medium",children:k.staff_code}),e.jsx(J,{children:k.staff_name}),e.jsx(J,{children:k.role}),e.jsx(J,{children:k.department||"-"}),e.jsx(J,{children:k.email||"-"}),e.jsx(J,{children:k.phone||"-"}),e.jsx(J,{children:k.joining_date?new Date(k.joining_date).toLocaleDateString("en-GB"):"-"}),e.jsx(J,{children:e.jsx(We,{variant:k.status==="Active"?"default":"secondary",children:k.status})}),e.jsx(J,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(A,{variant:"outline",size:"sm",onClick:()=>w(k),children:e.jsx(as,{className:"h-4 w-4"})}),e.jsx(A,{variant:"outline",size:"sm",onClick:()=>Y(k.$id),children:e.jsx(It,{className:"h-4 w-4"})})]})})]},k.$id)})})]})})]})]})]})},Xl=()=>{const[r,t]=u.useState(""),[s,a]=u.useState("all"),[n,i]=u.useState(!1),[c,m]=u.useState(null),[d,o]=u.useState([]),[f,N]=u.useState(50),[g,y]=u.useState({name:"",department:"",description:"",status:"Active"}),{toast:j}=Ie(),P=mt(),{config:x}=Tt("processes"),{validationRules:C,canImport:E}=Et("processes"),D={async getAll(){return(await st.listDocuments(at,ke.PROCESSES)).documents},async create(p){return await st.createDocument(at,ke.PROCESSES,hs.unique(),p)},async update(p,L){return await st.updateDocument(at,ke.PROCESSES,p,L)},async delete(p){return await st.deleteDocument(at,ke.PROCESSES,p)}},{data:T=[],isLoading:F,error:K}=Ne({queryKey:["processes"],queryFn:async()=>await D.getAll()}),O=Re({mutationFn:p=>{const{name:L,department:k}=p,W={process_name:L,department:k};return D.create(W)},onSuccess:()=>{P.invalidateQueries({queryKey:["processes"]}),j({title:"Success",description:"Process created successfully"}),i(!1),z()},onError:p=>{j({title:"Error",description:"Failed to create process",variant:"destructive"}),console.error("Error creating process:",p)}}),Z=Re({mutationFn:({id:p,data:L})=>{const{name:k,department:W}=L,xe={process_name:k,department:W};return D.update(p,xe)},onSuccess:()=>{P.invalidateQueries({queryKey:["processes"]}),j({title:"Success",description:"Process updated successfully"}),i(!1),z()},onError:p=>{j({title:"Error",description:"Failed to update process",variant:"destructive"}),console.error("Error updating process:",p)}}),M=Re({mutationFn:p=>D.delete(p),onSuccess:()=>{P.invalidateQueries({queryKey:["processes"]}),j({title:"Success",description:"Process deleted successfully"})},onError:p=>{j({title:"Error",description:"Failed to delete process",variant:"destructive"}),console.error("Error deleting process:",p)}}),z=()=>{y({name:"",department:"",description:"",status:"Active"}),m(null)},Q=p=>{if(p.preventDefault(),!g.name?.trim()){j({title:"Error",description:"Process Name is required",variant:"destructive"});return}if(!g.department.trim()){j({title:"Error",description:"Department is required",variant:"destructive"});return}c?Z.mutate({id:c.$id,data:g}):O.mutate(g)},R=p=>{m(p),y({name:p.process_name,department:p.department||"",description:p.description||"",status:p.status}),i(!0)},w=p=>{confirm("Are you sure you want to delete this process?")&&M.mutate(p)},Y=async()=>{if(d.length===0){j({title:"Error",description:"Please select processes to delete",variant:"destructive"});return}if(window.confirm(`Are you sure you want to delete ${d.length} selected process(es)?`))try{const p=d.length;await Promise.all(d.map(L=>new Promise((k,W)=>{M.mutate(L.$id,{onSuccess:k,onError:W})}))),o([]),j({title:"Success",description:`${p} processes deleted successfully`})}catch(p){console.error("Error deleting processes:",p),j({title:"Error",description:"Failed to delete selected processes",variant:"destructive"})}},_=async()=>{if(d.length===0){j({title:"Error",description:"Please select processes to export",variant:"destructive"});return}if(x)try{const p=d.map(L=>{const k={};return x.exportColumns.forEach(W=>{let xe;switch(W.dataKey){case"name":case"process_name":xe=L.process_name;break;case"description":xe=L.description||"";break;case"estimatedTime":xe=0;break;case"isActive":xe=L.status==="Active";break;default:xe=L[W.dataKey]}k[W.exportHeader]=W.formatter?W.formatter(xe):xe}),k});await Qt.exportToXLSX({filename:"processes-selected",headers:x.exportColumns.map(L=>L.exportHeader),data:p,format:"xlsx"}),j({title:"Success",description:`Exported ${d.length} selected process(es) successfully`})}catch(p){console.error("Export error:",p),j({title:"Error",description:"Failed to export selected processes",variant:"destructive"})}},H=()=>{m(null),z(),i(!0)},re=T.filter(p=>(p.process_name.toLowerCase().includes(r.toLowerCase())||p.department?.toLowerCase().includes(r.toLowerCase())||p.description?.toLowerCase().includes(r.toLowerCase()))&&(s==="all"||p.status===s)),I=re.length,ee=re.slice(0,f),V=(p,L)=>{o(L?[...d,p]:d.filter(k=>k.$id!==p.$id))},de=p=>{o(p?[...ee]:[])},U=ee.length>0&&ee.every(p=>d.some(L=>L.$id===p.$id)),h=d.length>0&&!U;return K?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("p",{className:"text-red-500",children:["Error loading processes: ",K.message]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Processes"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage manufacturing and operational processes"})]}),e.jsxs(lt,{open:n,onOpenChange:i,children:[e.jsx(ys,{asChild:!0,children:e.jsxs(A,{onClick:H,className:"bg-primary hover:bg-primary/90",children:[e.jsx(Ct,{className:"h-4 w-4 mr-2"}),"Add New Process"]})}),e.jsxs(rt,{className:"sm:max-w-[500px]",children:[e.jsxs(nt,{children:[e.jsx(ot,{children:c?"Edit Process":"Add New Process"}),e.jsxs(ct,{children:[c?"Update process information":"Enter process details to add a new process",e.jsxs("span",{className:"mt-2 text-sm text-muted-foreground",children:["Fields marked with ",e.jsx("span",{className:"text-red-500",children:"*"})," are required."]})]})]}),e.jsxs("form",{onSubmit:Q,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs($,{htmlFor:"name",className:"text-right",children:["Process Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(G,{id:"name",value:g.name,onChange:p=>y({...g,name:p.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs($,{htmlFor:"department",className:"text-right",children:["Department ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(le,{value:g.department||"",onValueChange:p=>y({...g,department:p}),children:[e.jsx(ie,{className:"col-span-3",children:e.jsx(ce,{placeholder:"Select department"})}),e.jsxs(oe,{children:[e.jsx(S,{value:"Pre-Production",children:"Pre-Production"}),e.jsx(S,{value:"Production",children:"Production"}),e.jsx(S,{value:"Post Production",children:"Post Production"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-start gap-4",children:[e.jsx($,{htmlFor:"description",className:"text-right mt-2",children:"Description"}),e.jsx(ns,{id:"description",value:g.description,onChange:p=>y({...g,description:p.target.value}),className:"col-span-3",rows:3,placeholder:"Enter process description..."})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx($,{htmlFor:"status",className:"text-right",children:"Status"}),e.jsxs(le,{value:g.status,onValueChange:p=>y({...g,status:p}),children:[e.jsx(ie,{className:"col-span-3",children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"Active",children:"Active"}),e.jsx(S,{value:"Inactive",children:"Inactive"}),e.jsx(S,{value:"Under Review",children:"Under Review"})]})]})]})]}),e.jsx(it,{children:e.jsx(A,{type:"submit",children:c?"Update":"Create"})})]})]})]})]}),e.jsx(ae,{children:e.jsx(ne,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(pt,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(G,{placeholder:"Search processes...",className:"pl-10",value:r,onChange:p=>t(p.target.value)})]}),e.jsxs(A,{variant:"outline",children:[e.jsx(ss,{className:"h-4 w-4 mr-2"}),"Filter"]}),E&&e.jsx(qt,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:["Process Name"],optionalColumns:["Description","Estimated Time (minutes)"],validationRules:C,onImportComplete:p=>{p.successfulRows>0&&(P.invalidateQueries({queryKey:["processes"]}),j({title:"Import Successful",description:`${p.successfulRows} processes imported successfully.`}))}},variant:"outline"}),x&&e.jsx(Rt,{data:re.map(p=>({name:p.process_name,description:p.description||"",estimatedTime:0,isActive:p.status==="Active",createdAt:p.$createdAt})),headers:x.exportColumns.map(p=>p.exportHeader),filename:"processes",variant:"outline"})]})})}),e.jsxs(ae,{children:[e.jsx(fe,{children:e.jsxs(je,{children:["Manufacturing Processes (",re.length,")"]})}),e.jsxs(ne,{children:[d.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 p-3 bg-muted rounded-md",children:[e.jsxs("span",{className:"text-sm font-medium",children:[d.length," selected"]}),e.jsx(A,{variant:"destructive",size:"sm",onClick:Y,disabled:M.isPending,children:"Delete Selected"}),e.jsx(A,{variant:"outline",size:"sm",onClick:_,children:"Export Selected"})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",Math.min(ee.length,I)," of ",I," records"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Records per page:"}),e.jsxs(le,{value:f.toString(),onValueChange:p=>N(Number(p)),children:[e.jsx(ie,{className:"w-[100px]",children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"50",children:"50"}),e.jsx(S,{value:"100",children:"100"}),e.jsx(S,{value:"500",children:"500"})]})]})]})]}),F?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:e.jsx("span",{children:"Loading processes..."})}):re.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("p",{className:"text-lg mb-2",children:"No processes found"}),e.jsx("p",{className:"text-sm",children:"Add your first process to get started"})]}):e.jsx("div",{className:"border rounded-md overflow-auto",style:{maxHeight:"70vh"},children:e.jsxs(yt,{children:[e.jsx(vt,{children:e.jsxs(qe,{children:[e.jsx(te,{className:"w-12",children:e.jsx("input",{type:"checkbox",checked:U,ref:p=>{p&&(p.indeterminate=h)},onChange:p=>de(p.target.checked),className:"rounded border-gray-300"})}),e.jsx(te,{children:"Process Name"}),e.jsx(te,{children:"Department"}),e.jsx(te,{children:"Description"}),e.jsx(te,{children:"Status"}),e.jsx(te,{children:"Actions"})]})}),e.jsx(bt,{children:ee.map(p=>{const L=d.some(k=>k.$id===p.$id);return e.jsxs(qe,{children:[e.jsx(J,{children:e.jsx("input",{type:"checkbox",checked:L,onChange:k=>V(p,k.target.checked),className:"rounded border-gray-300"})}),e.jsx(J,{className:"font-medium",children:p.process_name}),e.jsx(J,{children:p.department||"-"}),e.jsx(J,{className:"max-w-xs truncate",children:p.description||"-"}),e.jsx(J,{children:e.jsx(We,{variant:p.status==="Active"?"default":p.status==="Under Review"?"secondary":"outline",children:p.status})}),e.jsx(J,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(A,{variant:"outline",size:"sm",onClick:()=>R(p),children:e.jsx(as,{className:"h-4 w-4"})}),e.jsx(A,{variant:"outline",size:"sm",onClick:()=>w(p.$id),children:e.jsx(It,{className:"h-4 w-4"})})]})})]},p.$id)})})]})})]})]})]})},Zl=()=>{const[r,t]=u.useState(""),[s,a]=u.useState("all"),[n,i]=u.useState(!1),[c,m]=u.useState(null),[d,o]=u.useState([]),[f,N]=u.useState(50),[g,y]=u.useState({code:"",raw_product:"",uom:"",source:"Manufactured",status:"Active"}),{toast:j}=Ie(),P=mt(),{config:x}=Tt("raw-products"),{validationRules:C,canImport:E}=Et("raw-products"),{data:D=[],isLoading:T,error:F}=Ne({queryKey:["rawProducts"],queryFn:async()=>await Ss.getAll()}),K=Re({mutationFn:h=>{const{code:p,raw_product:L,uom:k,source:W}=h,xe={code:p,raw_product:L,uom:k,source:W};return Ss.create(xe)},onSuccess:()=>{P.invalidateQueries({queryKey:["rawProducts"]}),j({title:"Success",description:"Raw product created successfully"}),i(!1),M()},onError:h=>{j({title:"Error",description:"Failed to create raw product",variant:"destructive"}),console.error("Error creating raw product:",h)}}),O=Re({mutationFn:({id:h,data:p})=>{const{code:L,raw_product:k,uom:W,source:xe}=p,he={code:L,raw_product:k,uom:W,source:xe};return Ss.update(h,he)},onSuccess:()=>{P.invalidateQueries({queryKey:["rawProducts"]}),j({title:"Success",description:"Raw product updated successfully"}),i(!1),M()},onError:h=>{j({title:"Error",description:"Failed to update raw product",variant:"destructive"}),console.error("Error updating raw product:",h)}}),Z=Re({mutationFn:h=>Ss.delete(h),onSuccess:()=>{P.invalidateQueries({queryKey:["rawProducts"]}),j({title:"Success",description:"Raw product deleted successfully"})},onError:h=>{j({title:"Error",description:"Failed to delete raw product",variant:"destructive"}),console.error("Error deleting raw product:",h)}}),M=()=>{y({code:"",raw_product:"",uom:"",source:"Manufactured",status:"Active"}),m(null)},z=h=>{if(h.preventDefault(),!g.code.trim()){j({title:"Error",description:"Code is required",variant:"destructive"});return}if(!g.raw_product.trim()){j({title:"Error",description:"Raw Product is required",variant:"destructive"});return}if(!g.uom.trim()){j({title:"Error",description:"UoM is required",variant:"destructive"});return}if(!g.source.trim()){j({title:"Error",description:"Source is required",variant:"destructive"});return}c?O.mutate({id:c.$id,data:g}):K.mutate(g)},Q=h=>{m(h),y({code:h.code,raw_product:h.raw_product,uom:h.uom||"",source:h.source||"Manufactured",status:h.status}),i(!0)},R=h=>{window.confirm("Are you sure you want to delete this raw product?")&&Z.mutate(h)},w=async()=>{if(d.length===0){j({title:"Error",description:"Please select raw products to delete",variant:"destructive"});return}if(window.confirm(`Are you sure you want to delete ${d.length} selected raw product(s)?`))try{const h=d.length;await Promise.all(d.map(p=>new Promise((L,k)=>{Z.mutate(p.$id,{onSuccess:L,onError:k})}))),o([]),j({title:"Success",description:`${h} raw products deleted successfully`})}catch(h){console.error("Error deleting raw products:",h),j({title:"Error",description:"Failed to delete selected raw products",variant:"destructive"})}},Y=async()=>{if(d.length===0){j({title:"Error",description:"Please select raw products to export",variant:"destructive"});return}if(x)try{const h=d.map(p=>{const L={};return x.exportColumns.forEach(k=>{let W;switch(k.dataKey){case"name":case"raw_product":W=p.raw_product;break;case"code":W=p.code;break;case"uom":W=p.uom||"";break;case"source":W=p.source||"";break;case"status":W=p.status;break;default:W=p[k.dataKey]}L[k.exportHeader]=k.formatter?k.formatter(W):W}),L});await Qt.exportToXLSX({filename:"raw-products-selected",headers:x.exportColumns.map(p=>p.exportHeader),data:h,format:"xlsx"}),j({title:"Success",description:`Exported ${d.length} selected raw product(s) successfully`})}catch(h){console.error("Export error:",h),j({title:"Error",description:"Failed to export selected raw products",variant:"destructive"})}},_=()=>{m(null),M(),i(!0)},H=D.filter(h=>{const p=h.raw_product.toLowerCase().includes(r.toLowerCase())||h.code.toLowerCase().includes(r.toLowerCase())||h.source?.toLowerCase().includes(r.toLowerCase()),L=s==="all"||h.status===s;return p&&L}),re=H.length,I=H.slice(0,f),ee=(h,p)=>{o(p?[...d,h]:d.filter(L=>L.$id!==h.$id))},V=h=>{o(h?[...I]:[])},de=I.length>0&&I.every(h=>d.some(p=>p.$id===h.$id)),U=d.length>0&&!de;return F?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("p",{className:"text-red-500",children:["Error loading raw products: ",F.message]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Raw Products"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage raw materials and ingredients"})]}),e.jsxs(lt,{open:n,onOpenChange:i,children:[e.jsx(ys,{asChild:!0,children:e.jsxs(A,{onClick:_,className:"bg-primary hover:bg-primary/90",children:[e.jsx(Ct,{className:"h-4 w-4 mr-2"}),"Add New Raw Product"]})}),e.jsxs(rt,{className:"sm:max-w-[500px]",children:[e.jsxs(nt,{children:[e.jsx(ot,{children:c?"Edit Raw Product":"Add New Raw Product"}),e.jsxs(ct,{children:[c?"Update raw product information":"Enter raw product details to add a new material",e.jsxs("p",{className:"mt-2 text-sm text-muted-foreground",children:["Fields marked with ",e.jsx("span",{className:"text-red-500",children:"*"})," are required."]})]})]}),e.jsxs("form",{onSubmit:z,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs($,{htmlFor:"code",className:"text-right",children:["Code ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(G,{id:"code",value:g.code,onChange:h=>y({...g,code:h.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs($,{htmlFor:"raw_product",className:"text-right",children:["Raw Product ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(G,{id:"raw_product",value:g.raw_product,onChange:h=>y({...g,raw_product:h.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs($,{htmlFor:"uom",className:"text-right",children:["UoM ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(le,{value:g.uom,onValueChange:h=>y({...g,uom:h}),children:[e.jsx(ie,{className:"col-span-3",children:e.jsx(ce,{placeholder:"Select unit of measure"})}),e.jsxs(oe,{children:[e.jsx(S,{value:"kg",children:"Kilogram (kg)"}),e.jsx(S,{value:"g",children:"Gram (g)"}),e.jsx(S,{value:"l",children:"Liter (l)"}),e.jsx(S,{value:"ml",children:"Milliliter (ml)"}),e.jsx(S,{value:"pcs",children:"Pieces (pcs)"}),e.jsx(S,{value:"box",children:"Box"}),e.jsx(S,{value:"bag",children:"Bag"}),e.jsx(S,{value:"ton",children:"Ton"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs($,{htmlFor:"source",className:"text-right",children:["Source ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(le,{value:g.source,onValueChange:h=>y({...g,source:h}),children:[e.jsx(ie,{className:"col-span-3",children:e.jsx(ce,{placeholder:"Select source type"})}),e.jsxs(oe,{children:[e.jsx(S,{value:"Manufactured",children:"Manufactured"}),e.jsx(S,{value:"Purchased",children:"Purchased"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx($,{htmlFor:"status",className:"text-right",children:"Status"}),e.jsxs(le,{value:g.status,onValueChange:h=>y({...g,status:h}),children:[e.jsx(ie,{className:"col-span-3",children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"Active",children:"Active"}),e.jsx(S,{value:"Inactive",children:"Inactive"}),e.jsx(S,{value:"Discontinued",children:"Discontinued"})]})]})]})]}),e.jsx(it,{children:e.jsx(A,{type:"submit",children:c?"Update":"Create"})})]})]})]})]}),e.jsx(ae,{children:e.jsx(ne,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(pt,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(G,{placeholder:"Search raw products...",className:"pl-10",value:r,onChange:h=>t(h.target.value)})]}),e.jsxs(A,{variant:"outline",children:[e.jsx(ss,{className:"h-4 w-4 mr-2"}),"Filter"]}),E&&e.jsx(qt,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:["Raw Product Name","SKU","Unit"],optionalColumns:["Cost Per Unit","Description"],validationRules:C,onImportComplete:h=>{h.successfulRows>0&&(P.invalidateQueries({queryKey:["rawProducts"]}),j({title:"Import Successful",description:`${h.successfulRows} raw products imported successfully.`}))}},variant:"outline"}),x&&e.jsx(Rt,{data:H.map(h=>({name:h.raw_product,sku:h.code,unit:h.uom||"",costPerUnit:0,description:"",createdAt:h.$createdAt})),headers:x.exportColumns.map(h=>h.exportHeader),filename:"raw-products",variant:"outline"})]})})}),e.jsxs(ae,{children:[e.jsx(fe,{children:e.jsxs(je,{children:["Raw Materials (",H.length,")"]})}),e.jsxs(ne,{children:[d.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 p-3 bg-muted rounded-md",children:[e.jsxs("span",{className:"text-sm font-medium",children:[d.length," selected"]}),e.jsx(A,{variant:"destructive",size:"sm",onClick:w,disabled:Z.isPending,children:"Delete Selected"}),e.jsx(A,{variant:"outline",size:"sm",onClick:Y,children:"Export Selected"})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",Math.min(I.length,re)," of ",re," records"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Records per page:"}),e.jsxs(le,{value:f.toString(),onValueChange:h=>N(Number(h)),children:[e.jsx(ie,{className:"w-[100px]",children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"50",children:"50"}),e.jsx(S,{value:"100",children:"100"}),e.jsx(S,{value:"500",children:"500"})]})]})]})]}),T?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:e.jsx("span",{children:"Loading raw products..."})}):H.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("p",{className:"text-lg mb-2",children:"No raw products found"}),e.jsx("p",{className:"text-sm",children:"Add your first raw product to get started"})]}):e.jsx("div",{className:"border rounded-md overflow-auto",style:{maxHeight:"70vh"},children:e.jsxs(yt,{children:[e.jsx(vt,{children:e.jsxs(qe,{children:[e.jsx(te,{className:"w-12",children:e.jsx("input",{type:"checkbox",checked:de,ref:h=>{h&&(h.indeterminate=U)},onChange:h=>V(h.target.checked),className:"rounded border-gray-300"})}),e.jsx(te,{children:"Code"}),e.jsx(te,{children:"Raw Product"}),e.jsx(te,{children:"UoM"}),e.jsx(te,{children:"Source"}),e.jsx(te,{children:"Status"}),e.jsx(te,{children:"Actions"})]})}),e.jsx(bt,{children:I.map(h=>{const p=d.some(L=>L.$id===h.$id);return e.jsxs(qe,{children:[e.jsx(J,{children:e.jsx("input",{type:"checkbox",checked:p,onChange:L=>ee(h,L.target.checked),className:"rounded border-gray-300"})}),e.jsx(J,{className:"font-medium",children:h.code}),e.jsx(J,{children:h.raw_product}),e.jsx(J,{children:h.uom||"-"}),e.jsx(J,{children:h.source&&e.jsx(We,{variant:h.source==="Manufactured"?"default":"secondary",children:h.source})}),e.jsx(J,{children:e.jsx(We,{variant:h.status==="Active"?"default":h.status==="Discontinued"?"destructive":"secondary",children:h.status})}),e.jsx(J,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(A,{variant:"outline",size:"sm",onClick:()=>Q(h),children:e.jsx(as,{className:"h-4 w-4"})}),e.jsx(A,{variant:"outline",size:"sm",onClick:()=>R(h.$id),children:e.jsx(It,{className:"h-4 w-4"})})]})})]},h.$id)})})]})})]})]})]})},ec=()=>{const[r,t]=u.useState(""),[s,a]=u.useState("all"),[n,i]=u.useState(!1),[c,m]=u.useState(null),[d,o]=u.useState([]),[f,N]=u.useState(50),[g,y]=u.useState({sku:"",name:"",uom:"",min_level:"",status:"Active"}),{toast:j}=Ie(),P=mt(),{user:x}=jt(),{config:C}=Tt("products"),{validationRules:E,canImport:D}=Et("products"),{currentSort:T,handleSort:F,getSortedData:K}=rs(),{data:O=[],isLoading:Z,error:M}=Ne({queryKey:["products"],queryFn:async()=>await Ht.getAll(),enabled:!!x}),z=Re({mutationFn:p=>{const{sku:L,name:k,uom:W,min_level:xe}=p,he={sku:L,product:k,uom:W,min_level:xe};return Ht.create(he)},onSuccess:()=>{P.invalidateQueries({queryKey:["products"]}),j({title:"Success",description:"Product created successfully"}),i(!1),w()},onError:p=>{j({title:"Error",description:"Failed to create product",variant:"destructive"}),console.error("Error creating product:",p)}}),Q=Re({mutationFn:({id:p,data:L})=>{const{sku:k,name:W,uom:xe,min_level:he}=L,be={sku:k,product:W,uom:xe,min_level:he};return Ht.update(p,be)},onSuccess:()=>{P.invalidateQueries({queryKey:["products"]}),j({title:"Success",description:"Product updated successfully"}),i(!1),w()},onError:p=>{j({title:"Error",description:"Failed to update product",variant:"destructive"}),console.error("Error updating product:",p)}}),R=Re({mutationFn:p=>Ht.delete(p),onSuccess:()=>{P.invalidateQueries({queryKey:["products"]}),j({title:"Success",description:"Product deleted successfully"})},onError:p=>{j({title:"Error",description:"Failed to delete product",variant:"destructive"}),console.error("Error deleting product:",p)}}),w=()=>{y({sku:"",name:"",uom:"",min_level:"",status:"Active"}),m(null)},Y=p=>{if(p.preventDefault(),!g.sku?.trim()){j({title:"Error",description:"SKU is required",variant:"destructive"});return}if(!g.name?.trim()){j({title:"Error",description:"Product Name is required",variant:"destructive"});return}if(!g.uom?.trim()){j({title:"Error",description:"Unit of Measure is required",variant:"destructive"});return}if(!g.min_level?.trim()){j({title:"Error",description:"Minimum Level is required",variant:"destructive"});return}const L={...g,min_level:g.min_level?parseInt(g.min_level):void 0};c?Q.mutate({id:c.$id,data:L}):z.mutate(L)},_=p=>{m(p),y({sku:p.sku,name:p.product,uom:p.uom||"",min_level:p.min_level?.toString()||"",status:p.status}),i(!0)},H=p=>{confirm("Are you sure you want to delete this product?")&&R.mutate(p)},re=async()=>{if(d.length===0){j({title:"Error",description:"Please select products to delete",variant:"destructive"});return}if(window.confirm(`Are you sure you want to delete ${d.length} selected product(s)?`))try{const p=d.length;await Promise.all(d.map(L=>new Promise((k,W)=>{R.mutate(L.$id,{onSuccess:k,onError:W})}))),o([]),j({title:"Success",description:`${p} products deleted successfully`})}catch(p){console.error("Error deleting products:",p),j({title:"Error",description:"Failed to delete selected products",variant:"destructive"})}},I=async()=>{if(d.length===0){j({title:"Error",description:"Please select products to export",variant:"destructive"});return}if(C)try{const p=d.map(L=>{const k={};return C.exportColumns.forEach(W=>{let xe;switch(W.dataKey){case"sku":xe=L.sku;break;case"name":case"product":xe=L.product;break;case"uom":xe=L.uom||"";break;case"min_level":xe=L.min_level||0;break;case"status":xe=L.status;break;default:xe=L[W.dataKey]}k[W.exportHeader]=W.formatter?W.formatter(xe):xe}),k});await Qt.exportToXLSX({filename:"products-selected",headers:C.exportColumns.map(L=>L.exportHeader),data:p,format:"xlsx"}),j({title:"Success",description:`Exported ${d.length} selected product(s) successfully`})}catch(p){console.error("Export error:",p),j({title:"Error",description:"Failed to export selected products",variant:"destructive"})}},ee=()=>{m(null),w(),i(!0)},V=O.filter(p=>{const L=p.product.toLowerCase().includes(r.toLowerCase())||p.sku.toLowerCase().includes(r.toLowerCase()),k=s==="all"||p.status===s;return L&&k}),de=K(V),U=de.length,h=de.slice(0,f);return M?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("p",{className:"text-red-500",children:["Error loading products: ",M.message]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Products"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage finished products and inventory"})]}),e.jsxs(lt,{open:n,onOpenChange:i,children:[e.jsx(ys,{asChild:!0,children:e.jsxs(A,{onClick:ee,className:"bg-primary hover:bg-primary/90",children:[e.jsx(Ct,{className:"h-4 w-4 mr-2"}),"Add New Product"]})}),e.jsxs(rt,{className:"sm:max-w-[500px]",children:[e.jsxs(nt,{children:[e.jsx(ot,{children:c?"Edit Product":"Add New Product"}),e.jsxs(ct,{children:[c?"Update product information":"Enter product details to add a new finished product",e.jsxs("span",{className:"mt-2 text-sm text-muted-foreground",children:["Fields marked with ",e.jsx("span",{className:"text-red-500",children:"*"})," are required."]})]})]}),e.jsxs("form",{onSubmit:Y,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs($,{htmlFor:"sku",className:"text-right",children:["SKU ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(G,{id:"sku",value:g.sku,onChange:p=>y({...g,sku:p.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs($,{htmlFor:"product",className:"text-right",children:["Product ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(G,{id:"product",value:g.name,onChange:p=>y({...g,name:p.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs($,{htmlFor:"uom",className:"text-right",children:["UoM ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(le,{value:g.uom,onValueChange:p=>y({...g,uom:p}),children:[e.jsx(ie,{className:"col-span-3",children:e.jsx(ce,{placeholder:"Select unit of measure"})}),e.jsxs(oe,{children:[e.jsx(S,{value:"kg",children:"Kilogram (kg)"}),e.jsx(S,{value:"g",children:"Gram (g)"}),e.jsx(S,{value:"l",children:"Liter (l)"}),e.jsx(S,{value:"ml",children:"Milliliter (ml)"}),e.jsx(S,{value:"pcs",children:"Pieces (pcs)"}),e.jsx(S,{value:"box",children:"Box"}),e.jsx(S,{value:"pack",children:"Pack"}),e.jsx(S,{value:"bottle",children:"Bottle"}),e.jsx(S,{value:"can",children:"Can"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs($,{htmlFor:"min_level",className:"text-right",children:["Min Level ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(G,{id:"min_level",type:"number",value:g.min_level,onChange:p=>y({...g,min_level:p.target.value}),className:"col-span-3",min:"0",placeholder:"Minimum stock level"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx($,{htmlFor:"status",className:"text-right",children:"Status"}),e.jsxs(le,{value:g.status,onValueChange:p=>y({...g,status:p}),children:[e.jsx(ie,{className:"col-span-3",children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"Active",children:"Active"}),e.jsx(S,{value:"Inactive",children:"Inactive"}),e.jsx(S,{value:"Discontinued",children:"Discontinued"})]})]})]})]}),e.jsx(it,{children:e.jsx(A,{type:"submit",children:c?"Update":"Create"})})]})]})]})]}),e.jsx(ae,{children:e.jsx(ne,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(pt,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(G,{placeholder:"Search products...",className:"pl-10",value:r,onChange:p=>t(p.target.value)})]}),e.jsxs(A,{variant:"outline",children:[e.jsx(ss,{className:"h-4 w-4 mr-2"}),"Filter"]}),D&&e.jsx(qt,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:["Product Name","SKU"],optionalColumns:["Category","Price","Description"],validationRules:E,onImportComplete:p=>{p.successfulRows>0&&(P.invalidateQueries({queryKey:["products"]}),j({title:"Import Successful",description:`${p.successfulRows} products imported successfully.`}))}},variant:"outline"}),C&&e.jsx(Rt,{data:V.map(p=>({name:p.product,sku:p.sku,category:"",price:0,description:"",isActive:p.status==="Active",createdAt:p.$createdAt})),headers:C.exportColumns.map(p=>p.exportHeader),filename:"products",variant:"outline"})]})})}),e.jsxs(ae,{children:[e.jsx(fe,{children:e.jsxs(je,{children:["Finished Products (",V.length,")"]})}),e.jsxs(ne,{children:[d.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 p-3 bg-muted rounded-md",children:[e.jsxs("span",{className:"text-sm font-medium",children:[d.length," selected"]}),e.jsx(A,{variant:"destructive",size:"sm",onClick:re,disabled:R.isPending,children:"Delete Selected"}),e.jsx(A,{variant:"outline",size:"sm",onClick:I,children:"Export Selected"})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",Math.min(h.length,U)," of ",U," records"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Records per page:"}),e.jsxs(le,{value:f.toString(),onValueChange:p=>N(Number(p)),children:[e.jsx(ie,{className:"w-[100px]",children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"50",children:"50"}),e.jsx(S,{value:"100",children:"100"}),e.jsx(S,{value:"500",children:"500"})]})]})]})]}),e.jsx("div",{className:"border rounded-md overflow-auto",style:{maxHeight:"70vh"},children:e.jsx(us,{maxHeight:"none",selectable:!0,selectedRows:d,onSelectionChange:o,rowKey:"$id",data:h.map(p=>({...p,sku:p.sku||"",product:p.product||"",uom:p.uom||"-",min_level:p.min_level||0,status:p.status||"Active"})),columns:[{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"product",label:"Product Name",sortable:!0,dataType:"string"},{key:"uom",label:"UoM",sortable:!0,dataType:"string"},{key:"min_level",label:"Min Level",sortable:!0,dataType:"number",align:"right"},{key:"status",label:"Status",sortable:!0,dataType:"string"}],onSort:F,currentSort:T,loading:Z,emptyMessage:"No products found",actions:[{label:"Edit",icon:e.jsx(as,{className:"h-4 w-4"}),onClick:_},{label:"Delete",icon:e.jsx(It,{className:"h-4 w-4"}),onClick:p=>H(p.$id),variant:"destructive"}]})})]})]})]})},tc=()=>{const[r,t]=u.useState(""),[s,a]=u.useState("all"),[n,i]=u.useState(!1),[c,m]=u.useState(null),[d,o]=u.useState([]),[f,N]=u.useState(50),[g,y]=u.useState({channel_name:"",description:"",type:"Online",contact_person:"",phone:"",email:"",status:"Active"}),{toast:j}=Ie(),P=mt(),{config:x}=Tt("sales-channels"),{validationRules:C,canImport:E}=Et("sales-channels"),{data:D=[],isLoading:T,error:F}=Ne({queryKey:["salesChannels"],queryFn:async()=>await Os.getAll()}),K=Re({mutationFn:h=>{const{channel_name:p,type:L,email:k}=h,W={channel_name:p,type:L};return k&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(k)&&(W.email=k),Os.create(W)},onSuccess:()=>{P.invalidateQueries({queryKey:["salesChannels"]}),j({title:"Success",description:"Sales channel created successfully"}),i(!1),M()},onError:h=>{j({title:"Error",description:"Failed to create sales channel",variant:"destructive"}),console.error("Error creating sales channel:",h)}}),O=Re({mutationFn:({id:h,data:p})=>{const{channel_name:L,type:k,email:W}=p,xe={channel_name:L,type:k};return W&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(W)&&(xe.email=W),Os.update(h,xe)},onSuccess:()=>{P.invalidateQueries({queryKey:["salesChannels"]}),j({title:"Success",description:"Sales channel updated successfully"}),i(!1),M()},onError:h=>{j({title:"Error",description:"Failed to update sales channel",variant:"destructive"}),console.error("Error updating sales channel:",h)}}),Z=Re({mutationFn:h=>Os.delete(h),onSuccess:()=>{P.invalidateQueries({queryKey:["salesChannels"]}),j({title:"Success",description:"Sales channel deleted successfully"})},onError:h=>{j({title:"Error",description:"Failed to delete sales channel",variant:"destructive"}),console.error("Error deleting sales channel:",h)}}),M=()=>{y({channel_name:"",description:"",type:"Online",contact_person:"",phone:"",email:"",status:"Active"}),m(null)},z=h=>{if(h.preventDefault(),!g.channel_name.trim()){j({title:"Error",description:"Channel Name is required",variant:"destructive"});return}if(!g.type.trim()){j({title:"Error",description:"Type is required",variant:"destructive"});return}if(g.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(g.email)){j({title:"Error",description:"Please enter a valid email address",variant:"destructive"});return}c?O.mutate({id:c.$id,data:g}):K.mutate(g)},Q=h=>{m(h),y({channel_name:h.channel_name,description:h.description||"",type:h.type||"Online",contact_person:h.contact_person||"",phone:h.phone||"",email:h.email||"",status:h.status}),i(!0)},R=h=>{confirm("Are you sure you want to delete this sales channel?")&&Z.mutate(h)},w=async()=>{if(d.length===0){j({title:"Error",description:"Please select sales channels to delete",variant:"destructive"});return}if(window.confirm(`Are you sure you want to delete ${d.length} selected sales channel(s)?`))try{const h=d.length;await Promise.all(d.map(p=>new Promise((L,k)=>{Z.mutate(p.$id,{onSuccess:L,onError:k})}))),o([]),j({title:"Success",description:`${h} sales channels deleted successfully`})}catch(h){console.error("Error deleting sales channels:",h),j({title:"Error",description:"Failed to delete selected sales channels",variant:"destructive"})}},Y=async()=>{if(d.length===0){j({title:"Error",description:"Please select sales channels to export",variant:"destructive"});return}if(x)try{const h=d.map(p=>{const L={};return x.exportColumns.forEach(k=>{let W;switch(k.dataKey){case"name":case"channel_name":W=p.channel_name;break;case"description":W=p.description||"";break;case"isActive":W=p.status==="Active";break;default:W=p[k.dataKey]}L[k.exportHeader]=k.formatter?k.formatter(W):W}),L});await Qt.exportToXLSX({filename:"sales-channels-selected",headers:x.exportColumns.map(p=>p.exportHeader),data:h,format:"xlsx"}),j({title:"Success",description:`Exported ${d.length} selected sales channel(s) successfully`})}catch(h){console.error("Export error:",h),j({title:"Error",description:"Failed to export selected sales channels",variant:"destructive"})}},_=()=>{m(null),M(),i(!0)},H=D.filter(h=>{const p=h.channel_name.toLowerCase().includes(r.toLowerCase())||h.type?.toLowerCase().includes(r.toLowerCase())||h.contact_person?.toLowerCase().includes(r.toLowerCase()),L=s==="all"||h.status===s;return p&&L}),re=H.length,I=H.slice(0,f),ee=(h,p)=>{o(p?[...d,h]:d.filter(L=>L.$id!==h.$id))},V=h=>{o(h?[...I]:[])},de=I.length>0&&I.every(h=>d.some(p=>p.$id===h.$id)),U=d.length>0&&!de;return F?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("p",{className:"text-red-500",children:["Error loading sales channels: ",F.message]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Sales Channels"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage sales distribution channels and partners"})]}),e.jsxs(lt,{open:n,onOpenChange:i,children:[e.jsx(ys,{asChild:!0,children:e.jsxs(A,{onClick:_,className:"bg-primary hover:bg-primary/90",children:[e.jsx(Ct,{className:"h-4 w-4 mr-2"}),"Add New Channel"]})}),e.jsxs(rt,{className:"sm:max-w-[500px]",children:[e.jsxs(nt,{children:[e.jsx(ot,{children:c?"Edit Sales Channel":"Add New Sales Channel"}),e.jsxs(ct,{children:[c?"Update sales channel information":"Enter sales channel details to add a new distribution partner",e.jsxs("p",{className:"mt-2 text-sm text-muted-foreground",children:["Fields marked with ",e.jsx("span",{className:"text-red-500",children:"*"})," are required."]})]})]}),e.jsxs("form",{onSubmit:z,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs($,{htmlFor:"channel_name",className:"text-right",children:["Channel Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(G,{id:"channel_name",value:g.channel_name,onChange:h=>y({...g,channel_name:h.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-start gap-4",children:[e.jsx($,{htmlFor:"description",className:"text-right mt-2",children:"Description"}),e.jsx(ns,{id:"description",value:g.description,onChange:h=>y({...g,description:h.target.value}),className:"col-span-3",rows:3,placeholder:"Enter channel description..."})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs($,{htmlFor:"type",className:"text-right",children:["Type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(le,{value:g.type,onValueChange:h=>y({...g,type:h}),children:[e.jsx(ie,{className:"col-span-3",children:e.jsx(ce,{placeholder:"Select channel type"})}),e.jsxs(oe,{children:[e.jsx(S,{value:"Online",children:"Online"}),e.jsx(S,{value:"Retail",children:"Retail"}),e.jsx(S,{value:"Wholesale",children:"Wholesale"}),e.jsx(S,{value:"Direct Sales",children:"Direct Sales"}),e.jsx(S,{value:"Distributor",children:"Distributor"}),e.jsx(S,{value:"E-commerce",children:"E-commerce"}),e.jsx(S,{value:"Export",children:"Export"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx($,{htmlFor:"contact_person",className:"text-right",children:"Contact Person"}),e.jsx(G,{id:"contact_person",value:g.contact_person,onChange:h=>y({...g,contact_person:h.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx($,{htmlFor:"phone",className:"text-right",children:"Phone"}),e.jsx(G,{id:"phone",value:g.phone,onChange:h=>y({...g,phone:h.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx($,{htmlFor:"email",className:"text-right",children:"Email"}),e.jsx(G,{id:"email",type:"email",value:g.email,onChange:h=>y({...g,email:h.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx($,{htmlFor:"status",className:"text-right",children:"Status"}),e.jsxs(le,{value:g.status,onValueChange:h=>y({...g,status:h}),children:[e.jsx(ie,{className:"col-span-3",children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"Active",children:"Active"}),e.jsx(S,{value:"Inactive",children:"Inactive"}),e.jsx(S,{value:"Pending",children:"Pending"})]})]})]})]}),e.jsx(it,{children:e.jsx(A,{type:"submit",children:c?"Update":"Create"})})]})]})]})]}),e.jsx(ae,{children:e.jsx(ne,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(pt,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(G,{placeholder:"Search sales channels...",className:"pl-10",value:r,onChange:h=>t(h.target.value)})]}),e.jsxs(A,{variant:"outline",children:[e.jsx(ss,{className:"h-4 w-4 mr-2"}),"Filter"]}),E&&e.jsx(qt,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:["Channel Name","Type"],optionalColumns:["Commission (%)","Description"],validationRules:C,onImportComplete:h=>{h.successfulRows>0&&(P.invalidateQueries({queryKey:["salesChannels"]}),j({title:"Import Successful",description:`${h.successfulRows} sales channels imported successfully.`}))}},variant:"outline"}),x&&e.jsx(Rt,{data:H.map(h=>({name:h.channel_name,type:h.type||"",commission:0,description:h.description||"",isActive:h.status==="Active",createdAt:h.$createdAt})),headers:x.exportColumns.map(h=>h.exportHeader),filename:"sales-channels",variant:"outline"})]})})}),e.jsxs(ae,{children:[e.jsx(fe,{children:e.jsxs(je,{children:["Distribution Channels (",H.length,")"]})}),e.jsxs(ne,{children:[d.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 p-3 bg-muted rounded-md",children:[e.jsxs("span",{className:"text-sm font-medium",children:[d.length," selected"]}),e.jsx(A,{variant:"destructive",size:"sm",onClick:w,disabled:Z.isPending,children:"Delete Selected"}),e.jsx(A,{variant:"outline",size:"sm",onClick:Y,children:"Export Selected"})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",Math.min(I.length,re)," of ",re," records"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Records per page:"}),e.jsxs(le,{value:f.toString(),onValueChange:h=>N(Number(h)),children:[e.jsx(ie,{className:"w-[100px]",children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"50",children:"50"}),e.jsx(S,{value:"100",children:"100"}),e.jsx(S,{value:"500",children:"500"})]})]})]})]}),T?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:e.jsx("span",{children:"Loading sales channels..."})}):H.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("p",{className:"text-lg mb-2",children:"No sales channels found"}),e.jsx("p",{className:"text-sm",children:"Add your first sales channel to get started"})]}):e.jsx("div",{className:"border rounded-md overflow-auto",style:{maxHeight:"70vh"},children:e.jsxs(yt,{children:[e.jsx(vt,{children:e.jsxs(qe,{children:[e.jsx(te,{className:"w-12",children:e.jsx("input",{type:"checkbox",checked:de,ref:h=>{h&&(h.indeterminate=U)},onChange:h=>V(h.target.checked),className:"rounded border-gray-300"})}),e.jsx(te,{children:"Channel Name"}),e.jsx(te,{children:"Description"}),e.jsx(te,{children:"Type"}),e.jsx(te,{children:"Contact Person"}),e.jsx(te,{children:"Phone"}),e.jsx(te,{children:"Email"}),e.jsx(te,{children:"Status"}),e.jsx(te,{children:"Actions"})]})}),e.jsx(bt,{children:I.map(h=>{const p=d.some(L=>L.$id===h.$id);return e.jsxs(qe,{children:[e.jsx(J,{children:e.jsx("input",{type:"checkbox",checked:p,onChange:L=>ee(h,L.target.checked),className:"rounded border-gray-300"})}),e.jsx(J,{className:"font-medium",children:h.channel_name}),e.jsx(J,{className:"max-w-xs truncate",children:h.description||"-"}),e.jsx(J,{children:h.type&&e.jsx(We,{variant:"outline",children:h.type})}),e.jsx(J,{children:h.contact_person||"-"}),e.jsx(J,{children:h.phone||"-"}),e.jsx(J,{children:h.email||"-"}),e.jsx(J,{children:e.jsx(We,{variant:h.status==="Active"?"default":h.status==="Pending"?"secondary":"outline",children:h.status})}),e.jsx(J,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(A,{variant:"outline",size:"sm",onClick:()=>Q(h),children:e.jsx(as,{className:"h-4 w-4"})}),e.jsx(A,{variant:"outline",size:"sm",onClick:()=>R(h.$id),children:e.jsx(It,{className:"h-4 w-4"})})]})})]},h.$id)})})]})})]})]})]})},In=(r,t,s={})=>{const{category:a,searchTerm:n}=s,i=r?Bs(r,1):void 0,c=r?dt(r,"yyyy-MM-dd"):void 0,m=t?dt(t,"yyyy-MM-dd"):void 0,d=i?dt(i,"yyyy-MM-dd"):void 0,{data:o=[],isLoading:f}=Ne({queryKey:["stocks"],queryFn:()=>Bt.getAll(),staleTime:600*1e3}),{data:N=[],isLoading:g}=Ne({queryKey:["processes"],queryFn:()=>js.getAll(),staleTime:600*1e3}),{data:y=[],isLoading:j}=Ne({queryKey:["purchases",c,m],queryFn:()=>Gt.getByDateRange(r,t),enabled:!!r&&!!t,staleTime:300*1e3}),{data:P=[]}=Ne({queryKey:["purchasesBefore",d],queryFn:()=>Gt.getByDateRange(void 0,i),enabled:!!i,staleTime:300*1e3}),{data:x=[],isLoading:C}=Ne({queryKey:["cleaning-tasks",c,m],queryFn:async()=>(await cs.getByDateRange(r,t)).filter(K=>(K.process_name?.toLowerCase()||"").includes("cleaning")),enabled:!!r&&!!t,staleTime:300*1e3}),{data:E=[]}=Ne({queryKey:["cleaning-tasksBefore",d],queryFn:async()=>(await cs.getByDateRange(void 0,i)).filter(K=>(K.process_name?.toLowerCase()||"").includes("cleaning")),enabled:!!i,staleTime:300*1e3});return{stockStatus:u.useMemo(()=>o.length?o.filter(F=>{if(a&&a!=="all"&&(F.category||F.Category)!==a)return!1;if(n){const K=n.toLowerCase();if(!(F.stock_name?.toLowerCase()||"").includes(K))return!1}return!0}).map(F=>{const K=P.filter(Y=>Y.stock_id===F.$id).reduce((Y,_)=>Y+(Number(_.quantity)||0),0),O=E.filter(Y=>Y.stock_id===F.$id&&Y.status==="completed").reduce((Y,_)=>Y+(Number(_.assigned_quantity)||0),0),Z=K-O,M=y.filter(Y=>Y.stock_id===F.$id).reduce((Y,_)=>Y+(Number(_.quantity)||0),0),z=x.filter(Y=>Y.stock_id===F.$id&&Y.status==="completed").reduce((Y,_)=>Y+(Number(_.assigned_quantity)||0),0),Q=Z+M-z,R=F.min_level||0;let w="In Stock";return Q<=0?w="Out of Stock":Q<R&&(w="Low Stock"),{stock_id:F.$id,stock_name:F.stock_name,category:F.category||F.Category,opening_balance:Z,purchases:M,utilised:z,closing_balance:Q,min_level:R,status:w}}):[],[o,y,P,x,E,a,n]),isLoading:f||g||j||C,error:null}},sc=()=>{const{data:r,isLoading:t,error:s}=Ne({queryKey:["stock-categories"],queryFn:()=>Bt.getCategories()});return{categories:r,isLoading:t,error:s}},ac=()=>{const[r,t]=u.useState({from:ts(new Date),to:es(new Date)}),[s,a]=u.useState(void 0),[n,i]=u.useState(""),{toast:c}=Ie(),m=mt(),{stockStatus:d,isLoading:o}=In(r?.from,r?.to,{category:s,searchTerm:n}),{categories:f}=sc(),N=async()=>{try{await m.invalidateQueries({queryKey:["stocks"]}),await m.invalidateQueries({queryKey:["purchases"]}),await m.invalidateQueries({queryKey:["tasks"]}),c({title:"Stock Data Refreshed",description:"Data updated successfully"})}catch{c({title:"Refresh Failed",description:"Please try again",variant:"destructive"})}};return e.jsxs(ae,{children:[e.jsxs(fe,{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(je,{children:"Stock Status"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(A,{variant:"outline",onClick:N,disabled:o,children:[e.jsx(qa,{className:`h-4 w-4 mr-1 ${o?"animate-spin":""}`}),"Refresh Data"]}),e.jsx(A,{variant:"outline",children:"Export"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-4",children:[e.jsx(As,{value:r,onChange:t,className:"w-[300px]"}),e.jsxs(le,{onValueChange:a,value:s,children:[e.jsx(ie,{className:"w-[180px]",children:e.jsx(ce,{placeholder:"All Categories"})}),e.jsxs(oe,{children:[e.jsx(S,{value:"all",children:"All Categories"}),f?.map(g=>e.jsx(S,{value:g,children:g},g))]})]}),e.jsx(G,{placeholder:"Search...",className:"w-[200px]",value:n,onChange:g=>i(g.target.value)})]})]}),e.jsx(ne,{children:e.jsxs(yt,{children:[e.jsx(vt,{children:e.jsxs(qe,{children:[e.jsx(te,{children:"Stock Name"}),e.jsx(te,{children:"Category"}),e.jsx(te,{className:"text-right",children:"Opening Balance"}),e.jsx(te,{className:"text-right bg-purple-50",children:"Purchases"}),e.jsx(te,{className:"text-right bg-green-50",children:"Utilised"}),e.jsx(te,{className:"text-right",children:"Closing Balance"}),e.jsx(te,{className:"text-right",children:"Min Level"}),e.jsx(te,{children:"Status"})]})}),e.jsx(bt,{children:o?e.jsx(qe,{children:e.jsxs(J,{colSpan:8,className:"text-center py-12",children:[e.jsx(ze,{className:"h-8 w-8 animate-spin mx-auto mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading stock status..."})]})}):d.length===0?e.jsx(qe,{children:e.jsx(J,{colSpan:8,className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"No stock data found for the selected criteria"})})}):d.map((g,y)=>e.jsxs(qe,{children:[e.jsx(J,{children:g.stock_name}),e.jsx(J,{children:g.category||"N/A"}),e.jsx(J,{className:"text-right",children:(g.opening_balance||0).toLocaleString()}),e.jsx(J,{className:"text-right bg-purple-50 font-medium",children:(g.purchases||0).toLocaleString()}),e.jsx(J,{className:"text-right bg-green-50 font-medium",children:(g.utilised||0).toLocaleString()}),e.jsx(J,{className:"text-right font-semibold",children:e.jsx("span",{className:(g.closing_balance||0)<0?"text-red-600":"text-green-600",children:(g.closing_balance||0).toLocaleString()})}),e.jsx(J,{className:"text-right text-muted-foreground",children:(g.min_level||0).toLocaleString()}),e.jsx(J,{children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${g.status==="Out of Stock"?"bg-red-100 text-red-800":g.status==="Low Stock"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:g.status||"In Stock"})})]},g.stock_id||`stock-${y}`))})]})})]})},Ka=(r,t,s={})=>{const{processId:a}=s,n=r?Kt(r):void 0,i=t?Kt(t):void 0,c=n?Bs(n,1):void 0,m=n?dt(n,"yyyy-MM-dd"):void 0,d=i?dt(i,"yyyy-MM-dd"):void 0,o=c?dt(c,"yyyy-MM-dd"):void 0,{data:f=[],isLoading:N}=Ne({queryKey:["stocks"],queryFn:()=>Bt.getAll(),staleTime:600*1e3}),{data:g=[],isLoading:y}=Ne({queryKey:["processes"],queryFn:()=>js.getAll(),staleTime:600*1e3}),{data:j=[],isLoading:P}=Ne({queryKey:["preProductionTasks",m,d],queryFn:()=>cs.getByDateRange(n,i),enabled:!!n&&!!i,staleTime:300*1e3}),{data:x=[]}=Ne({queryKey:["preProductionTasksBefore",o],queryFn:()=>cs.getByDateRange(void 0,c),enabled:!!c,staleTime:300*1e3}),{data:C=[]}=Ne({queryKey:["productionTasksForPreStatus",m,d],queryFn:()=>zt.getProductionTasksWithRelations(m,d),enabled:!!n&&!!i,staleTime:300*1e3}),{data:E=[]}=Ne({queryKey:["productionTasksBeforeForPreStatus",o],queryFn:()=>zt.getProductionTasksWithRelations(void 0,o),enabled:!!c,staleTime:300*1e3});return{statusRecords:u.useMemo(()=>{if(!f.length||!g.length)return[];new Map(g.map(z=>[z.$id,z.process_name]));const F=["cleaning","c & d","roasting","rfp"],K=a?g.filter(z=>{const Q=z.process_name?.toLowerCase();return z.$id===a&&F.includes(Q)}):g.filter(z=>{const Q=z.process_name?.toLowerCase();return F.includes(Q)}),O=z=>{if(!z)return!n&&!i;if(!n&&!i)return!0;const Q=Kt(z),R=n?Q>=n:!0,w=i?Q<=i:!0;return R&&w},Z=z=>!z||!c?!1:Kt(z)<=c;return f.flatMap(z=>K.map(Q=>{const R=z.stock_name,w=Q.process_name;if(!R||!w)return null;const _=x.filter(he=>he.stock_id===z.$id&&he.process_id===Q.$id&&he.status==="completed"&&Z(he.date_completed||he.date_assigned)).reduce((he,be)=>{const Fe=be.completed_quantity!==void 0&&be.completed_quantity!==null?Number(be.completed_quantity):Number(be.assigned_quantity)||0,Me=Number(be.wastage_quantity)||0;return he+(Fe-Me)},0),H=x.filter(he=>he.stock_id===z.$id&&he.stock_source===w&&Z(he.date_assigned)).reduce((he,be)=>he+(Number(be.assigned_quantity)||0),0),re=E.filter(he=>he.source_process_id===Q.$id).reduce((he,be)=>{const Me=(be.stock_items||[]).filter(He=>He.stock_id===z.$id).reduce((He,ht)=>He+(Number(ht.quantity)||0),0);return he+Me},0),I=H+re,ee=_-I,V=j.filter(he=>he.stock_id===z.$id&&he.process_id===Q.$id&&O(he.date_assigned)),de=V.filter(he=>he.status==="completed").reduce((he,be)=>{const Fe=be.completed_quantity!==void 0&&be.completed_quantity!==null?Number(be.completed_quantity):Number(be.assigned_quantity)||0,Me=Number(be.wastage_quantity)||0;return he+(Fe-Me)},0),U=V.reduce((he,be)=>he+(Number(be.wastage_quantity)||0),0),h=j.filter(he=>he.stock_id===z.$id&&he.stock_source===w&&O(he.date_assigned)).reduce((he,be)=>he+(Number(be.assigned_quantity)||0),0),p=C.filter(he=>he.source_process_id===Q.$id).reduce((he,be)=>{const Me=(be.stock_items||[]).filter(He=>He.stock_id===z.$id).reduce((He,ht)=>He+(Number(ht.quantity)||0),0);return he+Me},0),L=h+p,k=ee+de-L,W=z.min_level||0;let xe="In Stock";return k<=0?xe="Out of Stock":k<W&&(xe="Low Stock"),{stock_name:R,process:w,opening_balance:ee,effective_completed:de,wastage_qty:U,utilised:L,closing_balance:k,min_level:W,status:xe}}).filter(Q=>Q!==null)).filter(Boolean)},[f,g,j,x,C,E,a,n,i,c]),isLoading:N||y||P,error:null}},Va=()=>{const{data:r=[],isLoading:t,error:s}=Ne({queryKey:["stocks"],queryFn:async()=>await Bt.getAll()});return{data:r,isLoading:t,error:s}},Fs=()=>{const{data:r=[],isLoading:t,error:s}=Ne({queryKey:["staff"],queryFn:async()=>await Pl.getAll(),staleTime:3e5,gcTime:9e5,refetchOnWindowFocus:!1});return{data:r,isLoading:t,error:s}},ms=()=>{const{data:r=[],isLoading:t,error:s}=Ne({queryKey:["processes"],queryFn:async()=>await js.getAll(),staleTime:3e5,gcTime:9e5,refetchOnWindowFocus:!1});return{data:r,isLoading:t,error:s}},Ln=()=>{const{data:r=[],isLoading:t,error:s}=Ne({queryKey:["products"],queryFn:async()=>await Ht.getAll(),staleTime:3e5,gcTime:9e5,refetchOnWindowFocus:!1});return{data:r,isLoading:t,error:s}},Ba=()=>{const{data:r=[],isLoading:t,error:s}=Ne({queryKey:["rawProducts"],queryFn:async()=>await Ss.getAll(),staleTime:3e5,gcTime:9e5,refetchOnWindowFocus:!1});return{data:r,isLoading:t,error:s}},rc=()=>{const r=mt(),[t,s]=u.useState(""),[a,n]=u.useState({from:ts(new Date),to:es(new Date)}),[i,c]=u.useState(""),{data:m}=ms(),d=a.from?dt(a.from,"yyyy-MM-dd"):void 0,o=a.to?dt(a.to,"yyyy-MM-dd"):void 0,{toast:f}=Ie(),{statusRecords:N,isLoading:g}=Ka(d,o,{processId:i||void 0}),y=u.useMemo(()=>N?N.filter(x=>(x.stock_name||"").toLowerCase().includes(t.toLowerCase())||(x.process||"").toLowerCase().includes(t.toLowerCase())):[],[N,t]),j=async()=>{try{await r.invalidateQueries({queryKey:["stocks"]}),await r.invalidateQueries({queryKey:["processes"]}),await r.invalidateQueries({queryKey:["preProductionTasks"]}),await r.invalidateQueries({queryKey:["productionTasksForPreStatus"]}),f({title:"Pre-Production Data Refreshed",description:"Data updated successfully"})}catch{f({title:"Refresh Failed",description:"Please try again",variant:"destructive"})}},P=()=>{const C=[["Stock Name","Process","Opening Balance","Effective Completed","Wastage Qty","Utilised","Closing Balance","Min Level","Status"].join(","),...y.map(K=>[`"${K.stock_name}"`,`"${K.process}"`,K.opening_balance.toFixed(2),K.effective_completed.toFixed(2),K.wastage_qty.toFixed(2),K.utilised.toFixed(2),K.closing_balance.toFixed(2),(K.min_level||0).toFixed(2),`"${K.status||"In Stock"}"`].join(","))].join(`
`),E=new Blob([C],{type:"text/csv;charset=utf-8;"}),D=URL.createObjectURL(E),T=document.createElement("a");T.setAttribute("href",D);const F=d&&o?`_${d}_to_${o}`:"";T.setAttribute("download",`pre-production-status${F}_${new Date().toISOString().split("T")[0]}.csv`),T.style.visibility="hidden",document.body.appendChild(T),T.click(),document.body.removeChild(T)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Pre-Production Status"}),e.jsx("p",{className:"text-muted-foreground",children:"Track material flow through pre-production stages"})]}),e.jsx(ae,{children:e.jsx(ne,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("div",{className:"relative w-full md:w-auto",children:[e.jsx(pt,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(G,{placeholder:"Search stock or process...",className:"w-full pl-8 md:w-[200px] lg:w-[300px]",value:t,onChange:x=>s(x.target.value)})]}),e.jsx(As,{value:a,onChange:x=>{x?.from&&x?.to&&n({from:x.from,to:x.to})}}),e.jsxs(le,{value:i||"all",onValueChange:x=>c(x==="all"?"":x),children:[e.jsx(ie,{className:"w-[180px]",children:e.jsx(ce,{placeholder:"All Processes"})}),e.jsxs(oe,{children:[e.jsx(S,{value:"all",children:"All Processes"}),m?.filter(x=>{const C=x.process_name?.toLowerCase();return["cleaning","c & d","roasting","rfp"].includes(C)}).map(x=>e.jsx(S,{value:x.$id,children:x.process_name},x.$id))]})]}),e.jsx(A,{onClick:j,variant:"outline",size:"icon",disabled:g,children:e.jsx(La,{className:`h-4 w-4 ${g?"animate-spin":""}`})}),e.jsx(A,{onClick:P,variant:"outline",size:"icon",disabled:!y||y.length===0,children:e.jsx(xs,{className:"h-4 w-4"})})]})})}),g?e.jsx(ae,{children:e.jsxs(ne,{className:"py-12 text-center",children:[e.jsx(ze,{className:"h-8 w-8 animate-spin mx-auto mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading pre-production status..."})]})}):e.jsxs(ae,{children:[e.jsx(fe,{children:e.jsx(je,{children:"Status Details"})}),e.jsx(ne,{children:e.jsxs(yt,{children:[e.jsx(vt,{children:e.jsxs(qe,{children:[e.jsx(te,{children:"Stock Name"}),e.jsx(te,{children:"Process"}),e.jsx(te,{className:"text-right",children:"Opening Balance"}),e.jsx(te,{className:"text-right bg-purple-50",children:"Effective Completed"}),e.jsx(te,{className:"text-right",children:"Wastage Qty"}),e.jsx(te,{className:"text-right bg-green-50",children:"Utilised"}),e.jsx(te,{className:"text-right",children:"Closing Balance"}),e.jsx(te,{className:"text-right",children:"Min Level"}),e.jsx(te,{children:"Status"})]})}),e.jsx(bt,{children:y&&y.length>0?y.map((x,C)=>e.jsxs(qe,{children:[e.jsx(J,{children:x.stock_name}),e.jsx(J,{children:x.process}),e.jsx(J,{className:"text-right",children:x.opening_balance.toFixed(2)}),e.jsx(J,{className:"text-right bg-purple-50 font-medium",children:x.effective_completed.toFixed(2)}),e.jsx(J,{className:"text-right",children:x.wastage_qty.toFixed(2)}),e.jsx(J,{className:"text-right bg-green-50 font-medium",children:x.utilised.toFixed(2)}),e.jsx(J,{className:"text-right font-semibold",children:e.jsx("span",{className:x.closing_balance<0?"text-red-600":"text-green-600",children:x.closing_balance.toFixed(2)})}),e.jsx(J,{className:"text-right text-muted-foreground",children:(x.min_level||0).toFixed(2)}),e.jsx(J,{children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${x.status==="Out of Stock"?"bg-red-100 text-red-800":x.status==="Low Stock"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:x.status||"In Stock"})})]},`${x.stock_name}-${x.process}-${C}`)):e.jsx(qe,{children:e.jsx(J,{colSpan:9,className:"text-center",children:"No pre-production status found for the selected criteria."})})})]})})]})]})},Ha=(r,t,s={})=>{const{processId:a}=s,n=r?Kt(r):void 0,i=t?Kt(t):void 0,c=n?Bs(n,1):void 0,m=n?dt(n,"yyyy-MM-dd"):void 0,d=i?dt(i,"yyyy-MM-dd"):void 0,o=c?dt(c,"yyyy-MM-dd"):void 0,{data:f=[],isLoading:N}=Ne({queryKey:["stocks"],queryFn:()=>Bt.getAll(),staleTime:600*1e3}),{data:g=[],isLoading:y}=Ne({queryKey:["processes"],queryFn:()=>js.getAll(),staleTime:600*1e3}),{data:j=[],isLoading:P}=Ne({queryKey:["rawProducts"],queryFn:()=>Ss.getAll(),staleTime:600*1e3}),{data:x=[],isLoading:C}=Ne({queryKey:["products"],queryFn:()=>Ht.getAll(),staleTime:600*1e3}),{data:E=[],isLoading:D}=Ne({queryKey:["productionTasks",m,d,a],queryFn:()=>zt.getProductionTasksWithRelations(m,d,a),enabled:!!n&&!!i,staleTime:300*1e3}),{data:T=[]}=Ne({queryKey:["productionTasksBefore",o,a],queryFn:()=>zt.getProductionTasksWithRelations(void 0,o,a),enabled:!!c,staleTime:300*1e3}),{data:F=[]}=Ne({queryKey:["postProductionTasks",m,d],queryFn:()=>Zt.getPostProductionTasksWithRelations(),enabled:!!n&&!!i,staleTime:300*1e3});return{statusRecords:u.useMemo(()=>{if(!g.length||!j.length||!x.length)return[];const Z=a?g.filter(_=>_.$id===a):g.filter(_=>{const H=_.process_name?.toLowerCase();return H==="grinding"||H==="blending"}),M=new Map(Z.map(_=>[_.$id,_.process_name])),z=new Map(j.map(_=>[_.$id,_])),Q=_=>{const H=x.find(ee=>ee.$id===_);if(!H)return null;const re=H.product||H.product_name||H.Product_Name||H.name;if(!re)return null;let I=j.find(ee=>ee.raw_product?.toLowerCase()===re.toLowerCase());return I||(I=j.find(ee=>{const V=ee.raw_product?.toLowerCase()||"",de=re.toLowerCase();return V.includes(de)||de.includes(V)})),I},R=new Map,w=_=>{if(!_)return!n&&!i;if(!n&&!i)return!0;const H=Kt(_),re=n?H>=n:!0,I=i?H<=i:!0;return re&&I},Y=new Set(Z.map(_=>_.$id));return T.filter(_=>Y.has(_.process_id)).forEach(_=>{const H=`${_.raw_product_id}-${_.process_id}`,re=Array.isArray(_.stock_items)?_.stock_items.reduce((de,U)=>de+(Number(U.quantity)||0),0):0,I=_.assigned_quantity!==void 0&&_.assigned_quantity!==null?Number(_.assigned_quantity):re,ee=Number(_.wastage_quantity)||0,V=I-ee;R.has(H)?R.get(H).opening_balance+=V:R.set(H,{stock_name:_.raw_product_name||"Unknown",process:M.get(_.process_id)||"Unknown",opening_balance:V,assigned:0,effective_completed:0,wastage_qty:0,utilised:0,closing_balance:0})}),E.filter(_=>Y.has(_.process_id)).forEach(_=>{const H=`${_.raw_product_id}-${_.process_id}`,re=Array.isArray(_.stock_items)?_.stock_items.reduce((de,U)=>de+(Number(U.quantity)||0),0):0,I=_.assigned_quantity!==void 0&&_.assigned_quantity!==null?Number(_.assigned_quantity):re,ee=Number(_.wastage_quantity)||0,V=I-ee;if(R.has(H)){const de=R.get(H);de.assigned+=I,de.wastage_qty+=ee,de.effective_completed+=V}else R.set(H,{stock_name:_.raw_product_name||"Unknown",process:M.get(_.process_id)||"Unknown",opening_balance:0,assigned:I,wastage_qty:ee,effective_completed:V,utilised:0,closing_balance:0})}),R.forEach((_,H)=>{const[re,I]=H.split("-");z.get(re);const ee=(F||[]).filter(V=>{const de=V.source_process_id===I,U=Q(V.product_id),h=U&&U.$id===re,p=w(V.date_assigned)||w(V.date_completed);return de&&h&&p}).reduce((V,de)=>{const U=Number(de.source_quantity)||0;return V+U},0);_.utilised=ee}),R.forEach(_=>{_.closing_balance=_.opening_balance+_.effective_completed-_.utilised,_.closing_balance<=0?_.status="Out of Stock":_.closing_balance<0?_.status="Low Stock":_.status="In Stock"}),Array.from(R.values())},[f,g,E,T,F,j,x,n,i,c,a]),isLoading:N||y||P||C||D,error:null}},nc=()=>{const{user:r,loading:t}=jt(),s=ds(),{toast:a}=Ie(),n=mt(),[i,c]=u.useState(""),[m,d]=u.useState({from:ts(new Date),to:es(new Date)}),[o,f]=u.useState(""),{data:N,isLoading:g}=ms(),y=m.from?dt(m.from,"yyyy-MM-dd"):void 0,j=m.to?dt(m.to,"yyyy-MM-dd"):void 0,{statusRecords:P,isLoading:x}=Ha(y,j,{processId:o||void 0}),C=u.useMemo(()=>P?P.filter(F=>(F.stock_name||"").toLowerCase().includes(i.toLowerCase())||(F.process||"").toLowerCase().includes(i.toLowerCase())):[],[P,i]),E=async()=>{try{await n.invalidateQueries({queryKey:["stocks"]}),await n.invalidateQueries({queryKey:["processes"]}),await n.invalidateQueries({queryKey:["productionTasks"]}),await n.invalidateQueries({queryKey:["postProductionTasks"]}),await n.invalidateQueries({queryKey:["rawProducts"]}),await n.invalidateQueries({queryKey:["products"]}),a({title:"Production Data Refreshed",description:"Data updated successfully"})}catch{a({title:"Refresh Failed",description:"Please try again",variant:"destructive"})}},D=()=>{const K=[["Raw Product","Process","Opening Balance","Assigned","Effective Completed","Wastage Qty","Utilised","Closing Bal","Min Level","Status"].join(","),...C.map(Q=>[`"${Q.stock_name}"`,`"${Q.process}"`,Q.opening_balance.toFixed(2),Q.assigned.toFixed(2),Q.effective_completed.toFixed(2),Q.wastage_qty.toFixed(2),Q.utilised.toFixed(2),Q.closing_balance.toFixed(2),(Q.min_level||0).toFixed(2),`"${Q.status||"In Stock"}"`].join(","))].join(`
`),O=new Blob([K],{type:"text/csv;charset=utf-8;"}),Z=URL.createObjectURL(O),M=document.createElement("a");M.setAttribute("href",Z);const z=y&&j?`_${y}_to_${j}`:"";M.setAttribute("download",`production-status${z}_${new Date().toISOString().split("T")[0]}.csv`),M.style.visibility="hidden",document.body.appendChild(M),M.click(),document.body.removeChild(M)},T=x||g;return t?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ze,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading..."})]})}):r?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Production Status"}),e.jsx("p",{className:"text-muted-foreground",children:"Track material flow through production stages"})]}),e.jsx(ae,{children:e.jsx(ne,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("div",{className:"relative w-full md:w-auto",children:[e.jsx(pt,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(G,{placeholder:"Search stock or process...",className:"w-full pl-8 md:w-[200px] lg:w-[300px]",value:i,onChange:F=>c(F.target.value)})]}),e.jsx(As,{value:m,onChange:F=>{F?.from&&F?.to&&d(F)}}),e.jsxs(le,{value:o,onValueChange:f,children:[e.jsx(ie,{className:"w-[180px]",children:e.jsx(ce,{placeholder:"All Processes"})}),e.jsx(oe,{children:N?.filter(F=>{const K=F.process_name?.toLowerCase();return K==="grinding"||K==="blending"}).map(F=>e.jsx(S,{value:F.$id,children:F.process_name},F.$id))})]}),e.jsx(A,{onClick:E,variant:"outline",size:"icon",disabled:T,children:e.jsx(La,{className:`h-4 w-4 ${T?"animate-spin":""}`})}),e.jsx(A,{onClick:D,variant:"outline",size:"icon",disabled:!C||C.length===0,children:e.jsx(xs,{className:"h-4 w-4"})})]})})}),T?e.jsx(ae,{children:e.jsxs(ne,{className:"py-12 text-center",children:[e.jsx(ze,{className:"h-8 w-8 animate-spin mx-auto mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading production status..."})]})}):e.jsxs(ae,{children:[e.jsxs(fe,{className:"flex flex-row items-center justify-between",children:[e.jsxs(je,{children:["Production Status Records (",C.length,")"]}),e.jsx("div",{className:"flex items-center gap-2"})]}),e.jsx(ne,{children:e.jsxs(yt,{children:[e.jsx(vt,{children:e.jsxs(qe,{children:[e.jsx(te,{children:"Raw Product"}),e.jsx(te,{children:"Process"}),e.jsx(te,{className:"text-right",children:"Opening Balance"}),e.jsx(te,{className:"text-right",children:"Assigned"}),e.jsx(te,{className:"text-right bg-purple-50",children:"Effective Completed"}),e.jsx(te,{className:"text-right",children:"Wastage Qty"}),e.jsx(te,{className:"text-right bg-green-50",children:"Utilised"}),e.jsx(te,{className:"text-right",children:"Closing Bal"}),e.jsx(te,{className:"text-right",children:"Min Level"}),e.jsx(te,{children:"Status"})]})}),e.jsx(bt,{children:C&&C.length>0?C.map((F,K)=>e.jsxs(qe,{children:[e.jsx(J,{children:F.stock_name}),e.jsx(J,{children:F.process}),e.jsx(J,{className:"text-right",children:F.opening_balance.toFixed(2)}),e.jsx(J,{className:"text-right",children:F.assigned.toFixed(2)}),e.jsx(J,{className:"text-right bg-purple-50 font-medium",children:F.effective_completed.toFixed(2)}),e.jsx(J,{className:"text-right",children:F.wastage_qty.toFixed(2)}),e.jsx(J,{className:"text-right bg-green-50 font-medium",children:F.utilised.toFixed(2)}),e.jsx(J,{className:"text-right font-semibold",children:e.jsx("span",{className:F.closing_balance<0?"text-red-600":"text-green-600",children:F.closing_balance.toFixed(2)})}),e.jsx(J,{className:"text-right text-muted-foreground",children:(F.min_level||0).toFixed(2)}),e.jsx(J,{children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${F.status==="Out of Stock"?"bg-red-100 text-red-800":F.status==="Low Stock"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:F.status||"In Stock"})})]},`${F.stock_name}-${F.process}-${K}`)):e.jsx(qe,{children:e.jsx(J,{colSpan:10,className:"text-center",children:"No production status found for the selected criteria."})})})]})})]})]}):e.jsx(qs,{to:"/login",state:{from:s},replace:!0})},ic=(r,t)=>r.filter(s=>{const a=s.$id;return a&&a.trim()!==""}),Ws={ALL:"all"},Mn=(r,t,s={})=>{const{processId:a}=s,n=r?Kt(r):void 0,i=t?Kt(t):void 0;n&&Bs(n,1);const c=n?dt(n,"yyyy-MM-dd"):void 0,m=i?dt(i,"yyyy-MM-dd"):void 0,{data:d=[],isLoading:o}=Ne({queryKey:["products"],queryFn:()=>Ht.getAll(),staleTime:600*1e3}),{data:f=[],isLoading:N}=Ne({queryKey:["processes"],queryFn:()=>js.getAll(),staleTime:600*1e3}),{data:g=[],isLoading:y}=Ne({queryKey:["postProductionTasks",c,m],queryFn:()=>Zt.getPostProductionTasksWithRelations(),enabled:!!n&&!!i,staleTime:300*1e3}),{data:j=[]}=Ne({queryKey:["salesUnits",c,m],queryFn:()=>Jt.getAll(),staleTime:60*1e3});return{statusRecords:u.useMemo(()=>{if(!d.length||!f.length)return[];const C=n?Bs(n,1):void 0,E=a?f.filter(K=>K.$id===a):f.filter(K=>{const O=K.process_name?.toLowerCase();return O==="packing"||O==="batch coding"}),D=K=>{if(!K)return!n&&!i;if(!n&&!i)return!0;const O=Kt(K),Z=n?O>=n:!0,M=i?O<=i:!0;return Z&&M},T=K=>!K||!C?!1:Kt(K)<=C,F=[];return d.forEach(K=>{E.forEach(O=>{const Z=K.sku||K.SKU||"",M=K.product||"",z=O.process_name,Q=K.min_level||K.minLevel||0;if(!Z||!M||!z)return;const w=g.filter(p=>p.product_id===K.$id&&p.process_id===O.$id&&p.status==="completed"&&T(p.date_completed||p.date_assigned)).reduce((p,L)=>p+(Number(L.units)||0),0),Y=g.filter(p=>p.source_process_id===O.$id&&p.product_id===K.$id&&T(p.date_assigned||p.date_completed)).reduce((p,L)=>p+(Number(L.units)||0),0);let _=0;z.toLowerCase()==="batch coding"&&(_=j.filter(p=>p.product_id===K.$id&&T(p.date||p.$createdAt)).reduce((p,L)=>p+(Number(L.units)||0),0));const H=w-Y-_,I=g.filter(p=>p.product_id===K.$id&&p.process_id===O.$id&&p.status==="completed"&&D(p.date_completed||p.date_assigned)).reduce((p,L)=>p+(Number(L.units)||0),0),ee=g.filter(p=>p.source_process_id===O.$id&&p.product_id===K.$id&&D(p.date_assigned||p.date_completed)).reduce((p,L)=>{const k=Number(L.units)||0;return p+k},0);let V=0;z.toLowerCase()==="batch coding"&&(V=j.filter(p=>p.product_id===K.$id&&D(p.date||p.$createdAt)).reduce((p,L)=>{const k=Number(L.units)||0;return p+k},0));const de=ee+V,U=H+I-de;let h="In Stock";U<=0?h="Out of Stock":U<Q&&(h="Low Stock"),F.push({sku:Z,product_name:M,process_name:z,opening_balance:H,completed_units:I,utilised:de,closing_balance:U,status:h,min_level:Q})})}),F},[d,f,g,j,a,n,i]),isLoading:o||N||y,error:null}},oc=()=>{const{user:r,loading:t}=jt(),s=ds(),{toast:a}=Ie(),n=mt(),[i,c]=u.useState(""),[m,d]=u.useState({from:ts(new Date),to:es(new Date)}),[o,f]=u.useState(Ws.ALL);if(t)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ze,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Validating authentication..."})]})});if(!r)return console.error("PostProductionStatus: User not authenticated, redirecting to login"),e.jsx(qs,{to:"/login",state:{from:s},replace:!0});const{data:N=[],isLoading:g}=Ne({queryKey:Ra.processes,queryFn:async()=>await js.getAll()}),{statusRecords:y=[],isLoading:j}=Mn(m?.from?dt(m.from,"yyyy-MM-dd"):void 0,m?.to?dt(m.to,"yyyy-MM-dd"):void 0,{processId:o!==Ws.ALL?o:void 0}),P=u.useMemo(()=>{if(!y)return[];let D=[...y];if(i&&(D=D.filter(T=>T.product_name?.toLowerCase().includes(i.toLowerCase())||T.process_name?.toLowerCase().includes(i.toLowerCase())||T.sku?.toLowerCase().includes(i.toLowerCase()))),o!==Ws.ALL){const T=N.find(F=>F.$id===o)?.process_name;T&&(D=D.filter(F=>F.process_name===T))}return D},[y,i,o,N]),x=g||j,C=async()=>{try{await n.invalidateQueries({queryKey:["products"]}),await n.invalidateQueries({queryKey:["processes"]}),await n.invalidateQueries({queryKey:["postProductionTasks"]}),await n.invalidateQueries({queryKey:["salesUnits"]}),a({title:"Post-Production Data Refreshed",description:"Data updated successfully"})}catch{a({title:"Refresh Failed",description:"Please try again",variant:"destructive"})}},E=()=>{try{const D=[["SKU","Product","Process","Source Qty (kg)","Opening Balance","Completed Units","Utilised","Closing Balance","Min Level","Status"],...P.map(O=>[O.sku||"",O.product_name||"",O.process_name||"",O.source_qty??"N/A",O.opening_balance||0,O.completed_units||0,O.utilised||0,O.closing_balance||0,O.min_level||0,`"${O.status||"In Stock"}"`])].map(O=>O.join(",")).join(`
`),T=new Blob([D],{type:"text/csv"}),F=window.URL.createObjectURL(T),K=document.createElement("a");K.href=F,K.download=`post-production-status-${dt(new Date,"yyyy-MM-dd")}.csv`,K.click(),window.URL.revokeObjectURL(F),a({title:"Export Successful",description:"Post-production status data exported successfully."})}catch(D){console.error("PostProductionStatus: Export failed",D),a({title:"Export Failed",description:"Failed to export data. Please try again.",variant:"destructive"})}};return e.jsxs("div",{className:"space-y-6 p-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Post-Production Status"}),e.jsx("p",{className:"text-muted-foreground",children:"Track quality checks and post-production status"})]}),e.jsx(ae,{children:e.jsx(ne,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("div",{className:"relative w-full md:w-auto",children:[e.jsx(pt,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(G,{placeholder:"Search product, process or SKU...",className:"w-full pl-8 md:w-[200px] lg:w-[300px]",value:i,onChange:D=>c(D.target.value)})]}),e.jsx(As,{value:m,onChange:D=>{D?.from&&D?.to&&d(D)}}),e.jsxs(le,{value:o,onValueChange:f,children:[e.jsx(ie,{className:"w-[180px]",children:e.jsx(ce,{placeholder:"Select Process"})}),e.jsxs(oe,{children:[e.jsx(S,{value:Ws.ALL,children:"All Processes"}),ic(N).filter(D=>{const T=D.process_name?.toLowerCase();return T==="packing"||T==="batch coding"}).map(D=>e.jsx(S,{value:D.$id,children:D.process_name},D.$id))]})]}),e.jsx(A,{onClick:C,variant:"outline",size:"icon",disabled:x,children:e.jsx(La,{className:`h-4 w-4 ${x?"animate-spin":""}`})}),e.jsx(A,{onClick:E,variant:"outline",size:"icon",disabled:!P||P.length===0,title:"Export to CSV",children:e.jsx(xs,{className:"h-4 w-4"})})]})})}),e.jsxs(ae,{children:[e.jsx(fe,{className:"flex flex-row items-center justify-between",children:e.jsxs(je,{children:["Post-Production Status Records (",P.length,")"]})}),e.jsx(ne,{children:x?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(ze,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("span",{children:"Loading post-production status..."})]}):P.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("p",{className:"text-lg mb-2",children:"No post-production status found"}),e.jsx("p",{className:"text-sm",children:i?"No matching records found":"Post-production status data will be populated from packing tasks and sales"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(yt,{children:[e.jsx(vt,{children:e.jsxs(qe,{children:[e.jsx(te,{children:"SKU"}),e.jsx(te,{children:"Product"}),e.jsx(te,{children:"Process"}),e.jsx(te,{className:"text-right",children:"Source Qty (kg)"}),e.jsx(te,{className:"text-right",children:"Opening Balance"}),e.jsx(te,{className:"text-right bg-purple-50",children:"Completed Units"}),e.jsx(te,{className:"text-right bg-green-50",children:"Utilised"}),e.jsx(te,{className:"text-right",children:"Closing Balance"}),e.jsx(te,{className:"text-right",children:"Min Level"}),e.jsx(te,{children:"Status"})]})}),e.jsx(bt,{children:P.map((D,T)=>e.jsxs(qe,{children:[e.jsx(J,{className:"font-medium",children:D.sku}),e.jsx(J,{children:D.product_name}),e.jsx(J,{children:D.process_name}),e.jsx(J,{className:"text-right",children:D.source_qty??"N/A"}),e.jsx(J,{className:"text-right",children:D.opening_balance||0}),e.jsx(J,{className:"text-right bg-purple-50 font-medium",children:D.completed_units||0}),e.jsx(J,{className:"text-right bg-green-50 font-medium",children:D.utilised||0}),e.jsx(J,{className:"text-right font-semibold",children:e.jsx("span",{className:(D.closing_balance||0)<0?"text-red-600":"text-green-600",children:D.closing_balance||0})}),e.jsx(J,{className:"text-right text-muted-foreground",children:D.min_level||0}),e.jsx(J,{children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${D.status==="Out of Stock"?"bg-red-100 text-red-800":D.status==="Low Stock"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:D.status||"In Stock"})})]},`${D.sku}-${D.process_name}-${T}`))})]})})})]})]})};function lc(){const{user:r,loading:t}=jt(),s=ds(),[a,n]=u.useState(""),[i,c]=u.useState(void 0);if(t)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ze,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Validating authentication..."})]})});if(!r)return console.error("InventoryStatus: User not authenticated, redirecting to login"),e.jsx(qs,{to:"/login",state:{from:s},replace:!0});const{data:m=[],isLoading:d}=Ne({queryKey:["products"],queryFn:async()=>await Ht.getAll()}),o=u.useMemo(()=>{const C=[];return i?.from&&C.push(et.greaterThanEqual("date",i.from.toISOString())),i?.to&&C.push(et.lessThanEqual("date",i.to.toISOString())),C},[i]),{data:f=[],isLoading:N}=Ne({queryKey:["sales-units-inventory",i?.from?.toISOString(),i?.to?.toISOString()],queryFn:async()=>await Jt.getAll(o)}),{data:g=[],isLoading:y}=Ne({queryKey:["sales-records-inventory",i?.from?.toISOString(),i?.to?.toISOString()],queryFn:async()=>await ls.getAll(o)}),j=u.useMemo(()=>m.length?m.map(C=>{const E=C.sku||"",D=C.product||C.name||"",T=C.min_level||C.minLevel||0,F=f.filter(z=>z.sku===E).reduce((z,Q)=>z+(Q.units||0),0),K=g.filter(z=>z.sku===E).reduce((z,Q)=>z+(Q.sold_units||0),0),O=0,Z=O+F-K;let M="In Stock";return Z<=0?M="Out of Stock":Z<=T&&(M="Low Stock"),{sku:E,product:D,opening_balance:O,sales_units:F,sold:K,closing_balance:Z,min_level:T,status:M}}):[],[m,f,g]),P=u.useMemo(()=>a?j.filter(C=>C.sku.toLowerCase().includes(a.toLowerCase())||C.product.toLowerCase().includes(a.toLowerCase())):j,[j,a]),x=d||N||y;return e.jsxs("div",{className:"space-y-6 p-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Inventory Status"}),e.jsx("p",{className:"text-muted-foreground",children:"Track current inventory levels based on sales units and sold units"})]}),e.jsx(ae,{children:e.jsx(ne,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4 items-center flex-wrap",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(pt,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(G,{placeholder:"Search by SKU or Product...",className:"pl-10",value:a,onChange:C=>n(C.target.value)})]}),e.jsx("div",{className:"min-w-[250px]",children:e.jsx(As,{value:i,onChange:c,placeholder:"Select date range for calculations"})}),e.jsxs(A,{variant:"outline",children:[e.jsx(ss,{className:"h-4 w-4 mr-2"}),"Filter"]}),e.jsxs(A,{variant:"outline",children:[e.jsx(xs,{className:"h-4 w-4 mr-2"}),"Export"]})]})})}),e.jsxs(ae,{children:[e.jsx(fe,{children:e.jsxs(je,{children:["Inventory Status (",P.length,")",i?.from&&i?.to&&e.jsxs("span",{className:"text-sm font-normal text-muted-foreground ml-2",children:["(",i.from.toLocaleDateString("en-GB")," - ",i.to.toLocaleDateString("en-GB"),")"]})]})}),e.jsx(ne,{children:x?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(ze,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("span",{children:"Loading inventory status..."})]}):P.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("p",{className:"text-lg mb-2",children:"No inventory data found"}),e.jsx("p",{className:"text-sm",children:a?"Try adjusting your search criteria":"Add products and sales data to see inventory status"})]}):e.jsxs(yt,{children:[e.jsx(vt,{children:e.jsxs(qe,{children:[e.jsx(te,{children:"SKU"}),e.jsx(te,{children:"Product"}),e.jsx(te,{className:"text-right",children:"Opening Bal"}),e.jsx(te,{className:"text-right bg-purple-50",children:"Sales Units"}),e.jsx(te,{className:"text-right bg-green-50",children:"Sold"}),e.jsx(te,{className:"text-right",children:"Closing Bal"}),e.jsx(te,{className:"text-right",children:"Min Level"}),e.jsx(te,{children:"Status"})]})}),e.jsx(bt,{children:P.map((C,E)=>e.jsxs(qe,{children:[e.jsx(J,{className:"font-medium",children:C.sku}),e.jsx(J,{children:C.product}),e.jsx(J,{className:"text-right",children:C.opening_balance.toLocaleString()}),e.jsx(J,{className:"text-right bg-purple-50 font-medium",children:C.sales_units.toLocaleString()}),e.jsx(J,{className:"text-right bg-green-50 font-medium",children:C.sold.toLocaleString()}),e.jsx(J,{className:"text-right font-semibold",children:e.jsx("span",{className:C.closing_balance<0?"text-red-600":"text-green-600",children:C.closing_balance.toLocaleString()})}),e.jsx(J,{className:"text-right text-muted-foreground",children:C.min_level.toLocaleString()}),e.jsx(J,{children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${C.status==="Out of Stock"?"bg-red-100 text-red-800":C.status==="Low Stock"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:C.status})})]},`${C.sku}-${E}`))})]})})]}),e.jsxs(ae,{children:[e.jsx(fe,{children:e.jsx(je,{children:"Summary"})}),e.jsx(ne,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:P.length}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Products"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:P.reduce((C,E)=>C+E.sales_units,0).toLocaleString()}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Sales Units"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:P.reduce((C,E)=>C+E.sold,0).toLocaleString()}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Sold"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:P.reduce((C,E)=>C+E.closing_balance,0).toLocaleString()}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Net Closing Balance"})]})]})})]})]})}const cc=[{value:"pending",label:"Pending"},{value:"in_progress",label:"In Progress"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"}],dc=({isOpen:r,onClose:t,onSubmit:s,editingTask:a,isLoading:n=!1})=>{const{data:i}=Va(),{data:c}=Fs(),{data:m}=ms(),d=new Date,o=ts(d),f=es(d),{statusRecords:N}=Ka(o.toISOString().split("T")[0],f.toISOString().split("T")[0],{processId:void 0}),{stockStatus:g,isLoading:y}=In(o,f,{category:void 0,searchTerm:void 0});u.useEffect(()=>{console.log("ðŸ” RTQV DATA SOURCE DEBUG:",{dateRange:`${o.toISOString().split("T")[0]} to ${f.toISOString().split("T")[0]}`,isLoading:y,dataLength:g?.length,sampleData:g?.slice(0,2),timestamp:new Date().toISOString()})},[g,y]);const j=["Stock","Cleaning","C & D","Roasting","RFP"],P=m.filter(R=>{const w=R.process_name?.toLowerCase();return["cleaning","c & d","roasting","rfp"].includes(w)}),[x,C]=u.useState({task_id:"",stock_id:"",stock_source:"",date_assigned:new Date().toISOString().split("T")[0],process_id:"",assigned_quantity:"",completed_quantity:"",staff_id:"",date_completed:"",wastage_quantity:"",remarks:"",status:"pending"}),[E,D]=u.useState({}),[T,F]=u.useState(null),K=u.useRef(!1),O=u.useRef(""),Z=()=>{if(!x.stock_id||!x.stock_source||!x.assigned_quantity){F(null);return}const R=i?.find(U=>U.$id===x.stock_id);if(!R){F({isValid:!1,availableQty:0,requiredQty:0,stockName:"Unknown Stock",stockSource:x.stock_source,error:"Stock not found",validationClass:"bg-red-50 text-red-700 border-red-200",validationMessage:"Selected stock not found"});return}const w=parseFloat(x.assigned_quantity);if(w<=0){F({isValid:!1,availableQty:0,requiredQty:w,stockName:R.stock_name,stockSource:x.stock_source,error:"Invalid quantity",validationClass:"bg-yellow-50 text-yellow-700 border-yellow-200",validationMessage:"Quantity must be greater than 0"});return}let Y=0,_="",H=!1;if(x.stock_source==="Stock"){if(_="Stock Status",H=y,H){F({isValid:!1,availableQty:0,requiredQty:w,stockName:R.stock_name,stockSource:x.stock_source,dataSource:_,isLoading:!0,validationClass:"bg-blue-50 text-blue-700 border-blue-200",validationMessage:"Loading stock data..."});return}const U=g?.find(h=>h.stock_name?.toLowerCase()===R.stock_name?.toLowerCase());Y=U?.closing_balance??0,console.log("ðŸ” RTQV Stock Status Check:",{stock_name:R.stock_name,stockRecord_found:!!U,closing_balance:U?.closing_balance,availableQty:Y,dataSource:_,forced_fresh:!0})}else{_="Pre-Production Status";const U=N?.find(h=>h.stock_name===R.stock_name&&h.process===x.stock_source);Y=U?.closing_balance??0,console.log("ðŸ” RTQV Pre-Production Status Check:",{stock_name:R.stock_name,stock_source:x.stock_source,statusRecord_found:!!U,closing_balance:U?.closing_balance,availableQty:Y,dataSource:_,forced_fresh:!0})}const re=Y>=w;let I="",ee="";re?(I="bg-green-50 text-green-700 border-green-200",ee=`âœ“ Available: ${Y}kg (Required: ${w}kg)`):Y===0?(I="bg-red-50 text-red-700 border-red-200",ee=`âœ— Out of stock (Required: ${w}kg)`):(I="bg-orange-50 text-orange-700 border-orange-200",ee=`âš  Insufficient stock: ${Y}kg available (Required: ${w}kg)`);const V={isValid:re,availableQty:Y,requiredQty:w,stockName:R.stock_name,stockSource:x.stock_source,dataSource:_,isLoading:!1,validationClass:I,validationMessage:ee},de=`${x.stock_id}-${x.stock_source}-${x.assigned_quantity}-${Y}-${w}`;O.current!==de&&(O.current=de,F(V))};u.useEffect(()=>{K.current||(K.current=!0,Z(),queueMicrotask(()=>{K.current=!1}))},[x.stock_id,x.stock_source,x.assigned_quantity]),u.useEffect(()=>{!x.stock_id||!x.stock_source||!x.assigned_quantity||K.current||(K.current=!0,Z(),queueMicrotask(()=>{K.current=!1}))},[g?.length,N?.length,y]),u.useEffect(()=>{if(r)if(a)C({task_id:a.task_id,stock_id:a.stock_id,stock_source:a.stock_source,date_assigned:a.date_assigned,process_id:a.process_id,assigned_quantity:a.assigned_quantity.toString(),completed_quantity:a.completed_quantity?.toString()||"",staff_id:a.staff_id,date_completed:a.date_completed||"",wastage_quantity:a.wastage_quantity?.toString()||"",remarks:a.remarks||"",status:a.status});else{const R=`TASK${Date.now().toString().slice(-6)}`;C({task_id:R,stock_id:"",stock_source:"",date_assigned:new Date().toISOString().split("T")[0],process_id:"",assigned_quantity:"",completed_quantity:"",staff_id:"",date_completed:"",wastage_quantity:"",remarks:"",status:"pending"})}},[a,r]);const M=()=>{const R={};return x.task_id.trim()||(R.task_id="Task ID is required"),x.stock_id||(R.stock_id="Stock is required"),x.stock_source||(R.stock_source="Stock source is required"),x.date_assigned||(R.date_assigned="Date assigned is required"),x.process_id||(R.process_id="Process is required"),(!x.assigned_quantity||parseFloat(x.assigned_quantity)<=0)&&(R.assigned_quantity="Assigned quantity must be greater than 0"),x.staff_id||(R.staff_id="Staff is required"),x.wastage_quantity&&parseFloat(x.wastage_quantity)<0&&(R.wastage_quantity="Wastage quantity cannot be negative"),D(R),Object.keys(R).length===0},z=R=>{if(R.preventDefault(),!M())return;const w={task_id:x.task_id,stock_id:x.stock_id,stock_source:x.stock_source,date_assigned:x.date_assigned,process_id:x.process_id,assigned_quantity:parseFloat(x.assigned_quantity),completed_quantity:x.completed_quantity?parseFloat(x.completed_quantity):void 0,staff_id:x.staff_id,date_completed:x.date_completed||void 0,wastage_quantity:x.wastage_quantity?parseFloat(x.wastage_quantity):void 0,remarks:x.remarks||void 0,status:x.status};s(w)},Q=()=>{C({task_id:"",stock_id:"",stock_source:"",date_assigned:new Date().toISOString().split("T")[0],process_id:"",assigned_quantity:"",completed_quantity:"",staff_id:"",date_completed:"",wastage_quantity:"",remarks:"",status:"pending"}),D({}),F(null),t()};return e.jsx(lt,{open:r,onOpenChange:Q,children:e.jsxs(rt,{className:"sm:max-w-[600px] max-w-[95vw] max-h-[90vh] overflow-y-auto",children:[e.jsxs(nt,{children:[e.jsx(ot,{children:a?"Edit Pre-Production Task":"Add New Pre-Production Task"}),e.jsx(ct,{children:a?"Update the details of the pre-production task below.":"Fill in the details to create a new pre-production task."})]}),e.jsxs("form",{onSubmit:z,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx($,{htmlFor:"task_id",children:"Task ID *"}),e.jsx(G,{id:"task_id",value:x.task_id,onChange:R=>C({...x,task_id:R.target.value}),className:E.task_id?"border-red-500":""}),E.task_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:E.task_id})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"date_assigned",children:"Date Assigned *"}),e.jsx(G,{id:"date_assigned",type:"date",value:x.date_assigned,onChange:R=>C({...x,date_assigned:R.target.value}),className:E.date_assigned?"border-red-500":""}),E.date_assigned&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:E.date_assigned})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx($,{htmlFor:"stock_id",children:"Stock Name *"}),e.jsxs(le,{value:x.stock_id,onValueChange:R=>C({...x,stock_id:R}),children:[e.jsx(ie,{className:E.stock_id?"border-red-500":"",children:e.jsx(ce,{placeholder:"Select Stock"})}),e.jsx(oe,{children:i.map(R=>e.jsx(S,{value:R.$id||"",children:R.stock_name},R.$id))})]}),E.stock_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:E.stock_id})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"stock_source",children:"Stock Source *"}),e.jsxs(le,{value:x.stock_source,onValueChange:R=>C({...x,stock_source:R}),children:[e.jsx(ie,{className:E.stock_source?"border-red-500":"",children:e.jsx(ce,{placeholder:"Select Source"})}),e.jsx(oe,{children:j.map(R=>e.jsx(S,{value:R,children:R},R))})]}),E.stock_source&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:E.stock_source})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx($,{htmlFor:"process_id",children:"Process *"}),e.jsxs(le,{value:x.process_id,onValueChange:R=>C({...x,process_id:R}),children:[e.jsx(ie,{className:E.process_id?"border-red-500":"",children:e.jsx(ce,{placeholder:"Select Process"})}),e.jsx(oe,{children:P.map(R=>e.jsx(S,{value:R.$id||"",children:R.process_name},R.$id))})]}),E.process_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:E.process_id})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"assigned_quantity",children:"Assigned Quantity *"}),e.jsx(G,{id:"assigned_quantity",type:"number",step:"0.01",min:"0",value:x.assigned_quantity,onChange:R=>C({...x,assigned_quantity:R.target.value}),className:E.assigned_quantity?"border-red-500":"",placeholder:"Enter quantity in kg"}),E.assigned_quantity&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:E.assigned_quantity}),T&&e.jsxs("div",{className:`mt-2 p-3 rounded-md border text-sm ${T.validationClass}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("div",{className:"font-medium",children:T.stockName}),e.jsxs("div",{className:"text-xs opacity-75",children:["Source: ",T.dataSource]})]}),e.jsx("div",{className:"mb-1",children:T.validationMessage}),T.error&&e.jsxs("div",{className:"text-xs mt-1 opacity-75",children:["Error: ",T.error]}),T.isLoading&&e.jsxs("div",{className:"flex items-center gap-2 text-xs mt-1",children:[e.jsx("div",{className:"animate-spin h-3 w-3 border border-current border-t-transparent rounded-full"}),"Loading fresh data from ",T.dataSource,"..."]})]})]})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"staff_id",children:"Assigned To *"}),e.jsxs(le,{value:x.staff_id,onValueChange:R=>C({...x,staff_id:R}),children:[e.jsx(ie,{className:E.staff_id?"border-red-500":"",children:e.jsx(ce,{placeholder:"Select Staff"})}),e.jsx(oe,{children:c.map(R=>e.jsx(S,{value:R.$id||"",children:R.staff_name},R.$id))})]}),E.staff_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:E.staff_id})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx($,{htmlFor:"completed_quantity",children:"Completed Quantity"}),e.jsx(G,{id:"completed_quantity",type:"number",value:x.completed_quantity,onChange:R=>C({...x,completed_quantity:R.target.value})})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"date_completed",children:"Date Completed"}),e.jsx(G,{id:"date_completed",type:"date",value:x.date_completed,onChange:R=>C({...x,date_completed:R.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx($,{htmlFor:"wastage_quantity",children:"Wastage Quantity"}),e.jsx(G,{id:"wastage_quantity",type:"number",step:"0.01",min:"0",value:x.wastage_quantity,onChange:R=>C({...x,wastage_quantity:R.target.value}),className:E.wastage_quantity?"border-red-500":""}),E.wastage_quantity&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:E.wastage_quantity})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"status",children:"Status"}),e.jsxs(le,{value:x.status,onValueChange:R=>C({...x,status:R}),children:[e.jsx(ie,{children:e.jsx(ce,{placeholder:"Select Status"})}),e.jsx(oe,{children:cc.map(R=>e.jsx(S,{value:R.value,children:R.label},R.value))})]})]})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"remarks",children:"Remarks"}),e.jsx(ns,{id:"remarks",value:x.remarks,onChange:R=>C({...x,remarks:R.target.value}),placeholder:"Enter any remarks",rows:3})]})]}),e.jsxs(it,{className:"flex-col sm:flex-row gap-2 pt-4",children:[e.jsx(A,{type:"button",variant:"outline",onClick:Q,className:"w-full sm:w-auto",children:"Cancel"}),e.jsx(A,{type:"submit",disabled:n,className:"w-full sm:w-auto",children:n?"Saving...":a?"Update":"Save"})]})]})]})})},uc=()=>{const r=mt(),t=Re({mutationFn:n=>st.createDocument(at,ke.PRE_PRODUCTION_TASKS,hs.unique(),n),onSuccess:()=>{queueMicrotask(()=>{r.invalidateQueries({queryKey:["preProductionTasks"]})})}}),s=Re({mutationFn:({id:n,data:i})=>st.updateDocument(at,ke.PRE_PRODUCTION_TASKS,n,i),onSuccess:()=>{queueMicrotask(()=>{r.invalidateQueries({queryKey:["preProductionTasks"]})})}}),a=Re({mutationFn:n=>st.deleteDocument(at,ke.PRE_PRODUCTION_TASKS,n),onSuccess:()=>{queueMicrotask(()=>{r.invalidateQueries({queryKey:["preProductionTasks"]})})}});return{createTask:t,updateTask:s,deleteTask:a}},mc=()=>{const r=mt(),[t,s]=u.useState(""),[a,n]=u.useState(!1),[i,c]=u.useState(null),[m,d]=u.useState([]),[o,f]=u.useState({show:!1,message:"",type:"success"}),[N,g]=u.useState("all"),[y,j]=u.useState("all"),[P,x]=u.useState("all"),[C,E]=u.useState({from:"",to:""}),[D,T]=u.useState(1),[F,K]=u.useState(50),{tasks:O,isLoading:Z,error:M,refetch:z}=Rn(),{createTask:Q,updateTask:R,deleteTask:w}=uc(),{config:Y}=Tt("pre-production-tasks"),{validationRules:_,canImport:H}=Et("pre-production-tasks");Ao("pre-production-tasks");const{currentSort:re,handleSort:I,getSortedData:ee}=rs(),{data:V}=ms(),{data:de}=Va(),{data:U}=Fs(),{toast:h}=Ie(),{data:p}=Ne({queryKey:["pre-production-tasks","all","with-relations"],queryFn:()=>cs.getPreProductionTasksWithRelations()}),L=(l,se)=>{f({show:!0,message:l,type:se}),setTimeout(()=>f({show:!1,message:"",type:"success"}),3e3)},k=O.filter(l=>{const se=l.task_id.toLowerCase().includes(t.toLowerCase())||l.stock_name.toLowerCase().includes(t.toLowerCase())||l.staff_name.toLowerCase().includes(t.toLowerCase())||l.process_name.toLowerCase().includes(t.toLowerCase()),b=N==="all"||l.stock_name.toLowerCase().includes(N.toLowerCase()),X=y==="all"||l.process_name.toLowerCase().includes(y.toLowerCase()),ye=P==="all"||l.staff_name.toLowerCase().includes(P.toLowerCase()),Se=(!C.from||l.date_assigned>=C.from)&&(!C.to||l.date_assigned<=C.to);return se&&b&&X&&ye&&Se}),W=Array.from(new Set(O.map(l=>l.stock_name))).sort(),xe=Array.from(new Set(O.map(l=>l.process_name))).sort(),he=Array.from(new Set(O.map(l=>l.staff_name))).sort(),be=k.length,Fe=Math.ceil(be/F),Me=(D-1)*F,He=Me+F,ht=k.slice(Me,He);u.useEffect(()=>{T(1)},[t,N,y,P,C,F]);const Lt=async l=>{try{i?(await R.mutateAsync({id:i.$id,data:l}),L("Pre-production task updated successfully","success")):(await Q.mutateAsync(l),L("Pre-production task created successfully","success")),n(!1),c(null)}catch(se){console.error("Error saving task:",se),L("Failed to save task","error")}},xt=l=>{c(l),n(!0)},gt=async l=>{if(window.confirm("Are you sure you want to delete this task?"))try{await w.mutateAsync(l.$id),L("Pre-production task deleted successfully","success")}catch(se){console.error("Error deleting task:",se),L("Failed to delete task","error")}},Nt=async()=>{if(m.length===0){L("Please select tasks to delete","error");return}if(window.confirm(`Are you sure you want to delete ${m.length} selected task(s)?`))try{await Promise.all(m.map(l=>w.mutateAsync(l.$id))),d([]),L(`${m.length} tasks deleted successfully`,"success")}catch(l){console.error("Error deleting tasks:",l),L("Failed to delete selected tasks","error")}},wt=()=>{if(m.length===0){L("Please select tasks to export","error");return}L(`Exporting ${m.length} selected task(s)...`,"success")};return M?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Pre-Production Tasks"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage pre-production processing tasks"})]}),e.jsx(ae,{children:e.jsx(ne,{className:"pt-6",children:e.jsxs("div",{className:"text-center py-12 text-red-600",children:[e.jsx("p",{className:"text-lg mb-2",children:"Error loading tasks"}),e.jsx("p",{className:"text-sm mb-4",children:M.message}),e.jsx(A,{onClick:()=>z(),variant:"outline",children:"Retry"})]})})})]}):e.jsxs("div",{className:"space-y-6",children:[o.show&&e.jsx("div",{className:`fixed top-4 right-4 px-4 py-2 rounded-md shadow-lg z-50 ${o.type==="success"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300"}`,children:o.message}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Pre-Production Tasks"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage pre-production processing tasks"})]}),e.jsxs(A,{className:"bg-primary hover:bg-primary/90",onClick:()=>{c(null),n(!0)},children:[e.jsx(Ct,{className:"h-4 w-4 mr-2"}),"Add New"]})]}),e.jsx(ae,{children:e.jsx(ne,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(pt,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(G,{placeholder:"Search tasks...",className:"pl-10",value:t,onChange:l=>s(l.target.value)})]}),H&&Y&&e.jsx(qt,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:Y.exportColumns.filter(l=>l.required).map(l=>l.exportHeader),optionalColumns:Y.exportColumns.filter(l=>!l.required).map(l=>l.exportHeader),validationRules:_,maxFileSize:50,existingData:p||[],duplicateChecker:(l,se)=>{const b=(l["Task ID"]||l.task_id||l.task_id||"").toLowerCase().trim(),X=(l["Stock Name"]||l.stock_name||l.stock_name||"").toLowerCase().trim(),ye=(l["Stock Source"]||l.stock_source||l.stock_source||"").toLowerCase().trim(),Se=l["Date Assigned"]||l.date_assigned||l.date_assigned||"",Oe=(l.Process||l.process_name||l.process_name||"").toLowerCase().trim();let Ue="";if(Se)if(typeof Se=="string"){const Ke=Se.match(/^(\d{2})-(\d{2})-(\d{4})$/);if(Ke){const[,q,ve,_e]=Ke,we=new Date(parseInt(_e),parseInt(ve)-1,parseInt(q));isNaN(we.getTime())||(Ue=we.toISOString().split("T")[0])}else{const q=new Date(Se);isNaN(q.getTime())||(Ue=q.toISOString().split("T")[0])}}else Se instanceof Date&&(Ue=Se.toISOString().split("T")[0]);return se.some(Ke=>{const q=(Ke.task_id||"").toLowerCase().trim(),ve=(Ke.stock_name||"").toLowerCase().trim(),_e=(Ke.stock_source||"").toLowerCase().trim(),we=Ke.date_assigned||"",ft=(Ke.process_name||"").toLowerCase().trim();let Ee="";return we&&(typeof we=="string"?Ee=we:we instanceof Date&&(Ee=we.toISOString().split("T")[0])),b===q&&X===ve&&ye===_e&&Ue===Ee&&Oe===ft})},validationHeaderMapper:l=>{const se=Y.exportColumns.find(b=>b.dataKey===l);return se?se.exportHeader:l},columnMapper:l=>{const se=Y.exportColumns.find(b=>b.exportHeader===l);if(se){if(se.dataKey==="stock_name")return"stock_name";if(se.dataKey==="process_name")return"process_name";if(se.dataKey==="staff_name")return"staff_name";const b={task_id:"task_id",stock_source:"stock_source",date_assigned:"date_assigned",assigned_quantity:"assigned_quantity",date_completed:"date_completed",completed_quantity:"completed_quantity",wastage_quantity:"wastage_quantity",remarks:"remarks",status:"status"};return se.dataKey==="date_completed"?"date_completed":se.dataKey==="completed_quantity"?"completed_quantity":b[se.dataKey]||se.dataKey}return l},dataProcessor:async l=>{let se=l["Stock Name"]||l.stock_name||l.stock_name;if(!se||se==="")throw new Error("Stock Name is required");const b=String(se).trim(),X=de?.find(Ce=>Ce.stock_name.toLowerCase()===b.toLowerCase());if(!X){const Ce=de?.map(Ve=>Ve.stock_name).slice(0,5).join(", ")||"None";throw new Error(`Stock "${b}" not found. Available: ${Ce}`)}const ye=X.$id;let Se=l.Process||l.process_name||l.process_name;if(!Se||Se==="")throw new Error("Process is required");const Oe=String(Se).trim(),Ue=V?.find(Ce=>Ce.process_name.toLowerCase()===Oe.toLowerCase());if(!Ue){const Ce=V?.map(Ve=>Ve.process_name).slice(0,5).join(", ")||"None";throw new Error(`Process "${Oe}" not found. Available: ${Ce}`)}const Ke=Ue.$id;let q="",ve=l["Staff Name"]||l.staff_name||l.staff_name;if(ve&&ve!==""){const Ce=String(ve).trim(),Ve=U?.find(Be=>Be.staff_name.toLowerCase()===Ce.toLowerCase());Ve&&(q=Ve.$id)}const _e=(Ce,Ve)=>{if(!Ce)return Ve||"";let Be=Ce;if(typeof Be=="string"){const Le=Be.match(/^(\d{2})-(\d{2})-(\d{4})$/);if(Le){const[,v,B,ue]=Le,ge=new Date(parseInt(ue),parseInt(B)-1,parseInt(v));if(!isNaN(ge.getTime()))return ge.toISOString().split("T")[0]}else{const v=new Date(Be);if(!isNaN(v.getTime()))return v.toISOString().split("T")[0]}}else if(Be instanceof Date)return Be.toISOString().split("T")[0];return Ve||""},we=_e(l["Date Assigned"]||l.date_assigned||l.date_assigned,new Date().toISOString().split("T")[0]),ft=_e(l["Date Completed"]||l.date_completed||l.date_completed,""),Ee={task_id:l["Task ID"]||l.task_id||l.task_id,stock_id:ye,stock_source:l["Stock Source"]||l.stock_source||l.stock_source||"",date_assigned:we,date_completed:ft||void 0,process_id:Ke,staff_id:q||"",assigned_quantity:parseFloat(l["Assigned Qty"]||l.assigned_quantity||l.assigned_quantity||0),completed_quantity:parseFloat(l["Completed Qty"]||l.completed_quantity||l.completed_quantity||0),wastage_quantity:parseFloat(l["Wastage Qty"]||l.wastage_quantity||l.wastage_quantity||0),status:"completed",remarks:l.Remarks||l.remarks||l.remarks||""};return await cs.create(Ee)},onImportComplete:async l=>{await r.invalidateQueries({queryKey:["pre-production-tasks"],refetchType:"active"}),await r.refetchQueries({queryKey:["pre-production-tasks"]}),z(),l.successfulRows>0&&h({title:"Import Successful",description:`${l.successfulRows} pre-production tasks imported successfully.`}),l.failedRows>0&&h({title:"Import Completed with Errors",description:`${l.successfulRows} successful, ${l.failedRows} failed.`,variant:"destructive"})}},variant:"outline"}),Y&&e.jsx(Rt,{data:k.map(l=>{const se={};return Y.exportColumns.forEach(b=>{const X=l[b.dataKey];se[b.exportHeader]=b.formatter?b.formatter(X):X}),se}),headers:Y.exportColumns.map(l=>l.exportHeader),filename:"pre-production-tasks",variant:"outline"})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs(le,{value:N,onValueChange:g,children:[e.jsx(ie,{className:"w-[180px]",children:e.jsx(ce,{placeholder:"Stock Name"})}),e.jsxs(oe,{children:[e.jsx(S,{value:"all",children:"All Stocks"}),W.map(l=>e.jsx(S,{value:l,children:l},l))]})]}),e.jsxs(le,{value:y,onValueChange:j,children:[e.jsx(ie,{className:"w-[180px]",children:e.jsx(ce,{placeholder:"Process"})}),e.jsxs(oe,{children:[e.jsx(S,{value:"all",children:"All Processes"}),xe.map(l=>e.jsx(S,{value:l,children:l},l))]})]}),e.jsxs(le,{value:P,onValueChange:x,children:[e.jsx(ie,{className:"w-[180px]",children:e.jsx(ce,{placeholder:"Staff Name"})}),e.jsxs(oe,{children:[e.jsx(S,{value:"all",children:"All Staff"}),he.map(l=>e.jsx(S,{value:l,children:l},l))]})]}),e.jsx(G,{type:"date",placeholder:"From Date",className:"w-[150px]",value:C.from,onChange:l=>E(se=>({...se,from:l.target.value}))}),e.jsx(G,{type:"date",placeholder:"To Date",className:"w-[150px]",value:C.to,onChange:l=>E(se=>({...se,to:l.target.value}))})]})]})})}),e.jsx(ae,{children:e.jsxs(ne,{className:"pt-6",children:[m.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 p-3 bg-muted rounded-md",children:[e.jsxs("span",{className:"text-sm font-medium",children:[m.length," selected"]}),e.jsx(A,{variant:"destructive",size:"sm",onClick:Nt,children:"Delete Selected"}),e.jsx(A,{variant:"outline",size:"sm",onClick:wt,children:"Export Selected"})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",Me+1," to ",Math.min(He,be)," of ",be," records"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Records per page:"}),e.jsxs(le,{value:F.toString(),onValueChange:l=>K(Number(l)),children:[e.jsx(ie,{className:"w-[100px]",children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"50",children:"50"}),e.jsx(S,{value:"100",children:"100"}),e.jsx(S,{value:"500",children:"500"})]})]})]})]}),e.jsx("div",{className:"border rounded-md",children:e.jsx("div",{className:"overflow-auto",style:{maxHeight:"600px"},children:e.jsx(us,{data:ee(ht.map(l=>({...l,formattedDateAssigned:new Date(l.date_assigned).toLocaleDateString("en-GB"),formattedDateCompleted:l.date_completed?new Date(l.date_completed).toLocaleDateString("en-GB"):"-"}))),columns:[{key:"task_id",label:"Task ID",sortable:!0,dataType:"string"},{key:"stock_name",label:"Stock Name",sortable:!0,dataType:"string"},{key:"stock_source",label:"Stock Source",sortable:!0,dataType:"string"},{key:"formattedDateAssigned",label:"Date Assigned",sortable:!0,dataType:"date"},{key:"process_name",label:"Process",sortable:!0,dataType:"string"},{key:"assigned_quantity",label:"Assigned Qty",sortable:!0,dataType:"number",align:"right",headerClassName:"bg-purple-50",cellClassName:"bg-purple-50 font-medium"},{key:"staff_name",label:"Staff Name",sortable:!0,dataType:"string"},{key:"formattedDateCompleted",label:"Date Completed",sortable:!0,dataType:"date"},{key:"completed_quantity",label:"Completed Qty",sortable:!0,dataType:"number",align:"right",headerClassName:"bg-green-50",cellClassName:"bg-green-50 font-medium"},{key:"wastage_quantity",label:"Wastage Qty",sortable:!0,dataType:"number",align:"right"},{key:"remarks",label:"Remarks",sortable:!0,dataType:"string"},{key:"status",label:"Status",sortable:!0,dataType:"string",formatter:l=>e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${l==="completed"?"bg-green-100 text-green-800":l==="in_progress"?"bg-yellow-100 text-yellow-800":l==="pending"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:l==="in_progress"?"In Progress":l.charAt(0).toUpperCase()+l.slice(1)})}],onSort:I,currentSort:re,loading:Z,maxHeight:"none",stickyHeader:!0,bordered:!1,searchable:!1,selectable:!0,selectedRows:m,onSelectionChange:d,rowKey:"$id",actions:[Ts.edit(l=>xt(l)),Ts.delete(l=>gt(l))],emptyMessage:"No pre-production tasks found"})})}),Fe>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx(A,{variant:"outline",size:"sm",onClick:()=>T(l=>Math.max(1,l-1)),disabled:D===1,children:"Previous"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",D," of ",Fe]})}),e.jsx(A,{variant:"outline",size:"sm",onClick:()=>T(l=>Math.min(Fe,l+1)),disabled:D===Fe,children:"Next"})]})]})}),e.jsx(dc,{isOpen:a,onClose:()=>{n(!1),c(null)},onSubmit:Lt,editingTask:i,isLoading:Q.isPending||R.isPending})]})},pc=({items:r,onItemsChange:t,availableStocks:s,isLoading:a=!1})=>{const n=()=>{const d={stock_id:"",stock_name:"",quantity:0,action:""};t([...r,d])},i=d=>{const o=r.filter((f,N)=>N!==d);t(o)},c=(d,o,f)=>{const N=[...r];if(N[d]={...N[d],[o]:f},o==="stock_id"){const g=s.find(y=>y.$id===f);N[d].stock_name=g?.stock_name||""}t(N)},m=()=>r.reduce((d,o)=>d+(o.quantity||0),0);return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx($,{className:"text-xs font-medium",children:"Stock Items"}),e.jsxs(A,{type:"button",variant:"outline",size:"sm",onClick:n,disabled:a,className:"h-7 px-2 text-xs",children:[e.jsx(Ct,{className:"h-3 w-3 mr-1"}),"Add Row"]})]}),r.length===0?e.jsxs("div",{className:"text-center py-4 text-muted-foreground border-2 border-dashed rounded-lg",children:[e.jsx("p",{className:"text-xs",children:"No stock items added"}),e.jsx("p",{className:"text-xs",children:'Click "Add Row" to add stock items'})]}):e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsx("div",{className:"max-h-64 overflow-y-auto",children:e.jsxs(yt,{children:[e.jsx(vt,{className:"sticky top-0 bg-white z-10",children:e.jsxs(qe,{children:[e.jsx(te,{className:"text-xs py-2",children:"Stock Name"}),e.jsx(te,{className:"text-xs py-2 w-24",children:"Qty (kg)"}),e.jsx(te,{className:"text-xs py-2 w-20",children:"Action"}),e.jsx(te,{className:"text-xs py-2 w-12",children:"Remove"})]})}),e.jsx(bt,{children:r.map((d,o)=>e.jsxs(qe,{className:"h-10",children:[e.jsx(J,{className:"py-1",children:e.jsxs(le,{value:d.stock_id,onValueChange:f=>c(o,"stock_id",f),disabled:a,children:[e.jsx(ie,{className:"h-7 text-xs",children:e.jsx(ce,{placeholder:"Select Stock"})}),e.jsx(oe,{children:s.map(f=>e.jsxs(S,{value:f.$id||"",children:[f.stock_name," (",f.stock_code,")"]},f.$id))})]})}),e.jsx(J,{className:"py-1",children:e.jsx(G,{type:"number",step:"0.01",min:"0",value:d.quantity||"",onChange:f=>c(o,"quantity",parseFloat(f.target.value)||0),placeholder:"0",disabled:a,className:"h-7 text-xs",maxLength:10})}),e.jsx(J,{className:"py-1",children:e.jsx(G,{value:d.action||"",onChange:f=>c(o,"action",f.target.value),placeholder:"Action",disabled:a,className:"h-7 text-xs"})}),e.jsx(J,{className:"py-1",children:e.jsx(A,{type:"button",variant:"ghost",size:"sm",className:"h-6 w-6 p-0 text-red-500 hover:text-red-700 hover:bg-red-50",onClick:()=>i(o),disabled:a,children:e.jsx(It,{className:"h-3 w-3"})})})]},o))})]})})}),r.length>0&&e.jsx("div",{className:"flex justify-end bg-gray-50 px-3 py-1 rounded",children:e.jsxs("div",{className:"text-xs font-medium",children:["Total Quantity: ",m().toFixed(2)," kg"]})})]})},hc=[{value:"pending",label:"Pending"},{value:"in_progress",label:"In Progress"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"}],xc=({isOpen:r,onClose:t,onSubmit:s,editingTask:a,isLoading:n=!1})=>{const{data:i}=Va(),{data:c}=Fs(),{data:m}=ms(),{data:d}=Ba(),o=m.filter(w=>{const Y=w.department?.toLowerCase();return Y&&Y==="production"?!0:w.process_name?.toLowerCase()==="grinding"}),[f,N]=u.useState({task_id:"",date_assigned:new Date().toISOString().split("T")[0],raw_product_id:"",process_id:"",staff_id:"",source_process_id:"",completed_quantity:"",date_completed:"",wastage_quantity:"",remarks:"",status:"pending"}),[g,y]=u.useState([]),[j,P]=u.useState({}),[x,C]=u.useState(null),E=new Date,D=ts(E),T=es(E),{statusRecords:F}=Ha(D.toISOString().split("T")[0],T.toISOString().split("T")[0],{processId:void 0}),{statusRecords:K}=Ka(D.toISOString().split("T")[0],T.toISOString().split("T")[0],{processId:void 0}),O=()=>{if(!f.source_process_id||!g.length||!f.raw_product_id){C(null);return}const w=g.reduce((p,L)=>p+(L.quantity||0),0);if(w<=0){C({isValid:!1,availableQty:0,requiredQty:w,stockName:"Stock Items",stockSource:"Unknown",error:"Invalid quantity",validationClass:"bg-yellow-50 text-yellow-700 border-yellow-200",validationMessage:"Total quantity must be greater than 0"});return}const Y=m?.find(p=>p.$id===f.source_process_id),_=d?.find(p=>p.$id===f.raw_product_id);if(!Y||!_){C({isValid:!1,availableQty:0,requiredQty:w,stockName:_?.raw_product||"Unknown Product",stockSource:Y?.process_name||"Unknown Process",error:"Missing reference data",validationClass:"bg-red-50 text-red-700 border-red-200",validationMessage:"Source process or raw product not found"});return}const H="Pre-Production Status",I=g[0]?.stock_name||_.raw_product;let ee=K?.find(p=>p.stock_name===I&&p.process===Y.process_name);if(!ee&&I&&(ee=K?.find(p=>p.stock_name?.toLowerCase().includes(I.toLowerCase().split("(")[0].trim())&&p.process===Y.process_name)),!ee){const p=I?.toLowerCase().split("(")[0].trim()||_.raw_product?.toLowerCase();ee=K?.find(L=>L.process===Y.process_name&&L.stock_name?.toLowerCase().includes(p))}const V=ee?.closing_balance??0,de=V>=w;console.log("ðŸ” RTQV Production Status Check (Enhanced):",{raw_product:_.raw_product,stock_name_from_items:I,source_process:Y.process_name,statusRecord_found:!!ee,statusRecord_stock_name:ee?.stock_name,statusRecord_process:ee?.process,closing_balance:ee?.closing_balance,availableQty:V,totalRequiredQty:w,dataSource:H,forced_fresh:!0,stock_items:g.map(p=>({stock_name:p.stock_name,quantity:p.quantity})),all_preproduction_records:K?.map(p=>({stock_name:p.stock_name,process:p.process,closing_balance:p.closing_balance}))});let U="",h="";de?(U="bg-green-50 text-green-700 border-green-200",h=`âœ“ Available: ${V}kg (Required: ${w}kg)`):V===0?(U="bg-red-50 text-red-700 border-red-200",h=`âœ— Out of stock (Required: ${w}kg)`):(U="bg-orange-50 text-orange-700 border-orange-200",h=`âš  Insufficient stock: ${V}kg available (Required: ${w}kg)`),C({isValid:de,availableQty:V,requiredQty:w,stockName:I||_.raw_product,stockSource:Y.process_name,dataSource:H,isLoading:!1,validationClass:U,validationMessage:h})};u.useEffect(()=>{O()},[f.source_process_id,f.raw_product_id,g,m,d,F,K]);const Z=m.filter(w=>w.process_name==="RFP");u.useEffect(()=>{if(r)if(a)N({task_id:a.task_id||"",date_assigned:a.date||"",raw_product_id:a.raw_product_id||"",process_id:a.process_id||"",staff_id:a.staff_id||"",source_process_id:a.source_process_id||"",completed_quantity:a.completed_quantity?.toString()||"",date_completed:a.date_completed||"",wastage_quantity:a.wastage_quantity?.toString()||"",remarks:a.remarks||"",status:a.status||"pending"}),a.stock_items&&y(a.stock_items.map(w=>({stock_id:w.stock_id,stock_name:w.stock_name,quantity:w.quantity,action:w.action||""})));else{const w=`PROD${Date.now().toString().slice(-6)}`;N({task_id:w,date_assigned:new Date().toISOString().split("T")[0],raw_product_id:"",process_id:"",staff_id:"",source_process_id:"",completed_quantity:"",date_completed:"",wastage_quantity:"",remarks:"",status:"pending"}),y([])}},[a,r]);const M=()=>g.reduce((w,Y)=>w+(Y.quantity||0),0),z=()=>{const w={};return f.task_id.trim()||(w.task_id="Task ID is required"),f.date_assigned||(w.date_assigned="Date is required"),f.raw_product_id||(w.raw_product_id="Raw product is required"),f.process_id||(w.process_id="Process is required"),f.staff_id||(w.staff_id="Staff is required"),f.source_process_id||(w.source_process_id="Source process is required"),(!f.completed_quantity||parseFloat(f.completed_quantity)<=0)&&(w.completed_quantity="Completed quantity is required and must be greater than 0"),g.length===0&&(w.stock_items="At least one stock item is required"),f.wastage_quantity&&parseFloat(f.wastage_quantity)<0&&(w.wastage_quantity="Wastage quantity cannot be negative"),g.forEach((Y,_)=>{Y.stock_id||(w[`stock_item_${_}_stock`]=`Stock is required for item ${_+1}`),(!Y.quantity||Y.quantity<=0)&&(w[`stock_item_${_}_quantity`]=`Quantity must be greater than 0 for item ${_+1}`)}),P(w),Object.keys(w).length===0},Q=w=>{if(w.preventDefault(),!z())return;const Y={task_id:f.task_id,date:f.date_assigned,raw_product_id:f.raw_product_id,process_id:f.process_id,staff_id:f.staff_id,source_process_id:f.source_process_id,assigned_quantity:M(),completed_quantity:parseFloat(f.completed_quantity),wastage_quantity:f.wastage_quantity?parseFloat(f.wastage_quantity):void 0,remarks:f.remarks||void 0,status:f.status};f.date_completed&&f.date_completed.trim()!==""&&(Y.date_completed=f.date_completed),s({taskData:Y,stockItems:g})},R=()=>{N({task_id:"",date_assigned:new Date().toISOString().split("T")[0],raw_product_id:"",process_id:"",staff_id:"",source_process_id:"",completed_quantity:"",date_completed:"",wastage_quantity:"",remarks:"",status:"pending"}),y([]),P({}),t()};return e.jsx(lt,{open:r,onOpenChange:R,children:e.jsxs(rt,{className:"sm:max-w-[800px] max-w-[95vw] max-h-[90vh] overflow-y-auto",children:[e.jsxs(nt,{className:"pb-2",children:[e.jsx(ot,{className:"text-lg",children:a?"Edit Production Task":"Add New Production Task"}),e.jsx(ct,{className:"text-sm",children:a?"Update the production task details below.":"Fill in the details to create a new production task."})]}),e.jsxs("form",{onSubmit:Q,children:[e.jsxs("div",{className:"grid gap-3 py-3",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[e.jsxs("div",{children:[e.jsx($,{htmlFor:"task_id",className:"text-xs font-medium",children:"Task ID *"}),e.jsx(G,{id:"task_id",value:f.task_id,onChange:w=>N({...f,task_id:w.target.value}),className:`h-8 text-sm ${j.task_id?"border-red-500":""}`,maxLength:15}),j.task_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:j.task_id})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"date_assigned",className:"text-xs font-medium",children:"Date *"}),e.jsx(G,{id:"date_assigned",type:"date",value:f.date_assigned,onChange:w=>N({...f,date_assigned:w.target.value}),className:`h-8 text-sm ${j.date_assigned?"border-red-500":""}`}),j.date_assigned&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:j.date_assigned})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"process_id",className:"text-xs font-medium",children:"Process *"}),e.jsxs(le,{value:f.process_id,onValueChange:w=>N({...f,process_id:w}),children:[e.jsx(ie,{className:`h-8 text-sm ${j.process_id?"border-red-500":""}`,children:e.jsx(ce,{placeholder:"Select Process"})}),e.jsx(oe,{children:o.map(w=>e.jsx(S,{value:w.$id||"",children:w.process_name},w.$id))})]}),j.process_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:j.process_id})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"source_process_id",className:"text-xs font-medium",children:"Source Process *"}),e.jsxs(le,{value:f.source_process_id,onValueChange:w=>N({...f,source_process_id:w}),children:[e.jsx(ie,{className:`h-8 text-sm ${j.source_process_id?"border-red-500":""}`,children:e.jsx(ce,{placeholder:"Select Source"})}),e.jsx(oe,{children:Z.map(w=>e.jsx(S,{value:w.$id||"",children:w.process_name},w.$id))})]}),j.source_process_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:j.source_process_id})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx($,{htmlFor:"raw_product_id",className:"text-xs font-medium",children:"Raw Product *"}),e.jsxs(le,{value:f.raw_product_id,onValueChange:w=>N({...f,raw_product_id:w}),children:[e.jsx(ie,{className:`h-8 text-sm ${j.raw_product_id?"border-red-500":""}`,children:e.jsx(ce,{placeholder:"Select Raw Product"})}),e.jsx(oe,{children:d.map(w=>e.jsx(S,{value:w.$id||"",children:w.raw_product},w.$id))})]}),j.raw_product_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:j.raw_product_id})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"staff_id",className:"text-xs font-medium",children:"Staff Name *"}),e.jsxs(le,{value:f.staff_id,onValueChange:w=>N({...f,staff_id:w}),children:[e.jsx(ie,{className:`h-8 text-sm ${j.staff_id?"border-red-500":""}`,children:e.jsx(ce,{placeholder:"Select Staff"})}),e.jsx(oe,{children:c.map(w=>e.jsx(S,{value:w.$id||"",children:w.staff_name},w.$id))})]}),j.staff_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:j.staff_id})]})]}),e.jsxs("div",{children:[e.jsx($,{className:"text-base font-semibold",children:"Stock Items"}),e.jsx(pc,{items:g,onItemsChange:y,availableStocks:i,isLoading:n}),j.stock_items&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:j.stock_items}),x&&e.jsxs("div",{className:`mt-2 p-3 rounded-md border text-sm ${x.validationClass}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("div",{className:"font-medium",children:x.stockName}),e.jsxs("div",{className:"text-xs opacity-75",children:["Source: ",x.dataSource]})]}),e.jsx("div",{className:"mb-1",children:x.validationMessage}),x.error&&e.jsxs("div",{className:"text-xs mt-1 opacity-75",children:["Error: ",x.error]}),x.isLoading&&e.jsxs("div",{className:"flex items-center gap-2 text-xs mt-1",children:[e.jsx("div",{className:"animate-spin h-3 w-3 border border-current border-t-transparent rounded-full"}),"Loading fresh data from ",x.dataSource,"..."]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx($,{htmlFor:"assigned_quantity",className:"text-xs font-medium",children:"Assigned Qty (Auto-calculated)"}),e.jsxs("div",{className:"relative",children:[e.jsx(G,{id:"assigned_quantity",type:"number",value:M().toFixed(2),disabled:!0,className:"bg-gray-50 h-8 text-sm pr-8",maxLength:10}),e.jsx("span",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-xs text-gray-500",children:"kg"})]})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"completed_quantity",className:"text-xs font-medium",children:"Completed Qty *"}),e.jsxs("div",{className:"relative",children:[e.jsx(G,{id:"completed_quantity",type:"number",step:"0.01",min:"0",value:f.completed_quantity,onChange:w=>N({...f,completed_quantity:w.target.value}),className:`h-8 text-sm pr-8 ${j.completed_quantity?"border-red-500":""}`,maxLength:10}),e.jsx("span",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-xs text-gray-500",children:"kg"})]}),j.completed_quantity&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:j.completed_quantity})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"wastage_quantity",className:"text-xs font-medium",children:"Wastage Qty"}),e.jsxs("div",{className:"relative",children:[e.jsx(G,{id:"wastage_quantity",type:"number",step:"0.01",min:"0",value:f.wastage_quantity,onChange:w=>N({...f,wastage_quantity:w.target.value}),className:`h-8 text-sm pr-8 ${j.wastage_quantity?"border-red-500":""}`,maxLength:10}),e.jsx("span",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-xs text-gray-500",children:"kg"})]}),j.wastage_quantity&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:j.wastage_quantity})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx($,{htmlFor:"date_completed",className:"text-xs font-medium",children:"Date Completed"}),e.jsx(G,{id:"date_completed",type:"date",value:f.date_completed,onChange:w=>N({...f,date_completed:w.target.value}),className:"h-8 text-sm"})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"status",className:"text-xs font-medium",children:"Status"}),e.jsxs(le,{value:f.status,onValueChange:w=>N({...f,status:w}),children:[e.jsx(ie,{className:"h-8 text-sm",children:e.jsx(ce,{})}),e.jsx(oe,{children:hc.map(w=>e.jsx(S,{value:w.value,children:w.label},w.value))})]})]})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"remarks",className:"text-xs font-medium",children:"Remarks"}),e.jsx(ns,{id:"remarks",value:f.remarks,onChange:w=>N({...f,remarks:w.target.value}),placeholder:"Enter any remarks",rows:2,className:"text-sm resize-none"})]})]}),e.jsxs(it,{className:"pt-3 flex-col sm:flex-row gap-2",children:[e.jsx(A,{type:"button",variant:"outline",onClick:R,className:"h-8 px-4 text-sm w-full sm:w-auto",children:"Cancel"}),e.jsx(A,{type:"submit",disabled:n,className:"h-8 px-4 text-sm w-full sm:w-auto",children:n?"Saving...":a?"Update":"Save"})]})]})]})})},gc=()=>{const r=mt(),[t,s]=u.useState(""),[a,n]=u.useState(!1),[i,c]=u.useState(null),[m,d]=u.useState([]),[o,f]=u.useState({show:!1,message:"",type:"success"}),[N,g]=u.useState("all"),[y,j]=u.useState("all"),[P,x]=u.useState("all"),[C,E]=u.useState({from:"",to:""}),[D,T]=u.useState(1),[F,K]=u.useState(50),{tasks:O,isLoading:Z,error:M,refetch:z}=qn(),{createTask:Q,updateTask:R,deleteTask:w}=Il(),{config:Y}=Tt("production-tasks"),{validationRules:_,canImport:H}=Et("production-tasks"),{currentSort:re,handleSort:I,getSortedData:ee}=rs(),{data:V}=ms(),{data:de}=Ba(),{data:U}=Fs(),{toast:h}=Ie(),{data:p}=Ne({queryKey:["production-tasks","all"],queryFn:()=>zt.getAll()}),L=(l,se)=>{f({show:!0,message:l,type:se}),setTimeout(()=>f({show:!1,message:"",type:"success"}),3e3)},k=O.filter(l=>{const se=l.task_id.toLowerCase().includes(t.toLowerCase())||l.raw_product_name.toLowerCase().includes(t.toLowerCase())||l.staff_name.toLowerCase().includes(t.toLowerCase())||l.process_name.toLowerCase().includes(t.toLowerCase()),b=N==="all"||l.raw_product_name.toLowerCase().includes(N.toLowerCase()),X=y==="all"||l.process_name.toLowerCase().includes(y.toLowerCase()),ye=P==="all"||l.staff_name.toLowerCase().includes(P.toLowerCase()),Se=(!C.from||l.date>=C.from)&&(!C.to||l.date<=C.to);return se&&b&&X&&ye&&Se}),W=Array.from(new Set(O.map(l=>l.raw_product_name))).sort(),xe=Array.from(new Set(O.map(l=>l.process_name))).sort(),he=Array.from(new Set(O.map(l=>l.staff_name))).sort(),be=k.length,Fe=Math.ceil(be/F),Me=(D-1)*F,He=Me+F,ht=k.slice(Me,He);u.useEffect(()=>{T(1)},[t,N,y,P,C,F]);const Lt=async l=>{try{i?(await R.mutateAsync({id:i.$id,taskData:l.taskData,stockItems:l.stockItems}),L("Production task updated successfully","success")):(await Q.mutateAsync(l),L("Production task created successfully","success")),n(!1),c(null)}catch(se){console.error("Error saving task:",se),L("Failed to save task","error")}},xt=l=>{c(l),n(!0)},gt=async l=>{if(window.confirm("Are you sure you want to delete this task?"))try{await w.mutateAsync(l.$id),L("Production task deleted successfully","success")}catch(se){console.error("Error deleting task:",se),L("Failed to delete task","error")}},Nt=async()=>{if(m.length===0){L("Please select tasks to delete","error");return}if(window.confirm(`Are you sure you want to delete ${m.length} selected task(s)?`))try{await Promise.all(m.map(l=>w.mutateAsync(l.$id))),d([]),L(`${m.length} tasks deleted successfully`,"success")}catch(l){console.error("Error deleting tasks:",l),L("Failed to delete selected tasks","error")}},wt=()=>{if(m.length===0){L("Please select tasks to export","error");return}L(`Exporting ${m.length} selected task(s)...`,"success")};return M?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Production Tasks"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage production processing tasks"})]}),e.jsx(ae,{children:e.jsx(ne,{className:"pt-6",children:e.jsxs("div",{className:"text-center py-12 text-red-600",children:[e.jsx("p",{className:"text-lg mb-2",children:"Error loading tasks"}),e.jsx("p",{className:"text-sm mb-4",children:M.message}),e.jsx(A,{onClick:()=>z(),variant:"outline",children:"Retry"})]})})})]}):e.jsxs("div",{className:"space-y-6",children:[o.show&&e.jsx("div",{className:`fixed top-4 right-4 px-4 py-2 rounded-md shadow-lg z-50 ${o.type==="success"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300"}`,children:o.message}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Production Tasks"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage production processing tasks"})]}),e.jsxs(A,{className:"bg-primary hover:bg-primary/90 w-full sm:w-auto",onClick:()=>{c(null),n(!0)},children:[e.jsx(Ct,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"sm:inline",children:"Add New"})]})]}),e.jsx(ae,{children:e.jsx(ne,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4 items-stretch sm:items-center",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(pt,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(G,{placeholder:"Search tasks...",className:"pl-10",value:t,onChange:l=>s(l.target.value)})]}),H&&Y&&e.jsx(qt,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:Y.exportColumns.filter(l=>l.required).map(l=>l.exportHeader),optionalColumns:Y.exportColumns.filter(l=>!l.required).map(l=>l.exportHeader),validationRules:_,maxFileSize:50,existingData:p||[],validationHeaderMapper:l=>{const se=Y.exportColumns.find(b=>b.dataKey===l);return se?se.exportHeader:l},columnMapper:l=>{const se=Y.exportColumns.find(b=>b.exportHeader===l);return se?se.dataKey==="raw_product_name"?"raw_product_name":se.dataKey==="process_name"?"process_name":se.dataKey==="source_process_name"?"source_process_name":se.dataKey==="staff_name"?"staff_name":se.dataKey==="date_completed"?"date_completed":se.dataKey==="completed_quantity"?"completed_quantity":{task_id:"task_id",date:"date",assigned_quantity:"assigned_quantity",wastage_quantity:"wastage_quantity",status:"status"}[se.dataKey]||se.dataKey:l},dataProcessor:async l=>{let se=l["Raw Product"]||l.raw_product_name||l.raw_product_name;if(!se||se==="")throw new Error("Raw Product is required");const b=String(se).trim(),X=de?.find(v=>v.product_name.toLowerCase()===b.toLowerCase());if(!X){const v=de?.map(B=>B.product_name).slice(0,5).join(", ")||"None";throw new Error(`Raw Product "${b}" not found. Available: ${v}`)}const ye=X.$id;let Se=l.Process||l.process_name||l.process_name;if(!Se||Se==="")throw new Error("Process is required");const Oe=String(Se).trim(),Ue=V?.find(v=>v.process_name.toLowerCase()===Oe.toLowerCase());if(!Ue){const v=V?.map(B=>B.process_name).slice(0,5).join(", ")||"None";throw new Error(`Process "${Oe}" not found. Available: ${v}`)}const Ke=Ue.$id;let q="",ve=l["Staff Name"]||l.staff_name||l.staff_name;if(ve&&ve!==""){const v=String(ve).trim(),B=U?.find(ue=>ue.staff_name.toLowerCase()===v.toLowerCase());B&&(q=B.$id)}if(!q&&U&&U.length>0&&(q=U[0].$id),!q)throw new Error("Staff is required. Please ensure staff data is available.");let _e="",we=l["Source Process"]||l.source_process_name||l.source_process_name;if(we&&we!==""){const v=String(we).trim(),B=V?.find(ue=>ue.process_name.toLowerCase()===v.toLowerCase());B&&(_e=B.$id)}if(!_e){const v=V?.find(B=>B.process_name.toLowerCase()==="rfp");v?_e=v.$id:V&&V.length>0&&(_e=V[0].$id)}if(!_e)throw new Error("Source Process is required. Please ensure process data is available.");const ft=v=>{if(!v||v==="")return"";let B=v;if(typeof v=="string"){const ue=v.match(/^(\d{2})-(\d{2})-(\d{4})$/);if(ue){const[,ge,Pe,Te]=ue,Ae=new Date(parseInt(Te),parseInt(Pe)-1,parseInt(ge));isNaN(Ae.getTime())||(B=Ae.toISOString().split("T")[0])}else{const ge=new Date(v);isNaN(ge.getTime())||(B=ge.toISOString().split("T")[0])}}else v instanceof Date&&(B=v.toISOString().split("T")[0]);return B};let Ee=l.Date||l.date||l.date||new Date().toISOString().split("T")[0];Ee=ft(Ee)||new Date().toISOString().split("T")[0];let Ce=l["Date Completed"]||l.date_completed||l.date_completed||Ee;Ce=ft(Ce)||Ee;const Ve=l["Completed Qty"]||l.completed_quantity||l.completed_quantity,Be=Ve!=null&&Ve!==""?parseFloat(String(Ve)):void 0,Le={task_id:l["Task ID"]||l.task_id||l.task_id,date:Ee,raw_product_id:ye,process_id:Ke,staff_id:q,source_process_id:_e,assigned_quantity:parseFloat(l["Assigned Qty"]||l.assigned_quantity||l.assigned_quantity||0),wastage_quantity:parseFloat(l["Wastage Qty"]||l.wastage_quantity||l.wastage_quantity||0),status:"completed"};return Be!==void 0&&!isNaN(Be)&&(Le.completed_quantity=Be),Ce&&(Le.date_completed=Ce),await zt.create(Le)},onImportComplete:async l=>{await r.invalidateQueries({queryKey:["production-tasks"],refetchType:"active"}),await r.refetchQueries({queryKey:["production-tasks"]}),z(),l.successfulRows>0&&h({title:"Import Successful",description:`${l.successfulRows} production tasks imported successfully.`}),l.failedRows>0&&h({title:"Import Completed with Errors",description:`${l.successfulRows} successful, ${l.failedRows} failed.`,variant:"destructive"})}},variant:"outline"}),Y&&e.jsx(Rt,{data:k.map(l=>{const se={};return Y.exportColumns.forEach(b=>{const X=l[b.dataKey];se[b.exportHeader]=b.formatter?b.formatter(X):X}),se}),headers:Y.exportColumns.map(l=>l.exportHeader),filename:"production-tasks",variant:"outline"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-3 sm:gap-4",children:[e.jsxs(le,{value:N,onValueChange:g,children:[e.jsx(ie,{className:"w-full",children:e.jsx(ce,{placeholder:"Raw Product"})}),e.jsxs(oe,{children:[e.jsx(S,{value:"all",children:"All Raw Products"}),W.map(l=>e.jsx(S,{value:l,children:l},l))]})]}),e.jsxs(le,{value:y,onValueChange:j,children:[e.jsx(ie,{className:"w-full",children:e.jsx(ce,{placeholder:"Process"})}),e.jsxs(oe,{children:[e.jsx(S,{value:"all",children:"All Processes"}),xe.map(l=>e.jsx(S,{value:l,children:l},l))]})]}),e.jsxs(le,{value:P,onValueChange:x,children:[e.jsx(ie,{className:"w-full",children:e.jsx(ce,{placeholder:"Staff Name"})}),e.jsxs(oe,{children:[e.jsx(S,{value:"all",children:"All Staff"}),he.map(l=>e.jsx(S,{value:l,children:l},l))]})]}),e.jsx(G,{type:"date",placeholder:"From Date",className:"w-full",value:C.from,onChange:l=>E(se=>({...se,from:l.target.value}))}),e.jsx(G,{type:"date",placeholder:"To Date",className:"w-full",value:C.to,onChange:l=>E(se=>({...se,to:l.target.value}))})]})]})})}),e.jsx(ae,{children:e.jsxs(ne,{className:"pt-6",children:[m.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 p-3 bg-muted rounded-md",children:[e.jsxs("span",{className:"text-sm font-medium",children:[m.length," selected"]}),e.jsx(A,{variant:"destructive",size:"sm",onClick:Nt,children:"Delete Selected"}),e.jsx(A,{variant:"outline",size:"sm",onClick:wt,children:"Export Selected"})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",Me+1," to ",Math.min(He,be)," of ",be," records"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Records per page:"}),e.jsxs(le,{value:F.toString(),onValueChange:l=>K(Number(l)),children:[e.jsx(ie,{className:"w-[100px]",children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"50",children:"50"}),e.jsx(S,{value:"100",children:"100"}),e.jsx(S,{value:"500",children:"500"})]})]})]})]}),e.jsx("div",{className:"border rounded-md",children:e.jsx("div",{className:"overflow-auto",style:{maxHeight:"600px"},children:e.jsx(us,{data:ee(ht.map(l=>({...l,formattedDate:new Date(l.date).toLocaleDateString("en-GB")}))),columns:[{key:"task_id",label:"Task ID",sortable:!0,dataType:"string"},{key:"formattedDate",label:"Date",sortable:!0,dataType:"date"},{key:"raw_product_name",label:"Raw Product",sortable:!0,dataType:"string"},{key:"process_name",label:"Process",sortable:!0,dataType:"string"},{key:"staff_name",label:"Staff Name",sortable:!0,dataType:"string"},{key:"assigned_quantity",label:"Assigned Qty",sortable:!0,dataType:"number",align:"right",headerClassName:"bg-purple-50",cellClassName:"bg-purple-50 font-medium"},{key:"completed_quantity",label:"Completed Qty",sortable:!0,dataType:"number",align:"right",headerClassName:"bg-green-50",cellClassName:"bg-green-50 font-medium"},{key:"wastage_quantity",label:"Wastage Qty",sortable:!0,dataType:"number",align:"right"},{key:"status",label:"Status",sortable:!0,dataType:"string",formatter:l=>e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${l==="completed"?"bg-green-100 text-green-800":l==="in_progress"?"bg-yellow-100 text-yellow-800":l==="pending"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:l==="in_progress"?"In Progress":l.charAt(0).toUpperCase()+l.slice(1)})}],onSort:I,currentSort:re,loading:Z,maxHeight:"none",stickyHeader:!0,bordered:!1,searchable:!1,selectable:!0,selectedRows:m,onSelectionChange:d,rowKey:"$id",actions:[Ts.edit(l=>xt(l)),Ts.delete(l=>gt(l))],emptyMessage:"No production tasks found"})})}),Fe>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx(A,{variant:"outline",size:"sm",onClick:()=>T(l=>Math.max(1,l-1)),disabled:D===1,children:"Previous"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",D," of ",Fe]})}),e.jsx(A,{variant:"outline",size:"sm",onClick:()=>T(l=>Math.min(Fe,l+1)),disabled:D===Fe,children:"Next"})]})]})}),e.jsx(xc,{isOpen:a,onClose:()=>{n(!1),c(null)},onSubmit:Lt,editingTask:i,isLoading:Q.isPending||R.isPending})]})},fc=[{value:"pending",label:"Pending"},{value:"in_progress",label:"In Progress"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"}],jc=({isOpen:r,onClose:t,onSubmit:s,editingTask:a,isLoading:n=!1})=>{const{data:i}=Fs(),{data:c}=ms(),{data:m}=Ln(),{data:d}=Ba(),[o,f]=u.useState({task_id:"",date_assigned:new Date().toISOString().split("T")[0],date_completed:"",raw_product_id:"",source_process_id:"",source_quantity:"",sku:"",product_id:"",process_id:"",staff_id:"",completed_quantity:"",wastage_quantity:"",remarks:"",status:"pending"}),[N,g]=u.useState({}),[y,j]=u.useState(null),P=new Date,x=ts(P),C=es(P),{statusRecords:E}=Mn(x.toISOString().split("T")[0],C.toISOString().split("T")[0]),{statusRecords:D}=Ha(x.toISOString().split("T")[0],C.toISOString().split("T")[0]),T=()=>{if(!o.source_process_id||!o.source_quantity||!o.product_id){j(null);return}const _=parseFloat(o.source_quantity);if(_<=0){j({isValid:!1,availableQty:0,requiredQty:_,stockName:"Source Material",stockSource:"Unknown",error:"Invalid quantity",validationClass:"bg-yellow-50 text-yellow-700 border-yellow-200",validationMessage:"Source quantity must be greater than 0"});return}const H=c?.find(k=>k.$id===o.source_process_id),re=m?.find(k=>k.$id===o.product_id);if(!H||!re){j({isValid:!1,availableQty:0,requiredQty:_,stockName:re?.product_name||"Unknown Product",stockSource:H?.process_name||"Unknown Process",error:"Missing reference data",validationClass:"bg-red-50 text-red-700 border-red-200",validationMessage:"Source process or product not found"});return}let I="",ee=null,V=0;const de=H.process_name?.toLowerCase();if(de==="grinding"){I="Production Status";const k=re.product_name;if(ee=D?.find(W=>W.stock_name===k&&W.process===H.process_name),!ee&&k){const W=k.toLowerCase().split(" ")[0];ee=D?.find(xe=>xe.stock_name?.toLowerCase().includes(W)&&xe.process===H.process_name)}ee||(ee=D?.find(W=>W.process===H.process_name&&(W.stock_name?.toLowerCase().includes("chilli")||W.stock_name?.toLowerCase().includes("powder"))))}else de==="packing"&&(I="Post-Production Status",ee=E?.find(k=>k.product_name===re.product_name&&k.process_name===H.process_name));V=ee?.closing_balance??0;const U=V>=_;console.log("ðŸ” RTQV Post-Production Status Check (Enhanced):",{product_name:re.product_name,source_process:H.process_name,source_process_type:de,statusRecord_found:!!ee,statusRecord_stock_name:ee?.stock_name,statusRecord_process:ee?.process,closing_balance:ee?.closing_balance,availableQty:V,requiredQty:_,dataSource:I,forced_fresh:!0,all_production_records:de==="grinding"?D?.map(k=>({stock_name:k.stock_name,process:k.process,closing_balance:k.closing_balance})):[],all_postproduction_records:de==="packing"?E?.map(k=>({product_name:k.product_name,process_name:k.process_name,closing_balance:k.closing_balance})):[]});let h="",p="";const L=de==="grinding"?"kg":"units";U?(h="bg-green-50 text-green-700 border-green-200",p=`âœ“ Available: ${V}${L} (Required: ${_}${L})`):V===0?(h="bg-red-50 text-red-700 border-red-200",p=`âœ— Out of stock (Required: ${_}${L})`):(h="bg-orange-50 text-orange-700 border-orange-200",p=`âš  Insufficient stock: ${V}${L} available (Required: ${_}${L})`),j({isValid:U,availableQty:V,requiredQty:_,stockName:re.product_name,stockSource:H.process_name,dataSource:I,isLoading:!1,validationClass:h,validationMessage:p})};u.useEffect(()=>{T()},[o.source_process_id,o.product_id,o.source_quantity,c,m,E,D]);const F=c.filter(_=>{const H=_.department?.toLowerCase();if(H&&H==="post-production")return!0;const re=_.process_name?.toLowerCase();return["packing","batch coding"].includes(re)});console.log("All Processes:",c.map(_=>_.process_name)),console.log("Post Production Processes:",F.map(_=>_.process_name));const K=c.find(_=>_.$id===o.process_id),O=K?.process_name==="Batch Coding",Z=K?.process_name==="Packing",M=()=>O,Q=(()=>{if(!o.process_id)return[];const _=c.find(re=>re.$id===o.process_id);if(!_)return[];const H=_.process_name?.toLowerCase();return H==="packing"?c.filter(re=>re.process_name?.toLowerCase()==="grinding"):H==="batch coding"?c.filter(re=>re.process_name?.toLowerCase()==="packing"):[]})();u.useEffect(()=>{o.process_id&&(f(_=>({..._,source_process_id:"",source_quantity:O?"":_.source_quantity,raw_product_id:O?"":_.raw_product_id})),console.log("Selected Process:",K?.process_name),console.log("Is Batch Coding:",O))},[o.process_id,c,O,K]),u.useEffect(()=>{if(r)if(a){const _=H=>{if(!H)return"";try{const re=new Date(H);return isNaN(re.getTime())?"":re.toISOString().split("T")[0]}catch{return""}};f({task_id:a.task_id,date_assigned:_(a.date),date_completed:_(a.date_completed||""),raw_product_id:a.raw_product_id||"",source_process_id:a.source_process_id,source_quantity:a.source_quantity.toString(),sku:a.sku,product_id:a.product_id,process_id:a.process_id,staff_id:a.staff_id,completed_quantity:a.units?.toString()||"",wastage_quantity:a.wastage_quantity?.toString()||"",remarks:a.remarks||"",status:a.status})}else{const _=`POST${Date.now().toString().slice(-6)}`;f({task_id:_,date_assigned:new Date().toISOString().split("T")[0],date_completed:"",raw_product_id:"",source_process_id:"",source_quantity:"",sku:"",product_id:"",process_id:"",staff_id:"",completed_quantity:"",wastage_quantity:"",remarks:"",status:"pending"})}},[a,r]);const R=()=>{const _={},re=c.find(I=>I.$id===o.process_id)?.process_name==="Batch Coding";return o.task_id.trim()||(_.task_id="Task ID is required"),o.date_assigned||(_.date_assigned="Date is required"),!re&&!o.raw_product_id&&(_.raw_product_id="Raw Product is required"),o.process_id||(_.process_id="Process is required"),o.source_process_id||(_.source_process_id="Source process is required"),!re&&(!o.source_quantity||parseFloat(o.source_quantity)<=0)&&(_.source_quantity="Source quantity must be greater than 0"),o.sku.trim()||(_.sku="SKU is required"),o.product_id||(_.product_id="Product is required"),o.staff_id||(_.staff_id="Staff is required"),o.status==="completed"&&((!o.completed_quantity||parseFloat(o.completed_quantity)<=0)&&(_.completed_quantity="Completed units must be greater than 0"),o.wastage_quantity&&parseFloat(o.wastage_quantity)<0&&(_.wastage_quantity="Wastage quantity cannot be negative")),g(_),Object.keys(_).length===0},w=_=>{if(_.preventDefault(),!R())return;const re=c.find(ee=>ee.$id===o.process_id)?.process_name==="Batch Coding",I={task_id:o.task_id,date:o.date_assigned,date_completed:o.status==="completed"?o.date_completed:void 0,source_process_id:o.source_process_id,source_quantity:re?0:parseFloat(o.source_quantity)||0,sku:o.sku,product_id:o.product_id,process_id:o.process_id,staff_id:o.staff_id,units:o.completed_quantity?parseFloat(o.completed_quantity):0,wastage_quantity:o.status==="completed"&&o.wastage_quantity?parseFloat(o.wastage_quantity):void 0,remarks:o.remarks||void 0,status:o.status};console.log("ðŸš€ SUBMITTING POST-PRODUCTION TASK DATA:",I),s(I)},Y=()=>{f({task_id:"",date_assigned:new Date().toISOString().split("T")[0],date_completed:"",raw_product_id:"",source_process_id:"",source_quantity:"",sku:"",product_id:"",process_id:"",staff_id:"",completed_quantity:"",wastage_quantity:"",remarks:"",status:"pending"}),g({}),t()};return e.jsx(lt,{open:r,onOpenChange:Y,children:e.jsxs(rt,{className:"sm:max-w-[600px] max-w-[95vw] max-h-[90vh] overflow-y-auto",children:[e.jsxs(nt,{children:[e.jsx(ot,{children:a?"Edit Post-Production Task":"Add New Post-Production Task"}),e.jsx(ct,{children:a?"Update the post-production task details below.":"Fill in the details to create a new post-production task."})]}),e.jsxs("form",{onSubmit:w,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx($,{htmlFor:"task_id",children:"Task ID *"}),e.jsx(G,{id:"task_id",value:o.task_id,onChange:_=>f({...o,task_id:_.target.value}),className:N.task_id?"border-red-500":""}),N.task_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:N.task_id})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"date_assigned",children:"Date Assigned *"}),e.jsx(G,{id:"date_assigned",type:"date",value:o.date_assigned,onChange:_=>f({...o,date_assigned:_.target.value}),className:N.date_assigned?"border-red-500":""}),N.date_assigned&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:N.date_assigned})]})]}),e.jsxs("div",{children:[e.jsxs($,{htmlFor:"raw_product_id",children:["Raw Product ",!O&&"*",O&&e.jsx("span",{className:"text-muted-foreground",children:"(N/A for Batch Coding)"})]}),O?e.jsx(G,{value:"N/A",disabled:!0,className:"bg-gray-100 text-muted-foreground"}):e.jsxs(le,{value:o.raw_product_id,onValueChange:_=>f({...o,raw_product_id:_}),children:[e.jsx(ie,{className:N.raw_product_id?"border-red-500":"",children:e.jsx(ce,{placeholder:"Select Raw Product"})}),e.jsx(oe,{children:d?.map(_=>e.jsx(S,{value:_.$id||"",children:_.raw_product},_.$id))})]}),N.raw_product_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:N.raw_product_id}),e.jsx("p",{className:"text-muted-foreground text-xs mt-1",children:O?"Batch Coding works with finished products (units), not raw products":"Select the raw product powder (kg) from Grinding process to be packed into units"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx($,{htmlFor:"process_id",children:"Process *"}),e.jsxs(le,{value:o.process_id,onValueChange:_=>f({...o,process_id:_,source_process_id:""}),children:[e.jsx(ie,{className:N.process_id?"border-red-500":"",children:e.jsx(ce,{placeholder:"Select Process"})}),e.jsx(oe,{children:F.map(_=>e.jsx(S,{value:_.$id||"",children:_.process_name},_.$id))})]}),N.process_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:N.process_id})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"source_process_id",children:"Source Process *"}),e.jsxs(le,{value:o.source_process_id,onValueChange:_=>f({...o,source_process_id:_}),children:[e.jsx(ie,{className:N.source_process_id?"border-red-500":"",disabled:!o.process_id,children:e.jsx(ce,{placeholder:o.process_id?"Select Source Process":"First select a Process"})}),e.jsx(oe,{children:Q.map(_=>e.jsx(S,{value:_.$id||"",children:_.process_name},_.$id))})]}),N.source_process_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:N.source_process_id})]})]}),e.jsxs("div",{children:[e.jsxs($,{htmlFor:"source_quantity",children:[Z?"Source Qty (kg) *":"Source Qty"," ",!M()&&!Z&&"*"]}),e.jsx(G,{id:"source_quantity",type:"number",step:"0.01",min:"0",value:M()?"N/A":o.source_quantity,onChange:_=>!M()&&f({...o,source_quantity:_.target.value}),className:N.source_quantity?"border-red-500":"",disabled:M(),placeholder:M()?"N/A":Z?"Raw product quantity in kg":"Enter source quantity"}),N.source_quantity&&!M()&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:N.source_quantity}),M()&&e.jsx("p",{className:"text-muted-foreground text-xs mt-1",children:"Source quantity is not required for Batch Coding"}),Z&&e.jsx("p",{className:"text-muted-foreground text-xs mt-1",children:"Raw product powder quantity from Grinding process"}),y&&!M()&&e.jsxs("div",{className:`mt-2 p-3 rounded-md border text-sm ${y.validationClass}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("div",{className:"font-medium",children:y.stockName}),e.jsxs("div",{className:"text-xs opacity-75",children:["Source: ",y.dataSource]})]}),e.jsx("div",{className:"mb-1",children:y.validationMessage}),y.error&&e.jsxs("div",{className:"text-xs mt-1 opacity-75",children:["Error: ",y.error]}),y.isLoading&&e.jsxs("div",{className:"flex items-center gap-2 text-xs mt-1",children:[e.jsx("div",{className:"animate-spin h-3 w-3 border border-current border-t-transparent rounded-full"}),"Loading fresh data from ",y.dataSource,"..."]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx($,{htmlFor:"sku",children:"SKU *"}),e.jsx(G,{id:"sku",value:o.sku,onChange:_=>f({...o,sku:_.target.value}),className:N.sku?"border-red-500":"",placeholder:"Enter SKU"}),N.sku&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:N.sku})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"product_id",children:"Product *"}),e.jsxs(le,{value:o.product_id,onValueChange:_=>f({...o,product_id:_}),children:[e.jsx(ie,{className:N.product_id?"border-red-500":"",children:e.jsx(ce,{placeholder:"Select Product"})}),e.jsx(oe,{children:m.map(_=>e.jsx(S,{value:_.$id||"",children:_.product},_.$id))})]}),N.product_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:N.product_id})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx($,{htmlFor:"staff_id",children:"Staff Name *"}),e.jsxs(le,{value:o.staff_id,onValueChange:_=>f({...o,staff_id:_}),children:[e.jsx(ie,{className:N.staff_id?"border-red-500":"",children:e.jsx(ce,{placeholder:"Select Staff"})}),e.jsx(oe,{children:i.map(_=>e.jsx(S,{value:_.$id||"",children:_.staff_name},_.$id))})]}),N.staff_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:N.staff_id})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"status",children:"Status"}),e.jsxs(le,{value:o.status,onValueChange:_=>f({...o,status:_}),children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsx(oe,{children:fc.map(_=>e.jsx(S,{value:_.value,children:_.label},_.value))})]})]})]}),o.status==="completed"&&e.jsxs("div",{className:"grid grid-cols-3 gap-4 p-4 border rounded-md bg-muted/50",children:[e.jsxs("div",{children:[e.jsx($,{htmlFor:"date_completed",children:"Date Completed *"}),e.jsx(G,{id:"date_completed",type:"date",value:o.date_completed,onChange:_=>f({...o,date_completed:_.target.value}),className:N.date_completed?"border-red-500":""}),N.date_completed&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:N.date_completed})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"completed_quantity",children:"Completed Units *"}),e.jsx(G,{id:"completed_quantity",type:"number",step:"0.01",min:"0",value:o.completed_quantity,onChange:_=>f({...o,completed_quantity:_.target.value}),className:N.completed_quantity?"border-red-500":"",placeholder:"Enter completed units"}),N.completed_quantity&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:N.completed_quantity})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"wastage_quantity",children:"Wastage Qty"}),e.jsx(G,{id:"wastage_quantity",type:"number",step:"0.01",min:"0",value:o.wastage_quantity,onChange:_=>f({...o,wastage_quantity:_.target.value}),className:N.wastage_quantity?"border-red-500":"",placeholder:"Enter wastage qty (optional)"}),N.wastage_quantity&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:N.wastage_quantity})]})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"remarks",children:"Remarks"}),e.jsx(ns,{id:"remarks",value:o.remarks,onChange:_=>f({...o,remarks:_.target.value}),placeholder:"Enter any remarks",rows:3})]})]}),e.jsxs(it,{className:"flex-col sm:flex-row gap-2 pt-4",children:[e.jsx(A,{type:"button",variant:"outline",onClick:Y,className:"w-full sm:w-auto",children:"Cancel"}),e.jsx(A,{type:"submit",disabled:n,className:"w-full sm:w-auto",children:n?"Saving...":a?"Update":"Save"})]})]})]})})},yc=()=>{const r=mt(),[t,s]=u.useState(""),[a,n]=u.useState(!1),[i,c]=u.useState(null),[m,d]=u.useState([]),[o,f]=u.useState({show:!1,message:"",type:"success"}),[N,g]=u.useState("all"),[y,j]=u.useState("all"),[P,x]=u.useState("all"),[C,E]=u.useState({from:"",to:""}),[D,T]=u.useState(1),[F,K]=u.useState(50),{tasks:O,isLoading:Z,error:M,refetch:z}=An(),{createTask:Q,updateTask:R,deleteTask:w}=Ll(),{config:Y}=Tt("post-production-tasks"),{validationRules:_,canImport:H}=Et("post-production-tasks"),{currentSort:re,handleSort:I,getSortedData:ee}=rs(),{data:V}=ms(),{data:de}=Ln(),{data:U}=Fs(),{toast:h}=Ie(),{data:p}=Ne({queryKey:["post-production-tasks","all"],queryFn:()=>Zt.getAll()}),L=(l,se)=>{f({show:!0,message:l,type:se}),setTimeout(()=>f({show:!1,message:"",type:"success"}),3e3)},k=O.filter(l=>{const se=l.task_id.toLowerCase().includes(t.toLowerCase())||l.product_name.toLowerCase().includes(t.toLowerCase())||l.staff_name.toLowerCase().includes(t.toLowerCase())||l.process_name.toLowerCase().includes(t.toLowerCase())||l.stock_name&&l.stock_name.toLowerCase().includes(t.toLowerCase())||l.sku&&l.sku.toLowerCase().includes(t.toLowerCase()),b=N==="all"||l.product_name.toLowerCase().includes(N.toLowerCase()),X=y==="all"||l.process_name.toLowerCase().includes(y.toLowerCase()),ye=P==="all"||l.staff_name.toLowerCase().includes(P.toLowerCase()),Se=(!C.from||l.date_assigned>=C.from)&&(!C.to||l.date_assigned<=C.to);return se&&b&&X&&ye&&Se}),W=Array.from(new Set(O.map(l=>l.product_name))).sort(),xe=Array.from(new Set(O.map(l=>l.process_name))).sort(),he=Array.from(new Set(O.map(l=>l.staff_name))).sort(),be=k.length,Fe=Math.ceil(be/F),Me=(D-1)*F,He=Me+F,ht=k.slice(Me,He);u.useEffect(()=>{T(1)},[t,N,y,P,C,F]);const Lt=async l=>{try{const se=V.find(X=>X.$id===l.process_id),b=se?.process_name?.toLowerCase()||"packing";if(console.log("ðŸ” Post-production task validation data:",{isEdit:!!i,processId:l.process_id,selectedProcess:se,processName:b,rawProductId:l.product_id,sourceProcessId:l.source_process_id,sourceQuantity:l.source_quantity,productId:l.product_id,allData:l}),i){const X=i.source_quantity||0,ye=parseFloat(l.source_quantity)||0,Se=ye-X;if(console.log("ðŸ”„ Post-production task edit validation:",{originalQuantity:X,newQuantity:ye,quantityDifference:Se,needsValidation:Se>0}),Se<=0)await R.mutateAsync({id:i.$id,data:l}),L("Post-production task updated successfully","success"),n(!1),c(null);else{const Ue=V.find(_e=>_e.$id===l.source_process_id)?.process_name||"Grinding",Ke=b==="batch_coding"||b==="batch coding",q=parseFloat(l.source_quantity)||0;console.log("ðŸš¨ POST-PRODUCTION EDIT VALIDATION TRIGGERED:",{processName:b,sourceProcess:Ue,rawProductId:l.product_id,sourceQuantity:l.source_quantity,quantityToValidate:q,newQuantity:ye,productId:l.product_id});const ve=await validateTaskCreation(b,Ue,q,void 0,l.product_id,async _e=>{const we=_e?{...l,source_quantity:_e}:l;console.log("ðŸ”„ UPDATING POST-PRODUCTION TASK WITH ADJUSTED QUANTITY:",we),await R.mutateAsync({id:i.$id,data:we}),L("Post-production task updated successfully","success"),n(!1),c(null)});console.log("ðŸ” POST-PRODUCTION EDIT VALIDATION RESULT:",ve)}}else{const ye=V.find(Ke=>Ke.$id===l.source_process_id)?.process_name||"Grinding",Se=b==="batch_coding"||b==="batch coding",Oe=parseFloat(l.source_quantity)||0;console.log("ðŸ” PROCESS TYPE DEBUG:",{processName:b,isBatchCoding:Se,sourceQuantity:l.source_quantity,quantityToValidate:Oe}),console.log("ðŸš¨ POST-PRODUCTION NEW TASK VALIDATION:",{processName:b,sourceProcess:ye,rawProductId:l.product_id,sourceQuantity:l.source_quantity,quantityToValidate:Oe,productId:l.product_id});const Ue=l;await Q.mutateAsync(Ue),L("Post-production task created successfully","success"),n(!1),c(null)}}catch(se){console.error("Error saving task:",se),L("Failed to save task","error")}},xt=l=>{c(l),n(!0)},gt=async l=>{if(window.confirm("Are you sure you want to delete this task?"))try{await w.mutateAsync(l.$id),L("Post-production task deleted successfully","success")}catch(se){console.error("Error deleting task:",se),L("Failed to delete task","error")}},Nt=async()=>{if(m.length===0){L("Please select tasks to delete","error");return}if(window.confirm(`Are you sure you want to delete ${m.length} selected task(s)?`))try{await Promise.all(m.map(l=>w.mutateAsync(l.$id))),d([]),L(`${m.length} tasks deleted successfully`,"success")}catch(l){console.error("Error deleting tasks:",l),L("Failed to delete selected tasks","error")}},wt=()=>{if(m.length===0){L("Please select tasks to export","error");return}L(`Exporting ${m.length} selected task(s)...`,"success")};return M?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Post-Production Tasks"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage post-production processing tasks"})]}),e.jsx(ae,{children:e.jsx(ne,{className:"pt-6",children:e.jsxs("div",{className:"text-center py-12 text-red-600",children:[e.jsx("p",{className:"text-lg mb-2",children:"Error loading tasks"}),e.jsx("p",{className:"text-sm mb-4",children:M.message}),e.jsx(A,{onClick:()=>z(),variant:"outline",children:"Retry"})]})})})]}):e.jsxs("div",{className:"space-y-6",children:[o.show&&e.jsx("div",{className:`fixed top-4 right-4 px-4 py-2 rounded-md shadow-lg z-50 ${o.type==="success"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300"}`,children:o.message}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Post-Production Tasks"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage post-production processing tasks"})]}),e.jsxs(A,{className:"bg-primary hover:bg-primary/90",onClick:()=>{c(null),n(!0)},children:[e.jsx(Ct,{className:"h-4 w-4 mr-2"}),"Add New"]})]}),e.jsx(ae,{children:e.jsx(ne,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(pt,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(G,{placeholder:"Search tasks...",className:"pl-10",value:t,onChange:l=>s(l.target.value)})]}),H&&Y&&e.jsx(qt,{config:{allowedFormats:[".csv",".xlsx"],requiredColumns:Y.exportColumns.filter(l=>l.required).map(l=>l.exportHeader),optionalColumns:Y.exportColumns.filter(l=>!l.required).map(l=>l.exportHeader),validationRules:_,maxFileSize:50,existingData:p||[],validationHeaderMapper:l=>{const se=Y.exportColumns.find(b=>b.dataKey===l);return se?se.exportHeader:l},columnMapper:l=>{const se=Y.exportColumns.find(b=>b.exportHeader===l);return se?se.dataKey==="product_name"?"product_name":se.dataKey==="sku"?"sku":se.dataKey==="process_name"?"process_name":se.dataKey==="staff_name"?"staff_name":{task_id:"task_id",date:"date",date_completed:"date_completed",source_quantity:"source_quantity",assigned_quantity:"assigned_quantity",units:"units",wastage_quantity:"wastage_quantity",remarks:"remarks",status:"status"}[se.dataKey]||se.dataKey:l},dataProcessor:async l=>{let se=l.Product||l.product_name||l.product_name,b=l.SKU||l.sku||l.sku;if(!se||se==="")throw new Error("Product is required");const X=String(se).trim(),ye=de?.find(Ee=>Ee.product&&Ee.product.toLowerCase()===X.toLowerCase()||Ee.sku&&Ee.sku.toLowerCase()===(b||"").toLowerCase());if(!ye){const Ee=de?.map(Ce=>Ce.product||Ce.sku).slice(0,5).join(", ")||"None";throw new Error(`Product "${X}" not found. Available: ${Ee}`)}const Se=ye.$id;let Oe=l.Process||l.process_name||l.process_name;if(!Oe||Oe==="")throw new Error("Process is required");const Ue=String(Oe).trim(),Ke=V?.find(Ee=>Ee.process_name.toLowerCase()===Ue.toLowerCase());if(!Ke){const Ee=V?.map(Ce=>Ce.process_name).slice(0,5).join(", ")||"None";throw new Error(`Process "${Ue}" not found. Available: ${Ee}`)}const q=Ke.$id;let ve="",_e=l["Staff Name"]||l.staff_name||l.staff_name;if(_e&&_e!==""){const Ee=String(_e).trim(),Ce=U?.find(Ve=>Ve.staff_name.toLowerCase()===Ee.toLowerCase());Ce&&(ve=Ce.$id)}let we=l["Date Assigned"]||l.Date||l.date_assigned||l.date||new Date().toISOString().split("T")[0];if(we&&typeof we=="string"){const Ee=we.match(/^(\d{2})-(\d{2})-(\d{4})$/);if(Ee){const[,Ce,Ve,Be]=Ee,Le=new Date(parseInt(Be),parseInt(Ve)-1,parseInt(Ce));isNaN(Le.getTime())||(we=Le.toISOString().split("T")[0])}else{const Ce=new Date(we);isNaN(Ce.getTime())||(we=Ce.toISOString().split("T")[0])}}else we instanceof Date&&(we=we.toISOString().split("T")[0]);const ft={task_id:l["Task ID"]||l.task_id||l.task_id,date:we,source_process_id:q,source_quantity:parseFloat(l["Source Qty"]||l.source_quantity||l.source_quantity||0),sku:b||ye.sku||"",product_id:Se,process_id:q,staff_id:ve||"",assigned_quantity:parseFloat(l["Assigned Units"]||l.assigned_quantity||l.assigned_quantity||0),units:parseFloat(l["Completed Units"]||l.units||l.units||0),wastage_quantity:parseFloat(l["Wastage Qty"]||l.wastage_quantity||l.wastage_quantity||0),remarks:l.Remarks||l.remarks||l.remarks||"",status:"completed"};return await Zt.create(ft)},onImportComplete:async l=>{await r.invalidateQueries({queryKey:["post-production-tasks"],refetchType:"active"}),await r.refetchQueries({queryKey:["post-production-tasks"]}),z(),l.successfulRows>0&&h({title:"Import Successful",description:`${l.successfulRows} post-production tasks imported successfully.`}),l.failedRows>0&&h({title:"Import Completed with Errors",description:`${l.successfulRows} successful, ${l.failedRows} failed.`,variant:"destructive"})}},variant:"outline"}),Y&&e.jsx(Rt,{data:k.map(l=>{const se={};return Y.exportColumns.forEach(b=>{const X=l[b.dataKey];se[b.exportHeader]=b.formatter?b.formatter(X):X}),se}),headers:Y.exportColumns.map(l=>l.exportHeader),filename:"post-production-tasks",variant:"outline"})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs(le,{value:N,onValueChange:g,children:[e.jsx(ie,{className:"w-[180px]",children:e.jsx(ce,{placeholder:"Product"})}),e.jsxs(oe,{children:[e.jsx(S,{value:"all",children:"All Products"}),W.map(l=>e.jsx(S,{value:l,children:l},l))]})]}),e.jsxs(le,{value:y,onValueChange:j,children:[e.jsx(ie,{className:"w-[180px]",children:e.jsx(ce,{placeholder:"Process"})}),e.jsxs(oe,{children:[e.jsx(S,{value:"all",children:"All Processes"}),xe.map(l=>e.jsx(S,{value:l,children:l},l))]})]}),e.jsxs(le,{value:P,onValueChange:x,children:[e.jsx(ie,{className:"w-[180px]",children:e.jsx(ce,{placeholder:"Staff Name"})}),e.jsxs(oe,{children:[e.jsx(S,{value:"all",children:"All Staff"}),he.map(l=>e.jsx(S,{value:l,children:l},l))]})]}),e.jsx(G,{type:"date",placeholder:"From Date",className:"w-[150px]",value:C.from,onChange:l=>E(se=>({...se,from:l.target.value}))}),e.jsx(G,{type:"date",placeholder:"To Date",className:"w-[150px]",value:C.to,onChange:l=>E(se=>({...se,to:l.target.value}))})]})]})})}),e.jsx(ae,{children:e.jsxs(ne,{className:"pt-6",children:[m.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 p-3 bg-muted rounded-md",children:[e.jsxs("span",{className:"text-sm font-medium",children:[m.length," selected"]}),e.jsx(A,{variant:"destructive",size:"sm",onClick:Nt,children:"Delete Selected"}),e.jsx(A,{variant:"outline",size:"sm",onClick:wt,children:"Export Selected"})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",Me+1," to ",Math.min(He,be)," of ",be," records"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Records per page:"}),e.jsxs(le,{value:F.toString(),onValueChange:l=>K(Number(l)),children:[e.jsx(ie,{className:"w-[100px]",children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"50",children:"50"}),e.jsx(S,{value:"100",children:"100"}),e.jsx(S,{value:"500",children:"500"})]})]})]})]}),e.jsx("div",{className:"border rounded-md",children:e.jsx("div",{className:"overflow-auto",style:{maxHeight:"600px"},children:e.jsx(us,{data:ee(ht),columns:[{key:"task_id",label:"Task ID",sortable:!0,dataType:"string"},{key:"date",label:"Date Assigned",sortable:!0,dataType:"date"},{key:"date_completed",label:"Date Completed",sortable:!0,dataType:"date"},{key:"source_quantity",label:"Source Qty",sortable:!0,dataType:"number",align:"right"},{key:"sku",label:"SKU",sortable:!0,dataType:"string"},{key:"product_name",label:"Product",sortable:!0,dataType:"string"},{key:"process_name",label:"Process",sortable:!0,dataType:"string"},{key:"staff_name",label:"Staff Name",sortable:!0,dataType:"string"},{key:"units",label:"Completed Units",sortable:!0,dataType:"number",align:"right",headerClassName:"bg-green-50",cellClassName:"bg-green-50 font-medium"},{key:"wastage_quantity",label:"Wastage Qty",sortable:!0,dataType:"number",align:"right"},{key:"remarks",label:"Remarks",sortable:!0,dataType:"string"},{key:"status",label:"Status",sortable:!0,dataType:"string",formatter:l=>e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${l==="completed"?"bg-green-100 text-green-800":l==="in_progress"?"bg-yellow-100 text-yellow-800":l==="pending"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:l==="in_progress"?"In Progress":l.charAt(0).toUpperCase()+l.slice(1)})}],onSort:I,currentSort:re,loading:Z,maxHeight:"none",stickyHeader:!0,bordered:!1,searchable:!1,selectable:!0,selectedRows:m,onSelectionChange:d,rowKey:"$id",actions:[Ts.edit(l=>xt(l)),Ts.delete(l=>gt(l))],emptyMessage:"No post-production tasks found"})})}),Fe>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx(A,{variant:"outline",size:"sm",onClick:()=>T(l=>Math.max(1,l-1)),disabled:D===1,children:"Previous"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",D," of ",Fe]})}),e.jsx(A,{variant:"outline",size:"sm",onClick:()=>T(l=>Math.min(Fe,l+1)),disabled:D===Fe,children:"Next"})]})]})}),e.jsx(jc,{isOpen:a,onClose:()=>{n(!1),c(null)},onSubmit:Lt,editingTask:i,isLoading:Q.isPending||R.isPending})]})},On=Ri,za=u.forwardRef(({className:r,...t},s)=>e.jsx(Zr,{ref:s,className:me("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",r),...t}));za.displayName=Zr.displayName;const _s=u.forwardRef(({className:r,...t},s)=>e.jsx(en,{ref:s,className:me("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",r),...t}));_s.displayName=en.displayName;const _t=u.forwardRef(({className:r,...t},s)=>e.jsx(tn,{ref:s,className:me("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",r),...t}));_t.displayName=tn.displayName;class vc{DEFAULT_OPTIONS={maxWidth:200,maxHeight:90,maxSizeKB:500,allowedTypes:["image/jpeg","image/jpg","image/png","image/svg+xml","image/webp"]};async uploadLogo(t,s={}){const a={...this.DEFAULT_OPTIONS,...s};try{return a.allowedTypes.includes(t.type)?t.size/1024>a.maxSizeKB?{success:!1,error:`File too large. Maximum: ${a.maxSizeKB}KB`}:t.type==="image/svg+xml"?{success:!0,logoBase64:await this.fileToBase64(t)}:{success:!0,logoBase64:await this.scaleImage(t,a.maxWidth,a.maxHeight)}:{success:!1,error:`Invalid file type. Allowed: ${a.allowedTypes.join(", ")}`}}catch(n){return{success:!1,error:n.message||"Failed to process logo"}}}async scaleImage(t,s,a){return new Promise((n,i)=>{const c=new Image,m=document.createElement("canvas"),d=m.getContext("2d");if(!d){i(new Error("Canvas context not available"));return}c.onload=()=>{const{width:f,height:N}=this.calculateDimensions(c.width,c.height,s,a);m.width=f,m.height=N,d.drawImage(c,0,0,f,N);const g=m.toDataURL("image/png",.9);n(g)},c.onerror=()=>i(new Error("Failed to load image"));const o=new FileReader;o.onload=f=>{c.src=f.target?.result},o.onerror=()=>i(new Error("Failed to read file")),o.readAsDataURL(t)})}calculateDimensions(t,s,a,n){let{width:i,height:c}={width:t,height:s};if(i>a||c>n){const m=a/i,d=n/c,o=Math.min(m,d);i=Math.round(i*o),c=Math.round(c*o)}return{width:i,height:c}}fileToBase64(t){return new Promise((s,a)=>{const n=new FileReader;n.onload=()=>s(n.result),n.onerror=()=>a(new Error("Failed to read file")),n.readAsDataURL(t)})}}const bc=new vc;function Nc(){const{toast:r}=Ie(),{settings:t,updateSettings:s}=Nn(),[a,n]=u.useState(!1),[i,c]=u.useState(t.logo||null),m=u.useRef(null),d=(y,j)=>{s({[y]:j})},o=()=>{s({logo:i||void 0}),r({title:"Success",description:"Company profile saved successfully"})},f=async y=>{const j=y.target.files?.[0];if(j){n(!0);try{const P=await bc.uploadLogo(j,{maxWidth:200,maxHeight:90,maxSizeKB:500});P.success&&P.logoBase64?(c(P.logoBase64),r({title:"Logo uploaded successfully",description:"Logo has been scaled to fit 200x90px"})):r({title:"Upload failed",description:P.error||"Unknown error",variant:"destructive"})}catch(P){r({title:"Upload failed",description:P.message||"Failed to process logo",variant:"destructive"})}finally{n(!1),m.current&&(m.current.value="")}}},N=()=>{c(null),r({title:"Logo removed",description:"Logo has been removed"})},g=()=>{m.current?.click()};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(ae,{children:[e.jsxs(fe,{children:[e.jsx(je,{children:"Company Information"}),e.jsx(De,{children:"Basic information about your company"})]}),e.jsxs(ne,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx($,{children:"Company Logo"}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:i?e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"w-48 h-20 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg flex items-center justify-center bg-gray-50 dark:bg-gray-800 overflow-hidden",children:e.jsx("img",{src:i,alt:"Company Logo",className:"max-w-full max-h-full object-contain dark:brightness-90"})}),e.jsx(A,{variant:"destructive",size:"sm",className:"absolute -top-2 -right-2 h-6 w-6 rounded-full p-0 opacity-0 group-hover:opacity-100 transition-opacity",onClick:N,children:e.jsx(ks,{className:"h-3 w-3"})})]}):e.jsx("div",{className:"w-48 h-20 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg flex items-center justify-center bg-gray-50 dark:bg-gray-800 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:g,children:e.jsxs("div",{className:"text-center",children:[e.jsx(Wa,{className:"h-8 w-8 mx-auto text-gray-400 dark:text-gray-500 mb-2"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Click to upload"}),e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:"200x90px"})]})})}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(A,{variant:"outline",onClick:g,disabled:a,className:"gap-2",children:[e.jsx(na,{className:"h-4 w-4"}),a?"Uploading...":"Upload Logo"]}),i&&e.jsxs(A,{variant:"ghost",onClick:N,className:"gap-2 text-red-600 hover:text-red-700",children:[e.jsx(ks,{className:"h-4 w-4"}),"Remove"]})]}),e.jsxs(Qe,{children:[e.jsx(Wa,{className:"h-4 w-4"}),e.jsxs(Ye,{children:[e.jsx("strong",{children:"Requirements:"})," Max 500KB â€¢ 200x90px recommended â€¢ PNG, JPG, SVG, WebP â€¢ Auto-scaled to fit"]})]})]})]}),e.jsx("input",{ref:m,type:"file",accept:"image/*",onChange:f,className:"hidden"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx($,{htmlFor:"companyName",children:"Company Name *"}),e.jsx(G,{id:"companyName",value:t.companyName,onChange:y=>d("companyName",y.target.value)})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"legalName",children:"Legal Name"}),e.jsx(G,{id:"legalName",value:t.legalName,onChange:y=>d("legalName",y.target.value)})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"registrationNumber",children:"Registration Number"}),e.jsx(G,{id:"registrationNumber",value:t.registrationNumber,onChange:y=>d("registrationNumber",y.target.value)})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"taxId",children:"Tax ID / GST Number"}),e.jsx(G,{id:"taxId",value:t.taxId,onChange:y=>d("taxId",y.target.value)})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"industryType",children:"Industry Type"}),e.jsxs(le,{value:t.industryType,onValueChange:y=>d("industryType",y),children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"Manufacturing",children:"Manufacturing"}),e.jsx(S,{value:"Trading",children:"Trading"}),e.jsx(S,{value:"Services",children:"Services"}),e.jsx(S,{value:"Retail",children:"Retail"})]})]})]})]})]})]}),e.jsxs(ae,{children:[e.jsxs(fe,{children:[e.jsx(je,{children:"Contact Information"}),e.jsx(De,{children:"How to reach your company"})]}),e.jsxs(ne,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx($,{htmlFor:"address",children:"Address"}),e.jsx(ns,{id:"address",value:t.address,onChange:y=>d("address",y.target.value),rows:2})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx($,{htmlFor:"city",children:"City"}),e.jsx(G,{id:"city",value:t.city,onChange:y=>d("city",y.target.value)})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"state",children:"State"}),e.jsx(G,{id:"state",value:t.state,onChange:y=>d("state",y.target.value)})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"postalCode",children:"Postal Code"}),e.jsx(G,{id:"postalCode",value:t.postalCode,onChange:y=>d("postalCode",y.target.value)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx($,{htmlFor:"phone",children:"Phone"}),e.jsx(G,{id:"phone",value:t.phone,onChange:y=>d("phone",y.target.value)})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"email",children:"Email"}),e.jsx(G,{id:"email",type:"email",value:t.email,onChange:y=>d("email",y.target.value)})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"website",children:"Website"}),e.jsx(G,{id:"website",value:t.website,onChange:y=>d("website",y.target.value)})]})]})]})]}),e.jsxs(ae,{children:[e.jsxs(fe,{children:[e.jsx(je,{children:"Business Settings"}),e.jsx(De,{children:"Configure your business preferences"})]}),e.jsx(ne,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx($,{htmlFor:"fiscalYearStart",children:"Fiscal Year Start Month"}),e.jsxs(le,{value:t.fiscalYearStart,onValueChange:y=>d("fiscalYearStart",y),children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"01",children:"January"}),e.jsx(S,{value:"04",children:"April"}),e.jsx(S,{value:"07",children:"July"}),e.jsx(S,{value:"10",children:"October"})]})]})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"currency",children:"Default Currency"}),e.jsxs(le,{value:t.currency,onValueChange:y=>d("currency",y),children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"INR",children:"INR - Indian Rupee"}),e.jsx(S,{value:"USD",children:"USD - US Dollar"}),e.jsx(S,{value:"EUR",children:"EUR - Euro"}),e.jsx(S,{value:"GBP",children:"GBP - British Pound"})]})]})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"timezone",children:"Time Zone"}),e.jsxs(le,{value:t.timezone,onValueChange:y=>d("timezone",y),children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"Asia/Kolkata",children:"Asia/Kolkata (IST)"}),e.jsx(S,{value:"America/New_York",children:"America/New_York (EST)"}),e.jsx(S,{value:"Europe/London",children:"Europe/London (GMT)"}),e.jsx(S,{value:"Asia/Dubai",children:"Asia/Dubai (GST)"})]})]})]})]})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(A,{onClick:o,className:"gap-2",children:[e.jsx(ha,{className:"h-4 w-4"}),"Save Changes"]})})]})}const rr="molaga_users",nr="molaga_roles",ir=[{id:"super_admin",name:"Super Admin",description:"Full system access",permissions:{masterData:"full",purchases:"full",tasks:"full",sales:"full",status:"full",reports:"full",settings:"full"},isSystemRole:!0},{id:"admin",name:"Admin",description:"All except system configuration",permissions:{masterData:"full",purchases:"full",tasks:"full",sales:"full",status:"full",reports:"full",settings:"edit"},isSystemRole:!0},{id:"manager",name:"Manager",description:"View all, edit assigned",permissions:{masterData:"view",purchases:"edit",tasks:"edit",sales:"edit",status:"view",reports:"view",settings:"none"},isSystemRole:!0},{id:"staff",name:"Staff",description:"Limited access",permissions:{masterData:"view",purchases:"view",tasks:"edit",sales:"view",status:"view",reports:"none",settings:"none"},isSystemRole:!0},{id:"viewer",name:"Viewer",description:"Read-only access",permissions:{masterData:"view",purchases:"view",tasks:"view",sales:"view",status:"view",reports:"view",settings:"none"},isSystemRole:!0}],wc=[{id:"1",name:"Admin User",email:"admin@molaga.com",role:"super_admin",status:"active",lastLogin:new Date().toISOString(),createdAt:new Date().toISOString()}];class Sc{users;roles;constructor(){this.users=this.loadUsers(),this.roles=this.loadRoles()}loadUsers(){try{const t=localStorage.getItem(rr);if(t)return JSON.parse(t)}catch(t){console.error("Error loading users:",t)}return[...wc]}saveUsers(){try{localStorage.setItem(rr,JSON.stringify(this.users))}catch(t){console.error("Error saving users:",t)}}getAllUsers(){return[...this.users]}getUserById(t){return this.users.find(s=>s.id===t)}createUser(t){const s={...t,id:Date.now().toString(),createdAt:new Date().toISOString()};return this.users.push(s),this.saveUsers(),s}updateUser(t,s){const a=this.users.findIndex(n=>n.id===t);return a===-1?null:(this.users[a]={...this.users[a],...s},this.saveUsers(),this.users[a])}deleteUser(t){const s=this.users.findIndex(a=>a.id===t);return s===-1?!1:(this.users.splice(s,1),this.saveUsers(),!0)}loadRoles(){try{const t=localStorage.getItem(nr);if(t){const s=JSON.parse(t),a=[...ir];return s.forEach(n=>{n.isSystemRole||a.push(n)}),a}}catch(t){console.error("Error loading roles:",t)}return[...ir]}saveRoles(){try{const t=this.roles.filter(s=>!s.isSystemRole);localStorage.setItem(nr,JSON.stringify(t))}catch(t){console.error("Error saving roles:",t)}}getAllRoles(){return[...this.roles]}getRoleById(t){return this.roles.find(s=>s.id===t)}createRole(t){const s={...t,id:Date.now().toString(),isSystemRole:!1};return this.roles.push(s),this.saveRoles(),s}updateRole(t,s){const a=this.roles.findIndex(n=>n.id===t);return a===-1||this.roles[a].isSystemRole?null:(this.roles[a]={...this.roles[a],...s},this.saveRoles(),this.roles[a])}deleteRole(t){const s=this.roles.findIndex(a=>a.id===t);return s===-1||this.roles[s].isSystemRole?!1:(this.roles.splice(s,1),this.saveRoles(),!0)}}const Ft=new Sc;function _c(){const[r,t]=u.useState(Ft.getAllUsers()),s=u.useCallback(()=>{t(Ft.getAllUsers())},[]),a=u.useCallback(c=>{const m=Ft.createUser(c);return s(),m},[s]),n=u.useCallback((c,m)=>{const d=Ft.updateUser(c,m);return s(),d},[s]),i=u.useCallback(c=>{const m=Ft.deleteUser(c);return m&&s(),m},[s]);return{users:r,createUser:a,updateUser:n,deleteUser:i,refreshUsers:s}}function kc(){const[r,t]=u.useState(Ft.getAllRoles()),s=u.useCallback(()=>{t(Ft.getAllRoles())},[]),a=u.useCallback(c=>{const m=Ft.createRole(c);return s(),m},[s]),n=u.useCallback((c,m)=>{const d=Ft.updateRole(c,m);return s(),d},[s]),i=u.useCallback(c=>{const m=Ft.deleteRole(c);return m&&s(),m},[s]);return{roles:r,createRole:a,updateRole:n,deleteRole:i,refreshRoles:s}}class Cc{RESET_LOG_KEY="password_reset_log";FORCE_CHANGE_KEY="force_password_change";generateTempPassword(){const s="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*";let a="";a+="ABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(Math.random()*26)],a+="abcdefghijklmnopqrstuvwxyz"[Math.floor(Math.random()*26)],a+="0123456789"[Math.floor(Math.random()*10)],a+="!@#$%^&*"[Math.floor(Math.random()*8)];for(let n=a.length;n<12;n++)a+=s[Math.floor(Math.random()*s.length)];return a.split("").sort(()=>Math.random()-.5).join("")}async resetUserPassword(t,s,a,n,i){try{const c=this.generateTempPassword();return this.logPasswordReset({id:Date.now().toString(),userId:t,userName:s,userEmail:a,resetBy:`${i} (${n})`,resetAt:new Date().toISOString(),tempPassword:c,mustChangePassword:!0}),this.setForcePasswordChange(t,!0),{success:!0,tempPassword:c,message:"Password reset successfully. User must change password on next login."}}catch(c){return console.error("Password reset error:",c),{success:!1,message:c.message||"Failed to reset password"}}}logPasswordReset(t){try{const s=this.getResetLogs();s.unshift(t),s.length>100&&s.splice(100),localStorage.setItem(this.RESET_LOG_KEY,JSON.stringify(s))}catch(s){console.error("Error logging password reset:",s)}}getResetLogs(){try{const t=localStorage.getItem(this.RESET_LOG_KEY);return t?JSON.parse(t):[]}catch(t){return console.error("Error loading reset logs:",t),[]}}setForcePasswordChange(t,s){try{const a=this.getForceChangeFlags();a[t]=s,localStorage.setItem(this.FORCE_CHANGE_KEY,JSON.stringify(a))}catch(a){console.error("Error setting force change flag:",a)}}mustChangePassword(t){try{return this.getForceChangeFlags()[t]===!0}catch(s){return console.error("Error checking force change flag:",s),!1}}clearForcePasswordChange(t){this.setForcePasswordChange(t,!1)}getForceChangeFlags(){try{const t=localStorage.getItem(this.FORCE_CHANGE_KEY);return t?JSON.parse(t):{}}catch(t){return console.error("Error loading force change flags:",t),{}}}getUserResetLogs(t){return this.getResetLogs().filter(a=>a.userId===t)}clearOldLogs(){try{const t=this.getResetLogs(),s=new Date;s.setDate(s.getDate()-90);const a=t.filter(i=>new Date(i.resetAt)>s),n=t.length-a.length;return localStorage.setItem(this.RESET_LOG_KEY,JSON.stringify(a)),n}catch(t){return console.error("Error clearing old logs:",t),0}}}const Pc=new Cc;function Dc(){const{toast:r}=Ie(),{user:t}=jt(),{users:s,createUser:a,updateUser:n,deleteUser:i}=_c(),{roles:c}=kc(),[m,d]=u.useState(""),[o,f]=u.useState(!1),[N,g]=u.useState(null),[y,j]=u.useState(!1),[P,x]=u.useState(null),[C,E]=u.useState(""),[D,T]=u.useState({name:"",email:"",phone:"",role:"",department:"",employeeId:"",status:"active"}),F=s.filter(w=>w.name.toLowerCase().includes(m.toLowerCase())||w.email.toLowerCase().includes(m.toLowerCase())),K=()=>{g(null),T({name:"",email:"",phone:"",role:"",department:"",employeeId:"",status:"active"}),f(!0)},O=w=>{g(w),T({name:w.name,email:w.email,phone:w.phone||"",role:w.role,department:w.department||"",employeeId:w.employeeId||"",status:w.status}),f(!0)},Z=w=>{confirm("Are you sure you want to delete this user?")&&i(w)&&r({title:"User deleted successfully"})},M=w=>{x(w),E(""),j(!0)},z=async()=>{if(!P||!t)return;const w=await Pc.resetUserPassword(P.id,P.name,P.email,t.$id,t.name);w.success&&w.tempPassword?(E(w.tempPassword),r({title:"Password Reset Successfully",description:"Temporary password has been generated. Please share it securely with the user."})):(r({title:"Password Reset Failed",description:w.message,variant:"destructive"}),j(!1),x(null))},Q=()=>{navigator.clipboard.writeText(C),r({title:"Copied!",description:"Temporary password copied to clipboard"})},R=()=>{if(!D.name||!D.email||!D.role){r({title:"Please fill in all required fields",variant:"destructive"});return}N?(n(N.id,D),r({title:"User updated successfully"})):(a(D),r({title:"User created successfully"})),f(!1)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(ae,{children:[e.jsx(fe,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(je,{children:"User Management"}),e.jsx(De,{children:"Manage system users and their access"})]}),e.jsxs(A,{onClick:K,className:"gap-2",children:[e.jsx(qi,{className:"h-4 w-4"}),"Add User"]})]})}),e.jsxs(ne,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pt,{className:"h-4 w-4 text-muted-foreground"}),e.jsx(G,{placeholder:"Search users...",value:m,onChange:w=>d(w.target.value),className:"max-w-sm"})]}),e.jsxs(yt,{children:[e.jsx(vt,{children:e.jsxs(qe,{children:[e.jsx(te,{children:"Name"}),e.jsx(te,{children:"Email"}),e.jsx(te,{children:"Role"}),e.jsx(te,{children:"Status"}),e.jsx(te,{children:"Last Login"}),e.jsx(te,{className:"text-right",children:"Actions"})]})}),e.jsx(bt,{children:F.map(w=>e.jsxs(qe,{children:[e.jsx(J,{className:"font-medium",children:w.name}),e.jsx(J,{children:w.email}),e.jsx(J,{children:w.role}),e.jsx(J,{children:e.jsx(We,{variant:w.status==="active"?"default":"secondary",children:w.status})}),e.jsx(J,{children:w.lastLogin}),e.jsx(J,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(A,{variant:"ghost",size:"sm",onClick:()=>M(w),title:"Reset Password",children:e.jsx(Ys,{className:"h-4 w-4"})}),e.jsx(A,{variant:"ghost",size:"sm",onClick:()=>O(w),children:e.jsx(as,{className:"h-4 w-4"})}),e.jsx(A,{variant:"ghost",size:"sm",onClick:()=>Z(w.id),children:e.jsx(It,{className:"h-4 w-4"})})]})})]},w.id))})]})]})]}),e.jsxs(ae,{children:[e.jsxs(fe,{children:[e.jsx(je,{children:"Roles & Permissions"}),e.jsx(De,{children:"Configure user roles and their permissions"})]}),e.jsx(ne,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:c.map(w=>e.jsxs(ae,{children:[e.jsxs(fe,{children:[e.jsx(je,{className:"text-base",children:w.name}),w.isSystemRole&&e.jsx(We,{variant:"secondary",className:"w-fit",children:"System Role"})]}),e.jsxs(ne,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:w.description}),e.jsx("div",{className:"text-xs text-muted-foreground mb-3",children:e.jsx("div",{className:"grid grid-cols-2 gap-1",children:Object.entries(w.permissions).slice(0,4).map(([Y,_])=>e.jsxs("div",{children:[Y,": ",e.jsx("span",{className:"font-medium",children:_})]},Y))})}),e.jsx(A,{variant:"outline",size:"sm",className:"w-full",disabled:w.isSystemRole,children:w.isSystemRole?"View Permissions":"Edit Permissions"})]})]},w.id))})})]}),e.jsx(lt,{open:o,onOpenChange:f,children:e.jsxs(rt,{children:[e.jsxs(nt,{children:[e.jsx(ot,{children:N?"Edit User":"Add New User"}),e.jsx(ct,{children:N?"Update user information":"Create a new user account"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx($,{htmlFor:"name",children:"Full Name *"}),e.jsx(G,{id:"name",placeholder:"John Doe",value:D.name,onChange:w=>T({...D,name:w.target.value})})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"email",children:"Email *"}),e.jsx(G,{id:"email",type:"email",placeholder:"john@example.com",value:D.email,onChange:w=>T({...D,email:w.target.value})})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"phone",children:"Phone"}),e.jsx(G,{id:"phone",placeholder:"+91 9876543210",value:D.phone,onChange:w=>T({...D,phone:w.target.value})})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"role",children:"Role *"}),e.jsxs(le,{value:D.role,onValueChange:w=>T({...D,role:w}),children:[e.jsx(ie,{children:e.jsx(ce,{placeholder:"Select role"})}),e.jsx(oe,{children:c.map(w=>e.jsx(S,{value:w.id,children:w.name},w.id))})]})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"department",children:"Department"}),e.jsx(G,{id:"department",placeholder:"Production",value:D.department,onChange:w=>T({...D,department:w.target.value})})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"employeeId",children:"Employee ID"}),e.jsx(G,{id:"employeeId",placeholder:"EMP001",value:D.employeeId,onChange:w=>T({...D,employeeId:w.target.value})})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"status",children:"Status"}),e.jsxs(le,{value:D.status,onValueChange:w=>T({...D,status:w}),children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"active",children:"Active"}),e.jsx(S,{value:"inactive",children:"Inactive"})]})]})]})]}),e.jsxs(it,{children:[e.jsx(A,{variant:"outline",onClick:()=>f(!1),children:"Cancel"}),e.jsx(A,{onClick:R,children:N?"Update":"Create"})]})]})}),e.jsx(lt,{open:y,onOpenChange:j,children:e.jsxs(rt,{children:[e.jsxs(nt,{children:[e.jsx(ot,{children:"Reset Password"}),e.jsxs(ct,{children:["Reset password for ",P?.name]})]}),e.jsx("div",{className:"space-y-4 py-4",children:C?e.jsxs(e.Fragment,{children:[e.jsxs(Qe,{children:[e.jsx(Ys,{className:"h-4 w-4"}),e.jsx(Ye,{children:"Password reset successfully! Please share this temporary password securely with the user."})]}),e.jsxs("div",{children:[e.jsx($,{children:"Temporary Password"}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(G,{value:C,readOnly:!0,className:"font-mono"}),e.jsx(A,{variant:"outline",size:"icon",onClick:Q,children:e.jsx(Vs,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"User must change this password on next login"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(Qe,{children:[e.jsx(Ys,{className:"h-4 w-4"}),e.jsx(Ye,{children:"A temporary password will be generated. The user will be required to change it on next login."})]}),e.jsxs("div",{children:[e.jsx($,{children:"User Email"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:P?.email})]})]})}),e.jsx(it,{children:C?e.jsx(A,{onClick:()=>{j(!1),x(null),E("")},children:"Close"}):e.jsxs(e.Fragment,{children:[e.jsx(A,{variant:"outline",onClick:()=>j(!1),children:"Cancel"}),e.jsxs(A,{onClick:z,className:"gap-2",children:[e.jsx(Ys,{className:"h-4 w-4"}),"Generate Password"]})]})})]})})]})}class Tc{async registerWithApproval(t,s,a){try{const n=await Vt.create(hs.unique(),t,s,a),i={approvalStatus:"pending",registeredAt:new Date().toISOString(),role:"viewer"};await Vt.updatePrefs(i);try{await Vt.deleteSession("current")}catch{}return{success:!0,message:"Registration successful. Please wait for admin approval.",userId:n.$id}}catch(n){return console.error("Registration error:",n),{success:!1,message:n.message||"Registration failed"}}}async checkApprovalStatus(t){try{const a=(await Vt.get()).prefs;return!a.approvalStatus||a.approvalStatus==="approved"?{approved:!0,status:"approved",message:"User is approved"}:a.approvalStatus==="pending"?{approved:!1,status:"pending",message:"Your account is pending approval. Please wait for admin approval."}:a.approvalStatus==="rejected"?{approved:!1,status:"rejected",message:`Your account was rejected. Reason: ${a.rejectionReason||"Not specified"}`}:{approved:!1,status:"pending",message:"Unknown approval status"}}catch(s){return console.error("Approval check error:",s),{approved:!1,status:"pending",message:"Could not verify approval status"}}}async approveUser(t,s,a="viewer"){try{return{success:!0,message:"User approved successfully"}}catch(n){return console.error("Approval error:",n),{success:!1,message:n.message||"Failed to approve user"}}}async rejectUser(t,s,a){try{return{success:!0,message:"User rejected"}}catch(n){return console.error("Rejection error:",n),{success:!1,message:n.message||"Failed to reject user"}}}getPendingUsers(){try{const t=localStorage.getItem("pending_users");return t?JSON.parse(t):[]}catch(t){return console.error("Error loading pending users:",t),[]}}addPendingUser(t){try{const s=this.getPendingUsers();s.push(t),localStorage.setItem("pending_users",JSON.stringify(s))}catch(s){console.error("Error adding pending user:",s)}}removePendingUser(t){try{const a=this.getPendingUsers().filter(n=>n.$id!==t);localStorage.setItem("pending_users",JSON.stringify(a))}catch(s){console.error("Error removing pending user:",s)}}updatePendingUserStatus(t,s,a){try{const n=this.getPendingUsers(),i=n.find(c=>c.$id===t);i&&(i.approvalStatus=s,a&&(i.rejectionReason=a),localStorage.setItem("pending_users",JSON.stringify(n)))}catch(n){console.error("Error updating pending user:",n)}}}const bs=new Tc;function Ec(){const{toast:r}=Ie(),{user:t}=jt(),[s,a]=u.useState(bs.getPendingUsers()),[n,i]=u.useState(null),[c,m]=u.useState(!1),[d,o]=u.useState(!1),[f,N]=u.useState("viewer"),[g,y]=u.useState(""),j=Ft.getAllRoles(),P=()=>{a(bs.getPendingUsers())},x=T=>{i(T),N("viewer"),m(!0)},C=T=>{i(T),y(""),o(!0)},E=async()=>{if(!(!n||!t))try{Ft.createUser({name:n.name,email:n.email,role:f,status:"active"}),bs.updatePendingUserStatus(n.$id,"approved"),bs.removePendingUser(n.$id),r({title:"User Approved",description:`${n.name} has been approved and can now login.`}),P(),m(!1),i(null)}catch(T){r({title:"Approval Failed",description:T.message||"Failed to approve user",variant:"destructive"})}},D=async()=>{if(!(!n||!t)){if(!g.trim()){r({title:"Reason Required",description:"Please provide a reason for rejection",variant:"destructive"});return}try{bs.updatePendingUserStatus(n.$id,"rejected",g),bs.removePendingUser(n.$id),r({title:"User Rejected",description:`${n.name} has been rejected.`}),P(),o(!1),i(null),y("")}catch(T){r({title:"Rejection Failed",description:T.message||"Failed to reject user",variant:"destructive"})}}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(ae,{children:[e.jsxs(fe,{children:[e.jsx(je,{children:"Pending User Approvals"}),e.jsx(De,{children:"Review and approve new user registrations"})]}),e.jsx(ne,{children:s.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(_a,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No pending user approvals"})]}):e.jsxs(yt,{children:[e.jsx(vt,{children:e.jsxs(qe,{children:[e.jsx(te,{children:"Name"}),e.jsx(te,{children:"Email"}),e.jsx(te,{children:"Provider"}),e.jsx(te,{children:"Registered"}),e.jsx(te,{children:"Status"}),e.jsx(te,{className:"text-right",children:"Actions"})]})}),e.jsx(bt,{children:s.map(T=>e.jsxs(qe,{children:[e.jsx(J,{className:"font-medium",children:T.name}),e.jsx(J,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ma,{className:"h-4 w-4 text-muted-foreground"}),T.email]})}),e.jsx(J,{children:e.jsx(We,{variant:"outline",children:T.provider})}),e.jsx(J,{children:new Date(T.registeredAt).toLocaleDateString()}),e.jsx(J,{children:e.jsxs(We,{variant:"secondary",children:[e.jsx(_a,{className:"h-3 w-3 mr-1"}),"Pending"]})}),e.jsx(J,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(A,{variant:"ghost",size:"sm",onClick:()=>x(T),className:"text-green-600 hover:text-green-700",children:e.jsx(Xt,{className:"h-4 w-4"})}),e.jsx(A,{variant:"ghost",size:"sm",onClick:()=>C(T),className:"text-red-600 hover:text-red-700",children:e.jsx(ka,{className:"h-4 w-4"})})]})})]},T.$id))})]})})]}),e.jsx(lt,{open:c,onOpenChange:m,children:e.jsxs(rt,{children:[e.jsxs(nt,{children:[e.jsx(ot,{children:"Approve User"}),e.jsxs(ct,{children:["Approve ",n?.name," to access the system"]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx($,{children:"Email"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:n?.email})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"role",children:"Assign Role"}),e.jsxs(le,{value:f,onValueChange:N,children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsx(oe,{children:j.map(T=>e.jsx(S,{value:T.id,children:T.name},T.id))})]})]})]}),e.jsxs(it,{children:[e.jsx(A,{variant:"outline",onClick:()=>m(!1),children:"Cancel"}),e.jsxs(A,{onClick:E,className:"gap-2",children:[e.jsx(Xt,{className:"h-4 w-4"}),"Approve User"]})]})]})}),e.jsx(lt,{open:d,onOpenChange:o,children:e.jsxs(rt,{children:[e.jsxs(nt,{children:[e.jsx(ot,{children:"Reject User"}),e.jsxs(ct,{children:["Reject ",n?.name,"'s registration request"]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx($,{children:"Email"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:n?.email})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"reason",children:"Rejection Reason *"}),e.jsx(ns,{id:"reason",placeholder:"Please provide a reason for rejection...",value:g,onChange:T=>y(T.target.value),rows:4})]})]}),e.jsxs(it,{children:[e.jsx(A,{variant:"outline",onClick:()=>o(!1),children:"Cancel"}),e.jsxs(A,{onClick:D,variant:"destructive",className:"gap-2",children:[e.jsx(ka,{className:"h-4 w-4"}),"Reject User"]})]})]})})]})}const $t=u.forwardRef(({className:r,...t},s)=>e.jsx(sn,{className:me("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",r),...t,ref:s,children:e.jsx(Ai,{className:me("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));$t.displayName=sn.displayName;function Rc(){const{toast:r}=Ie(),{settings:t,updateSettings:s}=wn(),a=(i,c)=>{s({[i]:c})},n=()=>{r({title:"System configuration saved successfully"})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(ae,{children:[e.jsxs(fe,{children:[e.jsx(je,{children:"General Settings"}),e.jsx(De,{children:"Configure system-wide preferences"})]}),e.jsx(ne,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx($,{htmlFor:"language",children:"Default Language"}),e.jsxs(le,{value:t.language,onValueChange:i=>a("language",i),children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"en",children:"English"}),e.jsx(S,{value:"hi",children:"Hindi"}),e.jsx(S,{value:"ta",children:"Tamil"}),e.jsx(S,{value:"te",children:"Telugu"})]})]})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"dateFormat",children:"Date Format"}),e.jsxs(le,{value:t.dateFormat,onValueChange:i=>a("dateFormat",i),children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"DD/MM/YYYY",children:"DD/MM/YYYY"}),e.jsx(S,{value:"MM/DD/YYYY",children:"MM/DD/YYYY"}),e.jsx(S,{value:"YYYY-MM-DD",children:"YYYY-MM-DD"})]})]})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"timeFormat",children:"Time Format"}),e.jsxs(le,{value:t.timeFormat,onValueChange:i=>a("timeFormat",i),children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"12",children:"12-hour"}),e.jsx(S,{value:"24",children:"24-hour"})]})]})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"firstDayOfWeek",children:"First Day of Week"}),e.jsxs(le,{value:t.firstDayOfWeek,onValueChange:i=>a("firstDayOfWeek",i),children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"sunday",children:"Sunday"}),e.jsx(S,{value:"monday",children:"Monday"})]})]})]})]})})]}),e.jsxs(ae,{children:[e.jsxs(fe,{children:[e.jsx(je,{children:"Number Formatting"}),e.jsx(De,{children:"Configure how numbers are displayed"})]}),e.jsx(ne,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx($,{htmlFor:"decimalPlaces",children:"Decimal Places"}),e.jsxs(le,{value:t.decimalPlaces,onValueChange:i=>a("decimalPlaces",i),children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"0",children:"0"}),e.jsx(S,{value:"1",children:"1"}),e.jsx(S,{value:"2",children:"2"}),e.jsx(S,{value:"3",children:"3"}),e.jsx(S,{value:"4",children:"4"})]})]})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"thousandSeparator",children:"Thousand Separator"}),e.jsxs(le,{value:t.thousandSeparator,onValueChange:i=>a("thousandSeparator",i),children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:",",children:", (Comma)"}),e.jsx(S,{value:".",children:". (Period)"}),e.jsx(S,{value:" ",children:"  (Space)"})]})]})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"decimalSeparator",children:"Decimal Separator"}),e.jsxs(le,{value:t.decimalSeparator,onValueChange:i=>a("decimalSeparator",i),children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:".",children:". (Period)"}),e.jsx(S,{value:",",children:", (Comma)"})]})]})]})]})})]}),e.jsxs(ae,{children:[e.jsxs(fe,{children:[e.jsx(je,{children:"Display Settings"}),e.jsx(De,{children:"Customize the user interface"})]}),e.jsxs(ne,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx($,{htmlFor:"recordsPerPage",children:"Records Per Page"}),e.jsxs(le,{value:t.recordsPerPage,onValueChange:i=>a("recordsPerPage",i),children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"25",children:"25"}),e.jsx(S,{value:"50",children:"50"}),e.jsx(S,{value:"100",children:"100"}),e.jsx(S,{value:"200",children:"200"})]})]})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"theme",children:"Theme"}),e.jsxs(le,{value:t.theme,onValueChange:i=>a("theme",i),children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"light",children:"Light"}),e.jsx(S,{value:"dark",children:"Dark"}),e.jsx(S,{value:"auto",children:"Auto"})]})]})]})]}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx($,{htmlFor:"sidebarCollapsed",children:"Sidebar Collapsed by Default"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Start with a collapsed sidebar"})]}),e.jsx($t,{id:"sidebarCollapsed",checked:t.sidebarCollapsed,onCheckedChange:i=>a("sidebarCollapsed",i)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx($,{htmlFor:"showTooltips",children:"Show Tooltips"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Display helpful tooltips"})]}),e.jsx($t,{id:"showTooltips",checked:t.showTooltips,onCheckedChange:i=>a("showTooltips",i)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx($,{htmlFor:"enableAnimations",children:"Enable Animations"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Use smooth transitions"})]}),e.jsx($t,{id:"enableAnimations",checked:t.enableAnimations,onCheckedChange:i=>a("enableAnimations",i)})]})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(A,{onClick:n,className:"gap-2",children:[e.jsx(ha,{className:"h-4 w-4"}),"Save Configuration"]})})]})}class qc{BACKUP_VERSION="1.0";APP_VERSION="1.0.0";getCollectionsList(){return["purchases","vendors","stocks","products","raw_products","processes","staff","sales_channels","pre_production_tasks","production_tasks","post_production_tasks","sales_units","sales_records","stock_status","pre_production_status","production_status","post_production_status"]}async exportCollection(t,s){const a=[];let n=0;const i=100;let c=!0;try{for(;c;){const m=await st.listDocuments(at,ke[t],[et.limit(i),et.offset(n)]);a.push(...m.documents),s&&s(a.length,m.total),m.documents.length<i?c=!1:n+=i}return console.log(`âœ“ Exported ${a.length} documents from ${t}`),a}catch(m){return console.error(`Error exporting ${t}:`,m),[]}}async createFullBackup(t){const s=this.getCollectionsList(),a={metadata:{version:this.BACKUP_VERSION,timestamp:new Date().toISOString(),appVersion:this.APP_VERSION,totalRecords:0,totalCollections:s.length,collections:s},collections:{}};let n=0;for(const i of s)try{const c=await this.exportCollection(i,(m,d)=>{t&&t({currentCollection:i,processedCollections:n,totalCollections:s.length,currentRecords:m,totalRecords:a.metadata.totalRecords+m,percentage:Math.round((n+m/d)/s.length*100)})});a.collections[i]=c,a.metadata.totalRecords+=c.length,n++,t&&t({currentCollection:i,processedCollections:n,totalCollections:s.length,currentRecords:c.length,totalRecords:a.metadata.totalRecords,percentage:Math.round(n/s.length*100)})}catch(c){console.error(`Failed to backup ${i}:`,c),a.collections[i]=[]}return a}async createPartialBackup(t,s){const a={metadata:{version:this.BACKUP_VERSION,timestamp:new Date().toISOString(),appVersion:this.APP_VERSION,totalRecords:0,totalCollections:t.length,collections:t},collections:{}};let n=0;for(const i of t){const c=await this.exportCollection(i);a.collections[i]=c,a.metadata.totalRecords+=c.length,n++,s&&s({currentCollection:i,processedCollections:n,totalCollections:t.length,currentRecords:c.length,totalRecords:a.metadata.totalRecords,percentage:Math.round(n/t.length*100)})}return a}async downloadBackup(t,s){const a=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),n=`molaga-backup-${new Date().toISOString().split("T")[0]}.json`;Ls.saveAs(a,s||n)}getBackupSize(t){const s=JSON.stringify(t),a=new Blob([s]).size;return a<1024?`${a} B`:a<1024*1024?`${(a/1024).toFixed(2)} KB`:`${(a/(1024*1024)).toFixed(2)} MB`}async readBackupFile(t){return new Promise((s,a)=>{const n=new FileReader;n.onload=i=>{try{const c=i.target?.result,m=JSON.parse(c);s(m)}catch{a(new Error("Invalid backup file format"))}},n.onerror=()=>{a(new Error("Failed to read backup file"))},n.readAsText(t)})}}const Gs=new qc;class Ac{RESTORE_ORDER=["vendors","stocks","raw_products","processes","products","staff","sales_channels","purchases","pre_production_tasks","production_tasks","post_production_tasks","sales_units","sales_records","stock_status","pre_production_status","production_status","post_production_status"];async validateBackup(t){const s=[],a=[];if(t.metadata?.version||s.push("Missing backup version"),t.metadata?.timestamp||s.push("Missing backup timestamp"),!t.collections||typeof t.collections!="object")return s.push("Invalid or missing collections data"),{valid:!1,errors:s,warnings:a};const n=["products","stocks","vendors"];for(const c of n)t.collections[c]||a.push(`Missing recommended collection: ${c}`);for(const[c,m]of Object.entries(t.collections))Array.isArray(m)?m.length>0&&(m[0].$id||a.push(`Documents in ${c} may be missing $id field`)):s.push(`Invalid data format for collection: ${c}`);const i=Object.values(t.collections).reduce((c,m)=>c+m.length,0);return t.metadata.totalRecords!==i&&a.push(`Metadata record count (${t.metadata.totalRecords}) doesn't match actual count (${i})`),{valid:s.length===0,errors:s,warnings:a}}cleanDocument(t){const{$id:s,$createdAt:a,$updatedAt:n,$permissions:i,$collectionId:c,$databaseId:m,...d}=t;return d}async documentExists(t,s){try{return await st.getDocument(at,ke[t],s),!0}catch{return!1}}async clearCollection(t){let s=0,a=!0;try{for(;a;){const n=await st.listDocuments(at,ke[t],[]);for(const i of n.documents)try{await st.deleteDocument(at,ke[t],i.$id),s++}catch(c){console.error(`Failed to delete document ${i.$id}:`,c)}a=n.documents.length>0}}catch(n){console.error(`Error clearing collection ${t}:`,n)}return s}async restoreCollection(t,s,a,n){const i={total:s.length,success:0,failed:0,skipped:0,errors:[]};for(let c=0;c<s.length;c++){const m=s[c];try{const d=this.cleanDocument(m),o=m.$id||hs.unique();if(a.handleIdConflicts==="skip"){if(await this.documentExists(t,o)){i.skipped++;continue}}else a.handleIdConflicts==="overwrite"&&await this.documentExists(t,o)&&await st.deleteDocument(at,ke[t],o);await st.createDocument(at,ke[t],a.handleIdConflicts==="new"?hs.unique():o,d),i.success++}catch(d){if(i.failed++,i.errors.push({documentId:m.$id||"unknown",error:d.message||"Unknown error"}),a.stopOnError)throw d}n&&n(c+1,s.length)}return i}async restoreFromBackup(t,s,a){const n={success:!0,collections:{},errors:[],totalProcessed:0,totalSuccess:0,totalFailed:0};try{a&&a({currentCollection:"",processedCollections:0,totalCollections:0,currentRecords:0,totalRecords:0,percentage:0,phase:"validating"});const i=await this.validateBackup(t);if(!i.valid)throw new Error(`Invalid backup: ${i.errors.join(", ")}`);const c=this.RESTORE_ORDER.filter(o=>t.collections[o]&&t.collections[o].length>0),m=c.length;let d=0;if(s.clearExisting){a&&a({currentCollection:"",processedCollections:0,totalCollections:m,currentRecords:0,totalRecords:0,percentage:0,phase:"clearing"});for(const o of c)await this.clearCollection(o)}for(const o of c){a&&a({currentCollection:o,processedCollections:d,totalCollections:m,currentRecords:0,totalRecords:n.totalProcessed,percentage:Math.round(d/m*100),phase:"restoring"});try{const f=t.collections[o],N=await this.restoreCollection(o,f,s,(g,y)=>{a&&a({currentCollection:o,processedCollections:d,totalCollections:m,currentRecords:g,totalRecords:n.totalProcessed+g,percentage:Math.round((d+g/y)/m*100),phase:"restoring"})});n.collections[o]=N,n.totalProcessed+=N.total,n.totalSuccess+=N.success,n.totalFailed+=N.failed,d++}catch(f){if(n.success=!1,n.errors.push({collection:o,error:f.message||"Unknown error"}),s.stopOnError)throw f}}a&&a({currentCollection:"",processedCollections:m,totalCollections:m,currentRecords:n.totalProcessed,totalRecords:n.totalProcessed,percentage:100,phase:"complete"})}catch(i){n.success=!1,n.errors.push({collection:"general",error:i.message||"Unknown error"})}return n}getRestoreSummary(t){const s=[`Total Collections: ${Object.keys(t.collections).length}`,`Total Records Processed: ${t.totalProcessed}`,`Successful: ${t.totalSuccess}`,`Failed: ${t.totalFailed}`];return t.errors.length>0&&(s.push(`
Errors: ${t.errors.length}`),t.errors.forEach(a=>{s.push(`  - ${a.collection}: ${a.error}`)})),s.join(`
`)}}const Fc=new Ac;function $c(){const{toast:r}=Ie(),t=u.useRef(null),[s,a]=u.useState(!1),[n,i]=u.useState(!1),[c,m]=u.useState(null),[d,o]=u.useState(null),[f,N]=u.useState(!1),[g,y]=u.useState(null),[j,P]=u.useState({autoBackup:!0,frequency:"daily",time:"00:00",retention:"30"}),[x,C]=u.useState({createSafetyBackup:!0,clearExisting:!0,handleIdConflicts:"skip",stopOnError:!1}),E=async()=>{a(!0),m(null);try{r({title:"Creating backup...",description:"This may take a few minutes depending on data size"});const F=await Gs.createFullBackup(O=>{m(O)}),K=Gs.getBackupSize(F);await Gs.downloadBackup(F),r({title:"Backup created successfully!",description:`Downloaded ${K} backup file with ${F.metadata.totalRecords} records`})}catch(F){console.error("Backup error:",F),r({title:"Backup failed",description:F.message||"An error occurred during backup",variant:"destructive"})}finally{a(!1),m(null)}},D=F=>{const K=F.target.files?.[0];if(K){if(!K.name.endsWith(".json")){r({title:"Invalid file type",description:"Please select a JSON backup file",variant:"destructive"});return}y(K),N(!0)}},T=async()=>{if(g){N(!1),i(!0),o(null);try{r({title:"Reading backup file...",description:"Please wait while we validate the backup"});const F=await Gs.readBackupFile(g);r({title:"Restoring data...",description:"This may take several minutes. Do not close this window."});const K=await Fc.restoreFromBackup(F,x,O=>{o(O)});K.success?r({title:"Restore completed successfully!",description:`Restored ${K.totalSuccess} records across ${Object.keys(K.collections).length} collections`}):(r({title:"Restore completed with errors",description:`${K.totalSuccess} succeeded, ${K.totalFailed} failed. Check console for details.`,variant:"destructive"}),console.error("Restore errors:",K.errors))}catch(F){console.error("Restore error:",F),r({title:"Restore failed",description:F.message||"An error occurred during restore",variant:"destructive"})}finally{i(!1),o(null),y(null),t.current&&(t.current.value="")}}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(Qe,{children:[e.jsx(Dt,{className:"h-4 w-4"}),e.jsx(Ye,{children:"Always create a backup before making major changes. Store backups securely in multiple locations."})]}),s&&c&&e.jsxs(ae,{children:[e.jsx(fe,{children:e.jsxs(je,{className:"flex items-center gap-2",children:[e.jsx(ze,{className:"h-5 w-5 animate-spin"}),"Creating Backup..."]})}),e.jsx(ne,{className:"space-y-4",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsxs("span",{children:["Processing: ",c.currentCollection]}),e.jsxs("span",{children:[c.percentage,"%"]})]}),e.jsx(Ds,{value:c.percentage}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:[c.processedCollections," / ",c.totalCollections," collections (",c.totalRecords," records)"]})]})})]}),n&&d&&e.jsxs(ae,{children:[e.jsx(fe,{children:e.jsxs(je,{className:"flex items-center gap-2",children:[e.jsx(ze,{className:"h-5 w-5 animate-spin"}),"Restoring Data..."]})}),e.jsx(ne,{className:"space-y-4",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsxs("span",{children:["Phase: ",d.phase]}),e.jsxs("span",{children:[d.percentage,"%"]})]}),e.jsx(Ds,{value:d.percentage}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:[d.currentCollection&&`Processing: ${d.currentCollection}`,e.jsx("br",{}),d.processedCollections," / ",d.totalCollections," collections (",d.totalRecords," records)"]})]})})]}),e.jsxs(ae,{children:[e.jsxs(fe,{children:[e.jsx(je,{children:"Create Backup"}),e.jsx(De,{children:"Export all your data to a JSON file"})]}),e.jsxs(ne,{className:"space-y-4",children:[e.jsxs(Qe,{children:[e.jsx(ia,{className:"h-4 w-4"}),e.jsx(Ye,{children:"Full backup includes all master data, transactions, tasks, and status records. The backup file will be downloaded to your computer."})]}),e.jsx(A,{onClick:E,disabled:s||n,className:"gap-2",children:s?e.jsxs(e.Fragment,{children:[e.jsx(ze,{className:"h-4 w-4 animate-spin"}),"Creating Backup..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ia,{className:"h-4 w-4"}),"Create Full Backup"]})})]})]}),e.jsxs(ae,{children:[e.jsxs(fe,{children:[e.jsx(je,{children:"Restore Data"}),e.jsx(De,{children:"Import data from a backup file"})]}),e.jsxs(ne,{className:"space-y-4",children:[e.jsxs(Qe,{children:[e.jsx(Dt,{className:"h-4 w-4"}),e.jsx(Ye,{children:"Warning: Restoring will replace current data. Make sure you have a recent backup before proceeding."})]}),e.jsx("input",{ref:t,type:"file",accept:".json",onChange:D,className:"hidden"}),e.jsxs(A,{variant:"outline",onClick:()=>t.current?.click(),disabled:s||n,className:"gap-2",children:[e.jsx(na,{className:"h-4 w-4"}),"Select Backup File"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Supported format: JSON backup files created by this system"})]})]}),e.jsx(lt,{open:f,onOpenChange:N,children:e.jsxs(rt,{className:"max-w-2xl",children:[e.jsxs(nt,{children:[e.jsx(ot,{children:"Confirm Data Restore"}),e.jsxs(ct,{children:["You are about to restore data from: ",g?.name]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs(Qe,{children:[e.jsx(Dt,{className:"h-4 w-4"}),e.jsx(Ye,{children:"This operation will modify your database. Please review the options carefully."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx($,{children:"Create Safety Backup First"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Backup current data before restoring"})]}),e.jsx($t,{checked:x.createSafetyBackup,onCheckedChange:F=>C({...x,createSafetyBackup:F})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx($,{children:"Clear Existing Data"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Remove all current data before restore"})]}),e.jsx($t,{checked:x.clearExisting,onCheckedChange:F=>C({...x,clearExisting:F})})]}),e.jsxs("div",{children:[e.jsx($,{children:"Handle ID Conflicts"}),e.jsxs(le,{value:x.handleIdConflicts,onValueChange:F=>C({...x,handleIdConflicts:F}),children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"skip",children:"Skip existing records"}),e.jsx(S,{value:"overwrite",children:"Overwrite existing records"}),e.jsx(S,{value:"new",children:"Create with new IDs"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx($,{children:"Stop on Error"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Stop restore if any error occurs"})]}),e.jsx($t,{checked:x.stopOnError,onCheckedChange:F=>C({...x,stopOnError:F})})]})]})]}),e.jsxs(it,{children:[e.jsx(A,{variant:"outline",onClick:()=>N(!1),children:"Cancel"}),e.jsxs(A,{onClick:T,className:"gap-2",children:[e.jsx(Xt,{className:"h-4 w-4"}),"Start Restore"]})]})]})})]})}function Ic(){const{toast:r}=Ie(),[t,s]=u.useState({minPasswordLength:"8",requireUppercase:!0,requireLowercase:!0,requireNumbers:!0,requireSpecialChars:!0,passwordExpiry:"90",sessionTimeout:"30",maxSessions:"3",enable2FA:!1,loginAttempts:"5",lockoutDuration:"30"});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(ae,{children:[e.jsxs(fe,{children:[e.jsxs(je,{className:"flex items-center gap-2",children:[e.jsx(Fi,{className:"h-5 w-5"}),"Password Policy"]}),e.jsx(De,{children:"Configure password requirements"})]}),e.jsxs(ne,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx($,{children:"Minimum Password Length"}),e.jsxs(le,{value:t.minPasswordLength,onValueChange:a=>s({...t,minPasswordLength:a}),children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsx(oe,{children:[6,8,10,12,16].map(a=>e.jsxs(S,{value:String(a),children:[a," characters"]},a))})]})]}),e.jsxs("div",{children:[e.jsx($,{children:"Password Expiry"}),e.jsxs(le,{value:t.passwordExpiry,onValueChange:a=>s({...t,passwordExpiry:a}),children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"never",children:"Never"}),e.jsx(S,{value:"30",children:"30 days"}),e.jsx(S,{value:"60",children:"60 days"}),e.jsx(S,{value:"90",children:"90 days"})]})]})]})]}),e.jsx("div",{className:"space-y-3",children:[{key:"requireUppercase",label:"Require Uppercase Letters"},{key:"requireLowercase",label:"Require Lowercase Letters"},{key:"requireNumbers",label:"Require Numbers"},{key:"requireSpecialChars",label:"Require Special Characters"}].map(({key:a,label:n})=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx($,{children:n}),e.jsx($t,{checked:t[a],onCheckedChange:i=>s({...t,[a]:i})})]},a))})]})]}),e.jsxs(ae,{children:[e.jsxs(fe,{children:[e.jsxs(je,{className:"flex items-center gap-2",children:[e.jsx(an,{className:"h-5 w-5"}),"Session Management"]}),e.jsx(De,{children:"Control user sessions and timeouts"})]}),e.jsx(ne,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx($,{children:"Session Timeout (minutes)"}),e.jsxs(le,{value:t.sessionTimeout,onValueChange:a=>s({...t,sessionTimeout:a}),children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsx(oe,{children:[15,30,60,120].map(a=>e.jsxs(S,{value:String(a),children:[a," minutes"]},a))})]})]}),e.jsxs("div",{children:[e.jsx($,{children:"Max Concurrent Sessions"}),e.jsxs(le,{value:t.maxSessions,onValueChange:a=>s({...t,maxSessions:a}),children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsx(oe,{children:[1,2,3,5,10].map(a=>e.jsxs(S,{value:String(a),children:[a," session",a>1?"s":""]},a))})]})]})]})})]}),e.jsxs(ae,{children:[e.jsxs(fe,{children:[e.jsxs(je,{className:"flex items-center gap-2",children:[e.jsx(Ur,{className:"h-5 w-5"}),"Access Control"]}),e.jsx(De,{children:"Configure login security"})]}),e.jsxs(ne,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx($,{children:"Enable Two-Factor Authentication (2FA)"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Require 2FA for all users"})]}),e.jsx($t,{checked:t.enable2FA,onCheckedChange:a=>s({...t,enable2FA:a})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx($,{children:"Login Attempt Limit"}),e.jsxs(le,{value:t.loginAttempts,onValueChange:a=>s({...t,loginAttempts:a}),children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsx(oe,{children:[3,5,10].map(a=>e.jsxs(S,{value:String(a),children:[a," attempts"]},a))})]})]}),e.jsxs("div",{children:[e.jsx($,{children:"Account Lockout Duration"}),e.jsxs(le,{value:t.lockoutDuration,onValueChange:a=>s({...t,lockoutDuration:a}),children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsx(oe,{children:[15,30,60].map(a=>e.jsxs(S,{value:String(a),children:[a," minutes"]},a))})]})]})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(A,{onClick:()=>r({title:"Security settings saved"}),className:"gap-2",children:[e.jsx(ha,{className:"h-4 w-4"}),"Save Security Settings"]})})]})}function Lc(){const{toast:r}=Ie(),[t,s]=u.useState({host:"smtp.gmail.com",port:"587",username:"noreply@molaga.com",password:"",fromEmail:"noreply@molaga.com",fromName:"Molaga ERP",useTLS:!0}),[a,n]=u.useState({lowStockAlerts:!0,taskCompletion:!0,backupStatus:!0,userLogin:!1,dataImportExport:!0});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(ae,{children:[e.jsxs(fe,{children:[e.jsxs(je,{className:"flex items-center gap-2",children:[e.jsx(Ma,{className:"h-5 w-5"}),"Email Configuration"]}),e.jsx(De,{children:"Configure SMTP settings for email notifications"})]}),e.jsxs(ne,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx($,{children:"SMTP Host"}),e.jsx(G,{value:t.host,onChange:i=>s({...t,host:i.target.value})})]}),e.jsxs("div",{children:[e.jsx($,{children:"SMTP Port"}),e.jsx(G,{value:t.port,onChange:i=>s({...t,port:i.target.value})})]}),e.jsxs("div",{children:[e.jsx($,{children:"Username"}),e.jsx(G,{value:t.username,onChange:i=>s({...t,username:i.target.value})})]}),e.jsxs("div",{children:[e.jsx($,{children:"Password"}),e.jsx(G,{type:"password",value:t.password,onChange:i=>s({...t,password:i.target.value})})]}),e.jsxs("div",{children:[e.jsx($,{children:"From Email"}),e.jsx(G,{type:"email",value:t.fromEmail,onChange:i=>s({...t,fromEmail:i.target.value})})]}),e.jsxs("div",{children:[e.jsx($,{children:"From Name"}),e.jsx(G,{value:t.fromName,onChange:i=>s({...t,fromName:i.target.value})})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx($,{children:"Use TLS/SSL"}),e.jsx($t,{checked:t.useTLS,onCheckedChange:i=>s({...t,useTLS:i})})]}),e.jsxs(A,{variant:"outline",className:"gap-2",children:[e.jsx($i,{className:"h-4 w-4"}),"Send Test Email"]})]})]}),e.jsxs(ae,{children:[e.jsxs(fe,{children:[e.jsx(je,{children:"Notification Preferences"}),e.jsx(De,{children:"Choose which notifications to receive"})]}),e.jsx(ne,{className:"space-y-4",children:[{key:"lowStockAlerts",label:"Low Stock Alerts",desc:"Get notified when stock falls below minimum level"},{key:"taskCompletion",label:"Task Completion",desc:"Notifications when tasks are completed"},{key:"backupStatus",label:"Backup Success/Failure",desc:"Get notified about backup operations"},{key:"userLogin",label:"User Login Alerts",desc:"Notifications for user login activity"},{key:"dataImportExport",label:"Data Import/Export Status",desc:"Updates on data operations"}].map(({key:i,label:c,desc:m})=>e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{children:[e.jsx($,{children:c}),e.jsx("p",{className:"text-sm text-muted-foreground",children:m})]}),e.jsx($t,{checked:a[i],onCheckedChange:d=>n({...a,[i]:d})})]},i))})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(A,{onClick:()=>r({title:"Notification settings saved"}),className:"gap-2",children:[e.jsx(ha,{className:"h-4 w-4"}),"Save Settings"]})})]})}const or="molaga_data_settings",lr={importFormat:"csv",exportFormat:"csv",dateFormat:"DD/MM/YYYY",encoding:"utf8"};class Mc{settings;constructor(){this.settings=this.loadSettings()}loadSettings(){try{const t=localStorage.getItem(or);if(t)return{...lr,...JSON.parse(t)}}catch(t){console.error("Error loading data settings:",t)}return lr}saveSettings(){try{localStorage.setItem(or,JSON.stringify(this.settings))}catch(t){console.error("Error saving data settings:",t)}}getSettings(){return{...this.settings}}updateSettings(t){return this.settings={...this.settings,...t},this.saveSettings(),this.getSettings()}async archiveOldRecords(t){return new Promise(s=>{setTimeout(()=>{s({success:!0,count:0})},1e3)})}async deleteCancelledTasks(t){return new Promise(s=>{setTimeout(()=>{s({success:!0,count:0})},1e3)})}async clearAuditLogs(t){return new Promise(s=>{setTimeout(()=>{s({success:!0,count:0})},1e3)})}async optimizeDatabase(){return new Promise(t=>{setTimeout(()=>{t({success:!0,message:"Database optimized successfully"})},2e3)})}}const Ns=new Mc;function Oc(){const[r,t]=u.useState(Ns.getSettings()),[s,a]=u.useState(!1),n=u.useCallback(o=>{const f=Ns.updateSettings(o);return t(f),f},[]),i=u.useCallback(async o=>{a(!0);try{return await Ns.archiveOldRecords(o)}finally{a(!1)}},[]),c=u.useCallback(async o=>{a(!0);try{return await Ns.deleteCancelledTasks(o)}finally{a(!1)}},[]),m=u.useCallback(async o=>{a(!0);try{return await Ns.clearAuditLogs(o)}finally{a(!1)}},[]),d=u.useCallback(async()=>{a(!0);try{return await Ns.optimizeDatabase()}finally{a(!1)}},[]);return{settings:r,updateSettings:n,archiveOldRecords:i,deleteCancelledTasks:c,clearAuditLogs:m,optimizeDatabase:d,isProcessing:s}}function Uc(){const{toast:r}=Ie(),{settings:t,updateSettings:s,archiveOldRecords:a,deleteCancelledTasks:n,clearAuditLogs:i,optimizeDatabase:c,isProcessing:m}=Oc(),d=async()=>{if(!confirm("Are you sure you want to archive old records?"))return;const g=await a(12);g.success&&r({title:`Archived ${g.count} records successfully`})},o=async()=>{if(!confirm("Are you sure you want to delete cancelled tasks?"))return;const g=await n(90);g.success&&r({title:`Deleted ${g.count} tasks successfully`})},f=async()=>{if(!confirm("Are you sure you want to clear audit logs?"))return;const g=await i(6);g.success&&r({title:`Cleared ${g.count} log entries successfully`})},N=async()=>{const g=await c();g.success&&r({title:g.message})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(ae,{children:[e.jsxs(fe,{children:[e.jsxs(je,{className:"flex items-center gap-2",children:[e.jsx(Cs,{className:"h-5 w-5"}),"Import/Export Settings"]}),e.jsx(De,{children:"Configure default import and export preferences"})]}),e.jsx(ne,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx($,{children:"Default Import Format"}),e.jsxs(le,{value:t.importFormat,onValueChange:g=>s({importFormat:g}),children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"csv",children:"CSV"}),e.jsx(S,{value:"excel",children:"Excel"}),e.jsx(S,{value:"json",children:"JSON"})]})]})]}),e.jsxs("div",{children:[e.jsx($,{children:"Default Export Format"}),e.jsxs(le,{value:t.exportFormat,onValueChange:g=>s({exportFormat:g}),children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"csv",children:"CSV"}),e.jsx(S,{value:"excel",children:"Excel"}),e.jsx(S,{value:"pdf",children:"PDF"})]})]})]}),e.jsxs("div",{children:[e.jsx($,{children:"Date Format for Import/Export"}),e.jsxs(le,{value:t.dateFormat,onValueChange:g=>s({dateFormat:g}),children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"DD/MM/YYYY",children:"DD/MM/YYYY"}),e.jsx(S,{value:"MM/DD/YYYY",children:"MM/DD/YYYY"}),e.jsx(S,{value:"YYYY-MM-DD",children:"YYYY-MM-DD"})]})]})]}),e.jsxs("div",{children:[e.jsx($,{children:"File Encoding"}),e.jsxs(le,{value:t.encoding,onValueChange:g=>s({encoding:g}),children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"utf8",children:"UTF-8"}),e.jsx(S,{value:"utf16",children:"UTF-16"}),e.jsx(S,{value:"ascii",children:"ASCII"})]})]})]})]})})]}),e.jsxs(ae,{children:[e.jsxs(fe,{children:[e.jsxs(je,{className:"flex items-center gap-2",children:[e.jsx(It,{className:"h-5 w-5"}),"Data Cleanup"]}),e.jsx(De,{children:"Manage old and unnecessary data"})]}),e.jsxs(ne,{className:"space-y-4",children:[e.jsxs(Qe,{children:[e.jsx(Dt,{className:"h-4 w-4"}),e.jsx(Ye,{children:"Data cleanup operations are permanent. Always create a backup before proceeding."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx($,{children:"Archive Old Records"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Move records older than 12 months to archive"})]}),e.jsx(A,{variant:"outline",onClick:d,disabled:m,children:m?e.jsx(ze,{className:"h-4 w-4 animate-spin"}):"Archive"})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx($,{children:"Delete Cancelled Tasks"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Remove cancelled tasks older than 90 days"})]}),e.jsx(A,{variant:"outline",onClick:o,disabled:m,children:m?e.jsx(ze,{className:"h-4 w-4 animate-spin"}):"Delete"})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx($,{children:"Clear Audit Logs"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Remove audit logs older than 6 months"})]}),e.jsx(A,{variant:"outline",onClick:f,disabled:m,children:m?e.jsx(ze,{className:"h-4 w-4 animate-spin"}):"Clear"})]})]})]})]}),e.jsxs(ae,{children:[e.jsxs(fe,{children:[e.jsxs(je,{className:"flex items-center gap-2",children:[e.jsx(ia,{className:"h-5 w-5"}),"Database Maintenance"]}),e.jsx(De,{children:"Optimize database performance"})]}),e.jsx(ne,{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx($,{children:"Optimize Database"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Rebuild indexes and optimize tables"})]}),e.jsx(A,{variant:"outline",onClick:N,disabled:m,children:m?e.jsx(ze,{className:"h-4 w-4 animate-spin"}):"Optimize"})]})})]})]})}const ws="molaga_api_keys";class Kc{generateKey(t,s,a){const n=this.createSecureKey(),i=new Date,c={id:this.generateId(),name:t,key:n,createdAt:i.toISOString(),expiresAt:a?new Date(i.getTime()+a*24*60*60*1e3).toISOString():void 0,permissions:s,isActive:!0};return this.saveKey(c),c}createSecureKey(){return`mlg_${this.generateRandomString(32)}`}generateRandomString(t){const s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let a="";const n=new Uint8Array(t);crypto.getRandomValues(n);for(let i=0;i<t;i++)a+=s[n[i]%s.length];return a}generateId(){return`key_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}saveKey(t){const s=this.getAllKeys();s.push(t),localStorage.setItem(ws,JSON.stringify(s))}getAllKeys(){try{const t=localStorage.getItem(ws);return t?JSON.parse(t):[]}catch(t){return console.error("Error loading API keys:",t),[]}}getKeyById(t){return this.getAllKeys().find(a=>a.id===t)||null}revokeKey(t){const s=this.getAllKeys(),a=s.findIndex(n=>n.id===t);return a!==-1?(s[a].isActive=!1,localStorage.setItem(ws,JSON.stringify(s)),!0):!1}deleteKey(t){const s=this.getAllKeys(),a=s.filter(n=>n.id!==t);return a.length!==s.length?(localStorage.setItem(ws,JSON.stringify(a)),!0):!1}validateKey(t){const a=this.getAllKeys().find(n=>n.key===t);return a?a.isActive?a.expiresAt&&new Date(a.expiresAt)<new Date?{valid:!1,error:"API key has expired"}:{valid:!0,apiKey:a}:{valid:!1,error:"API key has been revoked"}:{valid:!1,error:"Invalid API key"}}updateLastUsed(t){const s=this.getAllKeys(),a=s.findIndex(n=>n.id===t);a!==-1&&(s[a].lastUsed=new Date().toISOString(),localStorage.setItem(ws,JSON.stringify(s)))}regenerateKey(t){const s=this.getAllKeys(),a=s.findIndex(n=>n.id===t);return a!==-1?(s[a],s[a].key=this.createSecureKey(),s[a].createdAt=new Date().toISOString(),s[a].lastUsed=void 0,localStorage.setItem(ws,JSON.stringify(s)),s[a]):null}}const Yt=new Kc;function Vc(){const{toast:r}=Ie(),{user:t}=jt(),[s,a]=u.useState(Yt.getAllKeys()),[n,i]=u.useState(!1),[c,m]=u.useState(!1),[d,o]=u.useState({name:"",expiresIn:"90",permissions:["read"]}),[f,N]=u.useState(null),g=t?.email==="varda3d@gmail.com",y=()=>{if(!d.name.trim()){r({title:"Validation error",description:"Please enter a key name",variant:"destructive"});return}const T=d.expiresIn==="never"?void 0:parseInt(d.expiresIn),F=Yt.generateKey(d.name,d.permissions,T);N(F),a(Yt.getAllKeys()),i(!1),m(!0),o({name:"",expiresIn:"90",permissions:["read"]}),r({title:"API key created",description:"Copy the key now - it won't be shown again"})},j=T=>{navigator.clipboard.writeText(T),r({title:"Copied",description:"API key copied to clipboard"})},P=T=>{Yt.revokeKey(T),a(Yt.getAllKeys()),r({title:"API key revoked",description:"The key can no longer be used"})},x=T=>{Yt.deleteKey(T),a(Yt.getAllKeys()),r({title:"API key deleted",description:"The key has been permanently removed"})},C=T=>{const F=Yt.regenerateKey(T);F&&(N(F),a(Yt.getAllKeys()),m(!0),r({title:"API key regenerated",description:"Copy the new key now"}))},E=T=>new Date(T).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),D=T=>T&&new Date(T)<new Date;return g?e.jsxs("div",{className:"space-y-6",children:[e.jsxs(ae,{children:[e.jsx(fe,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(je,{className:"flex items-center gap-2",children:[e.jsx(Ca,{className:"h-5 w-5"}),"API Keys"]}),e.jsx(De,{children:"Generate and manage API keys for external integrations"})]}),e.jsxs(A,{onClick:()=>i(!0),className:"gap-2",children:[e.jsx(Ct,{className:"h-4 w-4"}),"Create API Key"]})]})}),e.jsxs(ne,{children:[e.jsxs(Qe,{className:"mb-6",children:[e.jsx(Dt,{className:"h-4 w-4"}),e.jsxs(Ye,{children:[e.jsx("strong",{children:"Security Notice:"})," API keys provide access to your system. Keep them secure and never share them publicly."]})]}),s.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(Ca,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No API keys created yet"}),e.jsx("p",{className:"text-sm",children:"Create your first API key to get started"})]}):e.jsx("div",{className:"space-y-4",children:s.map(T=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h4",{className:"font-medium",children:T.name}),T.isActive?D(T.expiresAt)?e.jsx(We,{variant:"destructive",children:"Expired"}):e.jsx(We,{variant:"default",className:"bg-green-500",children:"Active"}):e.jsx(We,{variant:"secondary",children:"Revoked"})]}),e.jsxs("div",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsxs("p",{children:["Key: ",T.key.substring(0,20),"...",T.key.substring(T.key.length-4)]}),e.jsxs("p",{children:["Created: ",E(T.createdAt)]}),T.expiresAt&&e.jsxs("p",{children:["Expires: ",E(T.expiresAt)]}),T.lastUsed&&e.jsxs("p",{children:["Last used: ",E(T.lastUsed)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(A,{variant:"outline",size:"sm",onClick:()=>j(T.key),className:"gap-2",children:[e.jsx(Vs,{className:"h-3 w-3"}),"Copy"]}),T.isActive&&!D(T.expiresAt)&&e.jsxs(e.Fragment,{children:[e.jsxs(A,{variant:"outline",size:"sm",onClick:()=>C(T.id),className:"gap-2",children:[e.jsx(qa,{className:"h-3 w-3"}),"Regenerate"]}),e.jsx(A,{variant:"outline",size:"sm",onClick:()=>P(T.id),className:"gap-2 text-orange-600 hover:text-orange-700",children:"Revoke"})]}),e.jsxs(A,{variant:"outline",size:"sm",onClick:()=>x(T.id),className:"gap-2 text-red-600 hover:text-red-700",children:[e.jsx(It,{className:"h-3 w-3"}),"Delete"]})]})]},T.id))})]})]}),e.jsx(lt,{open:n,onOpenChange:i,children:e.jsxs(rt,{children:[e.jsxs(nt,{children:[e.jsx(ot,{children:"Create New API Key"}),e.jsx(ct,{children:"Generate a new API key for external integrations"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx($,{htmlFor:"keyName",children:"Key Name *"}),e.jsx(G,{id:"keyName",placeholder:"e.g., Mobile App Integration",value:d.name,onChange:T=>o({...d,name:T.target.value})})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"expiresIn",children:"Expires In"}),e.jsxs(le,{value:d.expiresIn,onValueChange:T=>o({...d,expiresIn:T}),children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(S,{value:"30",children:"30 days"}),e.jsx(S,{value:"90",children:"90 days"}),e.jsx(S,{value:"180",children:"180 days"}),e.jsx(S,{value:"365",children:"1 year"}),e.jsx(S,{value:"never",children:"Never"})]})]})]})]}),e.jsxs(it,{children:[e.jsx(A,{variant:"outline",onClick:()=>i(!1),children:"Cancel"}),e.jsx(A,{onClick:y,children:"Create Key"})]})]})}),e.jsx(lt,{open:c,onOpenChange:m,children:e.jsxs(rt,{children:[e.jsxs(nt,{children:[e.jsxs(ot,{className:"flex items-center gap-2",children:[e.jsx(Xt,{className:"h-5 w-5 text-green-500"}),"API Key Created"]}),e.jsx(ct,{children:"Copy this key now - it won't be shown again"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs(Qe,{children:[e.jsx(Dt,{className:"h-4 w-4"}),e.jsx(Ye,{children:"Store this key securely. You won't be able to see it again."})]}),e.jsxs("div",{children:[e.jsx($,{children:"API Key"}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(G,{value:f?.key||"",readOnly:!0,className:"font-mono text-sm"}),e.jsxs(A,{variant:"outline",onClick:()=>j(f?.key||""),className:"gap-2",children:[e.jsx(Vs,{className:"h-4 w-4"}),"Copy"]})]})]})]}),e.jsx(it,{children:e.jsx(A,{onClick:()=>m(!1),children:"Done"})})]})})]}):e.jsxs(Qe,{children:[e.jsx(Dt,{className:"h-4 w-4"}),e.jsx(Ye,{children:"Only Super Admins can manage API keys. Contact your administrator for access."})]})}const cr="molaga_custom_domain";class Bc{getConfig(){try{const t=localStorage.getItem(cr);if(t)return JSON.parse(t)}catch(t){console.error("Error loading domain config:",t)}return{customDomain:null,isVerified:!1,verificationToken:this.generateVerificationToken(),verifiedAt:null,createdAt:null}}setDomain(t){const s=this.getConfig();s.customDomain=t,s.isVerified=!1,s.verifiedAt=null,s.createdAt=new Date().toISOString(),s.verificationToken||(s.verificationToken=this.generateVerificationToken()),this.saveConfig(s)}verifyDomain(){const t=this.getConfig();t.isVerified=!0,t.verifiedAt=new Date().toISOString(),this.saveConfig(t)}removeDomain(){const t={customDomain:null,isVerified:!1,verificationToken:this.generateVerificationToken(),verifiedAt:null,createdAt:null};this.saveConfig(t)}generateVerificationToken(){const t=new Uint8Array(16);return crypto.getRandomValues(t),Array.from(t,s=>s.toString(16).padStart(2,"0")).join("")}saveConfig(t){try{localStorage.setItem(cr,JSON.stringify(t))}catch(s){console.error("Error saving domain config:",s)}}isCustomDomainActive(){const t=this.getConfig();return!!(t.customDomain&&t.isVerified)}getActiveDomain(){const t=this.getConfig();return t.isVerified?t.customDomain:null}}const ps=new Bc;function Hc(){const{toast:r}=Ie(),{user:t}=jt(),[s,a]=u.useState(ps.getConfig()),[n,i]=u.useState(s.customDomain||""),[c,m]=u.useState(!1),d=t?.email==="varda3d@gmail.com",o=()=>{if(!n.trim()){r({title:"Validation error",description:"Please enter a domain name",variant:"destructive"});return}if(!/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(n)){r({title:"Invalid domain",description:"Please enter a valid domain name (e.g., erp.yourcompany.com)",variant:"destructive"});return}ps.setDomain(n),a(ps.getConfig()),r({title:"Domain saved",description:"Custom domain configuration updated"})},f=async()=>{m(!0),setTimeout(()=>{Math.random()>.3?(ps.verifyDomain(),a(ps.getConfig()),r({title:"Domain verified",description:"Your custom domain is now active"})):r({title:"Verification failed",description:"Please check your DNS records and try again",variant:"destructive"}),m(!1)},2e3)},N=()=>{ps.removeDomain(),a(ps.getConfig()),i(""),r({title:"Domain removed",description:"Custom domain configuration has been removed"})},g=y=>{navigator.clipboard.writeText(y),r({title:"Copied",description:"Copied to clipboard"})};return d?e.jsx("div",{className:"space-y-6",children:e.jsxs(ae,{children:[e.jsxs(fe,{children:[e.jsxs(je,{className:"flex items-center gap-2",children:[e.jsx(Pa,{className:"h-5 w-5"}),"Custom Domain"]}),e.jsx(De,{children:"Configure a custom domain for your ERP system"})]}),e.jsxs(ne,{className:"space-y-6",children:[e.jsxs(Qe,{children:[e.jsx(Dt,{className:"h-4 w-4"}),e.jsxs(Ye,{children:[e.jsx("strong",{children:"Note:"})," Custom domain configuration requires DNS changes. Make sure you have access to your domain's DNS settings."]})]}),s.customDomain&&e.jsxs("div",{className:"p-4 border rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pa,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:s.customDomain})]}),s.isVerified?e.jsxs(We,{className:"bg-green-500",children:[e.jsx(Xt,{className:"h-3 w-3 mr-1"}),"Verified"]}):e.jsx(We,{variant:"secondary",children:"Pending Verification"})]}),s.verifiedAt&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Verified on ",new Date(s.verifiedAt).toLocaleDateString()]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx($,{htmlFor:"domain",children:"Domain Name"}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(G,{id:"domain",placeholder:"erp.yourcompany.com",value:n,onChange:y=>i(y.target.value),disabled:s.isVerified}),s.isVerified?e.jsx(A,{variant:"outline",onClick:N,className:"text-red-600",children:"Remove"}):e.jsx(A,{onClick:o,children:"Save"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Enter your custom domain (e.g., erp.yourcompany.com)"})]}),s.customDomain&&!s.isVerified&&e.jsxs(ae,{children:[e.jsxs(fe,{children:[e.jsx(je,{className:"text-base",children:"DNS Configuration"}),e.jsx(De,{children:"Add these DNS records to your domain provider"})]}),e.jsxs(ne,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"p-3 border rounded-lg bg-muted/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Type: CNAME"}),e.jsx(A,{variant:"ghost",size:"sm",onClick:()=>g("CNAME"),className:"h-6 px-2",children:e.jsx(Vs,{className:"h-3 w-3"})})]}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," ",s.customDomain]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Value:"})," molaga-erp.app"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"TTL:"})," 3600"]})]})]}),e.jsxs("div",{className:"p-3 border rounded-lg bg-muted/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Type: TXT (Verification)"}),e.jsx(A,{variant:"ghost",size:"sm",onClick:()=>g(`molaga-verification=${s.verificationToken}`),className:"h-6 px-2",children:e.jsx(Vs,{className:"h-3 w-3"})})]}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," _molaga-verification.",s.customDomain]}),e.jsxs("p",{className:"break-all",children:[e.jsx("strong",{children:"Value:"})," molaga-verification=",s.verificationToken]}),e.jsxs("p",{children:[e.jsx("strong",{children:"TTL:"})," 3600"]})]})]})]}),e.jsxs(Qe,{children:[e.jsx(Dt,{className:"h-4 w-4"}),e.jsx(Ye,{children:'DNS changes can take up to 48 hours to propagate. After adding the records, click "Verify Domain" below.'})]}),e.jsx(A,{onClick:f,disabled:c,className:"w-full gap-2",children:c?e.jsx(e.Fragment,{children:"Verifying..."}):e.jsxs(e.Fragment,{children:[e.jsx(Xt,{className:"h-4 w-4"}),"Verify Domain"]})})]})]}),s.isVerified&&e.jsxs(ae,{children:[e.jsxs(fe,{children:[e.jsx(je,{className:"text-base",children:"SSL Certificate"}),e.jsx(De,{children:"Your domain is secured with SSL/TLS"})]}),e.jsxs(ne,{children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-600",children:[e.jsx(Xt,{className:"h-4 w-4"}),e.jsx("span",{children:"SSL certificate is active and valid"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Your custom domain is secured with automatic SSL certificate provisioning."})]})]}),e.jsxs(ae,{children:[e.jsx(fe,{children:e.jsx(je,{className:"text-base",children:"Need Help?"})}),e.jsxs(ne,{className:"space-y-2",children:[e.jsxs("a",{href:"#",className:"flex items-center gap-2 text-sm text-primary hover:underline",children:[e.jsx(Js,{className:"h-3 w-3"}),"How to configure DNS records"]}),e.jsxs("a",{href:"#",className:"flex items-center gap-2 text-sm text-primary hover:underline",children:[e.jsx(Js,{className:"h-3 w-3"}),"Troubleshooting domain verification"]}),e.jsxs("a",{href:"#",className:"flex items-center gap-2 text-sm text-primary hover:underline",children:[e.jsx(Js,{className:"h-3 w-3"}),"Contact support"]})]})]})]})]})]})}):e.jsxs(Qe,{children:[e.jsx(Dt,{className:"h-4 w-4"}),e.jsx(Ye,{children:"Only Super Admins can configure custom domains. Contact your administrator for access."})]})}function zc(){Ie();const{user:r}=jt(),[t,s]=u.useState("overview"),a=r?.email==="varda3d@gmail.com";return e.jsxs("div",{className:"space-y-6",children:[!a&&e.jsxs(Qe,{children:[e.jsx(Dt,{className:"h-4 w-4"}),e.jsxs(Ye,{children:[e.jsx("strong",{children:"Read-Only Mode:"})," Only Super Admin (varda3d@gmail.com) can modify integration settings."]})]}),e.jsxs(On,{value:t,onValueChange:s,children:[e.jsxs(za,{className:"grid w-full grid-cols-4",children:[e.jsx(_s,{value:"overview",children:"Overview"}),e.jsx(_s,{value:"api-keys",children:"API Keys"}),e.jsx(_s,{value:"domain",children:"Custom Domain"}),e.jsx(_s,{value:"webhooks",children:"Webhooks"})]}),e.jsxs(_t,{value:"overview",className:"space-y-6 mt-6",children:[e.jsxs(ae,{children:[e.jsxs(fe,{children:[e.jsxs(je,{className:"flex items-center gap-2",children:[e.jsx(Ca,{className:"h-5 w-5"}),"API Configuration"]}),e.jsx(De,{children:"Quick overview of API settings"})]}),e.jsx(ne,{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx($,{children:"API Access Status"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage API keys in the API Keys tab"})]}),e.jsx(We,{variant:"secondary",children:"View Details â†’"})]})})]}),e.jsxs(ae,{children:[e.jsxs(fe,{children:[e.jsxs(je,{className:"flex items-center gap-2",children:[e.jsx(Pa,{className:"h-5 w-5"}),"Custom Domain"]}),e.jsx(De,{children:"Configure your custom domain"})]}),e.jsx(ne,{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx($,{children:"Domain Status"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Configure custom domain in the Custom Domain tab"})]}),e.jsx(We,{variant:"secondary",children:"View Details â†’"})]})})]}),e.jsxs(ae,{children:[e.jsxs(fe,{children:[e.jsxs(je,{className:"flex items-center gap-2",children:[e.jsx(Ii,{className:"h-5 w-5"}),"Third-Party Integrations"]}),e.jsx(De,{children:"Connect with external services"})]}),e.jsx(ne,{className:"space-y-4",children:[{name:"Accounting Software",status:"Not Connected",available:!1},{name:"Payment Gateway",status:"Not Connected",available:!1},{name:"SMS Gateway",status:"Not Connected",available:!1},{name:"Cloud Storage",status:"Not Connected",available:!1}].map(n=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx($,{children:n.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:n.status})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!n.available&&e.jsx(We,{variant:"secondary",children:"Coming Soon"}),e.jsx(A,{variant:"outline",size:"sm",disabled:!n.available||!a,children:"Configure"})]})]},n.name))})]})]}),e.jsx(_t,{value:"api-keys",className:"mt-6",children:e.jsx(Vc,{})}),e.jsx(_t,{value:"domain",className:"mt-6",children:e.jsx(Hc,{})}),e.jsx(_t,{value:"webhooks",className:"space-y-6 mt-6",children:e.jsxs(ae,{children:[e.jsxs(fe,{children:[e.jsxs(je,{className:"flex items-center gap-2",children:[e.jsx(Li,{className:"h-5 w-5"}),"Webhooks"]}),e.jsx(De,{children:"Configure webhook endpoints for real-time notifications"})]}),e.jsxs(ne,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx($,{children:"Webhook URL"}),e.jsx(G,{placeholder:"https://your-domain.com/webhook",disabled:!a}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Receive POST requests when events occur"})]}),e.jsxs("div",{children:[e.jsx($,{children:"Events to Subscribe"}),e.jsx("div",{className:"space-y-2 mt-2",children:["Task Created","Task Completed","Low Stock Alert","Backup Completed"].map(n=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:n}),e.jsx($t,{disabled:!a})]},n))})]}),e.jsx(A,{variant:"outline",disabled:!a,children:"Test Webhook"})]})]})})]})]})}function Qc(){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(ae,{children:[e.jsxs(fe,{children:[e.jsxs(je,{className:"flex items-center gap-2",children:[e.jsx(Da,{className:"h-5 w-5"}),"System Information"]}),e.jsx(De,{children:"Details about your Molaga ERP installation"})]}),e.jsx(ne,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Application Name"}),e.jsx("p",{className:"font-medium",children:"Molaga ERP"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Version"}),e.jsxs("p",{className:"font-medium flex items-center gap-2",children:["1.0.0",e.jsxs(We,{variant:"default",className:"gap-1",children:[e.jsx(Xt,{className:"h-3 w-3"}),"Latest"]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Build Date"}),e.jsx("p",{className:"font-medium",children:"October 11, 2025"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"License Type"}),e.jsx("p",{className:"font-medium",children:"Enterprise"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Licensed To"}),e.jsx("p",{className:"font-medium",children:"Molaga Spices Pvt Ltd"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"License Expiry"}),e.jsx("p",{className:"font-medium",children:"October 11, 2026"})]})]})})]}),e.jsxs(ae,{children:[e.jsxs(fe,{children:[e.jsx(je,{children:"Support & Help"}),e.jsx(De,{children:"Get assistance with Molaga ERP"})]}),e.jsx(ne,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3 p-4 border rounded-lg",children:[e.jsx(Cs,{className:"h-5 w-5 text-primary mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Documentation"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Comprehensive guides and tutorials"}),e.jsxs(A,{variant:"link",className:"h-auto p-0 gap-1",children:["View Docs",e.jsx(Js,{className:"h-3 w-3"})]})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 border rounded-lg",children:[e.jsx(Ma,{className:"h-5 w-5 text-primary mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Email Support"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"support@molagaerp.com"}),e.jsx(A,{variant:"link",className:"h-auto p-0",children:"Send Email"})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 border rounded-lg",children:[e.jsx(Mi,{className:"h-5 w-5 text-primary mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Phone Support"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"+91 9876543210"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Mon-Fri, 9 AM - 6 PM IST"})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 border rounded-lg",children:[e.jsx(Da,{className:"h-5 w-5 text-primary mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Submit Feedback"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Help us improve"}),e.jsx(A,{variant:"link",className:"h-auto p-0",children:"Give Feedback"})]})]})]})})]}),e.jsxs(ae,{children:[e.jsxs(fe,{children:[e.jsx(je,{children:"Updates"}),e.jsx(De,{children:"Check for system updates"})]}),e.jsxs(ne,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg bg-muted/50",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"You're running the latest version"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Last checked: October 11, 2025"})]}),e.jsx(A,{variant:"outline",children:"Check for Updates"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium mb-2",children:"Recent Updates"}),e.jsx("div",{className:"space-y-2",children:[{version:"1.0.0",date:"Oct 11, 2025",changes:"Initial release with full ERP features"},{version:"0.9.5",date:"Oct 1, 2025",changes:"Beta testing and bug fixes"},{version:"0.9.0",date:"Sep 15, 2025",changes:"Added validation system"}].map(r=>e.jsxs("div",{className:"p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("p",{className:"font-medium text-sm",children:["Version ",r.version]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r.date})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r.changes})]},r.version))})]})]})]}),e.jsxs(ae,{children:[e.jsx(fe,{children:e.jsx(je,{children:"About Molaga ERP"})}),e.jsxs(ne,{children:[e.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed",children:"Molaga ERP is a comprehensive enterprise resource planning system designed specifically for spice manufacturing businesses. It streamlines operations from raw material procurement through production processes to final product sales, providing real-time insights and data-driven decision making capabilities."}),e.jsx("p",{className:"text-sm text-muted-foreground mt-4",children:"Â© 2025 Molaga ERP. All rights reserved."})]})]})]})}const Yc=[{value:"company",label:"Company Profile",icon:qr},{value:"users",label:"User Management",icon:Jr},{value:"approvals",label:"User Approvals",icon:Xr},{value:"system",label:"System Config",icon:Oi},{value:"backup",label:"Backup & Restore",icon:ia},{value:"security",label:"Security",icon:an},{value:"notifications",label:"Notifications",icon:Ar},{value:"data",label:"Data Management",icon:Cs},{value:"integrations",label:"Integrations",icon:xs},{value:"about",label:"About",icon:Da}];function Wc(){const[r,t]=u.useState("company");return e.jsxs("div",{className:"container mx-auto p-6 max-w-7xl",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Settings"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage your system configuration and preferences"})]}),e.jsx(ae,{className:"p-6",children:e.jsxs(On,{value:r,onValueChange:t,className:"space-y-6",children:[e.jsx(za,{className:"grid grid-cols-3 lg:grid-cols-10 gap-2 h-auto p-2",children:Yc.map(s=>e.jsxs(_s,{value:s.value,className:"flex flex-col items-center gap-1 py-3 data-[state=active]:bg-primary data-[state=active]:text-primary-foreground",children:[e.jsx(s.icon,{className:"h-4 w-4"}),e.jsx("span",{className:"text-xs",children:s.label})]},s.value))}),e.jsx(_t,{value:"company",className:"space-y-4",children:e.jsx(Nc,{})}),e.jsx(_t,{value:"users",className:"space-y-4",children:e.jsx(Dc,{})}),e.jsx(_t,{value:"approvals",className:"space-y-4",children:e.jsx(Ec,{})}),e.jsx(_t,{value:"system",className:"space-y-4",children:e.jsx(Rc,{})}),e.jsx(_t,{value:"backup",className:"space-y-4",children:e.jsx($c,{})}),e.jsx(_t,{value:"security",className:"space-y-4",children:e.jsx(Ic,{})}),e.jsx(_t,{value:"notifications",className:"space-y-4",children:e.jsx(Lc,{})}),e.jsx(_t,{value:"data",className:"space-y-4",children:e.jsx(Uc,{})}),e.jsx(_t,{value:"integrations",className:"space-y-4",children:e.jsx(zc,{})}),e.jsx(_t,{value:"about",className:"space-y-4",children:e.jsx(Qc,{})})]})})]})}const Gc=new Vi({defaultOptions:{queries:{staleTime:300*1e3,gcTime:600*1e3,retry:(r,t)=>t?.code===401||t?.code===403?!1:r<3,refetchOnWindowFocus:!1,refetchOnMount:!0,refetchOnReconnect:!0},mutations:{retry:(r,t)=>t?.code===401||t?.code===403?!1:r<2}}}),Jc=Hi([{path:"/login",element:e.jsx(Nl,{})},{path:"/register",element:e.jsx(wl,{})},{path:"/",element:e.jsx(Xe,{children:e.jsx(Je,{children:e.jsx(Tl,{})})})},{path:"/purchases",element:e.jsx(Xe,{children:e.jsx(Je,{children:e.jsx($l,{})})})},{path:"/tasks",element:e.jsx(Xe,{children:e.jsx(Je,{children:e.jsx(Ml,{})})})},{path:"/status",element:e.jsx(Xe,{children:e.jsx(Je,{children:e.jsx(Ol,{})})})},{path:"/sales",element:e.jsx(Xe,{children:e.jsx(Je,{children:e.jsx(Ul,{})})})},{path:"/sales/units",element:e.jsx(Xe,{children:e.jsx(Je,{children:e.jsx(Bl,{})})})},{path:"/sales/records",element:e.jsx(Xe,{children:e.jsx(Je,{children:e.jsx(Hl,{})})})},{path:"/master",element:e.jsx(Xe,{children:e.jsx(Je,{children:e.jsx(zl,{})})})},{path:"/master/stocks",element:e.jsx(Xe,{children:e.jsx(Je,{children:e.jsx(Wl,{})})})},{path:"/master/vendors",element:e.jsx(Xe,{children:e.jsx(Je,{children:e.jsx(Gl,{})})})},{path:"/master/staff",element:e.jsx(Xe,{children:e.jsx(Je,{children:e.jsx(Jl,{})})})},{path:"/master/processes",element:e.jsx(Xe,{children:e.jsx(Je,{children:e.jsx(Xl,{})})})},{path:"/master/raw-products",element:e.jsx(Xe,{children:e.jsx(Je,{children:e.jsx(Zl,{})})})},{path:"/master/products",element:e.jsx(Xe,{children:e.jsx(Je,{children:e.jsx(ec,{})})})},{path:"/master/sales-channels",element:e.jsx(Xe,{children:e.jsx(Je,{children:e.jsx(tc,{})})})},{path:"/analytics",element:e.jsx(Xe,{children:e.jsx(Je,{children:e.jsx(Ql,{})})})},{path:"/status/stock-status",element:e.jsx(Xe,{children:e.jsx(Je,{children:e.jsx(ac,{})})})},{path:"/status/pre-production-status",element:e.jsx(Xe,{children:e.jsx(Je,{children:e.jsx(rc,{})})})},{path:"/status/production-status",element:e.jsx(Xe,{children:e.jsx(Je,{children:e.jsx(nc,{})})})},{path:"/status/post-production-status",element:e.jsx(Xe,{children:e.jsx(Je,{children:e.jsx(oc,{})})})},{path:"/status/inventory-status",element:e.jsx(Xe,{children:e.jsx(Je,{children:e.jsx(lc,{})})})},{path:"/tasks/pre-production",element:e.jsx(Xe,{children:e.jsx(Je,{children:e.jsx(mc,{})})})},{path:"/tasks/production",element:e.jsx(Xe,{children:e.jsx(Je,{children:e.jsx(gc,{})})})},{path:"/tasks/post-production",element:e.jsx(Xe,{children:e.jsx(Je,{children:e.jsx(yc,{})})})},{path:"/settings",element:e.jsx(Xe,{children:e.jsx(Je,{children:e.jsx(Wc,{})})})},{path:"*",element:e.jsx(Yl,{})}],{future:{v7_startTransition:!0}}),Xc=()=>e.jsx(Bi,{client:Gc,children:e.jsx(po,{children:e.jsx(qo,{children:e.jsxs(dn,{children:[e.jsx(io,{}),e.jsx(oo,{}),e.jsx(Mo,{}),e.jsx(zi,{router:Jc,future:{v7_startTransition:!0}})]})})})});Kn.createRoot(document.getElementById("root")).render(e.jsx(Xc,{}));
